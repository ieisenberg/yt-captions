[
  {
    "start": "0",
    "end": "97000"
  },
  {
    "text": "[Music]",
    "start": "3890",
    "end": "13690"
  },
  {
    "text": "hi there uh this is nicholas jolie it's great to be with you today i hope that you're all safe and doing",
    "start": "14240",
    "end": "20320"
  },
  {
    "text": "well in those difficult times um i'm going to talk about a project",
    "start": "20320",
    "end": "25840"
  },
  {
    "text": "that i did in summer 2018 for excel online so i work for microsoft",
    "start": "25840",
    "end": "32558"
  },
  {
    "text": "at the msrc and i'm doing this recording from the uk from home actually i'm",
    "start": "32559",
    "end": "37840"
  },
  {
    "text": "living in cheltenham in england so i'm here to talk about an exploit that i did for",
    "start": "37840",
    "end": "44559"
  },
  {
    "text": "excel online so i guess that this plantation is going to take roughly about 30 minutes or so yeah something",
    "start": "44559",
    "end": "51440"
  },
  {
    "text": "like that so i'm going to talk first about office exploits",
    "start": "51440",
    "end": "56480"
  },
  {
    "text": "that we've seen in the past years and then i will describe a bit uh",
    "start": "56480",
    "end": "62719"
  },
  {
    "text": "the office online server what's going on there how the services interact between each other",
    "start": "62719",
    "end": "69200"
  },
  {
    "text": "and then i will dig on the vulnerability that i found and how i managed to",
    "start": "69200",
    "end": "75840"
  },
  {
    "text": "exploit it and in the end i will discuss a bit uh this exploit see if this is the kind of things that",
    "start": "75840",
    "end": "83200"
  },
  {
    "text": "we could expect to see in the cloud today so i hope that you guys are going",
    "start": "83200",
    "end": "88640"
  },
  {
    "text": "to learn a few things from this plantation and i really hope that you enjoy it so all right let's go",
    "start": "88640",
    "end": "97680"
  },
  {
    "text": "office exploits uh so the good thing when you work at microsoft at the msrc",
    "start": "98240",
    "end": "103680"
  },
  {
    "text": "is that you see loads of exploits by loads i don't mean that we are going to see exploits on a weekly",
    "start": "103680",
    "end": "110000"
  },
  {
    "text": "basis but you know often quite some those are quite frequent um so office",
    "start": "110000",
    "end": "117200"
  },
  {
    "text": "exploits uh we haven't seen any i don't think so in the recent years but we saw some about two",
    "start": "117200",
    "end": "124560"
  },
  {
    "text": "to three years ago so i'm thinking especially of those affecting the comm monitors in this case",
    "start": "124560",
    "end": "132640"
  },
  {
    "text": "we cannot really talk about an office exploits an office exploit as those exploits were actually targeting windows",
    "start": "132640",
    "end": "139920"
  },
  {
    "text": "components i did myself an exploit on there's a on one of this command here the object",
    "start": "139920",
    "end": "145680"
  },
  {
    "text": "moniker so if you're curious uh go check out my outlook presentation that i did",
    "start": "145680",
    "end": "151440"
  },
  {
    "text": "at blackhat last year yeah if you are curious uh exploit targeting",
    "start": "151440",
    "end": "158959"
  },
  {
    "text": "office core functionalities those are quite rare and um thinking about it uh the only",
    "start": "158959",
    "end": "164720"
  },
  {
    "text": "ones that i can remember dates from like uh five years ago those were targeting",
    "start": "164720",
    "end": "170000"
  },
  {
    "text": "the office eps fund parser the exploits at that moment were quite",
    "start": "170000",
    "end": "175599"
  },
  {
    "text": "interesting and i'm wondering why we didn't see that much price about it",
    "start": "175599",
    "end": "180640"
  },
  {
    "text": "so if you're curious yeah go check them out those are quite interesting as well and when i",
    "start": "180640",
    "end": "185840"
  },
  {
    "text": "wrote those slides i initially forgot about the stack overflow in the equation editor",
    "start": "185840",
    "end": "191519"
  },
  {
    "text": "and why did i forget that it's probably because the exploit was too simple it was just a",
    "start": "191519",
    "end": "197760"
  },
  {
    "text": "simple stack smash in a component where absolutely no mitigations existed no nothing no such thing like",
    "start": "197760",
    "end": "204720"
  },
  {
    "text": "asr or things like that so the expert was just trivial but apart from that i don't",
    "start": "204720",
    "end": "209760"
  },
  {
    "text": "think that we've seen anything in at least in the recent years what about office online so uh when i",
    "start": "209760",
    "end": "217760"
  },
  {
    "text": "initially did that research i had never seen an exploit for office online so we've seen bugs i'm thinking for",
    "start": "217760",
    "end": "223680"
  },
  {
    "text": "example about something that guru from google reported to us a couple of years ago",
    "start": "223680",
    "end": "229599"
  },
  {
    "text": "so the history of the sec of this vrp is that he found an issue in gdi and he",
    "start": "229599",
    "end": "236159"
  },
  {
    "text": "managed to trigger it through a world document so the vulnerability here was a an",
    "start": "236159",
    "end": "243439"
  },
  {
    "text": "uninitialized memory issue and so we commonly agreed with geru that we wouldn't service this",
    "start": "243439",
    "end": "250959"
  },
  {
    "text": "issue as this wasn't this wasn't posing a significant a significant threat to",
    "start": "250959",
    "end": "258079"
  },
  {
    "text": "two world customers and then he came back a couple of weeks later saying that this",
    "start": "258079",
    "end": "264720"
  },
  {
    "text": "issue actually affected office online and at that moment this is a scenario that we just hadn't thought about",
    "start": "264720",
    "end": "271199"
  },
  {
    "text": "and so his proof of concept was just the same file copied three times and when you",
    "start": "271199",
    "end": "278560"
  },
  {
    "text": "looked at this copy on office online you could see that a different picture was rendered",
    "start": "278560",
    "end": "284080"
  },
  {
    "text": "each time so here we cannot really speak about an office online exploit as uh he i",
    "start": "284080",
    "end": "290880"
  },
  {
    "text": "don't believe that drew was able to exploit that but he was still able to demonstrate it",
    "start": "290880",
    "end": "297120"
  },
  {
    "text": "so what about the office online server so it's basically just an ios server",
    "start": "297120",
    "end": "303759"
  },
  {
    "start": "299000",
    "end": "454000"
  },
  {
    "text": "running on a fresh build on of windows 10 where lots of services interact",
    "start": "303759",
    "end": "311199"
  },
  {
    "text": "between each other so now when i did those slides i dusted off a vm that i used as a testing",
    "start": "311199",
    "end": "318240"
  },
  {
    "text": "environment back in the days and it's it's amazing to see that in this vm there are almost",
    "start": "318240",
    "end": "324880"
  },
  {
    "text": "more than 500 services running at the same time so of course this is a testing",
    "start": "324880",
    "end": "330160"
  },
  {
    "text": "environment so it doesn't really compare to what you would see in production but that still gives an idea of what's",
    "start": "330160",
    "end": "336800"
  },
  {
    "text": "going on there so there are dozens of scenarios of usage for office online",
    "start": "336800",
    "end": "344320"
  },
  {
    "text": "the most common ones are for example when you received an email from outlook on the",
    "start": "344320",
    "end": "351360"
  },
  {
    "text": "web and this email contains some attachments some of these documents so in this case",
    "start": "351360",
    "end": "356800"
  },
  {
    "text": "you can just look see those attachments in your browser and then office online will render them",
    "start": "356800",
    "end": "363919"
  },
  {
    "text": "for you another use case scenario is just when you want to edit",
    "start": "363919",
    "end": "369280"
  },
  {
    "text": "some documents on the cloud and then in this case you will be directly interacting",
    "start": "369280",
    "end": "374400"
  },
  {
    "text": "with the office online server um so one thing that i'd like to um to",
    "start": "374400",
    "end": "380400"
  },
  {
    "text": "precise here is that there are two different servers so there is the server that we call office",
    "start": "380400",
    "end": "386720"
  },
  {
    "text": "online uh this is the thing that you can find on the cloud so the public doesn't have access to it",
    "start": "386720",
    "end": "393520"
  },
  {
    "text": "and there is another version that we'll call office on-prem and this one you can actually download",
    "start": "393520",
    "end": "400240"
  },
  {
    "text": "some some bills uh if i'm if i remember correctly from november 2018",
    "start": "400240",
    "end": "406400"
  },
  {
    "text": "with just a simple visual studio subscription if you want more recent builds uh you",
    "start": "406400",
    "end": "412000"
  },
  {
    "text": "need something like a volume license agreement so it's a bit more complicated to get but",
    "start": "412000",
    "end": "417199"
  },
  {
    "text": "if you if you're curious if you want to test things you can still get a copy so let's come back to",
    "start": "417199",
    "end": "424560"
  },
  {
    "text": "this project so in 2018 so we are seeing all these exploits affecting desktop office and the",
    "start": "424560",
    "end": "431520"
  },
  {
    "text": "question there is all right so we know that the desktop office is vulnerable there are some mitigations but yeah there are those",
    "start": "431520",
    "end": "437680"
  },
  {
    "text": "exploits but what about the online server is it just possible to get",
    "start": "437680",
    "end": "442800"
  },
  {
    "text": "an exploit there so this is the first question just make like some kind of feasibility study see if",
    "start": "442800",
    "end": "449039"
  },
  {
    "text": "one couldn't achieve remote code execution on on this on the server and then the next",
    "start": "449039",
    "end": "456240"
  },
  {
    "start": "454000",
    "end": "495000"
  },
  {
    "text": "question would be how how would one do that how much time would that take would we",
    "start": "456240",
    "end": "462000"
  },
  {
    "text": "need like some things like i don't know symbols for example like insider knowledge insider information",
    "start": "462000",
    "end": "468879"
  },
  {
    "text": "um that's an interesting question um and then uh in vienna if we ever manage",
    "start": "468879",
    "end": "475280"
  },
  {
    "text": "to to to exploit a vulnerability what can be done better so that office",
    "start": "475280",
    "end": "481440"
  },
  {
    "text": "online isn't uh such to make office online a harder target",
    "start": "481440",
    "end": "488160"
  },
  {
    "text": "for exploiter so you see several questions that needed some answers so i chose to go after",
    "start": "488160",
    "end": "496160"
  },
  {
    "start": "495000",
    "end": "630000"
  },
  {
    "text": "excel online i could have gone after a powerpoint or a world i chose excel so there are several",
    "start": "496160",
    "end": "503440"
  },
  {
    "text": "reasons for this um so before before i joined microsoft i was working",
    "start": "503440",
    "end": "509120"
  },
  {
    "text": "for a company named viewpen security and at that moment i i've done",
    "start": "509120",
    "end": "514479"
  },
  {
    "text": "some a bit of research on excel i found a couple of bugs i did a couple of exploits but well that's quite",
    "start": "514479",
    "end": "520159"
  },
  {
    "text": "some time ago and so i was already a bit familiar with the internals how",
    "start": "520159",
    "end": "525279"
  },
  {
    "text": "things worked there i just i just had a couple of ideas for complex exploits",
    "start": "525279",
    "end": "533040"
  },
  {
    "text": "that i've never really put in practice and so i was a bit curious to see if i",
    "start": "533040",
    "end": "539040"
  },
  {
    "text": "could get something get something done and then of course i was curious to",
    "start": "539040",
    "end": "544240"
  },
  {
    "text": "use the microsoft resources to look at excel because at that moment this is something that i",
    "start": "544240",
    "end": "549440"
  },
  {
    "text": "had never done before so what is excel online so as i said",
    "start": "549440",
    "end": "555920"
  },
  {
    "text": "office online is a an is server and excel online is just a service",
    "start": "555920",
    "end": "562800"
  },
  {
    "text": "running in that ios so it's basically a huge dll excel server that contains most of",
    "start": "562800",
    "end": "570399"
  },
  {
    "text": "excel desktop core functionalities so if you find a bug affecting desktop",
    "start": "570399",
    "end": "577440"
  },
  {
    "text": "excel chances are that it will also affect the online server",
    "start": "577440",
    "end": "583439"
  },
  {
    "text": "so now we are in 2018 and the question is how do we find a bug",
    "start": "583519",
    "end": "589170"
  },
  {
    "text": "[Music] in in excel online so you know excel has been first like former over 20 years and by",
    "start": "589170",
    "end": "597120"
  },
  {
    "text": "finders externals also by the product team does it would it make sense for me to",
    "start": "597120",
    "end": "604320"
  },
  {
    "text": "start running a fuzzer maybe on the cloud i don't know uh we need to to think a bit about that and",
    "start": "604320",
    "end": "610959"
  },
  {
    "text": "also uh what am i after what kind of bugs am i looking for because uh excel online",
    "start": "610959",
    "end": "618480"
  },
  {
    "text": "there are some mitigations like depth islr things like that i need to i need to get a small an",
    "start": "618480",
    "end": "624320"
  },
  {
    "text": "interesting bug at least interesting enough so i so that i can bypass some mitigations also i'd like to come",
    "start": "624320",
    "end": "631760"
  },
  {
    "start": "630000",
    "end": "750000"
  },
  {
    "text": "back to one thing why uh aren't we seeing uh more exploits targeting uh office",
    "start": "631760",
    "end": "638160"
  },
  {
    "text": "core features especially because of mitigations occasionally uh we can have exploits that we call",
    "start": "638160",
    "end": "645360"
  },
  {
    "text": "like one shot exploits that uh just a file that would trigger such a complicated exploits that every",
    "start": "645360",
    "end": "652480"
  },
  {
    "text": "single mitigation would be bypassed at once that occasionally happens so here",
    "start": "652480",
    "end": "657600"
  },
  {
    "text": "the example that i'm giving here is from chris evans uh it's quite quite an interesting exploit",
    "start": "657600",
    "end": "663519"
  },
  {
    "text": "he's targeting here in an image format and i think that he he found",
    "start": "663519",
    "end": "668800"
  },
  {
    "text": "a cool hip corruption and he was able to uh to exploit the hip corruption in",
    "start": "668800",
    "end": "674959"
  },
  {
    "text": "such a way that with just one file he managed to get a remote code execution even without depth",
    "start": "674959",
    "end": "682720"
  },
  {
    "text": "even with depth and isr enabled those are very occasional exploits we",
    "start": "682720",
    "end": "688560"
  },
  {
    "text": "don't see them uh every day what we see most commonly are exploits with uh for example javascript",
    "start": "688560",
    "end": "696320"
  },
  {
    "text": "engines uh so typically exploit for web browser exploits where you can dynamically",
    "start": "696320",
    "end": "702800"
  },
  {
    "text": "interact with your vulnerability like typically with javascript or when you have a bug affecting the",
    "start": "702800",
    "end": "709680"
  },
  {
    "text": "kernel then you have certain apis to uh to play with that bug so these are the most common things that",
    "start": "709680",
    "end": "717040"
  },
  {
    "text": "we see but for excel there's no such thing there's nothing like a javascript engine",
    "start": "717040",
    "end": "722079"
  },
  {
    "text": "actually there is one but you don't have access to it no in excel there is something cool",
    "start": "722079",
    "end": "729360"
  },
  {
    "text": "there are the formulas and when you think a bit about that excel unders i think a bit more than 200",
    "start": "729360",
    "end": "736320"
  },
  {
    "text": "formulas i don't remember the exact figure but it's something uh something around that and when you think about all those",
    "start": "736320",
    "end": "742560"
  },
  {
    "text": "formulas then yes it's certainly it's certainly possible to get something",
    "start": "742560",
    "end": "747680"
  },
  {
    "text": "good done with this so think for example about all those uh",
    "start": "747680",
    "end": "753680"
  },
  {
    "text": "all this stream string package you've got everything there if you want to manipulate pointers",
    "start": "753680",
    "end": "759760"
  },
  {
    "start": "755000",
    "end": "835000"
  },
  {
    "text": "strings then yes you've got all the functions you need everything that you can find that you would be able to find in javascript",
    "start": "759760",
    "end": "766399"
  },
  {
    "text": "you can find it uh in just formulas excel formulas so there are still a couple of things that are",
    "start": "766399",
    "end": "772800"
  },
  {
    "text": "more difficult like i'm thinking for example of the fact that you cannot set a variable with with the formulas",
    "start": "772800",
    "end": "780959"
  },
  {
    "text": "so say that you are in cell a3 and you would type equal three plus five",
    "start": "780959",
    "end": "788079"
  },
  {
    "text": "then uh cell a3 will be set to eight but within that formula you cannot set the content of another",
    "start": "788079",
    "end": "795040"
  },
  {
    "text": "cell so this is one of um of the limitations of of this scenario but",
    "start": "795040",
    "end": "801680"
  },
  {
    "text": "there are still uh several other cool things like typically i'm thinking of the lookup formulas with that you can use to",
    "start": "801680",
    "end": "808320"
  },
  {
    "text": "emulate uh for loops so here the reasoning is a such if we can find a bug a",
    "start": "808320",
    "end": "815440"
  },
  {
    "text": "vulnerability in one of those formulas then it might be possible to exploit that issue",
    "start": "815440",
    "end": "823839"
  },
  {
    "text": "with other formulas and this is the idea that i had at the moment and but this is something that i've",
    "start": "823839",
    "end": "829839"
  },
  {
    "text": "never managed to uh to exploit myself so this is where i'm starting",
    "start": "829839",
    "end": "836399"
  },
  {
    "start": "835000",
    "end": "1062000"
  },
  {
    "text": "so now how do we find uh an interesting bug for excel online so here i'm going to",
    "start": "836399",
    "end": "842399"
  },
  {
    "text": "use my experience uh so i'm coming back a long time ago basically when i started",
    "start": "842399",
    "end": "848480"
  },
  {
    "text": "i started uh in 2008 for at viewpen so at that moment it wasn't",
    "start": "848480",
    "end": "854959"
  },
  {
    "text": "named viewpen already but that was coming and so i started in september 2008 and",
    "start": "854959",
    "end": "860800"
  },
  {
    "text": "in october 2008 the next month i remember there was a patch for excel",
    "start": "860800",
    "end": "866959"
  },
  {
    "text": "and one of the vulnerabilities that had been fixed at that moment came had been reported by the zdi",
    "start": "866959",
    "end": "873680"
  },
  {
    "text": "so this was basically the first time that i was dealing with an integer overflow so i remember",
    "start": "873680",
    "end": "878880"
  },
  {
    "text": "going to that advisory and reading it probably 50 times to try to figure out",
    "start": "878880",
    "end": "885920"
  },
  {
    "text": "some clues uh as we were just clueless we had no idea what was going on we knew there was something that was",
    "start": "885920",
    "end": "891839"
  },
  {
    "text": "affecting the red formula but apart from that pretty much nothing else so i do",
    "start": "891839",
    "end": "897600"
  },
  {
    "text": "remember also diffing that thing and i'm pretty sure that i spent more than two days trying to figure out what was the issue",
    "start": "897600",
    "end": "904399"
  },
  {
    "text": "i do remember seeing a multiplication that had been changed in the fix but at that moment you know i",
    "start": "904399",
    "end": "910800"
  },
  {
    "text": "was a noob i was totally literally a beginner and to me it didn't make sense that just a simple multiplication could",
    "start": "910800",
    "end": "918560"
  },
  {
    "text": "lead to a vulnerability turns out the vulnerability was quite simple rep repeats the repeat formula takes two",
    "start": "918560",
    "end": "925440"
  },
  {
    "text": "arguments and a string and a counter and if you multiply if you multiply is countered by the",
    "start": "925440",
    "end": "932160"
  },
  {
    "text": "length of the string it's possible to get that multiplication to overflow on 30 to it and then you'd",
    "start": "932160",
    "end": "939839"
  },
  {
    "text": "you then allocate an undersized buffer leading that to ever a stack overflow or a hyper flow so",
    "start": "939839",
    "end": "946160"
  },
  {
    "text": "at the end i found it and i was quite happy when i found it but then the question that i asked myself in",
    "start": "946160",
    "end": "952240"
  },
  {
    "text": "2018 is how that bug had been fixed because i did remember that bug",
    "start": "952240",
    "end": "957759"
  },
  {
    "text": "i was i was very curious of it so i looked at the code and uh and then yeah uh the buggy was",
    "start": "957759",
    "end": "964000"
  },
  {
    "text": "correctly fixed yeah 10 years after no way this was still going to be a",
    "start": "964000",
    "end": "969680"
  },
  {
    "text": "vulnerability so they at the moment at the time the developers fixed that by",
    "start": "969680",
    "end": "974880"
  },
  {
    "text": "introducing a function called cbr locksafe and this function just make sure that",
    "start": "974880",
    "end": "980079"
  },
  {
    "text": "the math uh is correct and doesn't overflow so let's have a deeper look at that function just a",
    "start": "980079",
    "end": "986720"
  },
  {
    "text": "checks on just some checks on the additions and multiplications using a saving type",
    "start": "986720",
    "end": "993680"
  },
  {
    "text": "so yeah nothing to nothing interesting anymore for us there however as we are looking for",
    "start": "993680",
    "end": "1001839"
  },
  {
    "text": "entry points in the code uh potentially very number on three points",
    "start": "1001839",
    "end": "1007199"
  },
  {
    "text": "one it's what i i felt at that moment was maybe i could",
    "start": "1007199",
    "end": "1012959"
  },
  {
    "text": "just look for other references to this function and see who calls that because uh well again i",
    "start": "1012959",
    "end": "1019440"
  },
  {
    "text": "don't have much experience at that moment with formulas i'm not sure of what what is going on there",
    "start": "1019440",
    "end": "1026480"
  },
  {
    "text": "so so i told you i work for microsoft and i have access to the source code but",
    "start": "1026480",
    "end": "1032720"
  },
  {
    "text": "i still use ida pretty much every day and so i did look for reference for also just",
    "start": "1032720",
    "end": "1038640"
  },
  {
    "text": "doing a simple x-ray on the cb lock safe in ida and this gives about 100",
    "start": "1038640",
    "end": "1045120"
  },
  {
    "text": "different results and in these results three of them points to a function",
    "start": "1045120",
    "end": "1051840"
  },
  {
    "text": "called fn concatenate so you don't have the symbols but i can tell you that the name of the function is fn concatenate",
    "start": "1051840",
    "end": "1058000"
  },
  {
    "text": "let's look at them and more particularly let's look at the last one",
    "start": "1058000",
    "end": "1063200"
  },
  {
    "start": "1062000",
    "end": "1135000"
  },
  {
    "text": "and when you look at the code in ida you see a bunch of multiplications and additions",
    "start": "1063200",
    "end": "1069919"
  },
  {
    "text": "this is done right before a call to cbrx which is supposed to check additions and multiplications and so",
    "start": "1069919",
    "end": "1077039"
  },
  {
    "text": "when you look at that as a bug enter you think like okay there",
    "start": "1077039",
    "end": "1082400"
  },
  {
    "text": "there is something here it's not possible this is this is too weird so the next thing you do uh obviously is",
    "start": "1082400",
    "end": "1088799"
  },
  {
    "text": "uh trying to figure out who calls this function and then you uh just by doing a simple express",
    "start": "1088799",
    "end": "1094720"
  },
  {
    "text": "you find a mention of a string named text join so at that moment i'm like you i have no",
    "start": "1094720",
    "end": "1100160"
  },
  {
    "text": "idea what this is so let's uh let's look on the internet and a quick search",
    "start": "1100160",
    "end": "1105440"
  },
  {
    "text": "gave me this documentation from microsoft saying that text join is just another formula",
    "start": "1105440",
    "end": "1110720"
  },
  {
    "text": "using um concatenating cells and strings so pay attention to the",
    "start": "1110720",
    "end": "1117120"
  },
  {
    "text": "first argument here the diameter so this can have a several form and here we are interesting in the",
    "start": "1117120",
    "end": "1125120"
  },
  {
    "text": "the reference form and this is well thing this is where things get cool so",
    "start": "1125120",
    "end": "1131280"
  },
  {
    "text": "when you look again at that assembly you think that uh well excellent has been first again for over",
    "start": "1131280",
    "end": "1137200"
  },
  {
    "start": "1135000",
    "end": "1190000"
  },
  {
    "text": "20 years uh something like that it's too big um definitely missing something and again yeah there is something that",
    "start": "1137200",
    "end": "1143440"
  },
  {
    "text": "uh that i don't see this these are my my first faults literally and then just",
    "start": "1143440",
    "end": "1148960"
  },
  {
    "text": "looking at the code you can see the history and it turns out that in 2015 some new code had been",
    "start": "1148960",
    "end": "1156000"
  },
  {
    "text": "added to that uh to that formula and at that moment uh the developer decided to support 3d",
    "start": "1156000",
    "end": "1162960"
  },
  {
    "text": "references so references on three dimensions column row and spreadsheet",
    "start": "1162960",
    "end": "1170640"
  },
  {
    "text": "and now once you have everything in mind it's pretty much it's very easy to get a",
    "start": "1170640",
    "end": "1176640"
  },
  {
    "text": "simple puck and the formula that you can see on the screen right now will trigger uh",
    "start": "1176640",
    "end": "1181840"
  },
  {
    "text": "i believe an access violation a write access variation in a vulnerable version of excel that's cool we now have our bug",
    "start": "1181840",
    "end": "1190400"
  },
  {
    "start": "1190000",
    "end": "1265000"
  },
  {
    "text": "let's see if we can exploit it so most of the time the problem with those issues is that you are going to",
    "start": "1190400",
    "end": "1196880"
  },
  {
    "text": "hit the end of the page quite quite quickly and you won't be able to exploit it because usually you trigger your",
    "start": "1196880",
    "end": "1203360"
  },
  {
    "text": "intelligent overflow and then you allocate some space on the hip and then there are several loops so in",
    "start": "1203360",
    "end": "1209280"
  },
  {
    "text": "this case there are like three different loops which will be trying to write data on the hip so",
    "start": "1209280",
    "end": "1215919"
  },
  {
    "text": "we need we need to we need to get out of these loops we need to find something",
    "start": "1215919",
    "end": "1221200"
  },
  {
    "text": "uh where we can we can safely exit and control the corruption and it turns out that",
    "start": "1221200",
    "end": "1226799"
  },
  {
    "text": "it's actually possible in this scenario there is something uh very something",
    "start": "1226799",
    "end": "1232640"
  },
  {
    "text": "that where we can abort here so if one of the cells that we are trying",
    "start": "1232640",
    "end": "1239600"
  },
  {
    "text": "to concatenate contains an error excel will see that error and will just",
    "start": "1239600",
    "end": "1245600"
  },
  {
    "text": "raise an exception in this in this function and so in vn we will just exit the loop without",
    "start": "1245600",
    "end": "1252400"
  },
  {
    "text": "hitting that that end of page so this is a good thing that means that we have a controllable",
    "start": "1252400",
    "end": "1260080"
  },
  {
    "text": "hip overflow and this is quite good one thing that i didn't mention is that we are writing",
    "start": "1260080",
    "end": "1265919"
  },
  {
    "start": "1265000",
    "end": "1323000"
  },
  {
    "text": "pointers to strings not just bytes so let's look a bit more",
    "start": "1265919",
    "end": "1271280"
  },
  {
    "text": "at this issue so there are a few constraints of course constraints from",
    "start": "1271280",
    "end": "1276640"
  },
  {
    "text": "excel for example the number of rows or the number of currents but they're also something else as we",
    "start": "1276640",
    "end": "1282960"
  },
  {
    "text": "are forced to trigger an issue an error an exception",
    "start": "1282960",
    "end": "1288480"
  },
  {
    "text": "excel at the end of that function will just free everything which means that those",
    "start": "1288480",
    "end": "1293760"
  },
  {
    "text": "pointers that you've just written those pointers that you are using to overflow the hip",
    "start": "1293760",
    "end": "1299200"
  },
  {
    "text": "those will no point to freed memory and when you think of it about that you initially have an integer overflow",
    "start": "1299200",
    "end": "1306320"
  },
  {
    "text": "that leads to a hyper flow that no leads to sever use after three",
    "start": "1306320",
    "end": "1311360"
  },
  {
    "text": "so at first side the primitive looked good but looking better well it's",
    "start": "1311360",
    "end": "1317600"
  },
  {
    "text": "not the best bug ever but it's certainly possible to get something",
    "start": "1317600",
    "end": "1322880"
  },
  {
    "text": "and then comes the exploitation so probably the first thing that you'll try",
    "start": "1322880",
    "end": "1327919"
  },
  {
    "start": "1323000",
    "end": "1352000"
  },
  {
    "text": "to do is get a lick a memory leak because you need to bypass isr so here the memory is quite",
    "start": "1327919",
    "end": "1335840"
  },
  {
    "text": "it's quite easy to get to get an exploit done it's because excel store string in",
    "start": "1335840",
    "end": "1341200"
  },
  {
    "text": "memory with a counter on two bytes followed by the string itself which means that if you override that",
    "start": "1341200",
    "end": "1348080"
  },
  {
    "text": "counter then you will be able to read past the bounds of the string so once you've",
    "start": "1348080",
    "end": "1353679"
  },
  {
    "start": "1352000",
    "end": "1375000"
  },
  {
    "text": "got that in mind you can think about a scenario where you would override that counter",
    "start": "1353679",
    "end": "1359039"
  },
  {
    "text": "to uh to that string length with a pointer and then you would be able to read past",
    "start": "1359039",
    "end": "1365200"
  },
  {
    "text": "the bounds of that of that string potentially reading things like",
    "start": "1365200",
    "end": "1370480"
  },
  {
    "text": "v tables pointer something like that so at that moment the scenario is quite simple",
    "start": "1370480",
    "end": "1375520"
  },
  {
    "start": "1375000",
    "end": "1400000"
  },
  {
    "text": "just spray the hip make some hole make some holes trigger the variability and then yeah",
    "start": "1375520",
    "end": "1381120"
  },
  {
    "text": "let's cross fingers let's hope that there is something cool to leak but you know i'm not very scared",
    "start": "1381120",
    "end": "1386720"
  },
  {
    "text": "of this so it's probably going to work and if you've ever done something like",
    "start": "1386720",
    "end": "1392320"
  },
  {
    "text": "that before if you are an expert writer you know that things will never go according to the plan",
    "start": "1392320",
    "end": "1398000"
  },
  {
    "text": "there is always something that you haven't thought of and in my case it was the undo or ctrl z and this is quite cool",
    "start": "1398000",
    "end": "1405679"
  },
  {
    "start": "1400000",
    "end": "1442000"
  },
  {
    "text": "actually when you think about that when you type something in a cell you can always revert your change and",
    "start": "1405679",
    "end": "1411200"
  },
  {
    "text": "then excel will just keep everything in memory which means for us that those strengths",
    "start": "1411200",
    "end": "1417280"
  },
  {
    "text": "they won't be freed like this no and uh i totally forgot about that i didn't",
    "start": "1417280",
    "end": "1422720"
  },
  {
    "text": "even consider this at the beginning so it took me a couple of at least hours",
    "start": "1422720",
    "end": "1430480"
  },
  {
    "text": "good hours probably days to realize what was going on i i just couldn't free my strings",
    "start": "1430480",
    "end": "1436559"
  },
  {
    "text": "so once you've got that in mind uh there are several scenarios where you can uh work work around so the first",
    "start": "1436559",
    "end": "1444880"
  },
  {
    "start": "1442000",
    "end": "1505000"
  },
  {
    "text": "scenario would be to exhaust that undo stack just enter so many actions that in the",
    "start": "1444880",
    "end": "1451039"
  },
  {
    "text": "end excel would be forced to free the strings the problem with this scenario is that it would force you to make so many",
    "start": "1451039",
    "end": "1457520"
  },
  {
    "text": "allocations and then the hip would be you know a bit uh unstable uh your expert wouldn't be a reliable",
    "start": "1457520",
    "end": "1465919"
  },
  {
    "text": "so in the end i didn't opt for this scenario i went for another scenario so things",
    "start": "1465919",
    "end": "1471440"
  },
  {
    "text": "have changed since 2018 but at that moment there was a button",
    "start": "1471440",
    "end": "1476880"
  },
  {
    "text": "named calculate workbook and using that button you could actually commit your changes",
    "start": "1476880",
    "end": "1482000"
  },
  {
    "text": "which means that excel would just free all those strengths everything that you",
    "start": "1482000",
    "end": "1487120"
  },
  {
    "text": "wanted to be free and it wouldn't be possible for you to revert those changes",
    "start": "1487120",
    "end": "1492400"
  },
  {
    "text": "and so this is what i did so now i've got my lick i know that",
    "start": "1492400",
    "end": "1497440"
  },
  {
    "text": "overwriting a string length with a pointer is enough for me to read past the bounds and this is what",
    "start": "1497440",
    "end": "1502960"
  },
  {
    "text": "it looks like when you do something like that with excel online your literary you literally",
    "start": "1502960",
    "end": "1509120"
  },
  {
    "start": "1505000",
    "end": "1530000"
  },
  {
    "text": "get some chinese results in your cells and now coming back to the string",
    "start": "1509120",
    "end": "1515039"
  },
  {
    "text": "package this is where you can use it you use the string functions to just play",
    "start": "1515039",
    "end": "1520400"
  },
  {
    "text": "on this uh there's these chinese characters which are individual pointers",
    "start": "1520400",
    "end": "1525600"
  },
  {
    "text": "so this is cool no what do what are we leaking i believe that the first thing i did",
    "start": "1525600",
    "end": "1531760"
  },
  {
    "start": "1530000",
    "end": "1567000"
  },
  {
    "text": "once my leak was working was to check every single formula see if there wasn't one that could",
    "start": "1531760",
    "end": "1538720"
  },
  {
    "text": "potentially allocate some c plus plus objects with the tables yeah that would make sense",
    "start": "1538720",
    "end": "1544320"
  },
  {
    "text": "i went over them all i didn't find anything uh that doesn't mean that it's not possible there are some really",
    "start": "1544320",
    "end": "1550080"
  },
  {
    "text": "complicated formulas like typically i'm thinking of the pivot tables",
    "start": "1550080",
    "end": "1556080"
  },
  {
    "text": "formulas those are quite complex and i wouldn't be surprised if in the end it was possible to get",
    "start": "1556080",
    "end": "1562000"
  },
  {
    "text": "something allocated with them no i went for a different scenario i want to play with",
    "start": "1562000",
    "end": "1568559"
  },
  {
    "start": "1567000",
    "end": "1588000"
  },
  {
    "text": "charts and graphs so again there are dozens of charts and each of them leads to",
    "start": "1568559",
    "end": "1574559"
  },
  {
    "text": "allocate a different object in in memory and those objects are c plus plus object",
    "start": "1574559",
    "end": "1580320"
  },
  {
    "text": "with the tables and pointers to other objects in my case i found a graph with a",
    "start": "1580320",
    "end": "1587360"
  },
  {
    "text": "pointer to a title object and that title object was had a pointer in the structure to a string object and",
    "start": "1587360",
    "end": "1593440"
  },
  {
    "start": "1588000",
    "end": "1639000"
  },
  {
    "text": "that was cool because as i was overwriting the hip with pointers to string i could potentially overwrite that",
    "start": "1593440",
    "end": "1600159"
  },
  {
    "text": "object up to overwriting a pointer to tighter objects and then overwrite that final pointers",
    "start": "1600159",
    "end": "1608159"
  },
  {
    "text": "with some some control characters my intention at that moment was to get a",
    "start": "1608159",
    "end": "1615840"
  },
  {
    "text": "read primitive so that i would be able to read data from excel server basically disclose",
    "start": "1615840",
    "end": "1622799"
  },
  {
    "text": "the entire binary it turns out that this scenario didn't work for various reasons i could get it to",
    "start": "1622799",
    "end": "1629360"
  },
  {
    "text": "work sometimes but it was unreliable enough so in the end i failed to get a redry primitive i just",
    "start": "1629360",
    "end": "1636799"
  },
  {
    "text": "opted for more simple scenarios i was assuming that",
    "start": "1636799",
    "end": "1642000"
  },
  {
    "start": "1639000",
    "end": "1680000"
  },
  {
    "text": "i knew already excel serve which is the case when you are attacking excel on-prem for example you've got",
    "start": "1642000",
    "end": "1647760"
  },
  {
    "text": "access to the build so you can work around you can have an idea of where your gadgets are",
    "start": "1647760",
    "end": "1654080"
  },
  {
    "text": "and in the end you just replay a static wrap that works and so in my case",
    "start": "1654080",
    "end": "1661120"
  },
  {
    "text": "i just managed to trigger a vitable call on one of those graphs to get",
    "start": "1661120",
    "end": "1668080"
  },
  {
    "text": "code execution and the exploit there was quite cool because i just needed to resize the",
    "start": "1668080",
    "end": "1673200"
  },
  {
    "text": "one of the graph to get code execution so you know what i'm going to show it to you",
    "start": "1673200",
    "end": "1679200"
  },
  {
    "text": "so i've got a demo here hopefully it will work the reasons um so i'm going to comment",
    "start": "1679200",
    "end": "1685679"
  },
  {
    "start": "1680000",
    "end": "1813000"
  },
  {
    "text": "it quickly so this is the online office online server that you're seeing and this is the xlr online process",
    "start": "1685679",
    "end": "1692640"
  },
  {
    "text": "so the best way to interact with it is just create a blank email and add an excel file to it",
    "start": "1692640",
    "end": "1699600"
  },
  {
    "text": "and then preview it so that it will be sent to excel online then we go to edit mode which will",
    "start": "1699600",
    "end": "1707600"
  },
  {
    "text": "enable us to interact with the server and so here we go so now first thing i'm doing",
    "start": "1707600",
    "end": "1713200"
  },
  {
    "text": "is spray the hip and make a couple of holes so that later i can fill those holes and trigger",
    "start": "1713200",
    "end": "1722080"
  },
  {
    "text": "the vulnerability to a variety counter of a string and this is what's",
    "start": "1722080",
    "end": "1728240"
  },
  {
    "text": "happening here so we got successful we got uh the expert as the variability succeeded because",
    "start": "1728240",
    "end": "1734559"
  },
  {
    "text": "we've got that string showing um weird characters",
    "start": "1734559",
    "end": "1740799"
  },
  {
    "text": "and here we go here this is what i call my hip visualizer today i'm basically looking at the hip",
    "start": "1740799",
    "end": "1748240"
  },
  {
    "text": "using excel cells so let's come back to the first spreadsheet now let's make more holes and let's",
    "start": "1748240",
    "end": "1756480"
  },
  {
    "text": "insert some graphs so this is to be able to lick something this is to be able to leak a v table so",
    "start": "1756480",
    "end": "1763120"
  },
  {
    "text": "if i remember correctly yes there are two graphs here that are put there just to be sure",
    "start": "1763120",
    "end": "1768240"
  },
  {
    "text": "that it's going to work let's come back to my heap visualizer did that work yes it worked because right now you can",
    "start": "1768240",
    "end": "1775520"
  },
  {
    "text": "see those v tables you can see those pointers so we just need to trigger the variability one last time so",
    "start": "1775520",
    "end": "1782799"
  },
  {
    "text": "third time to be to overwrite one of these tables and hopefully train our good execution",
    "start": "1782799",
    "end": "1791039"
  },
  {
    "text": "and if things worked at that moment we just need to resize one of that graph",
    "start": "1791039",
    "end": "1796640"
  },
  {
    "text": "one of those graphs to trigger our payload let's see if we were lucky",
    "start": "1796640",
    "end": "1803440"
  },
  {
    "text": "turns out that yeah we were lucky magic of the recorded demo",
    "start": "1803440",
    "end": "1810399"
  },
  {
    "text": "so let's discuss a bit uh this exploit is it the kind of thing that uh we could potentially expect to see uh on",
    "start": "1811600",
    "end": "1818960"
  },
  {
    "start": "1813000",
    "end": "1857000"
  },
  {
    "text": "the cloud i'm a bit skeptical on this especially when i'm thinking of",
    "start": "1818960",
    "end": "1824080"
  },
  {
    "text": "all those memory manipulations you need to sculpt the hip you need to",
    "start": "1824080",
    "end": "1829919"
  },
  {
    "text": "be able to put some holes to trigger your vulnerability but the problem is when your attack a production",
    "start": "1829919",
    "end": "1836640"
  },
  {
    "text": "environment there will be all those users working on excel spreadsheet at the same time so",
    "start": "1836640",
    "end": "1842399"
  },
  {
    "text": "to me it sounds a bit complicated to be able to reach",
    "start": "1842399",
    "end": "1847760"
  },
  {
    "text": "a state a heap state that could potentially be useful for your exploit scenario that",
    "start": "1847760",
    "end": "1854640"
  },
  {
    "text": "doesn't mean that it's not possible definitely not and the thing is with iis",
    "start": "1854640",
    "end": "1859840"
  },
  {
    "text": "if your process crashed then if your process crashes then you it would just restart it for you and in the end you",
    "start": "1859840",
    "end": "1866799"
  },
  {
    "text": "just need one try one lucky try to get your payload executed",
    "start": "1866799",
    "end": "1874080"
  },
  {
    "text": "so i found a bug uh it wasn't definitely not the best bug i actually found two uh the",
    "start": "1874080",
    "end": "1880320"
  },
  {
    "text": "second issue was affecting the uh forecast formula and it turns out that at that moment",
    "start": "1880320",
    "end": "1885600"
  },
  {
    "text": "uh those were not available on office online so i didn't really um look at them in in the exploit scenario",
    "start": "1885600",
    "end": "1894240"
  },
  {
    "text": "but the thing is in the end you just do with what you have and so i had one bug and",
    "start": "1894240",
    "end": "1900080"
  },
  {
    "text": "managed to exploit it i'm quite convinced that by putting more effort on it it's possible to get something really",
    "start": "1900080",
    "end": "1906399"
  },
  {
    "text": "cool something where you could potentially leak and read the entire excel binary i",
    "start": "1906399",
    "end": "1912159"
  },
  {
    "text": "didn't do that because i was limited on time but that's definitely something possible and of course",
    "start": "1912159",
    "end": "1917519"
  },
  {
    "text": "so this raises more questions so it's possible to do that on excel online can we do it on desktop",
    "start": "1917519",
    "end": "1925039"
  },
  {
    "text": "excel as well can we can you get can is it possible to craft an excel file so that everything will be",
    "start": "1925039",
    "end": "1932720"
  },
  {
    "text": "done at the same time bypass a sr bypass step etc etc and then either even an exploit for",
    "start": "1932720",
    "end": "1939679"
  },
  {
    "text": "protective view i don't know possibly and then of course once you're once you have control on the",
    "start": "1939679",
    "end": "1946399"
  },
  {
    "text": "server what can you do but then this will probably be a",
    "start": "1946399",
    "end": "1951600"
  },
  {
    "text": "subject for a next presentation at black hat so i hope that you've enjoyed this presentation",
    "start": "1951600",
    "end": "1956799"
  },
  {
    "start": "1954000",
    "end": "2463000"
  },
  {
    "text": "and if you have questions i'm always there thank you all thank you for your attention hope you had a good moment",
    "start": "1956799",
    "end": "1963360"
  },
  {
    "text": "with me",
    "start": "1963360",
    "end": "1965679"
  },
  {
    "text": "thanks well thank you for listening i hope you had a good time",
    "start": "1969440",
    "end": "1977840"
  },
  {
    "text": "so taking any questions",
    "start": "1983440",
    "end": "1990080"
  },
  {
    "text": "you must have questions i'm sure",
    "start": "1990080",
    "end": "1993919"
  },
  {
    "text": "can i speculate if this same time of attack could theoretically be performed on something",
    "start": "2000880",
    "end": "2006240"
  },
  {
    "text": "like google documents uh i have literally no idea of what's",
    "start": "2006240",
    "end": "2011440"
  },
  {
    "text": "running on the google cloud so i cannot answer that uh i guess maybe yes but",
    "start": "2011440",
    "end": "2019120"
  },
  {
    "text": "i don't know",
    "start": "2019120",
    "end": "2021600"
  },
  {
    "text": "she does google guys actually they must know about that",
    "start": "2025679",
    "end": "2033840"
  },
  {
    "text": "any other question",
    "start": "2045039",
    "end": "2047840"
  },
  {
    "text": "come on don't be shy",
    "start": "2061760",
    "end": "2075839"
  },
  {
    "text": "hi evangelist",
    "start": "2081280",
    "end": "2084079"
  },
  {
    "text": "can i upload this box um no but uh well you've got enough uh",
    "start": "2086639",
    "end": "2093520"
  },
  {
    "text": "to build your own proof of concept uh if you're curious uh i believe that you can understand",
    "start": "2093520",
    "end": "2100320"
  },
  {
    "text": "that i'm not going to provide the exploit",
    "start": "2100320",
    "end": "2105440"
  },
  {
    "text": "is it likely that world will be subject to the same variability",
    "start": "2109599",
    "end": "2115520"
  },
  {
    "text": "so so um the book that i exploited was in excel",
    "start": "2115520",
    "end": "2121359"
  },
  {
    "text": "so there was a formerly in excel there is no such thing in the world",
    "start": "2121359",
    "end": "2126400"
  },
  {
    "text": "is there any vulnerability in the world that could be expected then yeah potentially i don't have any",
    "start": "2126400",
    "end": "2132720"
  },
  {
    "text": "in mind but i mean that you can potentially get the same sort of thing",
    "start": "2132720",
    "end": "2138320"
  },
  {
    "text": "in world but definitely with something else",
    "start": "2138320",
    "end": "2144240"
  },
  {
    "text": "do i know if detection capabilities with azure sentinel exist uh this is actually a good",
    "start": "2144240",
    "end": "2152000"
  },
  {
    "text": "question i am not aware of anything like that um",
    "start": "2152000",
    "end": "2160720"
  },
  {
    "text": "there would be uh detections on on the behavior of iis for example things like if it starts",
    "start": "2161359",
    "end": "2170000"
  },
  {
    "text": "a random process like cmd or this this kind of thing yeah that would that would raise um some arms but",
    "start": "2170000",
    "end": "2177280"
  },
  {
    "text": "uh detections based on uh like deeply malicious excel formulas no",
    "start": "2177280",
    "end": "2182960"
  },
  {
    "text": "i don't think that there is anything like that",
    "start": "2182960",
    "end": "2187838"
  },
  {
    "text": "any other questions",
    "start": "2204640",
    "end": "2215838"
  },
  {
    "text": "i like the question on the google documents by the way you should definitely ask those guys",
    "start": "2223599",
    "end": "2229920"
  },
  {
    "text": "the same questions",
    "start": "2229920",
    "end": "2243838"
  },
  {
    "text": "anything else come on don't be shy",
    "start": "2248000",
    "end": "2254480"
  },
  {
    "text": "i cannot see you",
    "start": "2254880",
    "end": "2257838"
  },
  {
    "text": "uh in my exploit attempt did i trigger any forensic logging from the exploit",
    "start": "2279440",
    "end": "2288720"
  },
  {
    "text": "so i was testing on my own environment so there was no such thing there i mean",
    "start": "2289040",
    "end": "2295839"
  },
  {
    "text": "there wasn't any av or anything in particular there",
    "start": "2295839",
    "end": "2301359"
  },
  {
    "text": "so i know that exploiter did not trigger anything but as i said i was building a library",
    "start": "2301359",
    "end": "2308160"
  },
  {
    "text": "from a remote chair and if you actually try to do that in your exploit you're",
    "start": "2308160",
    "end": "2313520"
  },
  {
    "text": "probably going to raise dozens of different arms if you do that",
    "start": "2313520",
    "end": "2327839"
  },
  {
    "text": "anything else",
    "start": "2334560",
    "end": "2341839"
  },
  {
    "text": "i'm taking advantage of this q a session to remind you that we've got a job",
    "start": "2350480",
    "end": "2356240"
  },
  {
    "text": "offers in our team in cheltenham in the uk so if you want to work with me then you're most welcome to uh being me",
    "start": "2356240",
    "end": "2364079"
  },
  {
    "text": "on twitter or uh just look at the job offers that we've advertised",
    "start": "2364079",
    "end": "2370640"
  },
  {
    "text": "i would love to get your city",
    "start": "2370640",
    "end": "2383838"
  },
  {
    "text": "in your questions",
    "start": "2389040",
    "end": "2397839"
  },
  {
    "text": "thank you anyway for uh it's a great feedback on this uh on this chat i can see that",
    "start": "2398400",
    "end": "2404160"
  },
  {
    "text": "you enjoyed the presentation so that's good",
    "start": "2404160",
    "end": "2411838"
  },
  {
    "text": "anything else",
    "start": "2437599",
    "end": "2440319"
  },
  {
    "text": "well if there are no other questions then i think i'm good to review them",
    "start": "2451359",
    "end": "2457760"
  },
  {
    "text": "thank you all for following me have a great day guys",
    "start": "2458560",
    "end": "2465280"
  }
]