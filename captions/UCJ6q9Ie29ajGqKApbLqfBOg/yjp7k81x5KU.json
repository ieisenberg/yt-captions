[
  {
    "start": "0",
    "end": "50000"
  },
  {
    "text": "good morning welcome to finding our path how we're trying to improve Active",
    "start": "30",
    "end": "5790"
  },
  {
    "text": "Directory security in South Seas a b e with an d Robins will Schrader and Rohan",
    "start": "5790",
    "end": "13139"
  },
  {
    "text": "Berserker before we begin a few brief notes stop by the business hall located",
    "start": "13139",
    "end": "18359"
  },
  {
    "text": "in Mandalay ocean buff side and shoreline ballrooms on level 2 the",
    "start": "18359",
    "end": "23609"
  },
  {
    "text": "blackhat Arsenal is in the business hall on level 2 lunch will be in Bayside a B",
    "start": "23609",
    "end": "29310"
  },
  {
    "text": "from 1:00 to 2:30 and don't forget the merchandise store on level 2 and the session recordings from source of",
    "start": "29310",
    "end": "35610"
  },
  {
    "text": "knowledge they I have a desk on every level before we begin please put your",
    "start": "35610",
    "end": "41579"
  },
  {
    "text": "phone on vibrate it makes it easier for the rest of us to ignore the ringing while you wait for your voicemail to pick it up alright let's give a hand",
    "start": "41579",
    "end": "48750"
  },
  {
    "text": "round of applause to our speakers hello",
    "start": "48750",
    "end": "61739"
  },
  {
    "start": "50000",
    "end": "85000"
  },
  {
    "text": "everyone dude doing awesome today we're gonna be talking about the greatest tool",
    "start": "61739",
    "end": "67380"
  },
  {
    "text": "of all time bloodhounds power review data power view actually all right so",
    "start": "67380",
    "end": "74640"
  },
  {
    "text": "our talk is called finding your path how we're trying to improve Active Directory security this is us",
    "start": "74640",
    "end": "80250"
  },
  {
    "text": "I'm Rohan I'm will I'm Andy alright introductions done alright so first of",
    "start": "80250",
    "end": "86850"
  },
  {
    "start": "85000",
    "end": "98000"
  },
  {
    "text": "all we're gonna talk about a little bit of background here we released the Bloodhound project about three years ago",
    "start": "86850",
    "end": "92579"
  },
  {
    "text": "now and we had some very significant problems to solve when we did so I do",
    "start": "92579",
    "end": "99810"
  },
  {
    "start": "98000",
    "end": "116000"
  },
  {
    "text": "want to acknowledge some prior work these are really really cool stings especially like Metcalf's blog here and",
    "start": "99810",
    "end": "106640"
  },
  {
    "text": "check all these out here is where we kind of started when we were trying to build bloodhound so we're standing on",
    "start": "106640",
    "end": "112409"
  },
  {
    "text": "the shoulder of giants here whatever been possible without that all right what is bloodhound bloodhound is the",
    "start": "112409",
    "end": "121170"
  },
  {
    "start": "116000",
    "end": "147000"
  },
  {
    "text": "tool we wrote and our goal was to apply graph theory to Active Directory we wanted to simplify privileged analysis",
    "start": "121170",
    "end": "128459"
  },
  {
    "text": "in Active Directory which if anyone has tried to use built-in tools and Windows knows that is not easy it's very very arcane",
    "start": "128459",
    "end": "135989"
  },
  {
    "text": "and not very easy to navigate so we wanted to visualize relationships in",
    "start": "135989",
    "end": "141090"
  },
  {
    "text": "Active Directory and essentially build what we call Google Maps for Active Directory so we had a bunch of problems",
    "start": "141090",
    "end": "150660"
  },
  {
    "start": "147000",
    "end": "191000"
  },
  {
    "text": "we had to solve one of them was how do you go from one place in Active Directory to another our background is",
    "start": "150660",
    "end": "156870"
  },
  {
    "text": "pentesters and red teamers and often we drop it in a network and we were given",
    "start": "156870",
    "end": "161879"
  },
  {
    "text": "an objective go get healthcare data go get da whatever happened to be and our original",
    "start": "161879",
    "end": "169349"
  },
  {
    "text": "process would take a really long time so this was kind of our solution to the problem other problem we wanted to solve",
    "start": "169349",
    "end": "175380"
  },
  {
    "text": "is how do you escalate your privileges without the scanning in the network many many many times I'm gonna demonstrate what I'm talking about in like the next",
    "start": "175380",
    "end": "182010"
  },
  {
    "text": "slide here but we hit the network a lot when we used to operate and also how do",
    "start": "182010",
    "end": "188459"
  },
  {
    "text": "you analyze permissions more efficiently than built-in tools so we're gonna tell the tale of two api's the two API is",
    "start": "188459",
    "end": "195629"
  },
  {
    "start": "191000",
    "end": "203000"
  },
  {
    "text": "that Microsoft's have graciously provided to make our lives much easier but also was the basis for everything",
    "start": "195629",
    "end": "202350"
  },
  {
    "text": "we're talking about here the first one is net session enum now the built in",
    "start": "202350",
    "end": "207989"
  },
  {
    "start": "203000",
    "end": "237000"
  },
  {
    "text": "Windows net command has lots of juicy stuff in it and one of them is net sessions and underneath net sessions",
    "start": "207989",
    "end": "215459"
  },
  {
    "text": "just uses the net session enum API call what's fun is that the actual API call has a nice little field for the server",
    "start": "215459",
    "end": "224099"
  },
  {
    "text": "name so because it the API call is a little bit more complex than whether than that session binary does by",
    "start": "224099",
    "end": "229739"
  },
  {
    "text": "implementing it directly we could enumerate remote server sessions so now we have a way to tell who's logged in",
    "start": "229739",
    "end": "236819"
  },
  {
    "text": "where the second one is net local group yet members lets you retrieve a list of",
    "start": "236819",
    "end": "242910"
  },
  {
    "start": "237000",
    "end": "265000"
  },
  {
    "text": "members of a local group the one which we were almost always most interested in being the administrators group",
    "start": "242910",
    "end": "248239"
  },
  {
    "text": "administrators are awesome good lets you do whatever you want on a system get rid",
    "start": "248239",
    "end": "253560"
  },
  {
    "text": "of all those pesky DDR solutions so again this one has a server name",
    "start": "253560",
    "end": "258810"
  },
  {
    "text": "parameter so this allows us to renew marae remotely and check who's a local men on remote computers so let's let's",
    "start": "258810",
    "end": "266699"
  },
  {
    "start": "265000",
    "end": "439000"
  },
  {
    "text": "tell a little story here we have a pen tester named Matt Nelson and he is pen",
    "start": "266699",
    "end": "272280"
  },
  {
    "text": "testing the corn hub bio domain this is a nice little tiny office in Indiana",
    "start": "272280",
    "end": "277740"
  },
  {
    "text": "gotta make sure that they're really secure so they have about nine computers",
    "start": "277740",
    "end": "282919"
  },
  {
    "text": "that Nelson fishes and gets initial access on the computer in the middle right there so this is our old",
    "start": "282919",
    "end": "289919"
  },
  {
    "text": "methodology here first thing you do you run find local admin access and Power View and now you've hit every single",
    "start": "289919",
    "end": "297000"
  },
  {
    "text": "machine once we're gonna put a little number under each underneath each machine here so you guys can keep track",
    "start": "297000",
    "end": "302389"
  },
  {
    "text": "we've found out we have admin on the two machines that have flags on them now so",
    "start": "302389",
    "end": "308210"
  },
  {
    "text": "next thing we do is we run net session enum on those we try to see who's logged",
    "start": "308210",
    "end": "314400"
  },
  {
    "text": "into those machines so we can get some kind of idea of what kind of creds we might get so we look at the user names",
    "start": "314400",
    "end": "320550"
  },
  {
    "text": "that come back and we find absolutely nothing of value they're not domain admins they're not an any like super",
    "start": "320550",
    "end": "326759"
  },
  {
    "text": "privileged group so let's just like blindly pick one computer here we're gonna go to the computer number four all",
    "start": "326759",
    "end": "333990"
  },
  {
    "text": "right so now we're over here what's the next thing we do hey we hit the whole network all over again we're going to do",
    "start": "333990",
    "end": "340650"
  },
  {
    "text": "find local admin access one more time because now we have a new credential that we've taken from this computer and",
    "start": "340650",
    "end": "345810"
  },
  {
    "text": "we want to know where we have admin so now we've found admin a few more places and again the number increments we now",
    "start": "345810",
    "end": "353550"
  },
  {
    "text": "we have to get net sessions on those computers so now we're up to three on those and we decide all right let's go",
    "start": "353550",
    "end": "360300"
  },
  {
    "text": "to the bottom computer over there and this one looks juicy I think it's a da and we go over there sure enough we're",
    "start": "360300",
    "end": "367110"
  },
  {
    "text": "domain admin yay we won but at this point we've hit every computer at least twice some three and this is a very very",
    "start": "367110",
    "end": "374550"
  },
  {
    "text": "very small network this is just nine computers as the network scales up this number just keeps increasing as each",
    "start": "374550",
    "end": "380849"
  },
  {
    "text": "step increases there's more and more network in numeration that's being done that's not good it's very very very slow",
    "start": "380849",
    "end": "390150"
  },
  {
    "text": "to do this process when we used to run this process in larger environments this would take us weeks or months to execute",
    "start": "390150",
    "end": "397100"
  },
  {
    "text": "weeks spent doing approvals escalation is a lot of time that removes post",
    "start": "397100",
    "end": "402260"
  },
  {
    "text": "exploitation from your assessments as you get more and more Network hits your chance of getting caught also increases",
    "start": "402260",
    "end": "408740"
  },
  {
    "text": "and if you're on a red team getting caught is no bueno and as you get bigger and bigger",
    "start": "408740",
    "end": "414470"
  },
  {
    "text": "networks keeping track of what your enumerated gets harder and harder we used to try and solve this by using like",
    "start": "414470",
    "end": "421010"
  },
  {
    "text": "Excel pivot tables which is like the worst thing you can possibly touch so we",
    "start": "421010",
    "end": "426650"
  },
  {
    "text": "want to do it better and as it just so happens an entire branch of math that we",
    "start": "426650",
    "end": "432500"
  },
  {
    "text": "all fell asleep during math class for exists to solve this problem so why are we doing this ourselves so let's let's",
    "start": "432500",
    "end": "440780"
  },
  {
    "start": "439000",
    "end": "479000"
  },
  {
    "text": "do the new way so we drop in on the network right in the middle here and we run data collection for bloodhound we",
    "start": "440780",
    "end": "448730"
  },
  {
    "text": "hit every computer in the domain twice once for that session once for local admin but instead of just blindly",
    "start": "448730",
    "end": "455300"
  },
  {
    "text": "latently picking something we feed all this data into our tool and then we say let's make educated decisions where we",
    "start": "455300",
    "end": "461600"
  },
  {
    "text": "need to go so instead of having to go to one computer and do an enumeration again we know exactly where we need to go and",
    "start": "461600",
    "end": "467960"
  },
  {
    "text": "what we need to hit in order to get to where we need to be so there you go you do two steps you get the DA no more",
    "start": "467960",
    "end": "473810"
  },
  {
    "text": "networking numeration no more extra steps you're just happy now sure all",
    "start": "473810",
    "end": "484430"
  },
  {
    "start": "479000",
    "end": "532000"
  },
  {
    "text": "right we're gonna swap out our table here but wait there's more when you run",
    "start": "484430",
    "end": "491480"
  },
  {
    "text": "sharp out you're not just getting basic local admins or sessions you're also",
    "start": "491480",
    "end": "496970"
  },
  {
    "text": "getting lots of other things like are there any Kerberos misconfigurations who belongs to what group and how is that",
    "start": "496970",
    "end": "502640"
  },
  {
    "text": "unrolled are there any abusable East ACLs in the environment that you could use which",
    "start": "502640",
    "end": "507980"
  },
  {
    "text": "might even prevent you from needing to move laterally to another computer is there MS sequel servers that you might",
    "start": "507980",
    "end": "513440"
  },
  {
    "text": "have admin to because of service principles and if you do can you use those to get where you need to go so in",
    "start": "513440",
    "end": "524450"
  },
  {
    "text": "the real world we actually created bloodhound because we were in a massive",
    "start": "524450",
    "end": "529810"
  },
  {
    "text": "massive organization with thousands of endpoints hundreds of thousands of endpoints as it were getting domain",
    "start": "529810",
    "end": "536500"
  },
  {
    "start": "532000",
    "end": "611000"
  },
  {
    "text": "admin in a single domain in this network two weeks now the organization have",
    "start": "536500",
    "end": "542020"
  },
  {
    "text": "literally hundreds of domains this was definitely did not spark joy knowing that getting to the top of the",
    "start": "542020",
    "end": "549100"
  },
  {
    "text": "root was gonna take months potentially we built bloodhound as a proof of",
    "start": "549100",
    "end": "554620"
  },
  {
    "text": "concept and we ran it data collection took no 48 hours about 48 hours and it",
    "start": "554620",
    "end": "560529"
  },
  {
    "text": "showed us a path that went through seven different domains to compromise the forest route so 48 hours to go from",
    "start": "560529",
    "end": "567420"
  },
  {
    "text": "beginning to end versus one week to get just da in one single domain so it's",
    "start": "567420",
    "end": "578140"
  },
  {
    "text": "kind of the history of bloodhound the genesis how it came about we've been doing some new work in the past year so",
    "start": "578140",
    "end": "584350"
  },
  {
    "text": "that means some new attack edges adding some cool new features so we wanted to go through an example attack path and",
    "start": "584350",
    "end": "589810"
  },
  {
    "text": "show some of the more kind of niche cool like new Kerberos abuses that we've been able to implement it so as we're going",
    "start": "589810",
    "end": "596470"
  },
  {
    "text": "through this attack path think to yourself okay these misconfigurations have been in the network or might be in your network for",
    "start": "596470",
    "end": "602290"
  },
  {
    "text": "years would you have had any way to actually analyze and execute these things or actually realize the",
    "start": "602290",
    "end": "608080"
  },
  {
    "text": "implication of the risk that some of these components would have but first we're going to talk about Kerberos",
    "start": "608080",
    "end": "615720"
  },
  {
    "start": "611000",
    "end": "646000"
  },
  {
    "text": "there's an element in Kerberos called resource based constrained delegation where the the general motivation for",
    "start": "615720",
    "end": "622030"
  },
  {
    "text": "delegation in general an active directory is a way to impersonate users just do user impersonation from the",
    "start": "622030",
    "end": "628300"
  },
  {
    "text": "Active Directory context resource based constrained delegation as opposed to unconstrained or classic constrain is a",
    "start": "628300",
    "end": "635920"
  },
  {
    "text": "modern so Server 2012 plus way to safely",
    "start": "635920",
    "end": "641110"
  },
  {
    "text": "allow this type of user impersonation in the active directory context why is this",
    "start": "641110",
    "end": "648010"
  },
  {
    "start": "646000",
    "end": "690000"
  },
  {
    "text": "needed for delegation in general so the classic example is if a user is authenticated into a front-end service",
    "start": "648010",
    "end": "655089"
  },
  {
    "text": "say a web server that web server may need to impersonate that user when they're authenticating to a different",
    "start": "655089",
    "end": "661060"
  },
  {
    "text": "back-end service say a sequel database so we've had some people say like why does Microsoft allow impersonation or",
    "start": "661060",
    "end": "666950"
  },
  {
    "text": "delegation at all there are legitimate use cases for it the first take edit the",
    "start": "666950",
    "end": "672680"
  },
  {
    "text": "Microsoft did with unconstrained is very dangerous for different reasons the second take they took it it would constrain had its own kind of elements",
    "start": "672680",
    "end": "679100"
  },
  {
    "text": "potentially domain takeover depending on things so this is a their third take at delegation and overall it's a good",
    "start": "679100",
    "end": "685130"
  },
  {
    "text": "system but it has unintended consequences that we love is pen testers",
    "start": "685130",
    "end": "690520"
  },
  {
    "start": "690000",
    "end": "734000"
  },
  {
    "text": "but diving a little bit deeper for resource base how it actually works I'm not going to spend you know 10 minutes",
    "start": "690520",
    "end": "696170"
  },
  {
    "text": "going over all the Kerberos internals and all that but resource based constrained delegation is implemented as",
    "start": "696170",
    "end": "701540"
  },
  {
    "text": "a security descriptor a discretionary access control list on a target resource or computer object so this tackle this",
    "start": "701540",
    "end": "709460"
  },
  {
    "text": "store is a serie of binary bytes and the msds allowed to allow to act on behalf of other identity it's a bit of a",
    "start": "709460",
    "end": "716270"
  },
  {
    "text": "mouthful property this is just a simple ACL that defines who is allowed to",
    "start": "716270",
    "end": "722030"
  },
  {
    "text": "impersonate any user to that target system the impersonation itself is",
    "start": "722030",
    "end": "727550"
  },
  {
    "text": "executed through a series of two Kerberos extensions called s3 to self s or youtube proxy why does this matter so",
    "start": "727550",
    "end": "736910"
  },
  {
    "start": "734000",
    "end": "794000"
  },
  {
    "text": "we had known about this for a while and one of the things we really cared about when we started bloodhound and doing the",
    "start": "736910",
    "end": "742339"
  },
  {
    "text": "ACL based injection components is we wanted a computer ACL based takeover attack operative what what do we mean by",
    "start": "742339",
    "end": "749210"
  },
  {
    "text": "that so for a user ACL based primitive we could if we had generic all or kind",
    "start": "749210",
    "end": "754430"
  },
  {
    "text": "of edit rights admin rights over a user object itself we could reset their password that doesn't work with",
    "start": "754430",
    "end": "759620"
  },
  {
    "text": "computers because they'll become disjoint from the domain so we've been waiting for an ACL based primitive for",
    "start": "759620",
    "end": "765200"
  },
  {
    "text": "this and in spring of this year Evod Shamir or at least his really really awesome wagging the dog post on resource",
    "start": "765200",
    "end": "771980"
  },
  {
    "text": "base constrained delegation abuse and his big finding is that non-portable s3",
    "start": "771980",
    "end": "777230"
  },
  {
    "text": "to self tickets will still work for s4 youtube proxy specifically in the case",
    "start": "777230",
    "end": "783140"
  },
  {
    "text": "of resource based constrained delegation so what does that mean if you're not person Kerberos is this grants us a",
    "start": "783140",
    "end": "790250"
  },
  {
    "text": "generalized ACL based computer takeover per image what does that mean in English in",
    "start": "790250",
    "end": "795790"
  },
  {
    "start": "794000",
    "end": "810000"
  },
  {
    "text": "English if we can modify this one particular property on a target computer object we can completely compromise that",
    "start": "795790",
    "end": "803560"
  },
  {
    "text": "computer and take it over we're going to show this an attack that so first any is",
    "start": "803560",
    "end": "812950"
  },
  {
    "start": "810000",
    "end": "893000"
  },
  {
    "text": "in the show what this attack path would look like and bloodhound so here's the",
    "start": "812950",
    "end": "818410"
  },
  {
    "text": "bloodhound interface whoa here's the bloodhound interface and we're saying the domain object in the contoso dot",
    "start": "818410",
    "end": "826180"
  },
  {
    "text": "local domain give me the shortest attack paths to there and the graph will find all the",
    "start": "826180",
    "end": "833110"
  },
  {
    "text": "shortest paths that exist from any node in the domain to that object this attack path starts at this desktop",
    "start": "833110",
    "end": "839200"
  },
  {
    "text": "0:01 computer as a session for Bob accounting that user belonged to this group called",
    "start": "839200",
    "end": "844990"
  },
  {
    "text": "accounting support accounting support belongs to accounting admins so through",
    "start": "844990",
    "end": "850000"
  },
  {
    "text": "security group delegation accounting admins has epidemic accounting 0 0 1 and",
    "start": "850000",
    "end": "855100"
  },
  {
    "text": "so does Bob this computer in accounting has generic write over an exchange system which belongs to the exchange",
    "start": "855100",
    "end": "862030"
  },
  {
    "text": "trusted sub system group and AD our favorite ad group favorite ad group that",
    "start": "862030",
    "end": "867130"
  },
  {
    "text": "group has tons and tons of privileges including right tackle on the domain head so we're gonna execute this attack",
    "start": "867130",
    "end": "873580"
  },
  {
    "text": "path in these video demos we're gonna",
    "start": "873580",
    "end": "882550"
  },
  {
    "text": "skip part one just because it's a very basic thing it's local admin on a computer so PS exec WMI whatever you",
    "start": "882550",
    "end": "890950"
  },
  {
    "text": "want okay so we're assuming that we're",
    "start": "890950",
    "end": "898060"
  },
  {
    "start": "893000",
    "end": "1172000"
  },
  {
    "text": "going to be on this accounting box we compromised that first hop we're gonna show the verification of the ACLs that",
    "start": "898060",
    "end": "905740"
  },
  {
    "text": "bloodhound was able to find but first we're on the system or on accounting we're gonna escalate to the system user",
    "start": "905740",
    "end": "912220"
  },
  {
    "text": "context but showing like ok even whatever context were in we do not have",
    "start": "912220",
    "end": "920850"
  },
  {
    "text": "we do not have rights over that target box so we will escalate up the system",
    "start": "921300",
    "end": "929459"
  },
  {
    "text": "because the system user context will use the Machine account from whatever box you're on see access denied",
    "start": "929459",
    "end": "936959"
  },
  {
    "text": "because we haven't actually executed this resource-based constrained delegation attack better yet so we're",
    "start": "936959",
    "end": "942959"
  },
  {
    "text": "gonna load up Power View to do our active directory analysis we're also gonna load up Kevin Robertson's",
    "start": "942959",
    "end": "948899"
  },
  {
    "text": "power-mad which abuses the machine account quota component of active directory to provision new machine",
    "start": "948899",
    "end": "954089"
  },
  {
    "text": "accounts in a way that we can control so our target computer in this example is going to be the exchange server this",
    "start": "954089",
    "end": "960989"
  },
  {
    "text": "is the machine that our current machine has edit rights over we're going to pull our actual attacker Sid so this is the",
    "start": "960989",
    "end": "968339"
  },
  {
    "text": "SID of the computer we're currently on this is who has edit rights over that target system then we're going to show",
    "start": "968339",
    "end": "974069"
  },
  {
    "text": "the ACL base we're just gonna pull the the dackel the ACLs for that target computer on the exchange box if we",
    "start": "974069",
    "end": "981599"
  },
  {
    "text": "examine the ace we see ok there's a generic all right over the exchange",
    "start": "981599",
    "end": "988079"
  },
  {
    "text": "system by the security identifier what happens which happens to match what our current computer security identifier is",
    "start": "988079",
    "end": "993899"
  },
  {
    "text": "so this is just simple verification of the actual ACL information the bloodhound was able to enumerate the",
    "start": "993899",
    "end": "1002509"
  },
  {
    "text": "next steps we want to actually execute this this attack that we are going to",
    "start": "1002509",
    "end": "1007819"
  },
  {
    "text": "first use Powermat from Kevin Robertson to provision a new machine account with",
    "start": "1007819",
    "end": "1014089"
  },
  {
    "text": "a password that we control this is because we need an account we need complete control of an account that has",
    "start": "1014089",
    "end": "1019699"
  },
  {
    "text": "a service principle name set to actually execute the resource based constrained delegation path we're gonna grab the",
    "start": "1019699",
    "end": "1026779"
  },
  {
    "text": "computer set these this is the this computer says is going to become the principal in the ACL that we actually",
    "start": "1026779",
    "end": "1033230"
  },
  {
    "text": "construct the general approach is we need to create this ACL set it to a particular property on the target and",
    "start": "1033230",
    "end": "1039288"
  },
  {
    "text": "then we're going to execute the s for you to self and proxy component for resource based constrained delegation so",
    "start": "1039289",
    "end": "1045970"
  },
  {
    "text": "create the ACL very easy to do in PowerShell we're gonna get the binary bytes that",
    "start": "1045970",
    "end": "1051860"
  },
  {
    "text": "ACL and we're going to use that and set against the MSDS a lot to act on",
    "start": "1051860",
    "end": "1056930"
  },
  {
    "text": "Oh what can never burn off the whole thing it's a little too long so part of the axe",
    "start": "1056930",
    "end": "1062440"
  },
  {
    "text": "grab the binary form we're going to just use a simple l dot property set against",
    "start": "1062440",
    "end": "1068810"
  },
  {
    "text": "the target and after that we're going to pull the ACL to just verify that we",
    "start": "1068810",
    "end": "1074240"
  },
  {
    "text": "actually did the correct LDAP set on this component the puller all raw bytes",
    "start": "1074240",
    "end": "1080830"
  },
  {
    "text": "we're going to transform that back into a security descriptor and pull out the discretionary component of the ACL for",
    "start": "1080830",
    "end": "1087350"
  },
  {
    "text": "verification but still you can actually do this we're not gonna have administrative rights against the target",
    "start": "1087350",
    "end": "1094730"
  },
  {
    "text": "system because we have to go through a fairly complex Kerberos ticket exchange process to actually get the final",
    "start": "1094730",
    "end": "1101600"
  },
  {
    "text": "service ticket that we want against the target verification everything matches",
    "start": "1101600",
    "end": "1107750"
  },
  {
    "text": "up everything's great still don't have admin rights ok the next bit we're going",
    "start": "1107750",
    "end": "1114530"
  },
  {
    "text": "to do is use a tool that we wrote called Rubeus which is a Kerberos abuse toolkit",
    "start": "1114530",
    "end": "1119840"
  },
  {
    "text": "that heavily heavily pulls from benjamin deltas kikyo project we're in a hash of",
    "start": "1119840",
    "end": "1124850"
  },
  {
    "text": "our password then we're going to use the s4 you module our command and Rubeus to",
    "start": "1124850",
    "end": "1131270"
  },
  {
    "text": "actually execute this whole process which will first get a TGT for this dummy system account we created it'll do",
    "start": "1131270",
    "end": "1138110"
  },
  {
    "text": "that for you to self to itself to impersonate an administrators or pretending to be the domain admin then",
    "start": "1138110",
    "end": "1143660"
  },
  {
    "text": "it'll do this for you to proxy protocol transition ending with a full ticket for",
    "start": "1143660",
    "end": "1149360"
  },
  {
    "text": "CIFS or the file system we're then going to apply that ticket to our current logon session and after this we're able",
    "start": "1149360",
    "end": "1157100"
  },
  {
    "text": "to compromise the exchange box awesome",
    "start": "1157100",
    "end": "1162320"
  },
  {
    "text": "there we go alright let's step one of that whole path that Andy outline in the",
    "start": "1162320",
    "end": "1168500"
  },
  {
    "text": "bloodhound analysis component step two",
    "start": "1168500",
    "end": "1175010"
  },
  {
    "start": "1172000",
    "end": "1304000"
  },
  {
    "text": "we're moving to the exchange server itself so now we're on the exchange box",
    "start": "1175010",
    "end": "1181400"
  },
  {
    "text": "see exchange o1 and this is the computer account that because of the Nestene in",
    "start": "1181400",
    "end": "1186740"
  },
  {
    "text": "exchange trusted subsystem is gonna have right deco rights over the domain root",
    "start": "1186740",
    "end": "1191809"
  },
  {
    "text": "this means that we can grant ourselves DC sync privileges DC sync is a the",
    "start": "1191809",
    "end": "1197900"
  },
  {
    "text": "reimplementation of the DC replication protocol by Vincent Lee - and Benjamin",
    "start": "1197900",
    "end": "1203050"
  },
  {
    "text": "so we're gonna run this and because we have these edit rights we can't just DC",
    "start": "1203050",
    "end": "1208100"
  },
  {
    "text": "sync immediately we have control rights over the target we don't have the DC",
    "start": "1208100",
    "end": "1213559"
  },
  {
    "text": "sync rights itself yet and you can do",
    "start": "1213559",
    "end": "1218870"
  },
  {
    "text": "any of these like a CL bias modifications you don't have to use Power View anything that has just LDAP",
    "start": "1218870",
    "end": "1223910"
  },
  {
    "text": "property modification can be used to execute this PAP so we're going to use the C import power view we're gonna get",
    "start": "1223910",
    "end": "1235220"
  },
  {
    "text": "the we need to get the identity the CID of the chain trusted subsystem we're verifying this okay that's one 603 then",
    "start": "1235220",
    "end": "1246890"
  },
  {
    "text": "we're gonna verify some of the ACL information for the attack that but because this we know okay exchange",
    "start": "1246890",
    "end": "1252770"
  },
  {
    "text": "trusted we can add and modify an ACL on the root domain object where the",
    "start": "1252770",
    "end": "1258950"
  },
  {
    "text": "principal is the extreme trusted subsystem itself we're gonna grant",
    "start": "1258950",
    "end": "1265790"
  },
  {
    "text": "ourselves DC sync rights everything's gonna execute through and now we're",
    "start": "1265790",
    "end": "1274070"
  },
  {
    "text": "gonna have now we can synchronize and retrieve the password credential material for any use in the domain so",
    "start": "1274070",
    "end": "1279740"
  },
  {
    "text": "say krbtgt we get our hash we can create all of our awesome golden tickets so",
    "start": "1279740",
    "end": "1287990"
  },
  {
    "text": "that's a fairly complex path with a lot of moving pieces that even as of like a year or so ago we would not have been",
    "start": "1287990",
    "end": "1293870"
  },
  {
    "text": "able to enumerate and find but these are miss configurations that have existed in domains and existing domains and have",
    "start": "1293870",
    "end": "1299780"
  },
  {
    "text": "been around for years we just don't realize the full risk and implication of it okay so",
    "start": "1299780",
    "end": "1308480"
  },
  {
    "start": "1304000",
    "end": "1335000"
  },
  {
    "text": "what are we trying to do about this do you hear a lot of feedback from my voice",
    "start": "1308480",
    "end": "1313870"
  },
  {
    "text": "okay I'll just keep on so our answer to this",
    "start": "1313870",
    "end": "1320570"
  },
  {
    "text": "as far as what can we do to efficiently and empirically understand enumerate and",
    "start": "1320570",
    "end": "1327730"
  },
  {
    "text": "remediate these attack paths in Active Directory is this it's our adversary",
    "start": "1327730",
    "end": "1333080"
  },
  {
    "text": "resilience methodology a lot of this is based on this quote from John Lambert in",
    "start": "1333080",
    "end": "1339500"
  },
  {
    "start": "1335000",
    "end": "1359000"
  },
  {
    "text": "his blog post with this tile right here attackers think in graphs defenders",
    "start": "1339500",
    "end": "1345020"
  },
  {
    "text": "think in lists as long as this is true attackers when you would think that",
    "start": "1345020",
    "end": "1350090"
  },
  {
    "text": "we're contractually obligated to have this quote in every talk that we have but really this is a timeless and",
    "start": "1350090",
    "end": "1355640"
  },
  {
    "text": "extremely insightful quote from John this is what our methodology it looks",
    "start": "1355640",
    "end": "1361490"
  },
  {
    "start": "1359000",
    "end": "1393000"
  },
  {
    "text": "like so starting at the top left we enumerate attack paths that's using bloodhound we analyze the attack paths",
    "start": "1361490",
    "end": "1367940"
  },
  {
    "text": "to understand what patterns we can ferret out from that data and then the",
    "start": "1367940",
    "end": "1374090"
  },
  {
    "text": "most difficult part of this methodology is in generating and validating those remediation hypotheses and then finally",
    "start": "1374090",
    "end": "1381890"
  },
  {
    "text": "we deploy our prior talk to prioritize fixes and start all over again we're",
    "start": "1381890",
    "end": "1387380"
  },
  {
    "text": "gonna focus here initially on analyzing these attack paths that bloodhound shows us so our objective here we want to find",
    "start": "1387380",
    "end": "1395990"
  },
  {
    "start": "1393000",
    "end": "1410000"
  },
  {
    "text": "critical low-hanging fruit we want to generate basic descriptive statistics",
    "start": "1395990",
    "end": "1401570"
  },
  {
    "text": "and measure our overall security posture in Active Directory based on these",
    "start": "1401570",
    "end": "1406870"
  },
  {
    "text": "misconfigurations and user behaviors so",
    "start": "1406870",
    "end": "1412150"
  },
  {
    "start": "1410000",
    "end": "1531000"
  },
  {
    "text": "before bloodhound was created it was very very difficult to take any given",
    "start": "1412150",
    "end": "1418190"
  },
  {
    "text": "principal and Active Directory and determine what privileges are held by this principal because of the nature of",
    "start": "1418190",
    "end": "1424220"
  },
  {
    "text": "Active Directory permissions they are discretionary so they are inbound on objects and outbound privileges there is",
    "start": "1424220",
    "end": "1430640"
  },
  {
    "text": "no native way in Windows or Active Directory to enumerate that with the",
    "start": "1430640",
    "end": "1436370"
  },
  {
    "text": "bloodhound data we can so this is a very basic descriptive statistic that we do for our",
    "start": "1436370",
    "end": "1443269"
  },
  {
    "text": "customers by the way everything we're talking about this in this talk is free and open source so there's nothing in",
    "start": "1443269",
    "end": "1449419"
  },
  {
    "text": "here that is like private or secret or anything what we're looking at here is just in descending order what are the",
    "start": "1449419",
    "end": "1455539"
  },
  {
    "text": "most privileged groups in Active Directory and from this chart you can see some very immediate insights that",
    "start": "1455539",
    "end": "1462529"
  },
  {
    "text": "would launch you into a little more of investigative process to figure out why",
    "start": "1462529",
    "end": "1467990"
  },
  {
    "text": "these why this is the way this is an one example is the domain admins group you",
    "start": "1467990",
    "end": "1473240"
  },
  {
    "text": "would expect that to be the most privileged group an ad in this data set which is based on real data the names",
    "start": "1473240",
    "end": "1480080"
  },
  {
    "text": "have been changed to protect the innocent the domain admins group is barely even in the top five of the most",
    "start": "1480080",
    "end": "1485480"
  },
  {
    "text": "privileged ad groups sometimes it's not even in top ten so Shawn Metcalf has a",
    "start": "1485480",
    "end": "1490700"
  },
  {
    "text": "fantastic blog post about how domain admin is you know just the tip of the iceberg we should be going far beyond",
    "start": "1490700",
    "end": "1496279"
  },
  {
    "text": "domain admin but still da is like the most obvious target something else you",
    "start": "1496279",
    "end": "1502490"
  },
  {
    "text": "can look at is there are these helpdesk tier 1 2 & 3 groups that you would think they would have a different level of",
    "start": "1502490",
    "end": "1508549"
  },
  {
    "text": "privilege in AD but for some reason they have all the exact same privilege which kind of defies our at least privilege",
    "start": "1508549",
    "end": "1514549"
  },
  {
    "text": "goals so in this chart we can we can understand what the privileges are",
    "start": "1514549",
    "end": "1519919"
  },
  {
    "text": "they're held by the most sensitive groups what those miss the most sensitive verbs actually are and start",
    "start": "1519919",
    "end": "1526340"
  },
  {
    "text": "digging into how we can protect the users and other identities that belong to these groups so what about the other",
    "start": "1526340",
    "end": "1533389"
  },
  {
    "text": "way around what about computers in my domain sorted",
    "start": "1533389",
    "end": "1538549"
  },
  {
    "text": "in descending order of the most admins that exist on each of those so this is based on fake data that we created with",
    "start": "1538549",
    "end": "1545059"
  },
  {
    "text": "our blood on DB creator script and you can see like very obviously at the very top there are these four computers that",
    "start": "1545059",
    "end": "1551330"
  },
  {
    "text": "have way more admins than any other system and the network does in reality this chart looks exactly like this in",
    "start": "1551330",
    "end": "1558590"
  },
  {
    "text": "real environments but the numbers are astronomically large and sometimes",
    "start": "1558590",
    "end": "1563899"
  },
  {
    "text": "that's because the domain users group gets added to the local admins group but sometimes it's also because a different",
    "start": "1563899",
    "end": "1570190"
  },
  {
    "text": "all-inclusive non default built-in ad group has been added either",
    "start": "1570190",
    "end": "1575210"
  },
  {
    "text": "to a privileged group or has been directly edited local admins group on a system with traditional auditing tools",
    "start": "1575210",
    "end": "1583400"
  },
  {
    "text": "you really can't determine this information easily what that makes it super easy so we're going to look at",
    "start": "1583400",
    "end": "1590690"
  },
  {
    "text": "another video this this slide right here at the very top we can see that this",
    "start": "1590690",
    "end": "1597050"
  },
  {
    "text": "comp 0 0 0 3 computer has way more admins than any other computer does it's",
    "start": "1597050",
    "end": "1602330"
  },
  {
    "text": "a part of a group of 4 other computers that have that many admins so in the",
    "start": "1602330",
    "end": "1607910"
  },
  {
    "text": "bloodhound UI we can look up that computer and we can figure out what's going on any asset that's tracking",
    "start": "1607910",
    "end": "1614630"
  },
  {
    "text": "bloodhound you can just like just like Google Maps you search for it we'll click on the computer and then under",
    "start": "1614630",
    "end": "1620840"
  },
  {
    "text": "this local admin section we can see that there are six principles that are actually added to the domain evidence",
    "start": "1620840",
    "end": "1626510"
  },
  {
    "text": "group but then if we unroll that out there's actually 500 different users that have evan rights on that system and",
    "start": "1626510",
    "end": "1632780"
  },
  {
    "text": "it's all because of that right there that domain users group has been added to the local admins group on that computer so as far as finding",
    "start": "1632780",
    "end": "1639710"
  },
  {
    "text": "low-hanging fruit an ad on the assessments that we do we find this on",
    "start": "1639710",
    "end": "1644870"
  },
  {
    "text": "day one and usually eyes are kind of like big and like people are terrified",
    "start": "1644870",
    "end": "1651710"
  },
  {
    "text": "to see this kind of stuff all right what",
    "start": "1651710",
    "end": "1661400"
  },
  {
    "text": "about Kerberos Kerberos sting fundamentally changed how we operated as",
    "start": "1661400",
    "end": "1668270"
  },
  {
    "start": "1663000",
    "end": "1739000"
  },
  {
    "text": "red teamers because it gave us a capability to do password cracking",
    "start": "1668270",
    "end": "1674120"
  },
  {
    "text": "attempts on usually very high privileged users in AD from any domain",
    "start": "1674120",
    "end": "1679730"
  },
  {
    "text": "authenticated context and do this kind of offline brute-force attack against a curb 5 TGS ticket but how do you",
    "start": "1679730",
    "end": "1688250"
  },
  {
    "text": "prioritize as a red teamer what users are actually interesting to go after so",
    "start": "1688250",
    "end": "1693500"
  },
  {
    "text": "in the Bloodhound data we can again look at any principle and determine what privileges they have and on red teams",
    "start": "1693500",
    "end": "1700730"
  },
  {
    "text": "this is exactly what we do we'll find ok here are the ten you kerberos table and one of them is a",
    "start": "1700730",
    "end": "1706399"
  },
  {
    "text": "domain admin or one of them has admin rights on 50% of the boxes or whatever so they can be kind of interesting and",
    "start": "1706399",
    "end": "1713029"
  },
  {
    "text": "that can be very helpful to chart out in a way like this so we can kind of have a hit list of okay you should be",
    "start": "1713029",
    "end": "1718820"
  },
  {
    "text": "remediating these users first because of the level of privilege so that's one",
    "start": "1718820",
    "end": "1723859"
  },
  {
    "text": "thing that's kind of interesting but what if we also add another element to this what if we say alright these are my",
    "start": "1723859",
    "end": "1729109"
  },
  {
    "text": "Kerberos table users but the Kerberos attack being successful depends on that",
    "start": "1729109",
    "end": "1734450"
  },
  {
    "text": "user having a weak password that can actually be broken okay well let's try to break all of them so here's all of",
    "start": "1734450",
    "end": "1740509"
  },
  {
    "start": "1739000",
    "end": "1786000"
  },
  {
    "text": "our users that our Kerberos LaBolt that also have a weak password that we were able to crack a password within some",
    "start": "1740509",
    "end": "1746269"
  },
  {
    "text": "reasonable time frame 24 hours 48 hours whatever so when you're looking for",
    "start": "1746269",
    "end": "1751729"
  },
  {
    "text": "remediation strategy you're looking for low-hanging fruit which is exactly what we're talking about here this is like",
    "start": "1751729",
    "end": "1757639"
  },
  {
    "text": "zooming in and saying here is your extreme risk you need to fix this immediately there was a customer that we",
    "start": "1757639",
    "end": "1764629"
  },
  {
    "text": "did this for recently and there was a user that had admin rights on 97% of their systems password has changed let's",
    "start": "1764629",
    "end": "1772249"
  },
  {
    "text": "just say a long time ago we showed them this chart and they deleted the user",
    "start": "1772249",
    "end": "1777589"
  },
  {
    "text": "within the hour a huge amount of attack surface was removed basically",
    "start": "1777589",
    "end": "1783049"
  },
  {
    "text": "instantaneously so pretty big win what about this so when we're looking at",
    "start": "1783049",
    "end": "1791299"
  },
  {
    "start": "1786000",
    "end": "1840000"
  },
  {
    "text": "strategies to figure out how can we reduce attack surface and AD it's useful",
    "start": "1791299",
    "end": "1797599"
  },
  {
    "text": "to have very basic statistics that will apply to any domain and so we hone in on",
    "start": "1797599",
    "end": "1804709"
  },
  {
    "text": "this we hone in on what percentage of users in Active Directory can compromise",
    "start": "1804709",
    "end": "1810349"
  },
  {
    "text": "a domain admin this is a very simple concept that we can actually empirically measure thanks to this tool what do I",
    "start": "1810349",
    "end": "1820879"
  },
  {
    "text": "want to say I want to say that is very common that this number is a hundred percent in Active Directory so let's go",
    "start": "1820879",
    "end": "1830749"
  },
  {
    "text": "back to our overall resilience methodology and now we want to look at how we can generate and validate these",
    "start": "1830749",
    "end": "1837830"
  },
  {
    "text": "so to save your mediation hypotheses and our objective here is to eliminate or mitigate as many attack paths as",
    "start": "1837830",
    "end": "1844490"
  },
  {
    "start": "1840000",
    "end": "1891000"
  },
  {
    "text": "possible using practical and measurably effective strategies before we actually",
    "start": "1844490",
    "end": "1850370"
  },
  {
    "text": "attempt to deploy them in production so when we say practical we mean we don't",
    "start": "1850370",
    "end": "1856519"
  },
  {
    "text": "want to go in someplace or you don't want to do this yourself and then come back and say well you just have to re",
    "start": "1856519",
    "end": "1863240"
  },
  {
    "text": "are protecting entire forests it's easy and everything will be fixed everything will be solved don't more tourists",
    "start": "1863240",
    "end": "1869240"
  },
  {
    "text": "tomorrow yeah I will do it we'll go tomorrow it's not practical for most",
    "start": "1869240",
    "end": "1874370"
  },
  {
    "text": "organizations to go through that process that process can also be extremely expensive as a lot of people know so",
    "start": "1874370",
    "end": "1881330"
  },
  {
    "text": "what we're looking for are the so to say surgical and precise changes that we can",
    "start": "1881330",
    "end": "1886700"
  },
  {
    "text": "deploy within days or weeks and not years so here's an example of what you",
    "start": "1886700",
    "end": "1894559"
  },
  {
    "start": "1891000",
    "end": "1987000"
  },
  {
    "text": "might see in bloodhound this is a user over here on the Left called er more 0 0",
    "start": "1894559",
    "end": "1900649"
  },
  {
    "text": "1 1 and what we're looking at here are all of the shortest attack paths to",
    "start": "1900649",
    "end": "1907130"
  },
  {
    "text": "domain heaven and that word shortest is absolutely vital so in graph theory it is very easy to",
    "start": "1907130",
    "end": "1915500"
  },
  {
    "text": "find a shortest attack path or a shortest path from any vertex to any",
    "start": "1915500",
    "end": "1920779"
  },
  {
    "text": "other vertex there are several different outcomes that can solve that problem",
    "start": "1920779",
    "end": "1926620"
  },
  {
    "text": "instantaneously effectively like think about Google Maps how long does it take to calculate a route from Los Angeles to New York less than a second it's very",
    "start": "1926649",
    "end": "1934250"
  },
  {
    "text": "very fast Google message that because they use a graph to track all that data",
    "start": "1934250",
    "end": "1939700"
  },
  {
    "text": "so something without we want to help you with is avoid a very common pitfall that",
    "start": "1939700",
    "end": "1945679"
  },
  {
    "text": "we fell into ourselves and then we also see a lot of other people falling into when they start trying to apply this",
    "start": "1945679",
    "end": "1952669"
  },
  {
    "text": "data in a defensive way and that pitfall is looking at this information right",
    "start": "1952669",
    "end": "1959179"
  },
  {
    "text": "here and believing or thinking that this is the entire attack path possibility",
    "start": "1959179",
    "end": "1964460"
  },
  {
    "text": "from one user to the domain admins group it is not we are looking at the shortest attack paths so",
    "start": "1964460",
    "end": "1971549"
  },
  {
    "text": "here's a longer attack path that goes through one other group membership step that we couldn't enumerate because it",
    "start": "1971549",
    "end": "1977309"
  },
  {
    "text": "was not part of the shortest attack pads here's another here's another attack path that was not enumerated at first",
    "start": "1977309",
    "end": "1983759"
  },
  {
    "text": "because it is also not among the shortest attack paths let's go just a",
    "start": "1983759",
    "end": "1989340"
  },
  {
    "start": "1987000",
    "end": "2064000"
  },
  {
    "text": "different way very common question we get is how can I see all attack paths",
    "start": "1989340",
    "end": "1996289"
  },
  {
    "text": "okay this is a good question and it is a question that we asked ourselves when we",
    "start": "1996289",
    "end": "2002360"
  },
  {
    "text": "started trying to accomplish more defensive centric things using this data",
    "start": "2002360",
    "end": "2007690"
  },
  {
    "text": "so we're going to look at all the tech paths that are possible from this user this is one user and this one we're",
    "start": "2007690",
    "end": "2016070"
  },
  {
    "text": "looking at this is length zero so link zero of an attack path here's one here's",
    "start": "2016070",
    "end": "2023869"
  },
  {
    "text": "two here's three here's four here's five",
    "start": "2023869",
    "end": "2032109"
  },
  {
    "text": "here's six seven eight nine didn't need",
    "start": "2032109",
    "end": "2043489"
  },
  {
    "text": "to be derive any kind of insight from that I can but for one user outbound",
    "start": "2043489",
    "end": "2051290"
  },
  {
    "text": "attack has that are possible of length nine this also took approximately three",
    "start": "2051290",
    "end": "2057169"
  },
  {
    "text": "minutes for the database to return the result of this query why is this this is",
    "start": "2057169",
    "end": "2067190"
  },
  {
    "text": "because finding all paths means you have to include the longest path finding the",
    "start": "2067190",
    "end": "2073849"
  },
  {
    "text": "longest path in a graph is a very well studied problem in graph theory and it",
    "start": "2073849",
    "end": "2079549"
  },
  {
    "text": "is understood and known to be non polynomial hard visit is an np-hard",
    "start": "2079549",
    "end": "2084740"
  },
  {
    "text": "problem this is true for directed acyclic graphs which is what the",
    "start": "2084740",
    "end": "2090530"
  },
  {
    "text": "Bloodhound attack graph is if it were an a cyclic graph then you could solve this",
    "start": "2090530",
    "end": "2096500"
  },
  {
    "text": "problem in linear time which also will be a very very very long time so",
    "start": "2096500",
    "end": "2105310"
  },
  {
    "text": "shortest attack paths we look at in customer environments and this is how",
    "start": "2105310",
    "end": "2112030"
  },
  {
    "text": "many attack paths we found in one of those networks this network had 8,000",
    "start": "2112030",
    "end": "2118630"
  },
  {
    "text": "computers all of the possible shortest attack paths from any user to domain",
    "start": "2118630",
    "end": "2123940"
  },
  {
    "text": "admins the domain route the domain controller whatever twenty million three hundred forty six thousand three hundred",
    "start": "2123940",
    "end": "2129520"
  },
  {
    "text": "and eighty five I don't know about you but I don't want to go I don't want to go to reach one of those it's like an",
    "start": "2129520",
    "end": "2134650"
  },
  {
    "text": "average Tuesday I'm in we have 15 minutes left though so we running we're",
    "start": "2134650",
    "end": "2139690"
  },
  {
    "text": "gonna start with number one okay sure this attack number one stupid joke so",
    "start": "2139690",
    "end": "2146200"
  },
  {
    "text": "the bottom line that I want to try to drive into your mind is that Active Directory is not a maze was a red teamer",
    "start": "2146200",
    "end": "2152470"
  },
  {
    "text": "as a pen tester you start off with access under one system some kind of like beachhead system and you find your",
    "start": "2152470",
    "end": "2159280"
  },
  {
    "text": "way through Active Directory until you finally get to your objective domain admin or whatever don't think of Active",
    "start": "2159280",
    "end": "2166119"
  },
  {
    "text": "Directory as a maze Active Directory is a map it is a extremely complicated it",
    "start": "2166119",
    "end": "2175510"
  },
  {
    "start": "2168000",
    "end": "2180000"
  },
  {
    "text": "extremely complicated map that doesn't follow the rules of two-dimensional geography so consider this if we're",
    "start": "2175510",
    "end": "2182410"
  },
  {
    "start": "2180000",
    "end": "2233000"
  },
  {
    "text": "going from Washington DC to New York this is the shortest path here's another path here's another path",
    "start": "2182410",
    "end": "2188710"
  },
  {
    "text": "here's another path here's another path another path another one so don't think",
    "start": "2188710",
    "end": "2195520"
  },
  {
    "text": "about trying to look at all the attack paths you can't I'm sorry to say so what",
    "start": "2195520",
    "end": "2203500"
  },
  {
    "text": "if instead of looking at all the attack paths what if we change our thinking from you know trying to find like a",
    "start": "2203500",
    "end": "2209890"
  },
  {
    "text": "sparse cut edge into a strategy of isolation well they were trying to",
    "start": "2209890",
    "end": "2216310"
  },
  {
    "text": "isolate New York and Washington DC from the rest of the country well we would start with zoom in on that city and we",
    "start": "2216310",
    "end": "2222790"
  },
  {
    "text": "would understand what are the first and second-degree connections that get us there all right let's replace that with domain",
    "start": "2222790",
    "end": "2229960"
  },
  {
    "text": "admins and domain users so forget about",
    "start": "2229960",
    "end": "2235210"
  },
  {
    "start": "2233000",
    "end": "2254000"
  },
  {
    "text": "analyzing all paths focus on isolating sensitive principles and focus on understanding what the",
    "start": "2235210",
    "end": "2241780"
  },
  {
    "text": "outbound privileges are they're held by the built-in security groups also privileges are held by more or less",
    "start": "2241780",
    "end": "2249030"
  },
  {
    "text": "all-inclusive security groups in Active Directory as well that are not default and built-in so how can I do this for",
    "start": "2249030",
    "end": "2257109"
  },
  {
    "start": "2254000",
    "end": "2281000"
  },
  {
    "text": "domain admins well let's look at how domain admins are exposed there are several different ways that we can",
    "start": "2257109",
    "end": "2263530"
  },
  {
    "text": "understand a domain admin exposure or exposure for the group itself so we have",
    "start": "2263530",
    "end": "2268570"
  },
  {
    "text": "credentials in memory we have abusable aces we have GPO abuse harborough's AS",
    "start": "2268570",
    "end": "2274420"
  },
  {
    "text": "prep roasting there's a thousand ways to skin that cat let's focus on GPO abuse",
    "start": "2274420",
    "end": "2279880"
  },
  {
    "text": "first so with GPOs if I control a GPO that is linked to an",
    "start": "2279880",
    "end": "2287830"
  },
  {
    "start": "2281000",
    "end": "2372000"
  },
  {
    "text": "object that descends down and affected domain admin if I control that GPO I",
    "start": "2287830",
    "end": "2294400"
  },
  {
    "text": "control that domain admin I can do anything I want with GPO possibilities are absolutely endless so with our data",
    "start": "2294400",
    "end": "2301930"
  },
  {
    "text": "we can look at any user who belong to the domain Evans group what are the GPO that apply to any of those users",
    "start": "2301930",
    "end": "2308589"
  },
  {
    "text": "regardless of where they exist in the OU you tree also nine times out of ten we see that domain",
    "start": "2308589",
    "end": "2315160"
  },
  {
    "text": "admins don't actually belong to the same oh you so whatever GPO is applied to a domain admin is basically anybody's guess so",
    "start": "2315160",
    "end": "2324640"
  },
  {
    "text": "what we want to look at is show me who has control of any GPO that applies to a domain admin where that user is not a",
    "start": "2324640",
    "end": "2332109"
  },
  {
    "text": "domain admin and I don't really care if a DA can pop another da I can trust them to you know protect themselves sloop and",
    "start": "2332109",
    "end": "2340150"
  },
  {
    "text": "run that query and it looks like this so there's a domain object there and teal and then the GPO that are linked to the",
    "start": "2340150",
    "end": "2347589"
  },
  {
    "text": "domain head then we have four different security groups that have control of",
    "start": "2347589",
    "end": "2353920"
  },
  {
    "text": "different GPOs that apply to those das those users are not domain admins so",
    "start": "2353920",
    "end": "2360760"
  },
  {
    "text": "what if we remove those permissions or what if we change the owners of those GPIOs from some random",
    "start": "2360760",
    "end": "2366930"
  },
  {
    "text": "group back to the domain admins group you would think that this would cause",
    "start": "2366930",
    "end": "2372829"
  },
  {
    "text": "some remediation like maybe this will reduce the percentage of users that have an attack path and maybe it'll reduce",
    "start": "2372829",
    "end": "2378059"
  },
  {
    "text": "the overall number of attack paths or what if we're not talking about GPO whatever talking about deploying pause",
    "start": "2378059",
    "end": "2383849"
  },
  {
    "text": "and making domain admins log into paws or we're talking about ACLs can be abused when we started doing this we",
    "start": "2383849",
    "end": "2390450"
  },
  {
    "text": "thought I am so brilliant you are not gonna believe this I'm gonna I'm gonna make it so that domain admins only log",
    "start": "2390450",
    "end": "2397170"
  },
  {
    "text": "on the domain controllers and we're gonna see a huge reduction in the attack paths of Av so we stipulate that change",
    "start": "2397170",
    "end": "2404819"
  },
  {
    "text": "in our graph I'll say we remove those permissions and change the object owners and the GPOs so before it was 100 percent of the",
    "start": "2404819",
    "end": "2412410"
  },
  {
    "text": "users that have passed the DA we changed the data set we simulate that change before we have to put it into production",
    "start": "2412410",
    "end": "2418430"
  },
  {
    "text": "and after anybody won take a guess what the stat is after just how effective my",
    "start": "2418430",
    "end": "2423630"
  },
  {
    "text": "brilliant strategy is gonna be I never sent made absolutely no difference why",
    "start": "2423630",
    "end": "2431609"
  },
  {
    "text": "is this because the graph is extremely highly connected and there are other attack paths that we weren't seeing",
    "start": "2431609",
    "end": "2437400"
  },
  {
    "text": "because we were looking at all paths because you can't what about abusable aces what if we also",
    "start": "2437400",
    "end": "2444450"
  },
  {
    "start": "2441000",
    "end": "2468000"
  },
  {
    "text": "say okay well I'm still gonna trim those permissions in the GPOs because I want",
    "start": "2444450",
    "end": "2450690"
  },
  {
    "text": "to have this strategy of isolation from my domain admins when they still have all these other attack paths now that",
    "start": "2450690",
    "end": "2455849"
  },
  {
    "text": "rely on abusing aces on the domain admin users of the domain admins group itself",
    "start": "2455849",
    "end": "2462920"
  },
  {
    "text": "so here's an example we have our domain admins group we have those users that belong to the group inbound object",
    "start": "2462920",
    "end": "2471630"
  },
  {
    "start": "2468000",
    "end": "2488000"
  },
  {
    "text": "control if you look at the very bottom there you can see that there are three principles that have explicit control of",
    "start": "2471630",
    "end": "2477020"
  },
  {
    "text": "the domain admins group but if you unroll that out there are actually 47",
    "start": "2477020",
    "end": "2482790"
  },
  {
    "text": "different identities that have control of the group or a user in the group and",
    "start": "2482790",
    "end": "2488760"
  },
  {
    "text": "here they are so we can unroll this out and visualize what groups can control a domain admin",
    "start": "2488760",
    "end": "2495750"
  },
  {
    "text": "or control the group itself so let's get rid that let's focus on that strategy of",
    "start": "2495750",
    "end": "2502250"
  },
  {
    "text": "isolation okay so we've simulated changing gpo control for GPIOs that apply to domain",
    "start": "2502250",
    "end": "2508910"
  },
  {
    "text": "admins or computers that are used by domain admins and we've trimmed permissions inbound on the domain admin",
    "start": "2508910",
    "end": "2516320"
  },
  {
    "text": "users and on the domain admins group so before we had 100% of the users when",
    "start": "2516320",
    "end": "2521780"
  },
  {
    "text": "attack path domain admin after it's 82% we're actually making some forward",
    "start": "2521780",
    "end": "2528950"
  },
  {
    "start": "2525000",
    "end": "2536000"
  },
  {
    "text": "progress these numbers by the way are real these are real numbers from a real environment this is what's possible is",
    "start": "2528950",
    "end": "2539320"
  },
  {
    "start": "2536000",
    "end": "2637000"
  },
  {
    "text": "once you once you understand this this strategy of isolation both on the end",
    "start": "2539320",
    "end": "2546380"
  },
  {
    "text": "point of the attack path and on the possibilities for where the attack path can begin these are the local admin",
    "start": "2546380",
    "end": "2554270"
  },
  {
    "text": "rights on domain users or Kerberos table users or domain users that have RDP",
    "start": "2554270",
    "end": "2559460"
  },
  {
    "text": "access on systems that are escalated all or there's a local previs combo systems",
    "start": "2559460",
    "end": "2564790"
  },
  {
    "text": "you can whittle this down so that your attack surface is reduced all the way down to 1% or less than 1% of the users",
    "start": "2564790",
    "end": "2572600"
  },
  {
    "text": "in the directory being able to take control of a domain admin sometimes we can't get this number this low I think",
    "start": "2572600",
    "end": "2579380"
  },
  {
    "text": "the worst that we've done so far is being able to take it down to about 6 percent which is still pretty good once",
    "start": "2579380",
    "end": "2587570"
  },
  {
    "text": "you have that once you have those attack pass whittled down and you say well we can't get it any lower because there are",
    "start": "2587570",
    "end": "2594350"
  },
  {
    "text": "some business need for a domain trust or for some kind of configuration instead",
    "start": "2594350",
    "end": "2600470"
  },
  {
    "text": "of having to deploy some kind of non scalable security control so that you're",
    "start": "2600470",
    "end": "2605690"
  },
  {
    "text": "you know kind of like surveying every single computer in the environment no good because you have no idea where the",
    "start": "2605690",
    "end": "2611720"
  },
  {
    "text": "attacker is gonna go you're kind of funneling of the attacker so that they have to go through this one system they",
    "start": "2611720",
    "end": "2617090"
  },
  {
    "text": "have to go through this one user and those controls that cannot scale if it's",
    "start": "2617090",
    "end": "2622730"
  },
  {
    "text": "5 computers that I have to deploy the Windows Firewall on and configure inbound whitelisting rules I could do",
    "start": "2622730",
    "end": "2628370"
  },
  {
    "text": "that in an afternoon if I could do that for a hundred thousand computers join to AD",
    "start": "2628370",
    "end": "2633410"
  },
  {
    "text": "it's not gonna happen everything in this talk is free and opensource",
    "start": "2633410",
    "end": "2640160"
  },
  {
    "start": "2637000",
    "end": "2668000"
  },
  {
    "text": "the tools we talked about bloodhound the book on analytics tool pie review",
    "start": "2640160",
    "end": "2645320"
  },
  {
    "text": "power-mad in vogue DC sync and the methodology itself is also free and open source if you look at the bloodhound",
    "start": "2645320",
    "end": "2652070"
  },
  {
    "text": "analytics URL there you will be able to create these charts yourself and then if you look at this blog post in the top",
    "start": "2652070",
    "end": "2658100"
  },
  {
    "text": "right you'll see even more detail about understanding the difference between all",
    "start": "2658100",
    "end": "2663260"
  },
  {
    "text": "paths shortest paths and all that kind of good stuff thank you very much for",
    "start": "2663260",
    "end": "2669260"
  },
  {
    "start": "2668000",
    "end": "2683000"
  },
  {
    "text": "your time I think we have about six minutes left if we want to take questions here and then otherwise we're",
    "start": "2669260",
    "end": "2675050"
  },
  {
    "text": "gonna be out in the breakout room to the right over here thank you guys thank you",
    "start": "2675050",
    "end": "2682960"
  }
]