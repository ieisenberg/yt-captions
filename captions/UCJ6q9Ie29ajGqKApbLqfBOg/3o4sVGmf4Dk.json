[
  {
    "text": "thank you very much for showing up so early in the morning and I could understand that many of you had doubts",
    "start": "399",
    "end": "6359"
  },
  {
    "text": "about this presentation the rumor has it that Chris and I only met 48 hours ago",
    "start": "6359",
    "end": "12440"
  },
  {
    "text": "and actually that's true and both of us don't really have English-speaking names so thank you very",
    "start": "12440",
    "end": "18640"
  },
  {
    "text": "much for your courage and showing up this morning the title of our presentation is hiding in plain sight",
    "start": "18640",
    "end": "24880"
  },
  {
    "text": "and we want to discuss advances in malware covered communication channels my name is Pi Mar buau I work with Del",
    "start": "24880",
    "end": "32520"
  },
  {
    "text": "secure Works in my work I do mostly M analysis and security research and I'm",
    "start": "32520",
    "end": "39559"
  },
  {
    "text": "here with uh Chris who likes very much fancy animals and graphical design try",
    "start": "39559",
    "end": "46440"
  },
  {
    "text": "to guess who he works with but I think Chris can introduce himself a bit better than that hi",
    "start": "46440",
    "end": "52840"
  },
  {
    "text": "everybody uh my name is Chris dri uh I work for a company called crowd strike and I'm mainly doing reverse engineering",
    "start": "52840",
    "end": "58559"
  },
  {
    "text": "and Analysis of targeted attacks but um today uh we want to talk",
    "start": "58559",
    "end": "64960"
  },
  {
    "text": "about covered communication channels and especially about malware command and control now being security researchers",
    "start": "64960",
    "end": "71600"
  },
  {
    "text": "like and especially malware researchers like per Mark and and and myself uh",
    "start": "71600",
    "end": "77119"
  },
  {
    "text": "discovering a new malware family happens every now and then that's not not",
    "start": "77119",
    "end": "82200"
  },
  {
    "text": "necessarily nothing uh something new but a couple months back we were both",
    "start": "82200",
    "end": "87360"
  },
  {
    "text": "working on a Case uh which stands out about among what you usually see out",
    "start": "87360",
    "end": "93040"
  },
  {
    "text": "there in the wild and that is because we we've seen a malware which uses steganography in",
    "start": "93040",
    "end": "99360"
  },
  {
    "text": "order to hide parts of its command and control communication and at that point we decided to join forces and to work",
    "start": "99360",
    "end": "106399"
  },
  {
    "text": "together on this case and drive research on this uh most of which ended up in",
    "start": "106399",
    "end": "112560"
  },
  {
    "text": "what we're going to present in this talk apart from that we try to broaden up um",
    "start": "112560",
    "end": "119479"
  },
  {
    "text": "the objective of this talk a little bit so we will also cover a few more examples uh of malware families mware",
    "start": "119479",
    "end": "128119"
  },
  {
    "text": "samples that are out there real world mware samples um that are out there in the wild using hidden uh communication",
    "start": "128119",
    "end": "136360"
  },
  {
    "text": "methods for MW command and",
    "start": "136360",
    "end": "140519"
  },
  {
    "text": "control I knew this one let's try like this excuse me I'll",
    "start": "142040",
    "end": "147400"
  },
  {
    "text": "just try the pointer one more all right so here's the outline of this presentation as Chris mentioned uh we",
    "start": "147400",
    "end": "152760"
  },
  {
    "text": "first started working on mware that was using stenography to hide communication channels between an infected device and",
    "start": "152760",
    "end": "159560"
  },
  {
    "text": "its command and control server and during our discussions and investigation we started to realize this this was",
    "start": "159560",
    "end": "164800"
  },
  {
    "text": "actually a trend we were seeing more and more malware trying to hide the communication that they had with their command control server so in this",
    "start": "164800",
    "end": "171599"
  },
  {
    "text": "presentation we will cover mostly two topics of stenography and inconspicuous carrier",
    "start": "171599",
    "end": "178040"
  },
  {
    "text": "protocols I also want to emphasize that we really want to document cases that have been seen in the wild that we have",
    "start": "178040",
    "end": "184040"
  },
  {
    "text": "observed for real so we're not going to um make hypothesis or or try to invent",
    "start": "184040",
    "end": "190879"
  },
  {
    "text": "new communication channels that might exist because there are many more we really want to focus on real cases that",
    "start": "190879",
    "end": "196599"
  },
  {
    "text": "we have seen before going into a lot more",
    "start": "196599",
    "end": "202280"
  },
  {
    "text": "details let's first step back and look at why would maare want to",
    "start": "202280",
    "end": "208000"
  },
  {
    "text": "communicate and why why does malware need to communicate with a command and control server well first of all a",
    "start": "208000",
    "end": "214760"
  },
  {
    "text": "malware needs orders or it needs command to perform its tasks pretty much the",
    "start": "214760",
    "end": "220439"
  },
  {
    "text": "only task we could think of that would not need any kind of um communication",
    "start": "220439",
    "end": "226200"
  },
  {
    "text": "when a Comm in control server is if you are creating a destructive malware in this case the malware probably doesn't",
    "start": "226200",
    "end": "231599"
  },
  {
    "text": "need to communicate with anybody it just knows where and it reached the its Target and it will destroy it but in",
    "start": "231599",
    "end": "236920"
  },
  {
    "text": "other cases if you want for example to make Network reconnaissance then you need to interact with a M more precisely",
    "start": "236920",
    "end": "243480"
  },
  {
    "text": "you need the mare to receive command from its operators to send feedback on that command how the command was",
    "start": "243480",
    "end": "249120"
  },
  {
    "text": "executed did it succeed or not what kind of result it brought you might want to send updates for the code if you want to",
    "start": "249120",
    "end": "256199"
  },
  {
    "text": "fix uh bugs or introduce new features and finally you might be interested in",
    "start": "256199",
    "end": "261680"
  },
  {
    "text": "exfiltrated data you being the M operator of course in order for communication from",
    "start": "261680",
    "end": "268960"
  },
  {
    "text": "an infected Dev to the command control server to be efficient it needs to happen meaning that it should not be",
    "start": "268960",
    "end": "275000"
  },
  {
    "text": "blocked by any kind of security mechanism either human beings investigating a case like forensics",
    "start": "275000",
    "end": "281240"
  },
  {
    "text": "analysis or incident handlers or automatic tools like intrusion detection systems or",
    "start": "281240",
    "end": "287720"
  },
  {
    "text": "antivirus to ensure that we are all talking about the same thing here um I prepared one quick slide of definitions",
    "start": "291320",
    "end": "298280"
  },
  {
    "text": "I promise that you don't you don't need to go back to your bed right now this will only be one slide so to us covered",
    "start": "298280",
    "end": "304199"
  },
  {
    "text": "channels is the capability to transfer information Between Two Hosts which are not explicitly allowed to do so in a",
    "start": "304199",
    "end": "311479"
  },
  {
    "text": "corporate environment if a system is infected well it's probably not allowed explicitly to communicate with its command control",
    "start": "311479",
    "end": "317600"
  },
  {
    "text": "server there has been other us well there are other usage of the covered term in uh cryptography for example but",
    "start": "317600",
    "end": "324240"
  },
  {
    "text": "we this is not the case here in the context of our presentation this is how we want to use this term",
    "start": "324240",
    "end": "330319"
  },
  {
    "text": "stenography is the practice of concealing messages inside uh non-secret",
    "start": "330319",
    "end": "335400"
  },
  {
    "text": "Text data or media and what we call a carrier protocol is the underlying protocol",
    "start": "335400",
    "end": "341120"
  },
  {
    "text": "which is legitimate that can be used for command and control",
    "start": "341120",
    "end": "345960"
  },
  {
    "text": "protocol so when you think about malware communication I'm guessing that many of",
    "start": "346440",
    "end": "351800"
  },
  {
    "text": "you here have had to deal with malware cases either from an incident handling perspective or for reverse engineering",
    "start": "351800",
    "end": "357440"
  },
  {
    "text": "purposes usually when you think about we're communicating with it C2 it will be using um something maybe yeah the",
    "start": "357440",
    "end": "364240"
  },
  {
    "text": "usual will be HTTP traffic maybe using encryption maybe not so this would be your average but your average Zeus or as",
    "start": "364240",
    "end": "372400"
  },
  {
    "text": "proc cut whale this is what we think is not necessarily very",
    "start": "372400",
    "end": "378160"
  },
  {
    "text": "sophisticated and I want to um be very clear here when I'm talking about",
    "start": "378160",
    "end": "383280"
  },
  {
    "text": "sophistication I'm really only talking about the communication Channel not the malware at large or overall but really",
    "start": "383280",
    "end": "389800"
  },
  {
    "text": "the communication Channel we've seen cases that were a bit more sophisticated that were a bit more evolved uh we've",
    "start": "389800",
    "end": "395840"
  },
  {
    "text": "seen um apt28 for example using emails to send comment back probably adapting",
    "start": "395840",
    "end": "401759"
  },
  {
    "text": "their communication method to a specific environment where they really wanted to have communication between an infected",
    "start": "401759",
    "end": "406840"
  },
  {
    "text": "node and the command control server we've seen Stu net using removable drives but in both cases if a human",
    "start": "406840",
    "end": "414639"
  },
  {
    "text": "looked at the files they were probably able to figure out something weird was",
    "start": "414639",
    "end": "419800"
  },
  {
    "text": "going on what we want to discuss in this talk is something a bit more stealthy is now",
    "start": "419800",
    "end": "425960"
  },
  {
    "text": "using stenography and covered channels to hide their communication so that even humans looking at the situation will",
    "start": "425960",
    "end": "432560"
  },
  {
    "text": "have a very hard time figuring out what's going on and once again I am not saying that the cases we've analyzed",
    "start": "432560",
    "end": "438520"
  },
  {
    "text": "here are more complex or sophisticated than Stu net not at all I'm just saying that the way they communicate might",
    "start": "438520",
    "end": "446000"
  },
  {
    "text": "be now we have all these fancy terms and Def but really to be honest stenography",
    "start": "446800",
    "end": "452599"
  },
  {
    "text": "is just a cool ex excuse to look at kittens so",
    "start": "452599",
    "end": "458360"
  },
  {
    "text": "Chris do we have any malicious content hidden in here what do you think so you",
    "start": "458360",
    "end": "463919"
  },
  {
    "text": "want me to do applied steganography detection in that we are senior researchers this is what we're tasked",
    "start": "463919",
    "end": "469560"
  },
  {
    "text": "with usually I do that reverse engineering but um I don't know maybe",
    "start": "469560",
    "end": "474680"
  },
  {
    "text": "after a few beers I start seeing strange messages in that picture but right now I just see a cute little kitten and you're",
    "start": "474680",
    "end": "482159"
  },
  {
    "text": "right this is just a cute kitten there is no stenography in there just wanted to share the happy morning but how about",
    "start": "482159",
    "end": "489000"
  },
  {
    "text": "this one I don't know if you look at the same picture but that's just a bunch of servers right I mean a photo of a Reco",
    "start": "489000",
    "end": "496720"
  },
  {
    "text": "service yeah well this one is a bit tricky actually I wanted to have an example of something that we don't",
    "start": "496720",
    "end": "502759"
  },
  {
    "text": "necessarily considered to be stenography uh but actually is used by malware so this image was taken from one of the",
    "start": "502759",
    "end": "509759"
  },
  {
    "text": "Zeus kins command control server and there is something in the image let's have a deeper look when you look at the",
    "start": "509759",
    "end": "516760"
  },
  {
    "text": "header this is the hex dump of the header for this file so you see it's a JPEG with the header jfif over there but",
    "start": "516760",
    "end": "523640"
  },
  {
    "text": "the rest of the fields seem to be okay there is no HTML tags for example that we some of you might have seen yesterday",
    "start": "523640",
    "end": "529399"
  },
  {
    "text": "with the conference on stos plit it seems okay but when you scroll down and",
    "start": "529399",
    "end": "534519"
  },
  {
    "text": "look at the bottom of the file there is a base 64 encoded string appended to the image image so when a image reader",
    "start": "534519",
    "end": "542640"
  },
  {
    "text": "access this file it can render the file the image no problem you can see it and it's a Ser an",
    "start": "542640",
    "end": "549560"
  },
  {
    "text": "image of a server but at the bottom you have a configuration file it's encoded with Bas 64 and then decrypted with",
    "start": "549560",
    "end": "557360"
  },
  {
    "text": "rc6 this doesn't fit our definition of stenography because if a human looks at",
    "start": "557360",
    "end": "563399"
  },
  {
    "text": "the file they will see that there is something appended at the end they need to look at it in an exitor of course and",
    "start": "563399",
    "end": "569519"
  },
  {
    "text": "automated tools will not have a very hard time detecting this because clearly something is odd at the end the um",
    "start": "569519",
    "end": "576959"
  },
  {
    "text": "enthropy for example will not be the same at the end of the file and once you decode this config",
    "start": "576959",
    "end": "583959"
  },
  {
    "text": "this is what the configuration looks like so you have a lot of information stored into this B6 C4 string once it's",
    "start": "583959",
    "end": "590040"
  },
  {
    "text": "decrypted you have the version of the bot you have the different command control URLs what kind of information it should be stealing so this is just to",
    "start": "590040",
    "end": "597040"
  },
  {
    "text": "show you that Som hour are appending data to images but this is not exactly",
    "start": "597040",
    "end": "602120"
  },
  {
    "text": "what we consider to be stenography moving on to uh our first",
    "start": "602120",
    "end": "608680"
  },
  {
    "text": "example of malware we've seen using steganography this example is with go neverquest",
    "start": "608680",
    "end": "616040"
  },
  {
    "text": "so go neverquest um has different names so VRA is another alas of this malware",
    "start": "616279",
    "end": "622760"
  },
  {
    "text": "it appeared a long time ago in 2007 the main objective for this m is",
    "start": "622760",
    "end": "627959"
  },
  {
    "text": "banking fraud so they they're going after banking credentials and they're trying to uh make fraudulent transfer of",
    "start": "627959",
    "end": "634160"
  },
  {
    "text": "money between different accounts they do so by stealing credentials but then also installing VNC",
    "start": "634160",
    "end": "639880"
  },
  {
    "text": "plugins for example in sock proxies on Infected host so that they can control the accounts and transfer money another",
    "start": "639880",
    "end": "645920"
  },
  {
    "text": "interesting characteristic of the malware is that it very often deletes the browser history whenever it manages",
    "start": "645920",
    "end": "651040"
  },
  {
    "text": "to infect a computer to remove anything that uh might lead to the infection Vector for the",
    "start": "651040",
    "end": "658040"
  },
  {
    "text": "malware the real communication or the main",
    "start": "658040",
    "end": "663639"
  },
  {
    "text": "Communication channel used by gozi is what I would call standard or or it",
    "start": "663639",
    "end": "669519"
  },
  {
    "text": "doesn't fit the sophistication layer of stenography the standard way goes in",
    "start": "669519",
    "end": "675000"
  },
  {
    "text": "infected host will communicate with its command control server is using HTTP posts and it's going to use lcg",
    "start": "675000",
    "end": "680720"
  },
  {
    "text": "cryptography with ap lib compression so so far this is not really a good candidate for our presentation but",
    "start": "680720",
    "end": "688079"
  },
  {
    "text": "earlier this year gozi started to use a cover Channel and",
    "start": "688079",
    "end": "694279"
  },
  {
    "text": "they added the capability for stenography in the beginning of 2015 the way the malare does it is by um",
    "start": "694279",
    "end": "702360"
  },
  {
    "text": "downloading a file called five icon. Ico and these are the little images that you",
    "start": "702360",
    "end": "707639"
  },
  {
    "text": "see on pretty much every web server these days that are giving you a small icon to represent the website when",
    "start": "707639",
    "end": "712680"
  },
  {
    "text": "you're saving it as a browser uh bookmark for example GOI will download this five icon",
    "start": "712680",
    "end": "720120"
  },
  {
    "text": "over SSL from a Tor node using the tor2 web service it will then extract the least",
    "start": "720120",
    "end": "727320"
  },
  {
    "text": "significant bit from each pixel in that file decrypt it using rc4 and retrieve",
    "start": "727320",
    "end": "733560"
  },
  {
    "text": "backup servers so the cover channel is only used as a backup mechanism when the",
    "start": "733560",
    "end": "739160"
  },
  {
    "text": "infected host cannot communicate with its common control server anymore it will try to use this cover channel to",
    "start": "739160",
    "end": "745279"
  },
  {
    "text": "gain connection back to its command control server so for those of you who are not very",
    "start": "745279",
    "end": "751120"
  },
  {
    "text": "familiar with the um least significant bits technography here is a quick diagram of how this works if you want to",
    "start": "751120",
    "end": "759000"
  },
  {
    "text": "hide information inside an image you can um basically change some of the information that is encoded with every",
    "start": "759000",
    "end": "765240"
  },
  {
    "text": "color so when you're parsing a file you look at every pixel and in the case of least",
    "start": "765240",
    "end": "771600"
  },
  {
    "text": "significant bit signography you can alter the last bit and flip it to fit",
    "start": "771600",
    "end": "777600"
  },
  {
    "text": "with the message you want to transmit and in this case the change are so small the changes are so small that they are",
    "start": "777600",
    "end": "783399"
  },
  {
    "text": "very hard to see by the human eye so we see here that we have a first orange pixel and you can start encoding four",
    "start": "783399",
    "end": "790079"
  },
  {
    "text": "bits in it 1101 etc etc what's interesting to note here is",
    "start": "790079",
    "end": "797320"
  },
  {
    "text": "that actually you will be encoding you have some limits in the size of the data you can encode inside this image",
    "start": "797320",
    "end": "803079"
  },
  {
    "text": "compared to the size of the image itself so coming back to GOI",
    "start": "803079",
    "end": "809279"
  },
  {
    "text": "GOI uses Le significant bits signography to uh download F ion. Ico file it then",
    "start": "809279",
    "end": "815839"
  },
  {
    "text": "strips out the other doesn't care about the header then extracts a configuration file which is signed so we have the",
    "start": "815839",
    "end": "822000"
  },
  {
    "text": "white Mark at the top of the middle box here and from from there it extracts a",
    "start": "822000",
    "end": "827399"
  },
  {
    "text": "list of backup command control server actually just the domain names for these servers that they will contact when they",
    "start": "827399",
    "end": "833639"
  },
  {
    "text": "lose contact with the main server and this is what we see in this he X dump of the decrypted config configuration file",
    "start": "833639",
    "end": "839320"
  },
  {
    "text": "for go neverquest moving to the second example of M using",
    "start": "839320",
    "end": "847160"
  },
  {
    "text": "stenography this mare is called lurk so let's see if we've learned anything",
    "start": "847160",
    "end": "852399"
  },
  {
    "text": "about this uh stenography thing how about this one and no the slide is not",
    "start": "852399",
    "end": "858279"
  },
  {
    "text": "broken oh yet another test oh yes yet another stogy I want to make sure you don't fall asleep it's a wide slide I",
    "start": "858279",
    "end": "864800"
  },
  {
    "text": "mean you know there can't be anything in there oddly enough there is lurk is",
    "start": "864800",
    "end": "871320"
  },
  {
    "text": "hiding some data in a bmps that are usually look like this they're",
    "start": "871320",
    "end": "876519"
  },
  {
    "text": "completely white so lurk is a our family um that was first discovered last year",
    "start": "876519",
    "end": "883160"
  },
  {
    "text": "and documented last year it's a downloader so it's used uh to install click for malware so by itself lur only",
    "start": "883160",
    "end": "890839"
  },
  {
    "text": "downloads and install more malicious stuff on Infected hosts but to retrieve",
    "start": "890839",
    "end": "896000"
  },
  {
    "text": "the URL of the mare it wants to download it will actually download a BMP image",
    "start": "896000",
    "end": "901440"
  },
  {
    "text": "and extract the least significant bit information from each pixel and to retrieve the the URL after",
    "start": "901440",
    "end": "908920"
  },
  {
    "text": "some basic xor en coding for the payload it's interesting to to note here",
    "start": "908920",
    "end": "914839"
  },
  {
    "text": "that the mare author didn't even take the time to use nice Graphics or or even",
    "start": "914839",
    "end": "921000"
  },
  {
    "text": "cats maybe but they just kept the white images lurk also uses techn",
    "start": "921000",
    "end": "929199"
  },
  {
    "text": "for hiding code of its modules that it that come bundled with the main binary",
    "start": "929199",
    "end": "935600"
  },
  {
    "text": "so there are a couple images inside the resources of the PE file that contain",
    "start": "935600",
    "end": "941040"
  },
  {
    "text": "code but this code is also encoded uh inside images but in this case it is",
    "start": "941040",
    "end": "946959"
  },
  {
    "text": "very visible by the human eye so it's not exactly fitting our definition of stenography but still this is another",
    "start": "946959",
    "end": "952720"
  },
  {
    "text": "example of malware in the wild that has been seen last year actually using stenography to hide communication",
    "start": "952720",
    "end": "960399"
  },
  {
    "text": "moving into the case that we quickly mentioned during the introduction sto loer",
    "start": "960399",
    "end": "967120"
  },
  {
    "text": "um you like Bears don't you that's a fancy bear that's a fancy bear so is",
    "start": "967120",
    "end": "973480"
  },
  {
    "text": "there um do you think that there's anything hidden in this in this image I would be tempted to say no but",
    "start": "973480",
    "end": "980800"
  },
  {
    "text": "you know I learned so this time I say maybe maybe actually you're right you",
    "start": "980800",
    "end": "988560"
  },
  {
    "text": "know your animals so that's very good um in this image this is one of the examples of images that are used by stle",
    "start": "988560",
    "end": "995600"
  },
  {
    "text": "loer to hide content this is actually a PNG image ster is an information stealer we",
    "start": "995600",
    "end": "1003199"
  },
  {
    "text": "first started uh seeing incidents involving this m at the beginning of this",
    "start": "1003199",
    "end": "1008800"
  },
  {
    "text": "year the component of the M that uses stenography is the downloader module so this is the first executable that will",
    "start": "1008800",
    "end": "1016079"
  },
  {
    "text": "uh start executing on a machine and this downloader module is used to spot",
    "start": "1016079",
    "end": "1021639"
  },
  {
    "text": "analysis environment only execute if the M thinks that it is running on a real machine and",
    "start": "1021639",
    "end": "1028280"
  },
  {
    "text": "not inside any kind of analysis environment it then downloads an image from a legitimate website and this is",
    "start": "1028280",
    "end": "1034558"
  },
  {
    "text": "something new extract the main module code from the image so compared to lurk",
    "start": "1034559",
    "end": "1040199"
  },
  {
    "text": "and gozy which we're extracting on the URLs from the images in this case theer extracts code x 86 code from the image",
    "start": "1040199",
    "end": "1048120"
  },
  {
    "text": "and then directly launch the main module code from memory so the images don't touch dis and the code for the main",
    "start": "1048120",
    "end": "1054720"
  },
  {
    "text": "module never touches the dis either what the mare does once it's",
    "start": "1054720",
    "end": "1060280"
  },
  {
    "text": "running once the main module is running is that it will create a pretty verbos",
    "start": "1060280",
    "end": "1065480"
  },
  {
    "text": "profile of the infected host it will try to list its characteristics and we will see a bit more details on that later",
    "start": "1065480",
    "end": "1071039"
  },
  {
    "text": "depending on the characteristics of the infected host the mare uh operator will",
    "start": "1071039",
    "end": "1076159"
  },
  {
    "text": "push different modules that will be executed",
    "start": "1076159",
    "end": "1081600"
  },
  {
    "text": "afterward the infection Vector for ster is a bit odd um the infection Vector",
    "start": "1081760",
    "end": "1087720"
  },
  {
    "text": "that we've seen are actually the files are downloaded from websites pretending to be delivering key generators or or",
    "start": "1087720",
    "end": "1093640"
  },
  {
    "text": "crack software that are used to bypass um well to crack software basically and",
    "start": "1093640",
    "end": "1101280"
  },
  {
    "text": "uh some of the these websites are actually delivering new variants of the M every day and once you start the executable",
    "start": "1101280",
    "end": "1109720"
  },
  {
    "text": "that you downloaded from this crack site you have a UI for a real key generator",
    "start": "1109720",
    "end": "1114960"
  },
  {
    "text": "with a nice 16 bit music so if you've analyzed it you will remember that uh but also it drops a copy of sto order",
    "start": "1114960",
    "end": "1121120"
  },
  {
    "text": "that starts executing some of you might also be interested by the detail that these websites also always have a capture so",
    "start": "1121120",
    "end": "1128240"
  },
  {
    "text": "whenever you want to download a file you need to solve one of the capture so either this is to slow down automatic",
    "start": "1128240",
    "end": "1134159"
  },
  {
    "text": "crawlers trying to fetch the files I'm not sure coming back to our bare image and",
    "start": "1134159",
    "end": "1139400"
  },
  {
    "text": "this stenography um ster actually extracts a least significant bit information from",
    "start": "1139400",
    "end": "1146520"
  },
  {
    "text": "PNG images so we have our picture here at the bottom of this diagram we have the LSB extraction then the mware uh the",
    "start": "1146520",
    "end": "1153640"
  },
  {
    "text": "code is going to be decrypted using rc4 there is some uh validation done also",
    "start": "1153640",
    "end": "1158799"
  },
  {
    "text": "with a crc32 at the beginning of the encrypted uh block of data and then we end up with code that is going to be",
    "start": "1158799",
    "end": "1165360"
  },
  {
    "text": "executed directly from memory so I know you like animals but I also",
    "start": "1165360",
    "end": "1171799"
  },
  {
    "text": "like nice sceneries so what do you think about this one there's no cut in there there's no be in there but I still say",
    "start": "1171799",
    "end": "1177880"
  },
  {
    "text": "yes there's something in there you're learning you're learning you're good this is another example of images used by sto loader I actually downloaded",
    "start": "1177880",
    "end": "1184280"
  },
  {
    "text": "hundreds of them and they're all different but they're all nice to look at so I'm sharing this with you stolder",
    "start": "1184280",
    "end": "1190760"
  },
  {
    "text": "has a lot of interesting characteristics it um has many tricks to",
    "start": "1190760",
    "end": "1196880"
  },
  {
    "text": "find to identif ify analysis environments both automated and uh the",
    "start": "1196880",
    "end": "1202000"
  },
  {
    "text": "tools that might be used by researchers the first one it uses is to resolve what I call funky Imports so in different or",
    "start": "1202000",
    "end": "1209480"
  },
  {
    "text": "in specific analysis environments for example antivirus emulators or sandboxes um some features are added so",
    "start": "1209480",
    "end": "1218360"
  },
  {
    "text": "there might be for example functions that will be resolved inside um standard",
    "start": "1218360",
    "end": "1223400"
  },
  {
    "text": "DLS that will resolve inside that will resolve in an analysis environment but",
    "start": "1223400",
    "end": "1228640"
  },
  {
    "text": "that will not resolve on a real system so on the example I have here and I know it's a bit small but I'm I trust that",
    "start": "1228640",
    "end": "1234360"
  },
  {
    "text": "you can read it on the slides you can download from the website the malware tries to resolve the import MP start",
    "start": "1234360",
    "end": "1241080"
  },
  {
    "text": "process from KL 32.dll this ex this is not a function that is",
    "start": "1241080",
    "end": "1248080"
  },
  {
    "text": "exported by K 32.dll on a standard system but in some environment it is so",
    "start": "1248080",
    "end": "1253600"
  },
  {
    "text": "the malare if it achieves to resolve this import by calling get proc address it directly exits so it won't show any",
    "start": "1253600",
    "end": "1261640"
  },
  {
    "text": "other Behavior it won't do anything else it won't decrypt itself to execute so it will just stop executing so this is one",
    "start": "1261640",
    "end": "1268640"
  },
  {
    "text": "the first trick used to identify analysis environment stolder also uh closely",
    "start": "1268640",
    "end": "1275320"
  },
  {
    "text": "monitors where the pointer uh of the mouse is on the screen trying to ensure that a user is really playing with the",
    "start": "1275320",
    "end": "1282200"
  },
  {
    "text": "system when it's being uh when it's executing this is done by calling the get cursor post function",
    "start": "1282200",
    "end": "1289039"
  },
  {
    "text": "but the M doesn't call it once or twice it actually calls it in an infinite Loop until the mouse moves but if the mouse",
    "start": "1289039",
    "end": "1296880"
  },
  {
    "text": "moves too fast meaning that if it jumps in different position they also stop execution and will never execute again",
    "start": "1296880",
    "end": "1302840"
  },
  {
    "text": "so the the guys that did this uh malware really want to make sure that it only executes on their target and not",
    "start": "1302840",
    "end": "1309400"
  },
  {
    "text": "necessarily when some researcher or some sandbox is running this malare strings in the binaries are",
    "start": "1309400",
    "end": "1315919"
  },
  {
    "text": "constructed dynamically so the characters are pushed on the are moved on the stack before using the strings so",
    "start": "1315919",
    "end": "1321360"
  },
  {
    "text": "that if you're running strings for example on the binary you pretty much won't find anything and finally the M",
    "start": "1321360",
    "end": "1326960"
  },
  {
    "text": "also lists the processes that are running on the machine when the m is executing so if there is a network",
    "start": "1326960",
    "end": "1332760"
  },
  {
    "text": "traffic capture uh program running or if there is um something like",
    "start": "1332760",
    "end": "1337799"
  },
  {
    "text": "procmon any kind of debugger wind dbg a dbg the M will stop executing directly",
    "start": "1337799",
    "end": "1343679"
  },
  {
    "text": "without executing any kind of malicious behavior",
    "start": "1343679",
    "end": "1349600"
  },
  {
    "text": "interestingly enough the maare also has a lot of debugging uh messages or",
    "start": "1349600",
    "end": "1355279"
  },
  {
    "text": "debugging facilities embedded inside it using a different command control server",
    "start": "1355279",
    "end": "1360520"
  },
  {
    "text": "than its main command control server stolder sends status messages or",
    "start": "1360520",
    "end": "1365880"
  },
  {
    "text": "debug messages to a server that is different using strings like this one shown in this example and it will",
    "start": "1365880",
    "end": "1372520"
  },
  {
    "text": "actually report every stage of its execution once it's passed the check for analysis machines so it will say yep I",
    "start": "1372520",
    "end": "1379279"
  },
  {
    "text": "was able to allocate a page of memory okay I will download an image oh yeah the size is okay yeah the it is",
    "start": "1379279",
    "end": "1384799"
  },
  {
    "text": "consistent I'm able to load a GDI plus library that will be used to actually process the PNG afterward does it also",
    "start": "1384799",
    "end": "1392760"
  },
  {
    "text": "report if it's a beautiful image or not or it doesn't have a lot of taste right now but uh yeah it's a good question no",
    "start": "1392760",
    "end": "1399200"
  },
  {
    "text": "no not yet but I find it really odd that I just told you about all these checks and how stealthy the m is and then when",
    "start": "1399200",
    "end": "1406120"
  },
  {
    "text": "it it starts running it spits out pretty much everything exactly what it is",
    "start": "1406120",
    "end": "1412039"
  },
  {
    "text": "doing and we had a couple theories about this yeah we thought about this why is that the case why does it make sense for",
    "start": "1412039",
    "end": "1418480"
  },
  {
    "text": "a very complicated malware to have this kind of reporting Channel and um so I",
    "start": "1418480",
    "end": "1424120"
  },
  {
    "text": "mean of course if you if you design or if you write very complex software you have to have debug output or debug",
    "start": "1424120",
    "end": "1430200"
  },
  {
    "text": "reporting at some point so that makes sense but why do you leave it in there for you know for for long running",
    "start": "1430200",
    "end": "1436880"
  },
  {
    "text": "campaigns and I think we have like two hypothesis right yeah so I first our",
    "start": "1436880",
    "end": "1443200"
  },
  {
    "text": "first hypothesis was that maybe this is an affiliate program maybe the guy uh maybe the people operating this mare",
    "start": "1443200",
    "end": "1449559"
  },
  {
    "text": "want to get paid whenever the mare is running so they want to know exactly where it's running how it's doing so that they can collect the money somehow",
    "start": "1449559",
    "end": "1456799"
  },
  {
    "text": "but um yeah we were still not sure about this the other one would be that the operator is a different entity than the",
    "start": "1456799",
    "end": "1463880"
  },
  {
    "text": "programmer and in this case the programmer is allowed to receive debug information but they are not allowed to",
    "start": "1463880",
    "end": "1469960"
  },
  {
    "text": "access the command control infrastructure used by the operator where stolen data can reside or when",
    "start": "1469960",
    "end": "1475559"
  },
  {
    "text": "more spe or where more specific data can",
    "start": "1475559",
    "end": "1479679"
  },
  {
    "text": "reside so this is a bit more of a complete explanation how St loer works",
    "start": "1481240",
    "end": "1487159"
  },
  {
    "text": "so we were telling you about the deployment module that downloads the image and starts the main module once the main module",
    "start": "1487159",
    "end": "1493880"
  },
  {
    "text": "executes it will um create a profile of the infected host send it to the server",
    "start": "1493880",
    "end": "1499399"
  },
  {
    "text": "and then try to uh download new modules as they are decided by the um oper by",
    "start": "1499399",
    "end": "1505919"
  },
  {
    "text": "the command control server the different modules that we have observed so far are the there is one module used for",
    "start": "1505919",
    "end": "1512399"
  },
  {
    "text": "geolocation so trying to identify where the host is located based on its IP",
    "start": "1512399",
    "end": "1517640"
  },
  {
    "text": "there's a module that is used to list recently open documents by looking at the folder uh recently opened documents",
    "start": "1517640",
    "end": "1523559"
  },
  {
    "text": "in Windows and following all the links there's a password sealer module which is a recompiled version of the pony",
    "start": "1523559",
    "end": "1529760"
  },
  {
    "text": "loader and finally an Ida stealing module so if the malare finds that there",
    "start": "1529760",
    "end": "1535120"
  },
  {
    "text": "is Ida installed on the host they will send specific code to grab all the Ida",
    "start": "1535120",
    "end": "1542120"
  },
  {
    "text": "folder the Ida key the executable the installer the plugins any code you might have in there and they will send it out",
    "start": "1542120",
    "end": "1548159"
  },
  {
    "text": "to send space I'm pretty sure there are other modules dependent on other",
    "start": "1548159",
    "end": "1554360"
  },
  {
    "text": "characteristics of an infected host but these are the ones that we've seen what's really odd is that we've also",
    "start": "1554360",
    "end": "1559640"
  },
  {
    "text": "seen some other payloads being delivered as binary uh as binaries as PES that would be executed on the on the machine",
    "start": "1559640",
    "end": "1566440"
  },
  {
    "text": "for example we've seen some vundu samples or pmup which are more like click fraud malware and we don't know if",
    "start": "1566440",
    "end": "1573360"
  },
  {
    "text": "this is part of the monetization for this m or if it is just a distraction so that people wouldn't really pay attention too much to the m",
    "start": "1573360",
    "end": "1580840"
  },
  {
    "text": "itself so the monetization in this case is still a bit of a puzzle to",
    "start": "1580840",
    "end": "1586600"
  },
  {
    "text": "us what's also interesting is just like gozi stle loer actually communicates um",
    "start": "1586600",
    "end": "1592960"
  },
  {
    "text": "with its main command control server in a way that we do not consider to be very stealthy or very sophisticated I mean it",
    "start": "1592960",
    "end": "1600039"
  },
  {
    "text": "took a while to analyze but it's still relatively standard HTTP posts with rc4",
    "start": "1600039",
    "end": "1605480"
  },
  {
    "text": "encryption and then you have different messages that are being sent many of them are in Json format some of the data",
    "start": "1605480",
    "end": "1612480"
  },
  {
    "text": "in there is encoded with B 64 If the message is uh bigger than 0 X200 bytes",
    "start": "1612480",
    "end": "1619080"
  },
  {
    "text": "it will be compressed with lzma so this is more of a standard communication protocol that we would",
    "start": "1619080",
    "end": "1625080"
  },
  {
    "text": "see one of the interesting aspects to mention there maybe one of the interesting aspects is that the rc4 keys",
    "start": "1625080",
    "end": "1631799"
  },
  {
    "text": "are actually uh they vary over time and they are hardcoded in the binary so they are not derived from the messages or",
    "start": "1631799",
    "end": "1638679"
  },
  {
    "text": "from you know some environmental properties uh but they're just changed regularly and hardcoded in the",
    "start": "1638679",
    "end": "1645480"
  },
  {
    "text": "distributed uh binaries or in the distributed code uh via the images very good point",
    "start": "1645480",
    "end": "1652720"
  },
  {
    "text": "thanks we've also realized that actually um the way that different",
    "start": "1652720",
    "end": "1658799"
  },
  {
    "text": "modules are being pushed on to infected host kind of uh is organized in",
    "start": "1658799",
    "end": "1664960"
  },
  {
    "text": "scenarios so you will usually have a first interaction with the command control server where you will have for",
    "start": "1664960",
    "end": "1670399"
  },
  {
    "text": "example send CIS info so the server will ask the infected host to send a list of cism information so you will have the",
    "start": "1670399",
    "end": "1677120"
  },
  {
    "text": "name of the processor the name of the graphic called adapter system uh the version of the operating system then you",
    "start": "1677120",
    "end": "1684000"
  },
  {
    "text": "might have a uh another request to send a list of infected software of software",
    "start": "1684000",
    "end": "1689480"
  },
  {
    "text": "sorry and then depending on this first information you will have another scenario or another set of interaction",
    "start": "1689480",
    "end": "1695880"
  },
  {
    "text": "where we will have the different modules being pushed one after the other and at the end you all well in all the cases",
    "start": "1695880",
    "end": "1702399"
  },
  {
    "text": "we've seen we the infected host receives the kill command and at that point there",
    "start": "1702399",
    "end": "1708000"
  },
  {
    "text": "is no persistence there is nothing left on this system the M simply stops executing and and it's gone and that's",
    "start": "1708000",
    "end": "1716960"
  },
  {
    "text": "it all right so now we had nice animals we had nice sceneries with winter",
    "start": "1717360",
    "end": "1723799"
  },
  {
    "text": "mountains how about this one I'm giving up I'm giving up ask the audience what do they think do you think that there is",
    "start": "1723799",
    "end": "1730760"
  },
  {
    "text": "any stol Lo U data or code being hidden in this image who says yes",
    "start": "1730760",
    "end": "1737919"
  },
  {
    "text": "is there yes yes yes yes I think the majority is right yes",
    "start": "1737919",
    "end": "1743159"
  },
  {
    "text": "there is so this is another example of the images being used by by ster and and in fact I don't know exactly where they",
    "start": "1743159",
    "end": "1749840"
  },
  {
    "text": "they are taking all these images so just to to wrap up the stenography part of this presentation as",
    "start": "1749840",
    "end": "1757159"
  },
  {
    "text": "a summary uh we've seen three recent cases of maare using stenography in real life they all use least significant bits",
    "start": "1757159",
    "end": "1764279"
  },
  {
    "text": "stenography which is interesting on the other hand and the three of them use different file formats",
    "start": "1764279",
    "end": "1769559"
  },
  {
    "text": "so I Ico BMP and PNG they all use some kind of encoding",
    "start": "1769559",
    "end": "1774600"
  },
  {
    "text": "two of them use rc4 and one is using custom encoding what's very important to note is that stenography by itself is",
    "start": "1774600",
    "end": "1782399"
  },
  {
    "text": "not a very good way of exchanging information between an infected host and a command control server there needs to",
    "start": "1782399",
    "end": "1788799"
  },
  {
    "text": "be other technology to uh use and this is what M are operators are doing right now and that is compression and",
    "start": "1788799",
    "end": "1796320"
  },
  {
    "text": "encryption yeah one thing to add there maybe is that the uh all of those use lossless",
    "start": "1796320",
    "end": "1802919"
  },
  {
    "text": "compressions in in the image formats and that's a pretty important point if you use or if you try to rely on",
    "start": "1802919",
    "end": "1809559"
  },
  {
    "text": "steganography um yeah because if the if the compression is lossy then you might",
    "start": "1809559",
    "end": "1814960"
  },
  {
    "text": "end up decoding uh the wrong payload or yeah the wrong data from what you",
    "start": "1814960",
    "end": "1820120"
  },
  {
    "text": "originally intended to have encoded in that image abolutely moving on to C cover Comm a channels",
    "start": "1820120",
    "end": "1828399"
  },
  {
    "text": "thanks P Mar okay so up to this point we have only looked at steganography as",
    "start": "1828399",
    "end": "1835000"
  },
  {
    "text": "hidden uh command U command and control communication uh but now we want to take",
    "start": "1835000",
    "end": "1840440"
  },
  {
    "text": "a look at a few other examples of how you can hide um mware command control",
    "start": "1840440",
    "end": "1846240"
  },
  {
    "text": "communication so I have an example up here um basically two examples those are",
    "start": "1846240",
    "end": "1851440"
  },
  {
    "text": "two DNS responses the one in the upper half of the slide in given in Black that",
    "start": "1851440",
    "end": "1857240"
  },
  {
    "text": "that's a typical DNS response as you know you would expect basically what it",
    "start": "1857240",
    "end": "1862799"
  },
  {
    "text": "does DNS basically Maps domains to IP addresses and that's what we see in there as well someone was asking what's",
    "start": "1862799",
    "end": "1868159"
  },
  {
    "text": "the ipv4 address of the domain new community bank.com and in the answer",
    "start": "1868159",
    "end": "1874000"
  },
  {
    "text": "section you see this maps to an IP address uh 7454",
    "start": "1874000",
    "end": "1879720"
  },
  {
    "text": "8253 and it also has a time to live um associated with it in this case uh that",
    "start": "1879720",
    "end": "1885880"
  },
  {
    "text": "time to live is one day in the lower part however this looks",
    "start": "1885880",
    "end": "1891720"
  },
  {
    "text": "this looks a bit suspicious this does not look like a typical uh DNS request",
    "start": "1891720",
    "end": "1896799"
  },
  {
    "text": "but then again DNS is flexible you can do all kinds of stuff with DNS but if we take this this response apart there's a",
    "start": "1896799",
    "end": "1904519"
  },
  {
    "text": "few things that you know stick out first of all the query domain name is quite long and it ends in",
    "start": "1904519",
    "end": "1911159"
  },
  {
    "text": "google.com well there's a lot of Google services out there and you know who",
    "start": "1911159",
    "end": "1916480"
  },
  {
    "text": "knows this could be machine to machine communication so could be but the next thing that sticks out is the resource",
    "start": "1916480",
    "end": "1922679"
  },
  {
    "text": "record type of that query is set to any and that basically means give me any",
    "start": "1922679",
    "end": "1928679"
  },
  {
    "text": "resource record that you have for that given domain name and in the answer section we see that the server actually",
    "start": "1928679",
    "end": "1935960"
  },
  {
    "text": "responds with a txt record um that's that's here and in that resource record",
    "start": "1935960",
    "end": "1942080"
  },
  {
    "text": "we have a set of uh or a text string basically um and what's also interesting",
    "start": "1942080",
    "end": "1949559"
  },
  {
    "text": "is that the time to live for that DNS response uh is zero which basically means that response is not supposed to",
    "start": "1949559",
    "end": "1956559"
  },
  {
    "text": "be CED in any kind of DNS resolvers so at that point this looks suspicious and",
    "start": "1956559",
    "end": "1962120"
  },
  {
    "text": "I can tell you that much this lower part DNS response was caused by a botn net which uses DNS as a carrier protocol um",
    "start": "1962120",
    "end": "1970000"
  },
  {
    "text": "for its Commander control but before going into that example uh in depth let's step back back",
    "start": "1970000",
    "end": "1977240"
  },
  {
    "text": "for a moment and think about why would it make sense to use DNS as a carrier protocol for command and control well",
    "start": "1977240",
    "end": "1983600"
  },
  {
    "text": "first of all there's no specific detection for the DNS protocol now don't",
    "start": "1983600",
    "end": "1988880"
  },
  {
    "text": "get me wrong I know there are several dns-based protection means out there but",
    "start": "1988880",
    "end": "1994440"
  },
  {
    "text": "what they basically do is they apply blacklisting or wh listing and that means they target on the domain names",
    "start": "1994440",
    "end": "2001799"
  },
  {
    "text": "that are resolved via DNS and possibly also on the IP addresses that are",
    "start": "2001799",
    "end": "2007559"
  },
  {
    "text": "returned but they rarely Target the DNS traffic in general so for example if",
    "start": "2007559",
    "end": "2014000"
  },
  {
    "text": "you're talking syntactically valid DNS uh with third party resolvers uh on the",
    "start": "2014000",
    "end": "2019399"
  },
  {
    "text": "internet that's that's often allowed um for example Google public DNS or open",
    "start": "2019399",
    "end": "2024720"
  },
  {
    "text": "DNS there are several of these and that's sometimes even allowed in let's say heavily firewalled environments uh",
    "start": "2024720",
    "end": "2031679"
  },
  {
    "text": "so in environments that try to restrict communication but they do allow DNS to",
    "start": "2031679",
    "end": "2037240"
  },
  {
    "text": "go through they do even allow DNS to go through to third party resolvers and from the perspective of a",
    "start": "2037240",
    "end": "2044760"
  },
  {
    "text": "of a malware operator DNS has a few advantages and one of those being that it is designed as a distributed system",
    "start": "2044760",
    "end": "2052079"
  },
  {
    "text": "and that provides an advantage to the malware operator because distributed systems are typically much harder to to",
    "start": "2052079",
    "end": "2059040"
  },
  {
    "text": "take down than a centralized one all right let's look back at the",
    "start": "2059040",
    "end": "2064760"
  },
  {
    "text": "example that I just presented basically that initial request I showed you is from a bot that's called feeder bot uh",
    "start": "2064760",
    "end": "2072158"
  },
  {
    "text": "which has which we discovered in 2010 actually so it has been around for more than 5 years we called it feeder bot",
    "start": "2072159",
    "end": "2079358"
  },
  {
    "text": "back then based on a characteristic string in the binary um and you know it has this fancy",
    "start": "2079359",
    "end": "2086720"
  },
  {
    "text": "command control uh Channel but regarding monetization it basically just does add",
    "start": "2086720",
    "end": "2093760"
  },
  {
    "text": "or or click fr it implements a covered Channel via DNS",
    "start": "2093760",
    "end": "2100640"
  },
  {
    "text": "and that by itself it is not not really something new that has been presented in",
    "start": "2100640",
    "end": "2105760"
  },
  {
    "text": "the past many times but if you're actually faced with a question or with with a task of implementing such a",
    "start": "2105760",
    "end": "2111520"
  },
  {
    "text": "covered Channel you're basically facing several decisions that you have to make and it's interesting to see how exactly",
    "start": "2111520",
    "end": "2118960"
  },
  {
    "text": "uh the malware authors faced these or solved these and and designed the whole the whole",
    "start": "2118960",
    "end": "2125240"
  },
  {
    "text": "marware for example they have several query domain schemes one of those is",
    "start": "2125240",
    "end": "2131160"
  },
  {
    "text": "that they're using legitimate domains like well-known domains like that google.com example that I that I",
    "start": "2131160",
    "end": "2136760"
  },
  {
    "text": "presented earlier and that requires that that they either have control over the",
    "start": "2136760",
    "end": "2143040"
  },
  {
    "text": "Zone information for that for those domains which is unlikely in the example of Google or and that's what they did in",
    "start": "2143040",
    "end": "2150319"
  },
  {
    "text": "the example they direct these requests to their own set of DNS servers and that",
    "start": "2150319",
    "end": "2156200"
  },
  {
    "text": "makes it a challenge for forensics uh because if you just see the DNS requests",
    "start": "2156200",
    "end": "2161640"
  },
  {
    "text": "or responses without the information where this request uh went to or who who",
    "start": "2161640",
    "end": "2167280"
  },
  {
    "text": "answered that request uh it's hard to tell if it's legit or if it's uh",
    "start": "2167280",
    "end": "2173960"
  },
  {
    "text": "malicious um they are making use of a distributed",
    "start": "2173960",
    "end": "2179480"
  },
  {
    "text": "infrastruct infrastructure but they are not using the inherent features of DNS",
    "start": "2179480",
    "end": "2184880"
  },
  {
    "text": "which is also interesting now I'll get to that uh in a second but I can tell you that much their infrastructure is",
    "start": "2184880",
    "end": "2191079"
  },
  {
    "text": "spread over multiple autonomous systems so they they are pretty aware that a distributed infrastructure is is harder",
    "start": "2191079",
    "end": "2197760"
  },
  {
    "text": "to take down now let's take a a bit of a closer look at uh how this responses or this",
    "start": "2197760",
    "end": "2206680"
  },
  {
    "text": "request and the response are made up or built up so in the bootstrapping phase that's",
    "start": "2206680",
    "end": "2213319"
  },
  {
    "text": "what that's the early requests that the mware sends out it basically asks um for",
    "start": "2213319",
    "end": "2219480"
  },
  {
    "text": "for more C2 C2 servers or second stage uh C2 servers and it does that and it in",
    "start": "2219480",
    "end": "2225560"
  },
  {
    "text": "includes in the request a system dependent B ID which is this uh 50 byte",
    "start": "2225560",
    "end": "2231520"
  },
  {
    "text": "or 50 character U string that you see up there and that is used to encrypt uh the",
    "start": "2231520",
    "end": "2238119"
  },
  {
    "text": "response by the server if we take a look at the uh decrypted uh response that's",
    "start": "2238119",
    "end": "2245560"
  },
  {
    "text": "given as a hex stamp here here down here then um we basically see that there is",
    "start": "2245560",
    "end": "2250960"
  },
  {
    "text": "an IP address as an asky string in there and that IP address is used as the next stage C2 server that the malare then",
    "start": "2250960",
    "end": "2258079"
  },
  {
    "text": "contacts in order to get more information about its tasking so to sum up it contains a",
    "start": "2258079",
    "end": "2264640"
  },
  {
    "text": "referral to the next C2 server node um which is at the IP address that's on the",
    "start": "2264640",
    "end": "2271680"
  },
  {
    "text": "slide now there's a few more uh elements in that response and and it's",
    "start": "2271680",
    "end": "2277520"
  },
  {
    "text": "interesting to see how it actually builds up the second stage C2 request",
    "start": "2277520",
    "end": "2283400"
  },
  {
    "text": "now on the top we have that same referral in decrypted form as I showed on the previous slide and at the bottom",
    "start": "2283400",
    "end": "2289400"
  },
  {
    "text": "right here we have uh the sub the subsequent or the second stage C2 request so to say and I'll walk you",
    "start": "2289400",
    "end": "2296640"
  },
  {
    "text": "through how it builds up this second stage C2 request there's three dwords in",
    "start": "2296640",
    "end": "2302640"
  },
  {
    "text": "that decrypted um referral response and two asky string and the interesting stuff is that the",
    "start": "2302640",
    "end": "2308839"
  },
  {
    "text": "first dword the one marked in with a blue background that is used as a subdomain",
    "start": "2308839",
    "end": "2316920"
  },
  {
    "text": "of the domain that is supposed to be used to query the next stage C2 server so basically we have this magic number",
    "start": "2316920",
    "end": "2324440"
  },
  {
    "text": "the 26766 we have a domain name that's that should be used to to uh talk to the",
    "start": "2324440",
    "end": "2331640"
  },
  {
    "text": "second stage C2 server in this case this images movie de.net",
    "start": "2331640",
    "end": "2337240"
  },
  {
    "text": "and um we have an IP address which is the IP address of the DNS server that is to be U talked to and we can also see",
    "start": "2337240",
    "end": "2345440"
  },
  {
    "text": "that it specifically requests txt resource records at this stage now if you think about DNS",
    "start": "2345440",
    "end": "2353599"
  },
  {
    "text": "referrals are an inherent feature of DNS if you think about um iterative DNS",
    "start": "2353599",
    "end": "2359040"
  },
  {
    "text": "resolution you know you ask the rottins servers and you get a referral back and so on and so forth so they could have",
    "start": "2359040",
    "end": "2365359"
  },
  {
    "text": "relied on that but we suppose that or yeah we think they did not",
    "start": "2365359",
    "end": "2371680"
  },
  {
    "text": "because you can't encrypt the information you can't encrypt the referral if you're using the DNS",
    "start": "2371680",
    "end": "2376960"
  },
  {
    "text": "inherent features but you can if you do it that",
    "start": "2376960",
    "end": "2382319"
  },
  {
    "text": "way um DNS has a few implications so you can't make arbitrarily large uh DNS",
    "start": "2382319",
    "end": "2389760"
  },
  {
    "text": "requests it's based on UDP so you have some size limitations and the DNS RFC",
    "start": "2389760",
    "end": "2395000"
  },
  {
    "text": "also um has a few restrictions on the query domain name and stuff like that",
    "start": "2395000",
    "end": "2400520"
  },
  {
    "text": "but that's well respected by the malware so the authors were apparently aware of that and worked around that the basic",
    "start": "2400520",
    "end": "2406880"
  },
  {
    "text": "message structure is that you have a dnst txt record in that dnst txt record",
    "start": "2406880",
    "end": "2412280"
  },
  {
    "text": "you have base 64 encoded data and you have a crc32 a check sum for bytes",
    "start": "2412280",
    "end": "2419160"
  },
  {
    "text": "basically in order to check um the the decrypted content and the actual content",
    "start": "2419160",
    "end": "2425839"
  },
  {
    "text": "is what I refer to as as a chunk because basically what happens is all the",
    "start": "2425839",
    "end": "2431599"
  },
  {
    "text": "information that is to be transmitted is split up into chunks and these chunks are uh transferred",
    "start": "2431599",
    "end": "2439200"
  },
  {
    "text": "separately and each and and the chunk ID or to to query a specific Chunk from the",
    "start": "2439200",
    "end": "2445160"
  },
  {
    "text": "C2 server that chunk ID is prepended to the query domain name up front so it's a",
    "start": "2445160",
    "end": "2451079"
  },
  {
    "text": "pretty welld designed uh architecture or C2 protocol",
    "start": "2451079",
    "end": "2457079"
  },
  {
    "text": "based on DNS this meare again uses a variety of rc4 keys to make it you know",
    "start": "2457079",
    "end": "2463160"
  },
  {
    "text": "not a straightforward task to decod or decrypt the information um but as I said",
    "start": "2463160",
    "end": "2469400"
  },
  {
    "text": "it has been around since 2010 so apparently designing a C2 uh protocol in",
    "start": "2469400",
    "end": "2474839"
  },
  {
    "text": "that way uh apparently helps to stick around for for some",
    "start": "2474839",
    "end": "2480119"
  },
  {
    "text": "time okay that was an example um that was another cyber crime typical e crime",
    "start": "2480119",
    "end": "2485760"
  },
  {
    "text": "cyber crime example but how about how about targeted attacks do we see DNS",
    "start": "2485760",
    "end": "2491200"
  },
  {
    "text": "based um see2 channels in targeted attacks yes we do there's a mare family",
    "start": "2491200",
    "end": "2498640"
  },
  {
    "text": "called plugx uh which has been around for some time as well I think early variants go back to as far as",
    "start": "2498640",
    "end": "2504880"
  },
  {
    "text": "2008 um and we see that we we see plug X being used a lot",
    "start": "2504880",
    "end": "2510160"
  },
  {
    "text": "um um it has been used for many years uh we have seen it being used against government entities defense and",
    "start": "2510160",
    "end": "2516760"
  },
  {
    "text": "Aerospace sector um and even Pro democracy activists um it's it's mostly",
    "start": "2516760",
    "end": "2523680"
  },
  {
    "text": "used by China based actors and it has a very modular plug-in based design and as",
    "start": "2523680",
    "end": "2530440"
  },
  {
    "text": "such it supports multiple C2 carrier protocols and among that is also a",
    "start": "2530440",
    "end": "2535839"
  },
  {
    "text": "module to actually perform dns-based command and control so are you saying that there is actually a panda operating",
    "start": "2535839",
    "end": "2542400"
  },
  {
    "text": "operating this there's a panda using DNS for command and control that's what I'm saying okay let's take a",
    "start": "2542400",
    "end": "2548920"
  },
  {
    "text": "look at an example um compared to fedot we we see that this is this is structured a little",
    "start": "2548920",
    "end": "2555599"
  },
  {
    "text": "bit differently we we again have a pretty long uh query domain name uh and",
    "start": "2555599",
    "end": "2561400"
  },
  {
    "text": "that's actually where the information is encoded in this example so um again as I",
    "start": "2561400",
    "end": "2567680"
  },
  {
    "text": "said earlier there's a few implications that DNS uh implies and that is for example that the domain name consists of",
    "start": "2567680",
    "end": "2575680"
  },
  {
    "text": "labeled that's basically the stuff that's separated by the dots and each label can only have a length up to 63",
    "start": "2575680",
    "end": "2583240"
  },
  {
    "text": "characters and again the mware knows that and works around it by you know inserting a DOT at least every 63",
    "start": "2583240",
    "end": "2591040"
  },
  {
    "text": "characters um and the encoding scheme that's used here is basically base 16",
    "start": "2591040",
    "end": "2597280"
  },
  {
    "text": "using a custom alphabet um and it and it adds Randomness in the first few bites so the",
    "start": "2597280",
    "end": "2603480"
  },
  {
    "text": "question is why does it do that well adding random stuff to the query domain",
    "start": "2603480",
    "end": "2608559"
  },
  {
    "text": "name helps uh to to prevent this being um CED so because it's effectively a new",
    "start": "2608559",
    "end": "2616319"
  },
  {
    "text": "query domain name and you know cing resolvers uh won't add that to well they",
    "start": "2616319",
    "end": "2622119"
  },
  {
    "text": "might add it to a cache but you know it's always a new one so that prevents cing um but the interesting thing is",
    "start": "2622119",
    "end": "2628640"
  },
  {
    "text": "that the bite at offset three in the plain text which is offset six in the encoded variant that you see up there",
    "start": "2628640",
    "end": "2635680"
  },
  {
    "text": "that one is is fixed because that's the message type so it's always hex 1e in",
    "start": "2635680",
    "end": "2641079"
  },
  {
    "text": "the plain text and it's um OB in the query domain name so at that Offset you",
    "start": "2641079",
    "end": "2647440"
  },
  {
    "text": "will always find OB for the initial bootstrap traffic um in that case are",
    "start": "2647440",
    "end": "2652920"
  },
  {
    "text": "you aware of any public documentation on this uh feature ofex I don't think this",
    "start": "2652920",
    "end": "2657960"
  },
  {
    "text": "says these guys are hearing it for the first time I think so yeah I think think uh first time publicly documented",
    "start": "2657960",
    "end": "2668000"
  },
  {
    "text": "okay leaving DNS aside for a moment let's take a look at",
    "start": "2668960",
    "end": "2674720"
  },
  {
    "text": "HTTP here's a here's a typical HTTP response I would say so Pier Mark you",
    "start": "2674720",
    "end": "2680839"
  },
  {
    "text": "have been asking me so much about your beautiful animal pictures what do you think do you see anything suspicious in",
    "start": "2680839",
    "end": "2686119"
  },
  {
    "text": "there well to be honest to me HTML is complete gibberish all the time you have",
    "start": "2686119",
    "end": "2691160"
  },
  {
    "text": "special characters and bigger smaller and no I think this is completely legit I mean who doing HTML would do anything",
    "start": "2691160",
    "end": "2697240"
  },
  {
    "text": "malicious no it's not even a programming language right oh so um right I mean",
    "start": "2697240",
    "end": "2704359"
  },
  {
    "text": "it's supposed to mimic uh a typical HTTP file not found error message um and and",
    "start": "2704359",
    "end": "2710520"
  },
  {
    "text": "that consists of uh a header which has the the status code which is 404 um and",
    "start": "2710520",
    "end": "2716280"
  },
  {
    "text": "it also has a body and that's typical for error me messages as well it just repeats basically that uh the file was",
    "start": "2716280",
    "end": "2723520"
  },
  {
    "text": "not found and the body is basically presented to the user but what we see down here is actually there's some you",
    "start": "2723520",
    "end": "2732119"
  },
  {
    "text": "know encoded string we can't say what exactly um it has a prefix of debug so",
    "start": "2732119",
    "end": "2739880"
  },
  {
    "text": "you know maybe they wanted to make this look like some State machine or state information we don't know but actually",
    "start": "2739880",
    "end": "2746520"
  },
  {
    "text": "if you decode that you find that this is actually a command to to a bot so that's",
    "start": "2746520",
    "end": "2752160"
  },
  {
    "text": "basically part of command and control communication just hit hidden in a somewhat unique way and this command",
    "start": "2752160",
    "end": "2759480"
  },
  {
    "text": "basically tells the bot to download a specific binary from a specific location executed and so on and so",
    "start": "2759480",
    "end": "2766400"
  },
  {
    "text": "forth okay that's it with our examples let's try to sum up what we've seen what we've",
    "start": "2766400",
    "end": "2773880"
  },
  {
    "text": "presented in our talk now there were or these are real",
    "start": "2773880",
    "end": "2779480"
  },
  {
    "text": "world examples of malware that's using hidden communication and we've seen",
    "start": "2779480",
    "end": "2785440"
  },
  {
    "text": "examples from the Cyber criminal world and from targeted attack activities coverage channels are used by",
    "start": "2785440",
    "end": "2792839"
  },
  {
    "text": "mware C2 and they are mostly used under certain conditions and this is where it",
    "start": "2792839",
    "end": "2798000"
  },
  {
    "text": "gets interesting so we know that they combine that with cryptography and they",
    "start": "2798000",
    "end": "2803640"
  },
  {
    "text": "do that because just hiding the information you know doesn't solve all your problems um if you combine that",
    "start": "2803640",
    "end": "2811359"
  },
  {
    "text": "with C cryptography you actually make it difficult to Signature the traffic",
    "start": "2811359",
    "end": "2816400"
  },
  {
    "text": "um even traffic that is hidden and they often do that for small messages so",
    "start": "2816400",
    "end": "2821640"
  },
  {
    "text": "coming back to the gozy example this is a really nice example so why would you design your main command and control",
    "start": "2821640",
    "end": "2828160"
  },
  {
    "text": "channel uh using steganography or any of those pretty complex techniques um and",
    "start": "2828160",
    "end": "2835480"
  },
  {
    "text": "what they solved it by basically just designing the fallback C2 communication",
    "start": "2835480",
    "end": "2840520"
  },
  {
    "text": "using uh those techniques if you think about the",
    "start": "2840520",
    "end": "2846920"
  },
  {
    "text": "necessity to communicate there there might be some protocols that actually serve better um if you need uh more",
    "start": "2846920",
    "end": "2853920"
  },
  {
    "text": "bandwidth in the regular C2 communication so far we've only seen images for example for the",
    "start": "2853920",
    "end": "2859559"
  },
  {
    "text": "steganographic part and we've mostly seen DNS in these examples and also HTTP",
    "start": "2859559",
    "end": "2865720"
  },
  {
    "text": "but you know in order to scale up you could also use any kind of other",
    "start": "2865720",
    "end": "2871760"
  },
  {
    "text": "protocols uh video conferencing whatever protocols that by the themselves um use",
    "start": "2871760",
    "end": "2877760"
  },
  {
    "text": "more or require more bandwidth um part of that is that we",
    "start": "2877760",
    "end": "2884599"
  },
  {
    "text": "believe steganography at least is mainly used for unidirectional communication",
    "start": "2884599",
    "end": "2890559"
  },
  {
    "text": "and the reason is if you think about a two-way communication using steganography um let's say using images",
    "start": "2890559",
    "end": "2897480"
  },
  {
    "text": "as the media you want to encode your stuff in then you have to have a pool of images at hand that you can encode these",
    "start": "2897480",
    "end": "2904400"
  },
  {
    "text": "messages in and that might be doable for the C2 service side but it's definitely",
    "start": "2904400",
    "end": "2909599"
  },
  {
    "text": "more challenging on for an infected machine to have that pool of images at hand to encode the the messages",
    "start": "2909599",
    "end": "2917280"
  },
  {
    "text": "in if you use tonography such as stol loader um then you can actually leverage",
    "start": "2917280",
    "end": "2923400"
  },
  {
    "text": "beny infrastructure for command and control or mware storage and that poses another problem for Defenders because",
    "start": "2923400",
    "end": "2930319"
  },
  {
    "text": "that basically Works around reputation based um detection or protection means",
    "start": "2930319",
    "end": "2937599"
  },
  {
    "text": "so finally we've seen covered channels that involve St steganography or hiding",
    "start": "2938680",
    "end": "2945400"
  },
  {
    "text": "messages and carrier protocols make C2 communication more difficult to detect",
    "start": "2945400",
    "end": "2952559"
  },
  {
    "text": "but I would say St steganography is not a Panacea and hiding messages in",
    "start": "2952559",
    "end": "2959200"
  },
  {
    "text": "inconspicuous carrier protocols is neither um a Panacea one of the main goals that we",
    "start": "2959200",
    "end": "2966480"
  },
  {
    "text": "wanted to achieve with this talk is to raise awareness for this type of",
    "start": "2966480",
    "end": "2971799"
  },
  {
    "text": "communication and I think that's one of the first steps that we can take in order to detect this kind of",
    "start": "2971799",
    "end": "2977240"
  },
  {
    "text": "communication in the future and um if you ever happen to run across traffic",
    "start": "2977240",
    "end": "2982720"
  },
  {
    "text": "that looks suspicious to you uh just hit us up get in get in touch with us and we'll be happy to look into",
    "start": "2982720",
    "end": "2990240"
  },
  {
    "text": "that with that I think we'll conclude this talk um and we'll take questions",
    "start": "2990240",
    "end": "2996799"
  },
  {
    "text": "thank you for your",
    "start": "2996799",
    "end": "2999400"
  },
  {
    "text": "attention we actually have a little gimmick so for everybody who who gets up",
    "start": "3005680",
    "end": "3011680"
  },
  {
    "text": "and ask a question a real question they'll get a they'll get a t-shirt so you know think about",
    "start": "3011680",
    "end": "3019640"
  },
  {
    "text": "it we might have a real question over there yes sir so can you use rpz or",
    "start": "3024440",
    "end": "3031839"
  },
  {
    "text": "something on theace sorry I I didn't sorry I didn't",
    "start": "3031839",
    "end": "3037319"
  },
  {
    "text": "get it did you understand I think I understood the question but I don't have the answer uh do you think a mechanism",
    "start": "3037319",
    "end": "3043000"
  },
  {
    "text": "like rpz can be used for this for detecting or at least helping with the blocking of this type of",
    "start": "3043000",
    "end": "3050200"
  },
  {
    "text": "protocol one we're definitely not getting any t-shirts I'll get back to you I'm",
    "start": "3053760",
    "end": "3060680"
  },
  {
    "text": "interested in in knowing about this as well and this is one of the topics about DNS that yeah I'm not sure are you no",
    "start": "3060680",
    "end": "3067319"
  },
  {
    "text": "let's yeah let's chat about it offline I guess you'll get a t-shirt anyway",
    "start": "3067319",
    "end": "3074318"
  },
  {
    "text": "so Mark have you looked at or have you seen C2 mechanisms where they uh give",
    "start": "3075119",
    "end": "3081440"
  },
  {
    "text": "specific commands or answers only based on the source IP or the maybe the",
    "start": "3081440",
    "end": "3086599"
  },
  {
    "text": "country or the net block of the particular victim so that you can't really monitor it unless your victim",
    "start": "3086599",
    "end": "3092440"
  },
  {
    "text": "itself a very good question I I so the question was if we have seen specific answers um based on the environment of",
    "start": "3092440",
    "end": "3101359"
  },
  {
    "text": "of of the client or the infected machine so for example based on the IP address um and the answer is definitely yes so",
    "start": "3101359",
    "end": "3109400"
  },
  {
    "text": "for a ster loader for example um as Pier Mark mentioned they they build up a very",
    "start": "3109400",
    "end": "3114680"
  },
  {
    "text": "U verbus profile of the infected machine and we",
    "start": "3114680",
    "end": "3119839"
  },
  {
    "text": "believe there's some kind of state machine implemented on the C2 server and we we don't we don't always trigger uh",
    "start": "3119839",
    "end": "3127079"
  },
  {
    "text": "the distribution or the deployment of the of the same payload and we believe that is based on such things such as the",
    "start": "3127079",
    "end": "3134000"
  },
  {
    "text": "IP address that you're connecting from uh maybe even um how many times you have connected in the past we've seen that",
    "start": "3134000",
    "end": "3141119"
  },
  {
    "text": "pretty aggressive blacklisting for example by the by the C2 operators and stuff like that so that is definitely a",
    "start": "3141119",
    "end": "3147040"
  },
  {
    "text": "challenge for for researchers yes I think there was a question in the back",
    "start": "3147040",
    "end": "3153240"
  },
  {
    "text": "there so if I understood the question correctly is how did they Implement DNS",
    "start": "3162079",
    "end": "3167119"
  },
  {
    "text": "cover",
    "start": "3167119",
    "end": "3169480"
  },
  {
    "text": "channels okay so okay I got it now the question",
    "start": "3174240",
    "end": "3180760"
  },
  {
    "text": "is how do they redirect the messages to their C2 service to their DNS service",
    "start": "3180760",
    "end": "3185880"
  },
  {
    "text": "basically well in most examples they just send them directly to IP addresses",
    "start": "3185880",
    "end": "3191040"
  },
  {
    "text": "that belong to their own infrastructure they could as well use their own domains",
    "start": "3191040",
    "end": "3197280"
  },
  {
    "text": "and following the principles of iterative DNS resolution they will at",
    "start": "3197280",
    "end": "3202400"
  },
  {
    "text": "some point end up at the um author authoritative name servers or one of the",
    "start": "3202400",
    "end": "3207720"
  },
  {
    "text": "recursive resolvers will end up at the authoritative uh resolver that's",
    "start": "3207720",
    "end": "3212760"
  },
  {
    "text": "responsible for that for that domain so in that case you don't so if you use registered domains uh you don't need to",
    "start": "3212760",
    "end": "3220880"
  },
  {
    "text": "you know influence that that communication but if you use b or if you",
    "start": "3220880",
    "end": "3226359"
  },
  {
    "text": "yeah use benign domains basically um in that case they directed them uh to to",
    "start": "3226359",
    "end": "3232440"
  },
  {
    "text": "those DNS servers that U that they set up or have had under control there was another question over",
    "start": "3232440",
    "end": "3240079"
  },
  {
    "text": "there good point so I think the question was if we had seen um actors actively",
    "start": "3255839",
    "end": "3263400"
  },
  {
    "text": "operating around um blocking mechanisms that have been Implement implemented as",
    "start": "3263400",
    "end": "3269359"
  },
  {
    "text": "as a result of detecting this type of uh traffic um I'm not aware me neither yeah",
    "start": "3269359",
    "end": "3277319"
  },
  {
    "text": "I think so in short I think they rely purely on on not being detected or we",
    "start": "3277319",
    "end": "3282359"
  },
  {
    "text": "have not observed any other cases one question",
    "start": "3282359",
    "end": "3288318"
  },
  {
    "text": "there would possible",
    "start": "3294079",
    "end": "3298319"
  },
  {
    "text": "to it would definitely be possible to encode information inside images and send it to a server um especially now",
    "start": "3303760",
    "end": "3310599"
  },
  {
    "text": "that we're seeing more and more people trading images sending images to one another this is not even going to raise a lot of Suspicion on a network on the",
    "start": "3310599",
    "end": "3317520"
  },
  {
    "text": "other hand as Chris mentioned it it kind of assumes that the malare has a pool of images that they can use to send to code",
    "start": "3317520",
    "end": "3325359"
  },
  {
    "text": "message messages in and then send over and this is a bit less convenient for malare to actually download images do",
    "start": "3325359",
    "end": "3331400"
  },
  {
    "text": "something or if they always trade the same image then it might be a bit easier to spot but I think this is more of the",
    "start": "3331400",
    "end": "3337599"
  },
  {
    "text": "limitation that we we think is happening right now why people are only downloading images and not necessarily",
    "start": "3337599",
    "end": "3342799"
  },
  {
    "text": "trading them by hiding messages in both directions two questions first have you",
    "start": "3342799",
    "end": "3349280"
  },
  {
    "text": "seen the formats like video or audio and what clean size did",
    "start": "3349280",
    "end": "3355640"
  },
  {
    "text": "used",
    "start": "3355640",
    "end": "3358038"
  },
  {
    "text": "to be",
    "start": "3360799",
    "end": "3364000"
  },
  {
    "text": "us okay okay I see so the question was uh which benign sites which benign image",
    "start": "3367440",
    "end": "3373160"
  },
  {
    "text": "hosting websites have been used in order to distribute the images that contain the malicious stuff okay we've seen a",
    "start": "3373160",
    "end": "3379920"
  },
  {
    "text": "variety of of uh benign websites that were used to host that stuff and that",
    "start": "3379920",
    "end": "3386599"
  },
  {
    "text": "did change over time so I think we have seen a total of like five or six uh",
    "start": "3386599",
    "end": "3392920"
  },
  {
    "text": "hosting websites um I actually don't remember off the top of my head but it weren't they weren't",
    "start": "3392920",
    "end": "3399440"
  },
  {
    "text": "those those big ones uh like flicker or so so there were smaller ones or mediumsized ones I would say none of",
    "start": "3399440",
    "end": "3406520"
  },
  {
    "text": "none of them I had heard before to be honest one of the most relevant I've seen is host then post.org so this one",
    "start": "3406520",
    "end": "3413079"
  },
  {
    "text": "has been used a lot and actually the mare operators maybe as a closing remark because we're out of time the mare",
    "start": "3413079",
    "end": "3418480"
  },
  {
    "text": "operators sometimes also were pretty quick to remove the images once they were used so that was also interesting to note but yeah hostand post.org was",
    "start": "3418480",
    "end": "3425359"
  },
  {
    "text": "one of them so thank you very much if you have more questions we will be glad to take them maybe offline so because",
    "start": "3425359",
    "end": "3431200"
  },
  {
    "text": "we're all F thanks",
    "start": "3431200",
    "end": "3437160"
  }
]