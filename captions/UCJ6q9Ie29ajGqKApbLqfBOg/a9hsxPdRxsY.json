[
  {
    "text": "foreign",
    "start": "1979",
    "end": "4159"
  },
  {
    "text": "my name is Chava fitzel and the presentation is win against TCC also",
    "start": "10760",
    "end": "19199"
  },
  {
    "text": "known as 20 plus new ways to bypass your Mac OS privacy mechanism",
    "start": "19199",
    "end": "24840"
  },
  {
    "text": "my name is chabar I'm currently working for offensive security I'm right now the",
    "start": "24840",
    "end": "31619"
  },
  {
    "text": "lead content developer for our Mac OS control bypasses training I used to be a",
    "start": "31619",
    "end": "36660"
  },
  {
    "text": "red and blue teamer for eight years before that I do Mac OS buck hunting in",
    "start": "36660",
    "end": "42239"
  },
  {
    "text": "my free time as a hobby as part of work now I'm married have two kids and I love",
    "start": "42239",
    "end": "48539"
  },
  {
    "text": "hiking and trail running my core presenter is voycheck unfortunately he",
    "start": "48539",
    "end": "53879"
  },
  {
    "text": "wouldn't join us due to some has issues so we he recorded his part and we will",
    "start": "53879",
    "end": "61320"
  },
  {
    "text": "play it back now and then I will pick up from there",
    "start": "61320",
    "end": "66739"
  },
  {
    "text": "mobile security at security unfortunately due to my bad health",
    "start": "69860",
    "end": "75720"
  },
  {
    "text": "condition I couldn't be there with you at blackhead in person however I will be",
    "start": "75720",
    "end": "82200"
  },
  {
    "text": "still able to report the TCC from from the recording so I'm a blogger",
    "start": "82200",
    "end": "88439"
  },
  {
    "text": "um but you could go about a Blog where I of course document my iOS and macro",
    "start": "88439",
    "end": "95640"
  },
  {
    "text": "security findings for mostly focus on iOS and Marketplace application security",
    "start": "95640",
    "end": "101000"
  },
  {
    "text": "somebody of you may also know me from IOS Security Suite that I'm creator of",
    "start": "101000",
    "end": "106079"
  },
  {
    "text": "that's a free open source Swift library that helps developer making sure that their application is run on secure IOD",
    "start": "106079",
    "end": "114360"
  },
  {
    "text": "devices and also engage in macca's environment security testing markers red",
    "start": "114360",
    "end": "120420"
  },
  {
    "text": "teaming Etc so this is the second part of our",
    "start": "120420",
    "end": "125939"
  },
  {
    "text": "presentation we gave with Jabba last year on blackheads in the us",
    "start": "125939",
    "end": "132739"
  },
  {
    "text": "where we focused of course on on bypassing micros privacy mechanisms so",
    "start": "132739",
    "end": "139260"
  },
  {
    "text": "yeah that's that's the second part the recent continuation and that's because that's the second part in the first part",
    "start": "139260",
    "end": "147660"
  },
  {
    "text": "of the agenda I I'll just quickly remind you what stcc and what are the basic",
    "start": "147660",
    "end": "153780"
  },
  {
    "text": "privacy fundamentals of markers if you are interested in learning in details",
    "start": "153780",
    "end": "160140"
  },
  {
    "text": "how it works please check our first part of the stock so yeah that we will then",
    "start": "160140",
    "end": "167160"
  },
  {
    "text": "focus on uh technical stuff on TCC bypasses and as you can see here on the",
    "start": "167160",
    "end": "174239"
  },
  {
    "text": "slide there are a lot of utcc bypasses and in the end uh Chapa will cover some",
    "start": "174239",
    "end": "181200"
  },
  {
    "text": "new uh security improvements released and markers Ventura",
    "start": "181200",
    "end": "187739"
  },
  {
    "text": "so let's start with the I think the most fundamental uh Mac OS security mechanism",
    "start": "187739",
    "end": "194400"
  },
  {
    "text": "that the system Integrity protection uh based on Sandbox kernel extension",
    "start": "194400",
    "end": "200040"
  },
  {
    "text": "so on Mac OS if you have root you are not the God because even if you are rude",
    "start": "200040",
    "end": "206099"
  },
  {
    "text": "you can't do anything with your operating system because the Sip will",
    "start": "206099",
    "end": "211200"
  },
  {
    "text": "restrict access to many directories will deny debugger attachment to processes",
    "start": "211200",
    "end": "216540"
  },
  {
    "text": "signed by directly uh by Apple you may not be able to change some of the",
    "start": "216540",
    "end": "222540"
  },
  {
    "text": "contents of of some restricted crucial from the system perspective files",
    "start": "222540",
    "end": "229739"
  },
  {
    "text": "etc etc and when the system Integrity protection is turned on",
    "start": "229739",
    "end": "236700"
  },
  {
    "text": "um there is a new mechanism that's also turned on which is transparency constant",
    "start": "236700",
    "end": "242700"
  },
  {
    "text": "and control uh watch the abbreviation is of course TCC",
    "start": "242700",
    "end": "248159"
  },
  {
    "text": "uh when you for example open a new application",
    "start": "248159",
    "end": "253980"
  },
  {
    "text": "that will try access some privacy sensitive resources like for",
    "start": "253980",
    "end": "259739"
  },
  {
    "text": "example your contacts your address book uh you will see you will see a problem because",
    "start": "259739",
    "end": "266600"
  },
  {
    "text": "the operating system wants to know if there is a clear clear user that user is",
    "start": "266600",
    "end": "273780"
  },
  {
    "text": "consent to give the application access to your privacy sensitive",
    "start": "273780",
    "end": "280139"
  },
  {
    "text": "resources and if you open privacy and security settings uh you will see that there are",
    "start": "280139",
    "end": "287940"
  },
  {
    "text": "a lot of different resources that are controlled by the operating system",
    "start": "287940",
    "end": "293520"
  },
  {
    "text": "and the TCC mechanism even if you go to uh to the automation",
    "start": "293520",
    "end": "299040"
  },
  {
    "text": "tab you will see that TCC can be really granular because we can even control",
    "start": "299040",
    "end": "305479"
  },
  {
    "text": "what application can control which other applications",
    "start": "305479",
    "end": "312620"
  },
  {
    "text": "and yeah PCC is really huge uh nowadays",
    "start": "312840",
    "end": "317940"
  },
  {
    "text": "and we observed that when Apple released a new major Macos version",
    "start": "317940",
    "end": "324500"
  },
  {
    "text": "uh there are new TCC checks that are still added magnets yes so that's that's",
    "start": "324500",
    "end": "330240"
  },
  {
    "text": "still that's that's really huge and will be problem even more big",
    "start": "330240",
    "end": "337020"
  },
  {
    "text": "okay but that was the quick recap of the theory let's now focus on the",
    "start": "337139",
    "end": "342720"
  },
  {
    "text": "exploitation so one year ago uh we showed you that there was a huge",
    "start": "342720",
    "end": "347880"
  },
  {
    "text": "possibility to attack this city via uh plugins loaded to the applications contexts",
    "start": "347880",
    "end": "354600"
  },
  {
    "text": "and yeah here again from the year one year later uh still there was a",
    "start": "354600",
    "end": "360900"
  },
  {
    "text": "possibility but now from vrd uh device abstraction layer plugins so those",
    "start": "360900",
    "end": "367740"
  },
  {
    "text": "plugins are are loaded when applications uh open camera stream using the",
    "start": "367740",
    "end": "375300"
  },
  {
    "text": "coromandia io and those plugins are stored in library core media i o plug",
    "start": "375300",
    "end": "381900"
  },
  {
    "text": "install directory which is not predicted with system security protection",
    "start": "381900",
    "end": "388080"
  },
  {
    "text": "and those plugins are written let's say the old way there is no middle",
    "start": "388080",
    "end": "395340"
  },
  {
    "text": "layer between the core media IO and those plugins so they are directly",
    "start": "395340",
    "end": "402720"
  },
  {
    "text": "loaded to the process context which yeah allows us to if we are able of",
    "start": "402720",
    "end": "410520"
  },
  {
    "text": "course to load the plugin to the vulnerable application we can control the whole application and",
    "start": "410520",
    "end": "418199"
  },
  {
    "text": "use all of the permissions that were already granted to that app",
    "start": "418199",
    "end": "423419"
  },
  {
    "text": "so let's create a plugin uh it's a bundle a standard bundle with",
    "start": "423419",
    "end": "430380"
  },
  {
    "text": "um with Dynamic library that will be of course loaded we have to add those two CF plugin factors and see if plugin",
    "start": "430380",
    "end": "437880"
  },
  {
    "text": "types entries to the info Palace of that output bundle and using this simple old Objective C",
    "start": "437880",
    "end": "447599"
  },
  {
    "text": "Constructor trick to deconstruct the Constructor is executed when the plugin",
    "start": "447599",
    "end": "453720"
  },
  {
    "text": "is loaded to the to the context of the of the main app is executed so in this Constructor we are able to execute our",
    "start": "453720",
    "end": "460680"
  },
  {
    "text": "opcode um and yeah after I created the plugin I",
    "start": "460680",
    "end": "466319"
  },
  {
    "text": "decided to grab the file system for all Apple's",
    "start": "466319",
    "end": "471720"
  },
  {
    "text": "applications the standard standard installed on markets that have the private TCC SEC service camera",
    "start": "471720",
    "end": "480780"
  },
  {
    "text": "permission granted because if an app has the private TCC permission and title and",
    "start": "480780",
    "end": "487460"
  },
  {
    "text": "uh it the app does not have to ask uh for access to the grant that already uh",
    "start": "487460",
    "end": "496199"
  },
  {
    "text": "private resources because there is a private time right there are Apple controls which at which their app",
    "start": "496199",
    "end": "502020"
  },
  {
    "text": "don't have to ask the DC for accessing the private resource so I grabbed for",
    "start": "502020",
    "end": "507660"
  },
  {
    "text": "all those applications with that private entitlement and I decided to open them up",
    "start": "507660",
    "end": "514459"
  },
  {
    "text": "as you can see uh quickly almost instantly I got five hits",
    "start": "514560",
    "end": "521459"
  },
  {
    "text": "which is a big deal for somebody uh participating in Apple security party I",
    "start": "521459",
    "end": "528480"
  },
  {
    "text": "have to say so I was that happy that I decided to go AFK and I went on went on",
    "start": "528480",
    "end": "535560"
  },
  {
    "text": "vacation uh but coming back to the expectation the idea uh is really simple just create",
    "start": "535560",
    "end": "544500"
  },
  {
    "text": "a malicious plugin save the one that this one plugin dial directory and open all vulnerable",
    "start": "544500",
    "end": "552540"
  },
  {
    "text": "applications with interesting entitlements uh yeah so one of those five heads uh",
    "start": "552540",
    "end": "562140"
  },
  {
    "text": "was photobooth so let's take a look at its entitlement uh camera microphone",
    "start": "562140",
    "end": "568440"
  },
  {
    "text": "address book looks good now let's see the demo I created the",
    "start": "568440",
    "end": "575880"
  },
  {
    "text": "plugin and installed in the in the directory I told you let's now open the photo booth application",
    "start": "575880",
    "end": "583680"
  },
  {
    "text": "under the hood the plugin is loaded and as you can see I made a screenshot of that application so yeah",
    "start": "583680",
    "end": "590339"
  },
  {
    "text": "I was able to access users uh camera without reading an atcc prompt",
    "start": "590339",
    "end": "597120"
  },
  {
    "text": "but from those five hits I think the most interesting one was uh the contacts application because as you can see there",
    "start": "597120",
    "end": "604200"
  },
  {
    "text": "are a lot of different TCC permissions and one of those permissions was TCC",
    "start": "604200",
    "end": "610920"
  },
  {
    "text": "manager which allows us to fully take over the control",
    "start": "610920",
    "end": "616700"
  },
  {
    "text": "uh over the uh the whole PC database so",
    "start": "616700",
    "end": "622519"
  },
  {
    "text": "let's take a look at the demon I open the contacts I will do it also manually",
    "start": "622519",
    "end": "627959"
  },
  {
    "text": "uh to show you where the code is actually executed as you can see and full disk actors only those apps have",
    "start": "627959",
    "end": "635459"
  },
  {
    "text": "the the permissions granted and when I create a new contact manually",
    "start": "635459",
    "end": "642360"
  },
  {
    "text": "and I opened the camera stream the plugin is now loaded",
    "start": "642360",
    "end": "648000"
  },
  {
    "text": "and the terminal application has been added by my code because I have",
    "start": "648000",
    "end": "655320"
  },
  {
    "text": "the full control over the uh the DTC database so yeah that's the ultimate TCC",
    "start": "655320",
    "end": "662459"
  },
  {
    "text": "bypass model vulnerability so those uh five fine findings uh had",
    "start": "662459",
    "end": "672000"
  },
  {
    "text": "five different CVS assigned because in all of them the hardened Grind Time has to be turned on",
    "start": "672000",
    "end": "680120"
  },
  {
    "text": "uh the second part of us I wanted to share with you is via alarm services but",
    "start": "680120",
    "end": "687180"
  },
  {
    "text": "before we start exploiting it let's uh let's focus on what Mac L is so when you",
    "start": "687180",
    "end": "694920"
  },
  {
    "text": "open Terminal and want to cut you know so file from from a directory here for",
    "start": "694920",
    "end": "701040"
  },
  {
    "text": "example from document that is protected by PCC then the temperature should not be permitted because you didn't grab access",
    "start": "701040",
    "end": "708120"
  },
  {
    "text": "to terminal but if you drag and drop the file to determine now",
    "start": "708120",
    "end": "715980"
  },
  {
    "text": "you will see that now magically uh this the terminal has access to that file and",
    "start": "715980",
    "end": "722220"
  },
  {
    "text": "that's because that's because the Mac L uh extended attribute with which we can",
    "start": "722220",
    "end": "727620"
  },
  {
    "text": "see we have the X after uh Dash L uh to",
    "start": "727620",
    "end": "732959"
  },
  {
    "text": "to see the account Apple Mac L estimate attribute so this attribute has managed",
    "start": "732959",
    "end": "739920"
  },
  {
    "text": "managed by sandbox and it cannot be modified by user or even root and the",
    "start": "739920",
    "end": "746519"
  },
  {
    "text": "idea of Mac L is to have the clear wizard intention that user wants to open",
    "start": "746519",
    "end": "752940"
  },
  {
    "text": "this particular file and the that particular application had has to access",
    "start": "752940",
    "end": "760380"
  },
  {
    "text": "this file without raising addition of this prop so the Mac l",
    "start": "760380",
    "end": "766079"
  },
  {
    "text": "extended attribute is applied in two situations when user drags and drop a file to to",
    "start": "766079",
    "end": "774720"
  },
  {
    "text": "the app or when user double clicks uh on a on a",
    "start": "774720",
    "end": "780180"
  },
  {
    "text": "file so the application that is responsible for the file uh will automatically open it",
    "start": "780180",
    "end": "788540"
  },
  {
    "text": "so you tell me that Mark L extends attributes is applied when users",
    "start": "789779",
    "end": "795720"
  },
  {
    "text": "doubling to double clicks file foreign TCC",
    "start": "795720",
    "end": "803880"
  },
  {
    "text": "I found out that the only thing required to bypass the whole mechanism is just to",
    "start": "806760",
    "end": "813240"
  },
  {
    "text": "reduce their malicious app to handle all file extensions and call that services",
    "start": "813240",
    "end": "820019"
  },
  {
    "text": "to open the juicy files right it's a really good stock really that's",
    "start": "820019",
    "end": "825540"
  },
  {
    "text": "that's the my my most favorite bug in TCC I've ever found",
    "start": "825540",
    "end": "831480"
  },
  {
    "text": "so unless they get a good deal again",
    "start": "831480",
    "end": "836360"
  },
  {
    "text": "ah markers 12.2 uh system figure detection is enabled",
    "start": "836519",
    "end": "844220"
  },
  {
    "text": "you will now see in security and privacy",
    "start": "845339",
    "end": "849620"
  },
  {
    "text": "that there are no additional privileges granted to the Bible TC via me",
    "start": "851579",
    "end": "857040"
  },
  {
    "text": "application that will be using the perfect app",
    "start": "857040",
    "end": "861920"
  },
  {
    "text": "and now when I open it you can see when I put it on address",
    "start": "864060",
    "end": "871079"
  },
  {
    "text": "book Let's copy to the TMP directory and the same with my message",
    "start": "871079",
    "end": "878540"
  },
  {
    "text": "and when we go to the temporary directory you will see that we actually have",
    "start": "883380",
    "end": "890639"
  },
  {
    "text": "access to those files which shows that we were able to bypass the TCC",
    "start": "890639",
    "end": "896699"
  },
  {
    "text": "of course the new cve was granted for for the Edition",
    "start": "896699",
    "end": "904380"
  },
  {
    "text": "another have honorable that I wanted to share with you is there TCC bypass via",
    "start": "904380",
    "end": "911639"
  },
  {
    "text": "SQL tracing mechanism so there are a lot of small applications on Mac that use under the hoods sqlite",
    "start": "911639",
    "end": "919860"
  },
  {
    "text": "free to store data some of those applications are apps that have resources protected by the DCC like for",
    "start": "919860",
    "end": "926880"
  },
  {
    "text": "example male male contact knows iMessage Etc and all of them use leap sqlite3",
    "start": "926880",
    "end": "936500"
  },
  {
    "text": "Dynamic library that of course handles all of the SQL",
    "start": "936500",
    "end": "942240"
  },
  {
    "text": "live freestyle but the the the framework the",
    "start": "942240",
    "end": "948480"
  },
  {
    "text": "dialect respects the issacing light Auto Trace environment variable when it's",
    "start": "948480",
    "end": "956399"
  },
  {
    "text": "said it locks all of the used SQL queries",
    "start": "956399",
    "end": "962600"
  },
  {
    "text": "and I'll mark there is a simple way to enable a environment variable globally so we've",
    "start": "962639",
    "end": "971160"
  },
  {
    "text": "just launched CTS at amp I was able to do so and again I started",
    "start": "971160",
    "end": "976579"
  },
  {
    "text": "using those applications that used you that use the sqlite free one of the the",
    "start": "976579",
    "end": "984180"
  },
  {
    "text": "one of the examples contacts when I started creating one contact",
    "start": "984180",
    "end": "989600"
  },
  {
    "text": "UM the details were locked the same with mail because mail has to",
    "start": "989639",
    "end": "997079"
  },
  {
    "text": "store somehow your remains that are sent uh locally on your on your disk uh they",
    "start": "997079",
    "end": "1003380"
  },
  {
    "text": "are saved in a secure and free database so yeah let's just scroll right we are",
    "start": "1003380",
    "end": "1010459"
  },
  {
    "text": "locked again uh read this demon so when you use",
    "start": "1010459",
    "end": "1016459"
  },
  {
    "text": "iMessage uh this demon stores that the information about your recent contacts",
    "start": "1016459",
    "end": "1024678"
  },
  {
    "text": "foreign was a bit harder but it wasn't really",
    "start": "1024679",
    "end": "1031640"
  },
  {
    "text": "hard to attack so if you create a new node uh you will see that the data is is",
    "start": "1031640",
    "end": "1041540"
  },
  {
    "text": "visible in a SQL queries however if you just",
    "start": "1041540",
    "end": "1047240"
  },
  {
    "text": "um unhactify this data you will see you will see the context and funny thing",
    "start": "1047240",
    "end": "1053780"
  },
  {
    "text": "is that every application that it's not some boxed Mac can access the deluxe",
    "start": "1053780",
    "end": "1060740"
  },
  {
    "text": "so there is no special additional entitlement uh required to do so any app",
    "start": "1060740",
    "end": "1067160"
  },
  {
    "text": "could could access this notes",
    "start": "1067160",
    "end": "1072200"
  },
  {
    "text": "okay and the next vulnerability is to bypass the Celia iCloud so some of the",
    "start": "1072200",
    "end": "1079520"
  },
  {
    "text": "normality protected data uh is the default synchronized with iCloud uh",
    "start": "1079520",
    "end": "1086720"
  },
  {
    "text": "however in this part we want even touch the TCC protected data I mean by",
    "start": "1086720",
    "end": "1093820"
  },
  {
    "text": "attacking the TCC itself we will extract them directly from the cloud",
    "start": "1093820",
    "end": "1100880"
  },
  {
    "text": "so I identified two interesting applications a garage window type movie that had both come up with private I can",
    "start": "1100880",
    "end": "1109280"
  },
  {
    "text": "I can access the title months and the congressman additionally disabled",
    "start": "1109280",
    "end": "1115400"
  },
  {
    "text": "Library presentation so with the private iCloud account",
    "start": "1115400",
    "end": "1122299"
  },
  {
    "text": "access entitlement we can communicate with an old C written ecstasy API",
    "start": "1122299",
    "end": "1129860"
  },
  {
    "text": "provided with the iCloud helper service and this that service will happily uh",
    "start": "1129860",
    "end": "1138860"
  },
  {
    "text": "provide us with iPhone tokens with nicely apps but in order to do so we",
    "start": "1138860",
    "end": "1144799"
  },
  {
    "text": "have to have the code execution within the privileged processes uh countless",
    "start": "1144799",
    "end": "1152480"
  },
  {
    "text": "right so in GarageBand the attack was was pretty easy uh",
    "start": "1152480",
    "end": "1160039"
  },
  {
    "text": "because we because I just use the starter dialog proxy attack to modify",
    "start": "1160039",
    "end": "1166880"
  },
  {
    "text": "why one of garagebands framework and execute code with the GarageBand",
    "start": "1166880",
    "end": "1175120"
  },
  {
    "text": "in iMovie it was still easier because I already",
    "start": "1175419",
    "end": "1180799"
  },
  {
    "text": "didn't have the Highland runtime turned on so we've just built inside the libraries uh variable I was able to",
    "start": "1180799",
    "end": "1189760"
  },
  {
    "text": "inject my dialogue uh to the iov context and",
    "start": "1189760",
    "end": "1195500"
  },
  {
    "text": "execute code within it so when I did when I did",
    "start": "1195500",
    "end": "1201700"
  },
  {
    "text": "exploited those two applications uh that was the that was Json returned from",
    "start": "1201700",
    "end": "1208880"
  },
  {
    "text": "returned from the iCloud helper service and as you can see there are a lot of",
    "start": "1208880",
    "end": "1215419"
  },
  {
    "text": "hyper tokens that were provided I created also demo",
    "start": "1215419",
    "end": "1221840"
  },
  {
    "text": "that will exploit the location service so if you provide the the stolen token",
    "start": "1221840",
    "end": "1230360"
  },
  {
    "text": "under the hood the script well I refer to find my session and we'll",
    "start": "1230360",
    "end": "1237799"
  },
  {
    "text": "have the Json written from iCloud so latitude and longitude",
    "start": "1237799",
    "end": "1243860"
  },
  {
    "text": "of myself without raising any TCC prop right so yeah",
    "start": "1243860",
    "end": "1248960"
  },
  {
    "text": "we were able to exploit it the idea for other resources to run into your iCloud is the",
    "start": "1248960",
    "end": "1255080"
  },
  {
    "text": "same so which is actually the exploitation of location services [Music]",
    "start": "1255080",
    "end": "1262520"
  },
  {
    "text": "and of course uh those issues are now fixed you may ask but poetry why there",
    "start": "1262520",
    "end": "1269360"
  },
  {
    "text": "are two CDs for each vulnerability because again Apple forgot about the",
    "start": "1269360",
    "end": "1277640"
  },
  {
    "text": "upgrade attack so I was it was still exploited by help by just using it",
    "start": "1277640",
    "end": "1284780"
  },
  {
    "text": "against the older version of it but now it's all fixed",
    "start": "1284780",
    "end": "1290059"
  },
  {
    "text": "uh that's the end of my part thank you very much",
    "start": "1290059",
    "end": "1294760"
  },
  {
    "text": "thank you uh so you might think already that TCC is fully broken on my quest and you",
    "start": "1297860",
    "end": "1303980"
  },
  {
    "text": "haven't even seen the second half of the presentation so let's continue with some more box uh so the next round of",
    "start": "1303980",
    "end": "1311200"
  },
  {
    "text": "vulnerability class uh we call it TCC bypasses using sysadmin tools",
    "start": "1311200",
    "end": "1317419"
  },
  {
    "text": "I really like the rule of diversity from Eric Raymond's 17 unique Soul which he",
    "start": "1317419",
    "end": "1323299"
  },
  {
    "text": "says developers should design their programs to be flexible and open this rule aims to make programs flexible",
    "start": "1323299",
    "end": "1330020"
  },
  {
    "text": "allowing them to be used in other ways than their developers intended and I",
    "start": "1330020",
    "end": "1335900"
  },
  {
    "text": "think this this idea catches this partially there because we use sysadmin tools in the way they were never",
    "start": "1335900",
    "end": "1342020"
  },
  {
    "text": "intended to be used uh some of these two's have very powerful",
    "start": "1342020",
    "end": "1347539"
  },
  {
    "text": "entitlements and basically they will allow us to either fully or partially bypass TCC",
    "start": "1347539",
    "end": "1354740"
  },
  {
    "text": "uh so the first one called ASR which is the Apple software restore utility",
    "start": "1354740",
    "end": "1360280"
  },
  {
    "text": "basically it can be used to restore and clone full disk images",
    "start": "1360280",
    "end": "1365900"
  },
  {
    "text": "and has some very powerful entitlements and I had the idea okay",
    "start": "1365900",
    "end": "1371080"
  },
  {
    "text": "tc06 us from accessing certain parts of the file system but what if we take the",
    "start": "1371080",
    "end": "1377120"
  },
  {
    "text": "entire file system clone it somewhere and then just access that disk or image",
    "start": "1377120",
    "end": "1384460"
  },
  {
    "text": "uh turns out that ASR is a super buggy Tool uh I really feel sorry for all the",
    "start": "1384460",
    "end": "1390980"
  },
  {
    "text": "Mac admins who have to use it uh it's basically broken on every single version",
    "start": "1390980",
    "end": "1396500"
  },
  {
    "text": "in a different way I actually had to search for",
    "start": "1396500",
    "end": "1402140"
  },
  {
    "text": "how to actually use it and I found a very good blog post from one of the Mac admins which says okay these are the",
    "start": "1402140",
    "end": "1408500"
  },
  {
    "text": "steps how you use ASR on Catalina because ASR is very sensitive to all the",
    "start": "1408500",
    "end": "1414080"
  },
  {
    "text": "apfs display out the problem was that I was already on Monterey are not and not on Catalina so",
    "start": "1414080",
    "end": "1420620"
  },
  {
    "text": "that the steps uh he described didn't work anymore so I had to find my way too",
    "start": "1420620",
    "end": "1426220"
  },
  {
    "text": "I eventually managed to make an apfs layout and disk layout",
    "start": "1426220",
    "end": "1431919"
  },
  {
    "text": "which was happily assetted by ASR and",
    "start": "1431919",
    "end": "1436940"
  },
  {
    "text": "simply as is I could basically clone the entire disk to another partition then",
    "start": "1436940",
    "end": "1444320"
  },
  {
    "text": "open that partition mounted and then list all the",
    "start": "1444320",
    "end": "1449860"
  },
  {
    "text": "private stuff I wanted so on the screen we can see that I can access messages",
    "start": "1449860",
    "end": "1455860"
  },
  {
    "text": "uh on the newly created partition but I cannot access it on the on its original",
    "start": "1455860",
    "end": "1462500"
  },
  {
    "text": "location uh the next one is time machine time",
    "start": "1462500",
    "end": "1467659"
  },
  {
    "text": "machine is Apple's backup utility um if if we back off to an apfs disk it",
    "start": "1467659",
    "end": "1474320"
  },
  {
    "text": "will use snapshots uh to make the backup Now by default it seems to be very well",
    "start": "1474320",
    "end": "1481039"
  },
  {
    "text": "protected uh by TCC so if we try to go and restart backup volume in the hope that we will",
    "start": "1481039",
    "end": "1488659"
  },
  {
    "text": "find private files there uh it will not be permitted um if we try to list the snapshots of",
    "start": "1488659",
    "end": "1497960"
  },
  {
    "text": "that backup it will not be permitted so it looks good",
    "start": "1497960",
    "end": "1503080"
  },
  {
    "text": "but it turns out that if we start to browse The Time Machine backups in",
    "start": "1503080",
    "end": "1510320"
  },
  {
    "text": "finder finder via Mount those backups in a new location under the hood which is",
    "start": "1510320",
    "end": "1517220"
  },
  {
    "text": "under volumes slash dot time machine then a good and then the the backup date",
    "start": "1517220",
    "end": "1524720"
  },
  {
    "text": "and that location will not be protected by TCC so if by any chance the user",
    "start": "1524720",
    "end": "1530779"
  },
  {
    "text": "browses his backups for restoring something or whatever at that point you",
    "start": "1530779",
    "end": "1537020"
  },
  {
    "text": "can access all of his files uh unfortunately what this has been fixed",
    "start": "1537020",
    "end": "1544159"
  },
  {
    "text": "uh the next one is Apple mobile backup utility uh this is a small utility to",
    "start": "1544159",
    "end": "1552140"
  },
  {
    "text": "backup iOS to Mac OS Now the default backup location is under the user home",
    "start": "1552140",
    "end": "1558080"
  },
  {
    "text": "folder library application support mobile sync backup this is protected by TCC as it should be because iOS backups",
    "start": "1558080",
    "end": "1566000"
  },
  {
    "text": "contains private information of course but can we back up somewhere else",
    "start": "1566000",
    "end": "1572600"
  },
  {
    "text": "uh turns out we can uh so we first need to grab uh get the uh the ID of our iOS",
    "start": "1572600",
    "end": "1581539"
  },
  {
    "text": "device we can use the system profiler utility for that and then we can call the Apple mobile",
    "start": "1581539",
    "end": "1588500"
  },
  {
    "text": "backup utility with the dash dash root option and with the dash dash root option we can specify uh the root",
    "start": "1588500",
    "end": "1596179"
  },
  {
    "text": "directory for the backup so we can basically back up to the temp directory and once the backup is complete we can",
    "start": "1596179",
    "end": "1603620"
  },
  {
    "text": "access those files um that verse anytime the user plugs in his",
    "start": "1603620",
    "end": "1611120"
  },
  {
    "text": "uh or her iPhone to the machine and at that point we can access all the private",
    "start": "1611120",
    "end": "1617419"
  },
  {
    "text": "information now Affair came back to me at that voice that went uh Ventura beta 5",
    "start": "1617419",
    "end": "1624799"
  },
  {
    "text": "and they said David we fixed it and it turned out what they did they",
    "start": "1624799",
    "end": "1630020"
  },
  {
    "text": "removed the root option from the utility which seemed to be nice on the surface",
    "start": "1630020",
    "end": "1635840"
  },
  {
    "text": "but it turns out that the Apple mobile backup utility uh it doesn't have any specific",
    "start": "1635840",
    "end": "1642440"
  },
  {
    "text": "entitlements to do the backups first and it uses the device link private",
    "start": "1642440",
    "end": "1648020"
  },
  {
    "text": "framework now this private framework has the function to set the root folder for",
    "start": "1648020",
    "end": "1654080"
  },
  {
    "text": "the backup location and the framework still had this function um",
    "start": "1654080",
    "end": "1659240"
  },
  {
    "text": "so what someone can do is load this framework on its own and call",
    "start": "1659240",
    "end": "1668299"
  },
  {
    "text": "this function and basically mimic the utility on its on his or her own program",
    "start": "1668299",
    "end": "1677120"
  },
  {
    "text": "uh so this was one uh the other thing",
    "start": "1677120",
    "end": "1682580"
  },
  {
    "text": "I could take an old version of Apple mobile backup put it on the latest",
    "start": "1682580",
    "end": "1687799"
  },
  {
    "text": "Ventura run it and it will still work um so we are back to square one and I'm",
    "start": "1687799",
    "end": "1695000"
  },
  {
    "text": "pretty sure Emperor who's looking some like this okay so this is not good",
    "start": "1695000",
    "end": "1700640"
  },
  {
    "text": "um so they re-architected the entire fix and ultimately they sacrifice usability",
    "start": "1700640",
    "end": "1708820"
  },
  {
    "text": "on for security uh sorry for that uh someone called me out on Twitter that",
    "start": "1708820",
    "end": "1716480"
  },
  {
    "text": "hey did you break our automated backups for iOS and I was like no I haven't done",
    "start": "1716480",
    "end": "1723080"
  },
  {
    "text": "anything um like is is the cve related to uh to",
    "start": "1723080",
    "end": "1729260"
  },
  {
    "text": "the broken feature and I was like probably not maybe and I started to look",
    "start": "1729260",
    "end": "1736700"
  },
  {
    "text": "into it and and eventually it turned out that yes um uh they can blame me for that so",
    "start": "1736700",
    "end": "1742820"
  },
  {
    "text": "whatever did is whenever you want to backup your iOS device uh",
    "start": "1742820",
    "end": "1748940"
  },
  {
    "text": "you need to enter your passcode on the iOS device for the backup to happen",
    "start": "1748940",
    "end": "1755179"
  },
  {
    "text": "and this breaks any automated backups unfortunately",
    "start": "1755179",
    "end": "1761600"
  },
  {
    "text": "hope I hope this will change so for example if the backup is encrypted then",
    "start": "1762460",
    "end": "1768620"
  },
  {
    "text": "there is really no bypass here because the backup will be encrypted and regardless the backup location an",
    "start": "1768620",
    "end": "1776360"
  },
  {
    "text": "attacker cannot decrypt it so in that case I think asking for a passcode is not necessarily we will see if if it",
    "start": "1776360",
    "end": "1784700"
  },
  {
    "text": "will be changed in the future or not uh the next sysadmin to Remote Management",
    "start": "1784700",
    "end": "1792340"
  },
  {
    "text": "or apple remote desktop we can enable this service as root so it",
    "start": "1792340",
    "end": "1801080"
  },
  {
    "text": "requires root if it's not enabled and this the Apple remote desktop agent",
    "start": "1801080",
    "end": "1807080"
  },
  {
    "text": "the AI the agent has a system policy or files permission",
    "start": "1807080",
    "end": "1813919"
  },
  {
    "text": "which means full disk access so it can write files anywhere so what we can do",
    "start": "1813919",
    "end": "1819159"
  },
  {
    "text": "and here's a video of the exploit",
    "start": "1819159",
    "end": "1824360"
  },
  {
    "text": "for this you need to be root so on the video I'm showing that the TCC database",
    "start": "1824360",
    "end": "1829700"
  },
  {
    "text": "it's empty it doesn't Grant permissions to anything let's try this again",
    "start": "1829700",
    "end": "1837760"
  },
  {
    "text": "so the TCC database is empty uh what we will do is",
    "start": "1840200",
    "end": "1846740"
  },
  {
    "text": "create a new user again we need to be root for this",
    "start": "1846740",
    "end": "1852080"
  },
  {
    "text": "it can be any user it will be an admin user and then we will enable remote desktop",
    "start": "1852080",
    "end": "1860360"
  },
  {
    "text": "service we can we could do this without any specific permissions uh beside being",
    "start": "1860360",
    "end": "1867440"
  },
  {
    "text": "root and once it's",
    "start": "1867440",
    "end": "1873200"
  },
  {
    "text": "enabled okay it keeps crashing",
    "start": "1873200",
    "end": "1880480"
  },
  {
    "text": "so basically what happens is once the new user is created and remove",
    "start": "1882080",
    "end": "1887840"
  },
  {
    "text": "desktop is enabled we can use the remote desktop utility to copy a file to the",
    "start": "1887840",
    "end": "1893779"
  },
  {
    "text": "file system a remotely over fried the existing TCC database and basically take over TCC",
    "start": "1893779",
    "end": "1902299"
  },
  {
    "text": "with any new rules we want um we cannot access like the user",
    "start": "1902299",
    "end": "1909320"
  },
  {
    "text": "desktop uh with enabling remove desktop display but",
    "start": "1909320",
    "end": "1914360"
  },
  {
    "text": "we can still copy a file uh remotely and this was fixed uh mainly at the sandbox",
    "start": "1914360",
    "end": "1920539"
  },
  {
    "text": "and and backup by Apple uh there are still a few that being",
    "start": "1920539",
    "end": "1925940"
  },
  {
    "text": "fixed so maybe in a future black hat or conference we can present those",
    "start": "1925940",
    "end": "1931159"
  },
  {
    "text": "uh the next one is the TCC bypass through mounting uh the idea is basically that DCC protects many",
    "start": "1931159",
    "end": "1937820"
  },
  {
    "text": "directories and we mount a new disk image over this directory and maybe drop",
    "start": "1937820",
    "end": "1944419"
  },
  {
    "text": "a new configuration file like a new DCC database or let the system write there",
    "start": "1944419",
    "end": "1950179"
  },
  {
    "text": "something and then we can read it back by unmounting it I heavily have used this back in 2021 and eventually Apple",
    "start": "1950179",
    "end": "1958039"
  },
  {
    "text": "learned the lesson that they now properly protect most of the directories from mounting and I said most of them",
    "start": "1958039",
    "end": "1965600"
  },
  {
    "text": "turns out not all so TCC has two main databases one for the system processors",
    "start": "1965600",
    "end": "1971659"
  },
  {
    "text": "and one for the user turns out there is a third one which I wasn't aware of",
    "start": "1971659",
    "end": "1977299"
  },
  {
    "text": "and it's only used by the location services demon and it's not a database",
    "start": "1977299",
    "end": "1984200"
  },
  {
    "text": "but it's a property list file but it acts as the database I have no idea why",
    "start": "1984200",
    "end": "1989360"
  },
  {
    "text": "this is separately and why these permissions are not in the in the main TC database I think it should be anyhow",
    "start": "1989360",
    "end": "1996559"
  },
  {
    "text": "this location wasn't protected so what I could do is create a new custom P list",
    "start": "1996559",
    "end": "2003340"
  },
  {
    "text": "put it in a disk image and mount this disk image over the VAR DB location directory and Grant any",
    "start": "2003340",
    "end": "2011980"
  },
  {
    "text": "excess Grant any application access to location services",
    "start": "2011980",
    "end": "2018580"
  },
  {
    "text": "and then there was a very interesting bug I call it hardening confusion so some directories like documents",
    "start": "2018580",
    "end": "2026200"
  },
  {
    "text": "address book as we saw so earlier are protected by TCC so we cannot read",
    "start": "2026200",
    "end": "2032320"
  },
  {
    "text": "and modify files that exist but we can create new files there which is viewed",
    "start": "2032320",
    "end": "2039399"
  },
  {
    "text": "at the first time and I frequently got asked this question is this normal yes",
    "start": "2039399",
    "end": "2044860"
  },
  {
    "text": "it is it's confusing but it's still okay because if you create a new file as an",
    "start": "2044860",
    "end": "2050138"
  },
  {
    "text": "attacker it's not you don't really access the user private stuff so so it's it's okay it's weird but it's okay",
    "start": "2050139",
    "end": "2057220"
  },
  {
    "text": "uh the second thing is that we cannot create a hard link pointing to a TCC",
    "start": "2057220",
    "end": "2062260"
  },
  {
    "text": "protected file uh which is good because if the hard link is in a different location we could access that file",
    "start": "2062260",
    "end": "2068800"
  },
  {
    "text": "immediately but what if we combine the two so is there like",
    "start": "2068800",
    "end": "2075040"
  },
  {
    "text": "some sort of check raise uh here turns out that yes so what we can",
    "start": "2075040",
    "end": "2082720"
  },
  {
    "text": "do again we try to list documents we try to list the address book and we can see",
    "start": "2082720",
    "end": "2088179"
  },
  {
    "text": "that it's not permitted but and which was not right what we could do",
    "start": "2088179",
    "end": "2093658"
  },
  {
    "text": "is create a hard link inside the documents directory pointing to the",
    "start": "2093659",
    "end": "2099820"
  },
  {
    "text": "address book this shouldn't be shouldn't work but it",
    "start": "2099820",
    "end": "2105280"
  },
  {
    "text": "did work so at that point uh we have a hard link pointing to the address book from the",
    "start": "2105280",
    "end": "2111700"
  },
  {
    "text": "document so we still cannot access any of them but now if we try to access the",
    "start": "2111700",
    "end": "2117700"
  },
  {
    "text": "address DB in documents we will get the pop-up the terminal wants to access your",
    "start": "2117700",
    "end": "2122920"
  },
  {
    "text": "documents and now if the user approves it we can access that file we still cannot",
    "start": "2122920",
    "end": "2129520"
  },
  {
    "text": "access the address book but we can access the hard link and this is a problem because the user",
    "start": "2129520",
    "end": "2135220"
  },
  {
    "text": "thinks that he gave access to the documents folder but not the address book but we can actually access the",
    "start": "2135220",
    "end": "2142119"
  },
  {
    "text": "address book it's been fixed again in the sandbox",
    "start": "2142119",
    "end": "2148540"
  },
  {
    "text": "now let's switch to Ventura changes uh quickly one of the new TCC feature is",
    "start": "2148540",
    "end": "2153820"
  },
  {
    "text": "application bundle protection basically TCC we now prevent",
    "start": "2153820",
    "end": "2160140"
  },
  {
    "text": "applications from modifying other applications this has been abused way",
    "start": "2160140",
    "end": "2166000"
  },
  {
    "text": "too many times for pawning electron based application or simply malware by",
    "start": "2166000",
    "end": "2171579"
  },
  {
    "text": "dropping files inside other applications so this is good unfortunately I managed to bypass this",
    "start": "2171579",
    "end": "2178540"
  },
  {
    "text": "three times so this is still being fixed the other thing is the endpoint security",
    "start": "2178540",
    "end": "2184839"
  },
  {
    "text": "clients uh they used to require full disk access permission for them to operate and I had",
    "start": "2184839",
    "end": "2192579"
  },
  {
    "text": "another talk at objective by the Sea about the Oculus 0 of endpoint security basically it was really easy to revoke",
    "start": "2192579",
    "end": "2199480"
  },
  {
    "text": "this permission for endpoint security clients and you could disarm any uh",
    "start": "2199480",
    "end": "2206320"
  },
  {
    "text": "security software on a Mac so this went back and forth between me and Dapper and",
    "start": "2206320",
    "end": "2211359"
  },
  {
    "text": "eventually they redesigned the way endpoint security clients got this",
    "start": "2211359",
    "end": "2217240"
  },
  {
    "text": "permission and now instead of food is accessed they required this endpoint security client permission but it still",
    "start": "2217240",
    "end": "2224200"
  },
  {
    "text": "shows up under full disk access which allows",
    "start": "2224200",
    "end": "2229420"
  },
  {
    "text": "some confusion and it turns out that they made a mistake and",
    "start": "2229420",
    "end": "2236560"
  },
  {
    "text": "Mikey found it that if you do the upgrade",
    "start": "2236560",
    "end": "2242200"
  },
  {
    "text": "on Ventura beta then there will be two new two entries now for the endpoint",
    "start": "2242200",
    "end": "2247300"
  },
  {
    "text": "security client and it will be confusing for the process and eventually the endpoint security client will not work",
    "start": "2247300",
    "end": "2254400"
  },
  {
    "text": "so my friends Patrick Wardell Thomas read and anyone who writes endpoint security software for macdaver",
    "start": "2254400",
    "end": "2260980"
  },
  {
    "text": "overwhelmed with bug reports that hey your application is broken and articles",
    "start": "2260980",
    "end": "2266500"
  },
  {
    "text": "like these started to show up uh my request wrapper please don't break",
    "start": "2266500",
    "end": "2273700"
  },
  {
    "text": "stuff while fixing my stuff this is not the fame I want",
    "start": "2273700",
    "end": "2279640"
  },
  {
    "text": "um other improvements this these are not TCC specific",
    "start": "2279640",
    "end": "2285940"
  },
  {
    "text": "um there was it was a very common attack uh to do downgrades as we saw earlier so",
    "start": "2285940",
    "end": "2293380"
  },
  {
    "text": "basically we can either use an old binary from another order OS",
    "start": "2293380",
    "end": "2298420"
  },
  {
    "text": "or we can take an application copy it out from its location embed the plugin",
    "start": "2298420",
    "end": "2304740"
  },
  {
    "text": "and and run it there are many blog post talks about it",
    "start": "2304740",
    "end": "2310119"
  },
  {
    "text": "um so one of the improvements is trust cache this is coming from the iOS word",
    "start": "2310119",
    "end": "2316980"
  },
  {
    "text": "and it's only for Apple silicon the idea is that the trust cache will have all",
    "start": "2316980",
    "end": "2323680"
  },
  {
    "text": "the hashes of all the upper binaries present on the",
    "start": "2323680",
    "end": "2329260"
  },
  {
    "text": "system and if your binary is signed by Apple it can only run if it present in",
    "start": "2329260",
    "end": "2335440"
  },
  {
    "text": "the trust cache otherwise not so it will prevent any downgrade attacks so",
    "start": "2335440",
    "end": "2340480"
  },
  {
    "text": "I cannot take for example the old Apple mobile backup utility from an old system because it will be blocked because it",
    "start": "2340480",
    "end": "2348339"
  },
  {
    "text": "doesn't present in the trust cache uh so this is pretty nice unfortunately",
    "start": "2348339",
    "end": "2353380"
  },
  {
    "text": "it's not on the Intel based version but I guess that will go away anyway in a few years and the second big one is",
    "start": "2353380",
    "end": "2359619"
  },
  {
    "text": "launch constraints um which basically controls from where",
    "start": "2359619",
    "end": "2365320"
  },
  {
    "text": "and who can start an Apple sign binary on the system uh so for example even if an Apple sign",
    "start": "2365320",
    "end": "2373900"
  },
  {
    "text": "Daemon meant to be started by launch D only launch D can start it so I cannot",
    "start": "2373900",
    "end": "2378940"
  },
  {
    "text": "start it anymore from the command line and the other thing is that I cannot copy out an application from its trusted",
    "start": "2378940",
    "end": "2385839"
  },
  {
    "text": "location and run it so it has to reside on their system",
    "start": "2385839",
    "end": "2391440"
  },
  {
    "text": "uh which is pretty nice more from it is written by Linus hanza on his blog",
    "start": "2391440",
    "end": "2398619"
  },
  {
    "text": "post thank you very much that was all uh either a question I'm not sure if I have",
    "start": "2398619",
    "end": "2404859"
  },
  {
    "text": "time for question but you can find me here afterwards thank you",
    "start": "2404859",
    "end": "2409900"
  },
  {
    "text": "foreign [Music]",
    "start": "2409900",
    "end": "2414580"
  },
  {
    "text": "[Music]",
    "start": "2418420",
    "end": "2421530"
  }
]