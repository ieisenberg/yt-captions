[
  {
    "text": "hi so in this talk we are going to",
    "start": "30",
    "end": "2399"
  },
  {
    "text": "discuss about KVM hypervisor or arm",
    "start": "2399",
    "end": "4890"
  },
  {
    "text": "systems as you know that KVM hypervisor",
    "start": "4890",
    "end": "6960"
  },
  {
    "text": "are the part of linux kernel and so they",
    "start": "6960",
    "end": "10889"
  },
  {
    "text": "are automatically available to the",
    "start": "10889",
    "end": "12509"
  },
  {
    "text": "devices in which linux kernel is running",
    "start": "12509",
    "end": "15240"
  },
  {
    "text": "and we know that linux is running in all",
    "start": "15240",
    "end": "18420"
  },
  {
    "text": "sort of devices from a traffic control",
    "start": "18420",
    "end": "20730"
  },
  {
    "text": "system to self-driving cars to the home",
    "start": "20730",
    "end": "24420"
  },
  {
    "text": "appliances that we had we have at home",
    "start": "24420",
    "end": "26430"
  },
  {
    "text": "so it may be possible that some of the",
    "start": "26430",
    "end": "28949"
  },
  {
    "text": "devices around us will have a VM enabled",
    "start": "28949",
    "end": "32099"
  },
  {
    "text": "on it as well so in this talk we will",
    "start": "32099",
    "end": "34860"
  },
  {
    "text": "talk about the security for floor using",
    "start": "34860",
    "end": "37770"
  },
  {
    "text": "which it is possible for an attacker to",
    "start": "37770",
    "end": "40100"
  },
  {
    "text": "gain a privilege on hypervisor that is",
    "start": "40100",
    "end": "43980"
  },
  {
    "text": "running with a mode privilege level from",
    "start": "43980",
    "end": "46079"
  },
  {
    "text": "a less privileged kernel mode so before",
    "start": "46079",
    "end": "50460"
  },
  {
    "text": "I start my talk I would like to",
    "start": "50460",
    "end": "51870"
  },
  {
    "text": "introduce myself so I work for Samsung",
    "start": "51870",
    "end": "54210"
  },
  {
    "text": "Research America and before joining",
    "start": "54210",
    "end": "58469"
  },
  {
    "text": "Samsung research America I work for",
    "start": "58469",
    "end": "60539"
  },
  {
    "text": "various other companies like McAfee",
    "start": "60539",
    "end": "62340"
  },
  {
    "text": "Citrix and bromium and I've worked in",
    "start": "62340",
    "end": "65460"
  },
  {
    "text": "various areas of security like Volante",
    "start": "65460",
    "end": "69360"
  },
  {
    "text": "research security LC and also I have",
    "start": "69360",
    "end": "72510"
  },
  {
    "text": "architected and developed a malware",
    "start": "72510",
    "end": "74130"
  },
  {
    "text": "detection engine for bromium so right",
    "start": "74130",
    "end": "77220"
  },
  {
    "text": "now I'm actively working on on system",
    "start": "77220",
    "end": "79049"
  },
  {
    "text": "security and so this paper is one of my",
    "start": "79049",
    "end": "82740"
  },
  {
    "text": "research on arm system security and the",
    "start": "82740",
    "end": "86009"
  },
  {
    "text": "opinion that I am sharing with this",
    "start": "86009",
    "end": "87270"
  },
  {
    "text": "paper is my personal opinion and it may",
    "start": "87270",
    "end": "89340"
  },
  {
    "text": "not represent the open era I employ just",
    "start": "89340",
    "end": "91170"
  },
  {
    "text": "a disclaimer so so just to give you some",
    "start": "91170",
    "end": "96689"
  },
  {
    "text": "background about this flaw so I found",
    "start": "96689",
    "end": "99570"
  },
  {
    "text": "this flaw early this year while doing",
    "start": "99570",
    "end": "102180"
  },
  {
    "text": "some research on arm hypervisors so and",
    "start": "102180",
    "end": "105360"
  },
  {
    "text": "on 25th January I reported this issue to",
    "start": "105360",
    "end": "108659"
  },
  {
    "text": "the to Reddit product security team and",
    "start": "108659",
    "end": "111149"
  },
  {
    "text": "with that I provided them a complete",
    "start": "111149",
    "end": "113579"
  },
  {
    "text": "detailed report and an and exploit code",
    "start": "113579",
    "end": "117390"
  },
  {
    "text": "and after that we had multiple email",
    "start": "117390",
    "end": "119969"
  },
  {
    "text": "exchanges and I had them understanding",
    "start": "119969",
    "end": "122820"
  },
  {
    "text": "the problem and finally they understood",
    "start": "122820",
    "end": "124680"
  },
  {
    "text": "the problem and after that they",
    "start": "124680",
    "end": "126890"
  },
  {
    "text": "escalated that to the KVM team but this",
    "start": "126890",
    "end": "130489"
  },
  {
    "text": "flaw is still not fixed so I decided to",
    "start": "130489",
    "end": "133590"
  },
  {
    "text": "submit a blackhat paper and thanks to",
    "start": "133590",
    "end": "135480"
  },
  {
    "text": "blackhat for providing a platform to",
    "start": "135480",
    "end": "137040"
  },
  {
    "text": "share my research okay so I will start",
    "start": "137040",
    "end": "141660"
  },
  {
    "text": "with the basic arm v8a architecture so",
    "start": "141660",
    "end": "145349"
  },
  {
    "text": "as we know in our v8a there are four",
    "start": "145349",
    "end": "147450"
  },
  {
    "text": "exception levels and program executes in",
    "start": "147450",
    "end": "150269"
  },
  {
    "text": "one of these four extra levels so",
    "start": "150269",
    "end": "153450"
  },
  {
    "text": "exception levels determines the",
    "start": "153450",
    "end": "155099"
  },
  {
    "text": "privilege level higher the exception",
    "start": "155099",
    "end": "156540"
  },
  {
    "text": "value more privilege it has so",
    "start": "156540",
    "end": "160519"
  },
  {
    "text": "hypervisor running in el2 will have more",
    "start": "160519",
    "end": "162959"
  },
  {
    "text": "privileged than the guest OS that is",
    "start": "162959",
    "end": "164489"
  },
  {
    "text": "running in el1 so if the OS wants to",
    "start": "164489",
    "end": "168660"
  },
  {
    "text": "require some service from hypervisor for",
    "start": "168660",
    "end": "170760"
  },
  {
    "text": "that there is a special instruction",
    "start": "170760",
    "end": "172260"
  },
  {
    "text": "called HVC that is hypervisor called",
    "start": "172260",
    "end": "175730"
  },
  {
    "text": "when these instructions are executed",
    "start": "175730",
    "end": "178040"
  },
  {
    "text": "they result into a synchronous exception",
    "start": "178040",
    "end": "181019"
  },
  {
    "text": "and these exceptions are handled by the",
    "start": "181019",
    "end": "184049"
  },
  {
    "text": "hypervisor the hypervisor has the",
    "start": "184049",
    "end": "186420"
  },
  {
    "text": "handler code in it and through that",
    "start": "186420",
    "end": "188640"
  },
  {
    "text": "exception handler hypervisor services",
    "start": "188640",
    "end": "190890"
  },
  {
    "text": "the request back so this is how secure",
    "start": "190890",
    "end": "193379"
  },
  {
    "text": "communication happens between OS and",
    "start": "193379",
    "end": "195480"
  },
  {
    "text": "hypervisor",
    "start": "195480",
    "end": "196079"
  },
  {
    "text": "and so the movement any exception occurs",
    "start": "196079",
    "end": "198720"
  },
  {
    "text": "CPU executes its corresponding handler",
    "start": "198720",
    "end": "202139"
  },
  {
    "text": "code so the location where this handler",
    "start": "202139",
    "end": "204359"
  },
  {
    "text": "ports are stored are called",
    "start": "204359",
    "end": "205859"
  },
  {
    "text": "exception vectors and these vectors are",
    "start": "205859",
    "end": "208859"
  },
  {
    "text": "stored in a special table called",
    "start": "208859",
    "end": "210959"
  },
  {
    "text": "exception vector table and every e-l",
    "start": "210959",
    "end": "215549"
  },
  {
    "text": "every exception level has its own vector",
    "start": "215549",
    "end": "218250"
  },
  {
    "text": "table so l1 will have its own l2 will",
    "start": "218250",
    "end": "221130"
  },
  {
    "text": "have its own and similarly l3 so in this",
    "start": "221130",
    "end": "226079"
  },
  {
    "text": "talk we will just talk about l2 x s no",
    "start": "226079",
    "end": "228030"
  },
  {
    "text": "vector table and because we are just",
    "start": "228030",
    "end": "229590"
  },
  {
    "text": "talking about hypervisors so and the",
    "start": "229590",
    "end": "233819"
  },
  {
    "text": "base address of this exception vector",
    "start": "233819",
    "end": "235769"
  },
  {
    "text": "tables are stored in a special register",
    "start": "235769",
    "end": "237840"
  },
  {
    "text": "called v bar registers and this V bar",
    "start": "237840",
    "end": "241669"
  },
  {
    "text": "ETL has its own V Bar register as well",
    "start": "241669",
    "end": "244169"
  },
  {
    "text": "that points to the corresponding",
    "start": "244169",
    "end": "245730"
  },
  {
    "text": "expression vector table for that",
    "start": "245730",
    "end": "246870"
  },
  {
    "text": "particular PL so V Bar e l2 will point",
    "start": "246870",
    "end": "250709"
  },
  {
    "text": "to exception vector table of l2 and this",
    "start": "250709",
    "end": "255630"
  },
  {
    "text": "expression vector table has 16 handlers",
    "start": "255630",
    "end": "257669"
  },
  {
    "text": "in it and each handlers are executed",
    "start": "257669",
    "end": "259859"
  },
  {
    "text": "based on the kind of reception so",
    "start": "259859",
    "end": "263080"
  },
  {
    "text": "in case of HVC that is originating from",
    "start": "263080",
    "end": "265599"
  },
  {
    "text": "64-bit kernel the exception handler that",
    "start": "265599",
    "end": "267789"
  },
  {
    "text": "will be executed will be at an offset of",
    "start": "267789",
    "end": "269919"
  },
  {
    "text": "zero X 400 so when H VC is originated",
    "start": "269919",
    "end": "274990"
  },
  {
    "text": "from 64 64-bit kernel CPU refers to this",
    "start": "274990",
    "end": "279039"
  },
  {
    "text": "v bar el2 register obtains the pointer",
    "start": "279039",
    "end": "282009"
  },
  {
    "text": "then it adds 0 X 400 to it and then",
    "start": "282009",
    "end": "285280"
  },
  {
    "text": "executes the handler code from there and",
    "start": "285280",
    "end": "288150"
  },
  {
    "text": "this is how hypervisor services the",
    "start": "288150",
    "end": "291430"
  },
  {
    "text": "request to the OS and they communicate",
    "start": "291430",
    "end": "294280"
  },
  {
    "text": "with each other so this explains us",
    "start": "294280",
    "end": "297069"
  },
  {
    "text": "between how the comic internally how the",
    "start": "297069",
    "end": "298930"
  },
  {
    "text": "communication happens between the OS and",
    "start": "298930",
    "end": "300969"
  },
  {
    "text": "the hypervisors now we will see the",
    "start": "300969",
    "end": "304150"
  },
  {
    "text": "hypervisor on arm so in order to support",
    "start": "304150",
    "end": "308139"
  },
  {
    "text": "virtualization in arm hypervisor has to",
    "start": "308139",
    "end": "310300"
  },
  {
    "text": "execute in l2 and this is needed because",
    "start": "310300",
    "end": "313780"
  },
  {
    "text": "in order to access the hardware that is",
    "start": "313780",
    "end": "316990"
  },
  {
    "text": "needed to support virtualization a",
    "start": "316990",
    "end": "318690"
  },
  {
    "text": "software can access those hardware from",
    "start": "318690",
    "end": "321580"
  },
  {
    "text": "el2 so that's why your appetizer has to",
    "start": "321580",
    "end": "324310"
  },
  {
    "text": "execute in el2 some of some portion of",
    "start": "324310",
    "end": "326319"
  },
  {
    "text": "it has to be present in the l2 and there",
    "start": "326319",
    "end": "330069"
  },
  {
    "text": "are two kinds of hypervisors type 1",
    "start": "330069",
    "end": "332440"
  },
  {
    "text": "hypervisor and type 2 hypervisors so",
    "start": "332440",
    "end": "335430"
  },
  {
    "text": "type 1 hypervisor czar the bare-metal",
    "start": "335430",
    "end": "337810"
  },
  {
    "text": "hypervisor and the host is considered as",
    "start": "337810",
    "end": "342699"
  },
  {
    "text": "a VM in that so that is the main",
    "start": "342699",
    "end": "345219"
  },
  {
    "text": "difference between type 1 and type 2 so",
    "start": "345219",
    "end": "346750"
  },
  {
    "text": "host is considered a VM and Xen is a",
    "start": "346750",
    "end": "349150"
  },
  {
    "text": "classic example of type 1 hypervisor and",
    "start": "349150",
    "end": "351250"
  },
  {
    "text": "it runs completely niall to on arm and",
    "start": "351250",
    "end": "355650"
  },
  {
    "text": "type 2 hypervisor",
    "start": "355650",
    "end": "357520"
  },
  {
    "text": "the extension of the host kernel so",
    "start": "357520",
    "end": "359289"
  },
  {
    "text": "that's why the host kernel is not",
    "start": "359289",
    "end": "361210"
  },
  {
    "text": "considered as a VM in that and KVM is a",
    "start": "361210",
    "end": "364569"
  },
  {
    "text": "type 2 hypervisor and KVM runs partially",
    "start": "364569",
    "end": "367900"
  },
  {
    "text": "in al2 so4 arm a VM has two component a",
    "start": "367900",
    "end": "371560"
  },
  {
    "text": "low wiser and high riser loaiza runs in",
    "start": "371560",
    "end": "374650"
  },
  {
    "text": "el2 and this is the core guy and it does",
    "start": "374650",
    "end": "377949"
  },
  {
    "text": "the configuration of the hardware and",
    "start": "377949",
    "end": "381210"
  },
  {
    "text": "the VM switching so this this component",
    "start": "381210",
    "end": "385090"
  },
  {
    "text": "does the low level stuff and the high",
    "start": "385090",
    "end": "387159"
  },
  {
    "text": "visor runs with the Linux kernel and it",
    "start": "387159",
    "end": "389500"
  },
  {
    "text": "uses the resources that are provided by",
    "start": "389500",
    "end": "391330"
  },
  {
    "text": "the",
    "start": "391330",
    "end": "392200"
  },
  {
    "text": "Scanlan okay so in order to support KVM",
    "start": "392200",
    "end": "397780"
  },
  {
    "text": "in linux",
    "start": "397780",
    "end": "398920"
  },
  {
    "text": "so linux has to boot in l2 so the one of",
    "start": "398920",
    "end": "402730"
  },
  {
    "text": "the initial thing that linux does when",
    "start": "402730",
    "end": "404410"
  },
  {
    "text": "it starts to boot is it checks the",
    "start": "404410",
    "end": "406510"
  },
  {
    "text": "current TL value the exception level",
    "start": "406510",
    "end": "408310"
  },
  {
    "text": "value so if the attrition level value is",
    "start": "408310",
    "end": "410950"
  },
  {
    "text": "2 then it knows that ok I am running in",
    "start": "410950",
    "end": "414160"
  },
  {
    "text": "the l2 so I can a bit I can access vbar",
    "start": "414160",
    "end": "416560"
  },
  {
    "text": "el2 register because V bar ul to",
    "start": "416560",
    "end": "418210"
  },
  {
    "text": "register can't be accessed from the l1",
    "start": "418210",
    "end": "420130"
  },
  {
    "text": "directly in C it can't be accessible",
    "start": "420130",
    "end": "422410"
  },
  {
    "text": "from view element so now if Linux knows",
    "start": "422410",
    "end": "425980"
  },
  {
    "text": "that it is running in el2 so it can",
    "start": "425980",
    "end": "428290"
  },
  {
    "text": "access view arielle to register so it",
    "start": "428290",
    "end": "430570"
  },
  {
    "text": "updates the V Bar ul to register and",
    "start": "430570",
    "end": "432610"
  },
  {
    "text": "make sure that it points to star vector",
    "start": "432610",
    "end": "435190"
  },
  {
    "text": "table we will discuss about what this",
    "start": "435190",
    "end": "437710"
  },
  {
    "text": "stuff actor table is so it and after",
    "start": "437710",
    "end": "441190"
  },
  {
    "text": "updating that it switches back to l1 and",
    "start": "441190",
    "end": "443500"
  },
  {
    "text": "normal good flow happens so what it is",
    "start": "443500",
    "end": "445690"
  },
  {
    "text": "doing is that it is registering star",
    "start": "445690",
    "end": "447400"
  },
  {
    "text": "vector table as an exception vector",
    "start": "447400",
    "end": "449170"
  },
  {
    "text": "table for e l2 and after that normal",
    "start": "449170",
    "end": "451840"
  },
  {
    "text": "boot flow happens and it is very common",
    "start": "451840",
    "end": "456190"
  },
  {
    "text": "practice to start Linux in l2 if the",
    "start": "456190",
    "end": "460030"
  },
  {
    "text": "processor supports that mode as you can",
    "start": "460030",
    "end": "462490"
  },
  {
    "text": "see this code has been taken from the",
    "start": "462490",
    "end": "465300"
  },
  {
    "text": "prostrate form a repo and this is for",
    "start": "465300",
    "end": "468250"
  },
  {
    "text": "the raspberry pi device as you can see",
    "start": "468250",
    "end": "469900"
  },
  {
    "text": "the control is transferred into e l2 if",
    "start": "469900",
    "end": "474210"
  },
  {
    "text": "for these devices because they'd support",
    "start": "474210",
    "end": "476770"
  },
  {
    "text": "that mode and the chances are high that",
    "start": "476770",
    "end": "479130"
  },
  {
    "text": "Linux will start any l2 and so the stuff",
    "start": "479130",
    "end": "482200"
  },
  {
    "text": "vector table will be installed and KVM",
    "start": "482200",
    "end": "485020"
  },
  {
    "text": "will be enabled so let's go inside this",
    "start": "485020",
    "end": "488590"
  },
  {
    "text": "stuff vector table so this is standard",
    "start": "488590",
    "end": "491710"
  },
  {
    "text": "vector table it has 16 entry as we",
    "start": "491710",
    "end": "494170"
  },
  {
    "text": "discussed in the in the vector table",
    "start": "494170",
    "end": "496900"
  },
  {
    "text": "slide and the handler that will be",
    "start": "496900",
    "end": "500230"
  },
  {
    "text": "called will be l1 underscore Singh so",
    "start": "500230",
    "end": "503020"
  },
  {
    "text": "this this handler will be called when",
    "start": "503020",
    "end": "505000"
  },
  {
    "text": "hvc will be executed by 64-bit kernel so",
    "start": "505000",
    "end": "509830"
  },
  {
    "text": "it will go inside this handler function",
    "start": "509830",
    "end": "511930"
  },
  {
    "text": "we will see that this processes three",
    "start": "511930",
    "end": "516969"
  },
  {
    "text": "commands based on the x0 register value",
    "start": "516970",
    "end": "519880"
  },
  {
    "text": "so if X 0 register value is",
    "start": "519880",
    "end": "523080"
  },
  {
    "text": "then it updates the VAR e l2 register",
    "start": "523080",
    "end": "526230"
  },
  {
    "text": "with the value that hasn't passed in x1",
    "start": "526230",
    "end": "528300"
  },
  {
    "text": "register so what this means is that once",
    "start": "528300",
    "end": "532350"
  },
  {
    "text": "this stuff vector table is installed as",
    "start": "532350",
    "end": "534000"
  },
  {
    "text": "a exception factor table for e l2 it",
    "start": "534000",
    "end": "536160"
  },
  {
    "text": "provides the interface using which a",
    "start": "536160",
    "end": "537900"
  },
  {
    "text": "software running in l1 can update V Bar",
    "start": "537900",
    "end": "540840"
  },
  {
    "text": "e l2 register and install another",
    "start": "540840",
    "end": "542340"
  },
  {
    "text": "exception vector table for e l2 so so we",
    "start": "542340",
    "end": "549990"
  },
  {
    "text": "will see all this with the state diagram",
    "start": "549990",
    "end": "551280"
  },
  {
    "text": "to make things more clear so let it",
    "start": "551280",
    "end": "554910"
  },
  {
    "text": "started and it started in e l2 so it",
    "start": "554910",
    "end": "558240"
  },
  {
    "text": "updates the v bar UL to register and",
    "start": "558240",
    "end": "561030"
  },
  {
    "text": "makes your make sure that v bar en to",
    "start": "561030",
    "end": "563580"
  },
  {
    "text": "register points to the rest of vector",
    "start": "563580",
    "end": "565140"
  },
  {
    "text": "table and after that stuff editable",
    "start": "565140",
    "end": "567990"
  },
  {
    "text": "provides the interface using which it is",
    "start": "567990",
    "end": "569940"
  },
  {
    "text": "possible to update aviv arielle to",
    "start": "569940",
    "end": "574440"
  },
  {
    "text": "register and register a new accession",
    "start": "574440",
    "end": "575970"
  },
  {
    "text": "vector table for e l2 so using this",
    "start": "575970",
    "end": "581040"
  },
  {
    "text": "interface linux installs the actual k vm",
    "start": "581040",
    "end": "584460"
  },
  {
    "text": "vector table so this is the actual k vm",
    "start": "584460",
    "end": "586710"
  },
  {
    "text": "vector table this this will be installed",
    "start": "586710",
    "end": "588750"
  },
  {
    "text": "in a machine in which KVM is running and",
    "start": "588750",
    "end": "593510"
  },
  {
    "text": "in between these two lot of things",
    "start": "593510",
    "end": "595860"
  },
  {
    "text": "happens but that is out of scope of this",
    "start": "595860",
    "end": "597810"
  },
  {
    "text": "talk so once the KVM is running this",
    "start": "597810",
    "end": "601470"
  },
  {
    "text": "vector table will be installed we will",
    "start": "601470",
    "end": "603330"
  },
  {
    "text": "go inside the HVC handler of this k vm",
    "start": "603330",
    "end": "605400"
  },
  {
    "text": "vector table so this is the handler of",
    "start": "605400",
    "end": "608970"
  },
  {
    "text": "hpc handler of the k vm vector table so",
    "start": "608970",
    "end": "611730"
  },
  {
    "text": "the very first thing this handler",
    "start": "611730",
    "end": "615540"
  },
  {
    "text": "function is doing is that it is checking",
    "start": "615540",
    "end": "617160"
  },
  {
    "text": "from where that call has originated",
    "start": "617160",
    "end": "618720"
  },
  {
    "text": "whether it has originated from the host",
    "start": "618720",
    "end": "620840"
  },
  {
    "text": "kernel or from the guest kernel so if",
    "start": "620840",
    "end": "624750"
  },
  {
    "text": "and this check is very important that's",
    "start": "624750",
    "end": "627540"
  },
  {
    "text": "why the privilege escalation is not",
    "start": "627540",
    "end": "629190"
  },
  {
    "text": "possible from the guest kernel so the",
    "start": "629190",
    "end": "632760"
  },
  {
    "text": "movement it deserve when it finds that",
    "start": "632760",
    "end": "636480"
  },
  {
    "text": "the HVC is from the host kernel then the",
    "start": "636480",
    "end": "639600"
  },
  {
    "text": "control goes down and it checks the",
    "start": "639600",
    "end": "641370"
  },
  {
    "text": "value of x 0 register whether it is less",
    "start": "641370",
    "end": "643500"
  },
  {
    "text": "than 3 or not and if it is less than 3",
    "start": "643500",
    "end": "645720"
  },
  {
    "text": "then it then it calls another function",
    "start": "645720",
    "end": "647130"
  },
  {
    "text": "called underscore KVM handle stuff HVC",
    "start": "647130",
    "end": "650760"
  },
  {
    "text": "so it will go inside this function",
    "start": "650760",
    "end": "653860"
  },
  {
    "text": "we will see that there is a command",
    "start": "653860",
    "end": "656020"
  },
  {
    "text": "called hvc reset vector command and with",
    "start": "656020",
    "end": "659020"
  },
  {
    "text": "this command if that's a zero value is",
    "start": "659020",
    "end": "662290"
  },
  {
    "text": "true with this command it disables the",
    "start": "662290",
    "end": "664210"
  },
  {
    "text": "memory management unit of e l2 and after",
    "start": "664210",
    "end": "667600"
  },
  {
    "text": "disabling the memory management unit of",
    "start": "667600",
    "end": "669280"
  },
  {
    "text": "el2 it installs the star vector back",
    "start": "669280",
    "end": "671410"
  },
  {
    "text": "into the system so what this means is",
    "start": "671410",
    "end": "674380"
  },
  {
    "text": "that na stock vector table is back into",
    "start": "674380",
    "end": "678340"
  },
  {
    "text": "the system and star vector table",
    "start": "678340",
    "end": "679720"
  },
  {
    "text": "provides the interface using which it is",
    "start": "679720",
    "end": "681370"
  },
  {
    "text": "possible to install another exception",
    "start": "681370",
    "end": "683410"
  },
  {
    "text": "vector table for l2 so so attacker can",
    "start": "683410",
    "end": "687580"
  },
  {
    "text": "use this interface to install an",
    "start": "687580",
    "end": "689860"
  },
  {
    "text": "attacker exceptional vector table so we",
    "start": "689860",
    "end": "691780"
  },
  {
    "text": "will see with this with the straight",
    "start": "691780",
    "end": "693460"
  },
  {
    "text": "diagram so now KVM is running and the K",
    "start": "693460",
    "end": "698530"
  },
  {
    "text": "vector table provides an interface",
    "start": "698530",
    "end": "700030"
  },
  {
    "text": "called HVC reset vector interface and if",
    "start": "700030",
    "end": "703570"
  },
  {
    "text": "that hvc is all related from the host",
    "start": "703570",
    "end": "705400"
  },
  {
    "text": "kernel then the V then the V bar e l2",
    "start": "705400",
    "end": "709600"
  },
  {
    "text": "will point to the star vector table and",
    "start": "709600",
    "end": "712470"
  },
  {
    "text": "the store vector table will be",
    "start": "712470",
    "end": "714520"
  },
  {
    "text": "registered as a exception vector table",
    "start": "714520",
    "end": "715960"
  },
  {
    "text": "and this stuff vector table provide we",
    "start": "715960",
    "end": "718720"
  },
  {
    "text": "already discussed that it provides",
    "start": "718720",
    "end": "720220"
  },
  {
    "text": "interface using which another vector",
    "start": "720220",
    "end": "723040"
  },
  {
    "text": "table can be registered so attacker can",
    "start": "723040",
    "end": "725230"
  },
  {
    "text": "will register its own exception vector",
    "start": "725230",
    "end": "727330"
  },
  {
    "text": "table and get control over the e l2 so",
    "start": "727330",
    "end": "733710"
  },
  {
    "text": "now we will see with how the attacker",
    "start": "733710",
    "end": "736690"
  },
  {
    "text": "will exploit this in order to get code",
    "start": "736690",
    "end": "739090"
  },
  {
    "text": "execution in l2 from ill host e l1 and",
    "start": "739090",
    "end": "742170"
  },
  {
    "text": "this will explain things more clearly so",
    "start": "742170",
    "end": "745240"
  },
  {
    "text": "in order to skewed code from host l1 to",
    "start": "745240",
    "end": "748030"
  },
  {
    "text": "l2 attacker will first load the value 2",
    "start": "748030",
    "end": "750880"
  },
  {
    "text": "into X 0 register that means attacker",
    "start": "750880",
    "end": "754180"
  },
  {
    "text": "wants to send hvc reset vector command",
    "start": "754180",
    "end": "756100"
  },
  {
    "text": "it want to reset the vector star vector",
    "start": "756100",
    "end": "758470"
  },
  {
    "text": "table back into the system and then it",
    "start": "758470",
    "end": "762970"
  },
  {
    "text": "will execute hvc this HVC will be",
    "start": "762970",
    "end": "766090"
  },
  {
    "text": "handled by the KVM vector table because",
    "start": "766090",
    "end": "769570"
  },
  {
    "text": "kavia vector table is registered as an",
    "start": "769570",
    "end": "771100"
  },
  {
    "text": "exception vector table and the handler",
    "start": "771100",
    "end": "773170"
  },
  {
    "text": "of the K vector table will disable the",
    "start": "773170",
    "end": "774850"
  },
  {
    "text": "memory management unit of e l2 and after",
    "start": "774850",
    "end": "776980"
  },
  {
    "text": "disabling the memory management unit of",
    "start": "776980",
    "end": "778690"
  },
  {
    "text": "l2",
    "start": "778690",
    "end": "779350"
  },
  {
    "text": "it will install the star vector table",
    "start": "779350",
    "end": "781360"
  },
  {
    "text": "back into the system so now a stop",
    "start": "781360",
    "end": "783580"
  },
  {
    "text": "vector table is back in action after",
    "start": "783580",
    "end": "786160"
  },
  {
    "text": "this",
    "start": "786160",
    "end": "787020"
  },
  {
    "text": "attacker will allocate a physical",
    "start": "787020",
    "end": "789280"
  },
  {
    "text": "continuous memory he a physical",
    "start": "789280",
    "end": "791740"
  },
  {
    "text": "continuous memory is needed because the",
    "start": "791740",
    "end": "795100"
  },
  {
    "text": "memory management unit of el2 has been",
    "start": "795100",
    "end": "797050"
  },
  {
    "text": "disabled and attacker wants to allocate",
    "start": "797050",
    "end": "799240"
  },
  {
    "text": "a physical continuous memory and it",
    "start": "799240",
    "end": "800920"
  },
  {
    "text": "wants to register that physical",
    "start": "800920",
    "end": "802450"
  },
  {
    "text": "continuous memory as a exception vector",
    "start": "802450",
    "end": "804190"
  },
  {
    "text": "table for e l2 and then attacker will",
    "start": "804190",
    "end": "807760"
  },
  {
    "text": "embed a shell code at an offset of zero",
    "start": "807760",
    "end": "809440"
  },
  {
    "text": "X 400 zero X 400 because the exception",
    "start": "809440",
    "end": "814780"
  },
  {
    "text": "handler is at this particular address",
    "start": "814780",
    "end": "816450"
  },
  {
    "text": "then attacker will load the value 0 into",
    "start": "816450",
    "end": "819400"
  },
  {
    "text": "X 0 register and then the physical",
    "start": "819400",
    "end": "822670"
  },
  {
    "text": "address will be loaded in X 1 register",
    "start": "822670",
    "end": "825100"
  },
  {
    "text": "and again H PC will be called after",
    "start": "825100",
    "end": "828520"
  },
  {
    "text": "these forced steps this hvc will be",
    "start": "828520",
    "end": "831250"
  },
  {
    "text": "handled by the stuff vector table",
    "start": "831250",
    "end": "832930"
  },
  {
    "text": "because now star vector table is back",
    "start": "832930",
    "end": "834580"
  },
  {
    "text": "into action and the handler or store",
    "start": "834580",
    "end": "837640"
  },
  {
    "text": "vector table will install the electric",
    "start": "837640",
    "end": "840670"
  },
  {
    "text": "are allocated buffer as a exception",
    "start": "840670",
    "end": "843070"
  },
  {
    "text": "vector table for e l2 and after that",
    "start": "843070",
    "end": "847270"
  },
  {
    "text": "once this is done and the shell code is",
    "start": "847270",
    "end": "849160"
  },
  {
    "text": "at an offset of zero X 400 so attacker",
    "start": "849160",
    "end": "851410"
  },
  {
    "text": "need to execute another just as hvc",
    "start": "851410",
    "end": "853690"
  },
  {
    "text": "called and game over so attacker is able",
    "start": "853690",
    "end": "856660"
  },
  {
    "text": "to execute code in e l2 so after",
    "start": "856660",
    "end": "860830"
  },
  {
    "text": "providing this much of detail to KVM",
    "start": "860830",
    "end": "864700"
  },
  {
    "text": "team and the linux team I got this reply",
    "start": "864700",
    "end": "869740"
  },
  {
    "text": "from them so based on their reply it",
    "start": "869740",
    "end": "874540"
  },
  {
    "text": "seems like their threat model assumption",
    "start": "874540",
    "end": "877870"
  },
  {
    "text": "is the code that is running in the hosts",
    "start": "877870",
    "end": "880000"
  },
  {
    "text": "l1 is equivalent to the code that is",
    "start": "880000",
    "end": "882070"
  },
  {
    "text": "running in l2 and that's why they don't",
    "start": "882070",
    "end": "885610"
  },
  {
    "text": "care about the privileged host that they",
    "start": "885610",
    "end": "888400"
  },
  {
    "text": "have added into the isolation boundary",
    "start": "888400",
    "end": "890140"
  },
  {
    "text": "and they don't think that this is a",
    "start": "890140",
    "end": "893530"
  },
  {
    "text": "security issue at all that's why and",
    "start": "893530",
    "end": "895300"
  },
  {
    "text": "they think that if host kernel is",
    "start": "895300",
    "end": "897190"
  },
  {
    "text": "compromised game is already over but in",
    "start": "897190",
    "end": "901180"
  },
  {
    "text": "practice l1 is not equal to l2 and l1",
    "start": "901180",
    "end": "906070"
  },
  {
    "text": "has lot more code running than l2 l1 has",
    "start": "906070",
    "end": "910240"
  },
  {
    "text": "wider attack vector than l2 because it",
    "start": "910240",
    "end": "912250"
  },
  {
    "text": "is interacting to outside world it is it",
    "start": "912250",
    "end": "915400"
  },
  {
    "text": "may have some custom driver running in",
    "start": "915400",
    "end": "917110"
  },
  {
    "text": "it so l1 has lot more attack vector as",
    "start": "917110",
    "end": "919990"
  },
  {
    "text": "compared to L 2 L",
    "start": "919990",
    "end": "921010"
  },
  {
    "text": "is running in lot more closed",
    "start": "921010",
    "end": "922630"
  },
  {
    "text": "environment the interaction is very",
    "start": "922630",
    "end": "924370"
  },
  {
    "text": "closed for ul - it's a hypervisor so",
    "start": "924370",
    "end": "928260"
  },
  {
    "text": "what the thing as an end of game can be",
    "start": "928260",
    "end": "930940"
  },
  {
    "text": "a beginning of a new game for an",
    "start": "930940",
    "end": "932230"
  },
  {
    "text": "attacker so if I'm an attacker and if I",
    "start": "932230",
    "end": "937000"
  },
  {
    "text": "manage to get into the hosts el1 the",
    "start": "937000",
    "end": "940720"
  },
  {
    "text": "first thing that I will do is that I",
    "start": "940720",
    "end": "941980"
  },
  {
    "text": "will exploit this design and I will",
    "start": "941980",
    "end": "945040"
  },
  {
    "text": "migrate my attack into l2 and once I",
    "start": "945040",
    "end": "947830"
  },
  {
    "text": "migrated my attack into l2 I will make",
    "start": "947830",
    "end": "950710"
  },
  {
    "text": "sure that my attack is isolated by",
    "start": "950710",
    "end": "955330"
  },
  {
    "text": "conferring stairs to page table so that",
    "start": "955330",
    "end": "957610"
  },
  {
    "text": "the code that is the memory scanner that",
    "start": "957610",
    "end": "959710"
  },
  {
    "text": "is running in l1 will not be able to see",
    "start": "959710",
    "end": "962440"
  },
  {
    "text": "my code and so that will make my code",
    "start": "962440",
    "end": "964660"
  },
  {
    "text": "very stealthy in nature it will be hard",
    "start": "964660",
    "end": "966610"
  },
  {
    "text": "to detect my attack after doing that I",
    "start": "966610",
    "end": "969550"
  },
  {
    "text": "can also configure l2 in lot of",
    "start": "969550",
    "end": "971380"
  },
  {
    "text": "different ways to make sure that I am",
    "start": "971380",
    "end": "973210"
  },
  {
    "text": "getting the control from various",
    "start": "973210",
    "end": "974860"
  },
  {
    "text": "different places like conferring",
    "start": "974860",
    "end": "978550"
  },
  {
    "text": "interrupts and all and that will and l1",
    "start": "978550",
    "end": "982630"
  },
  {
    "text": "will not even know about it and the",
    "start": "982630",
    "end": "985330"
  },
  {
    "text": "third thing is that I can use this to",
    "start": "985330",
    "end": "987370"
  },
  {
    "text": "bypass a lot of the production mechanism",
    "start": "987370",
    "end": "989530"
  },
  {
    "text": "that are implemented in the kernel like",
    "start": "989530",
    "end": "991210"
  },
  {
    "text": "patch guard or Linux runtime guard in a",
    "start": "991210",
    "end": "994120"
  },
  {
    "text": "generic way by directly skipping into l2",
    "start": "994120",
    "end": "996720"
  },
  {
    "text": "and fourth is that if somebody has",
    "start": "996720",
    "end": "1001800"
  },
  {
    "text": "implemented some secure monitoring",
    "start": "1001800",
    "end": "1003420"
  },
  {
    "text": "software in hypervisor using KVM",
    "start": "1003420",
    "end": "1005310"
  },
  {
    "text": "something they have custom",
    "start": "1005310",
    "end": "1006810"
  },
  {
    "text": "implementation so attacker can attack",
    "start": "1006810",
    "end": "1009750"
  },
  {
    "text": "those things as well by because now",
    "start": "1009750",
    "end": "1013860"
  },
  {
    "text": "attacker is able to execute code in l2",
    "start": "1013860",
    "end": "1016640"
  },
  {
    "text": "so seeing all this point it seems like",
    "start": "1016640",
    "end": "1020550"
  },
  {
    "text": "it can be a very juicy target for an",
    "start": "1020550",
    "end": "1022200"
  },
  {
    "text": "attacker to preform a very sophisticated",
    "start": "1022200",
    "end": "1024180"
  },
  {
    "text": "and a stealth attack which will be hard",
    "start": "1024180",
    "end": "1026550"
  },
  {
    "text": "to detect like blue pill on arm and this",
    "start": "1026550",
    "end": "1032280"
  },
  {
    "text": "design has a bigger impact on mobile and",
    "start": "1032280",
    "end": "1034860"
  },
  {
    "text": "IOT because most of them runs on arm and",
    "start": "1034860",
    "end": "1038600"
  },
  {
    "text": "the chances are high that they will",
    "start": "1038600",
    "end": "1040740"
  },
  {
    "text": "start in el2 because if the processor",
    "start": "1040740",
    "end": "1043650"
  },
  {
    "text": "support that mode then it starts in e l2",
    "start": "1043650",
    "end": "1046260"
  },
  {
    "text": "and they are single kernel devices so",
    "start": "1046260",
    "end": "1050760"
  },
  {
    "text": "they have wider attack surface because",
    "start": "1050760",
    "end": "1053220"
  },
  {
    "text": "it may pause",
    "start": "1053220",
    "end": "1054780"
  },
  {
    "text": "interact outside world and may possible",
    "start": "1054780",
    "end": "1056970"
  },
  {
    "text": "that they have some custom driver",
    "start": "1056970",
    "end": "1058920"
  },
  {
    "text": "running in it so they are more impacted",
    "start": "1058920",
    "end": "1063090"
  },
  {
    "text": "by this and the affected architecture is",
    "start": "1063090",
    "end": "1067040"
  },
  {
    "text": "rv7 a and r v8 a with hardware",
    "start": "1067040",
    "end": "1070770"
  },
  {
    "text": "virtualization so this describes the",
    "start": "1070770",
    "end": "1076850"
  },
  {
    "text": "security problem and its implications so",
    "start": "1076850",
    "end": "1079920"
  },
  {
    "text": "if you think that your system is",
    "start": "1079920",
    "end": "1082470"
  },
  {
    "text": "vulnerable to this patch your bootloader",
    "start": "1082470",
    "end": "1085770"
  },
  {
    "text": "and make sure that your linux starts in",
    "start": "1085770",
    "end": "1088830"
  },
  {
    "text": "l1 and your KVM is disabled by default",
    "start": "1088830",
    "end": "1091290"
  },
  {
    "text": "and that will ensure that the attacker",
    "start": "1091290",
    "end": "1095430"
  },
  {
    "text": "will not be able to use Linux 2 as a",
    "start": "1095430",
    "end": "1097950"
  },
  {
    "text": "backdoor to install another and",
    "start": "1097950",
    "end": "1101300"
  },
  {
    "text": "hypervisor based rootkit into your",
    "start": "1101300",
    "end": "1103410"
  },
  {
    "text": "system so I have a demo which I would",
    "start": "1103410",
    "end": "1109170"
  },
  {
    "text": "like to show that using this it is",
    "start": "1109170",
    "end": "1111720"
  },
  {
    "text": "possible to execute code from host 1 to",
    "start": "1111720",
    "end": "1116190"
  },
  {
    "text": "l2",
    "start": "1116190",
    "end": "1116750"
  },
  {
    "text": "so for that I am using Q mu 2 and I am",
    "start": "1116750",
    "end": "1122220"
  },
  {
    "text": "running our machine using Q mu so I have",
    "start": "1122220",
    "end": "1126960"
  },
  {
    "text": "started my Q machine so it has cortex",
    "start": "1126960",
    "end": "1130290"
  },
  {
    "text": "a57 processor running in it now I",
    "start": "1130290",
    "end": "1138570"
  },
  {
    "text": "attached a gdb to that my our machine",
    "start": "1138570",
    "end": "1141330"
  },
  {
    "text": "and continued them so now Linux is",
    "start": "1141330",
    "end": "1145380"
  },
  {
    "text": "starting now I will check the version of",
    "start": "1145380",
    "end": "1152580"
  },
  {
    "text": "Linux so it's a recent version that I am",
    "start": "1152580",
    "end": "1157290"
  },
  {
    "text": "running I just reversed a few weeks back",
    "start": "1157290",
    "end": "1161180"
  },
  {
    "text": "now I will add a few few breakpoints",
    "start": "1162860",
    "end": "1166020"
  },
  {
    "text": "here I will put breakpoints in reset",
    "start": "1166020",
    "end": "1168270"
  },
  {
    "text": "vector and set vector call",
    "start": "1168270",
    "end": "1169880"
  },
  {
    "text": "so my exploit code will call this reset",
    "start": "1169880",
    "end": "1174240"
  },
  {
    "text": "vector first first it will call the",
    "start": "1174240",
    "end": "1176220"
  },
  {
    "text": "reset vector to reset the vector table",
    "start": "1176220",
    "end": "1180420"
  },
  {
    "text": "as a stop vector table and after that it",
    "start": "1180420",
    "end": "1183660"
  },
  {
    "text": "will call set vector table",
    "start": "1183660",
    "end": "1186950"
  },
  {
    "text": "[Music]",
    "start": "1193670",
    "end": "1195409"
  },
  {
    "text": "so now I am running the exploit test",
    "start": "1195409",
    "end": "1197730"
  },
  {
    "text": "program that will call reset vector",
    "start": "1197730",
    "end": "1199679"
  },
  {
    "text": "first so now it this will try to add",
    "start": "1199679",
    "end": "1204630"
  },
  {
    "text": "this will set the stop vector back into",
    "start": "1204630",
    "end": "1207480"
  },
  {
    "text": "action and now it will call the set",
    "start": "1207480",
    "end": "1217650"
  },
  {
    "text": "vector table so that attacker allocated",
    "start": "1217650",
    "end": "1219480"
  },
  {
    "text": "buffer will be registered as a exception",
    "start": "1219480",
    "end": "1221100"
  },
  {
    "text": "vector table for el2",
    "start": "1221100",
    "end": "1222149"
  },
  {
    "text": "so it will pass the buffer address as",
    "start": "1222149",
    "end": "1224850"
  },
  {
    "text": "well so here the set vector has been",
    "start": "1224850",
    "end": "1227880"
  },
  {
    "text": "called and x1 register will contain the",
    "start": "1227880",
    "end": "1230399"
  },
  {
    "text": "physical address of the attacker",
    "start": "1230399",
    "end": "1232260"
  },
  {
    "text": "allocated buffer so gdb is not able to",
    "start": "1232260",
    "end": "1241799"
  },
  {
    "text": "access it because this is a physical",
    "start": "1241799",
    "end": "1243419"
  },
  {
    "text": "address so now we are putting a",
    "start": "1243419",
    "end": "1248640"
  },
  {
    "text": "breakpoint at an offset of zero X 400",
    "start": "1248640",
    "end": "1251340"
  },
  {
    "text": "from this buffer so because our",
    "start": "1251340",
    "end": "1253230"
  },
  {
    "text": "shellcode is at this particular offset",
    "start": "1253230",
    "end": "1255059"
  },
  {
    "text": "so the moment our shell code will get",
    "start": "1255059",
    "end": "1257309"
  },
  {
    "text": "coded control at the web the breakpoint",
    "start": "1257309",
    "end": "1260279"
  },
  {
    "text": "will hit so here we get the execution so",
    "start": "1260279",
    "end": "1272309"
  },
  {
    "text": "now our cell code has started executing",
    "start": "1272309",
    "end": "1274350"
  },
  {
    "text": "so now we will go in assembly view and",
    "start": "1274350",
    "end": "1280730"
  },
  {
    "text": "this is our shell code so the very first",
    "start": "1280730",
    "end": "1283950"
  },
  {
    "text": "three statement we are just fetching the",
    "start": "1283950",
    "end": "1286020"
  },
  {
    "text": "value of the current TL and storing it",
    "start": "1286020",
    "end": "1288840"
  },
  {
    "text": "in in X one register and then we will",
    "start": "1288840",
    "end": "1291330"
  },
  {
    "text": "print tax on register value to see in",
    "start": "1291330",
    "end": "1293460"
  },
  {
    "text": "which L my shell code is running",
    "start": "1293460",
    "end": "1296898"
  },
  {
    "text": "so as you can see that xx1 register has",
    "start": "1303720",
    "end": "1307980"
  },
  {
    "text": "value too so that means shellcode is",
    "start": "1307980",
    "end": "1310200"
  },
  {
    "text": "running into l2 and now what I will do",
    "start": "1310200",
    "end": "1313200"
  },
  {
    "text": "my shellcode will get all the will read",
    "start": "1313200",
    "end": "1316590"
  },
  {
    "text": "all the l2 registers and send the",
    "start": "1316590",
    "end": "1319470"
  },
  {
    "text": "information back to the l1 so we are",
    "start": "1319470",
    "end": "1321600"
  },
  {
    "text": "able to access the heart the hardware",
    "start": "1321600",
    "end": "1324179"
  },
  {
    "text": "register of il-2 from me l1 so as you",
    "start": "1324179",
    "end": "1328769"
  },
  {
    "text": "can see we are able to access all the",
    "start": "1328769",
    "end": "1330720"
  },
  {
    "text": "hardware register of il-2 from l1 so I",
    "start": "1330720",
    "end": "1339570"
  },
  {
    "text": "think this concludes the talk and so in",
    "start": "1339570",
    "end": "1345509"
  },
  {
    "text": "order to mitigate this problem we need",
    "start": "1345509",
    "end": "1347399"
  },
  {
    "text": "to pass the system so that the by",
    "start": "1347399",
    "end": "1349649"
  },
  {
    "text": "default the KVM is not enabled in the",
    "start": "1349649",
    "end": "1351480"
  },
  {
    "text": "system and the system is not vulnerable",
    "start": "1351480",
    "end": "1355049"
  },
  {
    "text": "against the hypervisor wastes rootkit",
    "start": "1355049",
    "end": "1358220"
  },
  {
    "text": "thank you any questions",
    "start": "1358220",
    "end": "1360700"
  },
  {
    "text": "[Applause]",
    "start": "1360700",
    "end": "1367649"
  }
]