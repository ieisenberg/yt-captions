[
  {
    "text": "all right good afternoon everyone I'd like to welcome you all to breaking hardware enforced security with hypervisors here in Lagoon Kay speaking",
    "start": "30",
    "end": "7500"
  },
  {
    "text": "with us today is Joe Sharkey he's the chief technology officer that sees to siege technologies we have a couple of",
    "start": "7500",
    "end": "14370"
  },
  {
    "text": "housekeeping items to go over don't forget to stop by the business hall located in Bayside a and B blackhat",
    "start": "14370",
    "end": "21449"
  },
  {
    "text": "Arsenal is on in the Pomeroy a level 3 and the Arsenal reception will be at 5 p.m. if you haven't picked up any",
    "start": "21449",
    "end": "28439"
  },
  {
    "text": "merchandise the schwag bookstore will be closing today at 5:00 so swing by you",
    "start": "28439",
    "end": "33570"
  },
  {
    "text": "can still visit Kali Linux labs in Mandalay a and if you would please put your phones on vibrate or silent and",
    "start": "33570",
    "end": "39059"
  },
  {
    "text": "welcome Joe thank you",
    "start": "39059",
    "end": "44930"
  },
  {
    "text": "alright so I'm excited to be here today talking about breaking hardware and forced security with hypervisors we're",
    "start": "44930",
    "end": "52050"
  },
  {
    "text": "going to talk about a couple of different technologies and we're gonna break both of them with hypervisor rootkits so specifically you're gonna be",
    "start": "52050",
    "end": "58829"
  },
  {
    "text": "talking about Intel txt and AES and I which are both Hardware primitives that",
    "start": "58829",
    "end": "65700"
  },
  {
    "text": "were added in the hardware to help enhance security we're going to show how they can be compromised and undermine so",
    "start": "65700",
    "end": "72900"
  },
  {
    "text": "I'm going to start with a little bit of background on the technologies that we'll be covering today then I'll talk",
    "start": "72900",
    "end": "79229"
  },
  {
    "text": "about how we can use the AI provider rootkit to undermine txt talk about",
    "start": "79229",
    "end": "85619"
  },
  {
    "text": "undermining AES and I and will wrap up talking about implications and some kind",
    "start": "85619",
    "end": "91560"
  },
  {
    "text": "of takeaways near term solutions what are things that we can do walking out of this session today to kind of make our",
    "start": "91560",
    "end": "97229"
  },
  {
    "text": "systems more secure alright so I'm going to start by talking",
    "start": "97229",
    "end": "103619"
  },
  {
    "text": "about dynamic root of trust measurement or D RTM so d RTM has become the trusted",
    "start": "103619",
    "end": "111689"
  },
  {
    "text": "computing paradigm for servers laptops PCs so",
    "start": "111689",
    "end": "118820"
  },
  {
    "text": "this is called dynamic root of trust the alternative is static root of trust that's what we see on like iPhone gaming",
    "start": "118820",
    "end": "126060"
  },
  {
    "text": "consoles things like that where it's like one vendor that controls all of the code controls the hardware and they can",
    "start": "126060",
    "end": "133410"
  },
  {
    "text": "check digital signatures of every piece of code that executes saan that platform from like the very first instruction all",
    "start": "133410",
    "end": "139230"
  },
  {
    "text": "the way up and through problem is that paradigm doesn't work very well for a PC style platform it's not all controlled",
    "start": "139230",
    "end": "147390"
  },
  {
    "text": "by one vendor right there's a lot of different components in there you've got the motherboard with BIOS maybe it's an",
    "start": "147390",
    "end": "153630"
  },
  {
    "text": "Intel motherboard BIOS was written by Intel but it was modified by your OEM right adapted by like Dell HP Lenovo",
    "start": "153630",
    "end": "160650"
  },
  {
    "text": "whoever and then you got video cards network cards they all run firmware - so",
    "start": "160650",
    "end": "166220"
  },
  {
    "text": "collecting the signatures of the right code for all that just becomes an insurmountable problem so Intel came out",
    "start": "166220",
    "end": "172560"
  },
  {
    "text": "with this alternative of dynamic root of trust allows you to establish this this root of trust some point later in the",
    "start": "172560",
    "end": "178920"
  },
  {
    "text": "boot process so it doesn't have to be from the first instruction and the assumption is that at the time you're",
    "start": "178920",
    "end": "184320"
  },
  {
    "text": "starting or launching this this process system could be a completely untrusted",
    "start": "184320",
    "end": "189450"
  },
  {
    "text": "State there can be malware running where I'd have to assume you're not in a good state and what we want to do is be able",
    "start": "189450",
    "end": "195600"
  },
  {
    "text": "to put the system back into a trusted state and from that point be able to load our trusted operating system or",
    "start": "195600",
    "end": "201330"
  },
  {
    "text": "trusted hypervisor and know that that the system is in a good State",
    "start": "201330",
    "end": "207300"
  },
  {
    "text": "so part of what that includes is an atomic instruction to do this quote",
    "start": "207300",
    "end": "212700"
  },
  {
    "text": "measure and launch to kick off the process literally one assembly instruction starts you know the ball",
    "start": "212700",
    "end": "219360"
  },
  {
    "text": "rolling for establishing the root of trust and Intel has as released some open-source",
    "start": "219360",
    "end": "227310"
  },
  {
    "text": "tools to help work with txt and so they have some tools like inside of Linux",
    "start": "227310",
    "end": "233400"
  },
  {
    "text": "some operating system like kernel modules to interact with the hardware",
    "start": "233400",
    "end": "238590"
  },
  {
    "text": "and then some user space tools to check the state to say did I reach a trusted state that I not and check the status of",
    "start": "238590",
    "end": "245250"
  },
  {
    "text": "what's going on and so the large code base that is open",
    "start": "245250",
    "end": "251730"
  },
  {
    "text": "source and implements txt is called T boot and it's largely written and",
    "start": "251730",
    "end": "258180"
  },
  {
    "text": "maintained by engineers and developers at Intel and it's kind of the de facto",
    "start": "258180",
    "end": "263340"
  },
  {
    "text": "standard if you want to use txt T Buddha's proud we what what you're gonna",
    "start": "263340",
    "end": "268530"
  },
  {
    "text": "do and so t boot can load straight out of grub and you launch t boot and then from that it can chain load your",
    "start": "268530",
    "end": "274620"
  },
  {
    "text": "operating system or trusted hypervisor so it like works with Zen or VMware ESXi you know that sort of",
    "start": "274620",
    "end": "282090"
  },
  {
    "text": "thing and so the idea is it's taking measurements during this dr TM process",
    "start": "282090",
    "end": "289290"
  },
  {
    "text": "and then kind of checks that against a known state right and says all right so I",
    "start": "289290",
    "end": "295080"
  },
  {
    "text": "tried to enter this trusted state did everything work out if so cool let the",
    "start": "295080",
    "end": "300540"
  },
  {
    "text": "system boot indicate that we're going to trust the state if it doesn't work out if for some reason we we can't enter",
    "start": "300540",
    "end": "306330"
  },
  {
    "text": "that trusted environment we can't launch successfully then it falls back to a policy that's configured you know when",
    "start": "306330",
    "end": "312810"
  },
  {
    "text": "you set it up and install it and there's a set of policies you can do launch control policies and they can be really",
    "start": "312810",
    "end": "318810"
  },
  {
    "text": "strict and they say like halt the system don't let it boot if anything goes wrong or they can be a lot more you know",
    "start": "318810",
    "end": "324240"
  },
  {
    "text": "relaxed and allow the system to continue to boot all the way up into your operating system and just make note that",
    "start": "324240",
    "end": "330780"
  },
  {
    "text": "you're not in a trusted states like those utilities inside of Linux will let you know systems not in a secure state",
    "start": "330780",
    "end": "339080"
  },
  {
    "text": "so in order to do this there's a set of Hardware extensions they added to the",
    "start": "339710",
    "end": "345479"
  },
  {
    "text": "system it starts with instructions in the CPU the SMX instructions",
    "start": "345479",
    "end": "351410"
  },
  {
    "text": "specifically get sec and get sec s enter which is like a leaf function or sub",
    "start": "351410",
    "end": "357750"
  },
  {
    "text": "function within there is what we're going to talk about a lot today so get sec a center is the instruction the",
    "start": "357750",
    "end": "363990"
  },
  {
    "text": "single assembly code opcode that kicks off the root of trust process",
    "start": "363990",
    "end": "371000"
  },
  {
    "text": "in addition to low CPU extensions there's a bunch of other additions that",
    "start": "371000",
    "end": "376350"
  },
  {
    "text": "go into making this happen within the chipset so there's vtd protections oops",
    "start": "376350",
    "end": "382910"
  },
  {
    "text": "your vtd protections that guard against DMA attacks during the",
    "start": "382910",
    "end": "388710"
  },
  {
    "text": "establishment of a root of trust there were specific bus protocols a new",
    "start": "388710",
    "end": "394830"
  },
  {
    "text": "version of the LPC bus that has special bus cycles that indicate the trusted state within Hardware signaling across to the",
    "start": "394830",
    "end": "401700"
  },
  {
    "text": "TPM TPM is a critical part that's going to store these hashes store the",
    "start": "401700",
    "end": "407700"
  },
  {
    "text": "measurements and and help provide some attestation so there's you know a whole",
    "start": "407700",
    "end": "413250"
  },
  {
    "text": "set of changes to the system that'll be made to implement this I do want to note",
    "start": "413250",
    "end": "418740"
  },
  {
    "text": "although I'll be talking about Intel specifically today AMD does have a similar implementation they have their",
    "start": "418740",
    "end": "425130"
  },
  {
    "text": "secure virtual machine their instruction is called SK and it's secure kernel in it and it works very much the same way",
    "start": "425130",
    "end": "433880"
  },
  {
    "text": "alright so the last background I want to cover is about the TPM and how it's used as part of this process so TPM is a",
    "start": "434480",
    "end": "441960"
  },
  {
    "text": "really cool piece of hardware secure coprocessor and it provides like a whole",
    "start": "441960",
    "end": "447630"
  },
  {
    "text": "set of features I'm gonna cover the ones that are you know specifically relevant to dynamic root of trust today so the",
    "start": "447630",
    "end": "454740"
  },
  {
    "text": "first thing is PCRs platform configuration registers so these are the",
    "start": "454740",
    "end": "460169"
  },
  {
    "text": "registers that store the hashes of the code and system state that make up your",
    "start": "460169",
    "end": "465540"
  },
  {
    "text": "trusted computing base something important about PCRs is software can't just set them to a value",
    "start": "465540",
    "end": "472680"
  },
  {
    "text": "right so there's a set of them you can't just say set PC r17 to a value of 1 2 3",
    "start": "472680",
    "end": "478410"
  },
  {
    "text": "4 5 that's not how it works the only way you can change the value is through what's called an extend operation so the",
    "start": "478410",
    "end": "484770"
  },
  {
    "text": "extend operation takes the current value in that PCR concatenates the new data",
    "start": "484770",
    "end": "489900"
  },
  {
    "text": "you want to add and then takes like a hash of that whole thing the result of the hash becomes the new value of the",
    "start": "489900",
    "end": "495300"
  },
  {
    "text": "PCR right so you can keep extending them over and over and over and it's gonna change that value but it's",
    "start": "495300",
    "end": "502470"
  },
  {
    "text": "computationally infeasible to set the PCR to a specific value array oh wait I don't know what I need to extend it with",
    "start": "502470",
    "end": "508650"
  },
  {
    "text": "if I want the result to be 1 2 3 4 and that's really important it's an",
    "start": "508650",
    "end": "513900"
  },
  {
    "text": "important feature of the whole technology I mean an order of operations is important right that's you know",
    "start": "513900",
    "end": "519300"
  },
  {
    "text": "extending with a followed by any you know extend with B is not the same as extending with B and then extending with",
    "start": "519300",
    "end": "525089"
  },
  {
    "text": "a because of this the way the concatenation and hashing works",
    "start": "525089",
    "end": "532100"
  },
  {
    "text": "and so there's a set of these PCRs some of them are used for static route of trust the ones relevant today are number",
    "start": "532540",
    "end": "540759"
  },
  {
    "text": "17 to 23 which are specifically used for the dynamic route of trust",
    "start": "540759",
    "end": "546660"
  },
  {
    "text": "alright so now the PCRs store those measurements there's another set of important features the TPM provides",
    "start": "546750",
    "end": "554579"
  },
  {
    "text": "called sealed storage and remote at the station so what sealed storage does is it allows",
    "start": "554579",
    "end": "561160"
  },
  {
    "text": "you to bind data or seal data in the TPM and seal it against specific values in the",
    "start": "561160",
    "end": "569350"
  },
  {
    "text": "PC RS so let's say we're gonna seal data against PC R 17 18 and 19",
    "start": "569350",
    "end": "574889"
  },
  {
    "text": "when we seal it it looks at the values of those registers and it will only",
    "start": "574889",
    "end": "580870"
  },
  {
    "text": "allow us to unseal that data when those PCRs are in the same state they were in when we sealed it so you kind of think",
    "start": "580870",
    "end": "587290"
  },
  {
    "text": "of those PC ours is like the combinations to your combination lock right and what they're when they're in",
    "start": "587290",
    "end": "592930"
  },
  {
    "text": "the right state you can open that safe and go in and take out your secrets right but if you put them in there and you spin the dial and the TPM is not in",
    "start": "592930",
    "end": "599680"
  },
  {
    "text": "the right state it's not going to provide you access to those sealed steek sealed secrets remote access station",
    "start": "599680",
    "end": "605589"
  },
  {
    "text": "works conceptually the same way but allows you to attest to a remote entity so",
    "start": "605589",
    "end": "612190"
  },
  {
    "text": "basically a different system it allows the TPM to provide a quote with its own private key that's locked in in storage",
    "start": "612190",
    "end": "618459"
  },
  {
    "text": "and can only provide the right response when the PC RS are in the right State alright so we'll come back and talk",
    "start": "618459",
    "end": "624730"
  },
  {
    "text": "about these a little bit later so this is not the first talk that looks at",
    "start": "624730",
    "end": "631000"
  },
  {
    "text": "undermining txt there's been a bunch of work here so just want to point out some",
    "start": "631000",
    "end": "636910"
  },
  {
    "text": "of those if you're not familiar with these particular things and you're interested in this stuff I",
    "start": "636910",
    "end": "642240"
  },
  {
    "text": "encourage you to go look up this work some really really great stuff invisible",
    "start": "642240",
    "end": "647649"
  },
  {
    "text": "things labs look quite a bit at txt a few years ago and they showed that you",
    "start": "647649",
    "end": "653110"
  },
  {
    "text": "can use system management mode to bypass through the trust measurement because it's not included in the measurement Intel talked about this STM secure",
    "start": "653110",
    "end": "661089"
  },
  {
    "text": "transfer monitor that can actually measure what's in system management mode but we're still yet to see a real",
    "start": "661089",
    "end": "667430"
  },
  {
    "text": "implementation of that in practice there's a couple of other",
    "start": "667430",
    "end": "673089"
  },
  {
    "text": "miss configurations in chipset registers and some bugs in this authenticated code",
    "start": "673089",
    "end": "679040"
  },
  {
    "text": "module which is code that's signed by Intel that's part of the launch process so a couple of different bugs like that",
    "start": "679040",
    "end": "685879"
  },
  {
    "text": "that allowed the txt to be subverted and",
    "start": "685879",
    "end": "691149"
  },
  {
    "text": "those have been patched there's new sign modules released and some micro code updates that as long as you're running",
    "start": "691149",
    "end": "697699"
  },
  {
    "text": "the newest microcode it won't let you you know load the vulnerable versions of",
    "start": "697699",
    "end": "702800"
  },
  {
    "text": "those AC modules and there's some other work looking at hardware attacks against",
    "start": "702800",
    "end": "708620"
  },
  {
    "text": "txt and Jonas winter showed that you can",
    "start": "708620",
    "end": "713930"
  },
  {
    "text": "like open up the case connect on to the LPC bus and actually",
    "start": "713930",
    "end": "719709"
  },
  {
    "text": "inject some signals on the bus that gets the TPM to reset state gets those PCRs",
    "start": "719709",
    "end": "725269"
  },
  {
    "text": "back to a value of zero that then allows you to do the extends you want to reach",
    "start": "725269",
    "end": "730550"
  },
  {
    "text": "the value you want again very interesting requires physical access requires opening the case you know",
    "start": "730550",
    "end": "736850"
  },
  {
    "text": "connecting in and so what we want to talk about today is how can we circumvent txt completely from software",
    "start": "736850",
    "end": "744860"
  },
  {
    "text": "standpoint and you know in a way that it could be done you know remotely",
    "start": "744860",
    "end": "751689"
  },
  {
    "text": "all right so what we do is I call it the SN or emulation attack so we talked",
    "start": "751689",
    "end": "758389"
  },
  {
    "text": "about that get sack SNR instruction as being critical for establishing this route of trust and so what we do is",
    "start": "758389",
    "end": "766399"
  },
  {
    "text": "coming out of grub instead of loading T boot we're gonna load our own custom hypervisor so like a thin hypervisor",
    "start": "766399",
    "end": "773360"
  },
  {
    "text": "rootkit and our hypervisor is going to virtualize all of the SMX instructions",
    "start": "773360",
    "end": "778879"
  },
  {
    "text": "it's going to provide a virtual TPM so that the rest of the software on the system can actually talk to the physical",
    "start": "778879",
    "end": "786050"
  },
  {
    "text": "TPM and it's also going to virtualize the whole txt memory mapped i/o space so all the",
    "start": "786050",
    "end": "793850"
  },
  {
    "text": "the chipset features that are queried to check the status we're going to virtualize all of that",
    "start": "793850",
    "end": "799399"
  },
  {
    "text": "and pretty much then we're gonna lie through our teeth right or so we're gonna intercept what tea boot is trying to do lie to them about the state tell",
    "start": "799399",
    "end": "807019"
  },
  {
    "text": "them yep everything is cool go ahead and boot and during this whole thing they've",
    "start": "807019",
    "end": "812240"
  },
  {
    "text": "never actually run get SEC SNR on the hardware they've never put the hardware into a trusted state and they've never",
    "start": "812240",
    "end": "819050"
  },
  {
    "text": "really unlocked any of those secret's out of the TPM",
    "start": "819050",
    "end": "824110"
  },
  {
    "text": "so all right how do we do this how do we know how to emulate all that stuff the",
    "start": "826810",
    "end": "832699"
  },
  {
    "text": "right way so start by looking at the SMX instructions and conveniently when you",
    "start": "832699",
    "end": "838730"
  },
  {
    "text": "look at the Intel developer's manual they give you pseudocode for this instruction unlike what it's supposed to",
    "start": "838730",
    "end": "844790"
  },
  {
    "text": "do right and it's a complex instruction the pseudocode is like several pages long but we just take that pseudocode",
    "start": "844790",
    "end": "852259"
  },
  {
    "text": "write convert it to c and then obviously you know ignore some of the security checks we don't want to do but that",
    "start": "852259",
    "end": "858889"
  },
  {
    "text": "allows us to emulate the instruction in a way that's close enough to what the real hardware does that t boot is fooled",
    "start": "858889",
    "end": "864819"
  },
  {
    "text": "but skipping all of the like important security stuff it's doing",
    "start": "864819",
    "end": "869860"
  },
  {
    "text": "so then there's this authenticated code module that's supposed to be the first",
    "start": "869860",
    "end": "875120"
  },
  {
    "text": "piece of software run and so we have a couple of options with the hypervisor rootkit and actually was able to",
    "start": "875120",
    "end": "881720"
  },
  {
    "text": "implement in both ways we can run that AC module inside of a virtual machine we",
    "start": "881720",
    "end": "887690"
  },
  {
    "text": "control and and kind of let it execute and filter out some of the operations it's doing but we also found we can just",
    "start": "887690",
    "end": "893690"
  },
  {
    "text": "skip it altogether there are some side effects of doing that AC module is",
    "start": "893690",
    "end": "899000"
  },
  {
    "text": "supposed to put the chipset back into a trusted state it's supposed to go through all of the important hardware",
    "start": "899000",
    "end": "904579"
  },
  {
    "text": "and initialize it properly but we're actually able to skip that and T boot doesn't know the difference and Linux",
    "start": "904579",
    "end": "910819"
  },
  {
    "text": "doesn't know the difference and we emulate all interaction with the TPM so",
    "start": "910819",
    "end": "916779"
  },
  {
    "text": "before we had like the real TPM has these extend operations for the PC ours",
    "start": "916779",
    "end": "922660"
  },
  {
    "text": "and and so we can emulate all that but for ourselves within the rootkit we can just set those PC ours to the value we",
    "start": "922660",
    "end": "929839"
  },
  {
    "text": "want and then when someone reads the values we can you know return what they expect it to be and never let",
    "start": "929839",
    "end": "937750"
  },
  {
    "text": "them talk to the real TPM so bottom line is the software on the",
    "start": "937750",
    "end": "943840"
  },
  {
    "text": "system really believes it's in a trusted State it believes that the D RT M measured launch succeeded so it doesn't",
    "start": "943840",
    "end": "951010"
  },
  {
    "text": "matter what launch control policy you set at that point all right you can have the most restrictive policy telling the",
    "start": "951010",
    "end": "957070"
  },
  {
    "text": "system to halt not continue booting if something goes wrong it doesn't reach",
    "start": "957070",
    "end": "964450"
  },
  {
    "text": "that that policy doesn't invoke that policy because it doesn't believe anything has gone wrong it truly",
    "start": "964450",
    "end": "970330"
  },
  {
    "text": "believes the system is in a good state all right so I'm gonna hop over to a",
    "start": "970330",
    "end": "977110"
  },
  {
    "text": "video I have for demonstration quick first gonna explain what you're gonna see we're gonna see a system boot with",
    "start": "977110",
    "end": "984970"
  },
  {
    "text": "out using t boot just a normal system boot and we'll just kind of see how these utilities in Linux txt stat and",
    "start": "984970",
    "end": "991570"
  },
  {
    "text": "looking at the PCRs shoulder systems not in a trusted state then we'll see a system with you know normal t boot",
    "start": "991570",
    "end": "997960"
  },
  {
    "text": "current version booting up and we'll see what it looks like when it is in a trusted state will see that the the PCRs",
    "start": "997960",
    "end": "1005730"
  },
  {
    "text": "have some values that are you know specific to my system here and then we'll see it booting with the hypervisor",
    "start": "1005730",
    "end": "1011730"
  },
  {
    "text": "rootkit come up and we'll see you get the same output from the command line utilities alright so how we're gonna",
    "start": "1011730",
    "end": "1017730"
  },
  {
    "text": "know the rootkit is running what I did is implement in some serial port output so the hypervisor rootkits gonna like",
    "start": "1017730",
    "end": "1024209"
  },
  {
    "text": "print some things over the serial port to show that it's running explain what it's doing t boot also prints out on the",
    "start": "1024209",
    "end": "1029730"
  },
  {
    "text": "serial port so that's that's kind of cool when it when it's running we'll be able to see the T boot message is coming along with some messages from the",
    "start": "1029730",
    "end": "1036240"
  },
  {
    "text": "hypervisor rootkit",
    "start": "1036240",
    "end": "1039170"
  },
  {
    "text": "see",
    "start": "1047160",
    "end": "1050160"
  },
  {
    "text": "word in my mouth go",
    "start": "1054150",
    "end": "1057890"
  },
  {
    "text": "all right there we go",
    "start": "1079160",
    "end": "1082510"
  },
  {
    "text": "alright so measured launch is false for normal system we can see PCR 17 through",
    "start": "1090250",
    "end": "1096789"
  },
  {
    "text": "23 are initialized to negative 1 now let's see what it looks like launching T",
    "start": "1096789",
    "end": "1102159"
  },
  {
    "text": "boot and we can see T boot prints a bunch of messages across the serial port",
    "start": "1102159",
    "end": "1107470"
  },
  {
    "text": "as it boots explains what it's doing shows some measurements now we run txt",
    "start": "1107470",
    "end": "1113080"
  },
  {
    "text": "stat we see measured launches true and if we look at the values of the PC RS and the TPM will see that PC R 17",
    "start": "1113080",
    "end": "1121030"
  },
  {
    "text": "through through 19 have values that were initialized by T boot so now let's run",
    "start": "1121030",
    "end": "1126429"
  },
  {
    "text": "the routed T boot this is gonna launch the hypervisor rootkit first and we can see some output from the",
    "start": "1126429",
    "end": "1133330"
  },
  {
    "text": "hypervisor rootkit then it's gonna launch T boot and we'll see messages interspersed there between T boot and my",
    "start": "1133330",
    "end": "1139090"
  },
  {
    "text": "hypervisor rootkit as its as its emulating those operations",
    "start": "1139090",
    "end": "1144419"
  },
  {
    "text": "we see all the TPM access is being completely emulated Linux finishes",
    "start": "1144419",
    "end": "1150880"
  },
  {
    "text": "booting and now we can come in and run txt stat and we can see it says measure",
    "start": "1150880",
    "end": "1155950"
  },
  {
    "text": "launch is true and if we look at the PC R values they have the same values as before",
    "start": "1155950",
    "end": "1164070"
  },
  {
    "text": "so to show that ren ryan diffuse and kind of hard to see you know all the",
    "start": "1164070",
    "end": "1169480"
  },
  {
    "text": "numbers there but you can pull up the slides afterwards",
    "start": "1169480",
    "end": "1174750"
  },
  {
    "text": "and take a look at it and it oops a little bit too far there",
    "start": "1175200",
    "end": "1183700"
  },
  {
    "text": "we go alright but what we have is the same exact value so as far as the software on the system is concerned",
    "start": "1183700",
    "end": "1189580"
  },
  {
    "text": "we're in the same state that we were with regular t boot right so completely",
    "start": "1189580",
    "end": "1195280"
  },
  {
    "text": "undermine the route of trust here",
    "start": "1195280",
    "end": "1198809"
  },
  {
    "text": "so another question is should this kind of attack succeed it's like well hold on Joe like you know you didn't actually",
    "start": "1201030",
    "end": "1207610"
  },
  {
    "text": "run the instruction right so you know is this really in scope for the kind of protections it's supposed to do",
    "start": "1207610",
    "end": "1213940"
  },
  {
    "text": "or a like as long as it runs the instruction everything's cool I made sure I'd never really started",
    "start": "1213940",
    "end": "1219789"
  },
  {
    "text": "that process at all so interesting thing this",
    "start": "1219789",
    "end": "1225060"
  },
  {
    "text": "graphic on the right comes out of intel's white paper talking about txt",
    "start": "1225060",
    "end": "1230350"
  },
  {
    "text": "and circled in red they specifically talk about the case of a rootkit hypervisor as you know the the example",
    "start": "1230350",
    "end": "1238530"
  },
  {
    "text": "quintessential test case threat model that they're defending against and specifically say that hypervisor rootkit",
    "start": "1238530",
    "end": "1246370"
  },
  {
    "text": "or rootkit hypervisor will be detected and the measured launch will fail and",
    "start": "1246370",
    "end": "1252360"
  },
  {
    "text": "i say that's true if you ever actually start this process in the hardware",
    "start": "1252360",
    "end": "1257970"
  },
  {
    "text": "unfortunately with the hypervisor rootkit it's able to virtualize all of this so there's no guarantee that that",
    "start": "1257970",
    "end": "1264340"
  },
  {
    "text": "ever actually happened and there's there's one caveat to that we talked about sealed storage in the beginning as",
    "start": "1264340",
    "end": "1271840"
  },
  {
    "text": "a feature of the TPM when sealed storage is used properly it can",
    "start": "1271840",
    "end": "1278430"
  },
  {
    "text": "actually detect and prevent this kind of attack we'll come back to that towards",
    "start": "1278430",
    "end": "1283990"
  },
  {
    "text": "the end we'll talk about what's the right way to do this but unfortunately sealed storage isn't used by t boot it's",
    "start": "1283990",
    "end": "1290980"
  },
  {
    "text": "not used by default and it's not really even an option there are some command",
    "start": "1290980",
    "end": "1296320"
  },
  {
    "text": "line utilities in Linux that allow you to seal and unseal data against the TPM",
    "start": "1296320",
    "end": "1301510"
  },
  {
    "text": "but it's kind of left up to like the sysadmin that's configuring and installing this stuff to like figure out",
    "start": "1301510",
    "end": "1308350"
  },
  {
    "text": "what secrets they want to seal and you know all of the instances I've seen with",
    "start": "1308350",
    "end": "1314710"
  },
  {
    "text": "this hasn't been done right the first time because the sysadmin don't really understand what they should or shouldn't",
    "start": "1314710",
    "end": "1321310"
  },
  {
    "text": "be doing with it so again we'll come back to the recommendations at the end but the fundamental problem here is that",
    "start": "1321310",
    "end": "1327880"
  },
  {
    "text": "these instructions are virtualized bowl so the SMX instructions by default cause",
    "start": "1327880",
    "end": "1333130"
  },
  {
    "text": "a trap a vm exit to the hypervisor right and that's the hook the hypervisor needs to do the emulation",
    "start": "1333130",
    "end": "1340740"
  },
  {
    "text": "so all right maybe Intel's to do a micro code update to say well don't cause",
    "start": "1341010",
    "end": "1346480"
  },
  {
    "text": "traps to the hypervisor when you run SMX instructions that'll guarantee they get run without being interfered with by the",
    "start": "1346480",
    "end": "1352870"
  },
  {
    "text": "hypervisor well that's not such a great idea either right let's think about cloud hosted",
    "start": "1352870",
    "end": "1358650"
  },
  {
    "text": "infrastructure say say having an instance of ec2 if I run this user space",
    "start": "1358650",
    "end": "1364110"
  },
  {
    "text": "instruction you know get stuck a center do I really want it to kick the",
    "start": "1364110",
    "end": "1369600"
  },
  {
    "text": "hypervisor out put it in a trusted state and put the real hardware in a trusted state and run the code I tell it that",
    "start": "1369600",
    "end": "1375840"
  },
  {
    "text": "would be a generic VM breakout technique right so that's like really bad so instead of that Intel decided that we",
    "start": "1375840",
    "end": "1382620"
  },
  {
    "text": "oughta notify the hypervisor that someone's trying to run these instructions and let the hypervisor decide what to do right so fun if I'm a",
    "start": "1382620",
    "end": "1389580"
  },
  {
    "text": "cloud hypervisor I can just you know respond with an error say yeah that instructions not supported you can't do",
    "start": "1389580",
    "end": "1395640"
  },
  {
    "text": "that in this virtualized environment by the way I think that was the right decision right so so the hardware implemented it",
    "start": "1395640",
    "end": "1402840"
  },
  {
    "text": "the right way but it was a fundamental decision that had to be made",
    "start": "1402840",
    "end": "1408320"
  },
  {
    "text": "all right so I want to shift gears a little bit and talk about a s and I and I'm looking at the same kind of setup",
    "start": "1409880",
    "end": "1416220"
  },
  {
    "text": "with the hypervisor rootkit saying how can we use that to intercept these AES ni",
    "start": "1416220",
    "end": "1423540"
  },
  {
    "text": "instructions and and undermine the integrity of the",
    "start": "1423540",
    "end": "1428610"
  },
  {
    "text": "encryption so quick background on a sni these are native instructions added to",
    "start": "1428610",
    "end": "1434250"
  },
  {
    "text": "the CPU to speed up the process of encryption and decryption with a so it",
    "start": "1434250",
    "end": "1440460"
  },
  {
    "text": "works well it gives you no orders of magnitude performance increase over a pure software implementation of AES",
    "start": "1440460",
    "end": "1446720"
  },
  {
    "text": "there's a set of instructions added to the hardware to do this to do things like key Genesis so for for generating",
    "start": "1446720",
    "end": "1454620"
  },
  {
    "text": "keys for doing rounds of encryption and decryption next to have special op codes",
    "start": "1454620",
    "end": "1460500"
  },
  {
    "text": "for decrypt last round and encrypt last round and it makes use of the X mm and the y",
    "start": "1460500",
    "end": "1467700"
  },
  {
    "text": "mm registers like 128 bit and the 256 bit native registers that were already",
    "start": "1467700",
    "end": "1473280"
  },
  {
    "text": "there in the CPU important thing to note is that your",
    "start": "1473280",
    "end": "1478770"
  },
  {
    "text": "default crypto libraries right both in Windows and Linux wind crypt and live",
    "start": "1478770",
    "end": "1484200"
  },
  {
    "text": "crypt things like that nowadays all use AES and as long as they're on hardware",
    "start": "1484200",
    "end": "1489960"
  },
  {
    "text": "that supports it which is you know pretty much anything modern even current",
    "start": "1489960",
    "end": "1495919"
  },
  {
    "text": "so what we want to do is find a way to cause traps or VM exits to our",
    "start": "1496100",
    "end": "1502410"
  },
  {
    "text": "hypervisor rootkit anytime AES and I instructions are executed so we want to",
    "start": "1502410",
    "end": "1507600"
  },
  {
    "text": "put the cpu in a state where that happens so we want to configure our hypervisor rootkit to catch those events",
    "start": "1507600",
    "end": "1513350"
  },
  {
    "text": "and then we can kind of play man in the middle right allow the encryption or decryption to happen but spy on the keys",
    "start": "1513350",
    "end": "1520410"
  },
  {
    "text": "that are being used log or store off the unencrypted data so",
    "start": "1520410",
    "end": "1526590"
  },
  {
    "text": "right either before encryption or right after decryption get that plaintext and capture that",
    "start": "1526590",
    "end": "1533780"
  },
  {
    "text": "so that's what we're gonna do and so the first question is how are we gonna get",
    "start": "1533780",
    "end": "1538890"
  },
  {
    "text": "notified when these instructions are executed how are we gonna trigger those events unlike",
    "start": "1538890",
    "end": "1545820"
  },
  {
    "text": "the get SEC SNR instruction that automatically traps to the hypervisor the AES ni instructions are user space",
    "start": "1545820",
    "end": "1553440"
  },
  {
    "text": "instructions in a sense in terms of privilege standpoint within the CPU",
    "start": "1553440",
    "end": "1560100"
  },
  {
    "text": "there's not a whole lot different than add subtract multiply divide they're instructions that can be run from user",
    "start": "1560100",
    "end": "1565740"
  },
  {
    "text": "space and they don't need to notify the hypervisor so we got to say all right how can we get",
    "start": "1565740",
    "end": "1573390"
  },
  {
    "text": "creative to cause these traps so start by looking at the pseudocode in the",
    "start": "1573390",
    "end": "1578790"
  },
  {
    "text": "instruction set reference manual and say well what kind of events what kind of exceptions can they",
    "start": "1578790",
    "end": "1585390"
  },
  {
    "text": "generate so all right they can generate exceptions type for all right let's flip a few pages in the instruction or the",
    "start": "1585390",
    "end": "1591900"
  },
  {
    "text": "Intel manual and go and look at when we pull up this table on what exceptions type for means",
    "start": "1591900",
    "end": "1597680"
  },
  {
    "text": "and there is a bunch of rows here a bunch of ways they can generate exceptions some of them have to",
    "start": "1597680",
    "end": "1604290"
  },
  {
    "text": "do with the values that are in the registers at the time the instructions are executed okay those aren't super relevant for us",
    "start": "1604290",
    "end": "1610770"
  },
  {
    "text": "hypervisor doesn't control the operands that that the software is using but then",
    "start": "1610770",
    "end": "1616710"
  },
  {
    "text": "there's a couple I circled in red that are dependent on the state of the CPU",
    "start": "1616710",
    "end": "1621919"
  },
  {
    "text": "specifically bits in the control registers well that's cool the hypervisor can can manipulate the",
    "start": "1621919",
    "end": "1630149"
  },
  {
    "text": "control registers and has as free rein to do so so that that looks interesting let's try",
    "start": "1630149",
    "end": "1637080"
  },
  {
    "text": "that right so digging down a little deeper looked in control register for",
    "start": "1637080",
    "end": "1643759"
  },
  {
    "text": "specifically and the bits that we end up toggling are the ones that turn on or",
    "start": "1643759",
    "end": "1649830"
  },
  {
    "text": "off the X mm and Y mm registers so for backwards compatibility you can turn off",
    "start": "1649830",
    "end": "1655830"
  },
  {
    "text": "those registers rights let older software runs like like it normally did when you want to enable access to them",
    "start": "1655830",
    "end": "1661649"
  },
  {
    "text": "you have to like set these bits to turn on those features it allows those up codes to now exist and the",
    "start": "1661649",
    "end": "1668999"
  },
  {
    "text": "system is happy so what we can do is turn those bits off and that will cause any instruction using X",
    "start": "1668999",
    "end": "1677249"
  },
  {
    "text": "mm or Y mm registers to cause an undefined opcode exception and then cool",
    "start": "1677249",
    "end": "1682859"
  },
  {
    "text": "we can use the hypervisor to configure the system to route those exceptions to",
    "start": "1682859",
    "end": "1688169"
  },
  {
    "text": "the hypervisor and set it to the kernel BAM now we get notified when these instructions are executed",
    "start": "1688169",
    "end": "1695179"
  },
  {
    "text": "important to note in this case we get a bunch of other stuff to write a bunch of vector computations anything using X mm",
    "start": "1695179",
    "end": "1701789"
  },
  {
    "text": "or Y mm registers so we got to do a little bit of filtering based on the opcode when we're doing our logging",
    "start": "1701789",
    "end": "1709789"
  },
  {
    "text": "and so if we look here an example for",
    "start": "1709789",
    "end": "1715710"
  },
  {
    "text": "OpenSSL put together a quick example of generating a key",
    "start": "1715710",
    "end": "1721460"
  },
  {
    "text": "encrypting text and then decrypting it all right so we're kind of running",
    "start": "1721460",
    "end": "1727349"
  },
  {
    "text": "through that that whole life cycle and on the left-hand side we see the serial port output from our hypervisor and on",
    "start": "1727349",
    "end": "1735090"
  },
  {
    "text": "the right-hand side we see like the the output of the OpenSSL script that we wrote and",
    "start": "1735090",
    "end": "1742489"
  },
  {
    "text": "so the first thing we see from hypervisor output is the AES key Genesis",
    "start": "1742489",
    "end": "1748519"
  },
  {
    "text": "and not sure how well you can read it in the",
    "start": "1748519",
    "end": "1753929"
  },
  {
    "text": "back but one of the operands to that like the value directly in one of the xmm",
    "start": "1753929",
    "end": "1760179"
  },
  {
    "text": "registers is the actual key the AAS key so that's kind of cool we don't think of",
    "start": "1760179",
    "end": "1766840"
  },
  {
    "text": "looking through memory to find this right it's just handed to us directly in a register directly in the operand for",
    "start": "1766840",
    "end": "1772690"
  },
  {
    "text": "that instruction okay so we can make note of that we let it go ahead and do its encryption and then do its",
    "start": "1772690",
    "end": "1780130"
  },
  {
    "text": "decryption and then the next thing I'm pointing out here is a s decrypt lasts so it does multiple rounds of decryption",
    "start": "1780130",
    "end": "1788200"
  },
  {
    "text": "and can be configured AES can do different block modes and things like that don't have time to get into all those",
    "start": "1788200",
    "end": "1794799"
  },
  {
    "text": "details here right now but bottom line is when it gets to the last round of decryption we can look at the result",
    "start": "1794799",
    "end": "1802660"
  },
  {
    "text": "coming out of that computation again that result is provided directly in a register so we don't have to go around poking and memory trying to find it it's",
    "start": "1802660",
    "end": "1809470"
  },
  {
    "text": "right in a register so we can make note of that result and then a few instructions later we see the XOR go on",
    "start": "1809470",
    "end": "1815950"
  },
  {
    "text": "and the XOR takes this initialization vector that OpenSSL used as one operand",
    "start": "1815950",
    "end": "1821890"
  },
  {
    "text": "the output of AES decrypt last and the result is actually the bytes of our",
    "start": "1821890",
    "end": "1828340"
  },
  {
    "text": "plaintext you know secret message that we had provided so so this is pretty cool right",
    "start": "1828340",
    "end": "1834820"
  },
  {
    "text": "we don't have to go searching around memory for keys we can grab them during",
    "start": "1834820",
    "end": "1840250"
  },
  {
    "text": "like key Genesis we can grab round keys directly out of",
    "start": "1840250",
    "end": "1845380"
  },
  {
    "text": "of the registers one is doing rounds of encryption or decryption we can even grab the plaintext right out of the",
    "start": "1845380",
    "end": "1852220"
  },
  {
    "text": "registers so what's the catch right like sounds a",
    "start": "1852220",
    "end": "1858040"
  },
  {
    "text": "little bit too good to be true and the bottom line is its performance",
    "start": "1858040",
    "end": "1864660"
  },
  {
    "text": "right because we couldn't route just the AES instructions we end up with a bunch",
    "start": "1864660",
    "end": "1870220"
  },
  {
    "text": "of other stuff there's a performance impact on the system in this case my proof of concept",
    "start": "1870220",
    "end": "1877080"
  },
  {
    "text": "here was not optimized right something I put together in about a week and a half",
    "start": "1877080",
    "end": "1883080"
  },
  {
    "text": "and the performance impact is noticeable the system is noticeably slower to the user",
    "start": "1883080",
    "end": "1888700"
  },
  {
    "text": "could it be optimized for Shore right could spend a lot more time try and minimize the performance impact try and",
    "start": "1888700",
    "end": "1895210"
  },
  {
    "text": "do more efficient filtering and things like that but at the end of the day you're still going to incur the penalty",
    "start": "1895210",
    "end": "1902350"
  },
  {
    "text": "of these context switches to the hypervisor and back for more instructions than than just what you're",
    "start": "1902350",
    "end": "1908080"
  },
  {
    "text": "looking for but it is it is possible to do all",
    "start": "1908080",
    "end": "1914070"
  },
  {
    "text": "right so now let's talk a little bit about who's affected by these types of",
    "start": "1915270",
    "end": "1921820"
  },
  {
    "text": "things by undermining AES and I and txt so",
    "start": "1921820",
    "end": "1927660"
  },
  {
    "text": "there's a variety of systems that that use ace and I for sure desktops laptops",
    "start": "1927660",
    "end": "1933280"
  },
  {
    "text": "servers but but when you put these two sets of technologies together cloud",
    "start": "1933280",
    "end": "1938470"
  },
  {
    "text": "infrastructure is the one that kind of is is impacted the most right so just as",
    "start": "1938470",
    "end": "1944860"
  },
  {
    "text": "like a thought exercise here what if somebody gets into the cloud infrastructure other uses is like a VM",
    "start": "1944860",
    "end": "1951640"
  },
  {
    "text": "breakout technique right and and gets execution in the hypervisor or maybe a",
    "start": "1951640",
    "end": "1956890"
  },
  {
    "text": "malicious insider that works works there and kind of load some code on and",
    "start": "1956890",
    "end": "1962040"
  },
  {
    "text": "bypasses the route of trust make some changes to that hypervisor to",
    "start": "1962040",
    "end": "1967360"
  },
  {
    "text": "add some you know malicious bits in there and then decides to start you know snarfing up all the AES keys from",
    "start": "1967360",
    "end": "1973840"
  },
  {
    "text": "everything going on right that means everybody that's connecting and remotely using VPN using SSL maybe using disk",
    "start": "1973840",
    "end": "1982120"
  },
  {
    "text": "encryption to store their data securely in the cloud they could be at risk and I",
    "start": "1982120",
    "end": "1988300"
  },
  {
    "text": "do want to note that the techniques that I'm talking about here are not operating system specific so I talked about some Linux",
    "start": "1988300",
    "end": "1996100"
  },
  {
    "text": "implementations but what we're really doing is architectural it's based on the way the architecture works we also have",
    "start": "1996100",
    "end": "2003780"
  },
  {
    "text": "it working and have demonstrations on Windows as well same codebase no changes",
    "start": "2003780",
    "end": "2009360"
  },
  {
    "text": "right it's hypervisor rootkit it's not dependent on the operating system",
    "start": "2009360",
    "end": "2014720"
  },
  {
    "text": "all right so how will I know if I'm affected by this will I know",
    "start": "2016100",
    "end": "2022350"
  },
  {
    "text": "well it'll be hard and probably not when it comes to to AE s and I",
    "start": "2022350",
    "end": "2029960"
  },
  {
    "text": "many sysadmin 's don't even know whether their software is using the native",
    "start": "2029960",
    "end": "2035309"
  },
  {
    "text": "instructions or using a software implementation i'll conjecture that many developers also don't know in pulling together my",
    "start": "2035309",
    "end": "2043649"
  },
  {
    "text": "my proof-of-concept here and doing this research i was like alright well let me",
    "start": "2043649",
    "end": "2048720"
  },
  {
    "text": "find an interesting test case to start with right what's gonna be the easiest thing that I know for sure is using a s",
    "start": "2048720",
    "end": "2054419"
  },
  {
    "text": "and I it was really hard to do that to find any documentation that said one way",
    "start": "2054419",
    "end": "2060030"
  },
  {
    "text": "or the other because a lot of applications are just using a library right and then you call a library",
    "start": "2060030",
    "end": "2065460"
  },
  {
    "text": "function to do a AES encryption do you know if that library function is using the native instructions or as a software",
    "start": "2065460",
    "end": "2071550"
  },
  {
    "text": "implementation not really right so because that a lot of people aren't",
    "start": "2071550",
    "end": "2077730"
  },
  {
    "text": "even sure if they're using it based on my experimentation here and digging in a",
    "start": "2077730",
    "end": "2084210"
  },
  {
    "text": "little deeper to those default libraries I would say the answer is yes probably is being used because by default",
    "start": "2084210",
    "end": "2090770"
  },
  {
    "text": "the libraries will use it when the CPU supports it when the CPU doesn't support it they'll fall back to a software",
    "start": "2090770",
    "end": "2097138"
  },
  {
    "text": "implementation and the caller of those functions doesn't doesn't know the difference there'll be a performance",
    "start": "2097139",
    "end": "2102300"
  },
  {
    "text": "increase when the native instructions are there but other than that there's no indication one way or the other",
    "start": "2102300",
    "end": "2108230"
  },
  {
    "text": "and as far as txt right if if you're someone that uses that for a server",
    "start": "2108230",
    "end": "2113970"
  },
  {
    "text": "platform it's really complex it's an impressive technology but there's a lot of pieces",
    "start": "2113970",
    "end": "2120990"
  },
  {
    "text": "to it a lot of hardware changes a bunch of specifications that they go along with it hardware from multiple",
    "start": "2120990",
    "end": "2127290"
  },
  {
    "text": "manufacturers multiple pieces of software that all have to come together perfectly to really put you in that in",
    "start": "2127290",
    "end": "2134550"
  },
  {
    "text": "that secure state so let's move on and talk about",
    "start": "2134550",
    "end": "2140030"
  },
  {
    "text": "what we can do about it what are some steps we can take to protect ourselves against these kind of attacks",
    "start": "2140030",
    "end": "2147950"
  },
  {
    "text": "so if you're really paranoid right and you",
    "start": "2151119",
    "end": "2156619"
  },
  {
    "text": "want to encrypt data in the cloud and you're like well I don't want to be subject to this kind of attack I want I",
    "start": "2156619",
    "end": "2162410"
  },
  {
    "text": "want some way around that your best option is to use a software",
    "start": "2162410",
    "end": "2167839"
  },
  {
    "text": "implementation of AES don't use the native instructions because what that does is makes the job",
    "start": "2167839",
    "end": "2174710"
  },
  {
    "text": "of a hypervisor rootkit a lot more difficult so what do I mean by that I",
    "start": "2174710",
    "end": "2180049"
  },
  {
    "text": "think about it like Where's Waldo right so on the left hand side we can see",
    "start": "2180049",
    "end": "2186859"
  },
  {
    "text": "everything in that graphic right nothing is blocked out just like the hypervisor can see all of the bits and the bytes in",
    "start": "2186859",
    "end": "2193640"
  },
  {
    "text": "the system that has the privilege to read anything in memory but finding Waldo in that graphic takes",
    "start": "2193640",
    "end": "2200569"
  },
  {
    "text": "time and it's hard and it's not easy compare that to the graphic on the right",
    "start": "2200569",
    "end": "2206660"
  },
  {
    "text": "hand side where there's like a big circle and an arrow right and that's like when we get these VM exits we can",
    "start": "2206660",
    "end": "2212839"
  },
  {
    "text": "configure the CPU to to notify us as a hypervisor rootkit and like point over here it's like well that makes the job a",
    "start": "2212839",
    "end": "2219380"
  },
  {
    "text": "lot easier and yeah in the circle it's not just while though there's like two or three other people in there so we",
    "start": "2219380",
    "end": "2225289"
  },
  {
    "text": "have to do a little bit of filtering but still way easier to find what we're looking for on the right hand side than the left hand side",
    "start": "2225289",
    "end": "2231460"
  },
  {
    "text": "so one of the things you can do is hide in the noise using a software",
    "start": "2231460",
    "end": "2237499"
  },
  {
    "text": "implementation making it harder for the hypervisor to configure the system in a",
    "start": "2237499",
    "end": "2243230"
  },
  {
    "text": "way that it can have the hardware do the filtering for it and leverage this this challenge law",
    "start": "2243230",
    "end": "2250400"
  },
  {
    "text": "which is called the semantic gap where the hypervisor has to try and make sense out of everything and find exactly what",
    "start": "2250400",
    "end": "2256549"
  },
  {
    "text": "it's looking for all right so",
    "start": "2256549",
    "end": "2263890"
  },
  {
    "text": "txt and sealed storage",
    "start": "2263890",
    "end": "2269950"
  },
  {
    "text": "the reason this attack succeeds the reason the hypervisor rootkit can",
    "start": "2271300",
    "end": "2276500"
  },
  {
    "text": "undermine txt is because sealed storage is not used and",
    "start": "2276500",
    "end": "2282430"
  },
  {
    "text": "my conjecture is that sealed storage should not be optional it's kind of considered an optional part of the",
    "start": "2282430",
    "end": "2289520"
  },
  {
    "text": "platform but without it you have no way to guarantee the system is in a trusted",
    "start": "2289520",
    "end": "2294680"
  },
  {
    "text": "State so if I'm gonna use sealed storage if I",
    "start": "2294680",
    "end": "2302900"
  },
  {
    "text": "want to implement that what are some of the challenges to doing it the right way",
    "start": "2302900",
    "end": "2309339"
  },
  {
    "text": "well first thing is you have to decide what's",
    "start": "2309550",
    "end": "2314630"
  },
  {
    "text": "secret you're gonna seal in the TPM all right so the first pitfall that you can run into",
    "start": "2314630",
    "end": "2321140"
  },
  {
    "text": "is picking a secret that the attacker can guess right so although I can't undermine sealed storage as a hypervisor",
    "start": "2321140",
    "end": "2327500"
  },
  {
    "text": "rootkit I can emulate the TPM unseal operation it's just that the real",
    "start": "2327500",
    "end": "2334010"
  },
  {
    "text": "Hardware the real TPM is not in the state or it will release its secrets to me I'm letting software talk to a",
    "start": "2334010",
    "end": "2340190"
  },
  {
    "text": "virtualized TPM so if I don't know what's locked in the vault inside that TPM then I mean I can",
    "start": "2340190",
    "end": "2348290"
  },
  {
    "text": "return some data to you when you say TPM unseal but I'm not gonna have any way of knowing what that data should be",
    "start": "2348290",
    "end": "2354520"
  },
  {
    "text": "unless you chose poorly and I can guess what that value is if I can guess that value I can return it and you won't know",
    "start": "2354520",
    "end": "2361400"
  },
  {
    "text": "whether it came from me as the I provides a rootkit or from the real TPM so you want to pick something that you",
    "start": "2361400",
    "end": "2368270"
  },
  {
    "text": "know that can't be guessed okay so that's that's number one number",
    "start": "2368270",
    "end": "2373850"
  },
  {
    "text": "two you want to make sure that the value that you're storing there isn't kept",
    "start": "2373850",
    "end": "2380000"
  },
  {
    "text": "like around at runtime because if I compromised your system at runtime and I",
    "start": "2380000",
    "end": "2386840"
  },
  {
    "text": "can find that secret in RAM in memory somewhere and I save it off then I can",
    "start": "2386840",
    "end": "2392480"
  },
  {
    "text": "also report that back to you on the next boot and and again undermine through the trust so you want it to be something",
    "start": "2392480",
    "end": "2398810"
  },
  {
    "text": "that doesn't hang around very long something that you use just to prove you're in a trusted state at boot time",
    "start": "2398810",
    "end": "2403980"
  },
  {
    "text": "and you don't leave it hanging around the next thing you need to do is make",
    "start": "2403980",
    "end": "2410190"
  },
  {
    "text": "sure you extend the PCRs after you unseal your secrets so again",
    "start": "2410190",
    "end": "2416670"
  },
  {
    "text": "if you think about it is like the combination lock on the safe right if you open the safe take out your secrets",
    "start": "2416670",
    "end": "2422840"
  },
  {
    "text": "and you leave it open I can walk in behind you and I can just do TPM unseal",
    "start": "2422840",
    "end": "2429320"
  },
  {
    "text": "myself and I can read the secrets right out of the TPM and this is a common",
    "start": "2429320",
    "end": "2434970"
  },
  {
    "text": "pitfall I've seen as well where you know do everything else right and",
    "start": "2434970",
    "end": "2442020"
  },
  {
    "text": "you pick a value that they're not going to guess and you don't store it in memory but you didn't do an extra extend",
    "start": "2442020",
    "end": "2448680"
  },
  {
    "text": "on the PCRs after you extracted the value so the attacker can just go right back to the TPM and read it out so make",
    "start": "2448680",
    "end": "2455910"
  },
  {
    "text": "sure after you read the value out you do an another extend on one of those PCRs which is like spinning the dial on that",
    "start": "2455910",
    "end": "2462630"
  },
  {
    "text": "on the lock of your your combination lock",
    "start": "2462630",
    "end": "2466819"
  },
  {
    "text": "yeah and again so the bottom line is be careful about what you're sealing in there and and how you use those values a",
    "start": "2468500",
    "end": "2476430"
  },
  {
    "text": "lot of people want to use this for disk encryption and say all right well I can",
    "start": "2476430",
    "end": "2482369"
  },
  {
    "text": "make sure the system won't boot you know unload my home directory if all my data you know is on the drive is encrypted",
    "start": "2482369",
    "end": "2488700"
  },
  {
    "text": "and the key is stored in the TPM just have to be careful if that's the key that you keep around at runtime so",
    "start": "2488700",
    "end": "2495060"
  },
  {
    "text": "you can continue to access the disk the attacker can find that and fake that you",
    "start": "2495060",
    "end": "2500250"
  },
  {
    "text": "know using that both to protect your data and to ensure you're in a trusted state you're putting putting a lot on on",
    "start": "2500250",
    "end": "2507930"
  },
  {
    "text": "one value and perhaps opening yourself up to compromise so what's my recommendation",
    "start": "2507930",
    "end": "2515359"
  },
  {
    "text": "you know there probably are several ways you can do this safely but what I",
    "start": "2515359",
    "end": "2520710"
  },
  {
    "text": "recommend is using a value that's displayed to the user at boot time only to authenticate that trusted boot",
    "start": "2520710",
    "end": "2527820"
  },
  {
    "text": "actually worked so you're gonna take it could be a picture it could be a string",
    "start": "2527820",
    "end": "2533580"
  },
  {
    "text": "think like when you log in to your bank right a lot of them but you want to use their name before you type in the",
    "start": "2533580",
    "end": "2539430"
  },
  {
    "text": "password like they'll show you a picture or you know some text that you type you want that kind of thing in the pre-boot",
    "start": "2539430",
    "end": "2546000"
  },
  {
    "text": "environment here show the user something that they created that's unique to them to prove the system is in a trusted",
    "start": "2546000",
    "end": "2553080"
  },
  {
    "text": "state have them hit enter to continue right when they hit enter wipe that secret out of memory do another extend",
    "start": "2553080",
    "end": "2559860"
  },
  {
    "text": "out of the to the PCR so that's not accessible at runtime after that and",
    "start": "2559860",
    "end": "2565770"
  },
  {
    "text": "then allow the system you know to boot the rest of the way and you can combine that with full disk encryption and things like that but this is the way",
    "start": "2565770",
    "end": "2572430"
  },
  {
    "text": "that you can really attest to that user that systems in a secure state and you can do the same kind of thing",
    "start": "2572430",
    "end": "2579570"
  },
  {
    "text": "with remote attestation and instead of displaying it locally to a user at that point in time you can you know attest to",
    "start": "2579570",
    "end": "2586320"
  },
  {
    "text": "your remote server that you've configured properly all right so that that concludes my talk",
    "start": "2586320",
    "end": "2593840"
  },
  {
    "text": "I want to thank thank everybody for coming and at this time open it up for any questions",
    "start": "2593840",
    "end": "2601340"
  },
  {
    "text": "[Applause]",
    "start": "2606400",
    "end": "2610268"
  },
  {
    "text": "hi so out of a hundred sis admins or a hundred how many people will know this I",
    "start": "2632210",
    "end": "2638119"
  },
  {
    "text": "mean well know about the technology I mean to",
    "start": "2638119",
    "end": "2643230"
  },
  {
    "text": "implement the kind of things you talked about here so make it make sense having heard this brief but I'm just wondering",
    "start": "2643230",
    "end": "2650190"
  },
  {
    "text": "if you were running along fat dumb and happy saying I got a really good set of security people with most of them",
    "start": "2650190",
    "end": "2656220"
  },
  {
    "text": "intuitive we know this or this be something you need to hold special training classes on or or what yeah so",
    "start": "2656220",
    "end": "2662099"
  },
  {
    "text": "this is not something most admins will know they might know the name txt and",
    "start": "2662099",
    "end": "2667230"
  },
  {
    "text": "kyboot on things like ESXi well it can use t boot by default sysadmin might",
    "start": "2667230",
    "end": "2674160"
  },
  {
    "text": "check a box to say they want to you know use that technology they probably don't understand the inner workings very well",
    "start": "2674160",
    "end": "2680820"
  },
  {
    "text": "at all right so yeah it would be something to",
    "start": "2680820",
    "end": "2686670"
  },
  {
    "text": "to go to training on you know to learn about and you know so I've been talking",
    "start": "2686670",
    "end": "2693240"
  },
  {
    "text": "with Intel and the hope is to get an instantiation that uses sealed storage that's that's out there open source that",
    "start": "2693240",
    "end": "2700619"
  },
  {
    "text": "you know can be kind of turnkey so that we can point sis admins to that to be able to use it and and the hypervisor",
    "start": "2700619",
    "end": "2707970"
  },
  {
    "text": "you talked about it a hypervisor root is something routinely available that most most attackers would know about",
    "start": "2707970",
    "end": "2715730"
  },
  {
    "text": "so it's it's a type of rootkit um it's been around for a while blue pill was",
    "start": "2715730",
    "end": "2722670"
  },
  {
    "text": "kind of the first one that you know we heard about so it's a technique known to attackers",
    "start": "2722670",
    "end": "2728630"
  },
  {
    "text": "how widely known as it is it's not certainly not the most common type of attack but but it is kind of known in",
    "start": "2728630",
    "end": "2735240"
  },
  {
    "text": "community yeah thank you",
    "start": "2735240",
    "end": "2738650"
  },
  {
    "text": "yep yeah I just recently attended the",
    "start": "2740660",
    "end": "2746000"
  },
  {
    "text": "the iOS security kernel that they had which really looked like a reference",
    "start": "2746000",
    "end": "2752790"
  },
  {
    "text": "monitor and and so it really brings us a question just at a high level I mean it",
    "start": "2752790",
    "end": "2758099"
  },
  {
    "text": "just seems to me that txt is just not that useful given that in the end there's so much in the",
    "start": "2758099",
    "end": "2764519"
  },
  {
    "text": "trusted path that has to be trusted so to speak and it's just not there I mean you got the hardware but then everything",
    "start": "2764519",
    "end": "2771239"
  },
  {
    "text": "else is still depend on the software you know the operating system the hypervisor",
    "start": "2771239",
    "end": "2776900"
  },
  {
    "text": "yeah so I mean we're we're looking at it in a data center context trying to to secure our VMs and in an open",
    "start": "2776900",
    "end": "2785180"
  },
  {
    "text": "stack environment and it's it's a really tough problem you know so it is a really",
    "start": "2785180",
    "end": "2790289"
  },
  {
    "text": "hard problem and and I should say I'm actually a big fan of the technology it's really difficult to use it's really",
    "start": "2790289",
    "end": "2797369"
  },
  {
    "text": "complex right but the problem that Intel is tackling here is much larger than",
    "start": "2797369",
    "end": "2803279"
  },
  {
    "text": "like the problem Apple is tackling on their devices because they want to be able to do this when they don't control",
    "start": "2803279",
    "end": "2808289"
  },
  {
    "text": "all the hardware there's a bunch of third-party hardware in there so they're they're tackling a huge problem here and",
    "start": "2808289",
    "end": "2815759"
  },
  {
    "text": "I think what we have are some good tools for the job but there's there's still some work to bring it up to level it",
    "start": "2815759",
    "end": "2822660"
  },
  {
    "text": "makes it you know easier and safer for people to configure and and use and I",
    "start": "2822660",
    "end": "2829589"
  },
  {
    "text": "think large data centers um is really where this this makes the most sense because there's enough value there to",
    "start": "2829589",
    "end": "2834930"
  },
  {
    "text": "spend the time to get it right as compared to like you know just my laptop it's probably not something most users",
    "start": "2834930",
    "end": "2841619"
  },
  {
    "text": "are gonna play around with for a single laptop but for some you know critical",
    "start": "2841619",
    "end": "2847130"
  },
  {
    "text": "cloud infrastructure and things like that it's it's worth the time to to get an implementation that that works and",
    "start": "2847130",
    "end": "2854339"
  },
  {
    "text": "that's right and even though it's complex there's a lot of moving parts there can be a huge benefit when you do it the right way yeah I mean I can see",
    "start": "2854339",
    "end": "2861059"
  },
  {
    "text": "that there's some benefit here it just it just seems like it's not enough really I mean you need a secure",
    "start": "2861059",
    "end": "2867089"
  },
  {
    "text": "processor you need some way of reaching back into the i/o and controlling the i/o of the you know the hypervisor and",
    "start": "2867089",
    "end": "2874499"
  },
  {
    "text": "and I guess the interrupts and all that stuff I mean just I think there has to",
    "start": "2874499",
    "end": "2879749"
  },
  {
    "text": "be a little bit more well I mean iOS I think went a long way with their their",
    "start": "2879749",
    "end": "2884819"
  },
  {
    "text": "work I was really impressed so this just seems like just too small a piece",
    "start": "2884819",
    "end": "2889900"
  },
  {
    "text": "but I understand what you're saying yeah that's it's better than nothing so alright yeah",
    "start": "2889900",
    "end": "2896910"
  },
  {
    "text": "got a question about the AES and I highjacking sure so you're manipulating",
    "start": "2900580",
    "end": "2907180"
  },
  {
    "text": "the bits in the control register if I understand correctly to turn off the X mmm my mmm",
    "start": "2907180",
    "end": "2913330"
  },
  {
    "text": "is there a way that the higher-level OS that's being hijacked can check those",
    "start": "2913330",
    "end": "2920140"
  },
  {
    "text": "control registers or can the hypervisor just lie about those values yeah so the hypervisor can lie about those values",
    "start": "2920140",
    "end": "2926590"
  },
  {
    "text": "it's actually kind of inherent and an easy thing to do in order to like",
    "start": "2926590",
    "end": "2932500"
  },
  {
    "text": "support multiple VMs with different settings like hypervisor inherently has the ability to have one set of values in",
    "start": "2932500",
    "end": "2938110"
  },
  {
    "text": "the hardware and a different set in like what's called a read shadow so when the guest operating system reads the",
    "start": "2938110",
    "end": "2943210"
  },
  {
    "text": "register they can see one value but it's different than what's really in the hardware so that's how we implement it",
    "start": "2943210",
    "end": "2949270"
  },
  {
    "text": "also on the CPU checks for support it thinks that it's there and it's turned on but but it's actually not okay thanks",
    "start": "2949270",
    "end": "2955870"
  },
  {
    "text": "all right I think with that I'm out of time I'll be around I'll be out in the hallway if anybody has other questions",
    "start": "2955870",
    "end": "2961390"
  },
  {
    "text": "happy to to talk to you then thanks again for attending",
    "start": "2961390",
    "end": "2967260"
  }
]