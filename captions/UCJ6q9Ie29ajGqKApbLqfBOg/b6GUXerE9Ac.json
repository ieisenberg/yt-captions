[
  {
    "text": "hi good afternoon I hope everybody had a good lunch today uh welcome to black hat 2015 briefings day one uh just a couple",
    "start": "80",
    "end": "8000"
  },
  {
    "text": "of announcements there will be a reception tonight in the business Hall at 5:30 that's located in Shoreline a",
    "start": "8000",
    "end": "14679"
  },
  {
    "text": "the pony awards are also this evening those are in Mandalay Bay uh BCD at 6:00",
    "start": "14679",
    "end": "21600"
  },
  {
    "text": "p.m. you are in the room uh Mandalay EF right now for the session red versus",
    "start": "21600",
    "end": "27000"
  },
  {
    "text": "blue modern active directory attacks detection and protection Sean metcafe is",
    "start": "27000",
    "end": "32398"
  },
  {
    "text": "your speaker if that's where you intend to be great if not uh now you know also uh as with all talks we really",
    "start": "32399",
    "end": "40399"
  },
  {
    "text": "would prefer not to hear your super cool ring tone so let's make sure our phones are on vibrate and with that Sean I will",
    "start": "40399",
    "end": "46600"
  },
  {
    "text": "allow you to take a away thank",
    "start": "46600",
    "end": "50440"
  },
  {
    "text": "you whoops good afternoon I'm Sean metcafe and this is red versus blue",
    "start": "52800",
    "end": "58640"
  },
  {
    "text": "modern act directory attacks protection and prevention it's a long title but effectively we're going to talk about",
    "start": "58640",
    "end": "64838"
  },
  {
    "text": "active directory attack and [Music]",
    "start": "64839",
    "end": "69960"
  },
  {
    "text": "defense on the CTO of Dan Solutions which is a Microsoft Solutions",
    "start": "69960",
    "end": "76040"
  },
  {
    "text": "provider engineering and Security Solutions so I go into customers and talk to them about how they can secure",
    "start": "76040",
    "end": "82360"
  },
  {
    "text": "their Microsoft Enterprise specifically active directory and I do a lot of security research",
    "start": "82360",
    "end": "87479"
  },
  {
    "text": "surrounding active directory and I post that often times to adc.org",
    "start": "87479",
    "end": "93600"
  },
  {
    "text": "so the agenda is simple we're going to show some attacks basically there's a lot of conversation in the news and the",
    "start": "93600",
    "end": "100320"
  },
  {
    "text": "media about malware we're not going to talk about malware we're going to talk about what",
    "start": "100320",
    "end": "106240"
  },
  {
    "text": "happens once that malware gets on a computer and those attackers Connect into that computer and use it as their",
    "start": "106240",
    "end": "112399"
  },
  {
    "text": "jumping Point how does an attacker get from domain user to domain admin we're going to talk about some of those",
    "start": "112399",
    "end": "118320"
  },
  {
    "text": "techniques so we know in the news we have breaches",
    "start": "118320",
    "end": "125759"
  },
  {
    "text": "seems like every week there's another one that's announced we hear about the malware but how do they completely own",
    "start": "125759",
    "end": "132400"
  },
  {
    "text": "an environment don't we have security to protect against this well the issue is",
    "start": "132400",
    "end": "137680"
  },
  {
    "text": "that our traditional security is easily bypassed why because we've been focusing on the perimeter for years our firewalls",
    "start": "137680",
    "end": "145120"
  },
  {
    "text": "our primitive security devices are not doing what we need them to do today",
    "start": "145120",
    "end": "150920"
  },
  {
    "text": "email goes right through it right users get spear fished why do they click on links because they look like this it's",
    "start": "150920",
    "end": "157400"
  },
  {
    "text": "way too easy to get someone to click on a link or open up an attachment and then click on that little button that says",
    "start": "157400",
    "end": "162720"
  },
  {
    "text": "enable content what does that mean to a user nothing to user that means click on",
    "start": "162720",
    "end": "167800"
  },
  {
    "text": "this to see the content okay we've trained them to do this Verizon released their data breach",
    "start": "167800",
    "end": "174680"
  },
  {
    "text": "investigation report last year and it said what a lot of numbers 70 to 90% of",
    "start": "174680",
    "end": "181040"
  },
  {
    "text": "the malware that was used in these breaches was unique to that",
    "start": "181040",
    "end": "186280"
  },
  {
    "text": "organization 99.9% Almost 100% of the vulnerabilities exploited in",
    "start": "186959",
    "end": "194080"
  },
  {
    "text": "these breaches had patches that came out a year before that and 50% of the users in The Spar",
    "start": "194080",
    "end": "201280"
  },
  {
    "text": "fishing exercise actually opened up the email within an hour all right so we",
    "start": "201280",
    "end": "206560"
  },
  {
    "text": "know email works right so let's talk about what the attackers are doing the red",
    "start": "206560",
    "end": "212159"
  },
  {
    "text": "team what their motivations are what are they after other than maybe I don't know sharks with freaking laser memes on",
    "start": "212159",
    "end": "218519"
  },
  {
    "text": "their heads or something what are attackers after they want data they want to grab the data",
    "start": "218519",
    "end": "225200"
  },
  {
    "text": "from organizations they want to put it out of the internet where they can access it and they want to persist in the",
    "start": "225200",
    "end": "230920"
  },
  {
    "text": "environment sometimes this includes P privilege escalation sometimes it doesn't a lot of times it does why",
    "start": "230920",
    "end": "237280"
  },
  {
    "text": "because it's too easy to get to domain admin you want to learn more about persistence I highly recommend you go to",
    "start": "237280",
    "end": "242519"
  },
  {
    "text": "MC Raber's talk in this room at 420 because he'll talk about the Advanced Techniques that attackers are",
    "start": "242519",
    "end": "248640"
  },
  {
    "text": "using today to persist in the network a Powershell a lot has been",
    "start": "248640",
    "end": "253879"
  },
  {
    "text": "talked about in Powershell the past few years Powershell is an integrated",
    "start": "253879",
    "end": "259400"
  },
  {
    "text": "component in Windows you cannot uninstall it on every version or every supported version of Windows that's out",
    "start": "259400",
    "end": "266160"
  },
  {
    "text": "today why do attackers love powers showell well there's a bunch of toolkits they can",
    "start": "266160",
    "end": "271880"
  },
  {
    "text": "use but the coolest thing about Powershell to an attacker is the fact that they can grab code off of a web",
    "start": "271880",
    "end": "277600"
  },
  {
    "text": "server have it download and execute in memory and nothing touches dis antivirus",
    "start": "277600",
    "end": "283120"
  },
  {
    "text": "will not stop this we power exploit invoke mimic cats injecting Shell Code",
    "start": "283120",
    "end": "288240"
  },
  {
    "text": "into memory stealing tokens reusing injecting processes or executables into",
    "start": "288240",
    "end": "293680"
  },
  {
    "text": "existing running process nishang is another one that's very similar with additional tools for Recon in an",
    "start": "293680",
    "end": "300320"
  },
  {
    "text": "environment power up enables the attacker to identify who's logged on to what computer with additional tools for",
    "start": "300320",
    "end": "306880"
  },
  {
    "text": "reconing an act directory environment and Powershell Empire which is being announced in about 5",
    "start": "306880",
    "end": "314080"
  },
  {
    "text": "minutes Powershell Empire check it out this is the evolution of Powell",
    "start": "314080",
    "end": "321800"
  },
  {
    "text": "attacks so an attacker gets on a system they have their malware there they are",
    "start": "322319",
    "end": "327520"
  },
  {
    "text": "operating as a domain user well they could use a traditional method of getting information about the",
    "start": "327520",
    "end": "333800"
  },
  {
    "text": "environment what is that Network Port scanning right hit a whole bunch of ips on different ports and I get some",
    "start": "333800",
    "end": "339039"
  },
  {
    "text": "information back we don't need to do that anymore active directory has all this information why would an attacker",
    "start": "339039",
    "end": "344479"
  },
  {
    "text": "need to do a port scan in order for a service to support keros there needs to",
    "start": "344479",
    "end": "350240"
  },
  {
    "text": "be a service principal name associated without account that provides that service be it a service account or a",
    "start": "350240",
    "end": "355600"
  },
  {
    "text": "computer account well that information is in active directory service principal name or spin is formatted like this you",
    "start": "355600",
    "end": "363880"
  },
  {
    "text": "have the spin class you have the server name and with seel even has the port",
    "start": "363880",
    "end": "368960"
  },
  {
    "text": "number sqls running on who here changes the SQL port in order to be a little more tricky so that way no one knows",
    "start": "368960",
    "end": "375720"
  },
  {
    "text": "what it is right it's right here in active directory as a domain user we can request this",
    "start": "375720",
    "end": "381759"
  },
  {
    "text": "information I can request it with Powershell I can spin scan for every SQL",
    "start": "381759",
    "end": "388960"
  },
  {
    "text": "Server in the domain or the forest by spin scanning when I do this I get",
    "start": "388960",
    "end": "394240"
  },
  {
    "text": "information about every SQL Server including the port it's running on or an instance name the SQL uh service account",
    "start": "394240",
    "end": "400919"
  },
  {
    "text": "that's there so this means I can also spin scan for service accounts that's really",
    "start": "400919",
    "end": "406759"
  },
  {
    "text": "useful what if I can find the SQL service account that's the account that is the administrator on all of these SQL",
    "start": "406759",
    "end": "413639"
  },
  {
    "text": "servers here I have three okay what can I do with that",
    "start": "413639",
    "end": "419680"
  },
  {
    "text": "well last year at Deron Tim medine released a python based tool called Kerberos if you're a Defender you're",
    "start": "419680",
    "end": "426520"
  },
  {
    "text": "very scared of this so he recognized that the way that Kerberos communication works is that the",
    "start": "426520",
    "end": "434120"
  },
  {
    "text": "user types in the username password prove their identity to the domain",
    "start": "434120",
    "end": "439720"
  },
  {
    "text": "controller and the domain controller looks them up in ad and goes okay this user is a member of these groups has",
    "start": "439720",
    "end": "445599"
  },
  {
    "text": "these log on restrictions Etc builds a TGT a ticket granting ticket it's",
    "start": "445599",
    "end": "451440"
  },
  {
    "text": "effectively the authentication ticket it proves that user is that user to active directory to the domain controller so",
    "start": "451440",
    "end": "457639"
  },
  {
    "text": "that TGT is delivered to the user the user turns around gives it back to the domain controller says I need a service",
    "start": "457639",
    "end": "463199"
  },
  {
    "text": "ticket for this service principal name 80 doesn't care it goes all right",
    "start": "463199",
    "end": "468280"
  },
  {
    "text": "you have a valid TGT I'm going to take the data out of the TGT or effectively take your group membership that",
    "start": "468280",
    "end": "473720"
  },
  {
    "text": "information put into that service ticket that service ticket is encrypted with the service account password that is",
    "start": "473720",
    "end": "480639"
  },
  {
    "text": "running under the context of that service so again a user account or a",
    "start": "480639",
    "end": "486560"
  },
  {
    "text": "computer so what does this mean this means that if an",
    "start": "486560",
    "end": "492478"
  },
  {
    "text": "attacker requests a service ticket for a specific service principal name on the network gets a service ticket for it",
    "start": "493120",
    "end": "499919"
  },
  {
    "text": "using Powell you can see on the bottom here that I have that service ticket the",
    "start": "499919",
    "end": "505720"
  },
  {
    "text": "domain controller doesn't care if I ever actually talk to that server I'm going to get service ticket",
    "start": "505720",
    "end": "511000"
  },
  {
    "text": "anyway so we can take that service ticket out of memory save it using mimic",
    "start": "511000",
    "end": "516279"
  },
  {
    "text": "cats or there's other tools to use and then copy it up to the internet somewhere I can use my attacker box on",
    "start": "516279",
    "end": "523719"
  },
  {
    "text": "AWS or Azure or wherever run p uh run the uh ceros tool",
    "start": "523719",
    "end": "531320"
  },
  {
    "text": "against it and what'll happen is I can have a whole bunch of service account related service tickets and have keros",
    "start": "531320",
    "end": "539640"
  },
  {
    "text": "run through and brute force them based on my dictionary file why does this",
    "start": "539640",
    "end": "545240"
  },
  {
    "text": "work what is your domain password policy what is the minimum eight characters 10",
    "start": "545240",
    "end": "551880"
  },
  {
    "text": "characters 12 [Music] 15 needs to be 25 now or",
    "start": "551880",
    "end": "558839"
  },
  {
    "text": "higher you don't want your service account to be the one that actually is the reason why your entire domain gets",
    "start": "558839",
    "end": "565120"
  },
  {
    "text": "popped keros is way too easy to run because the attacker",
    "start": "565120",
    "end": "571360"
  },
  {
    "text": "can crack those passwords offline and they have months to do so they can use a Bitcoin rig even to uh",
    "start": "571600",
    "end": "578519"
  },
  {
    "text": "really get some good numbers but there's also managed service counts and group managed service counts which can be used",
    "start": "578519",
    "end": "585440"
  },
  {
    "text": "so the ad will actually manage that password it'll be a really long complex password which will never get",
    "start": "585440",
    "end": "590959"
  },
  {
    "text": "cracked so another problem we have is that group policy preferences when it was dropped with sorry when it was",
    "start": "590959",
    "end": "597079"
  },
  {
    "text": "released with Windows Server 2008 provided a great way for local admin",
    "start": "597079",
    "end": "602959"
  },
  {
    "text": "account passwords to be changed on hundreds and thousands of computers great it was AES 256bit encrypted that's",
    "start": "602959",
    "end": "610279"
  },
  {
    "text": "how that password was stored but Microsoft published the",
    "start": "610279",
    "end": "615480"
  },
  {
    "text": "private key so all an attacker has to do is scan",
    "start": "615480",
    "end": "622240"
  },
  {
    "text": "this location which is cisv look for XML files with a c password attribute pull extract them",
    "start": "622240",
    "end": "629440"
  },
  {
    "text": "that AES encrypted blob that comes after it and run an AES decrypt function",
    "start": "629440",
    "end": "634760"
  },
  {
    "text": "against it which we can use Powershell for leveraging that private key so this means that a domain user can",
    "start": "634760",
    "end": "643720"
  },
  {
    "text": "scan CIS fall and potentially get the local admin account for thousands of computers in the environment don't use",
    "start": "643720",
    "end": "652040"
  },
  {
    "text": "this so mitigating this really comes down to ensuring that administrators are",
    "start": "652040",
    "end": "658360"
  },
  {
    "text": "not putting cral in the group policy preferences Microsoft has a patch for that it has to be applied on every",
    "start": "658360",
    "end": "664839"
  },
  {
    "text": "system where an admin could use Group Policy Management console to set that to",
    "start": "664839",
    "end": "670160"
  },
  {
    "text": "apply those credentials or set them into that policy but that doesn't remove those",
    "start": "670160",
    "end": "675639"
  },
  {
    "text": "passwords from group policy or from CIS fall if they're already there so you have to go through and scan them",
    "start": "675639",
    "end": "681000"
  },
  {
    "text": "thankfully this KB article has a scanner that Microsoft put out which seems to be Loosely based on the uh get gpp password",
    "start": "681000",
    "end": "687480"
  },
  {
    "text": "in power sploit but you didn't hear that for me so how do we detect this well the",
    "start": "687480",
    "end": "693519"
  },
  {
    "text": "easiest way is to create an XML file dropping in cisv which has some data and it doesn't really matter but you set",
    "start": "693519",
    "end": "699440"
  },
  {
    "text": "everyone deny access and then you set auditing on it and that way when someone's scanning through CIS fall you",
    "start": "699440",
    "end": "705560"
  },
  {
    "text": "get an alert you get an event on your DC that you can trigger off of so the other issue is when every",
    "start": "705560",
    "end": "712279"
  },
  {
    "text": "computer account or local account in a domain or across a lot of",
    "start": "712279",
    "end": "718440"
  },
  {
    "text": "computers has a same account name and password specifically administrator accounts because Windows is very nice",
    "start": "718440",
    "end": "724079"
  },
  {
    "text": "about these things when there's a computer account over here a computer over here and a computer over here they have the same local admin account name",
    "start": "724079",
    "end": "730680"
  },
  {
    "text": "and password it works across the network so the whole local thing is a bit of a",
    "start": "730680",
    "end": "737800"
  },
  {
    "text": "misnomer so how do you protect that well two different parts one you have to make sure that your local admin account",
    "start": "738160",
    "end": "743600"
  },
  {
    "text": "passwords are randomized you want to make sure that they're unique across all your computers in your Enterprise because obviously",
    "start": "743600",
    "end": "749600"
  },
  {
    "text": "compromising one computer enables an attacker to compromise others the second part is you can install the KB 2871 1997",
    "start": "749600",
    "end": "758040"
  },
  {
    "text": "patch which is effectively a security backport from Windows 2 uh 2012 R2 and",
    "start": "758040",
    "end": "763440"
  },
  {
    "text": "Windows 8.1 and it adds some local SIDS to the computers these local SIDS say",
    "start": "763440",
    "end": "769240"
  },
  {
    "text": "this is a local user on this computer and you can create a group policy that prevents the local SIDS from logging in",
    "start": "769240",
    "end": "775079"
  },
  {
    "text": "across the network to another computer so I'm pretty sure everyone here is familiar with mimik cats right I",
    "start": "775079",
    "end": "781600"
  },
  {
    "text": "call it the credential multitool because it can dump all the credentials including curos tickets",
    "start": "781600",
    "end": "787839"
  },
  {
    "text": "reuse them generate golden tickets silver tickets Forge tickets whatever you",
    "start": "787839",
    "end": "794160"
  },
  {
    "text": "want and based on the access you can get all of them or the current users so this is what it looks like on",
    "start": "794160",
    "end": "800880"
  },
  {
    "text": "the left you have an admin Han Solo who's a great server admin he's logged on to the server the server's been",
    "start": "800880",
    "end": "807160"
  },
  {
    "text": "compromised which means that now his account is is compromised on the right",
    "start": "807160",
    "end": "812240"
  },
  {
    "text": "side we all have service accounts right we all have services that run across a large number",
    "start": "812240",
    "end": "819399"
  },
  {
    "text": "of computers we have that because we have vendors that say here's this product it does all this great stuff for",
    "start": "819399",
    "end": "824480"
  },
  {
    "text": "you fantastic what rights does this service count need domain admin okay I",
    "start": "824480",
    "end": "829600"
  },
  {
    "text": "want that functionality but the problem is that if a service is running under the context",
    "start": "829600",
    "end": "834800"
  },
  {
    "text": "of a service account those credentials are in Elsas which means mimic cats can dump them so",
    "start": "834800",
    "end": "841360"
  },
  {
    "text": "if you're running a service on workstations that has domain admin rights to your",
    "start": "841360",
    "end": "848800"
  },
  {
    "text": "domain you're not going to have a good day in the future if you haven't already and you'll notice that the clear text",
    "start": "848959",
    "end": "854920"
  },
  {
    "text": "password is there also well if you install that backport patch KB 2871",
    "start": "854920",
    "end": "861000"
  },
  {
    "text": "997 it will enable you to set a redge key so that password isn't stored in",
    "start": "861000",
    "end": "867079"
  },
  {
    "text": "Elsas so let's talk about ceros a little",
    "start": "867680",
    "end": "872120"
  },
  {
    "text": "bit if there are any keros nerds in the house like myself you're familiar with the double hop issue when active",
    "start": "874040",
    "end": "880600"
  },
  {
    "text": "directory was released Microsoft said let's use keros great problem is that a",
    "start": "880600",
    "end": "885920"
  },
  {
    "text": "service ticket the user gets for the web server does not work on the database server so how did they fix",
    "start": "885920",
    "end": "892120"
  },
  {
    "text": "this came up with unconstrained delegation you probably seen this that box in the middle that's uncon strain",
    "start": "892120",
    "end": "899240"
  },
  {
    "text": "delegation constrain delegation is the one below it which constrains that",
    "start": "899240",
    "end": "904399"
  },
  {
    "text": "delegation or that impersonation to specific Services running on specific",
    "start": "904399",
    "end": "910120"
  },
  {
    "text": "servers you can find these servers or systems or accounts by using Powershell",
    "start": "910240",
    "end": "916959"
  },
  {
    "text": "that first box that box that I've highlighted that's unconstrained delegation after this talk if you have any of those in your environment you",
    "start": "916959",
    "end": "923000"
  },
  {
    "text": "know you want to get rid of them the second box is constrained delegation that's much better why is unconstrained",
    "start": "923000",
    "end": "928360"
  },
  {
    "text": "delegation so bad well let's go back to the cerbos diagram when the user requests that service ticket for that",
    "start": "928360",
    "end": "935399"
  },
  {
    "text": "service running on that server which has unconstrained delegation the domain controller takes the copy of the user's",
    "start": "935399",
    "end": "941240"
  },
  {
    "text": "TGT and puts it into that service ticket delivers it back to the user because unconstrained delegation is",
    "start": "941240",
    "end": "947920"
  },
  {
    "text": "configured for that server or account so when the user provides that service",
    "start": "947920",
    "end": "952959"
  },
  {
    "text": "ticket to the server that's hosting that service that TGT is plac in the Elsas is",
    "start": "952959",
    "end": "960240"
  },
  {
    "text": "placed in a memory see why this is bad I've found environments that still",
    "start": "960240",
    "end": "966360"
  },
  {
    "text": "have UNC constrain delegation enabled and it wouldn't take much a social engineer a domain admin like good",
    "start": "966360",
    "end": "972959"
  },
  {
    "text": "old Luke Skywalker to connect to the server over a Cerro service he doesn't have to type in his credentials he just",
    "start": "972959",
    "end": "979720"
  },
  {
    "text": "needs to connect to a network share and you see at the Top This is a",
    "start": "979720",
    "end": "985199"
  },
  {
    "text": "network session but we have their have this users TGT which then we pass the ticket and using",
    "start": "985199",
    "end": "992199"
  },
  {
    "text": "Powershell remoting we can connect to a domain controller and we can dump the curb TGT account password hash which",
    "start": "992199",
    "end": "997720"
  },
  {
    "text": "means we can create golden tickets now the best and easiest way to fix this",
    "start": "997720",
    "end": "1003720"
  },
  {
    "text": "is don't use unconstrained delegation the other one is to check this box on your admin",
    "start": "1003720",
    "end": "1011000"
  },
  {
    "text": "accounts so attackers want to dump the domain credentials so that way they can be anyone they want or maybe create",
    "start": "1011360",
    "end": "1018000"
  },
  {
    "text": "golden tickets so the first way to do that is find the ntds.dit file that act directory",
    "start": "1018000",
    "end": "1023639"
  },
  {
    "text": "database file the other way is to steal credentials so where would the dit be so",
    "start": "1023639",
    "end": "1031160"
  },
  {
    "text": "everyone in an environment or a domain admin or security people for an organization do you know where your did",
    "start": "1031160",
    "end": "1037438"
  },
  {
    "text": "is maybe not backups of your domain controllers any external storage for the",
    "start": "1037439",
    "end": "1043438"
  },
  {
    "text": "domain controller such as a network device like a Nas or san or even uh just a b bunch of discs",
    "start": "1043439",
    "end": "1050000"
  },
  {
    "text": "well who administers your your virtual environment which has and hosts your virtual",
    "start": "1050000",
    "end": "1056000"
  },
  {
    "text": "DCS do you consider them domain admins well you probably should in VMware if I'm a VMware admin I can clone a virtual",
    "start": "1056000",
    "end": "1063760"
  },
  {
    "text": "DC within VMware and once I have that clone I don't need to start it I can copy down the storage files associated",
    "start": "1063760",
    "end": "1070320"
  },
  {
    "text": "with that clone V uh DC no alarm bells are going to go off in ad and no alarm bells are going to go",
    "start": "1070320",
    "end": "1076679"
  },
  {
    "text": "and no events are going to be triggered on uh on a DC or on a Windows system because I don't even start that up I can delete that clone VM after I pull those",
    "start": "1076679",
    "end": "1084120"
  },
  {
    "text": "files down now if I'm an attacker and I get on a mission sensitive box I may not want",
    "start": "1084120",
    "end": "1089840"
  },
  {
    "text": "to use a hacker tool or you know mimik cats or something like that well I can use task manager and dump Elsas into an",
    "start": "1089840",
    "end": "1096600"
  },
  {
    "text": "Elsas dump file and I can copy that off somewhere else and run mimicat against it there it's be a little more difficult",
    "start": "1096600",
    "end": "1103440"
  },
  {
    "text": "to discover that I was on that box but that Elsa stump file may actually have",
    "start": "1103440",
    "end": "1109280"
  },
  {
    "text": "the domain admin credentials in it it's what it looks like once I get to the domain controller or have access to",
    "start": "1109280",
    "end": "1115880"
  },
  {
    "text": "it where I can dump the credentials I'm going to be I'm going to have those those ntlm password",
    "start": "1115880",
    "end": "1120919"
  },
  {
    "text": "hashes or I can use ntds util what's ntdsutil it's a tool used by",
    "start": "1120919",
    "end": "1126760"
  },
  {
    "text": "administrators to administer the ACT directory database or manage it so when domain controllers are being",
    "start": "1126760",
    "end": "1134919"
  },
  {
    "text": "stood up especially when there's a large number of them or you have a branch office scenario where the bandwidth isn't great when you run DC promo that",
    "start": "1134919",
    "end": "1142520"
  },
  {
    "text": "server has to copy from another domain controller all the domain information but if we use ntds util to",
    "start": "1142520",
    "end": "1149840"
  },
  {
    "text": "create and install from media set or ifm it makes a copy of theit for us so an",
    "start": "1149840",
    "end": "1155280"
  },
  {
    "text": "attacker could use this or go looking for an ifm on the",
    "start": "1155280",
    "end": "1160520"
  },
  {
    "text": "network so in an environment where you have a domain controller that you need",
    "start": "1160520",
    "end": "1165559"
  },
  {
    "text": "to stand up and you have a server that's already staged you may drop an ifm on there but that server is not a DC yet so",
    "start": "1165559",
    "end": "1171600"
  },
  {
    "text": "it may not be secured in the same way and there may even be an ifm on the network somewhere and a",
    "start": "1171600",
    "end": "1179159"
  },
  {
    "text": "share but the key point to this is once an attacker has access to the did file",
    "start": "1179159",
    "end": "1184320"
  },
  {
    "text": "they own your domain because they can dump all the credentials and the one I've highlighted is the curb tdt one",
    "start": "1184320",
    "end": "1189880"
  },
  {
    "text": "which means again I can create golden tickets",
    "start": "1189880",
    "end": "1194600"
  },
  {
    "text": "well what can I do with ntlm hashes I can pass the hash but there's some detection for that",
    "start": "1199360",
    "end": "1205880"
  },
  {
    "text": "but last year on the stage Benjamin delpia and Skip duckwall in their golden ticket talk talked about overpass the",
    "start": "1205880",
    "end": "1212360"
  },
  {
    "text": "hash and by clearing out all the curos encryption keys that are on that system and injecting that ntlm password hash I",
    "start": "1212360",
    "end": "1219919"
  },
  {
    "text": "can take that password hash and switch it over so that I'm using a cerose",
    "start": "1219919",
    "end": "1225400"
  },
  {
    "text": "ticket which is a lot more difficult to detect",
    "start": "1225400",
    "end": "1230640"
  },
  {
    "text": "just Sunday Benjamin delpy released DC sync which is part of his Keo Suite what",
    "start": "1231120",
    "end": "1237480"
  },
  {
    "text": "is this a lot of people were confused some people got it right away he describes it as such hey I'm a DC send",
    "start": "1237480",
    "end": "1245000"
  },
  {
    "text": "me the password hashes for these accounts and the DC does it using standard official apis that Microsoft",
    "start": "1245000",
    "end": "1252080"
  },
  {
    "text": "has published you have to be a domain admin to do it but this is going to be the next method of how people are",
    "start": "1252080",
    "end": "1258280"
  },
  {
    "text": "pulling in hashes password hashes which includes the old passwords for accounts",
    "start": "1258280",
    "end": "1263679"
  },
  {
    "text": "which could be interesting for a variety of reasons yeah I agree with bad Brad Pit",
    "start": "1263679",
    "end": "1269840"
  },
  {
    "text": "that's kind of an issue so how do you detect this it's very difficult there's a lot of",
    "start": "1269840",
    "end": "1275600"
  },
  {
    "text": "different methods ultimately comes down to protecting your DC storage the did file any DC backups protecting the",
    "start": "1275600",
    "end": "1284760"
  },
  {
    "text": "credentials and ultimately separating your domain ad or your admin accounts on the network",
    "start": "1284760",
    "end": "1291279"
  },
  {
    "text": "from the other systems so last year in November",
    "start": "1291279",
    "end": "1297480"
  },
  {
    "text": "Microsoft released an out ofand patch for keros because the domain controllers weren't proper properly validating the",
    "start": "1297480",
    "end": "1303400"
  },
  {
    "text": "pack pack is the privilege attribute certificate which stores the group membership information within the keros",
    "start": "1303400",
    "end": "1308840"
  },
  {
    "text": "ticket kind of important so Gavin Miller of tenable",
    "start": "1308840",
    "end": "1314279"
  },
  {
    "text": "tweeted about this what I thought was the best example of how this works and I've been explaining this to Executives",
    "start": "1314279",
    "end": "1319559"
  },
  {
    "text": "using this exact analogy you have a boarding pass you get on the plane but before you get on the plane you take a",
    "start": "1319559",
    "end": "1325520"
  },
  {
    "text": "sharpie and right pilot you hand it to the flight attendant and as you get on the plane you're escorted into the",
    "start": "1325520",
    "end": "1331000"
  },
  {
    "text": "cockpit and then you're asked if you want coffee before you take off Captain",
    "start": "1331000",
    "end": "1336120"
  },
  {
    "text": "so this enables the rewriting of a ticket effectively from domain user to domain admin in about 5 minutes pikek",
    "start": "1336120",
    "end": "1343840"
  },
  {
    "text": "came out 2 weeks after the the patch was released python on script in order to",
    "start": "1343840",
    "end": "1350080"
  },
  {
    "text": "exploit this vulnerability the way it works is it requests a TGT with no pack once it gets",
    "start": "1350080",
    "end": "1356880"
  },
  {
    "text": "that it creates a forge pack signed with the user's password data then it's sent",
    "start": "1356880",
    "end": "1362760"
  },
  {
    "text": "back uh that that TGT uh and that Forge pack is sent as an authenticator the DC looks at it and",
    "start": "1362760",
    "end": "1369360"
  },
  {
    "text": "goes oh okay so you're requesting a service ticket with no pack and you have a TGT with no pack but you have an authenticator you know what I'm just",
    "start": "1369360",
    "end": "1375200"
  },
  {
    "text": "going to take this authenticator put it into a new TGT that that's the pack there you go golden ticket",
    "start": "1375200",
    "end": "1382080"
  },
  {
    "text": "accomplished Benjamin delpi updated this earlier this year and as part of his Kio Suite where it actually scans for",
    "start": "1382080",
    "end": "1388400"
  },
  {
    "text": "vulnerable DCS once it finds it it exploits it and then it does one more thing at the end",
    "start": "1388400",
    "end": "1393640"
  },
  {
    "text": "where it actually request a delegation ticket so now that exploit ticket works",
    "start": "1393640",
    "end": "1399039"
  },
  {
    "text": "against any DC not just unpatched ones so yeah use her ad use her to admin",
    "start": "1399039",
    "end": "1404240"
  },
  {
    "text": "in five minutes so the response to this is going to be simple make sure that your server images your server builds",
    "start": "1404240",
    "end": "1411159"
  },
  {
    "text": "are patched with this patch that way when you're standing up a new DC you can be fairly certain that the patch is",
    "start": "1411159",
    "end": "1417520"
  },
  {
    "text": "already there or preferably run this anyway before you run DC promo it should be",
    "start": "1417520",
    "end": "1423919"
  },
  {
    "text": "part of your steps your QA process because if you stand up a new DC that's not patched against this five minutes to",
    "start": "1423919",
    "end": "1431480"
  },
  {
    "text": "the main admins so a lot has been talked about with golden tickets I'm not going to add to that except to say that",
    "start": "1431480",
    "end": "1439200"
  },
  {
    "text": "this step in the curb Rose process is missing with G uh golden tickets and the attacker has to have",
    "start": "1439200",
    "end": "1445080"
  },
  {
    "text": "dumped the curb tdt account password hash in order to be able to create them now there was somewhat of a limitation",
    "start": "1445080",
    "end": "1451600"
  },
  {
    "text": "if you could call it that when golden tickets were released last year when you dump that curb tdt account password hash",
    "start": "1451600",
    "end": "1458440"
  },
  {
    "text": "that golden ticket only works within that domain uh where it was created and",
    "start": "1458440",
    "end": "1463480"
  },
  {
    "text": "so if there's other domains in the forest that golden ticket won't provide admin access to those well now I can",
    "start": "1463480",
    "end": "1470000"
  },
  {
    "text": "golden tickets are now more golden I did some security research on Sid history and it's used in",
    "start": "1470000",
    "end": "1477480"
  },
  {
    "text": "exploitation and I talked to Benjamin delpy he added City history to Golden tickets in a roundabout way I had asked",
    "start": "1477480",
    "end": "1483919"
  },
  {
    "text": "to add added to mimik cats and now golden ticket support Sid history what's Sid history it enables you to add",
    "start": "1483919",
    "end": "1490120"
  },
  {
    "text": "another Sid from another domain that isn't associated with that user in this domain and it gets evaluated as part of",
    "start": "1490120",
    "end": "1499960"
  },
  {
    "text": "whether or not that user should have access or determining access for resources so as you can see on the",
    "start": "1499960",
    "end": "1505640"
  },
  {
    "text": "bottom this golden ticket Works across every domain in that environment so silver tickets kind of",
    "start": "1505640",
    "end": "1513240"
  },
  {
    "text": "overshadow shadowed by the Big Brother golden ticket right what's interesting about a silver ticket is if the attacker",
    "start": "1513240",
    "end": "1519159"
  },
  {
    "text": "gets the password data for a service running on that server can generate a gold uh silver",
    "start": "1519159",
    "end": "1525039"
  },
  {
    "text": "ticket or that Forge service ticket for that service there's no communication with the domain",
    "start": "1525039",
    "end": "1530399"
  },
  {
    "text": "controller so if you're only pulling security Events off your DCS you're going to miss this and there is a",
    "start": "1530399",
    "end": "1535720"
  },
  {
    "text": "scenario where silver tickets can be more dangerous than golden tickets so in a breach recovery scenario",
    "start": "1535720",
    "end": "1542960"
  },
  {
    "text": "where an attacker has dumped everything and then the corporate it goes through the very painful process of",
    "start": "1542960",
    "end": "1549120"
  },
  {
    "text": "changing all the account passwords the item that gets missed is changing the computer account passwords",
    "start": "1549120",
    "end": "1554720"
  },
  {
    "text": "because every computer has an account password inacted directory that ties That physical computer to",
    "start": "1554720",
    "end": "1561840"
  },
  {
    "text": "ad and that computer account password is what's used to encrypt that service",
    "start": "1561840",
    "end": "1567720"
  },
  {
    "text": "ticket for that service on that Windows server or system so if we have the",
    "start": "1567720",
    "end": "1573440"
  },
  {
    "text": "computer account pass which for the domain controllers we can create a silver ticket for the sift service on that",
    "start": "1573440",
    "end": "1579880"
  },
  {
    "text": "domain controller which says we're a domain admin connect to the C doll share or",
    "start": "1579880",
    "end": "1587039"
  },
  {
    "text": "whichever we want copy up our exploit script create another silver ticket for",
    "start": "1587039",
    "end": "1592799"
  },
  {
    "text": "the host service which is a catchall service of a bunch of different window services that run on that system and",
    "start": "1592799",
    "end": "1600039"
  },
  {
    "text": "then we can create a schedule task we can replace an existing schedule",
    "start": "1600039",
    "end": "1605919"
  },
  {
    "text": "task or we can create a new one we'll call it something innocuous like scom agent health",
    "start": "1605919",
    "end": "1611760"
  },
  {
    "text": "check then what happens well re exploit the domain and this is a file on that",
    "start": "1611760",
    "end": "1618640"
  },
  {
    "text": "computer's C drive or wherever so we can access it there's another type of ticket",
    "start": "1618640",
    "end": "1624279"
  },
  {
    "text": "or Forge ticket so we've talked about within active directory between active directory forests or domains we have",
    "start": "1624279",
    "end": "1631320"
  },
  {
    "text": "trust blue domain admin creates a trust using a p trust password they send it over usually via email to the green",
    "start": "1631320",
    "end": "1637399"
  },
  {
    "text": "domain admin who types in the same one well that trust password doesn't change for 30 days so if attacker saw that",
    "start": "1637399",
    "end": "1644360"
  },
  {
    "text": "email or overheard them talking about it and knew what that pass was the attacker",
    "start": "1644360",
    "end": "1649799"
  },
  {
    "text": "could create their own trust ticket which is that cross Forest basically a",
    "start": "1649799",
    "end": "1655799"
  },
  {
    "text": "TGT which says who they are so that attacker can say I am this user a member of these groups in the blue domain and",
    "start": "1655799",
    "end": "1662760"
  },
  {
    "text": "just pass that ticket that trust ticket that Forge trust ticket over to the green domain and get access to any",
    "start": "1662760",
    "end": "1668399"
  },
  {
    "text": "resources in the green domain that were permission to resources from the blue domain now if this happens in an act",
    "start": "1668399",
    "end": "1676200"
  },
  {
    "text": "directory Forest well they just pass a trust ticket that says they're an Enterprise admin and then they fully compromise the",
    "start": "1676200",
    "end": "1682760"
  },
  {
    "text": "green domain so detection is difficult mitigation protect ad admins",
    "start": "1682760",
    "end": "1690320"
  },
  {
    "text": "I'll get into that a little bit more earlier this year I identified some key indicators on how to detect forg tickets",
    "start": "1690320",
    "end": "1696760"
  },
  {
    "text": "specifically golden and silver tickets in April late April of this year",
    "start": "1696760",
    "end": "1702360"
  },
  {
    "text": "Benjamin delpy updated mimic cats so that string at the end is what shows up in that domain field now identify",
    "start": "1702360",
    "end": "1708360"
  },
  {
    "text": "anomalies in the domain field that still may work but I suspect the attackers",
    "start": "1708360",
    "end": "1713640"
  },
  {
    "text": "have gotten better those are the events at the bottom so I know defense often feels",
    "start": "1713640",
    "end": "1719760"
  },
  {
    "text": "like 300 versus 300,000 but there is some are some ways",
    "start": "1719760",
    "end": "1727039"
  },
  {
    "text": "to help protect your environment when we're talking about Powershell attacks and how to detect them it starts with",
    "start": "1727039",
    "end": "1732880"
  },
  {
    "text": "logging Powershell version three and newer supports something called module logging which you can enable via Group",
    "start": "1732880",
    "end": "1739279"
  },
  {
    "text": "Policy so that way any command that's executed in Powershell is logged to the Powershell event log you can pull that",
    "start": "1739279",
    "end": "1746080"
  },
  {
    "text": "back into your sim tool you definitely want to look for some of these activities because they",
    "start": "1746080",
    "end": "1751320"
  },
  {
    "text": "are very",
    "start": "1751320",
    "end": "1753960"
  },
  {
    "text": "interesting attackers will use the net web client in order to pull down code or",
    "start": "1756840",
    "end": "1764440"
  },
  {
    "text": "files use invoke expression to execute those use encoded command in order to",
    "start": "1764440",
    "end": "1770039"
  },
  {
    "text": "ensure that it's OB fiscated it's difficult to see it's base 64 encoded and then there's a couple other",
    "start": "1770039",
    "end": "1775679"
  },
  {
    "text": "things that are interesting but I like to focus on Powershell remoting so you can enable Powershell remoting on",
    "start": "1775679",
    "end": "1781120"
  },
  {
    "text": "systems that support it again is every modern OS and it leverages",
    "start": "1781120",
    "end": "1788519"
  },
  {
    "text": "winrm you want to disable Powershell remoting on any system that doesn't need it because by default it's not enabled",
    "start": "1788519",
    "end": "1794399"
  },
  {
    "text": "except when you get to 2012 R2 but but you can limit it you can limit The Listener that that winrm you",
    "start": "1794399",
    "end": "1802360"
  },
  {
    "text": "can limit the scope of that listener that winrm has limit it to your admin",
    "start": "1802360",
    "end": "1809039"
  },
  {
    "text": "subnets and when you limit it you control who has access to it because as we've seen if someone can grab",
    "start": "1809240",
    "end": "1815320"
  },
  {
    "text": "credentials for an admin they can connect in and and do some interesting things with it the other part is auditing and metering Powershell usage",
    "start": "1815320",
    "end": "1822440"
  },
  {
    "text": "you can audit Powershell using uh you can audit Powershell using either",
    "start": "1822440",
    "end": "1828720"
  },
  {
    "text": "secm or you can use app Locker app Locker in audit mode uh secm gives you",
    "start": "1828720",
    "end": "1834080"
  },
  {
    "text": "some really interesting software metering capability with Powershell so you can do some Trend analysis on who's actually using it in your environment",
    "start": "1834080",
    "end": "1840080"
  },
  {
    "text": "you can use other software metering tools I'm just picking on the Microsoft folks so once you see this trend",
    "start": "1840080",
    "end": "1846880"
  },
  {
    "text": "analysis you can see that a user has run Powershell on 10 different computers in the past two hours maybe that's a",
    "start": "1846880",
    "end": "1853919"
  },
  {
    "text": "problem in Powershell version 5 things get a little bit better",
    "start": "1853919",
    "end": "1859159"
  },
  {
    "text": "you have script block logging which looks like this those OB",
    "start": "1859159",
    "end": "1865360"
  },
  {
    "text": "fiscated commands that I mentioned earlier are dehisced",
    "start": "1865360",
    "end": "1870880"
  },
  {
    "text": "decrypted before Powershell runs them so Powell will take that data and send it",
    "start": "1870880",
    "end": "1877559"
  },
  {
    "text": "to the event log and so now we can have some really interesting Sim alerts when it comes to Powershell attacks or",
    "start": "1877559",
    "end": "1883840"
  },
  {
    "text": "interesting Powershell code that was run we also get system wide transcripts",
    "start": "1883840",
    "end": "1889159"
  },
  {
    "text": "which means that we can enable this via Group Policy we can have a share on the network and have these system transcripts get sent automatically to",
    "start": "1889159",
    "end": "1895919"
  },
  {
    "text": "that share where they can't be modified or delet it later and have our Sim tool like Splunk",
    "start": "1895919",
    "end": "1901080"
  },
  {
    "text": "or something else ingest that those logs those transcript files and get some really interesting information about who",
    "start": "1901080",
    "end": "1907080"
  },
  {
    "text": "who's doing what as a step above the event",
    "start": "1907080",
    "end": "1911840"
  },
  {
    "text": "logging constrained Powershell is Powershell in constrain language mode",
    "start": "1913039",
    "end": "1918919"
  },
  {
    "text": "which is the core of Powershell so Powershell enables all this Advanced functionality all this",
    "start": "1918919",
    "end": "1926240"
  },
  {
    "text": "power it has the ability to leverage net functions do wmi things a bunch of other",
    "start": "1926240",
    "end": "1932159"
  },
  {
    "text": "things but the important note of this is that if we have Powershell V5 in our",
    "start": "1932159",
    "end": "1937600"
  },
  {
    "text": "environment which has been backported or fully supported in Windows 7 2008 R2 at",
    "start": "1937600",
    "end": "1942840"
  },
  {
    "text": "some point we can enable app Locker in allow mode which automatically sets Powershell",
    "start": "1942840",
    "end": "1949480"
  },
  {
    "text": "to constrain mode with Powershell V5 so this means that these Advanced attacks don't work like they usually do because",
    "start": "1949480",
    "end": "1957039"
  },
  {
    "text": "they Leverage The more advanced functionality of powers show Windows 10 the story gets better I",
    "start": "1957039",
    "end": "1963200"
  },
  {
    "text": "know it's going to be a little while before everyone gets there but there's the anti-malware scan interface in Windows 10 so before Powershell executes",
    "start": "1963200",
    "end": "1971080"
  },
  {
    "text": "code be it pulled down from a website typed in manually in the Powershell ISC select",
    "start": "1971080",
    "end": "1977960"
  },
  {
    "text": "did and hit run or run from a script Powershell is going to kick that over to the amsi and wait for it to come back",
    "start": "1977960",
    "end": "1985360"
  },
  {
    "text": "with a status okay if it doesn't get that Powershell is not executing code in Windows",
    "start": "1985360",
    "end": "1991480"
  },
  {
    "text": "10 so that malware scan interface is or that malware solution or anti-malware Solution that's on that box is going to",
    "start": "1991480",
    "end": "1998080"
  },
  {
    "text": "be looking for code Snippets so-called signatures but it can also do URL reputation so that way if that code is",
    "start": "1998080",
    "end": "2004080"
  },
  {
    "text": "attempted to being executed from a server on the internet you can see that",
    "start": "2004080",
    "end": "2009760"
  },
  {
    "text": "so now I'm going to summarize the mitigation levels this is what I call low difficulty you should ensure that",
    "start": "2009960",
    "end": "2017039"
  },
  {
    "text": "there are no user accounts in your environment that are member of admin groups it's obvious we've known this I",
    "start": "2017039",
    "end": "2022480"
  },
  {
    "text": "keep finding environments where this is the case why because a group nesting we Nest this group and this this group this",
    "start": "2022480",
    "end": "2028080"
  },
  {
    "text": "group this group and then people forget what the groups do we want to set that group policy to",
    "start": "2028080",
    "end": "2034399"
  },
  {
    "text": "ensure that even if a local admin account is compromised and we still have passwords that are the same across",
    "start": "2034399",
    "end": "2039440"
  },
  {
    "text": "multiple systems that the attacker can't jump from one to the",
    "start": "2039440",
    "end": "2044278"
  },
  {
    "text": "other so we also want to ensure that we",
    "start": "2046000",
    "end": "2051440"
  },
  {
    "text": "protect our service counts by using long complex passwords and pushing back on",
    "start": "2051440",
    "end": "2057000"
  },
  {
    "text": "our vendors to say that we don't need elevated rights last year there were a couple",
    "start": "2057000",
    "end": "2063480"
  },
  {
    "text": "patches that were released that improved RDP so historically RDP you would connect in you would type in",
    "start": "2063480",
    "end": "2069720"
  },
  {
    "text": "your explicit credentials into that RDP box they'd be sent over to that server that you're connecting to and they' be",
    "start": "2069720",
    "end": "2075800"
  },
  {
    "text": "placed in Elsa so they'd be in memory there which could be stolen restricted admin mode doesn't Place those",
    "start": "2075800",
    "end": "2082240"
  },
  {
    "text": "credentials on that box it converts your interactive log on into effectively a network connection",
    "start": "2082240",
    "end": "2088960"
  },
  {
    "text": "and so they're not there waiting for someone so we move on to level two it's important today to ensure that",
    "start": "2088960",
    "end": "2096679"
  },
  {
    "text": "you use a tool to automatically rotate and randomize and have unique local",
    "start": "2096679",
    "end": "2102440"
  },
  {
    "text": "administrator account passwords on every computer in your environment because again it's too easy for attackers to leverage that information to jump",
    "start": "2102440",
    "end": "2109040"
  },
  {
    "text": "around it doesn't matter what tool it is but Microsoft laps is available and it works better than what we've had it's",
    "start": "2109040",
    "end": "2117200"
  },
  {
    "text": "free the other thing to note is that even if you",
    "start": "2117200",
    "end": "2122359"
  },
  {
    "text": "have your administrators isolated you've randomized that if users on one",
    "start": "2122359",
    "end": "2127720"
  },
  {
    "text": "workstation can or a user on one workstation connect to workstations all over your environment you may be in a situation",
    "start": "2127720",
    "end": "2135839"
  },
  {
    "text": "where that those credentials that are on those workstations can be compromised especially if they have the local admin",
    "start": "2135839",
    "end": "2141920"
  },
  {
    "text": "account password but it enables the attacker to move around your environment in ways that you may not be aware of and",
    "start": "2141920",
    "end": "2147480"
  },
  {
    "text": "on Sunday there's going to be a tool release called pivoter which enables attackers to jump around like that using",
    "start": "2147480",
    "end": "2153359"
  },
  {
    "text": "user credentials so you definitely want to look at how to limit and restrict communication when it comes to",
    "start": "2153359",
    "end": "2159280"
  },
  {
    "text": "workstations in your environment we've had a flat Network for too long and part of that includes looking",
    "start": "2159280",
    "end": "2165800"
  },
  {
    "text": "at the server side as well and having some Network isolation so that way when",
    "start": "2165800",
    "end": "2171160"
  },
  {
    "text": "you have your backend Financial database or HR database or your badge system that those",
    "start": "2171160",
    "end": "2178880"
  },
  {
    "text": "aren't available for anyone on on your network to connect to them so separating your admins from your",
    "start": "2178880",
    "end": "2186119"
  },
  {
    "text": "users is very important making sure that you limit where your domain admins or your act directory admins actually log",
    "start": "2186119",
    "end": "2192160"
  },
  {
    "text": "on what they're able to do which brings us to what I call the it's complicated phase of",
    "start": "2192160",
    "end": "2199680"
  },
  {
    "text": "mitigation this is difficult but this is where we need to get to we need to make sure that our domain",
    "start": "2199680",
    "end": "2206960"
  },
  {
    "text": "admins group is now empty I know that's tough the problem is that domain admins has been around since",
    "start": "2206960",
    "end": "2214720"
  },
  {
    "text": "NT domain admins use Mage for managing an Enterprise is 1990s mentality and we",
    "start": "2214720",
    "end": "2221520"
  },
  {
    "text": "need to get away from it we need to identify what the roles are in our organizations figure out who needs what",
    "start": "2221520",
    "end": "2228599"
  },
  {
    "text": "access who needs to do what because I've been in organizations where the exchange admins are domain admins that's way too",
    "start": "2228599",
    "end": "2235680"
  },
  {
    "text": "powerful domain admins have full admin rights to active directory domain controllers all",
    "start": "2235680",
    "end": "2242880"
  },
  {
    "text": "workstations all servers everything it's way too easy for an",
    "start": "2242880",
    "end": "2248440"
  },
  {
    "text": "attacker to compromise One account and compromise an entire domain or",
    "start": "2248440",
    "end": "2253560"
  },
  {
    "text": "Forest so we need to make sure that our active directory admins because we're not calling them domain admins",
    "start": "2253560",
    "end": "2258880"
  },
  {
    "text": "anymore only can authenticate or log on to certain workstations admin workstations that are protected at a",
    "start": "2258880",
    "end": "2264160"
  },
  {
    "text": "higher level than what your standard users are going to be on We want to make sure that these domain admins or active",
    "start": "2264160",
    "end": "2270319"
  },
  {
    "text": "directory admins Only log on to domain controllers or special servers like admin servers special workstations we",
    "start": "2270319",
    "end": "2277000"
  },
  {
    "text": "also want loc at our server admins to make sure they're following something similar because if a credential is",
    "start": "2277000",
    "end": "2283280"
  },
  {
    "text": "stolen for a server admin but our domain admins or yeah we're still having domain",
    "start": "2283280",
    "end": "2288400"
  },
  {
    "text": "admins out there are logging in then the problem is that they have access to those credentials as",
    "start": "2288400",
    "end": "2295079"
  },
  {
    "text": "well so in Windows 10 there's some new architecture to prevent against",
    "start": "2299720",
    "end": "2305880"
  },
  {
    "text": "credential theft um this slide is actually out of date now as of this morning I went to the Microsoft briefing",
    "start": "2305880",
    "end": "2312000"
  },
  {
    "text": "and saw that all the stuff that I had based this slide on pretty much has changed from May which is when I put this together so but the architecture is",
    "start": "2312000",
    "end": "2319400"
  },
  {
    "text": "effectively the same what was your traditional Windows OS is now the high level OS and a blue box and there's a",
    "start": "2319400",
    "end": "2327560"
  },
  {
    "text": "new green box these both run on a hypervisor by default well not exactly by",
    "start": "2327560",
    "end": "2334040"
  },
  {
    "text": "default information uh is is coming out from Microsoft soon but the important",
    "start": "2334040",
    "end": "2340000"
  },
  {
    "text": "thing to note here is that Elsas is not going to store those credential Secrets anymore they're going to be over in the green box referred to as theum or",
    "start": "2340000",
    "end": "2348400"
  },
  {
    "text": "vssm I heard recently that we have secure secure World versus normal world",
    "start": "2348400",
    "end": "2353720"
  },
  {
    "text": "there's some new terms like cred guard to protect the credentials but the important thing to take away from this slide is",
    "start": "2353720",
    "end": "2359800"
  },
  {
    "text": "that the secrets that have been historically stolen and taken and reused",
    "start": "2359800",
    "end": "2365920"
  },
  {
    "text": "in past credential scenario are not in Elsas anymore are not in the traditional OS which means that",
    "start": "2365920",
    "end": "2374680"
  },
  {
    "text": "even if the kernel is compromised in that blue box those credentials are not available for the attacker to",
    "start": "2374680",
    "end": "2383040"
  },
  {
    "text": "reuse so with more sophisticated attacks we need better detection to this end",
    "start": "2383640",
    "end": "2389880"
  },
  {
    "text": "Microsoft bought a company called aado last year they've Incorporated the product and Technology into a new",
    "start": "2389880",
    "end": "2396960"
  },
  {
    "text": "product that Microsoft has releasing this month called Microsoft Advanced thread",
    "start": "2396960",
    "end": "2402520"
  },
  {
    "text": "analytics I don't work for Microsoft but I'm excited about this because this is where we need to go this will provide",
    "start": "2402520",
    "end": "2407640"
  },
  {
    "text": "some useful visibility in our Enterprises now if you work for a very large Enterprise and you have an uh",
    "start": "2407640",
    "end": "2414720"
  },
  {
    "text": "Enterprise client license or a cow and you have software Assurance this may be included in that so you want to ask your",
    "start": "2414720",
    "end": "2421000"
  },
  {
    "text": "Microsoft rep but effectively it works very differently than how Microsoft has traditionally focused on security and",
    "start": "2421000",
    "end": "2426920"
  },
  {
    "text": "looking at at events ATA works with an ATA sensor called the gateway that Taps into a",
    "start": "2426920",
    "end": "2433440"
  },
  {
    "text": "network switch or switches that fronts your domain controllers and it watches the authentication traffic between the",
    "start": "2433440",
    "end": "2439480"
  },
  {
    "text": "domain controllers and the clients it takes that interesting traffic and sends it over to the ATA Center which then",
    "start": "2439480",
    "end": "2445920"
  },
  {
    "text": "crunches those numbers and figures out that these users or this specific user",
    "start": "2445920",
    "end": "2453000"
  },
  {
    "text": "logs on to this this computer these computers and these resources and it builds a user Behavior profile",
    "start": "2453000",
    "end": "2459599"
  },
  {
    "text": "for every individual user in the environment but it does this without looking at or parsing any event logs and",
    "start": "2459599",
    "end": "2465440"
  },
  {
    "text": "it does it without installing a client application",
    "start": "2465440",
    "end": "2471240"
  },
  {
    "text": "or code on all your systems because it's looking at the authentication traffic so that means that it can also",
    "start": "2471240",
    "end": "2477640"
  },
  {
    "text": "detect Recon activities and the attacks that are very difficult to detect when you're just looking at event",
    "start": "2477640",
    "end": "2483880"
  },
  {
    "text": "locks and the detection at the bottom those are very difficult to detect in event event logs so let's see what this",
    "start": "2483880",
    "end": "2490119"
  },
  {
    "text": "looks like this is the base console so you see identity theft based",
    "start": "2490119",
    "end": "2496880"
  },
  {
    "text": "on abnormal behavior this user who's typically logged on to a couple different computers is logged on to",
    "start": "2496880",
    "end": "2502240"
  },
  {
    "text": "several more than that has attempted to access or has requested access to a number of resources that have never been",
    "start": "2502240",
    "end": "2508040"
  },
  {
    "text": "seen before this is your standard behavioral analysis ATA adds to that and",
    "start": "2508040",
    "end": "2513680"
  },
  {
    "text": "looks at deterministic components as well kind of the essence of what an attack looks like what's known bad and",
    "start": "2513680",
    "end": "2520599"
  },
  {
    "text": "so if you dig into this you can see the additional information about what is behind this this flag this alert ATA",
    "start": "2520599",
    "end": "2527040"
  },
  {
    "text": "will only flag on the bad things the known bad things so I'm very excited about",
    "start": "2527040",
    "end": "2532160"
  },
  {
    "text": "this credential theft pass the hash how do we detect pass the hash now event logs right maybe we identify some",
    "start": "2532160",
    "end": "2539359"
  },
  {
    "text": "suspicious activity over here what about pass the ticket oo that's tough not really sure how exactly",
    "start": "2539359",
    "end": "2546640"
  },
  {
    "text": "we'd find that event logs other than doing some correlation that this user logged on here and now they're over here overpass the hash which I mentioned",
    "start": "2546640",
    "end": "2553880"
  },
  {
    "text": "earlier taking that inlm password hash and converting it into cerus tickets that's really",
    "start": "2553880",
    "end": "2560319"
  },
  {
    "text": "tough and the ms1 14068 exploit that Forge pack atac's that as",
    "start": "2560319",
    "end": "2566880"
  },
  {
    "text": "well in addition to the golden",
    "start": "2566880",
    "end": "2570799"
  },
  {
    "text": "ticket and skeleton key so skeleton key was announced",
    "start": "2572720",
    "end": "2578920"
  },
  {
    "text": "earlier this year by Dell secure works it was in memory malware that was discovered on a domain controller a",
    "start": "2578920",
    "end": "2584960"
  },
  {
    "text": "domain controllers in an organization where it was patching elsass what was really interesting about this is it patched elsass in a way that there was a",
    "start": "2584960",
    "end": "2592000"
  },
  {
    "text": "master password for every user in the Enterprise so everyone here is in an",
    "start": "2592000",
    "end": "2597240"
  },
  {
    "text": "Enterprise if I patch that DC with skeleton key and I had no the master password I can log in as any of you and",
    "start": "2597240",
    "end": "2604079"
  },
  {
    "text": "you still continue logging in like normal because your password still works we can detect that so I have a few",
    "start": "2604079",
    "end": "2611520"
  },
  {
    "text": "additional mitigations which are more General some of these are obvious but blocking internet access to systems that",
    "start": "2611520",
    "end": "2618280"
  },
  {
    "text": "don't require it seems pretty obvious ensuring the computer account passwords get change when there's a breach",
    "start": "2618280",
    "end": "2625079"
  },
  {
    "text": "recovery scenario changing the curb TGT account",
    "start": "2625079",
    "end": "2631000"
  },
  {
    "text": "password on a regular basis and especially when a an active directory admin leaves",
    "start": "2631000",
    "end": "2637400"
  },
  {
    "text": "or if you suspect that a backup was compromised the curb TGT account as",
    "start": "2637400",
    "end": "2643119"
  },
  {
    "text": "mentioned before with with golden tickets stores two passwords the current and the previous one so that means that",
    "start": "2643119",
    "end": "2648359"
  },
  {
    "text": "a backup from four years ago could still have a valid curb TGT account password",
    "start": "2648359",
    "end": "2654359"
  },
  {
    "text": "in it and you want to model your defenses against what the real threats are what",
    "start": "2654359",
    "end": "2661280"
  },
  {
    "text": "adversaries are actually doing out in the world so in summary",
    "start": "2661280",
    "end": "2668040"
  },
  {
    "text": "at some point there will be bad code running on a system in your network what happens what they're able",
    "start": "2668040",
    "end": "2674720"
  },
  {
    "text": "to do how they're able to escalate how they're able to move around what data they're able to access is entirely",
    "start": "2674720",
    "end": "2681040"
  },
  {
    "text": "dependent on your defensive posture how well you've implemented the mitigations how well you have identified",
    "start": "2681040",
    "end": "2686920"
  },
  {
    "text": "we're going to protect these credentials because they're important but it is possible to secure your",
    "start": "2686920",
    "end": "2694078"
  },
  {
    "text": "environment that's been my time thank you so much for your [Applause]",
    "start": "2694400",
    "end": "2701920"
  },
  {
    "text": "No Maybe So I just want to point out these are great resources here on the left please follow them um on Twitter",
    "start": "2711599",
    "end": "2720000"
  },
  {
    "text": "great resources very helpful and I have time for questions as well please submit",
    "start": "2720000",
    "end": "2725920"
  },
  {
    "text": "an evaluation okay",
    "start": "2725920",
    "end": "2731319"
  },
  {
    "text": "questions right",
    "start": "2731319",
    "end": "2734520"
  },
  {
    "text": "here okay so the question is in the newer versions of Microsoft uh windows",
    "start": "2744040",
    "end": "2749400"
  },
  {
    "text": "and Windows Server there are mitigating uh security enhancements that mitigate",
    "start": "2749400",
    "end": "2756160"
  },
  {
    "text": "or or Implement some of these things I've talked about I haven't mapped those out but certainly running newer os's is",
    "start": "2756160",
    "end": "2762240"
  },
  {
    "text": "generally better than older ones which is why getting XP in 2003 is highly recommended to uh in the environment um",
    "start": "2762240",
    "end": "2768960"
  },
  {
    "text": "but yeah I'd be interested thanks for the suggestion I think I might look at that any other questions right over here",
    "start": "2768960",
    "end": "2776720"
  },
  {
    "text": "filteration the trust Sid filtering for the trust exploit that is a good question so Sid",
    "start": "2776720",
    "end": "2784800"
  },
  {
    "text": "filtering will will uh mitigate against",
    "start": "2784800",
    "end": "2789839"
  },
  {
    "text": "Sid history on that trust ticket if it's being used but if it's not it won't",
    "start": "2789839",
    "end": "2795240"
  },
  {
    "text": "filter it out because it it's looking at the Sid history attribute and in an act directory domain when you have or act",
    "start": "2795240",
    "end": "2801319"
  },
  {
    "text": "directory Forest when you have multiple domains uh you're not going to have Sid filtering between those so unfortunately",
    "start": "2801319",
    "end": "2807559"
  },
  {
    "text": "that that's not going to help but I highly recommend you use Sid filtering on external trusts and also look at uh",
    "start": "2807559",
    "end": "2814040"
  },
  {
    "text": "selective authentication because that helps as well questions yes have you dealt with the",
    "start": "2814040",
    "end": "2821440"
  },
  {
    "text": "domain backup key yet that's stored on the DC as a secret the domain backup key have I dealt with it yet uh no honestly",
    "start": "2821440",
    "end": "2828160"
  },
  {
    "text": "I haven't delved into that yet um it's actually protected by the store as a",
    "start": "2828160",
    "end": "2833520"
  },
  {
    "text": "special secret in the ab and once you have it it uh all the users U decryption",
    "start": "2833520",
    "end": "2843119"
  },
  {
    "text": "keys are being esro with that particular that's right public private key right so",
    "start": "2843119",
    "end": "2850480"
  },
  {
    "text": "basically the the conversation is surrounding the fact that whenever users are encrypting data on their system using deppy there's a effectively a",
    "start": "2850480",
    "end": "2858680"
  },
  {
    "text": "recovery key or escrow key that's stored in active directory that's protected by the domain Master uh backup key that",
    "start": "2858680",
    "end": "2865839"
  },
  {
    "text": "this gentleman is referring to and once you have access to that you can decrypt all the users data is a very good point",
    "start": "2865839",
    "end": "2871280"
  },
  {
    "text": "I I haven't looked in that just yet because I've been uh busy with with this stuff but that's on my list yeah the ad",
    "start": "2871280",
    "end": "2877599"
  },
  {
    "text": "doesn't release it because it's one of its intrinsic secrets and on the",
    "start": "2877599",
    "end": "2883280"
  },
  {
    "text": "nsit actually protected with theis key yeah it is you're right it is protected with the CIS key I didn't cover that due",
    "start": "2883280",
    "end": "2889440"
  },
  {
    "text": "to time uh so you you get the NDS that dat you get the CIS key or or that um that other file it's stored in registry",
    "start": "2889440",
    "end": "2896720"
  },
  {
    "text": "you grab those then yes you can decrypt the uh the NS that did so what way to also AR it is if you have key mechanism",
    "start": "2896720",
    "end": "2905200"
  },
  {
    "text": "on your on your that cannot be easily SL absolutely so if you have an additional",
    "start": "2905200",
    "end": "2911440"
  },
  {
    "text": "uh sis key method such as USB drive floppy Drive was historically what was used to ensure that the DC wouldn't",
    "start": "2911440",
    "end": "2918200"
  },
  {
    "text": "decrypt its data without that additional method method mechanism absolutely I have two and a half more",
    "start": "2918200",
    "end": "2924599"
  },
  {
    "text": "minutes for questions any other",
    "start": "2924599",
    "end": "2930400"
  },
  {
    "text": "questions if there are no other questions um G packing is in here at 3:00 so you may want to hold your seat",
    "start": "2931000",
    "end": "2937559"
  },
  {
    "text": "thank you very much I appreciate your time",
    "start": "2937559",
    "end": "2941040"
  }
]