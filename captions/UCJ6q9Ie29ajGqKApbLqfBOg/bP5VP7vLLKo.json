[
  {
    "start": "0",
    "end": "54000"
  },
  {
    "text": "uh so uh I'm Marco and uh this talk is about uh iOS Wi-Fi and uh some sunbox",
    "start": "320",
    "end": "7960"
  },
  {
    "text": "topic so a little bit about me uh very briefly uh my name is Marco grai and uh",
    "start": "7960",
    "end": "15200"
  },
  {
    "text": "I'm a member of uh King security lab of tensent and uh previously we were known",
    "start": "15200",
    "end": "21199"
  },
  {
    "text": "as kin team and uh my main focus is uh iOS uh Android uh Mac OS and uh in",
    "start": "21199",
    "end": "28800"
  },
  {
    "text": "particular sandbox and uh also recently I'm doing a little bit of",
    "start": "28800",
    "end": "34840"
  },
  {
    "text": "virtualization uh in the last uh two years uh I've been member of some uh P",
    "start": "34840",
    "end": "41680"
  },
  {
    "text": "one teams uh for Macos iOS and VMware and uh if you want to uh follow me on",
    "start": "41680",
    "end": "48960"
  },
  {
    "text": "Twitter or say in touch my Twitter handle is Marco",
    "start": "48960",
    "end": "54120"
  },
  {
    "start": "54000",
    "end": "54000"
  },
  {
    "text": "grass uh so um what about uh 10cent key security lab uh uh we were previously",
    "start": "54440",
    "end": "61039"
  },
  {
    "text": "known as Skin team and we are a white hat security researcher and uh we usually compete in pone and uh we are",
    "start": "61039",
    "end": "69080"
  },
  {
    "text": "based in shangai China and uh our blog English blog is at that link and our",
    "start": "69080",
    "end": "75880"
  },
  {
    "text": "Twitter is is that one and uh if someone is interested in joining uh please ping",
    "start": "75880",
    "end": "83960"
  },
  {
    "text": "me so high level agenda uh quite traditional let's say uh some",
    "start": "84240",
    "end": "90759"
  },
  {
    "text": "introduction and then we will check some bugs and some more technical topics and",
    "start": "90759",
    "end": "96000"
  },
  {
    "text": "then make some conclusions so uh some introduction uh",
    "start": "96000",
    "end": "103840"
  },
  {
    "text": "on how this research uh was uh done and uh why so back in",
    "start": "103840",
    "end": "110560"
  },
  {
    "text": "2015 uh I joined kin laab and uh there was mobile pH to own so I started",
    "start": "110560",
    "end": "117079"
  },
  {
    "text": "looking to work on the iOS category and in 2014 uh for mobile Pon to own there was",
    "start": "117079",
    "end": "124600"
  },
  {
    "text": "the Wi-Fi category uh so for 2015 it uh",
    "start": "124600",
    "end": "129759"
  },
  {
    "text": "was natural that I started considering it and uh to evaluate alternative attack",
    "start": "129759",
    "end": "135599"
  },
  {
    "text": "surface compared to uh the regular uh Pawn like the malicious Link in the",
    "start": "135599",
    "end": "142080"
  },
  {
    "text": "browser uh at that time there was iOS 9 uh unfortunately the mobile Ponto in",
    "start": "142080",
    "end": "148160"
  },
  {
    "text": "2015 was cancel the official one and uh so I I just keep the bu uh hoping that",
    "start": "148160",
    "end": "155760"
  },
  {
    "text": "uh uh CDI will add uh the mobile targets to the desktop on one but they didn't do",
    "start": "155760",
    "end": "162120"
  },
  {
    "text": "it so after the desktop on one I just disclosed the bug since uh there was no",
    "start": "162120",
    "end": "167560"
  },
  {
    "text": "point in in keeping them longer and uh it turned out to be the right choice",
    "start": "167560",
    "end": "172879"
  },
  {
    "text": "because in uh mobile Pon to own 2016 there was no Wi-fi",
    "start": "172879",
    "end": "178760"
  },
  {
    "text": "category so the rules uh last year Chang and uh",
    "start": "178760",
    "end": "184000"
  },
  {
    "start": "180000",
    "end": "180000"
  },
  {
    "text": "in 2016 mobile PTU own the only allowed way to attack iOS device was through a",
    "start": "184000",
    "end": "190840"
  },
  {
    "text": "malicious URL that uh will be opening mobile Safari and uh last year it was",
    "start": "190840",
    "end": "198200"
  },
  {
    "text": "not possible to touch the Wi-Fi or Bluetooth or whatever uh and uh from this uh",
    "start": "198200",
    "end": "204080"
  },
  {
    "text": "malicious Ur URL you have either to steal some sensitive data or install an application",
    "start": "204080",
    "end": "211239"
  },
  {
    "text": "and uh uh that said because in 2014 and the previous year there were more Target",
    "start": "211239",
    "end": "216400"
  },
  {
    "text": "such as proximity Network or basement so uh some uh previous related",
    "start": "216400",
    "end": "224000"
  },
  {
    "text": "research on iOS and Wi-Fi uh it was targeted in uh 2015 by Mark do at raxon",
    "start": "224000",
    "end": "232879"
  },
  {
    "text": "and they made a great presentation on our drop as a Target and uh I really",
    "start": "232879",
    "end": "238480"
  },
  {
    "text": "suggest you to to check check his slide and research because it's very",
    "start": "238480",
    "end": "244319"
  },
  {
    "start": "244000",
    "end": "244000"
  },
  {
    "text": "interesting so what about Wi-Fi on iOS uh maybe you notice that there is",
    "start": "244400",
    "end": "251120"
  },
  {
    "text": "something called The Captive portal and uh for example when you are at Starbucks or at the hotel at Marina Bas sense when",
    "start": "251120",
    "end": "259199"
  },
  {
    "text": "you join a Wi-Fi what happen uh well a captive portal pop up is is bring uh to",
    "start": "259199",
    "end": "266280"
  },
  {
    "text": "the front of the user automatically without clicking anything and that seems a promising Target",
    "start": "266280",
    "end": "272199"
  },
  {
    "text": "because it's rendering HTML content and U I find it interesting that uh on iOS",
    "start": "272199",
    "end": "279440"
  },
  {
    "text": "this procedure is automatic when you join a Wi-Fi uh but on Android usually it's not uh except some customization or",
    "start": "279440",
    "end": "287280"
  },
  {
    "text": "something like that you have to click a notification to to sing in to the to the",
    "start": "287280",
    "end": "292880"
  },
  {
    "text": "Wi-Fi uh a little bit of curiosity it's funny because in the last wiek leaks uh",
    "start": "292880",
    "end": "299880"
  },
  {
    "text": "in the vault s Dums there was also some bit of information about the iOS captive",
    "start": "299880",
    "end": "305360"
  },
  {
    "text": "portal and I found that interesting so what about ctive portal",
    "start": "305360",
    "end": "312840"
  },
  {
    "start": "310000",
    "end": "310000"
  },
  {
    "text": "on iOS uh how does it works uh as a user experience you see a UI that pop up when",
    "start": "312840",
    "end": "320400"
  },
  {
    "text": "there is a captive portal system in the network and this UI is called websheet",
    "start": "320400",
    "end": "326199"
  },
  {
    "text": "DOA and web sheet. is uh uh system application and uh it",
    "start": "326199",
    "end": "332360"
  },
  {
    "text": "resides um in the application folder uh as you can see in the in the screenshot",
    "start": "332360",
    "end": "338600"
  },
  {
    "text": "and uh but how does it triggers so when you join a Wi-Fi",
    "start": "338600",
    "end": "345520"
  },
  {
    "text": "network your device will make a request to a predefined URL to see if it's",
    "start": "345520",
    "end": "351440"
  },
  {
    "text": "reachable and uh this URL is captive. apple.com hotspot detect. HTML",
    "start": "351440",
    "end": "360120"
  },
  {
    "text": "and uh uh actually also other device made similar procedure like Google query",
    "start": "360120",
    "end": "366599"
  },
  {
    "text": "their own server to see if they are reachable and uh if the server is reachable uh it will return to you",
    "start": "366599",
    "end": "373520"
  },
  {
    "text": "normally this HTML content like success title success body success and uh but if",
    "start": "373520",
    "end": "380479"
  },
  {
    "text": "something happen uh to the connection such as a red or a different HTML content is returned then web sheet will",
    "start": "380479",
    "end": "388680"
  },
  {
    "text": "be prompted to the user uh showing the HTML content or the redirect in order to",
    "start": "388680",
    "end": "394560"
  },
  {
    "text": "make the user log in into the Wi-Fi so uh very B bad drone schematics",
    "start": "394560",
    "end": "402599"
  },
  {
    "text": "uh it's about uh this is a regular Wi-Fi without any captive portal so your",
    "start": "402599",
    "end": "408120"
  },
  {
    "text": "device will ask captive. apple.com uh for Hotspot detect and uh if the Apple",
    "start": "408120",
    "end": "414720"
  },
  {
    "text": "server is reachable then it will return a HTML page with success in it it means",
    "start": "414720",
    "end": "420479"
  },
  {
    "text": "that the network is unlocked and your device is good to go there's no need to make you log into a captive",
    "start": "420479",
    "end": "428080"
  },
  {
    "text": "portal what happen with a captive portal Appliance uh well uh your device will",
    "start": "428080",
    "end": "434120"
  },
  {
    "text": "ask for hpot detect. comom on on captive. apple.com and uh the the",
    "start": "434120",
    "end": "440680"
  },
  {
    "text": "captive Portal Device will not uh make you reach the internet because you didn't log in so it will send you a",
    "start": "440680",
    "end": "446759"
  },
  {
    "text": "redirect or different HTML content and and uh this uh content or redirect will",
    "start": "446759",
    "end": "452199"
  },
  {
    "text": "be rendered in web sheet. AP and make you log",
    "start": "452199",
    "end": "457319"
  },
  {
    "text": "in so web sheet. AP use a web view internally and doesn't have the git uh",
    "start": "457319",
    "end": "464360"
  },
  {
    "text": "because it lacks of the entitlements and uh but still it's a it's a web kit so it",
    "start": "464360",
    "end": "470840"
  },
  {
    "text": "has bugs and can be used for initial uh code",
    "start": "470840",
    "end": "476639"
  },
  {
    "start": "476000",
    "end": "476000"
  },
  {
    "text": "execution so um that's that's roughly at the plan of attack first we want to",
    "start": "476639",
    "end": "482199"
  },
  {
    "text": "create a malicious Wi-Fi network uh create a fake captive Portal",
    "start": "482199",
    "end": "488159"
  },
  {
    "text": "Device uh in order to to to exploit this this behavior of of triggering the web",
    "start": "488159",
    "end": "493720"
  },
  {
    "text": "sheet application and uh we can we can serve a exploit with",
    "start": "493720",
    "end": "499199"
  },
  {
    "start": "499000",
    "end": "499000"
  },
  {
    "text": "it so how do keep how do you create a malicious Wi-Fi network well it turns",
    "start": "499199",
    "end": "506199"
  },
  {
    "text": "out to be uh pretty simple and uh uh your most easy way is probably to use a",
    "start": "506199",
    "end": "512360"
  },
  {
    "text": "Linux machine because there is lot of stuff already made uh Ubuntu is fine and",
    "start": "512360",
    "end": "518240"
  },
  {
    "text": "uh you just use a Wi-Fi dongle that can go into access point mode and uh just",
    "start": "518240",
    "end": "523839"
  },
  {
    "text": "pick a Wi-Fi dongle for word driving and they work fine then you need the DHCP",
    "start": "523839",
    "end": "530200"
  },
  {
    "text": "and some other network stuff like to make everything work correctly and then you need something to man in the middle",
    "start": "530200",
    "end": "536880"
  },
  {
    "text": "or redirect or have some control of of of the network in order to hijack this",
    "start": "536880",
    "end": "543160"
  },
  {
    "text": "this request and uh I use men in the middle because it's in Python and it's easy to script and",
    "start": "543160",
    "end": "551440"
  },
  {
    "text": "uh make return what you want so in this way we can uh serve",
    "start": "551440",
    "end": "557519"
  },
  {
    "text": "arbitrary content into web sheet so uh we will not discuss any web",
    "start": "557519",
    "end": "565560"
  },
  {
    "start": "562000",
    "end": "562000"
  },
  {
    "text": "kit back here because the presentation is not about the web kit but uh you can use uh a web kit bu I mean there are lot",
    "start": "565560",
    "end": "573480"
  },
  {
    "text": "of resources and lot of uh previous buxs",
    "start": "573480",
    "end": "578560"
  },
  {
    "text": "and uh if your device is vulnerable you can you can use them and uh for example",
    "start": "578560",
    "end": "584399"
  },
  {
    "text": "recently there was the the Pegasus web kit bug which is used also on other uh",
    "start": "584399",
    "end": "591120"
  },
  {
    "text": "application like uh console or and something like that and uh you can use that if your device is still",
    "start": "591120",
    "end": "597560"
  },
  {
    "text": "vulnerable uh or maybe another good resource it's uh previous pto1",
    "start": "597560",
    "end": "603920"
  },
  {
    "text": "competitions uh project zero issues and also the Frack paper by Sayo which is about the JavaScript",
    "start": "603920",
    "end": "612760"
  },
  {
    "text": "core so just redirect to or return the exploit to render it in web sheeet and",
    "start": "612760",
    "end": "618640"
  },
  {
    "text": "and get the code execution inside the web sheeet so but now where do we have code",
    "start": "618640",
    "end": "627760"
  },
  {
    "start": "622000",
    "end": "622000"
  },
  {
    "text": "execution well if you know iOS you know that like a very important pillar of iOS",
    "start": "627760",
    "end": "634920"
  },
  {
    "text": "security is the sandbox so uh the first thing you should do usually is to",
    "start": "634920",
    "end": "640279"
  },
  {
    "text": "evaluate the S sandook profile of that context and uh turns out that Apple of",
    "start": "640279",
    "end": "647360"
  },
  {
    "text": "course think about it about this since web sheet is rendering untrusted content",
    "start": "647360",
    "end": "653560"
  },
  {
    "text": "it's also running in a very tight sandbox and in fact this sandbox is",
    "start": "653560",
    "end": "659240"
  },
  {
    "text": "almost like the mobile Safari renderer process process uh",
    "start": "659240",
    "end": "664399"
  },
  {
    "text": "sandbox um because uh they are both processing untrusted data so it makes",
    "start": "664399",
    "end": "670399"
  },
  {
    "text": "sense to sunbox it as much as possible but notice that I say almost because",
    "start": "670399",
    "end": "675440"
  },
  {
    "text": "there are slight difference and we will check them later uh so web sheet lacks of dynamic",
    "start": "675440",
    "end": "683200"
  },
  {
    "text": "Cod signing because performance were not critical uh in that context uh so there",
    "start": "683200",
    "end": "689160"
  },
  {
    "text": "is no way of uh there is no need of a git page to speed up uh the",
    "start": "689160",
    "end": "697320"
  },
  {
    "text": "content uh so as you may know uh iOS have the code signing so uh you cannot",
    "start": "697320",
    "end": "703639"
  },
  {
    "text": "run your stuff if there is no rwx page uh for the git so you will have to reuse",
    "start": "703639",
    "end": "710040"
  },
  {
    "text": "existing code so is the is this attack Vector new",
    "start": "710040",
    "end": "716279"
  },
  {
    "text": "or unique uh of course not it was already used in other context and",
    "start": "716279",
    "end": "722399"
  },
  {
    "text": "the first that come to my mind because it's recent it's the Nintendo switch uh",
    "start": "722399",
    "end": "728399"
  },
  {
    "text": "and uh basically the Nintendo switch supports a basic CF portal functionality and uh it",
    "start": "728399",
    "end": "738160"
  },
  {
    "text": "can be can be used to open a web kit uh on the Nintendo switch and uh it turns",
    "start": "738160",
    "end": "745160"
  },
  {
    "text": "out that until two days ago the Nintendo switch was vulnerable to the Pegasus pug",
    "start": "745160",
    "end": "750959"
  },
  {
    "text": "so a lot of some people online make uh code execution inside inside that and uh",
    "start": "750959",
    "end": "758240"
  },
  {
    "text": "um it's funny because also this one lacks of uh",
    "start": "758240",
    "end": "763440"
  },
  {
    "text": "git and uh yeah I would like to thanks Luca for for the",
    "start": "763440",
    "end": "768800"
  },
  {
    "text": "picture so um after getting uh initial code",
    "start": "768800",
    "end": "775880"
  },
  {
    "text": "execution usually what do you do uh well uh uh usually you try to escape the sandbox because you are confined in a",
    "start": "775880",
    "end": "783600"
  },
  {
    "text": "limited uh uh environment you cannot do much uh so the main targets uh",
    "start": "783600",
    "end": "790120"
  },
  {
    "text": "reasonable targets for sandbox Escape are user mode privilege process or Kel",
    "start": "790120",
    "end": "796639"
  },
  {
    "text": "so you can either use a user mode the sandbox Escape buag in a a privilege",
    "start": "796639",
    "end": "802399"
  },
  {
    "text": "procer or a Kel bug so what about user mode bugs",
    "start": "802399",
    "end": "809360"
  },
  {
    "start": "806000",
    "end": "806000"
  },
  {
    "text": "uh well like I mentioned before we use a um in mobile one we had two user modb",
    "start": "809360",
    "end": "817800"
  },
  {
    "text": "and we successfully bypass the mobile Safari sandbox um or you can use something else",
    "start": "817800",
    "end": "826199"
  },
  {
    "text": "uh so in 10.2 I got this CV from from Apple uh that there was a sunbox problem",
    "start": "826199",
    "end": "833680"
  },
  {
    "text": "from from web sheet and uh uh it says that a sunbox process may be able to to",
    "start": "833680",
    "end": "840040"
  },
  {
    "text": "uh escape the sandbox and uh let's see that problem so CV 2016 uh",
    "start": "840040",
    "end": "849600"
  },
  {
    "start": "844000",
    "end": "844000"
  },
  {
    "text": "7630 uh it's about the web sheet uh like The Advisory was",
    "start": "849600",
    "end": "854959"
  },
  {
    "text": "saying uh so like I said before this web sheet uh",
    "start": "854959",
    "end": "860560"
  },
  {
    "text": "have a similar sandbox profile to the web content uh",
    "start": "860560",
    "end": "865880"
  },
  {
    "text": "process uh which by the way is the separate process in which the mobile",
    "start": "865880",
    "end": "871360"
  },
  {
    "text": "Safari application will render your um web content uh so uh they are similar they",
    "start": "871360",
    "end": "879279"
  },
  {
    "text": "can access uh the same uh Service uh same drivers uh so they're for our uh",
    "start": "879279",
    "end": "887199"
  },
  {
    "text": "purpose they are basically equivalent so I'm not showing these two sandbox profiles because they will take like 30",
    "start": "887199",
    "end": "893600"
  },
  {
    "text": "slides and uh uh the real difference is that entire ements are quite",
    "start": "893600",
    "end": "901720"
  },
  {
    "text": "different so entitlements on iOS they are basically similar to uh Android",
    "start": "901720",
    "end": "908839"
  },
  {
    "start": "902000",
    "end": "902000"
  },
  {
    "text": "permission they like Express capabilities and they are um they they",
    "start": "908839",
    "end": "916519"
  },
  {
    "text": "they are inside the binary it's not like infop that is external and uh uh so",
    "start": "916519",
    "end": "922360"
  },
  {
    "text": "let's take a look at web sheet uh entitlements the first thing I it code",
    "start": "922360",
    "end": "928880"
  },
  {
    "text": "my attention um it's that uh it has unrestricted access to uh the managed",
    "start": "928880",
    "end": "936160"
  },
  {
    "text": "configuration which is interesting functionality that we we will explain in the next slides and the other very",
    "start": "936160",
    "end": "942000"
  },
  {
    "text": "interesting functionality is that it can open sensitive URL as you can see and it can do it in the",
    "start": "942000",
    "end": "948800"
  },
  {
    "text": "background uh and uh at the bottom you can see that it's running a custom soundbox profile named web",
    "start": "948800",
    "end": "956759"
  },
  {
    "text": "sheet and it Al uh you can see in the entitlements it also lacks of G of",
    "start": "956759",
    "end": "963519"
  },
  {
    "text": "dynamic Cod signing sorry so managed configuration is very",
    "start": "963519",
    "end": "970079"
  },
  {
    "start": "966000",
    "end": "966000"
  },
  {
    "text": "interesting uh it's related to MDM and configuration profile to be honest I don't uh know uh all all all it what can",
    "start": "970079",
    "end": "979639"
  },
  {
    "text": "do I only know the scope of what I use uh so if you have this entitlement you",
    "start": "979639",
    "end": "987319"
  },
  {
    "text": "can talk to a remote uh service that is in charge of managing the configuration",
    "start": "987319",
    "end": "994319"
  },
  {
    "text": "uh of this type so basically uh if you see here there is some objective c code",
    "start": "994319",
    "end": "1001560"
  },
  {
    "text": "and uh actually you can you can try this with uh I don't know a DB or something like that and uh inject it into web",
    "start": "1001560",
    "end": "1008319"
  },
  {
    "text": "sheeet and uh it will U communicate with MC profile connection via NSX xpc and uh",
    "start": "1008319",
    "end": "1015959"
  },
  {
    "text": "install our uh configuration profile profile so the code is quite simple just",
    "start": "1015959",
    "end": "1021120"
  },
  {
    "text": "decode my hardcoded profile and install it so how do we create create a",
    "start": "1021120",
    "end": "1029240"
  },
  {
    "start": "1027000",
    "end": "1027000"
  },
  {
    "text": "configuration profile well there is a tool for that it's called Apple configurator CH and it's in the App",
    "start": "1029240",
    "end": "1036000"
  },
  {
    "text": "Store and uh it's I think it's supposed to be used by network administrator or",
    "start": "1036000",
    "end": "1041600"
  },
  {
    "text": "MDM or something like that and uh it can basically specify a lot of options uh",
    "start": "1041600",
    "end": "1048120"
  },
  {
    "text": "for for uh the configuration of the iOS device and you can specify a proxy you",
    "start": "1048120",
    "end": "1053919"
  },
  {
    "text": "can embed the certificates you can add Wi-Fi VPN APN settings and other stuff",
    "start": "1053919",
    "end": "1061520"
  },
  {
    "text": "it's quite uh comprehensive so if we install this kind",
    "start": "1061520",
    "end": "1068120"
  },
  {
    "text": "of kind of uh certificate what do we gain well uh since we can bundle uh uh",
    "start": "1068120",
    "end": "1078480"
  },
  {
    "text": "certificates uh as you can see here in the picture for example I just embed a a burp certificate uh a root root",
    "start": "1078480",
    "end": "1085880"
  },
  {
    "text": "certificate Authority from borp and this root certificate Authority will will be installed on the device and so now we",
    "start": "1085880",
    "end": "1092440"
  },
  {
    "text": "can meet we can man in the middle not only the HTTP but also the https that",
    "start": "1092440",
    "end": "1097880"
  },
  {
    "text": "does not enforce the the the pinning of the certificate because the device will will trust our cert malicious",
    "start": "1097880",
    "end": "1106400"
  },
  {
    "text": "certificate uh and also we have also some other side effect capability such as specifying the APN and something like",
    "start": "1106400",
    "end": "1113799"
  },
  {
    "text": "that so it's quite powerful but uh we are not really interested into into that",
    "start": "1113799",
    "end": "1119520"
  },
  {
    "text": "uh what we want to do uh is to use this new capabilities to get into a less",
    "start": "1119520",
    "end": "1126640"
  },
  {
    "text": "restricted uh context so uh the idea is to jump to another app",
    "start": "1126640",
    "end": "1135440"
  },
  {
    "text": "but which app should we jump um so on iOS there is something called",
    "start": "1135440",
    "end": "1142679"
  },
  {
    "text": "the UR URL schemes and the CF bound or URL types basically in your application",
    "start": "1142679",
    "end": "1148039"
  },
  {
    "text": "infop list you can declare some URL that your application is willing to handle",
    "start": "1148039",
    "end": "1153919"
  },
  {
    "text": "and uh other application can simply open this URLs and use it as a form of IPC",
    "start": "1153919",
    "end": "1161120"
  },
  {
    "text": "and the app that declares those URL will handle this and be invoked and decide",
    "start": "1161120",
    "end": "1166720"
  },
  {
    "text": "what to do if handled them or not here we can see there is a example of Legacy",
    "start": "1166720",
    "end": "1173919"
  },
  {
    "text": "diagnostic URL so some application declare this",
    "start": "1173919",
    "end": "1179520"
  },
  {
    "text": "Legacy diagnostic URL so this is roughly how it works so",
    "start": "1179520",
    "end": "1185360"
  },
  {
    "text": "basically there are some callbacks I will not go too much into the details on this basically there are some callbacks",
    "start": "1185360",
    "end": "1191120"
  },
  {
    "text": "in the application that gets invoked when um this kind of interaction via URL",
    "start": "1191120",
    "end": "1197480"
  },
  {
    "text": "happen and invoking it is fairly simple you just uh can use system apis because it's",
    "start": "1197480",
    "end": "1204400"
  },
  {
    "text": "a supported functionality actually and it's used a lot by Facebook and Twitter",
    "start": "1204400",
    "end": "1209919"
  },
  {
    "text": "or to open the app store or so it's a legitimate system functionality nothing",
    "start": "1209919",
    "end": "1215200"
  },
  {
    "text": "nothing uh strange or bugs here so if you don't have some",
    "start": "1215200",
    "end": "1221480"
  },
  {
    "text": "entitlements when you do this uh probably you will get some popups and so it's not good for us because the user",
    "start": "1221480",
    "end": "1228520"
  },
  {
    "text": "will have to click to accept and uh to open this this but fortunately our web",
    "start": "1228520",
    "end": "1234000"
  },
  {
    "text": "sheet application have enough power to don't prompt any uh confirmation thanks",
    "start": "1234000",
    "end": "1240120"
  },
  {
    "text": "to open sensitive URL entitlement and open in the background",
    "start": "1240120",
    "end": "1246120"
  },
  {
    "text": "entitlement so what we will do is open another application called iOS Diagnostic and uh luckily this",
    "start": "1246120",
    "end": "1252919"
  },
  {
    "text": "application iOS diagnostic was uh was using uh http PS but uh uh now we",
    "start": "1252919",
    "end": "1260679"
  },
  {
    "text": "injected our certificate so we can man the middle it and also it was lucky",
    "start": "1260679",
    "end": "1265880"
  },
  {
    "text": "because uh it's U getting some content from the web and we can inject some JavaScript into it and also even more",
    "start": "1265880",
    "end": "1273679"
  },
  {
    "text": "lucky this Legacy application uh was UN",
    "start": "1273679",
    "end": "1278960"
  },
  {
    "text": "sandbox so uh this Pudo code will uh just uh install the malicious profile as",
    "start": "1279279",
    "end": "1286880"
  },
  {
    "text": "we explained and then it will open the URL triggering uh the Legacy diagnostic",
    "start": "1286880",
    "end": "1292919"
  },
  {
    "text": "URL and opening the iOS uh Diagnostics application and it will jump to that",
    "start": "1292919",
    "end": "1298640"
  },
  {
    "text": "application which runs and some boxed again and uh it will fetch a https URL",
    "start": "1298640",
    "end": "1304840"
  },
  {
    "text": "and uh we can man in the middle it and use the same buag to to to get a code",
    "start": "1304840",
    "end": "1311880"
  },
  {
    "text": "execution out of the sandbox so iOS diagnostic was a I I'm",
    "start": "1311880",
    "end": "1318039"
  },
  {
    "text": "saying was because now it's not present anymore as as we can see it's a it's a",
    "start": "1318039",
    "end": "1323400"
  },
  {
    "text": "application which I I don't know the purpose uh uh but I just found it",
    "start": "1323400",
    "end": "1328720"
  },
  {
    "text": "because I was auditing all the URL Handler on on the iOS and uh trying to",
    "start": "1328720",
    "end": "1334600"
  },
  {
    "text": "see if everyone was using HTTP or https and it turned out that uh this was and",
    "start": "1334600",
    "end": "1341880"
  },
  {
    "text": "uh so we can jump into this so this is some kind of crappy",
    "start": "1341880",
    "end": "1349400"
  },
  {
    "text": "codee of the malicious proxy as you can see it's very simple so the first part is targeting the the web sheeet and",
    "start": "1349400",
    "end": "1356600"
  },
  {
    "text": "uh uh just serve uh something and then uh",
    "start": "1356600",
    "end": "1362039"
  },
  {
    "text": "if the second one is some request made by the other",
    "start": "1362039",
    "end": "1367320"
  },
  {
    "start": "1368000",
    "end": "1368000"
  },
  {
    "text": "application so another consideration is this jumping through application and web",
    "start": "1368320",
    "end": "1375159"
  },
  {
    "text": "view a new topic and the answer is no again you should check this talk by my",
    "start": "1375159",
    "end": "1380320"
  },
  {
    "text": "friends uh flanker and leaming on Android and they use a similar technique",
    "start": "1380320",
    "end": "1385960"
  },
  {
    "text": "on Android mobile P 2016 uh which I think it's quite good",
    "start": "1385960",
    "end": "1393039"
  },
  {
    "text": "technique because with a single memory corruption you can reuse twice and uh so",
    "start": "1393039",
    "end": "1398760"
  },
  {
    "text": "it's a single memory corruption plus one plus logic bugs which is nice I think",
    "start": "1398760",
    "end": "1405640"
  },
  {
    "text": "and also another example is by locky hard of project zero it's a little bit similar but I think it Shar some",
    "start": "1405640",
    "end": "1412240"
  },
  {
    "text": "context uh some Concepts sorry and uh basically from Safari he was able to",
    "start": "1412240",
    "end": "1418200"
  },
  {
    "text": "jump to the on Mac OS on Safari he was able to jump to the help",
    "start": "1418200",
    "end": "1424480"
  },
  {
    "start": "1425000",
    "end": "1425000"
  },
  {
    "text": "viewer small video if it works",
    "start": "1425799",
    "end": "1432679"
  },
  {
    "text": "so a small video with some shortcuts",
    "start": "1432679",
    "end": "1439880"
  },
  {
    "text": "so I took a picture of my favorite",
    "start": "1442400",
    "end": "1446159"
  },
  {
    "text": "book and then I join my Wi-Fi which is go oh it's not oops sorry it's not",
    "start": "1450000",
    "end": "1458520"
  },
  {
    "text": "working fa",
    "start": "1458520",
    "end": "1465320"
  },
  {
    "start": "1466799",
    "end": "1469799"
  },
  {
    "text": "that's okay I think I think it's okay yeah",
    "start": "1472640",
    "end": "1477799"
  },
  {
    "text": "so so my favorite book",
    "start": "1481520",
    "end": "1485559"
  },
  {
    "text": "again uh so I will join my Wi-Fi network Marco",
    "start": "1488799",
    "end": "1494600"
  },
  {
    "text": "123 and you can see web web sheeet pop up B automatically and I don't have to click anything",
    "start": "1494600",
    "end": "1501440"
  },
  {
    "text": "more and then iOS Diagnostic and uh",
    "start": "1501440",
    "end": "1508360"
  },
  {
    "text": "then and then I got to the",
    "start": "1508559",
    "end": "1512398"
  },
  {
    "text": "picture whoops",
    "start": "1519279",
    "end": "1524559"
  },
  {
    "text": "sorry",
    "start": "1526679",
    "end": "1529679"
  },
  {
    "text": "so what change uh on Apple side so in",
    "start": "1533399",
    "end": "1540200"
  },
  {
    "text": "temp uh now uh the web sheet app doesn't allow any more uh unconstrained access",
    "start": "1540200",
    "end": "1546720"
  },
  {
    "text": "to the managed configuration they changeed the entitlements and also before like in iOS 10 beta or something",
    "start": "1546720",
    "end": "1553600"
  },
  {
    "text": "like that the diagnostic application was removed",
    "start": "1553600",
    "end": "1558799"
  },
  {
    "text": "so the entitlement are changed now uh there is a different entitlement for the managed configuration and it's much more",
    "start": "1558799",
    "end": "1565640"
  },
  {
    "text": "strict as you can see uh it's not like a single shot entitlement now they uh uh",
    "start": "1565640",
    "end": "1572480"
  },
  {
    "text": "separated like uh this application can only do the UI installation which",
    "start": "1572480",
    "end": "1578120"
  },
  {
    "text": "probably requires some user interaction and uh then the open sensitive URL have",
    "start": "1578120",
    "end": "1584559"
  },
  {
    "text": "been uh also they remov the wild card for the open sensitive URL and then now",
    "start": "1584559",
    "end": "1590880"
  },
  {
    "text": "you can open only a preference root Wi-Fi which is the URL to open uh the",
    "start": "1590880",
    "end": "1596360"
  },
  {
    "text": "setting application in the Wi-Fi um window and uh some other other one which",
    "start": "1596360",
    "end": "1603520"
  },
  {
    "text": "I assume it's to open a mobile Safari Tab and uh like I said the iOS",
    "start": "1603520",
    "end": "1611640"
  },
  {
    "text": "diagnostic application is totally gone so uh let's do",
    "start": "1611640",
    "end": "1621559"
  },
  {
    "start": "1616000",
    "end": "1616000"
  },
  {
    "text": "some how to say reason and uh comparison and uh so web rendering engine they have",
    "start": "1621559",
    "end": "1628480"
  },
  {
    "text": "bugs and we cannot do a lot about them because of the complexity but uh we can uh mitigate",
    "start": "1628480",
    "end": "1635559"
  },
  {
    "text": "this by running uh everything more sbox and uh Android for example will do this",
    "start": "1635559",
    "end": "1641600"
  },
  {
    "text": "as much as possible basically every application that has a web view it will",
    "start": "1641600",
    "end": "1647200"
  },
  {
    "text": "run in multiprocess mode which means that the untrusted web content would be handled in a separate uh isolated",
    "start": "1647200",
    "end": "1655640"
  },
  {
    "text": "process and uh actually in iOS I found that there is something similar but I",
    "start": "1655640",
    "end": "1661600"
  },
  {
    "text": "don't think it's very used uh because uh maybe it's maybe of the documentation it's explained more like a uh instead of",
    "start": "1661600",
    "end": "1670120"
  },
  {
    "text": "a like a unboxing security measure it's explained more like a performance a performance boost because you run web",
    "start": "1670120",
    "end": "1677320"
  },
  {
    "text": "sheet uh you run a web VI remotely and uh it will uh have uh entitlement to to",
    "start": "1677320",
    "end": "1683799"
  },
  {
    "text": "to do the git so some slides ago we say kernel but",
    "start": "1683799",
    "end": "1691120"
  },
  {
    "text": "we didn't talk at all about the kernel so I just uh bring some case study uh",
    "start": "1691120",
    "end": "1699640"
  },
  {
    "text": "the first one is the P using 10.2 for the yellow",
    "start": "1699640",
    "end": "1705799"
  },
  {
    "start": "1702000",
    "end": "1702000"
  },
  {
    "text": "jailbreak uh so this pack was affecting",
    "start": "1705799",
    "end": "1710840"
  },
  {
    "text": "from IOS 10 to 10.2 and um actually there are some",
    "start": "1710840",
    "end": "1716919"
  },
  {
    "text": "problem it's more there are some problem using this bag on 64-bit process because",
    "start": "1716919",
    "end": "1722120"
  },
  {
    "text": "its nature uh so to be honest I never used it in the web sheet context of this",
    "start": "1722120",
    "end": "1728840"
  },
  {
    "text": "talk but anyway I I thought it would be nice to to present it as a case study",
    "start": "1728840",
    "end": "1734440"
  },
  {
    "text": "because it's a very good hip overflow and it was used in the Yu temp2 jbre and",
    "start": "1734440",
    "end": "1741919"
  },
  {
    "text": "uh also this buag is reachable from any sandbox so I think it's quite",
    "start": "1741919",
    "end": "1747399"
  },
  {
    "text": "interesting and uh I found this bag uh I don't remember exactly the period but",
    "start": "1747399",
    "end": "1752640"
  },
  {
    "text": "somewhere in 2016 and uh y of project zero",
    "start": "1752640",
    "end": "1758559"
  },
  {
    "text": "independently rediscovered it and reported and uh of course if you P the",
    "start": "1758559",
    "end": "1764480"
  },
  {
    "text": "kernel also the sbox is compromised and the the device is",
    "start": "1764480",
    "end": "1771799"
  },
  {
    "text": "compromised so what about this bug this bug is in the Mac uh part of the xnu",
    "start": "1771880",
    "end": "1779600"
  },
  {
    "text": "kernel and uh it's inside this trap called the Mac voucher extract at receip",
    "start": "1779600",
    "end": "1785840"
  },
  {
    "text": "trap and uh for the one that doesn't know what the Trap is is basically on",
    "start": "1785840",
    "end": "1791519"
  },
  {
    "text": "Mac OS and iOS you have regular system calls and then you have some traps and",
    "start": "1791519",
    "end": "1796799"
  },
  {
    "text": "uh basically they are also system calls and they can be invoked from from user mode and uh if you see the function",
    "start": "1796799",
    "end": "1805120"
  },
  {
    "text": "declaration it has only one argument that represent the argument passed from",
    "start": "1805120",
    "end": "1811880"
  },
  {
    "text": "user mode by by the user so the first thing that uh this STP",
    "start": "1811880",
    "end": "1817240"
  },
  {
    "text": "this function does is to uh copy from user space with copying uh receip size into the the SZ",
    "start": "1817240",
    "end": "1826240"
  },
  {
    "text": "variable and then you do some basic check like that the size is not",
    "start": "1826240",
    "end": "1831840"
  },
  {
    "text": "unreasonably large and U if you look down there are a",
    "start": "1831840",
    "end": "1837640"
  },
  {
    "text": "big if else this uh big uh if else is basically two alternative two paths one",
    "start": "1837640",
    "end": "1844399"
  },
  {
    "text": "is the fast PA and one is the slow PA the fast PA will be will use will be",
    "start": "1844399",
    "end": "1850039"
  },
  {
    "text": "using the stack because the stack is faster but the stack in kernel you cannot make a very big uh stack buffer",
    "start": "1850039",
    "end": "1858080"
  },
  {
    "text": "so it basically check SV so to see if it larger than a a threshold if it's",
    "start": "1858080",
    "end": "1865840"
  },
  {
    "text": "smaller it can take the fast path and use the stack but uh if it's bigger then",
    "start": "1865840",
    "end": "1871679"
  },
  {
    "text": "it will take the slow path which is the lse and it's where the bug is in the",
    "start": "1871679",
    "end": "1877360"
  },
  {
    "text": "slow slow P if you noticed before AR's receipt size is using copy in and uh",
    "start": "1877360",
    "end": "1886080"
  },
  {
    "text": "this is because because AR's receip size is a pointer it's not a length and here",
    "start": "1886080",
    "end": "1891960"
  },
  {
    "text": "the developer made the mistake to use it as a uh a length but instead is a",
    "start": "1891960",
    "end": "1898200"
  },
  {
    "text": "pointer it's a user mode pointer so this value will be extremely big normally and",
    "start": "1898200",
    "end": "1905880"
  },
  {
    "text": "uh this will Heap to uh Hep",
    "start": "1905880",
    "end": "1911200"
  },
  {
    "text": "corruption if we uh if we can trigger it so uh it turns out that it's quite",
    "start": "1911559",
    "end": "1919360"
  },
  {
    "text": "easy to trigger and uh it can be easily and reliably exploited uh because uh",
    "start": "1919360",
    "end": "1925600"
  },
  {
    "text": "copying have some very nice feature uh which is uh actually it's it's quite",
    "start": "1925600",
    "end": "1931639"
  },
  {
    "text": "common in Kel in this kind of functions uh that copy from user mode to Kel mode basically if copying encounters a",
    "start": "1931639",
    "end": "1939679"
  },
  {
    "text": "unmapped page it will stop the copy but still it would have copy some content so",
    "start": "1939679",
    "end": "1947600"
  },
  {
    "text": "we can use this fact uh because our exploitation problem is that the user",
    "start": "1947600",
    "end": "1953039"
  },
  {
    "text": "mode pointer will be reasonably a big reasonbly big number if considered as a",
    "start": "1953039",
    "end": "1959279"
  },
  {
    "text": "length so we need we need some trick to bypass this and thanks to copying is",
    "start": "1959279",
    "end": "1965799"
  },
  {
    "text": "possible you can uh put your stuff on the um end of the page and unmap the",
    "start": "1965799",
    "end": "1972279"
  },
  {
    "text": "page after so uh you will not have a wild copy you can just over flow a very",
    "start": "1972279",
    "end": "1977720"
  },
  {
    "text": "small small uh content and uh so we can control exactly the size of the Overflow",
    "start": "1977720",
    "end": "1985000"
  },
  {
    "text": "and also the content and uh this means that this is like a perfect uh hip",
    "start": "1985000",
    "end": "1990559"
  },
  {
    "text": "overflow bag and can be easily and reliably exploited as we saw in the",
    "start": "1990559",
    "end": "1996039"
  },
  {
    "text": "yellow 10.2 uh to end uh I thought I might add",
    "start": "1996039",
    "end": "2004039"
  },
  {
    "text": "some ios9 uh buag that got fixed internally by Apple but they are interesting anyway",
    "start": "2004039",
    "end": "2013279"
  },
  {
    "start": "2011000",
    "end": "2011000"
  },
  {
    "text": "so those are iOS 93 kernel",
    "start": "2013279",
    "end": "2018799"
  },
  {
    "text": "bugs and uh I'm not sure which device are uh affected but on my device there",
    "start": "2018799",
    "end": "2025279"
  },
  {
    "text": "are and uh uh those are bugs in graphics and this one is uh use after free",
    "start": "2025279",
    "end": "2032840"
  },
  {
    "text": "from U the application sandbox or or the browser sandbox and uh it was fixed by",
    "start": "2032840",
    "end": "2039200"
  },
  {
    "text": "Apple uh somewhere in iOS 10 or iOS 10 beta and uh I think they found it",
    "start": "2039200",
    "end": "2045320"
  },
  {
    "text": "internally or maybe for some code refactor uh because um I didn't find a CV for it so",
    "start": "2045320",
    "end": "2054520"
  },
  {
    "text": "and also please excuse me for the poor coding style so basically this bug is",
    "start": "2054520",
    "end": "2060599"
  },
  {
    "text": "just opening a graphic I don't know opengl uh user client and then the most",
    "start": "2060599",
    "end": "2066520"
  },
  {
    "text": "important thing is to open also the shared graphic user client because there",
    "start": "2066520",
    "end": "2071960"
  },
  {
    "text": "are at least three or four type of graphic user client and then you have to",
    "start": "2071960",
    "end": "2077440"
  },
  {
    "text": "connect them together with IO connect at the client and after that you just call one",
    "start": "2077440",
    "end": "2085599"
  },
  {
    "text": "method on um the graphic user client and uh this method is related to graphic",
    "start": "2085599",
    "end": "2094720"
  },
  {
    "text": "resources and uh this this uh method call will cause a a use after",
    "start": "2094720",
    "end": "2101320"
  },
  {
    "text": "free condition when you close the user client anyway it's it was also",
    "start": "2101320",
    "end": "2106440"
  },
  {
    "text": "exploitable and reliable exploit and then some stupid couple of",
    "start": "2106440",
    "end": "2112560"
  },
  {
    "text": "stupid infol uh if you are familiar with IO",
    "start": "2112560",
    "end": "2118000"
  },
  {
    "text": "kit uh you might know that uh when you call a method it will return to you a",
    "start": "2118000",
    "end": "2124320"
  },
  {
    "text": "error code and um if in kernel you you forget to return",
    "start": "2124320",
    "end": "2129560"
  },
  {
    "text": "something then the content of some register can get uh spilled into the uh",
    "start": "2129560",
    "end": "2136359"
  },
  {
    "text": "into the return value and lick it to user mode and uh actually this kind of",
    "start": "2136359",
    "end": "2141760"
  },
  {
    "text": "bug I already saw before fixed it by Apple but um uh maybe there were other ones but",
    "start": "2141760",
    "end": "2149280"
  },
  {
    "text": "anyway this these two leaks uh now are they are gone and uh they were fixed",
    "start": "2149280",
    "end": "2154920"
  },
  {
    "text": "internally I think because uh I cannot find the CV",
    "start": "2154920",
    "end": "2160760"
  },
  {
    "text": "again so conclusion uh and then I I",
    "start": "2160760",
    "end": "2165800"
  },
  {
    "start": "2161000",
    "end": "2161000"
  },
  {
    "text": "finish uh I think it's very interesting to compare platform and study other",
    "start": "2165800",
    "end": "2171240"
  },
  {
    "text": "platform to understand difference and be behaviors and uh some platform have a",
    "start": "2171240",
    "end": "2177839"
  },
  {
    "text": "very good user friend friendly experience but uh you have some tradeoff like uh sometimes it might be a little",
    "start": "2177839",
    "end": "2184800"
  },
  {
    "text": "bit of security risk uh to add a click or remove a click and uh some box are of",
    "start": "2184800",
    "end": "2191560"
  },
  {
    "text": "course extremely important to contain attacks and force the attack chain to be",
    "start": "2191560",
    "end": "2198560"
  },
  {
    "text": "longer which is good for security and uh recently I noticed that a lot of bug are",
    "start": "2198560",
    "end": "2204760"
  },
  {
    "text": "getting disclosed or F fixed internally uh on iOS and Mac OS by Apple so I think",
    "start": "2204760",
    "end": "2211599"
  },
  {
    "text": "the security is getting even better uh it was already strong but",
    "start": "2211599",
    "end": "2217200"
  },
  {
    "text": "even better and uh if you I suggest you to check out the iOS 10.3 security",
    "start": "2217200",
    "end": "2224440"
  },
  {
    "text": "release uh notes because it lists a quite impressive uh list of BU fixes and",
    "start": "2224440",
    "end": "2232599"
  },
  {
    "text": "uh I think uh everyone should uh really check or at least research on another platform because I think it's good uh to",
    "start": "2232599",
    "end": "2240400"
  },
  {
    "text": "get a new ideas and uh apply them in different",
    "start": "2240400",
    "end": "2245599"
  },
  {
    "text": "context so I would like to credit uh these",
    "start": "2245599",
    "end": "2251480"
  },
  {
    "text": "people which I respect and uh I think that's it if you",
    "start": "2251480",
    "end": "2258240"
  },
  {
    "text": "have any question otherwise you can just ping me on Twitter or or uh whatever or find me",
    "start": "2258240",
    "end": "2268000"
  },
  {
    "text": "around thank you very",
    "start": "2268000",
    "end": "2271480"
  },
  {
    "text": "much",
    "start": "2275599",
    "end": "2278599"
  }
]