[
  {
    "text": "all right so this is pass the hash 2 uh which may lead you to believe that this is a continuation of the P the hash talk",
    "start": "80",
    "end": "6720"
  },
  {
    "text": "yesterday anybody go to that talk uh bravest guys in the room the Microsoft presenters that are here uh this is not",
    "start": "6720",
    "end": "14280"
  },
  {
    "text": "a continuation of that talk this is a continuation of our talk last year I'm Chris this is",
    "start": "14280",
    "end": "21320"
  },
  {
    "text": "Skip uh we both co-presented at black hat last year uh skip wrote the past the",
    "start": "21320",
    "end": "27679"
  },
  {
    "text": "hash Suite um that's our",
    "start": "27679",
    "end": "32599"
  },
  {
    "text": "info so this story so far last year we demonstrated how to use",
    "start": "33440",
    "end": "39680"
  },
  {
    "text": "WCE uh to pass the hash using Windows tools so you can pass the hash and fire",
    "start": "39680",
    "end": "45320"
  },
  {
    "text": "up Powershell you can use credentials within Windows Itself by adding a single binary uh more importantly we released",
    "start": "45320",
    "end": "51879"
  },
  {
    "text": "the pass the hash Suite which is partially in Cali and fully in uh",
    "start": "51879",
    "end": "56920"
  },
  {
    "text": "backtrack uh basically that patches uh took an old patch of Samba to allow it",
    "start": "56920",
    "end": "61960"
  },
  {
    "text": "to pass the hash and then we ported that so that you could pass the hash to exchange SQL uh pass the hash with",
    "start": "61960",
    "end": "68640"
  },
  {
    "text": "Firefox Has anyone used those tools couple people uh passing the hash",
    "start": "68640",
    "end": "73759"
  },
  {
    "text": "with Firefox as a pentester has been uh amazingly useful and also we we were",
    "start": "73759",
    "end": "80200"
  },
  {
    "text": "able to pass the hash using wmi so we can get command execution without using things like uh PS exec so that so far is",
    "start": "80200",
    "end": "90119"
  },
  {
    "text": "uh where we're at so now that you're caught up we can continue on but before we start uh who's an admin like a",
    "start": "90119",
    "end": "96079"
  },
  {
    "text": "Windows admin here wow couple all right who's a",
    "start": "96079",
    "end": "102320"
  },
  {
    "text": "pentester quite a few pentesters uh for a defensive talk uh Network Defenders",
    "start": "102320",
    "end": "108000"
  },
  {
    "text": "Network like Defenders IDs analysts who's interested in trying to protect",
    "start": "108000",
    "end": "113880"
  },
  {
    "text": "against or detect or mitigate against past the hash today awesome that's that's what we were",
    "start": "113880",
    "end": "119920"
  },
  {
    "text": "open for all right",
    "start": "119920",
    "end": "124880"
  },
  {
    "text": "skip so uh one of the things that we really wanted to do was there's a lot of uh talk and hype and marketing Etc",
    "start": "125479",
    "end": "133440"
  },
  {
    "text": "that's uh out there about past the hash so uh we wanted to uh address some of",
    "start": "133440",
    "end": "139200"
  },
  {
    "text": "the common misconceptions that are out there uh we also wanted to uh provide",
    "start": "139200",
    "end": "144959"
  },
  {
    "text": "you guys with some practical things that you can use hopefully tomorrow or next week when you go back to work that will",
    "start": "144959",
    "end": "152800"
  },
  {
    "text": "uh help you uh mitigate the these the the the credential attacks and pass the",
    "start": "152800",
    "end": "160200"
  },
  {
    "text": "hash and we also wanted to do it in less than 80 Pages sorry",
    "start": "160200",
    "end": "167239"
  },
  {
    "text": "guys so um we're trying to educate people um that's really the the biggest",
    "start": "167519",
    "end": "174040"
  },
  {
    "text": "thing we want to do uh past the hash sounds really really sexy I mean everyone knows what pass the hash is but",
    "start": "174040",
    "end": "181959"
  },
  {
    "text": "it really isn't like the central problem um women Windows has numerous issues",
    "start": "181959",
    "end": "189000"
  },
  {
    "text": "with authentication uh I'm sure everyone has heard of mimik cats and windows credential editor uh Benjamin delp's",
    "start": "189000",
    "end": "196480"
  },
  {
    "text": "Tool uh there's broken protocols that are still in use uh last year uh moxy's",
    "start": "196480",
    "end": "202360"
  },
  {
    "text": "talk uh introduced a cloud service that will crack uh Ms chap nlm version one",
    "start": "202360",
    "end": "210680"
  },
  {
    "text": "uh cast credentials tokens uh there's just uh just a lot of stuff that's out",
    "start": "210680",
    "end": "216640"
  },
  {
    "text": "there that can be used to uh gain access to a Windows box um like I mentioned earlier pass the",
    "start": "216640",
    "end": "224519"
  },
  {
    "text": "hash is only a small subset of the problems that are there in",
    "start": "224519",
    "end": "230360"
  },
  {
    "text": "uh Windows authentication um you know obviously if you can just read the uh the actual",
    "start": "230360",
    "end": "237480"
  },
  {
    "text": "username and password out of uh memory that that would be far easier than using",
    "start": "237480",
    "end": "244360"
  },
  {
    "text": "past the hash or anything else you because credentials are a user's main form of persistence on your network and",
    "start": "244360",
    "end": "250879"
  },
  {
    "text": "they're extremely portable you can go from one machine to another machine if you actually have the username and",
    "start": "250879",
    "end": "255959"
  },
  {
    "text": "password so a lot of people in this day and age have been asking you know why",
    "start": "255959",
    "end": "261359"
  },
  {
    "text": "pass the hash when you can use the actual creds um for some reason people think",
    "start": "261359",
    "end": "268639"
  },
  {
    "text": "that you can actually fix pass the hash with a patch pass the hash is by Design",
    "start": "268639",
    "end": "277639"
  },
  {
    "text": "functionality that's built into the ntlm protocol why else do you think when the",
    "start": "277639",
    "end": "285440"
  },
  {
    "text": "other service providers in in Elsas save the username and password the only thing",
    "start": "285440",
    "end": "291440"
  },
  {
    "text": "that gets saved by the ntlm service provider are the",
    "start": "291440",
    "end": "296960"
  },
  {
    "text": "hashes if they needed the username and password they would have saved the username and password instead they saved",
    "start": "296960",
    "end": "303000"
  },
  {
    "text": "the hashes um so and another little side bit",
    "start": "303000",
    "end": "309280"
  },
  {
    "text": "that I always like to hammer on the LM password if you're using a",
    "start": "309280",
    "end": "314680"
  },
  {
    "text": "password on a Windows box that is less than 14 is 14",
    "start": "314680",
    "end": "320000"
  },
  {
    "text": "characters or less in Elsas the LM has is always calculated currently now the",
    "start": "320000",
    "end": "327360"
  },
  {
    "text": "Microsoft guys talked about yesterday new version of Windows blue and uh Server 2012 R2 that functionality is",
    "start": "327360",
    "end": "336240"
  },
  {
    "text": "finally getting removed because I mean who uses LM anymore but uh and it",
    "start": "336240",
    "end": "342080"
  },
  {
    "text": "obviously it also makes it easier to crack the nlm hash because you can then use rainbow tables on the LM hash you",
    "start": "342080",
    "end": "347440"
  },
  {
    "text": "could then just take that word do some case scrambling and you'll get the ntlm without any",
    "start": "347440",
    "end": "354800"
  },
  {
    "text": "problems so this is something that was partially addressed yesterday but it still had a big TBD next to it even if",
    "start": "354800",
    "end": "362360"
  },
  {
    "text": "Microsoft figures out a way to completely neutralize past the has or any of the other attacks that are out",
    "start": "362360",
    "end": "368960"
  },
  {
    "text": "there there's no guarantee that it's going to be backported into the versions of Microsoft off uh Microsoft products",
    "start": "368960",
    "end": "376120"
  },
  {
    "text": "that are being used in your environment today so just as a quick informal survey",
    "start": "376120",
    "end": "381960"
  },
  {
    "text": "who here still has Vista on their Network",
    "start": "381960",
    "end": "387639"
  },
  {
    "text": "I was getting there who still has XP on their",
    "start": "389680",
    "end": "396000"
  },
  {
    "text": "Network all right who's",
    "start": "396160",
    "end": "401000"
  },
  {
    "text": "still you know where we're going next don't you who's still has 2,000 on their",
    "start": "401319",
    "end": "409759"
  },
  {
    "text": "Network all right ah you're going to make me ask it aren't",
    "start": "409759",
    "end": "414950"
  },
  {
    "text": "[Applause] you who has Windows NT still on on their",
    "start": "414950",
    "end": "420919"
  },
  {
    "text": "Network keep going you know what we're just going to",
    "start": "420919",
    "end": "426479"
  },
  {
    "text": "call you the winner and we'll be done with it 958 98",
    "start": "426479",
    "end": "433599"
  },
  {
    "text": "a man 95 you make a grown man cry oh wait or Start Me Up wasn't it I",
    "start": "433599",
    "end": "444199"
  },
  {
    "text": "miss I'm sure that stuff's still out there uh so anyway um another common",
    "start": "444199",
    "end": "451520"
  },
  {
    "text": "topic is that keros actually completely solves or completely eliminates the",
    "start": "451520",
    "end": "456960"
  },
  {
    "text": "problems with past the hash and that is quite simply just not true uh the ntlm",
    "start": "456960",
    "end": "463879"
  },
  {
    "text": "hashes are actually used in the keros process as the long-term secret Keys",
    "start": "463879",
    "end": "470039"
  },
  {
    "text": "between keros principles and the domain controller so if you compromise the debain controller you still get",
    "start": "470039",
    "end": "476400"
  },
  {
    "text": "everyone's the encryption key for everyone that for every keros ticket the long-term uh encryption key the curb TGT",
    "start": "476400",
    "end": "484840"
  },
  {
    "text": "hash which is uh in the uh in the main controller is the master key for all",
    "start": "484840",
    "end": "491080"
  },
  {
    "text": "krose tickets so uh per our white paper last year um once you have that you can",
    "start": "491080",
    "end": "498039"
  },
  {
    "text": "actually create your own arbitrary keros tickets with whatever privileges for",
    "start": "498039",
    "end": "504120"
  },
  {
    "text": "whatever user all you need is a few SIDS and Away you go and you can literally just write your own ticket onto the",
    "start": "504120",
    "end": "511320"
  },
  {
    "text": "network um so basically between the two loss of the hash can completely",
    "start": "511320",
    "end": "516640"
  },
  {
    "text": "undermine keros and tgts are fairly portable they",
    "start": "516640",
    "end": "522800"
  },
  {
    "text": "can be with WCE and I think mimik cats also has that functionality now think so",
    "start": "522800",
    "end": "528959"
  },
  {
    "text": "um they can the T tgts can be exported from one computer moved over to another",
    "start": "528959",
    "end": "534240"
  },
  {
    "text": "reimported into Elsas and even though they're time limited they can more or L",
    "start": "534240",
    "end": "539720"
  },
  {
    "text": "be continually renewed with you know some caveats depending on what your",
    "start": "539720",
    "end": "544800"
  },
  {
    "text": "settings are the Microsoft guys is kind of going yeah",
    "start": "544800",
    "end": "553000"
  },
  {
    "text": "so basically there's still a lot of issues with keros and just as a uh quick",
    "start": "553000",
    "end": "559760"
  },
  {
    "text": "aside um there was a ACM paper from what",
    "start": "559760",
    "end": "566240"
  },
  {
    "text": "was it 91 91 or '92 91 or9 2 that talked about problems in Kerberos",
    "start": "566240",
    "end": "573079"
  },
  {
    "text": "4 where they talked about things like compromise of the KDC could ultimately",
    "start": "573079",
    "end": "581040"
  },
  {
    "text": "result in somebody being able to uh impersonate anybody on the network they",
    "start": "581040",
    "end": "586399"
  },
  {
    "text": "talked about how tgts were relatively portable um and some other stuff that",
    "start": "586399",
    "end": "592480"
  },
  {
    "text": "was specific to keros 4 at the time but a lot of these problems are still around",
    "start": "592480",
    "end": "597640"
  },
  {
    "text": "today and uh in our white paper we actually link to the thing it's just a fascinating read cuz literally you could",
    "start": "597640",
    "end": "603120"
  },
  {
    "text": "just substitute windows for Unix here and there and the paper reads very",
    "start": "603120",
    "end": "610079"
  },
  {
    "text": "cleanly so the real issue here is single sign on um Microsoft actually has a term for",
    "start": "610600",
    "end": "618480"
  },
  {
    "text": "getting prompted uh just based on the videos I've seen uh for your password",
    "start": "618480",
    "end": "623800"
  },
  {
    "text": "too many times called credential fatigue so there's actually a term for getting bugged to to uh put in your password",
    "start": "623800",
    "end": "630920"
  },
  {
    "text": "over and over again so the idea is you ask for their password once username",
    "start": "630920",
    "end": "636320"
  },
  {
    "text": "password log in and then you keep the nagging at a minimum uh Windows also caches the",
    "start": "636320",
    "end": "644240"
  },
  {
    "text": "credentials for any of the ssps that are loaded by default so you know you need",
    "start": "644240",
    "end": "649720"
  },
  {
    "text": "them maybe possibly sometime somewhere maybe kind",
    "start": "649720",
    "end": "655680"
  },
  {
    "text": "of um so this is actually the title of our white",
    "start": "655680",
    "end": "662560"
  },
  {
    "text": "paper um please go read it uh it's a lot more thorough and in-depth than uh our talk and uh everyone that's read it so",
    "start": "662560",
    "end": "670399"
  },
  {
    "text": "far is is really really liked it so uh feel free to read through it it's only",
    "start": "670399",
    "end": "676079"
  },
  {
    "text": "25 Pages uh we tried to keep it at a minimum but uh let us know if you have",
    "start": "676079",
    "end": "681360"
  },
  {
    "text": "any feedback so obviously we have the ability to recover the plain text",
    "start": "681360",
    "end": "688480"
  },
  {
    "text": "passwords from uh memory uh you've got digest md5 you've",
    "start": "688480",
    "end": "693920"
  },
  {
    "text": "got the TS package and the live SSP because you know your Enterprise needs to authenticate to Xbox Live and Windows",
    "start": "693920",
    "end": "701639"
  },
  {
    "text": "Live because that's really what I want um even if nobody is logged in there is",
    "start": "701639",
    "end": "710880"
  },
  {
    "text": "at least one plain text password that is available on every domain every computer in a Windows",
    "start": "710880",
    "end": "718320"
  },
  {
    "text": "domain and that is the computer account it's stored in LSA",
    "start": "718320",
    "end": "723360"
  },
  {
    "text": "secrets you can recover its its hash or like I said the pass the unencrypted password itself is actually stored in",
    "start": "723360",
    "end": "730000"
  },
  {
    "text": "the LSA Secrets uh tools like cash dump can actually uh pull it out and you can",
    "start": "730000",
    "end": "735839"
  },
  {
    "text": "use it to do all sorts of interesting things on the domain such as enumerate user groups enumerate",
    "start": "735839",
    "end": "742600"
  },
  {
    "text": "users uh Mount file shares because how does the computer itself communicate",
    "start": "742600",
    "end": "748240"
  },
  {
    "text": "with active directory it uses its computer account how does the computer update its gpos it uses its computer",
    "start": "748240",
    "end": "754959"
  },
  {
    "text": "account so it uses its computer account to access the domain controller it uses it to do all these things and as an",
    "start": "754959",
    "end": "762760"
  },
  {
    "text": "attacker you can use the computer account to do all sorts of information gathering and it really doesn't look",
    "start": "762760",
    "end": "768680"
  },
  {
    "text": "that weird in the logs and once again the LSA Secrets",
    "start": "768680",
    "end": "773839"
  },
  {
    "text": "there might actually be more passwords you can use uh for Save passwords there for service accounts and uh stuff like",
    "start": "773839",
    "end": "782040"
  },
  {
    "text": "that then there's always the Sam database um the local 500 account is",
    "start": "782040",
    "end": "787680"
  },
  {
    "text": "actually a very dangerous account uh there is a separate UAC",
    "start": "787680",
    "end": "793320"
  },
  {
    "text": "setting for the local 500 account that is disabled by default in most modern",
    "start": "793320",
    "end": "800880"
  },
  {
    "text": "versions of Windows um however the and the 500 account",
    "start": "800880",
    "end": "807680"
  },
  {
    "text": "itself if you inst install from dis the uh the latest version of",
    "start": "807680",
    "end": "814199"
  },
  {
    "text": "Windows is disabled by default when you sign in and create a new user you actually create a new local user that is",
    "start": "814199",
    "end": "820959"
  },
  {
    "text": "in the local admins group and by default both the guest and the local",
    "start": "820959",
    "end": "826839"
  },
  {
    "text": "administrator account are disabled however a lot of places still use them the only caveat to that is on server",
    "start": "826839",
    "end": "834160"
  },
  {
    "text": "2012 currently by default the 500 account is",
    "start": "834160",
    "end": "839360"
  },
  {
    "text": "the one that gets created and the UAC setting that's specifically for the 500",
    "start": "839360",
    "end": "845000"
  },
  {
    "text": "account is not enabled by default um the other problem with the",
    "start": "845000",
    "end": "850519"
  },
  {
    "text": "local admin accounts are that they're typically uh shared passwords across multiple machines if you're in an",
    "start": "850519",
    "end": "857199"
  },
  {
    "text": "environment where you image you have a gold standard that local account is then used uh",
    "start": "857199",
    "end": "864079"
  },
  {
    "text": "throughout um and uh like I mentioned earlier",
    "start": "864079",
    "end": "869600"
  },
  {
    "text": "uh we that last bullet was meant to be on the last slide oops so just to uh you know keep this",
    "start": "869600",
    "end": "877680"
  },
  {
    "text": "talk within the allotted time frame we really aren't going to talk about stuff like",
    "start": "877680",
    "end": "883800"
  },
  {
    "text": "uh domain cast credentials or token impersonation or services that have",
    "start": "883800",
    "end": "891000"
  },
  {
    "text": "configuration files that have plain text passwords or PL text passwords stored in",
    "start": "891000",
    "end": "896639"
  },
  {
    "text": "files on file servers or key loggers or",
    "start": "896639",
    "end": "902639"
  },
  {
    "text": "fishing or any of the other ways that are out there for people to gain",
    "start": "902639",
    "end": "908880"
  },
  {
    "text": "credentials bottom line is if someone gets onto one of your workstations there",
    "start": "908880",
    "end": "914320"
  },
  {
    "text": "are multiple Avenues they can use to get credentials to use on your network",
    "start": "914320",
    "end": "921079"
  },
  {
    "text": "attackers always take the path of least resistance once an attacker has system",
    "start": "921079",
    "end": "926759"
  },
  {
    "text": "level access on a box it's usually a matter of time minutes",
    "start": "926759",
    "end": "933360"
  },
  {
    "text": "hours days at the most before they have system on your domain controller and",
    "start": "933360",
    "end": "939639"
  },
  {
    "text": "then it seconds for them to gather everyone's hashes on your domain and then it's just completely over at that",
    "start": "939639",
    "end": "948319"
  },
  {
    "text": "point so all right so we have a bad problem",
    "start": "948880",
    "end": "956000"
  },
  {
    "text": "but how do we make it worse or how does Microsoft make it worse so uh two ways",
    "start": "956000",
    "end": "962839"
  },
  {
    "text": "that they they make it worse is by ensuring that the local admin password on every single machine is the same and",
    "start": "962839",
    "end": "969880"
  },
  {
    "text": "they did this in Server 2008 by introducing this really cool feature Group Policy preferences has anyone seen",
    "start": "969880",
    "end": "976399"
  },
  {
    "text": "gpps before anyone use them okay so they're actually really",
    "start": "976399",
    "end": "982440"
  },
  {
    "text": "power powerful that give you granular control of lots of settings uh but they do easily enable an admin to set the",
    "start": "982440",
    "end": "989959"
  },
  {
    "text": "same password across entire OS and across entire Enterprises uh another way that",
    "start": "989959",
    "end": "996440"
  },
  {
    "text": "Microsoft made this worse is with smart cards which I was part of an organization where Microsoft came in a",
    "start": "996440",
    "end": "1002880"
  },
  {
    "text": "consultant came in and tried to sell us on the security benefits of smart cards and one of the things that they sold us",
    "start": "1002880",
    "end": "1008720"
  },
  {
    "text": "on was that it would help mitigate the P the hash attack that was a decade ago",
    "start": "1008720",
    "end": "1014040"
  },
  {
    "text": "and of course the the Microsoft presenters went over the fact that it",
    "start": "1014040",
    "end": "1019240"
  },
  {
    "text": "actually makes it worse so let's start with Group Policy preference settings um",
    "start": "1019240",
    "end": "1024918"
  },
  {
    "text": "so this is what it looks like in uh group policy management editor so we're",
    "start": "1024919",
    "end": "1030038"
  },
  {
    "text": "going to rename the administrator account to don't hash me bro and set a",
    "start": "1030039",
    "end": "1035439"
  },
  {
    "text": "password and that's a really easy way to ensure that even if uh even if one of",
    "start": "1035480",
    "end": "1041798"
  },
  {
    "text": "your users has local admin rights they don't go and change the local admin password uh so a lot of people find find",
    "start": "1041799",
    "end": "1048280"
  },
  {
    "text": "it useful but what it actually does is makes it",
    "start": "1048280",
    "end": "1055240"
  },
  {
    "text": "really easy for an attacker by setting by renaming the account to something like Ms presenters and setting that",
    "start": "1055240",
    "end": "1060679"
  },
  {
    "text": "password we're able to get on one box and then move from that box to any other box with the same password and that's",
    "start": "1060679",
    "end": "1067720"
  },
  {
    "text": "essentially what pass the hash pass the hash is uh in the in its most common",
    "start": "1067720",
    "end": "1075320"
  },
  {
    "text": "form but actually gpp makes it even worse because the passwords are only ausc on",
    "start": "1075320",
    "end": "1082120"
  },
  {
    "text": "the domain controller and as skip talked about before the the actual machine account is a domain account and can",
    "start": "1082120",
    "end": "1089120"
  },
  {
    "text": "access the the the DC so uh Italian researcher released a",
    "start": "1089120",
    "end": "1094919"
  },
  {
    "text": "python tool to be able to decrypt it and actually found it's AES encrypted so it's not technically Opus skated it is",
    "start": "1094919",
    "end": "1101159"
  },
  {
    "text": "encrypted but it's encrypted with that 32 by key that was on uh TechNet post on",
    "start": "1101159",
    "end": "1108280"
  },
  {
    "text": "the subject so uh the tool that he released was in",
    "start": "1108280",
    "end": "1114520"
  },
  {
    "text": "Python which is cool but Python's not installed on uh windows by default but",
    "start": "1114520",
    "end": "1119880"
  },
  {
    "text": "Powershell is so I rewrote it as a uh Powershell function and release with the",
    "start": "1119880",
    "end": "1126360"
  },
  {
    "text": "talk is get decrypted C password so if you want to go grab an the the actual encrypted form pull it down and decrypt",
    "start": "1126360",
    "end": "1133520"
  },
  {
    "text": "it uh instantly with Powershell you can do that we're going to quickly demo what this look like to your Enterprise and we",
    "start": "1133520",
    "end": "1140799"
  },
  {
    "text": "did this from a a user standpoint targeted at admins obviously if you're a",
    "start": "1140799",
    "end": "1146039"
  },
  {
    "text": "pentester there are metlo modules for you to do this there are lots of other ways that you could accomplish this but",
    "start": "1146039",
    "end": "1151320"
  },
  {
    "text": "I want to show you how easy it is for a user to be able to do that so the the scenario is gpp is being enforced uh",
    "start": "1151320",
    "end": "1160440"
  },
  {
    "text": "this user who who Googled a little bit has figured out that he can get around",
    "start": "1160440",
    "end": "1165679"
  },
  {
    "text": "uh the actual restrictions on his use user account so he downloads get gpp",
    "start": "1165679",
    "end": "1171640"
  },
  {
    "text": "password and then uh he now has local",
    "start": "1171640",
    "end": "1176600"
  },
  {
    "text": "admin so we're going to start from the login so the account is normal.",
    "start": "1181320",
    "end": "1190480"
  },
  {
    "text": "user logs in sped",
    "start": "1190480",
    "end": "1194480"
  },
  {
    "text": "up so he's got this really cool tool that he uses at home that he wants to use here VNC which is uh everyone's",
    "start": "1197120",
    "end": "1204600"
  },
  {
    "text": "favorite remote access tool so he goes to try to install it and UAC stops him",
    "start": "1204600",
    "end": "1209919"
  },
  {
    "text": "which it should requires administrative credentials so he puts in his username and password because maybe he is an",
    "start": "1209919",
    "end": "1216360"
  },
  {
    "text": "admin but he doesn't have the rights so he needs to",
    "start": "1216360",
    "end": "1222360"
  },
  {
    "text": "elevate so with Group Policy preferences he's literally seconds away from being able to accomplish this and many other",
    "start": "1222360",
    "end": "1229200"
  },
  {
    "text": "devious things and we will show you how easy it",
    "start": "1229200",
    "end": "1234880"
  },
  {
    "text": "is so he can browse to uh to",
    "start": "1237760",
    "end": "1242919"
  },
  {
    "text": "GitHub and snag get gpp password uh this a script I wrote that's in power exploit",
    "start": "1242919",
    "end": "1250280"
  },
  {
    "text": "uh which is a really awesome Suite of power shell functions and scripts and modules written mostly by Matt Graber",
    "start": "1250280",
    "end": "1256240"
  },
  {
    "text": "and a couple other contributors uh to do offensive post exploitation on",
    "start": "1256240",
    "end": "1261480"
  },
  {
    "text": "boxes so the easiest way even if Powers shell is locked down the execution policy is in its default set setting see",
    "start": "1261480",
    "end": "1268559"
  },
  {
    "text": "he's that Powershell session is normal user it does not actually apply to the",
    "start": "1268559",
    "end": "1275400"
  },
  {
    "text": "Powershell interpreter that this live session that we're in so we can paste that function in and then just call it",
    "start": "1275400",
    "end": "1282200"
  },
  {
    "text": "and no matter what the settings are uh execution policy-wise this will reach out to the DC from the",
    "start": "1282200",
    "end": "1289720"
  },
  {
    "text": "box quickly search find everywhere that those passwords exist and return the",
    "start": "1289720",
    "end": "1295039"
  },
  {
    "text": "actual plain text usernames and passwords uh so as a pentester this has",
    "start": "1295039",
    "end": "1300159"
  },
  {
    "text": "been extremely useful over the last year and a half or year yeah year and a half",
    "start": "1300159",
    "end": "1305559"
  },
  {
    "text": "uh probably nine out of 10 times I'm able to find either old passwords or current ones for local admin rights so I",
    "start": "1305559",
    "end": "1312120"
  },
  {
    "text": "no longer really worry as much about when sending a fishing email whether or not I'll be able to escalate quickly uh",
    "start": "1312120",
    "end": "1318559"
  },
  {
    "text": "privilege escalation with gpp because it's so popular in Enterprises uh has made my job a lot",
    "start": "1318559",
    "end": "1324840"
  },
  {
    "text": "easier so now I can just log in as a local admin account and install the the software",
    "start": "1324840",
    "end": "1331080"
  },
  {
    "text": "that everyone wants on their Enterprise especially if you're security so the demo is focused at",
    "start": "1331080",
    "end": "1337799"
  },
  {
    "text": "admins uh we're going to throw this up on YouTube so if you want to show uh if you're a pentester and you want to show",
    "start": "1337799",
    "end": "1343880"
  },
  {
    "text": "how bad this is to someone quickly uh you can do it in less than three",
    "start": "1343880",
    "end": "1349120"
  },
  {
    "text": "minutes uh but the reality is as a pentester you'll be able to use this to",
    "start": "1349120",
    "end": "1354240"
  },
  {
    "text": "to move around pretty",
    "start": "1354240",
    "end": "1357240"
  },
  {
    "text": "quickly all right so we talked about Group Policy preferences who's actually deployed Group Policy",
    "start": "1365240",
    "end": "1370799"
  },
  {
    "text": "preferences so there there a couple people any pentesters seen it on pentest and used it couple of those as well all",
    "start": "1370799",
    "end": "1378600"
  },
  {
    "text": "right smart cards uh to be honest with you I've pested many many organizations",
    "start": "1378600",
    "end": "1384159"
  },
  {
    "text": "that have uh smart cards deployed and originally it was a very scary proposition they it it changes the way",
    "start": "1384159",
    "end": "1391159"
  },
  {
    "text": "that you have to look at things it breaks a lot of tools but in the end it actually makes it easier and and I'll",
    "start": "1391159",
    "end": "1397720"
  },
  {
    "text": "explain why uh one smart cards are great in that users don't have to remember",
    "start": "1397720",
    "end": "1403919"
  },
  {
    "text": "passwords so by checking that account smart card is required for interactive",
    "start": "1403919",
    "end": "1409559"
  },
  {
    "text": "login right there uh we get rid of the requirement for that user to have a",
    "start": "1409559",
    "end": "1414679"
  },
  {
    "text": "password unfortunately authentication on the back end really works essentially the same what you're looking at down",
    "start": "1414679",
    "end": "1421039"
  },
  {
    "text": "here is mimic hats from a smart card user who's interactively logged in using",
    "start": "1421039",
    "end": "1427520"
  },
  {
    "text": "their smart card and we've dumped that's their pass password in HEX uh which it",
    "start": "1427520",
    "end": "1434080"
  },
  {
    "text": "would be terrible to have to try to type that but it's easier to type the hash",
    "start": "1434080",
    "end": "1440080"
  },
  {
    "text": "because that's even shorter than the password and it's equivalent in most cases n hashes and ntlm V2 none of it",
    "start": "1440080",
    "end": "1450039"
  },
  {
    "text": "changes with the introduction of smart cards smart cards actually give an attacker an opportunity to persist a",
    "start": "1450039",
    "end": "1457400"
  },
  {
    "text": "unique way that wasn't present before uh with past the has Firefox which is what",
    "start": "1457400",
    "end": "1462919"
  },
  {
    "text": "you're looking at on the bottom here uh and and the fact that ant SSP",
    "start": "1462919",
    "end": "1469000"
  },
  {
    "text": "has been pushed out of the perimeter which is a lot of what we talked about last year you can now hit an Enterprise",
    "start": "1469000",
    "end": "1475880"
  },
  {
    "text": "dump all the domain hashes and then come back in hitting SharePoint or owwa using",
    "start": "1475880",
    "end": "1481799"
  },
  {
    "text": "those hashes even if they have smart card deployed the beauty of smart cards is that the passwords NE the hashes",
    "start": "1481799",
    "end": "1489000"
  },
  {
    "text": "themselves never change once the account has been configured it's not like service accounts that change at a random",
    "start": "1489000",
    "end": "1495480"
  },
  {
    "text": "interval or change at a a set interval those will remain the same so in a scenario where say an intern shows up at",
    "start": "1495480",
    "end": "1502440"
  },
  {
    "text": "a new company and they're given a smart card that that password hash in the",
    "start": "1502440",
    "end": "1508200"
  },
  {
    "text": "Enterprise no matter how much the Enterprise moves on the hash itself for",
    "start": "1508200",
    "end": "1513440"
  },
  {
    "text": "that actual user he could become the CEO eventually and have the same password he",
    "start": "1513440",
    "end": "1519080"
  },
  {
    "text": "had when he was an intern so 10 15 20 years later if something doesn't",
    "start": "1519080",
    "end": "1524279"
  },
  {
    "text": "drastically change that's really the scenario that that you could uh end up",
    "start": "1524279",
    "end": "1529840"
  },
  {
    "text": "with one other thing real quick about um about smart cards oh yeah you uh smart",
    "start": "1529840",
    "end": "1537600"
  },
  {
    "text": "card accounts while you can do password guesses on them they they do lock out",
    "start": "1537600",
    "end": "1543120"
  },
  {
    "text": "but as soon as somebody actually logs in successfully with the smart card they don't even get prompted that their",
    "start": "1543120",
    "end": "1549080"
  },
  {
    "text": "password account was locked out so because the smart card is considered a",
    "start": "1549080",
    "end": "1554600"
  },
  {
    "text": "stronger form of authentication than the username and password you essentially have unlimited guesses to those accounts",
    "start": "1554600",
    "end": "1561120"
  },
  {
    "text": "they will lock out for like ntlm but then once somebody logs into the smart",
    "start": "1561120",
    "end": "1566640"
  },
  {
    "text": "card it's game on again so um also the accounts don't",
    "start": "1566640",
    "end": "1572000"
  },
  {
    "text": "expire and we have actually been to an organization that is part of their uh",
    "start": "1572000",
    "end": "1578039"
  },
  {
    "text": "setup of a new account they when as soon as you click",
    "start": "1578039",
    "end": "1583159"
  },
  {
    "text": "that check boox it scrambles the password it assigns a random password they then went and assigned the same",
    "start": "1583159",
    "end": "1591120"
  },
  {
    "text": "password to every account for every smart card user that was on there so",
    "start": "1591120",
    "end": "1597399"
  },
  {
    "text": "when we dumped the hashes we ended up with 7,000 identical",
    "start": "1597399",
    "end": "1605000"
  },
  {
    "text": "hashes and what's worse was we cracked the password but so we didn't even have",
    "start": "1605440",
    "end": "1610480"
  },
  {
    "text": "to use the pass to Hash Y and and thanks to a information disclosure vulnerability within Windows when even",
    "start": "1610480",
    "end": "1616720"
  },
  {
    "text": "when an account gets locked out uh you get a message saying that your",
    "start": "1616720",
    "end": "1621880"
  },
  {
    "text": "account has been locked out when you successfully get the password so then you sit back and wait till they log in",
    "start": "1621880",
    "end": "1627880"
  },
  {
    "text": "and then you could come back in in this case it's not the password it's the hash realistically that that that attack's",
    "start": "1627880",
    "end": "1633440"
  },
  {
    "text": "probably never going to happen trying to guess an NTI has but uh the second but",
    "start": "1633440",
    "end": "1639000"
  },
  {
    "text": "if they do set the uh password afterwards right exactly uh that second scenario I've actually seen twice um and",
    "start": "1639000",
    "end": "1645919"
  },
  {
    "text": "I actually saw a documentation of a a third organ ganization during a pentest got on saw the documentation and was",
    "start": "1645919",
    "end": "1651360"
  },
  {
    "text": "able to tell them don't do this they had a plan to do it in the future where they would set the same password for all",
    "start": "1651360",
    "end": "1656399"
  },
  {
    "text": "accounts at regular intervals okay so in the talk yesterday and in Microsoft's white paper they they",
    "start": "1656399",
    "end": "1664360"
  },
  {
    "text": "gave three main mitigations I'm sorry to pick on you guys uh and they're really good mitigations restrict and protect",
    "start": "1664360",
    "end": "1671080"
  },
  {
    "text": "High privileged domain accounts uh restrict and protect local accounts with admin privileges and",
    "start": "1671080",
    "end": "1676720"
  },
  {
    "text": "restrict inbound traffic using Windows Firewall now the third one um I'd love for you if you're a Windows admin to",
    "start": "1676720",
    "end": "1683440"
  },
  {
    "text": "take that take the white paper and go to your network admin and tell them that you're going to deploy 10,000 non-",
    "start": "1683440",
    "end": "1690320"
  },
  {
    "text": "centrally managed firewalls on the network and record and put it on YouTube because I'm sure that's going to",
    "start": "1690320",
    "end": "1696960"
  },
  {
    "text": "be so what it boils down to for us when we read it uh was you know stay calm",
    "start": "1696960",
    "end": "1702880"
  },
  {
    "text": "pass the Hesh it's bad but it's not that bad and yeah eat your vegetables",
    "start": "1702880",
    "end": "1708559"
  },
  {
    "text": "so ours might be actually worse our mitigation is uh don't get",
    "start": "1708559",
    "end": "1714320"
  },
  {
    "text": "owned so if you don't get owned if an attacker is not able to quickly get to system and dump those hashes they can't",
    "start": "1715080",
    "end": "1722120"
  },
  {
    "text": "be used so restrict admin",
    "start": "1722120",
    "end": "1729200"
  },
  {
    "text": "privileges which is tough to do I know I I was a Windows admin uh but you you've",
    "start": "1729200",
    "end": "1734640"
  },
  {
    "text": "got to do it the point is you want to slow an attacker once they've got on they're going to get on fishing is going",
    "start": "1734640",
    "end": "1740240"
  },
  {
    "text": "to work your users are going to click on something there's always a new method that they're going to use so you need to",
    "start": "1740240",
    "end": "1746320"
  },
  {
    "text": "slow them to the point where you're able to detect that they're there and get them off before they get to uh domain",
    "start": "1746320",
    "end": "1754360"
  },
  {
    "text": "admin so one of the ways that it would be very painful I've never seen it um",
    "start": "1754360",
    "end": "1759840"
  },
  {
    "text": "but it would be very painful if someone set NFS uh file permissions on powershell.exe that would be very",
    "start": "1759840",
    "end": "1766240"
  },
  {
    "text": "upsetting to me as a pentester I've seen it on uh command. exe and uh uh net.exe",
    "start": "1766240",
    "end": "1773480"
  },
  {
    "text": "and a lot of that stuff is in the NSA Stig or whatever they're called uh guidance for hardening windows boxes I",
    "start": "1773480",
    "end": "1780799"
  },
  {
    "text": "don't think they've added Powershell um but that would really that would really slow me down and it would probably slow",
    "start": "1780799",
    "end": "1787240"
  },
  {
    "text": "other people down as well and you do want to patch all local privilege escalation bugs both Skip and I have",
    "start": "1787240",
    "end": "1792559"
  },
  {
    "text": "seen where organizations just focus on high and they don't worry about client side attacks and they think client side",
    "start": "1792559",
    "end": "1797840"
  },
  {
    "text": "is associated with email a lot of times client side attacks are also used as a part of privilege escalation to quickly",
    "start": "1797840",
    "end": "1804080"
  },
  {
    "text": "get up you you might have user on a box if you're able to exploit something that's running as as system as a system",
    "start": "1804080",
    "end": "1809799"
  },
  {
    "text": "service uh you definitely want to look at all advisories and think about how it",
    "start": "1809799",
    "end": "1815120"
  },
  {
    "text": "could be used against you and then uh patch",
    "start": "1815120",
    "end": "1820840"
  },
  {
    "text": "them biggest thing is you don't want to make it easy for them either use UAC",
    "start": "1820840",
    "end": "1826000"
  },
  {
    "text": "it's a pain in the butt and it's uh to use and it's really not that big of a",
    "start": "1826000",
    "end": "1831240"
  },
  {
    "text": "deal for an attacker to get around it but I don't know if you know the the most common way that attackers get",
    "start": "1831240",
    "end": "1836360"
  },
  {
    "text": "around UAC requires dropping a binary which is something for a lot of pentesters and attackers we don't want",
    "start": "1836360",
    "end": "1842840"
  },
  {
    "text": "to drop a binary on the disk we want to avoid that completely so to use like the metas sploit bypass UAC module it's",
    "start": "1842840",
    "end": "1850360"
  },
  {
    "text": "actually dropping uh dll to dis so that's good we're forcing them to do something uh that that gives you the",
    "start": "1850360",
    "end": "1857039"
  },
  {
    "text": "opportunity to detect it uh don't gpp is awesome for a lot of",
    "start": "1857039",
    "end": "1862679"
  },
  {
    "text": "other granular uh changes on machines to enforce that but don't use it to set",
    "start": "1862679",
    "end": "1869200"
  },
  {
    "text": "passwords if you can get away with disabling the 500 account I don't see why you can't uh but do it get rid of it",
    "start": "1869200",
    "end": "1876080"
  },
  {
    "text": "entirely uh obviously don't use credentials and startup scripts or any",
    "start": "1876080",
    "end": "1881159"
  },
  {
    "text": "scripts that are stored on the the DC you're going to have admins do silly",
    "start": "1881159",
    "end": "1887120"
  },
  {
    "text": "things like this so occasionally check for it and don't save service account passwords on workstations including",
    "start": "1887120",
    "end": "1892840"
  },
  {
    "text": "admin workstations in text files ultimately what we're trying to do is protect the crown jewels the crown",
    "start": "1892840",
    "end": "1899159"
  },
  {
    "text": "jewels are being protected by your DC your DC might be the crown jewels for a",
    "start": "1899159",
    "end": "1904919"
  },
  {
    "text": "pentester but your crown jewels as an organization is your data if they're able to get on your DC they can pivot",
    "start": "1904919",
    "end": "1911320"
  },
  {
    "text": "from your DC and the credentials there to get to anything uh if you've got your",
    "start": "1911320",
    "end": "1916880"
  },
  {
    "text": "Enterprise virtual ized you need to protect your backups and your virtual machines with the same amount of effort",
    "start": "1916880",
    "end": "1922760"
  },
  {
    "text": "as you put into the DCS a lot of really strong organizations spend a lot of time",
    "start": "1922760",
    "end": "1928039"
  },
  {
    "text": "on the DC itself and then leave backup sitting on you know $100 Best Buy",
    "start": "1928039",
    "end": "1933159"
  },
  {
    "text": "purchased uh network attached storage devices which we have seen and I've",
    "start": "1933159",
    "end": "1940360"
  },
  {
    "text": "absolutely seen that more than once and I've downloaded the hard drive files for a DC before and then mounted it in my",
    "start": "1940360",
    "end": "1947200"
  },
  {
    "text": "copy of VM where and then just went to town so it's nice to have a backup copy",
    "start": "1947200",
    "end": "1953240"
  },
  {
    "text": "of the DC to play with all right yep it's fun to rejoin that to the",
    "start": "1953240",
    "end": "1959279"
  },
  {
    "text": "Enterprise and just maintain it outside of their their Network for a while what is all this crazy replication traffic",
    "start": "1959279",
    "end": "1965799"
  },
  {
    "text": "all right so everyone has too many Enterprise admins domain admins all right who's got 50 domain admins or",
    "start": "1965799",
    "end": "1975039"
  },
  {
    "text": "more who's got 25 domain admins who's lying yeah you're there's so many",
    "start": "1975039",
    "end": "1981240"
  },
  {
    "text": "liars in here who's got who's got one domain admin on their",
    "start": "1981240",
    "end": "1986519"
  },
  {
    "text": "Enterprise who doesn't know how many exactly how many PE how many people are",
    "start": "1986519",
    "end": "1992840"
  },
  {
    "text": "in the local administrators group for the domain controller because those are all domain",
    "start": "1992840",
    "end": "1998919"
  },
  {
    "text": "admin equivalent accounts so it's lots of fun to check that out where you have like nested help desk accounts there",
    "start": "1998919",
    "end": "2006159"
  },
  {
    "text": "where those guys are all domain admins so why do why do people end up with",
    "start": "2006159",
    "end": "2011760"
  },
  {
    "text": "domain admin why do service accounts why does that happen because it's the easiest way to solve a problem just give",
    "start": "2011760",
    "end": "2017320"
  },
  {
    "text": "them the Privileges and let it go and that makes it really easy for an attacker to move",
    "start": "2017320",
    "end": "2023919"
  },
  {
    "text": "around so you really can't be lazy uh I didn't want to expose that I've",
    "start": "2023919",
    "end": "2030639"
  },
  {
    "text": "done this uh but I'm going to do it anyway I used to be in the military uh",
    "start": "2030639",
    "end": "2037279"
  },
  {
    "text": "for almost 12 years and in that time I was told a lot of what I would do each",
    "start": "2037279",
    "end": "2042639"
  },
  {
    "text": "day and as a Windows admin a lot of times I would have a major tell me you",
    "start": "2042639",
    "end": "2048638"
  },
  {
    "text": "will Sergeant you will add these people to The Domain admins group and I never ever wanted to do that because I knew",
    "start": "2048639",
    "end": "2055320"
  },
  {
    "text": "that they didn't belong there so what I decided to do is follow his orders explicitly which were add them to The",
    "start": "2055320",
    "end": "2062398"
  },
  {
    "text": "Domain administrators group so I created a domain administrators group",
    "start": "2062399",
    "end": "2069638"
  },
  {
    "text": "and then I added them to that and then I took it one step forward and I actually went in and explicitly denied them",
    "start": "2070760",
    "end": "2077158"
  },
  {
    "text": "privileges to do things like move and OU or create accounts delete accounts so I",
    "start": "2077159",
    "end": "2082960"
  },
  {
    "text": "had a whole group of of restrictions but that can bite you in the butt in a couple ways one if you leave the",
    "start": "2082960",
    "end": "2088398"
  },
  {
    "text": "organization so I left and then you come back and then you actually need domain admin rights and they stick you in the",
    "start": "2088399",
    "end": "2095240"
  },
  {
    "text": "domain administrators group",
    "start": "2095240",
    "end": "2099320"
  },
  {
    "text": "yep so that that happened the other thing that can happen is that uh someone could think",
    "start": "2100839",
    "end": "2107800"
  },
  {
    "text": "they're being smart and Nest the actual domain admins group into the the",
    "start": "2107800",
    "end": "2113160"
  },
  {
    "text": "restricted deny privileged uh domain administrators group in which case no one can do anything and the entire",
    "start": "2113160",
    "end": "2119480"
  },
  {
    "text": "Enterprise has to be rebuilt so don't do that all right so this is uh basically e",
    "start": "2119480",
    "end": "2126720"
  },
  {
    "text": "or vegetable type uh advice issue multiple accounts to",
    "start": "2126720",
    "end": "2131839"
  },
  {
    "text": "admins uh I I really one of the my biggest pet peeves and I'm sure a lot of",
    "start": "2131839",
    "end": "2137520"
  },
  {
    "text": "people in here agree is if you're browsing the internet with iie as a domain admin you you a",
    "start": "2137520",
    "end": "2144839"
  },
  {
    "text": "shouldn't have domain admin privileges who just said who said",
    "start": "2144839",
    "end": "2150520"
  },
  {
    "text": "that I might agree with that but I was asked not to say that",
    "start": "2150520",
    "end": "2156400"
  },
  {
    "text": "um so so that's pretty common advice uh managing tokens I went against an",
    "start": "2156400",
    "end": "2162680"
  },
  {
    "text": "organization that was really good at this uh Microsoft has some steps that ways that they're going to implement",
    "start": "2162680",
    "end": "2167960"
  },
  {
    "text": "restricting tokens uh and their usefulness in future versions of windows so after you you go through upgrading",
    "start": "2167960",
    "end": "2174680"
  },
  {
    "text": "from XP to Windows 7 and then eventually you know whenever 8 nine years from now",
    "start": "2174680",
    "end": "2180119"
  },
  {
    "text": "you move to the next version of Windows that'll be taken care of until then you you might want to uh pay attention to",
    "start": "2180119",
    "end": "2186920"
  },
  {
    "text": "token management accounts create tokens elevated accounts create tokens on boxes most of the time I see this in",
    "start": "2186920",
    "end": "2192680"
  },
  {
    "text": "vulnerability scanners or we see this in vulnerability scanners they they use uh maffy was a recent example they use a",
    "start": "2192680",
    "end": "2199760"
  },
  {
    "text": "vulnerability scanner to scan their Enterprise with a domain admin credential or an elevated credential",
    "start": "2199760",
    "end": "2204960"
  },
  {
    "text": "that token's created on every single box because of the way it's authenticating you get on one box through a pentest use",
    "start": "2204960",
    "end": "2211680"
  },
  {
    "text": "gpp or however you get to system on that box and Bam you have a DA token and your attack lasted seconds for you to to own",
    "start": "2211680",
    "end": "2219119"
  },
  {
    "text": "an Enterprise uh pay attention to how you log out of RDP actually log out don't",
    "start": "2219119",
    "end": "2224720"
  },
  {
    "text": "just close it cuz that'll leave an actual token in and uh one of the hardest organizations I've ever pent",
    "start": "2224720",
    "end": "2230720"
  },
  {
    "text": "tested every admin anytime they use credentials they went and ask before they did it which seems insane but it",
    "start": "2230720",
    "end": "2235800"
  },
  {
    "text": "worked for them when they did it they immediately logged out regardless of what the server was that included domain",
    "start": "2235800",
    "end": "2242480"
  },
  {
    "text": "controllers which still seems insane to me but they kept their tokens to a minimum and it took weeks to find a",
    "start": "2242480",
    "end": "2249960"
  },
  {
    "text": "token that was useful and it took weeks to actually uh escalate privileges on that",
    "start": "2249960",
    "end": "2256079"
  },
  {
    "text": "Network all right so we still got time so uh we've just talked at you for for",
    "start": "2256079",
    "end": "2262160"
  },
  {
    "text": "over 35 minutes so we're not going to leave you hanging we going give you some scripts that uh if pentesters you can",
    "start": "2262160",
    "end": "2268680"
  },
  {
    "text": "point organizations in the right direction uh most of these out of the box aren't hugely useful but this one is",
    "start": "2268680",
    "end": "2277280"
  },
  {
    "text": "um what this one's going to do first off this is Powershell who's used Powershell",
    "start": "2277280",
    "end": "2282359"
  },
  {
    "text": "before awesome uh if you haven't used Powershell you should there are lots of great books lots of documentation out",
    "start": "2282359",
    "end": "2288800"
  },
  {
    "text": "there it's immensely useful for pentesters as well as Windows admins obviously Windows admins and forensic",
    "start": "2288800",
    "end": "2295040"
  },
  {
    "text": "people in this case this is how easy it is uh we're to reset every password hash",
    "start": "2295040",
    "end": "2301760"
  },
  {
    "text": "so we can prevent that persistence problem where the hashes stay the same and it's got some drawbacks and",
    "start": "2301760",
    "end": "2307880"
  },
  {
    "text": "Microsoft uh said that this doesn't scale you be the judge uh I think it's a",
    "start": "2307880",
    "end": "2312920"
  },
  {
    "text": "effective way to to mitigate the risk of the persistence problem with smart cards we're just going to import the active",
    "start": "2312920",
    "end": "2320720"
  },
  {
    "text": "directory module there create an array of users that actually have that account",
    "start": "2320720",
    "end": "2325800"
  },
  {
    "text": "have that setting set pretty simple so now 80 users uh has all the accounts",
    "start": "2325800",
    "end": "2332760"
  },
  {
    "text": "that have that setting and then we're going to go through and do a easy for",
    "start": "2332760",
    "end": "2338079"
  },
  {
    "text": "each for Loop through and toggle the setting wait a second toggle it back that's going to randomly generate a new",
    "start": "2338079",
    "end": "2343839"
  },
  {
    "text": "password for that user it is going to kill all their live sessions any active sessions they have at that point but if",
    "start": "2343839",
    "end": "2350280"
  },
  {
    "text": "you schedule this maybe every 90 days you you can certainly mitigate the risk of that uh I know for a fact that a",
    "start": "2350280",
    "end": "2358040"
  },
  {
    "text": "couple of uh sites that I've pent tested are actively doing this uh one got a little overeager and was like setting it",
    "start": "2358040",
    "end": "2364760"
  },
  {
    "text": "to run every day every other day I wouldn't recommend that uh they had lots of replication issues after that uh",
    "start": "2364760",
    "end": "2373800"
  },
  {
    "text": "another way to mitigate uh the local admin the the traditional pass the hash which I like to think of like pass the",
    "start": "2373800",
    "end": "2380160"
  },
  {
    "text": "hash Firefox where you've dumped all the domain hashes as kind of a different attack because you have the all the",
    "start": "2380160",
    "end": "2385359"
  },
  {
    "text": "hashes this way most people think of pass the hash as a lateral privilege",
    "start": "2385359",
    "end": "2390400"
  },
  {
    "text": "escalation across a network so to kind of slow that down uh we released and all",
    "start": "2390400",
    "end": "2395760"
  },
  {
    "text": "this stuff is online um on the the black hat site since they didn't send out CDs this year set unique password it's kind",
    "start": "2395760",
    "end": "2403000"
  },
  {
    "text": "of a start I don't really like I wouldn't want every organization to start using this because if everyone's",
    "start": "2403000",
    "end": "2408920"
  },
  {
    "text": "using the same principle eventually people will figure out a way around it and move on but this is just an idea",
    "start": "2408920",
    "end": "2414319"
  },
  {
    "text": "with different ways that I that I wrote uh skip requested that we Generate random passwords which is cool and a lot",
    "start": "2414319",
    "end": "2421560"
  },
  {
    "text": "of random password generators they they generate passwords of a uh static length so if you're actually doing doing",
    "start": "2421560",
    "end": "2427480"
  },
  {
    "text": "password cracking which is a hobby of both of ours uh knowing the ecstatic length of all passwords makes it",
    "start": "2427480",
    "end": "2432800"
  },
  {
    "text": "actually easier to crack so this this sets uh random variable lengths of those",
    "start": "2432800",
    "end": "2438000"
  },
  {
    "text": "random pseudo random passwords it's not actually random uh there's a built-in method within Powershell to do that uh I",
    "start": "2438000",
    "end": "2446280"
  },
  {
    "text": "wouldn't recommend example one as well uh unless you have to because we're outing all the plan text passwords to a",
    "start": "2446280",
    "end": "2452880"
  },
  {
    "text": "spreadsheet uh that would be dangerous if left available to some one uh and",
    "start": "2452880",
    "end": "2458920"
  },
  {
    "text": "different use cases for it you can pipe you could read from a file pipe it in it'll go through and set all those",
    "start": "2458920",
    "end": "2464319"
  },
  {
    "text": "passwords um then this was uh and I took this from two different clients that",
    "start": "2464319",
    "end": "2470599"
  },
  {
    "text": "were doing this um I didn't come up with any of these ideas but basically they took a phrase a past phrase and they",
    "start": "2470599",
    "end": "2477160"
  },
  {
    "text": "appended it to something that was unique to each machine so they had all Del computers so there was an actual serial",
    "start": "2477160",
    "end": "2482319"
  },
  {
    "text": "number with uh within the the bio settings in the registry so they",
    "start": "2482319",
    "end": "2487520"
  },
  {
    "text": "actually pulled out the serial number and then they they appended it to the phrase so then it was like it's not",
    "start": "2487520",
    "end": "2493920"
  },
  {
    "text": "multiactor authentication at all but it just set a unique password on every single box so the code to do all that is",
    "start": "2493920",
    "end": "2500280"
  },
  {
    "text": "in this function uh you can prepend append uh you can look at it there are",
    "start": "2500280",
    "end": "2506079"
  },
  {
    "text": "other ways to to to do unique characteristics Mac addresses host names IP addresses I would tend to stay away",
    "start": "2506079",
    "end": "2512680"
  },
  {
    "text": "from those cuz an attacker could get them off the network and eventually uh script out being being able to to move",
    "start": "2512680",
    "end": "2518480"
  },
  {
    "text": "around laterally that way but that's out there which may be helpful for uh some",
    "start": "2518480",
    "end": "2524760"
  },
  {
    "text": "of your clients if you're a pentester or your organization but detection of pass the hash is actually uh really easy um",
    "start": "2524760",
    "end": "2533560"
  },
  {
    "text": "there's a right way to do it and there's a wrong way so let's go over the wrong way which I've seen uh you could write",
    "start": "2533560",
    "end": "2538640"
  },
  {
    "text": "tools to detect you could write signatures for every pass the hash tool that's out there the one the pass the",
    "start": "2538640",
    "end": "2545280"
  },
  {
    "text": "hash tools that Skip and I use are not the same as what's out there and I think anyone who's a pentester probably has",
    "start": "2545280",
    "end": "2552040"
  },
  {
    "text": "unique variations of the tools so the signatures aren't going to match so I",
    "start": "2552040",
    "end": "2557079"
  },
  {
    "text": "wrote three examples of stuff that I've seen written in network signatures before uh and those are find PS exac",
    "start": "2557079",
    "end": "2564160"
  },
  {
    "text": "service find uh the metlo PS exac service and find wi exac and this is",
    "start": "2564160",
    "end": "2569720"
  },
  {
    "text": "what it looks like it gives you the host name that it came from the username that was used and when when it was actually",
    "start": "2569720",
    "end": "2575920"
  },
  {
    "text": "used and what this is doing is going through the actual local logs the event log and and pulling out signatures from",
    "start": "2575920",
    "end": "2581680"
  },
  {
    "text": "the event log that this was happened so this is detection it it's not prevention",
    "start": "2581680",
    "end": "2586800"
  },
  {
    "text": "so here's what it looks like for one of them this is find msf PS XX service so",
    "start": "2586800",
    "end": "2593200"
  },
  {
    "text": "we're finding the the event ID which is The Modern event ID they changed them up in I think uh Windows 7 uh 2008 so it's",
    "start": "2593200",
    "end": "2601480"
  },
  {
    "text": "got a pretty interesting signature that uh Rob Fuller changed he added an option within the mesy module so that that you",
    "start": "2601480",
    "end": "2607280"
  },
  {
    "text": "can change the service name but the service always starts with m and it's always that length of an exe so probably",
    "start": "2607280",
    "end": "2615480"
  },
  {
    "text": "you know you could have some false positives with with this signature it's not the greatest signature in the world",
    "start": "2615480",
    "end": "2620599"
  },
  {
    "text": "but that's pretty likely to be a PS exact Service uh",
    "start": "2620599",
    "end": "2626040"
  },
  {
    "text": "start um so that's what that is and that's full of fail for for multiple",
    "start": "2626040",
    "end": "2632040"
  },
  {
    "text": "reasons a like Rob changed the the the module you can set the service name to",
    "start": "2632040",
    "end": "2637599"
  },
  {
    "text": "be whatever you want so that's not going to detect it and if you think that this is actually detecting every P the hash",
    "start": "2637599",
    "end": "2644440"
  },
  {
    "text": "or every uh account use you you're really going to be lulled into a false sense of uh security so",
    "start": "2644440",
    "end": "2652319"
  },
  {
    "text": "instead let's monitor for the actual activity itself and if you walked around",
    "start": "2652319",
    "end": "2657680"
  },
  {
    "text": "the vendor Booth uh area there are actually several products that are doing uh similar things that can all be",
    "start": "2657680",
    "end": "2663920"
  },
  {
    "text": "accomplished with with relatively simple Powershell scripts uh so what we're looking for",
    "start": "2663920",
    "end": "2670599"
  },
  {
    "text": "specifically is ntlm Network logins so this little function which that's all it",
    "start": "2670599",
    "end": "2675640"
  },
  {
    "text": "is right there is going to use uh an XPath filter which I did a lot of testing um and this is looking for the",
    "start": "2675640",
    "end": "2682880"
  },
  {
    "text": "older ID or no that's that's the modern one no that's the older one uh which",
    "start": "2682880",
    "end": "2689599"
  },
  {
    "text": "still works xath filters uh for the get win event uh Windows commandlet the the",
    "start": "2689599",
    "end": "2696720"
  },
  {
    "text": "document m mentation is not really out there you see it's kind of that query is kind of weird looking so I had to play",
    "start": "2696720",
    "end": "2702160"
  },
  {
    "text": "with that to get it just right but it's actually near instant so you could have gigs so I generated an event log that",
    "start": "2702160",
    "end": "2709440"
  },
  {
    "text": "was actually uh 15 gigs just I I subscribed to all the machines dropped",
    "start": "2709440",
    "end": "2715680"
  },
  {
    "text": "it into one and created this huge event log and I I really wanted to put myself in an admin shoes like can I actually",
    "start": "2715680",
    "end": "2721400"
  },
  {
    "text": "use this not just throw together something that that works on my one Demo Box and a lot of the documentation",
    "start": "2721400",
    "end": "2728280"
  },
  {
    "text": "that's out there um like in the Powershell cookbook is great but it it really wasn't as fast as I I wanted it",
    "start": "2728280",
    "end": "2735079"
  },
  {
    "text": "to be so I settled on the XA filter there and that actually in multiple gig",
    "start": "2735079",
    "end": "2740920"
  },
  {
    "text": "uh vent logs returns near instantly um which is great it's a lot faster than a",
    "start": "2740920",
    "end": "2746480"
  },
  {
    "text": "lot of people recommend for looping through each event looking for this stuff which takes hours especially when",
    "start": "2746480",
    "end": "2753800"
  },
  {
    "text": "if you're trying to push this out over the network so I think that's pretty useful I've been pushing that out to my clients and they they've been",
    "start": "2753800",
    "end": "2760640"
  },
  {
    "text": "happy so now we can find past the hash and additionally we pick up Insider",
    "start": "2760640",
    "end": "2765760"
  },
  {
    "text": "threats where accounts have been used elevated accounts have been used maybe outside uh so one of the things that you",
    "start": "2765760",
    "end": "2774079"
  },
  {
    "text": "can do because this is returning objects you can play with them uh and this is a pretty good string to use we want to get",
    "start": "2774079",
    "end": "2780079"
  },
  {
    "text": "rid of anonymous login is going to show up all over the place so get rid of that anybody know what that is that host name",
    "start": "2780079",
    "end": "2787960"
  },
  {
    "text": "or that one that's the randomly generated host name used by the Met exploit PS exact",
    "start": "2787960",
    "end": "2794920"
  },
  {
    "text": "module so that's bad uh so what you can do with this is",
    "start": "2794920",
    "end": "2801000"
  },
  {
    "text": "you can pipe it uh with send mail message which is a Powershell commandlet that easily lets you send uh emails and",
    "start": "2801000",
    "end": "2809920"
  },
  {
    "text": "you can schedule this as a task um in one case one of my uh customers was able to to set this up to pretty good success",
    "start": "2809920",
    "end": "2817280"
  },
  {
    "text": "where they have it running daily you might want it um more more regular than",
    "start": "2817280",
    "end": "2822440"
  },
  {
    "text": "that and they have it emailing out checking running through the log looking for elevated use and then they audit",
    "start": "2822440",
    "end": "2829680"
  },
  {
    "text": "just these elevated use so this is elevated use over ntlm which is most",
    "start": "2829680",
    "end": "2834920"
  },
  {
    "text": "commonly going to be an attacker and that brings us to the uh",
    "start": "2834920",
    "end": "2842200"
  },
  {
    "text": "the question slide uh the surveys if you scan your badge on the way out that would be great the the feedback we got",
    "start": "2842200",
    "end": "2848400"
  },
  {
    "text": "from last year was was immensely helpful um so we would definitely appreciate",
    "start": "2848400",
    "end": "2853839"
  },
  {
    "text": "that we'd like to thank all the uh acuant Labs guys uh Martin Eric Tom um",
    "start": "2853839",
    "end": "2859760"
  },
  {
    "text": "I'd like to thank my boss JP for helping me get out here and Matt Graber Lee",
    "start": "2859760",
    "end": "2865200"
  },
  {
    "text": "Holmes who I was hoping would be here and then uh Carlos Perez and all the",
    "start": "2865200",
    "end": "2870319"
  },
  {
    "text": "other poers shell ninjas that help me uh come up with those functions and make them better and uh Princess where are",
    "start": "2870319",
    "end": "2876480"
  },
  {
    "text": "you yeah yeah you're here uh anyone have any",
    "start": "2876480",
    "end": "2882480"
  },
  {
    "text": "questions sure there there's a mic behind you you",
    "start": "2882480",
    "end": "2887799"
  },
  {
    "text": "can thank",
    "start": "2887920",
    "end": "2891119"
  },
  {
    "text": "you great talk thanks I was curious if um in a large architecture the value of",
    "start": "2894400",
    "end": "2899920"
  },
  {
    "text": "readon domain controllers and any of this as a mitigation approach uh read",
    "start": "2899920",
    "end": "2905079"
  },
  {
    "text": "only domain controllers are especially I think they're mostly useful in physical",
    "start": "2905079",
    "end": "2910400"
  },
  {
    "text": "security scenarios where uh as a a full scope pentester I I've been able to gain",
    "start": "2910400",
    "end": "2917520"
  },
  {
    "text": "access to facilities that were less secure than other facilities and gain physical access to a domain controller for it to be a readon domain controller",
    "start": "2917520",
    "end": "2924440"
  },
  {
    "text": "that only gives you access to the credentials of the users that are there which which is a really good step so I",
    "start": "2924440",
    "end": "2930200"
  },
  {
    "text": "think that that's very important when you're looking at physical security but as far as past the hash uh r domain",
    "start": "2930200",
    "end": "2937240"
  },
  {
    "text": "controllers don't ensure that the they don't enforce authentication from users",
    "start": "2937240",
    "end": "2942920"
  },
  {
    "text": "that are there and that uh site a user can explicitly authenticate against the",
    "start": "2942920",
    "end": "2948240"
  },
  {
    "text": "DC itself so it really doesn't stop or slow down it might trip up uh a novice",
    "start": "2948240",
    "end": "2953520"
  },
  {
    "text": "attacker that's not familiar with modern and a lot of training doesn't include that so if they've gone through you know",
    "start": "2953520",
    "end": "2959359"
  },
  {
    "text": "basic uh I I don't want to say that so basic training that teaches pentesters",
    "start": "2959359",
    "end": "2966440"
  },
  {
    "text": "probably how not to be a pestor or how to be a pestor 10 years ago then they're probably going to run into that and not know what to do but anyone that knows",
    "start": "2966440",
    "end": "2973559"
  },
  {
    "text": "what they're doing is going to realize it's a read only domain controller good on you for having that and then actually",
    "start": "2973559",
    "end": "2979319"
  },
  {
    "text": "ask for the PDC emulator go straight at the heart of the Enterprise and move on",
    "start": "2979319",
    "end": "2984799"
  },
  {
    "text": "are there any other questions we're going to be uh Skip and I are both going to head over to the AC event booth and",
    "start": "2984799",
    "end": "2991520"
  },
  {
    "text": "we're going to be over there hanging out answering questions so if you didn't want to ask it in a public setting we'll be there uh thanks for coming and enjoy",
    "start": "2991520",
    "end": "2999240"
  },
  {
    "text": "black hat",
    "start": "2999240",
    "end": "3002559"
  }
]