[
  {
    "text": "hey I'd like to welcome all you guys to Augustus 5 for a speech called",
    "start": "0",
    "end": "6080"
  },
  {
    "text": "Thunderbolt: Adventures in Thunderbolt DMA attacks by Russ Sinsky hope you guys",
    "start": "6080",
    "end": "11120"
  },
  {
    "text": "are excited about this as I am it's going to be a great talk going to turn it over to [Music]",
    "start": "11120",
    "end": "18289"
  },
  {
    "text": "Russ thank you thank you hi again my name is Russ Savinsky i'm a security",
    "start": "20600",
    "end": "27439"
  },
  {
    "text": "researcher with ISC Partners i'm also a father a husband and a musician i love",
    "start": "27439",
    "end": "34880"
  },
  {
    "text": "learning i love taking stuff apart figuring out how it works um and I feel",
    "start": "34880",
    "end": "40000"
  },
  {
    "text": "like that's the best way to really learn something um I feel like going through contrived",
    "start": "40000",
    "end": "45520"
  },
  {
    "text": "labs and kind of leading you down to the answer um is great on learning um a",
    "start": "45520",
    "end": "51280"
  },
  {
    "text": "specific um technology but it's it's not the way to kind of get a a great grasp",
    "start": "51280",
    "end": "56960"
  },
  {
    "text": "of of what you're looking at so I just like taking stuff apart that's kind of what I do so um that's why we're here",
    "start": "56960",
    "end": "63039"
  },
  {
    "text": "today we're here to talk about um the Thunderbolt technology uh going through a practical reverse engineering exercise",
    "start": "63039",
    "end": "70479"
  },
  {
    "text": "um of Thunderbolt and also looking at how it relates to DMA attacks so",
    "start": "70479",
    "end": "77960"
  },
  {
    "text": "um I focused primarily on Apple hardware so the Intel stuff I strayed away from",
    "start": "77960",
    "end": "85759"
  },
  {
    "text": "mostly because uh there were some uh bigger mitigations on the Intel stuff the uh the Apple stuff's not quite there",
    "start": "85759",
    "end": "92240"
  },
  {
    "text": "yet so um we're going to kind of focus on Apple specifically so in order to get",
    "start": "92240",
    "end": "97759"
  },
  {
    "text": "a deeper understanding of uh what we um are looking at we are going to need some",
    "start": "97759",
    "end": "103439"
  },
  {
    "text": "background information so just at a high level we need to know what is Thunderbolt and what is DMA we mentioned",
    "start": "103439",
    "end": "108720"
  },
  {
    "text": "that was the goal uh was a Thunderbolt DMA attack so what is Thunderbolt and what is DMA um Thunderbolt is Apple and",
    "start": "108720",
    "end": "116320"
  },
  {
    "text": "Intel's joint effort to combine a high-speed datab bus and display port all on one expansion port so no more",
    "start": "116320",
    "end": "124079"
  },
  {
    "text": "having to get an HDMI cable and then a USB3 cable it's all on one expansion port um the basis it funnels down into",
    "start": "124079",
    "end": "132400"
  },
  {
    "text": "PCI Express so already we're starting to kind of pick out some technologies we're",
    "start": "132400",
    "end": "137440"
  },
  {
    "text": "going to need to start looking at so PCI Express being one um since we're focusing on DMA uh we're going to stick",
    "start": "137440",
    "end": "143760"
  },
  {
    "text": "primarily to the um uh serial uh data speed connection so what is DMA uh it",
    "start": "143760",
    "end": "150319"
  },
  {
    "text": "stands for direct memory access and back in the day um when a device",
    "start": "150319",
    "end": "156160"
  },
  {
    "text": "needed to access memory uh it did something what's called programmed IO and so what happened was the uh device",
    "start": "156160",
    "end": "162319"
  },
  {
    "text": "would contact the processor processor um would take the address that it wanted it would store it in a register then it",
    "start": "162319",
    "end": "168239"
  },
  {
    "text": "would go fetch that memory come back and so the the processor was the bottleneck the the processor or not the bottleneck",
    "start": "168239",
    "end": "173599"
  },
  {
    "text": "the the middleman um and as the processor became faster devices still stayed slow So the processor would have",
    "start": "173599",
    "end": "180640"
  },
  {
    "text": "to wait around for the request to be finished by the device and it just was a horrible performance hit so what the",
    "start": "180640",
    "end": "186879"
  },
  {
    "text": "engineers decided to do was well let's just have the device contact the memory directly and allow the processor to",
    "start": "186879",
    "end": "193200"
  },
  {
    "text": "continue on doing what it needs to do so that was the",
    "start": "193200",
    "end": "197920"
  },
  {
    "text": "solution so just thinking about that why would these external buses matter uh for",
    "start": "199959",
    "end": "205680"
  },
  {
    "text": "us as security experts well I mean the biggest reason is if I have uh direct",
    "start": "205680",
    "end": "211680"
  },
  {
    "text": "access to your memory externally um on an external bus on the computer that",
    "start": "211680",
    "end": "217280"
  },
  {
    "text": "sounds pretty serious that there's some you know RAM consequences that I can I can pull memory out so um users uh may",
    "start": "217280",
    "end": "225200"
  },
  {
    "text": "be affected another thing is the field of digital forensics um we have a problem to solve we have a mystery we",
    "start": "225200",
    "end": "230959"
  },
  {
    "text": "want to solve and we have a a bad guy's laptop that has full disc encryption and we need to get the encryption key off so",
    "start": "230959",
    "end": "236640"
  },
  {
    "text": "we can start to solve this mystery we can use um these types of accesses to grab those keys out of memory uh and",
    "start": "236640",
    "end": "243920"
  },
  {
    "text": "also digital rights management um we can pull um we can pull",
    "start": "243920",
    "end": "250000"
  },
  {
    "text": "information off of the bus but um manufacturers might use bus encryption they may encrypt that that traffic going",
    "start": "250000",
    "end": "255920"
  },
  {
    "text": "back and forth so that makes it difficult for us to to check that out so those are some main reasons why external buses matter uh current DMA research",
    "start": "255920",
    "end": "263840"
  },
  {
    "text": "obviously I'm not the first one to ever be doing DMA attacks um so uh there's a",
    "start": "263840",
    "end": "270479"
  },
  {
    "text": "paper or a presentation called IO attacks and Intel architectures and countermeasures this presentation is",
    "start": "270479",
    "end": "276960"
  },
  {
    "text": "great it goes through all of the types of IO attacks that can be done and talks about DMA and gets uh really low level",
    "start": "276960",
    "end": "284000"
  },
  {
    "text": "into a lot of stuff so I highly recommend that uh presentation for those um who want to see that also",
    "start": "284000",
    "end": "289520"
  },
  {
    "text": "understanding DMA malware it's a great paper uh it goes through the way you can",
    "start": "289520",
    "end": "294960"
  },
  {
    "text": "take um a DMA you could take uh information and put it onto Intel's ME um platform and",
    "start": "294960",
    "end": "302960"
  },
  {
    "text": "you can actually run a key logger in on the hardware itself so uh pretty",
    "start": "302960",
    "end": "308479"
  },
  {
    "text": "interesting current Thunderbolt attacks we're talking about Thunderbolt so we should probably figure out if that's even possible um it is possible dma",
    "start": "308479",
    "end": "315600"
  },
  {
    "text": "attacks through Thunderbolt are definitely possible and they're they exist they're they're easy to do so the",
    "start": "315600",
    "end": "320720"
  },
  {
    "text": "way you would do that is uh currently you would um daisy chain um Thunderbolt through FireWire and you would use a",
    "start": "320720",
    "end": "327039"
  },
  {
    "text": "program called Inception and Inception allows you to um perform DMA attacks through FireWire it's based off the lib",
    "start": "327039",
    "end": "333280"
  },
  {
    "text": "forensics 1394 uh Python library and it allows you to run a DMA attack through",
    "start": "333280",
    "end": "339919"
  },
  {
    "text": "FireWire you thunder you daisy chain that through Thunderbolt and now you can pull off uh PCI DMA attacks through",
    "start": "339919",
    "end": "346240"
  },
  {
    "text": "FireWire daisy chain to Thunderbolt so also the deto",
    "start": "346240",
    "end": "351639"
  },
  {
    "text": "javs I'm sorry to snare if I pronounced that incorrectly but this paper was",
    "start": "351639",
    "end": "357360"
  },
  {
    "text": "awesome this was basically a Mac uh EFI rootkit so we're going to talk about",
    "start": "357360",
    "end": "362639"
  },
  {
    "text": "this process a little later but um when your when your computer boots up and your PCI Express bus goes to enumerate",
    "start": "362639",
    "end": "369280"
  },
  {
    "text": "everything it pulls expansion ROMs from devices and on those um expansion ROMs you can put an EFI program and that will",
    "start": "369280",
    "end": "377120"
  },
  {
    "text": "execute on the device before the operating system even loads so that is a great way to get um root kits in so",
    "start": "377120",
    "end": "384800"
  },
  {
    "text": "mitigations to a lot of this stuff i mean this this is sounding pretty scary um epoxy you can always glue your ports",
    "start": "384800",
    "end": "391600"
  },
  {
    "text": "shut uh no one can get into your ports and steal your memory but now you can't",
    "start": "391600",
    "end": "397280"
  },
  {
    "text": "use your ports so uh maybe we can think of something a little better how about an input output memory management unit",
    "start": "397280",
    "end": "402800"
  },
  {
    "text": "an MMU uh you think of these as virtual memory for your devices so your device",
    "start": "402800",
    "end": "409120"
  },
  {
    "text": "uh plugs in it actually gets a virtual memory address the virtual memory address is translated to the physical",
    "start": "409120",
    "end": "414880"
  },
  {
    "text": "memory address through the MMU hardware and also this so this not only gives you",
    "start": "414880",
    "end": "420400"
  },
  {
    "text": "an abstraction layer between your memory uh with virtual memory but it also allows you to set up um almost like",
    "start": "420400",
    "end": "426560"
  },
  {
    "text": "access controls for uh sections of memory and for devices so you can lock these down um from accessing certain",
    "start": "426560",
    "end": "433360"
  },
  {
    "text": "types of memories um also secure configurations you um Apple has some",
    "start": "433360",
    "end": "439039"
  },
  {
    "text": "configurations that you can do to prevent the FireWire attacks um while the computer is locked uh the problem",
    "start": "439039",
    "end": "445120"
  },
  {
    "text": "with that is the computer if the person's logged in then the attack is still available so this still doesn't",
    "start": "445120",
    "end": "452080"
  },
  {
    "text": "stop social engineering attacks from hey this my device isn't quite working on my laptop can I just try it on yours real",
    "start": "452080",
    "end": "457199"
  },
  {
    "text": "quick see if if I can get that squared away um so these these attacks definitely exist and so it turns out",
    "start": "457199",
    "end": "463199"
  },
  {
    "text": "that there is a way for us to bypass memory and continue on with our research so DMA stuff is um definitely prevalent",
    "start": "463199",
    "end": "470880"
  },
  {
    "text": "in Thunderbolt uh so in order for us to get through reverse engineering we're",
    "start": "470880",
    "end": "476560"
  },
  {
    "text": "going to need to get down to some of the underlying protocols we were talking about PCI Express being the main one uh",
    "start": "476560",
    "end": "481840"
  },
  {
    "text": "we mentioned that PCI Express um is kind of the underlying bus structure that's funnels down from Thunderbolt so um",
    "start": "481840",
    "end": "488879"
  },
  {
    "text": "we're going to need to understand that a little better so this is going to be a crash course in PCI Express um this uh",
    "start": "488879",
    "end": "496479"
  },
  {
    "text": "specification is a beast so uh I'll try and go as quick as I can and get through this um uh if if we run out of time and",
    "start": "496479",
    "end": "503199"
  },
  {
    "text": "there's no time for questions uh come and see me afterwards and we can go through it a little more uh so PCI Express it's a high-speed data bus um uh",
    "start": "503199",
    "end": "511919"
  },
  {
    "text": "it's it's serial so no longer using parallel anymore uh data uh uh sent via",
    "start": "511919",
    "end": "517120"
  },
  {
    "text": "lanes and so a lane is made up of um two simplex lines uh two simplex uh data",
    "start": "517120",
    "end": "524800"
  },
  {
    "text": "data paths one um transmit one receive and then each of those is made up of uh",
    "start": "524800",
    "end": "530640"
  },
  {
    "text": "two differential pairs a differential pair is uh one signal going uh positive and then another signal the exact",
    "start": "530640",
    "end": "537040"
  },
  {
    "text": "opposite going negative and what happens is when the two signals get to the device they compare the difference and",
    "start": "537040",
    "end": "543839"
  },
  {
    "text": "this is really great for interference if interference happens on the the lines um",
    "start": "543839",
    "end": "549200"
  },
  {
    "text": "it should affect both lines and so you can just take the difference and pull that out um and obviously we have the",
    "start": "549200",
    "end": "555040"
  },
  {
    "text": "transmit and receive pairs so those four lines will make up a single lane or uh",
    "start": "555040",
    "end": "560640"
  },
  {
    "text": "by one PCI Express um per the PCI SIG specification you the minimum amount of",
    "start": "560640",
    "end": "567200"
  },
  {
    "text": "wires needed for PCI Express is four uh single lane PCI Express only needs four",
    "start": "567200",
    "end": "572399"
  },
  {
    "text": "wires i thought that was really interesting um a reference clock uh is optional it's not required and you can",
    "start": "572399",
    "end": "578399"
  },
  {
    "text": "get away with a 2.5 GHz oscillator um with plus or minus 300",
    "start": "578399",
    "end": "585760"
  },
  {
    "text": "ppm so um when we're doing our reverse engineering most manufacturers will do",
    "start": "585880",
    "end": "592320"
  },
  {
    "text": "six wire just because it's easier to throw in um a reference clock and it makes it a little more stable uh but PCI",
    "start": "592320",
    "end": "598480"
  },
  {
    "text": "Express can definitely handle without one um different device types we have endpoints switches and hubs I'm sorry",
    "start": "598480",
    "end": "604800"
  },
  {
    "text": "switches and bridges and uh the root complex so endpoints um are basically your devices you have a legacy device",
    "start": "604800",
    "end": "612000"
  },
  {
    "text": "and or legacy endpoint and a native endpoint native endpoints are what's coming out nowadays um 64-bit uh",
    "start": "612000",
    "end": "618160"
  },
  {
    "text": "addressing there's a little bit of um permissions that are kind of locked down to which memory locations you can and",
    "start": "618160",
    "end": "623680"
  },
  {
    "text": "can't do uh legacy devices on the other hand allow you to actually do um IO",
    "start": "623680",
    "end": "629200"
  },
  {
    "text": "reads and writes um as well as memory reads and writes you can also do what are called locked transactions which means um you can lock the bus while",
    "start": "629200",
    "end": "636480"
  },
  {
    "text": "you're using it and no other devices can use the bus um back to the PCI days that",
    "start": "636480",
    "end": "641920"
  },
  {
    "text": "was important for um bus arbitration um more per um and so moving on the um data",
    "start": "641920",
    "end": "650480"
  },
  {
    "text": "is sent over packets similar it's analogous to TCP IP um they are called",
    "start": "650480",
    "end": "656240"
  },
  {
    "text": "transaction layer packets or TLPS um it's also uses a pointto-point uh",
    "start": "656240",
    "end": "661440"
  },
  {
    "text": "topology so there's no more bus arbitration like we talked about earlier in the PCI days uh you'd have to set a",
    "start": "661440",
    "end": "666720"
  },
  {
    "text": "line high to um request access and another line would go high when you get you granted permission from the",
    "start": "666720",
    "end": "672000"
  },
  {
    "text": "arbitrator this isn't the case you can just use the bus whenever you need to use the bus uh native devices aren't",
    "start": "672000",
    "end": "677360"
  },
  {
    "text": "allowed to lock it so other devices can use it legacy devices can lock the bus um and packets are routed by address",
    "start": "677360",
    "end": "684560"
  },
  {
    "text": "this is sounding a lot like TCP IP but this is memory address and so what'll happen is devices will travel through",
    "start": "684560",
    "end": "690800"
  },
  {
    "text": "the PCI Express fabric and uh based on their address um it will get routed to",
    "start": "690800",
    "end": "695839"
  },
  {
    "text": "the correct device peer-to-peer um communication is also possible because of this we give an address of the device",
    "start": "695839",
    "end": "702079"
  },
  {
    "text": "that we want to talk to it'll travel through and get to it u any memory addresses that are RAM based are going",
    "start": "702079",
    "end": "708160"
  },
  {
    "text": "through the root complex so the root complex it is a logical grouping of um",
    "start": "708160",
    "end": "714959"
  },
  {
    "text": "of circuitry that will connect uh the PCI Express bus to the CPU and memory i",
    "start": "714959",
    "end": "721120"
  },
  {
    "text": "say logical because there's multiple ways to implement this you can implement this um on your north bridge directly",
    "start": "721120",
    "end": "726720"
  },
  {
    "text": "you can implement this as a separate chipset you can implement this as as multiple chipsets uh it all depends uh",
    "start": "726720",
    "end": "732000"
  },
  {
    "text": "on the manufacturer what they want to do so in this image you can see the root complex being in the center um also",
    "start": "732000",
    "end": "737680"
  },
  {
    "text": "notice the switch that has a bunch of uh devices hooked up to it so in that example if a uh the device on the left",
    "start": "737680",
    "end": "745120"
  },
  {
    "text": "wanted to contact the device on the right it would send out a TLP with the address of that device it would get to",
    "start": "745120",
    "end": "750560"
  },
  {
    "text": "the switch and the switch would say \"Oh I have that over on this port i'm going to send it out here.\" It doesn't even need to traverse up to the root complex",
    "start": "750560",
    "end": "757040"
  },
  {
    "text": "um also with bridges legacy devices can send um old school packets through",
    "start": "757040",
    "end": "762160"
  },
  {
    "text": "they'll get translated into the correct u protocol and sent through um so we",
    "start": "762160",
    "end": "768880"
  },
  {
    "text": "talked about this a little bit earlier with the MAC EFI rootkit paper um devices um are enumerated through an",
    "start": "768880",
    "end": "774399"
  },
  {
    "text": "enumeration process for PCI Express so we start out um bus zero device zero",
    "start": "774399",
    "end": "780240"
  },
  {
    "text": "function zero bus zero is most always your root complex so we start at the root complex we start at the very first",
    "start": "780240",
    "end": "786079"
  },
  {
    "text": "device and the very first function we say is there anyone there uh if a device comes back and says yes I'm here then",
    "start": "786079",
    "end": "792639"
  },
  {
    "text": "the next question is are you a bridge or are you an endpoint if it's a bridge it'll go down and traverse down through",
    "start": "792639",
    "end": "799839"
  },
  {
    "text": "that bridge and start the process all over again enumerating all the devices there if it's an endpoint it'll uh tag",
    "start": "799839",
    "end": "805120"
  },
  {
    "text": "it with an ID and an address and it'll pull information from its PCI expansion ROM and load it into the configuration",
    "start": "805120",
    "end": "811600"
  },
  {
    "text": "space um if it's a hot plug device and you've already booted up the machine you just plug in that hot plug device and",
    "start": "811600",
    "end": "818079"
  },
  {
    "text": "there's two wires present one and present two these get um these get connected and now the enumeration",
    "start": "818079",
    "end": "824399"
  },
  {
    "text": "process happens but just for that one port it doesn't happen through the whole bus all over again uh the expansion ROMs",
    "start": "824399",
    "end": "830560"
  },
  {
    "text": "on the devices are what stores this information so when you plug in you get an ID and an address uh you start a new",
    "start": "830560",
    "end": "837120"
  },
  {
    "text": "uh you start pulling that information from the device ROMs so that was PCI",
    "start": "837120",
    "end": "843639"
  },
  {
    "text": "Express um now as far as reverse engineering all of this um I love taking stuff apart i",
    "start": "843639",
    "end": "851600"
  },
  {
    "text": "am not a professional reverse engineer i just love looking at stuff i love learning so I just like taking stuff",
    "start": "851600",
    "end": "858079"
  },
  {
    "text": "apart i don't have um the the best equipment but what I do have got me a",
    "start": "858079",
    "end": "863920"
  },
  {
    "text": "long way so I'd like to just share that with uh some of the uh EES out there and and uh maybe some of the hobbyists who",
    "start": "863920",
    "end": "870560"
  },
  {
    "text": "want to get into some of this stuff uh some of the tools that I used um a multimeter a multimeter is amazing",
    "start": "870560",
    "end": "876320"
  },
  {
    "text": "especially for the continuity testing feature we're able to touch different wires together and um and different",
    "start": "876320",
    "end": "883680"
  },
  {
    "text": "traces and different VAS and trace where signal is flowing uh for those who",
    "start": "883680",
    "end": "888800"
  },
  {
    "text": "aren't familiar a via is a way for and we'll kind of kind of touch on this in a little bit a via is a way for um a PCB",
    "start": "888800",
    "end": "896000"
  },
  {
    "text": "layer at top to talk to a PCB layer further down and vice versa so if I have a PCB and I have a layer up top and I",
    "start": "896000",
    "end": "902079"
  },
  {
    "text": "have a layer on the bottom um and a a VIA will allow me to drop down and do that that makes the um the board",
    "start": "902079",
    "end": "908959"
  },
  {
    "text": "development process really easy for manufacturers because they don't have to try and keep all of their designs constrained to one side um and then you",
    "start": "908959",
    "end": "916480"
  },
  {
    "text": "have a list of usual suspects you got your solder station heat gun reflow stuff desoldering tools for heating up",
    "start": "916480",
    "end": "922000"
  },
  {
    "text": "the board um desoldering chips uh soldering things um those all come in",
    "start": "922000",
    "end": "927360"
  },
  {
    "text": "really handy an Ethernet cable ethernet cable not because we're going to be doing any Ethernet stuff but if you cut",
    "start": "927360",
    "end": "932880"
  },
  {
    "text": "this one of two things will happen you can get the um one of the eight wires",
    "start": "932880",
    "end": "937920"
  },
  {
    "text": "just take that and you um if it's a solid wire you can wrap those around your multimeter and now your multimeter",
    "start": "937920",
    "end": "943440"
  },
  {
    "text": "is that much smaller and you can get into areas uh that you couldn't with big bulky multimeter uh leads also the other",
    "start": "943440",
    "end": "950639"
  },
  {
    "text": "thing if the um as we'll see a little early or a little later um the wires if",
    "start": "950639",
    "end": "956320"
  },
  {
    "text": "they're made up of strands you can take that strand out and cut it and you can actually solder into those VAS that we",
    "start": "956320",
    "end": "962079"
  },
  {
    "text": "talked about earlier and start sniffing some of the traffic on there epoxy epoxy",
    "start": "962079",
    "end": "967120"
  },
  {
    "text": "again epoxy is quickly becoming my favorite reverse engineering tool uh for this stuff uh I picked this tip up from",
    "start": "967120",
    "end": "973600"
  },
  {
    "text": "a buddy of mine Mike Warner uh we would take apart uh USB thumb drives uh for because the case was too big and it",
    "start": "973600",
    "end": "979600"
  },
  {
    "text": "wouldn't fit and then we would just put epoxy over everything to keep it solid epoxy is not conductive so we don't have",
    "start": "979600",
    "end": "985920"
  },
  {
    "text": "to worry about electronic shorting out and it's a great protector um the other thing it can do is if you have really",
    "start": "985920",
    "end": "991759"
  },
  {
    "text": "small leads and you want to get some wires on there if you're if you're just right and you put enough pressure on",
    "start": "991759",
    "end": "997600"
  },
  {
    "text": "there you can push the wires on there and glue them together so you can actually glue the wires um with epoxy",
    "start": "997600",
    "end": "1003839"
  },
  {
    "text": "directly to the leads and do some sniffing as well uh logic analyzer this is crucial for figuring out what's going",
    "start": "1003839",
    "end": "1009519"
  },
  {
    "text": "on on the board what uh protocols are being used uh what buses are are sending data when and an image editor um I use",
    "start": "1009519",
    "end": "1017360"
  },
  {
    "text": " because it's free and um but you can use anything this is great for",
    "start": "1017360",
    "end": "1022560"
  },
  {
    "text": "taking an image of the board taking image of the other side of the board and then comparing in the image editor by",
    "start": "1022560",
    "end": "1028160"
  },
  {
    "text": "flipping and watching where leads go uh so this is a really great way to um to reverse engineer uh so let's go through",
    "start": "1028160",
    "end": "1035839"
  },
  {
    "text": "the process this is the process I took for reverse engineering uh the Thunderbolt",
    "start": "1035839",
    "end": "1041600"
  },
  {
    "text": "technology so just pick a product we'll take it apart we're going to locate the",
    "start": "1041600",
    "end": "1047199"
  },
  {
    "text": "important IC's on this chip we're going to um locate all of the wires that",
    "start": "1047199",
    "end": "1052799"
  },
  {
    "text": "connect to all of them and see how they're interconnected then we'll look for data sheets for all of those chips",
    "start": "1052799",
    "end": "1057840"
  },
  {
    "text": "figure out what those pins are actually set up for and what they're meant to do and then we'll sniff those buses and",
    "start": "1057840",
    "end": "1063840"
  },
  {
    "text": "develop a map of our Thunderbolt technology and how it all works so I chose two devices uh the",
    "start": "1063840",
    "end": "1070080"
  },
  {
    "text": "first device was the um Buffalo Ministation uh Thunderbolt USB 3 hard",
    "start": "1070080",
    "end": "1075760"
  },
  {
    "text": "drive this has a really great form factor for reverse engineering this kind of stuff it's it's nice and big um it",
    "start": "1075760",
    "end": "1082080"
  },
  {
    "text": "has really um it has really I'm I'm gonna say big because it's in it's big in comparison to the other device I",
    "start": "1082080",
    "end": "1088480"
  },
  {
    "text": "chose but um has a um big area for VAS to solder in you can see the chips",
    "start": "1088480",
    "end": "1094480"
  },
  {
    "text": "clearly it's it's a really great form factor for that kind of stuff um it also has USB3 which I thought would be a",
    "start": "1094480",
    "end": "1100559"
  },
  {
    "text": "really interesting attack if we can start uh tweaking some of these chips and pulling information out uh through",
    "start": "1100559",
    "end": "1106320"
  },
  {
    "text": "TLP packets and writing those uh to a USB3 thumb drive i mean obviously it's a hard drive but if we want to put some",
    "start": "1106320",
    "end": "1113120"
  },
  {
    "text": "more um malicious um technology in this device and take that hard drive out um",
    "start": "1113120",
    "end": "1118240"
  },
  {
    "text": "we could put a USB3 thumb drive in there and route it so that that we just kind of thinking out loud that might be a",
    "start": "1118240",
    "end": "1123520"
  },
  {
    "text": "really cool attack scenario um and the Apple Thunderbolt to Gigabit Ethernet adapter this thing was a nightmare to",
    "start": "1123520",
    "end": "1129840"
  },
  {
    "text": "reverse engineer these things are are tiny i mean and and with good reason i mean you want consumers to have a nice",
    "start": "1129840",
    "end": "1135440"
  },
  {
    "text": "quick adapter they can plug in and go um and they look nice you know so that that's that's why they're super small",
    "start": "1135440",
    "end": "1141600"
  },
  {
    "text": "but it doesn't make it nice for us as reverse engineers to look at this stuff so so we'll start with the hard drive um",
    "start": "1141600",
    "end": "1147120"
  },
  {
    "text": "a nononte has an amazing tearown of this high-res images um really detailed",
    "start": "1147120",
    "end": "1153440"
  },
  {
    "text": "information on it and they've also um picked out all of the IC's for us so",
    "start": "1153440",
    "end": "1158559"
  },
  {
    "text": "that part of the um reverse engineering is done we already know all the chips on there all the interesting ones anyways",
    "start": "1158559",
    "end": "1164720"
  },
  {
    "text": "uh the main ones on there the uh MLDDU3 uh that's the USB to SATA controller and",
    "start": "1164720",
    "end": "1172000"
  },
  {
    "text": "so just thinking about this as a hard drive we know we're going to have SATA connecting to our hard drive we have USB3 and Thunderbolt as the input so now",
    "start": "1172000",
    "end": "1180000"
  },
  {
    "text": "looking at the chips we have a USB 3 to SATA controller so we start building our two paths one for USB 3 down to SATA and",
    "start": "1180000",
    "end": "1186400"
  },
  {
    "text": "one to Thunderbolt down to SATA and this chip kind of solves that mystery it's USB3 to controller controller to SATA",
    "start": "1186400",
    "end": "1193200"
  },
  {
    "text": "we're done so that leg is pretty much taken care of with that chip also have an ASM 1061 this is the PCI Express to",
    "start": "1193200",
    "end": "1199679"
  },
  {
    "text": "SATA controller again Thunderbolt based on PC uh using PCI Express uh you can",
    "start": "1199679",
    "end": "1205760"
  },
  {
    "text": "start building that path out now it's you know PCI Express to SATA and then some other technology up to the",
    "start": "1205760",
    "end": "1211760"
  },
  {
    "text": "Thunderbolt controller which leads us to our next chip the DSL 2210 this is the Intel Thunderbolt chip this also code",
    "start": "1211760",
    "end": "1218799"
  },
  {
    "text": "name is Peak Ridge um it is going to be connected directly to the Thunderbolt",
    "start": "1218799",
    "end": "1224960"
  },
  {
    "text": "controller and just kind of at a high level we can start seeing okay so Thunderbolt U connector uh controller",
    "start": "1224960",
    "end": "1231840"
  },
  {
    "text": "PCI Express SATA hard drive so we're starting to build that path out so now we have the USB3 path and the",
    "start": "1231840",
    "end": "1237280"
  },
  {
    "text": "Thunderbolt path then we have an LPC114 it's a ARM Cortex processor",
    "start": "1237280",
    "end": "1243760"
  },
  {
    "text": "um not really quite sure what this is doing here a nontech thinks that it's to switch between USB 3 and SATA but we've",
    "start": "1243760",
    "end": "1251280"
  },
  {
    "text": "already identified those paths and how they interact so it that's basically just um setting wires high and and",
    "start": "1251280",
    "end": "1258159"
  },
  {
    "text": "voltages so we really don't think that that's the solution but we're not quite sure what that is yet so we need to keep",
    "start": "1258159",
    "end": "1263280"
  },
  {
    "text": "digging deeper here's an image of the front of the board and as you can see just at visual inspection you can start",
    "start": "1263280",
    "end": "1270400"
  },
  {
    "text": "taking a look at some of these um right there are our three three out of our four main IC's the one on the upper left",
    "start": "1270400",
    "end": "1277360"
  },
  {
    "text": "is our USB3 controller the one in the middle is our Thunderbolt controller and the one on the right is our PCI Express",
    "start": "1277360",
    "end": "1283039"
  },
  {
    "text": "controller we also have um a couple SPI ROMs that um are on the board uh excuse",
    "start": "1283039",
    "end": "1289320"
  },
  {
    "text": "me visual inspection kind of says okay the one on the top left is going to be related to the USB3 controller the one",
    "start": "1289320",
    "end": "1296480"
  },
  {
    "text": "in the uh the top right is going to be related to the PCI Express controller so we can start picking out um what ROMs we",
    "start": "1296480",
    "end": "1302720"
  },
  {
    "text": "can start looking at also we have some interesting header rows set up here so these might be interesting these may be",
    "start": "1302720",
    "end": "1307840"
  },
  {
    "text": "JTAG uh headers they may be um I think it'd be really crazy if there was a um a",
    "start": "1307840",
    "end": "1314960"
  },
  {
    "text": "root shell on a hard drive um probably not the case but we you never know so let's uh we'll keep those in our back",
    "start": "1314960",
    "end": "1321440"
  },
  {
    "text": "pocket and kind of continue on flipping the board over um you notice we identify uh the fourth chip the ARM Cortex uh any",
    "start": "1321440",
    "end": "1328960"
  },
  {
    "text": "ROMs on this we notice there's one over here visual inspection just looking at this side we don't see any chips around",
    "start": "1328960",
    "end": "1335760"
  },
  {
    "text": "it although if we flip the board around uh in this image you'll see a big grouping of resistors uh right above",
    "start": "1335760",
    "end": "1342080"
  },
  {
    "text": "that and that's the other that's the bottom end of the Thunderbolt controller so all those resistors being you know",
    "start": "1342080",
    "end": "1347120"
  },
  {
    "text": "pulled uh pulled high or pulled low uh for power and such so this may be the",
    "start": "1347120",
    "end": "1352640"
  },
  {
    "text": "ROM for Thunderbolt we're not quite sure uh visual inspection doesn't show any direct VAS to it uh putting the board on",
    "start": "1352640",
    "end": "1359520"
  },
  {
    "text": "its side we noticed this board only has three layers so that's great for us as reverse engineers um it'd be ideal if it",
    "start": "1359520",
    "end": "1366240"
  },
  {
    "text": "was just two but most manufacturers may do eight or nine i mean it all depends on on how they're going to uh design",
    "start": "1366240",
    "end": "1373120"
  },
  {
    "text": "their boards but this allows us to do most of our our inspection visually and if we have anything that's interesting",
    "start": "1373120",
    "end": "1378880"
  },
  {
    "text": "that we can't quite find a continuity tester will help us to resolve that and since it's a single board in the middle",
    "start": "1378880",
    "end": "1385679"
  },
  {
    "text": "we shouldn't have to worry too much about speculation on where it's going so let's start looking at our PCI Express",
    "start": "1385679",
    "end": "1391679"
  },
  {
    "text": "controller it's a PCI excuse me PCI Express to SATA",
    "start": "1391679",
    "end": "1397440"
  },
  {
    "text": "controller um we're going to try and look for some data sheets so we can figure out what is going on and try to",
    "start": "1397440",
    "end": "1402799"
  },
  {
    "text": "identify all the ROMs and flashes on it this thing didn't have any direct uh",
    "start": "1402799",
    "end": "1408640"
  },
  {
    "text": "data sheets available that stuff was kept confidential that wasn't available on on Google or BYU or anything what I",
    "start": "1408640",
    "end": "1416320"
  },
  {
    "text": "was able to find though was a motherboard manufacturer thought it would be really great if they took all",
    "start": "1416320",
    "end": "1422720"
  },
  {
    "text": "of the chips that they used and they made pin outs of them and put them in the user manual for their motherboard so",
    "start": "1422720",
    "end": "1430080"
  },
  {
    "text": "I was able to find the pin outs for the ASM 1061 by finding a motherboard um",
    "start": "1430080",
    "end": "1435760"
  },
  {
    "text": "user sheet which I thought was pretty interesting uh but in this you can see it might be hard to see from the image",
    "start": "1435760",
    "end": "1441840"
  },
  {
    "text": "the um top middle is all of our PCI Express lines so we can start mapping",
    "start": "1441840",
    "end": "1448480"
  },
  {
    "text": "out where those are going based on our data sheet um in looking at this image you can see two nice big fat lanes",
    "start": "1448480",
    "end": "1456880"
  },
  {
    "text": "coming down um in between the um PCI Express port and Thunderbolt uh and also",
    "start": "1456880",
    "end": "1463279"
  },
  {
    "text": "if you see there's a big fat one looping around on the side uh looking at the data sheet we see that those are our PCI",
    "start": "1463279",
    "end": "1469200"
  },
  {
    "text": "Express lines so there's our transmit and receive going um up and down and there's a reference clock coming over on",
    "start": "1469200",
    "end": "1474640"
  },
  {
    "text": "the side uh you may also notice that uh there's two um there's two crystals on",
    "start": "1474640",
    "end": "1480159"
  },
  {
    "text": "this device one for the P one for the PCI Express one and also one going into Thunderbolt uh and that would make sense",
    "start": "1480159",
    "end": "1487360"
  },
  {
    "text": "because the Thunderbolt connector doesn't really have a reference clock and if P if Thunderbolt's doing PCI Express it's going to have a reference",
    "start": "1487360",
    "end": "1494320"
  },
  {
    "text": "clock coming out to the AS media so that's going to be a 2.5 GHz uh reference clock and that's going to be",
    "start": "1494320",
    "end": "1500960"
  },
  {
    "text": "traveling around on that um on that looping uh lines down to the AS media so",
    "start": "1500960",
    "end": "1507039"
  },
  {
    "text": "already we're starting to build a map we're starting to uh build a pin out of Thunderbolt um this is an image of the",
    "start": "1507039",
    "end": "1513520"
  },
  {
    "text": "board uh the chip desoldered and me kind of tracing in some of the lines coming",
    "start": "1513520",
    "end": "1519200"
  },
  {
    "text": "in with different colors this is where our image editor comes in handy so we've already identified seven of the pins for",
    "start": "1519200",
    "end": "1524480"
  },
  {
    "text": "the Thunderbolt controller uh all the PCI Express uh transmit stuff and also a PCI",
    "start": "1524480",
    "end": "1530200"
  },
  {
    "text": "reset um so maybe we can patch this ROM and do some DMA attacks through the PCI",
    "start": "1530200",
    "end": "1537080"
  },
  {
    "text": "Express ROM this although this in theory would be possible turns out this ROM is",
    "start": "1537080",
    "end": "1542960"
  },
  {
    "text": "actually a PCI Express expansion ROM so um if we can if we can send out some",
    "start": "1542960",
    "end": "1549360"
  },
  {
    "text": "malicious code on this that's a possibility uh but doing an actual DMA attack may not be the case with with",
    "start": "1549360",
    "end": "1556159"
  },
  {
    "text": "changing that um also if we were able to find the flash um on the ASM 1061 we",
    "start": "1556159",
    "end": "1563120"
  },
  {
    "text": "could pull that off and possibly look for bugs in that and exploit those but we're going to keep that in our back",
    "start": "1563120",
    "end": "1568799"
  },
  {
    "text": "pocket um and we're going to continue on looking for other things kind of digging a little deeper um now we move on to the",
    "start": "1568799",
    "end": "1574320"
  },
  {
    "text": "LPC1 1114 this is the ARM Cortex that we saw earlier we're not quite sure what",
    "start": "1574320",
    "end": "1579360"
  },
  {
    "text": "it's used for um this model of ARM has tons of information online so finding a",
    "start": "1579360",
    "end": "1585200"
  },
  {
    "text": "data sheet is not a problem um it does connect directly to Thunderbolt though uh and how do I know that",
    "start": "1585200",
    "end": "1594200"
  },
  {
    "text": "i'm able to just by visual inspection check out the lines coming out and they kind of drop into VAS in this pattern if",
    "start": "1594400",
    "end": "1601919"
  },
  {
    "text": "we continue looking on flipping the board on the other side we can see those same VAS popping up coming into Thunderbolt uh so with our little image",
    "start": "1601919",
    "end": "1609039"
  },
  {
    "text": "editing magic maybe hard to see in this image but we can kind of flop those two together and set a direct connection so",
    "start": "1609039",
    "end": "1615840"
  },
  {
    "text": "now that we have data sheets for our ARM let's go ahead and figure out what these are looks like two of them are I squared",
    "start": "1615840",
    "end": "1622400"
  },
  {
    "text": "C so for those who are not familiar I squared C is a um a bus for transferring",
    "start": "1622400",
    "end": "1627440"
  },
  {
    "text": "for two chips communicating with each other so looks like the ARM and the Thunderbolt controller are communicating via I squared C we can add those two",
    "start": "1627440",
    "end": "1634559"
  },
  {
    "text": "pins to our pin out for Thunderbolt um next we'll move on to Thunderbolt a DSL 2210 this has no data",
    "start": "1634559",
    "end": "1643279"
  },
  {
    "text": "sheets available online it's promotional information only um maybe we can find",
    "start": "1643279",
    "end": "1648400"
  },
  {
    "text": "some ROMs and flashes we noticed there was that one uh ROM sitting on the other side um this is where our continuity",
    "start": "1648400",
    "end": "1654640"
  },
  {
    "text": "testing comes in handy we're able to do our continuity test from the SPI lines",
    "start": "1654640",
    "end": "1660960"
  },
  {
    "text": "on the ROM into some lines going into Thunderbolt and so those are traveling on the middle plane so we're able to",
    "start": "1660960",
    "end": "1668320"
  },
  {
    "text": "find out this definitely is the ROM for Thunderbolt so not only do we know we have some code we can look at we also",
    "start": "1668320",
    "end": "1673600"
  },
  {
    "text": "know that we have four more pins that we can add to our list of um pins for",
    "start": "1673600",
    "end": "1678919"
  },
  {
    "text": "Thunderbolt um and so we kind of do this process we start developing this map of of how all these things are working",
    "start": "1678919",
    "end": "1684640"
  },
  {
    "text": "together um we use colorcoded um lines to trace out things i chose blue for PCI",
    "start": "1684640",
    "end": "1691760"
  },
  {
    "text": "Express um you know red for uh uh voltage uh you can see in the bottom",
    "start": "1691760",
    "end": "1697440"
  },
  {
    "text": "left there's some thick um dark maroon lines those are coming from the Thunderbolt connector directly um and we",
    "start": "1697440",
    "end": "1704799"
  },
  {
    "text": "can see those are the high-speed lines for Thunderbolt so now we can um flip the board over check out some other",
    "start": "1704799",
    "end": "1710720"
  },
  {
    "text": "things we see the the maroon lines coming in again we see that the um pins",
    "start": "1710720",
    "end": "1715840"
  },
  {
    "text": "at the bottom are coming up and they're heading over to what looks like they're heading over to the opposite side of",
    "start": "1715840",
    "end": "1720960"
  },
  {
    "text": "Thunderbolt so these may be JTAG pins um we'll we'll kind of uh look at that a",
    "start": "1720960",
    "end": "1727039"
  },
  {
    "text": "little closer but now we're able to start pinning out a little more we can pin out the Thunderbolt connector we can say \"Okay well these are the high-speed",
    "start": "1727039",
    "end": "1733200"
  },
  {
    "text": "lines for Thunderbolt.\" So let's take a look at that connector and see um what else we can pull so we got our",
    "start": "1733200",
    "end": "1739200"
  },
  {
    "text": "high-speed lines this is uh single lane uh PCI Express so most of the other",
    "start": "1739200",
    "end": "1745039"
  },
  {
    "text": "high-speed lines are just pulled to ground so those are out a lot of ground everywhere else we got power hot plug",
    "start": "1745039",
    "end": "1751600"
  },
  {
    "text": "detect we also have two lines that are called low-speed lines and if we trace those out those don't go to Thunderbolt",
    "start": "1751600",
    "end": "1758480"
  },
  {
    "text": "at all they actually go directly to the ARM Cortex so when you plug in a Thunderbolt connection what you're",
    "start": "1758480",
    "end": "1765279"
  },
  {
    "text": "really doing is connecting the Apple directly to the ARM Cortex over load",
    "start": "1765279",
    "end": "1770559"
  },
  {
    "text": "speed lines and since they're low speed maybe we can kind of sniff them and see what's going on um and we look at the",
    "start": "1770559",
    "end": "1777520"
  },
  {
    "text": "data sheet and sure enough on the ARM cortex these plug in directly to the UART of the ARM",
    "start": "1777520",
    "end": "1783080"
  },
  {
    "text": "cortex so um so now we can start doing some sniffing this is an image of these",
    "start": "1783080",
    "end": "1790480"
  },
  {
    "text": "um lines being soldered into VAS these are strands of Ethernet cable being",
    "start": "1790480",
    "end": "1796159"
  },
  {
    "text": "soldered into VAS another great use for the epoxy we can take this these wires",
    "start": "1796159",
    "end": "1801760"
  },
  {
    "text": "coming out they're very delicate cuz this is this very very small uh things we need to be soldering and trust me",
    "start": "1801760",
    "end": "1807840"
  },
  {
    "text": "take it from uh my experience uh these are really easy to rip out with a logic analyzer so there's tension on the logic",
    "start": "1807840",
    "end": "1814720"
  },
  {
    "text": "analyzer probes when you hook them in if you're not careful it could pull on those wires and potentially cause damage",
    "start": "1814720",
    "end": "1821520"
  },
  {
    "text": "to the entire board you have to throw the whole thing out so um the epoxy really helps to kind of put that layer",
    "start": "1821520",
    "end": "1827120"
  },
  {
    "text": "over there and protect the stuff while we're sniffing um right here you can see we connected up the I squed C lines to",
    "start": "1827120",
    "end": "1833440"
  },
  {
    "text": "our logic probe and we're going to start sniffing the I squed C bus as well as other buses um and just for scale here's",
    "start": "1833440",
    "end": "1839440"
  },
  {
    "text": "the size of the wires um that were going into these VAS and these VAS fit these",
    "start": "1839440",
    "end": "1844880"
  },
  {
    "text": "wires perfectly uh almost to the point where solder uh tinning the wires to put",
    "start": "1844880",
    "end": "1850159"
  },
  {
    "text": "it in um almost wasn't an option if if you just had to have the just the just the smallest amount of solder on these",
    "start": "1850159",
    "end": "1855919"
  },
  {
    "text": "wires to get them to fit in the VAS perfectly and then solder them in um once our wires are are soldered in and",
    "start": "1855919",
    "end": "1862320"
  },
  {
    "text": "our epoxy set up to protect it we can start um uh sniffing the board and sniffing all the traffic on there uh",
    "start": "1862320",
    "end": "1868799"
  },
  {
    "text": "notice our I squed C connection being uh sniffed and also our UART connection at the bottom uh into our ARM cortex from",
    "start": "1868799",
    "end": "1875360"
  },
  {
    "text": "our um Apple so here's an image of the output of the uh logic analyzer and it might be",
    "start": "1875360",
    "end": "1882480"
  },
  {
    "text": "hard to see from this image but basically the UART comes on first and",
    "start": "1882480",
    "end": "1887679"
  },
  {
    "text": "the UART transfers data even before Thunderbolt ever boots up thunderbolt",
    "start": "1887679",
    "end": "1893360"
  },
  {
    "text": "isn't even hot yet um once the ARM does its thing and gets programmed by the",
    "start": "1893360",
    "end": "1898880"
  },
  {
    "text": "Apple then Thunderbolt comes on the I squared C buses start communicating between the ARM cortex and the",
    "start": "1898880",
    "end": "1905279"
  },
  {
    "text": "Thunderbolt controller and um device information is now sent up to the",
    "start": "1905279",
    "end": "1910799"
  },
  {
    "text": "computer through the Thunderbolt so we can kind of build this map up of these these lower speed protocols on the board",
    "start": "1910799",
    "end": "1917519"
  },
  {
    "text": "without having to worry about sniffing the Thunderbolt you know connections or the PCI Express connections which are",
    "start": "1917519",
    "end": "1923519"
  },
  {
    "text": "unless you have a really expensive equipment it's very difficult to do um so we're looking at this UART traffic",
    "start": "1923519",
    "end": "1930880"
  },
  {
    "text": "coming from the computer down to the ARM so I want to know what's going on we want to know what's what's going on on",
    "start": "1930880",
    "end": "1936799"
  },
  {
    "text": "the ARM on the Apple how the ARM is communicating it turns out these um this arm is communicating to an ARM on the",
    "start": "1936799",
    "end": "1944720"
  },
  {
    "text": "Apple computer itself these low-speed lines are actually connected directly to two arms um so in any Thunderbolt",
    "start": "1944720",
    "end": "1952080"
  },
  {
    "text": "implementation you need the Thunderbolt controller and you also need an ARM Cortex the ARM Cortex and the",
    "start": "1952080",
    "end": "1958720"
  },
  {
    "text": "Thunderbolt controller have to be together this is kind of an interesting uh correlation that they they need to be",
    "start": "1958720",
    "end": "1963840"
  },
  {
    "text": "together um so let's grab some Thunderbolt um firmware updates and maybe we can find some of these uh",
    "start": "1963840",
    "end": "1970159"
  },
  {
    "text": "strings and some other things uh in these firmware updates we notice the string em space space um maybe we can",
    "start": "1970159",
    "end": "1976640"
  },
  {
    "text": "find that in the Thunderbolt uh firmware image and see how the thunder maybe the Thunderbolt uh controller talks to the",
    "start": "1976640",
    "end": "1982559"
  },
  {
    "text": "ARM and sets it up like we let's try and figure that out so we grab our firmware update and there's tons of information",
    "start": "1982559",
    "end": "1988720"
  },
  {
    "text": "online from great reverse engineers in this uh field but u on how to get",
    "start": "1988720",
    "end": "1994159"
  },
  {
    "text": "through you know application packages and and look at macco files and those kinds of things so I I used a lot of",
    "start": "1994159",
    "end": "2000559"
  },
  {
    "text": "that and you can see when we go through our application package there's a payload file um taking that and just",
    "start": "2000559",
    "end": "2007679"
  },
  {
    "text": "running a file on it shows us it's a gzip compressed file so we'll just rename it to TGZ and uh untar it uh when",
    "start": "2007679",
    "end": "2015919"
  },
  {
    "text": "we do that we get three files we get an EFI file and we get two bin files um so",
    "start": "2015919",
    "end": "2022240"
  },
  {
    "text": "we have two bin files and the EFI program so one of these is most likely the ARM uh image and the other is is",
    "start": "2022240",
    "end": "2029760"
  },
  {
    "text": "Thunderbolt so which is which let's see if we can um figure that out so we take",
    "start": "2029760",
    "end": "2034960"
  },
  {
    "text": "our string and we actually just we look for that em space base and sure enough we find it in our HPM bin file so now we",
    "start": "2034960",
    "end": "2042720"
  },
  {
    "text": "have a pretty pretty good uh understanding that this is going to be the the uh ARM firmware but maybe we",
    "start": "2042720",
    "end": "2048960"
  },
  {
    "text": "just got lucky maybe there were just four sequential uh characters that happen to make that up so let's see if",
    "start": "2048960",
    "end": "2054000"
  },
  {
    "text": "we can find another um sequence of characters so we have the um hex 270",
    "start": "2054000",
    "end": "2060760"
  },
  {
    "text": "000000 so we'll grab that out and we'll do another search and sure enough we",
    "start": "2060760",
    "end": "2066158"
  },
  {
    "text": "have the same exact uh image coming back to us so we're pretty confident that this is the image of the ARM Cortex and",
    "start": "2066159",
    "end": "2073118"
  },
  {
    "text": "the other is the Thunderbolt image so now we can let's look at our EFI program",
    "start": "2073119",
    "end": "2078560"
  },
  {
    "text": "a little bit um so for those of you not familiar with EFI um the format is based",
    "start": "2078560",
    "end": "2084079"
  },
  {
    "text": "on a PE format it's called TE and the way OS 10 does it is they they take an",
    "start": "2084079",
    "end": "2090480"
  },
  {
    "text": "x86 uh and a 64-bit version of the TE",
    "start": "2090480",
    "end": "2095520"
  },
  {
    "text": "file and they kind of wrap them in a macco file so just using a hex editor",
    "start": "2095520",
    "end": "2101119"
  },
  {
    "text": "and kind of doing some dding we're able to pull out the x86 te file from the",
    "start": "2101119",
    "end": "2106480"
  },
  {
    "text": "macco file and we can just load it up into like IDA or whatever um I choose Hopper hopper is an all right for those",
    "start": "2106480",
    "end": "2115280"
  },
  {
    "text": "uh Hopper uh fans and possibly the developer of Hopper kudos to you because",
    "start": "2115280",
    "end": "2120560"
  },
  {
    "text": "uh this is amazing um Hopper is um it's basically similar",
    "start": "2120560",
    "end": "2127280"
  },
  {
    "text": "to IDA except for onetenth the price and has a lot of cool features uh a couple",
    "start": "2127280",
    "end": "2133280"
  },
  {
    "text": "of which we're going to kind of cruise through here uh just looking at just the the strings in the EFI program shows us",
    "start": "2133280",
    "end": "2140800"
  },
  {
    "text": "a lot we're able to see a lot of debug information um and tracing that out we can see a lot of functions being called",
    "start": "2140800",
    "end": "2149920"
  },
  {
    "text": "being shown with a colon so init Jag colon and then some issue or you know",
    "start": "2149920",
    "end": "2156320"
  },
  {
    "text": "read you know read eperrom colon so these this debug information is kind of helping us to figure out what blocks of",
    "start": "2156320",
    "end": "2163200"
  },
  {
    "text": "code are doing what also we noticed there's a uh found light ridge and found eagle ridge and with a um four uh uh",
    "start": "2163200",
    "end": "2171599"
  },
  {
    "text": "eight uh eight byte um I'm sorry four byte um um hex number next to it uh that",
    "start": "2171599",
    "end": "2178800"
  },
  {
    "text": "is pretty interesting i haven't seen anything related to that in any of the Apple stuff um if let's do a little",
    "start": "2178800",
    "end": "2185599"
  },
  {
    "text": "digging around we have basically two different um two different uh",
    "start": "2185599",
    "end": "2190720"
  },
  {
    "text": "descriptors for that if we do a little googling we find only one file and that file is the um IO PCI bridge.cpp in",
    "start": "2190720",
    "end": "2199440"
  },
  {
    "text": "GitHub basically this lists out if these four identifiers are not the case then",
    "start": "2199440",
    "end": "2207119"
  },
  {
    "text": "go ahead and do some stuff so now we are able to say with pretty high confidence since two out of the four are listed in",
    "start": "2207119",
    "end": "2214000"
  },
  {
    "text": "our EFI program we could say this is probably the list of device uh IDs for all of the Thunderbolt family so taking",
    "start": "2214000",
    "end": "2221680"
  },
  {
    "text": "that we notice that we look at our um logic analyzer output and sure enough in",
    "start": "2221680",
    "end": "2227359"
  },
  {
    "text": "uh in little Indian we see the um 86 804915 or",
    "start": "2227359",
    "end": "2233880"
  },
  {
    "text": "1549886 this is traffic coming from our device up so the peak ridge that we're",
    "start": "2233880",
    "end": "2239359"
  },
  {
    "text": "looking at is actually the device ID of uh 1549886 um so let's kind of pull this a",
    "start": "2239359",
    "end": "2246880"
  },
  {
    "text": "little further we can take these strings we can cross reference that back up to code uh and then we can start tagging",
    "start": "2246880",
    "end": "2254800"
  },
  {
    "text": "some of this code so init J tag is going to be this block so let's go ahead and name it init J tag we can kind of do",
    "start": "2254800",
    "end": "2261040"
  },
  {
    "text": "this with all of the debug strings and start building a map one of the coolest things about Hopper is the pseudo code",
    "start": "2261040",
    "end": "2267440"
  },
  {
    "text": "option and what you do is you we're within a function you hit pseudo code and it compiles it out or decompiles it",
    "start": "2267440",
    "end": "2274000"
  },
  {
    "text": "to a C um code so we're able to pull out um some code for the init J tag thing it",
    "start": "2274000",
    "end": "2280400"
  },
  {
    "text": "it's it's a little messy but I mean it it does a really good job of pulling this out and since we are able to kind of put these symbols in from debug",
    "start": "2280400",
    "end": "2287200"
  },
  {
    "text": "strings and clean up the code a little bit this is the code for initializing",
    "start": "2287200",
    "end": "2292560"
  },
  {
    "text": "the JTAG chain for Thunderbolt um we can see um how it goes through i it does its",
    "start": "2292560",
    "end": "2299280"
  },
  {
    "text": "uh JTAG initialization connects up and then pulls this string out if it's if it's one of these two strings it's these",
    "start": "2299280",
    "end": "2306160"
  },
  {
    "text": "types of um Thunderbolt controllers if not it's an unknown one that it doesn't know about so it only really supports",
    "start": "2306160",
    "end": "2312079"
  },
  {
    "text": "two on the um Apple computer and that's um another good point to note this is",
    "start": "2312079",
    "end": "2317119"
  },
  {
    "text": "all on the Apple uh these EFI programs running on the Apple we've kind of switched gears from the device over to",
    "start": "2317119",
    "end": "2322240"
  },
  {
    "text": "the Apple because we want to watch that communication so let's go back to the device um let's look at these headers uh",
    "start": "2322240",
    "end": "2329280"
  },
  {
    "text": "we know JTAG exists somewhere we know it JTAG's uh being done with Thunderbolt so",
    "start": "2329280",
    "end": "2334640"
  },
  {
    "text": "let's look at some of the headers the the one the PE the picture of the two rows on the right um one of these is",
    "start": "2334640",
    "end": "2340880"
  },
  {
    "text": "actually LED voltages so I hook up my multimeter and I turn on the device and",
    "start": "2340880",
    "end": "2346400"
  },
  {
    "text": "sure enough as the light gets brighter the voltage goes up and as it gets",
    "start": "2346400",
    "end": "2351440"
  },
  {
    "text": "dimmer the voltage goes down so um not super interesting for us trying to",
    "start": "2351440",
    "end": "2357119"
  },
  {
    "text": "figure out how this stuff works so the one uh the other one uh in there is for",
    "start": "2357119",
    "end": "2362400"
  },
  {
    "text": "uh high voltage there's a 15vt um uh voltage on there the one on the left CN4",
    "start": "2362400",
    "end": "2370480"
  },
  {
    "text": "uh that looks like it's JTAG and I'm assuming it's JTAG for two reasons one",
    "start": "2370480",
    "end": "2375520"
  },
  {
    "text": "or actually three reasons one it's plugged into the Thunderbolt controller two we saw the code on how JTAG is done",
    "start": "2375520",
    "end": "2381920"
  },
  {
    "text": "and JTAG is definitely done and three it also these pins also go directly into",
    "start": "2381920",
    "end": "2387760"
  },
  {
    "text": "the arm so this looks like it's some kind of J-TAG chaining that's going on between the arm and the uh Thunderbolt",
    "start": "2387760",
    "end": "2396800"
  },
  {
    "text": "controller so I did it trial and error uh I know they make devices for this kind of stuff",
    "start": "2398599",
    "end": "2405240"
  },
  {
    "text": "but I had some fun kind of playing around with it um switching them around finally when I run a detect or I'm sorry",
    "start": "2405240",
    "end": "2413040"
  },
  {
    "text": "an ID code I'm able to pull back an ID code of all zeros um this is not",
    "start": "2413040",
    "end": "2418240"
  },
  {
    "text": "uncommon so the other stuff I was getting back was uncommon so I can",
    "start": "2418240",
    "end": "2423440"
  },
  {
    "text": "safely assume that this um this pin out is the correct way that this JTAG stuff is set up so now we've got four more",
    "start": "2423440",
    "end": "2430079"
  },
  {
    "text": "pins for our Thunderbolt connector we can start building this pin out a little further and and adding the J-tag lines",
    "start": "2430079",
    "end": "2435119"
  },
  {
    "text": "in there um since the ARM Cortex M0",
    "start": "2435119",
    "end": "2440240"
  },
  {
    "text": "which is the Cortex family that the LPC 1100 series is based off of it does not",
    "start": "2440240",
    "end": "2447599"
  },
  {
    "text": "support JTAG it supports SWD which is basically a two-wire version of J-tag uh",
    "start": "2447599",
    "end": "2453280"
  },
  {
    "text": "that ARM developed however those lines are pulled to ground so it's not using SWD to do",
    "start": "2453280",
    "end": "2460400"
  },
  {
    "text": "any um um testing or flashing it looks like all of these pins that are hooked",
    "start": "2460400",
    "end": "2466240"
  },
  {
    "text": "up are going to port three um and a port on a chip is basically a collection of",
    "start": "2466240",
    "end": "2471440"
  },
  {
    "text": "pins that usually serve one purpose so they're all going to port three which leads me to believe that port 3 has been",
    "start": "2471440",
    "end": "2478400"
  },
  {
    "text": "reconfigured to do a custom JTAG implementation on the ARM um it's also offiscated with a um start sequence or",
    "start": "2478400",
    "end": "2485680"
  },
  {
    "text": "what's called a a knockknock protocol so um just doing your simple JTAG connection kind of you know it it",
    "start": "2485680",
    "end": "2492720"
  },
  {
    "text": "defeats this and normally if you have anything like that JTAG becomes much",
    "start": "2492720",
    "end": "2498560"
  },
  {
    "text": "more difficult if not impossible uh but we saw the code for this earlier so we can uh we could play around with that a",
    "start": "2498560",
    "end": "2504400"
  },
  {
    "text": "little more uh leave that as an exercise u going continuing on uh the Thunderbolt",
    "start": "2504400",
    "end": "2509920"
  },
  {
    "text": "device ROM information what's coming off of that we can look at our logic analyzer stuff you see the um the image",
    "start": "2509920",
    "end": "2516000"
  },
  {
    "text": "on the right the where it says HD PATU3 and it has a bunch of information that is from the system information or system",
    "start": "2516000",
    "end": "2523119"
  },
  {
    "text": "profiler for those um Mac users from back in the day uh that comes from the system profiler section of the",
    "start": "2523119",
    "end": "2530319"
  },
  {
    "text": "Thunderbolt bus so this is the hard drive plugged in and we can see that the vendor name and device name come into",
    "start": "2530319",
    "end": "2535920"
  },
  {
    "text": "here from there from the Thunderbolt ROM uh the vendor ID the device ID and the",
    "start": "2535920",
    "end": "2541200"
  },
  {
    "text": "device revision come in from this ROM and also a UID which uh per Apple's",
    "start": "2541200",
    "end": "2547040"
  },
  {
    "text": "Thunderbolt dev guide um all devices are required to have a unique um UID to",
    "start": "2547040",
    "end": "2552240"
  },
  {
    "text": "identify them uh this comes from that ROM that's that's burned onto the uh onto that chip so moving on to the PCI",
    "start": "2552240",
    "end": "2560640"
  },
  {
    "text": "Express stuff um we kind of covered PCI Express in the beginning and now we're",
    "start": "2560640",
    "end": "2565920"
  },
  {
    "text": "going to kind of delve back into it and see how this is pertaining to Thunderbolt now um turns out if you",
    "start": "2565920",
    "end": "2571920"
  },
  {
    "text": "really think about it Thunderbolt is basically a PCI Express bridge because it's taking PCI Express information and",
    "start": "2571920",
    "end": "2578000"
  },
  {
    "text": "then it's u encapsulating it going up to Thunderbolt pulling it back down so it's",
    "start": "2578000",
    "end": "2583119"
  },
  {
    "text": "really a bridge and we can see this through a program called Arbor arbor is a pay program for Windows only but it",
    "start": "2583119",
    "end": "2590240"
  },
  {
    "text": "allows you to see your PCI Express bus and get a lot of detailed information on your PCI Express bus to the point where",
    "start": "2590240",
    "end": "2596560"
  },
  {
    "text": "you can actually pick out um problems with your PCI Express bus and implementations of PCI Express devices",
    "start": "2596560",
    "end": "2603040"
  },
  {
    "text": "um so this is an image if you take an LSPCI and you do the most verbose output",
    "start": "2603040",
    "end": "2609599"
  },
  {
    "text": "you can take those memory um out that memory output and you can put it into Arbor and you can see other devices PCI",
    "start": "2609599",
    "end": "2616079"
  },
  {
    "text": "Express um fabric so this is a picture of my Apple computers PCI Express bus",
    "start": "2616079",
    "end": "2622880"
  },
  {
    "text": "before I plug in uh my Thunderbolt hard drive and after I plug in my Thunderbolt",
    "start": "2622880",
    "end": "2628000"
  },
  {
    "text": "hard drive notice the big bluish purple area on top that is the Thunderbolt chip",
    "start": "2628000",
    "end": "2634560"
  },
  {
    "text": "connected on the Apple computer the smaller one over on the bottom left is",
    "start": "2634560",
    "end": "2639599"
  },
  {
    "text": "the Thunderbolt device um on the hard drive and then the the green one at the very bottom is our actual SATA",
    "start": "2639599",
    "end": "2646240"
  },
  {
    "text": "controller our PCI Express to SATA controller we talked about earlier um looking at the header the PCI Express",
    "start": "2646240",
    "end": "2652560"
  },
  {
    "text": "header for this uh device we see a 1549886",
    "start": "2652560",
    "end": "2658400"
  },
  {
    "text": "so those those um those bytes we were seeing earlier",
    "start": "2658400",
    "end": "2664079"
  },
  {
    "text": "those are directly related to the PCI express implementation so 1549 is the",
    "start": "2664079",
    "end": "2669119"
  },
  {
    "text": "device ID and 8086 makes sense is made by Intel is the vendor ID so those um",
    "start": "2669119",
    "end": "2675920"
  },
  {
    "text": "chips earlier are those um bits that went across the wire those are PCI Express um identifiers looking at our",
    "start": "2675920",
    "end": "2684000"
  },
  {
    "text": "hard drive we notice it's a legacy device so if you remember we talked about",
    "start": "2684000",
    "end": "2690319"
  },
  {
    "text": "earlier legacy devices for backwards compatibility reasons and as we all know what can possibly go wrong with",
    "start": "2690319",
    "end": "2695520"
  },
  {
    "text": "supporting legacy devices um they have more permission they can have more access to certain things they actually",
    "start": "2695520",
    "end": "2701920"
  },
  {
    "text": "have access to your IO space um they have access to other devices other",
    "start": "2701920",
    "end": "2707040"
  },
  {
    "text": "legacy devices um and a fun fact um back in the day your video card uh would need",
    "start": "2707040",
    "end": "2715040"
  },
  {
    "text": "access to the video memory in the BIOS and so it needed access to that lower",
    "start": "2715040",
    "end": "2720400"
  },
  {
    "text": "level memory when they moved up to native devices that wasn't allowed legacy devices were allowed to do that",
    "start": "2720400",
    "end": "2726960"
  },
  {
    "text": "so they made video cards legacy devices and to this day if you see a video card",
    "start": "2726960",
    "end": "2733040"
  },
  {
    "text": "most of them on the market are still supporting legacy PCI Express so in theory if if the programming was done",
    "start": "2733040",
    "end": "2740560"
  },
  {
    "text": "right we may be able to take snapshots with this hard drive because we may be able to read that memory space of the",
    "start": "2740560",
    "end": "2747119"
  },
  {
    "text": "video uh video uh card because they're they're a legacy device so that was a pretty in-depth",
    "start": "2747119",
    "end": "2754560"
  },
  {
    "text": "look at the hard drive we've got a lot of information out we got some great ways to pull some flashes uh and ROMs we",
    "start": "2754560",
    "end": "2760720"
  },
  {
    "text": "got some great ways to see what's going on we know that the ARM Cortex is kind of orchestrating the whole thing for",
    "start": "2760720",
    "end": "2766480"
  },
  {
    "text": "Thunderbolt and the Cortex is required so maybe we can and we have a pin out a",
    "start": "2766480",
    "end": "2772000"
  },
  {
    "text": "pretty detailed pin out of our DSL2210 chip so we're able to take that and look",
    "start": "2772000",
    "end": "2777920"
  },
  {
    "text": "at other DSL2210 chips so let's look at our gigabit Ethernet adapter uh we're",
    "start": "2777920",
    "end": "2783839"
  },
  {
    "text": "going to kind of go through the same thing we're going to take it apart and figure out um all of the traces and and",
    "start": "2783839",
    "end": "2789839"
  },
  {
    "text": "try to sniff that this thing is tiny so it's not going to be nearly as fun as the hard drive was we're going to start",
    "start": "2789839",
    "end": "2797040"
  },
  {
    "text": "on the left hand side and move over to the right hand side to see what's on both sides looking at the connection we",
    "start": "2797040",
    "end": "2805440"
  },
  {
    "text": "notice there's an ARM Cortex there it's an LPC 1112 so this is part of the",
    "start": "2805440",
    "end": "2811000"
  },
  {
    "text": "LPC100 family but it's a smaller model obviously um we have the data sheet for",
    "start": "2811000",
    "end": "2817680"
  },
  {
    "text": "this it's the same data sheet as the one we were looking at for the other one um so that's a win for us also we noticed",
    "start": "2817680",
    "end": "2825200"
  },
  {
    "text": "this goo over here uh this looks uh what appears to be uh conformal coating and what conformal coating is it's a way it",
    "start": "2825200",
    "end": "2832960"
  },
  {
    "text": "does serves two purposes the first purpose is it um locks down the board",
    "start": "2832960",
    "end": "2838720"
  },
  {
    "text": "and prevents interference so with these high-speed uh transmissions and this small space we're working with that's",
    "start": "2838720",
    "end": "2846160"
  },
  {
    "text": "essential to not have any interference the other thing it does is it makes it a huge pain to reverse engineer because",
    "start": "2846160",
    "end": "2851440"
  },
  {
    "text": "this stuff is basically like a rock when you're trying to look at it it also obuscates a lot of the um lines that are",
    "start": "2851440",
    "end": "2858880"
  },
  {
    "text": "traveling on the board if you look closely at the image you can see if you get the light just right you can start",
    "start": "2858880",
    "end": "2864880"
  },
  {
    "text": "seeing some of the traces connecting to other uh components on the board you could see some resistors you could start",
    "start": "2864880",
    "end": "2870400"
  },
  {
    "text": "making out some paths this would be a lot easier if it was just a a plain green board um that conformal coding",
    "start": "2870400",
    "end": "2876400"
  },
  {
    "text": "kind of obuscates that a little bit if we flip our chip over or our board over",
    "start": "2876400",
    "end": "2882160"
  },
  {
    "text": "we notice there's a nice big Thunderbolt controller um and a couple other peripherals uh notice the over to the",
    "start": "2882160",
    "end": "2889440"
  },
  {
    "text": "right there's a um refer there's a clock there's a oscillator uh it's a 2210 so it's a DSL",
    "start": "2889440",
    "end": "2897760"
  },
  {
    "text": "2210 so we have a pin out of this chip so now any pin outs that we have we can",
    "start": "2897760",
    "end": "2903520"
  },
  {
    "text": "migrate over to this device and we can start looking at um what things do what so checking on the SPI stuff we know",
    "start": "2903520",
    "end": "2910480"
  },
  {
    "text": "that that little device over there is an SPI ROM because it's connected to the SPI lines of our Thunderbolt controller",
    "start": "2910480",
    "end": "2915520"
  },
  {
    "text": "we've mapped out we've also mapped out that the wires coming out of the device are PCI Express",
    "start": "2915520",
    "end": "2921400"
  },
  {
    "text": "lines so coming out of the connector down this wire it's just straight PCI",
    "start": "2921400",
    "end": "2927680"
  },
  {
    "text": "Express and we know from our reverse engineering what p pins are doing what",
    "start": "2927680",
    "end": "2933040"
  },
  {
    "text": "and what's going on so we can start making a map on this device as well we could say okay well I've mapped out all",
    "start": "2933040",
    "end": "2939839"
  },
  {
    "text": "the PCI Express pins these are the wires that are doing this PCI Express and um",
    "start": "2939839",
    "end": "2944880"
  },
  {
    "text": "so what we can do is we can take a we can take this and desolder it we know",
    "start": "2944880",
    "end": "2951359"
  },
  {
    "text": "where all the pins are going maybe we can buy um little PCI Express DIP",
    "start": "2951359",
    "end": "2956480"
  },
  {
    "text": "connector and solder everything in correctly and maybe we'll get an FPGA and we can do a DMA attack through an",
    "start": "2956480",
    "end": "2963240"
  },
  {
    "text": "FPGA um so I chose the Altera Cyclone uh 4 GX transceiver starter kit it's around",
    "start": "2963240",
    "end": "2970200"
  },
  {
    "text": "$400 it has a hard IP core for PCI Express built on it so we don't have to",
    "start": "2970200",
    "end": "2976079"
  },
  {
    "text": "worry about writing our own PCI Express stack or trying to build our own um FPGA",
    "start": "2976079",
    "end": "2981200"
  },
  {
    "text": "with FI um connector and and set that all up it's all built on it's around $400 so it's a pretty decent price point",
    "start": "2981200",
    "end": "2988240"
  },
  {
    "text": "for this kind of thing and hopefully putting these all together we can actually kick off a DMA",
    "start": "2988240",
    "end": "2995160"
  },
  {
    "text": "attack so this proved to be a little more difficult than um I thought i was I",
    "start": "2995160",
    "end": "3001920"
  },
  {
    "text": "ran into some issues um I was going to have it here for everyone today i just I",
    "start": "3001920",
    "end": "3007839"
  },
  {
    "text": "ran out of time um but here's the here's the hack soldering job that I did to try and get these wires set up these wires",
    "start": "3007839",
    "end": "3014640"
  },
  {
    "text": "are so small the uh PCI Express wires that come out there's a um a jacket and",
    "start": "3014640",
    "end": "3022000"
  },
  {
    "text": "then if you pull that jacket off there's ground wires wrapping around it and then within there there's another wire with a",
    "start": "3022000",
    "end": "3028400"
  },
  {
    "text": "jacket and then within that there's the actual PCI Express wire to actually do",
    "start": "3028400",
    "end": "3033839"
  },
  {
    "text": "um stripping of that first jacket i used the grooves of a pair of needle-nose",
    "start": "3033839",
    "end": "3041559"
  },
  {
    "text": "pliers and that fit perfectly so it was really difficult to actually strip these",
    "start": "3041559",
    "end": "3047760"
  },
  {
    "text": "wires and then getting down to the even smaller wire I just had to use a really sharp um clipping tool and just be very",
    "start": "3047760",
    "end": "3054880"
  },
  {
    "text": "careful not to cut those thin wires um and then soldering this on um there's",
    "start": "3054880",
    "end": "3060880"
  },
  {
    "text": "not a lot of room we could we could pull these out we can use some other wires i wanted to try to make it as compact as",
    "start": "3060880",
    "end": "3066480"
  },
  {
    "text": "possible and then the uh end result would just be epoxied so that it would be protected uh here's a bottom view of",
    "start": "3066480",
    "end": "3074480"
  },
  {
    "text": "that um this is going through the process of soldering these all together um like I said I I didn't get a chance",
    "start": "3074480",
    "end": "3081040"
  },
  {
    "text": "to finish it but um if you have any questions after the talk I'll be happy to talk with you about it um wrapping up",
    "start": "3081040",
    "end": "3087599"
  },
  {
    "text": "some uh tips and tricks uh for this get a lot of devices if you're going to be doing this kind of reverse engineering",
    "start": "3087599",
    "end": "3093359"
  },
  {
    "text": "uh at this low level get a lot of devices um you'll go through I went through four hard drives and six",
    "start": "3093359",
    "end": "3100640"
  },
  {
    "text": "Ethernet adapters um heat up everything slowly if you're going to be pulling the ROMs off of these um I hooked up my heat",
    "start": "3100640",
    "end": "3108240"
  },
  {
    "text": "gun to like 220 and just put it there and I was like \"All right let's go why aren't you coming off?\" um heat the",
    "start": "3108240",
    "end": "3114880"
  },
  {
    "text": "whole board up to about 180 190 degrees Celsius wait about five minutes and then",
    "start": "3114880",
    "end": "3120480"
  },
  {
    "text": "um if you think about it the whole board is a like everything around is a giant ground plane so that's all metal that",
    "start": "3120480",
    "end": "3125599"
  },
  {
    "text": "we're going to need to like heat up to a correct temperature once you're around 180 to 190 then you can crank up your",
    "start": "3125599",
    "end": "3131280"
  },
  {
    "text": "heat gun to you know around 220 to 250 and and do some um desoldering i actually wasn't able to",
    "start": "3131280",
    "end": "3138000"
  },
  {
    "text": "pull the chips off until I got up to around 300 C so some of the EES out there might be like that's that's awful",
    "start": "3138000",
    "end": "3144640"
  },
  {
    "text": "high you're going to damage the chip but I was successfully able to desolder them at that temperature and connect them in",
    "start": "3144640",
    "end": "3151760"
  },
  {
    "text": "um continuity testing i couldn't have done all of the tracing of this without the continuity testing it makes it so",
    "start": "3151760",
    "end": "3158319"
  },
  {
    "text": "much easier to trace through boards um and um uh planes going through the board um sniff everything that you find i only",
    "start": "3158319",
    "end": "3165680"
  },
  {
    "text": "had an eight channel logic analyzer so I picked two reference channels which were the UART ones cuz they started first and",
    "start": "3165680",
    "end": "3171280"
  },
  {
    "text": "I said UART lines six wires UART lines six wires UART lines six wires and then",
    "start": "3171280",
    "end": "3176400"
  },
  {
    "text": "I kind of group them all together so I had a reference um and read all the ROMs and the rashes uh ROMs and flashes that",
    "start": "3176400",
    "end": "3183040"
  },
  {
    "text": "you have um and pull out interesting information on that um so again my name",
    "start": "3183040",
    "end": "3188960"
  },
  {
    "text": "is Russ Savinsky uh security consultant at ISC um I want to give a special thanks to everyone at Isc Partners but",
    "start": "3188960",
    "end": "3195680"
  },
  {
    "text": "specifically Jesse Burns uh he was uh very helpful in helping me through this",
    "start": "3195680",
    "end": "3201040"
  },
  {
    "text": "whole process and Mike Warernner a good buddy of mine who put up with a lot of my crap for the last couple days and uh",
    "start": "3201040",
    "end": "3206640"
  },
  {
    "text": "helped me out with with troubleshooting some stuff also I want to give a thanks to uh Craig Hefner i think he's giving a",
    "start": "3206640",
    "end": "3211839"
  },
  {
    "text": "talk next um he helped me out debugging some SPI stuff in the beginning and uh um a really smart guy so go check out",
    "start": "3211839",
    "end": "3218000"
  },
  {
    "text": "his talk uh thank [Applause]",
    "start": "3218000",
    "end": "3223300"
  },
  {
    "text": "you do we uh we have we have five minutes so um we have some time for questions yes",
    "start": "3225720",
    "end": "3234119"
  },
  {
    "text": "so uh were you able to send custom TLPS and what was the result um the question",
    "start": "3236880",
    "end": "3242640"
  },
  {
    "text": "was well obviously there's a mic so I'm not going to repeat the question but um I was not I was a I was not able to send",
    "start": "3242640",
    "end": "3250079"
  },
  {
    "text": "custom TLPS because I ran into issues with um with some of the wires um u",
    "start": "3250079",
    "end": "3257440"
  },
  {
    "text": "there there's so it turns out there's a step down converter that needs uh a certain voltage applied to it just in",
    "start": "3257440",
    "end": "3264319"
  },
  {
    "text": "the right spot and I wasn't able to get that finagled in time for the talk um I had the um the Altera PCI Express stuff",
    "start": "3264319",
    "end": "3272000"
  },
  {
    "text": "all set up and ready to go to run the attack um it ran in a simulator but I",
    "start": "3272000",
    "end": "3277359"
  },
  {
    "text": "wasn't able to get the device actually finished in time for the talk so I guess the answer is no",
    "start": "3277359",
    "end": "3283119"
  },
  {
    "text": "any other questions oh why not uh why not start with a",
    "start": "3283119",
    "end": "3288160"
  },
  {
    "text": "commercial PCIe to Thunderbolt card cage there are three on the market that is a",
    "start": "3288160",
    "end": "3294319"
  },
  {
    "text": "great question um I did not know about that so uh actually after this if you want to come uh talk to me about it I'd",
    "start": "3294319",
    "end": "3300160"
  },
  {
    "text": "really appreciate that information cuz uh like I said I love learning this stuff so I love taking it apart so that",
    "start": "3300160",
    "end": "3305200"
  },
  {
    "text": "was kind of the the attraction for me was \"Yeah let's get into this and start taking stuff apart.\" That that was an",
    "start": "3305200",
    "end": "3310559"
  },
  {
    "text": "awesome awesome attempt with the gigabit Ethernet adapter by the way i can't believe you tried to solder those thank",
    "start": "3310559",
    "end": "3316480"
  },
  {
    "text": "you it was It was a lot of work but it it ended up paying off now I can do it pretty easily",
    "start": "3316480",
    "end": "3323558"
  },
  {
    "text": "so um any other questions before we end oh yep this guy",
    "start": "3324319",
    "end": "3332720"
  },
  {
    "text": "sorry didn't see you yes um I'd like to know what is the purpose of the FPGA",
    "start": "3332720",
    "end": "3339760"
  },
  {
    "text": "because you have a PCI uh bus directly between the two the two devices so you",
    "start": "3339760",
    "end": "3347280"
  },
  {
    "text": "can plug it in a in a computer directly or maybe not uh I'm uh I'll try",
    "start": "3347280",
    "end": "3355359"
  },
  {
    "text": "to answer the question the best I can um I use the Alterara uh uh Cyclone 4 GX",
    "start": "3355359",
    "end": "3361680"
  },
  {
    "text": "stuff that came with um Alterara's Cortis 2 and the hard IP is is kind of",
    "start": "3361680",
    "end": "3367760"
  },
  {
    "text": "um on the FPGA itself so there wasn't actually a soft IP version that I needed to configure um what happens is uh the",
    "start": "3367760",
    "end": "3375200"
  },
  {
    "text": "Cortis 2 software will actually connect to the FPGA via JTAG and um it'll",
    "start": "3375200",
    "end": "3380400"
  },
  {
    "text": "actually program the um the IP uh the hard IP for PCI Express you can actually",
    "start": "3380400",
    "end": "3385440"
  },
  {
    "text": "give it device ID version of uh vendor ID and all the PCI Express stuff you can set up the bars uh to be whatever",
    "start": "3385440",
    "end": "3391440"
  },
  {
    "text": "addresses you want um you can set it to be a legacy or or native endpoint uh there's tons of configuration you can do",
    "start": "3391440",
    "end": "3397280"
  },
  {
    "text": "within the Cortis 2 software but that stuff gets programmed into the hard IP of the PCI Express stuff so um mostly",
    "start": "3397280",
    "end": "3403440"
  },
  {
    "text": "it's configuration and then um custom code to to do a TLP it makes it pretty",
    "start": "3403440",
    "end": "3411040"
  },
  {
    "text": "easy is uh we are we good or we have room time for another",
    "start": "3412440",
    "end": "3420000"
  },
  {
    "text": "question we're good all right well if you have any questions you see me around uh stop by and and ask me but otherwise",
    "start": "3422119",
    "end": "3428480"
  },
  {
    "text": "thanks again [Applause]",
    "start": "3428480",
    "end": "3434419"
  }
]