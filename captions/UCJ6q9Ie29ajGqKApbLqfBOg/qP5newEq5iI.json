[
  {
    "text": "[Music] foreign",
    "start": "1730",
    "end": "6720"
  },
  {
    "text": "event driven Cornucopia representing the binary team Windows management",
    "start": "12559",
    "end": "18619"
  },
  {
    "text": "instrumentation provides the ability to manage Enterprise devices both locally",
    "start": "18619",
    "end": "25619"
  },
  {
    "text": "and remotely various tools edrs and Sim Solutions",
    "start": "25619",
    "end": "30840"
  },
  {
    "text": "leverage this functionality for performance monitoring and device",
    "start": "30840",
    "end": "36120"
  },
  {
    "text": "Telemetry Gathering attacking this uh the this functionality can blind all",
    "start": "36120",
    "end": "42059"
  },
  {
    "text": "these solutions that rely on this telemetry and also this is an important topic for",
    "start": "42059",
    "end": "47820"
  },
  {
    "text": "uh for Defenders for experts in Windows security and uh malware detection and",
    "start": "47820",
    "end": "54840"
  },
  {
    "text": "the incident response a little bit about the binary team so",
    "start": "54840",
    "end": "59940"
  },
  {
    "text": "finally the device security uh startup based in La that focuses on threats that",
    "start": "59940",
    "end": "66900"
  },
  {
    "text": "originate below the uh below the operating system in the firmware and understand how they move up the stack",
    "start": "66900",
    "end": "74100"
  },
  {
    "text": "into the operating system and uh we use our land to deploy their next",
    "start": "74100",
    "end": "80820"
  },
  {
    "text": "level uh the their next stages uh in a",
    "start": "80820",
    "end": "86460"
  },
  {
    "text": "2021 and black at Europe the same team presented the Deep dive on attacks on",
    "start": "86460",
    "end": "92040"
  },
  {
    "text": "etw for this talk we chose to attack wmi and",
    "start": "92040",
    "end": "97799"
  },
  {
    "text": "as we will see through the presentation we have a lot to talk about again my",
    "start": "97799",
    "end": "104040"
  },
  {
    "text": "name is Claudia todresco I'm the CTO and co-founder of binary unfortunately Andre",
    "start": "104040",
    "end": "110180"
  },
  {
    "text": "retlet and the Igor couldn't make the trip to be with us today but their",
    "start": "110180",
    "end": "115200"
  },
  {
    "text": "contribution to this research was essential so it was very important to understand",
    "start": "115200",
    "end": "121680"
  },
  {
    "text": "how we can attack wmi because it is used by a lot of Solutions in the field and",
    "start": "121680",
    "end": "127439"
  },
  {
    "text": "these Solutions can be blind or it can be tricked uh in terms of the Telemetry that",
    "start": "127439",
    "end": "133379"
  },
  {
    "text": "they're Gathering also more important is to find ways how to detect if the wmi or",
    "start": "133379",
    "end": "139500"
  },
  {
    "text": "any other solution that is used by by Security Solutions is tampered with and",
    "start": "139500",
    "end": "146099"
  },
  {
    "text": "then act upon that by notifying the proper audience so as for the agenda",
    "start": "146099",
    "end": "152220"
  },
  {
    "text": "we'll start with presenting some information about the Windows management information in terms of architecture and",
    "start": "152220",
    "end": "158879"
  },
  {
    "text": "features also we'll look at how the hackers and the threat actors are using",
    "start": "158879",
    "end": "165260"
  },
  {
    "text": "wmi in the in the wild next we'll go to the core of the",
    "start": "165260",
    "end": "172980"
  },
  {
    "text": "presentation by introducing different types of attack on wmi and also introduce eight new brands",
    "start": "172980",
    "end": "181019"
  },
  {
    "text": "new attacks on it uh on the wmi at the end we'll introduce some uh some",
    "start": "181019",
    "end": "187980"
  },
  {
    "text": "solutions that can uh some solutions like wmi check and the memory Ranger",
    "start": "187980",
    "end": "193440"
  },
  {
    "text": "those Solutions can detect and prevent some of the attacks that will be presented in this presentation",
    "start": "193440",
    "end": "201180"
  },
  {
    "text": "foreign next let's go a little bit into the Windows management instrumentation architecture uh for for short uh short",
    "start": "201180",
    "end": "210120"
  },
  {
    "text": "wmi actually the windows implementation of two standards the the wbam or a",
    "start": "210120",
    "end": "217440"
  },
  {
    "text": "web-based Enterprise management and cim common information model it has",
    "start": "217440",
    "end": "225780"
  },
  {
    "text": "very good advantages it's available system-wide in all the",
    "start": "225780",
    "end": "231260"
  },
  {
    "text": "Windows operating systems starting with Windows and deep 4.0 also it provides a",
    "start": "231260",
    "end": "238560"
  },
  {
    "text": "standardized framework to talk with consumers and providers via Chrome",
    "start": "238560",
    "end": "244019"
  },
  {
    "text": "interfaces going into the specifics of the architecture so we have the wmi",
    "start": "244019",
    "end": "251159"
  },
  {
    "text": "providers that produce uh device Telemetry as wmi",
    "start": "251159",
    "end": "257760"
  },
  {
    "text": "objects we have the clients that consume those events we have the cim standard",
    "start": "257760",
    "end": "263520"
  },
  {
    "text": "that is a structuring querying and transmitting the wmi objects for",
    "start": "263520",
    "end": "270540"
  },
  {
    "text": "reference W by objects actually instances of wmi classes next uh so as part of the cim standard",
    "start": "270540",
    "end": "278520"
  },
  {
    "text": "we have the wmi repository that stores the class definitions the Dems and definitions and their Associated",
    "start": "278520",
    "end": "285560"
  },
  {
    "text": "properties as well as the persistent wmi objects then we have the",
    "start": "285560",
    "end": "292340"
  },
  {
    "text": "moth or managed object format it's a object oriented language that it is that",
    "start": "292340",
    "end": "300720"
  },
  {
    "text": "is used to specify uh different wmi artifacts to extend the format then we",
    "start": "300720",
    "end": "307680"
  },
  {
    "text": "have the query language that is the SQL like type language wql to query to",
    "start": "307680",
    "end": "314040"
  },
  {
    "text": "filter events and uh to very remotely connect and transmit",
    "start": "314040",
    "end": "320880"
  },
  {
    "text": "the receive data Windows Remote Management or dcom can be leveraged last but not the least we have the wmi",
    "start": "320880",
    "end": "327600"
  },
  {
    "text": "service which is implemented at the SVC host service dll in the net svcs Group",
    "start": "327600",
    "end": "334139"
  },
  {
    "text": "which is called winm GMT let's talk a little bit about a little",
    "start": "334139",
    "end": "339960"
  },
  {
    "text": "bit about the wmi providers so in user mode they are implemented as comb base",
    "start": "339960",
    "end": "346100"
  },
  {
    "text": "dla dlls or kernel drivers for the kernel component as you can see in the",
    "start": "346100",
    "end": "353520"
  },
  {
    "text": "more definition of a provider a provider is an instance of the underscore underscore Windows 32",
    "start": "353520",
    "end": "360020"
  },
  {
    "text": "provider standard class it is identified by a class ID and as",
    "start": "360020",
    "end": "365160"
  },
  {
    "text": "any com interface it has its own registry configuration uh as we can see",
    "start": "365160",
    "end": "371340"
  },
  {
    "text": "in Windows 11 we have more than 4 000 built-in wmi con providers that can",
    "start": "371340",
    "end": "376800"
  },
  {
    "text": "cover a lot of different device components some of them are listed in",
    "start": "376800",
    "end": "382380"
  },
  {
    "text": "the table wmi advance so double my offers a great",
    "start": "382380",
    "end": "389340"
  },
  {
    "text": "ability for both attackers and Defenders to act on a certain double on pretty",
    "start": "389340",
    "end": "396060"
  },
  {
    "text": "much every wmi event which covers mostly any of the operating system events also",
    "start": "396060",
    "end": "403020"
  },
  {
    "text": "another great ability uh offered by wmi is to register a permanent event",
    "start": "403020",
    "end": "409380"
  },
  {
    "text": "subscriptions this is very uh which uh",
    "start": "409380",
    "end": "414660"
  },
  {
    "text": "obviously we'll uh survive a reboot which is very used by uh in the field by",
    "start": "414660",
    "end": "420539"
  },
  {
    "text": "by attackers to obtain persistence on on those systems there are two types of",
    "start": "420539",
    "end": "425699"
  },
  {
    "text": "events intrinsic events and extrasing events I leave this the definition uh to",
    "start": "425699",
    "end": "431280"
  },
  {
    "text": "this uh on as reference next we move to filters it's an instance",
    "start": "431280",
    "end": "436800"
  },
  {
    "text": "of underscore underscore invent filter wmi class that specify which events are",
    "start": "436800",
    "end": "441900"
  },
  {
    "text": "delivered to the bound consumer we'll see what bound bounding means the most",
    "start": "441900",
    "end": "447599"
  },
  {
    "text": "important properties of this class are the event namespace the query language to filter",
    "start": "447599",
    "end": "454139"
  },
  {
    "text": "the events and also the query itself as a expressed as a wql query",
    "start": "454139",
    "end": "460620"
  },
  {
    "text": "these are the example of the general syntax of a w double query and also we",
    "start": "460620",
    "end": "467280"
  },
  {
    "text": "have two two examples one for uh uh intrinsic uh",
    "start": "467280",
    "end": "473099"
  },
  {
    "text": "event query which actually uh triggers every time a notepad exe is launched",
    "start": "473099",
    "end": "480060"
  },
  {
    "text": "and the other one it's an example of extrinsic event filter which detects",
    "start": "480060",
    "end": "487139"
  },
  {
    "text": "um persistence in the Run registry key next the consumer the wmi consumer defy",
    "start": "487139",
    "end": "494220"
  },
  {
    "text": "the action to be carried out once the bound filter event filter has triggered",
    "start": "494220",
    "end": "499379"
  },
  {
    "text": "and in the standard there are available five event consumers",
    "start": "499379",
    "end": "505620"
  },
  {
    "text": "to perform actions such as uh logging uh executing scripts or command",
    "start": "505620",
    "end": "512399"
  },
  {
    "text": "lines or even sending notifications and uh",
    "start": "512399",
    "end": "517520"
  },
  {
    "text": "in terms of we talked about the the permanent event subscription how is that",
    "start": "517520",
    "end": "524000"
  },
  {
    "text": "performed is uh the way persistence and code execution happens in the wmi",
    "start": "524000",
    "end": "529920"
  },
  {
    "text": "repository it's in three steps create a filter to describe the event to trigger",
    "start": "529920",
    "end": "535200"
  },
  {
    "text": "on create a consumer that describes the action once the the filter has triggered",
    "start": "535200",
    "end": "541440"
  },
  {
    "text": "and then bind them using a filter to Consumer binding instance to link pretty",
    "start": "541440",
    "end": "547980"
  },
  {
    "text": "much the trigger to the action to be performed so this is a simple example how it can",
    "start": "547980",
    "end": "554040"
  },
  {
    "text": "detect uh a new when a new service is installed you create a",
    "start": "554040",
    "end": "560160"
  },
  {
    "text": "event filter that monitors for instance creation events",
    "start": "560160",
    "end": "567480"
  },
  {
    "text": "or the polling interval for which the target instance is a of",
    "start": "567480",
    "end": "572640"
  },
  {
    "text": "type 132 service then you you create a consumer that will uh",
    "start": "572640",
    "end": "580680"
  },
  {
    "text": "trigger on this if one when the new service is created and write a notification into the event log using",
    "start": "580680",
    "end": "588120"
  },
  {
    "text": "the Event Viewer consumer and last but not least you bind the the",
    "start": "588120",
    "end": "593580"
  },
  {
    "text": "the the filter with the consumer to link pretty much the trigger to the action to",
    "start": "593580",
    "end": "599700"
  },
  {
    "text": "be performed let's talk a little talk a little bit about the cim repository uh it's the",
    "start": "599700",
    "end": "607200"
  },
  {
    "text": "database for the wmi that stores the uh class definitions for the class",
    "start": "607200",
    "end": "613440"
  },
  {
    "text": "definition namespace definitions together with their qualifiers and properties as long as as well as the",
    "start": "613440",
    "end": "620420"
  },
  {
    "text": "persistent uh objects wmi objects consists of three types of files it's",
    "start": "620420",
    "end": "628140"
  },
  {
    "text": "the index BTR object that data and the mapping three mapping files the",
    "start": "628140",
    "end": "634620"
  },
  {
    "text": "index.btr contains the uh the index index for the wmi which is implemented",
    "start": "634620",
    "end": "642959"
  },
  {
    "text": "as a B3 uh organized in index records stored in",
    "start": "642959",
    "end": "648779"
  },
  {
    "text": "Pages the object that data contains the actual class definitions and and the",
    "start": "648779",
    "end": "655740"
  },
  {
    "text": "persistent objects uh this in the same way it is organized in records and uh I",
    "start": "655740",
    "end": "662760"
  },
  {
    "text": "mean those records are stored in pages and then the mapping uh the mapping is",
    "start": "662760",
    "end": "669060"
  },
  {
    "text": "has one one uh only one purpose to translate The Logical page numbers to uh",
    "start": "669060",
    "end": "676800"
  },
  {
    "text": "their physical page number equivalent for both the object that data and index",
    "start": "676800",
    "end": "682260"
  },
  {
    "text": "that that the BTR uh one was part of the flare team in in",
    "start": "682260",
    "end": "688440"
  },
  {
    "text": "FireEye I reversed the format the format of uh wmi and right wrote a paper and",
    "start": "688440",
    "end": "695760"
  },
  {
    "text": "released uh several forensic tools with my good good friends uh uh Willie and",
    "start": "695760",
    "end": "702300"
  },
  {
    "text": "Matt so let's go a little bit deeper into the",
    "start": "702300",
    "end": "707700"
  },
  {
    "text": "the forensics how it works in in simple terms so pretty much the search storage",
    "start": "707700",
    "end": "713160"
  },
  {
    "text": "path is constructed by using the identifier of the namespace class",
    "start": "713160",
    "end": "719160"
  },
  {
    "text": "and the instance the index.btr is searched and then the",
    "start": "719160",
    "end": "724500"
  },
  {
    "text": "the corresponding index record is found which contains the logical page number",
    "start": "724500",
    "end": "730200"
  },
  {
    "text": "of the in the object data for the record that you're looking for the record identifier and its size then the mapping",
    "start": "730200",
    "end": "737459"
  },
  {
    "text": "file is used to translate The Logical page number into its physical uh",
    "start": "737459",
    "end": "742620"
  },
  {
    "text": "equivalent then now we have the physical page where the data you are you are",
    "start": "742620",
    "end": "747959"
  },
  {
    "text": "looking for it's in object that data you go through that page record by record and identify the one that you're looking",
    "start": "747959",
    "end": "754560"
  },
  {
    "text": "for by looking at the record ID of course the size in the index record should match the the actual size in the",
    "start": "754560",
    "end": "761940"
  },
  {
    "text": "objects that data also the same approach can be used for index.btr because it's",
    "start": "761940",
    "end": "768240"
  },
  {
    "text": "it's a bit B3 implementation and the pointers to the next nodes in the B3",
    "start": "768240",
    "end": "774420"
  },
  {
    "text": "are specified as logical page numbers now that we know how to pass the",
    "start": "774420",
    "end": "782399"
  },
  {
    "text": "now that we know that how to parse the the repository we took uh we we did a",
    "start": "782399",
    "end": "789060"
  },
  {
    "text": "very quick exercise to figure out what is in actual uh database for a Lenovo uh",
    "start": "789060",
    "end": "796680"
  },
  {
    "text": "machine so we saw that in the root wmi netspace we have uh very interesting",
    "start": "796680",
    "end": "803600"
  },
  {
    "text": "classes starting with Lenovo underscore as prefix one of them it's a bio setting",
    "start": "803600",
    "end": "809160"
  },
  {
    "text": "another one is Lenovo set biosetting another one is Lenovo set BIOS password",
    "start": "809160",
    "end": "814380"
  },
  {
    "text": "and in the right we have the definition the complete definition with properties in it for which current setting pick our",
    "start": "814380",
    "end": "821639"
  },
  {
    "text": "attention it's a string and if we're trying to look uh in the repository for",
    "start": "821639",
    "end": "826860"
  },
  {
    "text": "instances of this class we have empty results which means this class is uh",
    "start": "826860",
    "end": "833300"
  },
  {
    "text": "dynamically created on the Fly by a custom provider that is implemented by",
    "start": "833300",
    "end": "839220"
  },
  {
    "text": "the OEM vendor so we can use a w my to actually look for non-empty instances of",
    "start": "839220",
    "end": "846120"
  },
  {
    "text": "this class and then printing out the current settings we have this uh these",
    "start": "846120",
    "end": "851279"
  },
  {
    "text": "results if we magnify a little bit we see some information about The Trusted",
    "start": "851279",
    "end": "857040"
  },
  {
    "text": "execution the TPM and also about update updating the BIOS",
    "start": "857040",
    "end": "864540"
  },
  {
    "text": "which means that having those classes you can alter the",
    "start": "864540",
    "end": "871680"
  },
  {
    "text": "settings of the BIOS from the user land remember that there is a Lenovo",
    "start": "871680",
    "end": "876839"
  },
  {
    "text": "underscore set bios setting so which means Lenovo provides an interface in the in",
    "start": "876839",
    "end": "884579"
  },
  {
    "text": "the firmware so the wmi provider can communicate to to read or alter",
    "start": "884579",
    "end": "891899"
  },
  {
    "text": "the settings which from my point of view as the device security startup is pretty",
    "start": "891899",
    "end": "897779"
  },
  {
    "text": "scary also the standard provides a class with",
    "start": "897779",
    "end": "903060"
  },
  {
    "text": "32 bios to give us information about the the current uh the current uh BIOS",
    "start": "903060",
    "end": "909320"
  },
  {
    "text": "version uh it's serial the device serial number and also the OEM vendor",
    "start": "909320",
    "end": "915779"
  },
  {
    "text": "so now let's look at how the wmi is leveraged by both Defenders and attackers for Defenders it's a it's a",
    "start": "915779",
    "end": "923339"
  },
  {
    "text": "great tool to uh to use uh to gather Telemetry for attackers is a great living of the land infrastructure to",
    "start": "923339",
    "end": "930060"
  },
  {
    "text": "perform a malicious uh activities so how the threat actors leverage wmi",
    "start": "930060",
    "end": "938420"
  },
  {
    "text": "reconnaissance you can start with reconnaissance AV detection and so on",
    "start": "938420",
    "end": "943740"
  },
  {
    "text": "in the next slides I'll present an example of how in the wild wmi is",
    "start": "943740",
    "end": "951620"
  },
  {
    "text": "leveraged for far less persistence called the execution and data storage",
    "start": "951620",
    "end": "957120"
  },
  {
    "text": "so pretty much we have a three we have a trigger or even filter that",
    "start": "957120",
    "end": "963420"
  },
  {
    "text": "triggers several seconds after the system power up to allow the uh the the device to to",
    "start": "963420",
    "end": "971519"
  },
  {
    "text": "boot up which will this this trigger will make the command line event",
    "start": "971519",
    "end": "976560"
  },
  {
    "text": "consumer to execute what it will execute is a Powershell script that is located",
    "start": "976560",
    "end": "982740"
  },
  {
    "text": "in the description property of the option class so we have the definition of the option",
    "start": "982740",
    "end": "989579"
  },
  {
    "text": "class which has a name and a description both of them strings in the description that is called by the",
    "start": "989579",
    "end": "996660"
  },
  {
    "text": "consumer we have the script if we look at the script very quick we see that it extracts the the encoded the base64",
    "start": "996660",
    "end": "1004160"
  },
  {
    "text": "encoded payload from the name property and uh",
    "start": "1004160",
    "end": "1009339"
  },
  {
    "text": "decodes it drops it to disk the path specified in the configuration and",
    "start": "1009339",
    "end": "1017120"
  },
  {
    "text": "then it Executives the second stage so the tools that we use in our research",
    "start": "1017120",
    "end": "1022639"
  },
  {
    "text": "the WM test to showcase the wmi interaction scripting via vbscript and",
    "start": "1022639",
    "end": "1029780"
  },
  {
    "text": "Powershell to play with filters and consumers also developed our own",
    "start": "1029780",
    "end": "1035558"
  },
  {
    "text": "wmi client to look for for running processes",
    "start": "1035559",
    "end": "1042140"
  },
  {
    "text": "so WMA attacks now let's switch to the main topic",
    "start": "1042140",
    "end": "1047720"
  },
  {
    "text": "the threat model the thread model of wmi consists of the",
    "start": "1047720",
    "end": "1053260"
  },
  {
    "text": "wmi service that connects an interact that communicates with consumers clients",
    "start": "1053260",
    "end": "1060080"
  },
  {
    "text": "and providers via Advanced LPC ports uh LPC channels then we have the wmi files",
    "start": "1060080",
    "end": "1068539"
  },
  {
    "text": "the repository and and the provider dlls and so on we have the configuration and registry and also the the data in the",
    "start": "1068539",
    "end": "1076280"
  },
  {
    "text": "wmi service memory and then we split uh each one in uh in",
    "start": "1076280",
    "end": "1082940"
  },
  {
    "text": "in each of the attacks in five buckets depending uh which are the targets uh",
    "start": "1082940",
    "end": "1088039"
  },
  {
    "text": "the WNY data process the lapc connections the files and Registries",
    "start": "1088039",
    "end": "1093559"
  },
  {
    "text": "then the the sandboxing of a wmi using a user mode attack and then some boxing of",
    "start": "1093559",
    "end": "1100100"
  },
  {
    "text": "wmi using a decom attack so why the wmi attacks are so dangerous",
    "start": "1100100",
    "end": "1106340"
  },
  {
    "text": "so these attacks have existed in in the uh in in wmi from the beginning and the",
    "start": "1106340",
    "end": "1113419"
  },
  {
    "text": "reason for that is wi wasn't built for to be used for a security solution wmi",
    "start": "1113419",
    "end": "1119780"
  },
  {
    "text": "was built just to gather Telemetry on the device also the wmi service is not considered a",
    "start": "1119780",
    "end": "1125240"
  },
  {
    "text": "critical app it doesn't have PPL or a trust label and the solution the the",
    "start": "1125240",
    "end": "1131559"
  },
  {
    "text": "Security Solutions don't have a way to check if the wmi has",
    "start": "1131559",
    "end": "1136880"
  },
  {
    "text": "been disabled or has been tampered with so that on on top of that all these",
    "start": "1136880",
    "end": "1142340"
  },
  {
    "text": "attacks are architectural flaws which cannot be just fixed with a simple",
    "start": "1142340",
    "end": "1148760"
  },
  {
    "text": "patch so let's start with the fur the first",
    "start": "1148760",
    "end": "1155660"
  },
  {
    "text": "bucket which is uh attacks on files and registry configuration so you can modify",
    "start": "1155660",
    "end": "1162020"
  },
  {
    "text": "content you can remove files you can restrict access to the files on disks like the the the files that represent",
    "start": "1162020",
    "end": "1169820"
  },
  {
    "text": "the database or the provider dlls in the registry we have the the service",
    "start": "1169820",
    "end": "1175220"
  },
  {
    "text": "configuration and uh the the other the wmi internal settings",
    "start": "1175220",
    "end": "1183320"
  },
  {
    "text": "so let's the first attack uh there is an a there is a registry key called enable",
    "start": "1183320",
    "end": "1188539"
  },
  {
    "text": "events when a new event comes if wmi client comes in that's the following uh",
    "start": "1188539",
    "end": "1194299"
  },
  {
    "text": "call stack on any TSS which stands for initialized event subsystem is called in",
    "start": "1194299",
    "end": "1200240"
  },
  {
    "text": "it in inside the the function the enabled events registry value is red",
    "start": "1200240",
    "end": "1206840"
  },
  {
    "text": "if it's different from one then an inter a pointer to the interface is uh",
    "start": "1206840",
    "end": "1212299"
  },
  {
    "text": "obtained and success is returned if so an attacker basically can write a number",
    "start": "1212299",
    "end": "1218720"
  },
  {
    "text": "different from one on the in the in the registry if value restart the wmi",
    "start": "1218720",
    "end": "1224600"
  },
  {
    "text": "service and then everything is disabled so the UW my interest infrastructure in",
    "start": "1224600",
    "end": "1232039"
  },
  {
    "text": "the user space uh the most important is the is the service the service uh the main Services wmi",
    "start": "1232039",
    "end": "1239600"
  },
  {
    "text": "svcd is the wmysc SVC dll it's implemented as we see host service dll",
    "start": "1239600",
    "end": "1246080"
  },
  {
    "text": "and the other dlls that are important for our discussion the wbm core the",
    "start": "1246080",
    "end": "1251960"
  },
  {
    "text": "webdr VFS and wbms so let's look at the templates how this",
    "start": "1251960",
    "end": "1258799"
  },
  {
    "text": "is attacked so we have a the code of a certain dll",
    "start": "1258799",
    "end": "1264320"
  },
  {
    "text": "and on the right we have the running memory so when the dll is loaded the global flag is initialized to its",
    "start": "1264320",
    "end": "1270860"
  },
  {
    "text": "default value in this case Zero in the initialized uh function uh this flag is termed one when a new connection or",
    "start": "1270860",
    "end": "1278020"
  },
  {
    "text": "registration of an event filter comes in the global tag is checked if it's true",
    "start": "1278020",
    "end": "1284240"
  },
  {
    "text": "or one then uh the the event is process the the event is processed and success",
    "start": "1284240",
    "end": "1290419"
  },
  {
    "text": "is returned we have a new connection established and the registration uh successful",
    "start": "1290419",
    "end": "1296000"
  },
  {
    "text": "then an attacker can clear the global flag so the error path in the dispatch routine",
    "start": "1296000",
    "end": "1304580"
  },
  {
    "text": "is taken the event is dropped and then the error is returned",
    "start": "1304580",
    "end": "1309620"
  },
  {
    "text": "so we'll talk about all these flags so different flags in different uh",
    "start": "1309620",
    "end": "1316280"
  },
  {
    "text": "dlls can be attacked the only difference is the error returns after the attack",
    "start": "1316280",
    "end": "1321799"
  },
  {
    "text": "when you we disable wmi so we'll try we'll start with the global Boolean variable do not allow new",
    "start": "1321799",
    "end": "1328520"
  },
  {
    "text": "connections when the WM Accord dll is loaded then it is set to false",
    "start": "1328520",
    "end": "1334039"
  },
  {
    "text": "in the when the it is unloaded in the shutdown method it is set to True when a",
    "start": "1334039",
    "end": "1340520"
  },
  {
    "text": "new double my commission comes in ensuring it initialize is finally called and uh when is it called if it's false",
    "start": "1340520",
    "end": "1349340"
  },
  {
    "text": "then the initialize the the system is initialized and uh everything works correctly if an",
    "start": "1349340",
    "end": "1356539"
  },
  {
    "text": "attacker comes in on on the uh to turn this value to true then the insurers initial initialize and return an error",
    "start": "1356539",
    "end": "1363740"
  },
  {
    "text": "which is called a server stopping so now it's time for the first demo",
    "start": "1363740",
    "end": "1370299"
  },
  {
    "text": "thank you",
    "start": "1402200",
    "end": "1405039"
  },
  {
    "text": "amazing",
    "start": "1450320",
    "end": "1452980"
  },
  {
    "text": "foreign",
    "start": "1483200",
    "end": "1485440"
  },
  {
    "text": "thank you",
    "start": "1516320",
    "end": "1518440"
  },
  {
    "text": "cool nice",
    "start": "1538220",
    "end": "1542559"
  },
  {
    "text": "thank you so let's introduce wmi check which is a tool developed by Andre redplate",
    "start": "1544340",
    "end": "1551980"
  },
  {
    "text": "consists of a console app and a kernel driver it can it can scan uh the process",
    "start": "1552279",
    "end": "1559100"
  },
  {
    "text": "process and parse the wmi internal objects uh you can do that for a specific",
    "start": "1559100",
    "end": "1564740"
  },
  {
    "text": "process and also for uh for the whole system on the right side we have the all",
    "start": "1564740",
    "end": "1570559"
  },
  {
    "text": "the options that are supported on the left side uh it's a screenshot of how uh double my check can detect uh wmi data",
    "start": "1570559",
    "end": "1579020"
  },
  {
    "text": "patching so you have a snapshot before and after the attack comparing the",
    "start": "1579020",
    "end": "1584059"
  },
  {
    "text": "snapshot you see how the internal flags are modified between a different instances so next demo showing how to",
    "start": "1584059",
    "end": "1592940"
  },
  {
    "text": "detect the previous attack using the wmi check",
    "start": "1592940",
    "end": "1599380"
  },
  {
    "text": "you know",
    "start": "1635900",
    "end": "1638679"
  },
  {
    "text": "[Music] okay",
    "start": "1656300",
    "end": "1660100"
  },
  {
    "text": "foreign core event delivery this is an internal",
    "start": "1667460",
    "end": "1674059"
  },
  {
    "text": "flag the offset C in the ESC session uh field of C repository class",
    "start": "1674059",
    "end": "1680240"
  },
  {
    "text": "pretty much when the dll is loaded the event delivery is set to its default",
    "start": "1680240",
    "end": "1686120"
  },
  {
    "text": "value which is false in start event delivery is set to true and stop event delivery it is sent to false same same",
    "start": "1686120",
    "end": "1693620"
  },
  {
    "text": "attack pattern you have an interesting event coming in you have the delivery delivery implicit event function an",
    "start": "1693620",
    "end": "1699799"
  },
  {
    "text": "attacker will come in and Patch this flag to false so that the winner is nowhere or is is",
    "start": "1699799",
    "end": "1707240"
  },
  {
    "text": "sent that's actually an error if you use failed on this error it returns true",
    "start": "1707240",
    "end": "1713480"
  },
  {
    "text": "uh so what happened all the intrinsic events are disabled and let's see another demo",
    "start": "1713480",
    "end": "1721100"
  },
  {
    "text": "about how this works",
    "start": "1721100",
    "end": "1725799"
  },
  {
    "text": "foreign",
    "start": "1762559",
    "end": "1764799"
  },
  {
    "text": "okay",
    "start": "1795919",
    "end": "1798039"
  },
  {
    "text": "thank you",
    "start": "1806779",
    "end": "1809380"
  },
  {
    "text": "[Applause]",
    "start": "1818810",
    "end": "1822950"
  },
  {
    "text": "let's move on the next attack is a global Boolean variable which is called",
    "start": "1841580",
    "end": "1847340"
  },
  {
    "text": "shutting down when the DLR is loaded he said we need a",
    "start": "1847340",
    "end": "1852620"
  },
  {
    "text": "value which is false in the initialize class in C repository in a initialize",
    "start": "1852620",
    "end": "1858080"
  },
  {
    "text": "method in C repository is sent to false in the shutdown set to true this uh flag is checked in more than 50",
    "start": "1858080",
    "end": "1864860"
  },
  {
    "text": "functions so a template of this of a dispatching routine looks like this so the obvious",
    "start": "1864860",
    "end": "1871880"
  },
  {
    "text": "attack is just to set the flag to uh to false because it's the reverse uh",
    "start": "1871880",
    "end": "1878179"
  },
  {
    "text": "logic and then um true actually to to make sure that the",
    "start": "1878179",
    "end": "1885380"
  },
  {
    "text": "error is returned uh if it if it falls then the internal dispatch is uh is",
    "start": "1885380",
    "end": "1891740"
  },
  {
    "text": "executed now let's move to another flag in the G Global instance a global instance of the",
    "start": "1891740",
    "end": "1899779"
  },
  {
    "text": "field of set 0 g Globe is a group a global instance for the C globals class",
    "start": "1899779",
    "end": "1905840"
  },
  {
    "text": "in the Constructor we see it is set one in the initialize method it is set to",
    "start": "1905840",
    "end": "1911000"
  },
  {
    "text": "zero and we have this uh call stack when a new filter comes in put object is",
    "start": "1911000",
    "end": "1917120"
  },
  {
    "text": "called and also calls the get core Services um",
    "start": "1917120",
    "end": "1923919"
  },
  {
    "text": "next and then the attack is again obvious we set this value to zero so the",
    "start": "1924200",
    "end": "1929779"
  },
  {
    "text": "return return is an error the WMA initialization failure which will be",
    "start": "1929779",
    "end": "1938500"
  },
  {
    "text": "picked out by the put object and then return return",
    "start": "1940700",
    "end": "1947559"
  },
  {
    "text": "the error next uh this is the same attack",
    "start": "1947720",
    "end": "1952880"
  },
  {
    "text": "as the previous one the the field that offset 38 in the same",
    "start": "1952880",
    "end": "1959000"
  },
  {
    "text": "G globe instance the only difference is that the",
    "start": "1959000",
    "end": "1964880"
  },
  {
    "text": "the field that offset 38 is actually a pointer to an interface to double my core services and the obvious attack is",
    "start": "1964880",
    "end": "1972020"
  },
  {
    "text": "uh just setting uh null or zero to this to this value which will make uh",
    "start": "1972020",
    "end": "1979700"
  },
  {
    "text": "get core Services return the same error as before now uh the",
    "start": "1979700",
    "end": "1986120"
  },
  {
    "text": "word field at the offset BC in the in G globe it's set one when when the dll is loaded",
    "start": "1986120",
    "end": "1993620"
  },
  {
    "text": "in an ash in in uninitialized is set to uh zero when uh double my connection",
    "start": "1993620",
    "end": "2000580"
  },
  {
    "text": "comes in we have the deserialization function file to instance called and in there we",
    "start": "2000580",
    "end": "2008679"
  },
  {
    "text": "see that if it's zero it returns uh error server shutdown in progress which",
    "start": "2008679",
    "end": "2013779"
  },
  {
    "text": "is an internal error so the attackers has to set this uh field to zero then uh",
    "start": "2013779",
    "end": "2020860"
  },
  {
    "text": "the internal error is uh is set and it's translated on out to a external error a",
    "start": "2020860",
    "end": "2027580"
  },
  {
    "text": "w bam error in the A51 translator or code",
    "start": "2027580",
    "end": "2032940"
  },
  {
    "text": "and the next is the G underscore p e s s",
    "start": "2033039",
    "end": "2039039"
  },
  {
    "text": "M4 which is a global variable that keeps the pointer to an interface",
    "start": "2039039",
    "end": "2045399"
  },
  {
    "text": "so uh when the dll is loaded it is set to null then uh it's it is set using the",
    "start": "2045399",
    "end": "2053260"
  },
  {
    "text": "query interface in the initss and then it is released the interface is pointer to the",
    "start": "2053260",
    "end": "2059679"
  },
  {
    "text": "interface is released when shut down ESS is called so we have this call stack",
    "start": "2059679",
    "end": "2066580"
  },
  {
    "text": "and we get the last two functions the exact notification query calls get ESS",
    "start": "2066580",
    "end": "2072220"
  },
  {
    "text": "sync which is just returning that uh that variable and then based on the in",
    "start": "2072220",
    "end": "2078638"
  },
  {
    "text": "return if the if an attacker comes in and Patch the uh the global uh variable",
    "start": "2078639",
    "end": "2084580"
  },
  {
    "text": "and set null to it then this will the the calling function will return the WN",
    "start": "2084580",
    "end": "2091898"
  },
  {
    "text": "not supported next a new type of attack is some some",
    "start": "2091899",
    "end": "2097780"
  },
  {
    "text": "boxing wmi so wmi Service as we mentioned uh communicate with uh",
    "start": "2097780",
    "end": "2104260"
  },
  {
    "text": "providers and client consumers using Advanced LPC uh connections also it",
    "start": "2104260",
    "end": "2110740"
  },
  {
    "text": "interacts with the file system on the registry as we mentioned before so to sandbox wmi",
    "start": "2110740",
    "end": "2118119"
  },
  {
    "text": "agent wmi uh service to only isolate him it from the OS we have to set the",
    "start": "2118119",
    "end": "2124839"
  },
  {
    "text": "untrust the Integrity level to untrusted and we have to revoke the SE impersonal",
    "start": "2124839",
    "end": "2131619"
  },
  {
    "text": "privilege privilege of the service app and what's happening",
    "start": "2131619",
    "end": "2138359"
  },
  {
    "text": "this then the service become isolated every connection request will get the access denied",
    "start": "2138359",
    "end": "2144880"
  },
  {
    "text": "and how this is uh achieved we can do this in on in the user land",
    "start": "2144880",
    "end": "2150760"
  },
  {
    "text": "using uh these two functions and then you can use decom attack in the kernel",
    "start": "2150760",
    "end": "2156220"
  },
  {
    "text": "to modify the the token uh belonging to the wmi service",
    "start": "2156220",
    "end": "2162400"
  },
  {
    "text": "and as a result we have a sandboxed wmi service",
    "start": "2162400",
    "end": "2167740"
  },
  {
    "text": "so let's introduce let me introduce the memory Ranger which is a solution that can prevent against the decom attack on",
    "start": "2167740",
    "end": "2174160"
  },
  {
    "text": "the uh on the wmi token of the of the wmi service process how this is done uh",
    "start": "2174160",
    "end": "2181180"
  },
  {
    "text": "the memory Rangers uh traps the loading of the attacker's driver creates a",
    "start": "2181180",
    "end": "2188680"
  },
  {
    "text": "memory a separate memory Enclave where the attacker's driver is running in",
    "start": "2188680",
    "end": "2194020"
  },
  {
    "text": "where it doesn't have any access to uh modify the token belonging to double my",
    "start": "2194020",
    "end": "2200560"
  },
  {
    "text": "service so um as a conclusion",
    "start": "2200560",
    "end": "2206339"
  },
  {
    "text": "we did this research more like to tell the industry that they",
    "start": "2206339",
    "end": "2213460"
  },
  {
    "text": "when they're leveraging some type of solutions they understand their risks",
    "start": "2213460",
    "end": "2219160"
  },
  {
    "text": "that they're uh there is that they are exposed to so this is",
    "start": "2219160",
    "end": "2224980"
  },
  {
    "text": "in any case A bash of that is a very very interesting uh and very very useful",
    "start": "2224980",
    "end": "2231640"
  },
  {
    "text": "uh solution is more like a wake-up call be sure you have in place",
    "start": "2231640",
    "end": "2238180"
  },
  {
    "text": "mitigations are way to detect if this functionality has been tampered with either disabled or or to",
    "start": "2238180",
    "end": "2246220"
  },
  {
    "text": "send bogus information uh and everything that we showed that uh",
    "start": "2246220",
    "end": "2251579"
  },
  {
    "text": "all the attacks that we showed are attacking the the architectural weaknesses we call this attacks uh most",
    "start": "2251579",
    "end": "2258460"
  },
  {
    "text": "of them are one bit change attack you just flip",
    "start": "2258460",
    "end": "2264520"
  },
  {
    "text": "a bit and everything is disabled we introduced wmi check that can pretty",
    "start": "2264520",
    "end": "2272200"
  },
  {
    "text": "much detect W my attacks on on the on the on the",
    "start": "2272200",
    "end": "2279520"
  },
  {
    "text": "service data and then memory Ranger that can prevent the sandboxing of wmi",
    "start": "2279520",
    "end": "2286720"
  },
  {
    "text": "for the decoma the data kernel object direct kernel object manipulation attack",
    "start": "2286720",
    "end": "2293740"
  },
  {
    "text": "so another conclusion to conclusion pretty much all these attacks can originate from uh from firmware and uh",
    "start": "2293740",
    "end": "2301900"
  },
  {
    "text": "right now former is a big blind spot for the industry and we see every time we have uh",
    "start": "2301900",
    "end": "2309520"
  },
  {
    "text": "different attacks that originate in firmware that has been stealthy for for six to seven years so I think this",
    "start": "2309520",
    "end": "2318040"
  },
  {
    "text": "is one thing that I want to leave everybody out that this attacks happen in the user land what can originate in",
    "start": "2318040",
    "end": "2324640"
  },
  {
    "text": "the formula also one one to plug uh my co-founder and CEO of Winery talk that",
    "start": "2324640",
    "end": "2331900"
  },
  {
    "text": "follows this talk at 11 10. which is very interesting one it will he'll drop",
    "start": "2331900",
    "end": "2337119"
  },
  {
    "text": "11 new vulnerabilities and you will talk about exploiting early boot phases",
    "start": "2337119",
    "end": "2343839"
  },
  {
    "text": "thank you very much [Music]",
    "start": "2343839",
    "end": "2350989"
  },
  {
    "text": "[Music]",
    "start": "2354840",
    "end": "2357929"
  }
]