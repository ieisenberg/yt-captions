[
  {
    "start": "0",
    "end": "151000"
  },
  {
    "text": "all right so today we're going to be talking about methodology for auditing in this case endpoint security products",
    "start": "0",
    "end": "8429"
  },
  {
    "text": "the particularly use case that we'll be referring to is sis Mon here but really",
    "start": "8429",
    "end": "13710"
  },
  {
    "text": "the methodology that we cover could absolutely be applied to any endpoint security product out there so we're",
    "start": "13710",
    "end": "20580"
  },
  {
    "text": "definitely not here today to pick on sis Mon per se some of the tradecraft and bypasses and evasions that we'll talk",
    "start": "20580",
    "end": "27689"
  },
  {
    "text": "about will absolutely apply to other products so my name is Matt Graber I'm a security",
    "start": "27689",
    "end": "33329"
  },
  {
    "text": "researcher at Specter ops I've also been involved in a good amount of threat hunting work recently which I really",
    "start": "33329",
    "end": "39510"
  },
  {
    "text": "enjoy traditionally more offensively minded but getting to apply that in a",
    "start": "39510",
    "end": "45840"
  },
  {
    "text": "threatening threat hunting scenario has been a ton of fun and has been really eye-opening and really serves to make me",
    "start": "45840",
    "end": "52020"
  },
  {
    "text": "a better red teamer so I also really enjoyed burning tradecraft publicly",
    "start": "52020",
    "end": "58410"
  },
  {
    "text": "I would rather you know nation-state adversaries not have complete control",
    "start": "58410",
    "end": "64049"
  },
  {
    "text": "over tradecraft not to say that you know ours is the caliber of nation-states but anything",
    "start": "64049",
    "end": "69210"
  },
  {
    "text": "that we can get out there we try to be as transparent as possible which will include some of the tradecraft that",
    "start": "69210",
    "end": "75270"
  },
  {
    "text": "we'll cover today my name is Lee Kristensen I am a security researcher and operator at",
    "start": "75270",
    "end": "82380"
  },
  {
    "text": "Specter ops so things that includes is red teaming thread hunt hunting and I",
    "start": "82380",
    "end": "88200"
  },
  {
    "text": "just do a security research at when I can so I really like shiny security",
    "start": "88200",
    "end": "93659"
  },
  {
    "text": "things whatever it may be that's why I hold no allegiance to the red or blue side just any fascinating security",
    "start": "93659",
    "end": "100680"
  },
  {
    "text": "product that's out there I like to go after and some of you may be wondering why we're wearing these ridiculous",
    "start": "100680",
    "end": "107850"
  },
  {
    "text": "outfits well this is all for charity and we have some big thank yous that we need",
    "start": "107850",
    "end": "114060"
  },
  {
    "text": "to throw out for we a berry blow dart on Twitter for kicking off the charity event at Dave Kennedy and that and skip",
    "start": "114060",
    "end": "122009"
  },
  {
    "text": "tuck wall for some major contributions and of course thanks to everybody who contributed to the charity drive this is",
    "start": "122009",
    "end": "127890"
  },
  {
    "text": "for MDA I will have a link at the end but if any of you feel free feel free to contribute",
    "start": "127890",
    "end": "133290"
  },
  {
    "text": "to the charity it's something that's dear to us and our teams though appreciate any donations just so you know this is like",
    "start": "133290",
    "end": "139170"
  },
  {
    "text": "really awkward for us like we're not the type so you usually like beg for attention but well what we'll do as much",
    "start": "139170",
    "end": "146250"
  },
  {
    "text": "as we can within reason to support a good cause so what are we going to be",
    "start": "146250",
    "end": "152879"
  },
  {
    "start": "151000",
    "end": "151000"
  },
  {
    "text": "talking about today we're going to start off talking about the goals of an evasive adversary we're going to present",
    "start": "152879",
    "end": "159030"
  },
  {
    "text": "the detection a typical detection methodology and then we're gonna present the subversion subverting detection",
    "start": "159030",
    "end": "167310"
  },
  {
    "text": "methodology dive into why we're targeting system on we're going to since",
    "start": "167310",
    "end": "172950"
  },
  {
    "text": "dismount is a data collector we're going to talk about some subversion strategy strategies for data collectors then wrap",
    "start": "172950",
    "end": "178889"
  },
  {
    "text": "up with some conclusions from our research goals of an evasive adversary",
    "start": "178889",
    "end": "185549"
  },
  {
    "text": "so ultimately the goal of an adversary of any base of adversary is to avoid",
    "start": "185549",
    "end": "192389"
  },
  {
    "text": "detection at an organizational level so if AV failed if AV catches something and",
    "start": "192389",
    "end": "198120"
  },
  {
    "text": "it's not forwarded to the back end to wear the sock can analyze it that means detection has failed because the",
    "start": "198120",
    "end": "204419"
  },
  {
    "text": "adversary is going undetected from an organizational level this can be",
    "start": "204419",
    "end": "209519"
  },
  {
    "text": "accomplished by blending in with normal by exploiting defender biases when",
    "start": "209519",
    "end": "214590"
  },
  {
    "text": "they're on the writing detection rules avoid and in general just avoiding human eyes altogether so if we can subvert the",
    "start": "214590",
    "end": "221519"
  },
  {
    "text": "detection tools or data sources then we will be successful as an evasive",
    "start": "221519",
    "end": "227689"
  },
  {
    "text": "adversary so ultimately subverting",
    "start": "227689",
    "end": "235829"
  },
  {
    "start": "232000",
    "end": "232000"
  },
  {
    "text": "security solutions really is just an engineering challenge of more mature",
    "start": "235829",
    "end": "240900"
  },
  {
    "text": "adversaries so as a red teamer of a sufficient maturity level you really",
    "start": "240900",
    "end": "247439"
  },
  {
    "text": "should be trying to emulate that so I know some vendors will certainly be sensitive about researchers showing off",
    "start": "247439",
    "end": "255900"
  },
  {
    "text": "bypasses for their specific products we're more about showing general evasive",
    "start": "255900",
    "end": "261959"
  },
  {
    "text": "techniques that can apply to one or many security products",
    "start": "261959",
    "end": "267150"
  },
  {
    "text": "so if the adversaries are doing that then if we want to deliver value to our customers or any defenders out there as",
    "start": "267150",
    "end": "274290"
  },
  {
    "text": "well or if a red teamer just what yeah if a red team wants to provide as much value",
    "start": "274290",
    "end": "280380"
  },
  {
    "text": "as possible then they should be doing these same things and identifying the",
    "start": "280380",
    "end": "285389"
  },
  {
    "text": "key terrain in their target environment and having evasions prepared so like we",
    "start": "285389",
    "end": "293460"
  },
  {
    "text": "said ultimately a an organization wants to be able to detect attacker to detect",
    "start": "293460",
    "end": "299790"
  },
  {
    "text": "attacker attacker activity inside of their network so what goes into building",
    "start": "299790",
    "end": "306360"
  },
  {
    "text": "out a detection because that's going to influence us if we're trying to subvert it so and at a generalized adversary",
    "start": "306360",
    "end": "314220"
  },
  {
    "text": "detection methodology is you identifying at an attack technique so this could be a lateral move a specific lateral",
    "start": "314220",
    "end": "320639"
  },
  {
    "text": "movement technique or privilege escalation technique you find a data source that may inform you or that may",
    "start": "320639",
    "end": "328080"
  },
  {
    "text": "provide data about when that technique occurs so that could be like process when a process is created it could come",
    "start": "328080",
    "end": "335100"
  },
  {
    "text": "from something like an etw provider then you have to actually have a tool that will do this collection so in this",
    "start": "335100",
    "end": "342300"
  },
  {
    "text": "system on fits this case it is a data collection tool so we're gonna apply a strategy to subverting that data",
    "start": "342300",
    "end": "348870"
  },
  {
    "text": "collection tool I did just want to highlight that sis Mon is not we've been consider it to be like a full fledge",
    "start": "348870",
    "end": "354690"
  },
  {
    "text": "endpoint security product it really is just a data collector that can be used to supplement existing or additional",
    "start": "354690",
    "end": "362340"
  },
  {
    "text": "data sources and that brings us right into the next step of the detection methodology which is transport so this",
    "start": "362340",
    "end": "368130"
  },
  {
    "text": "can take place within us endpoint solution itself or the transport of events from an endpoint to a back-end",
    "start": "368130",
    "end": "374729"
  },
  {
    "text": "analysis system like a sim so and then there's enrichment and analysis that",
    "start": "374729",
    "end": "381510"
  },
  {
    "text": "goes on with any events that are transported and then there's some sort of classification whether it's malicious",
    "start": "381510",
    "end": "387289"
  },
  {
    "text": "suspicious or benign and then of course if it is malicious or maybe suspicious",
    "start": "387289",
    "end": "393180"
  },
  {
    "text": "there's going to be some sort of alert maybe there's a blocking action as a response this could also occur",
    "start": "393180",
    "end": "400289"
  },
  {
    "text": "like with antivirus if there is an alert it may write it to an event log and then",
    "start": "400289",
    "end": "405419"
  },
  {
    "text": "that Event log will be transported hopefully eventually back to the backend syn so as just as we have these you know",
    "start": "405419",
    "end": "416550"
  },
  {
    "text": "seven steps for a detection methodology those exact same steps inform our",
    "start": "416550",
    "end": "421889"
  },
  {
    "text": "subversion methodology so essentially the detection subversion methodology is",
    "start": "421889",
    "end": "428129"
  },
  {
    "text": "evading or tampering with any of the steps of the detection methodology so",
    "start": "428129",
    "end": "433949"
  },
  {
    "text": "instead of as a converse to the first step an attacker can select specific",
    "start": "433949",
    "end": "439199"
  },
  {
    "text": "techniques that the target organization may not be aware of they may they may",
    "start": "439199",
    "end": "444360"
  },
  {
    "text": "subvert data sources so they could disable a specific etw provider if that's being used to fund to generate",
    "start": "444360",
    "end": "451649"
  },
  {
    "text": "the data but they could subvert the data collection tool so suspending the tool",
    "start": "451649",
    "end": "457169"
  },
  {
    "text": "or killing off the process an ET w like is kind of all the rage with a lot of specific vendors out there and then just",
    "start": "457169",
    "end": "465569"
  },
  {
    "text": "say an attacker may also take the approach of subverting the transport of that data so disabling a log forwarder",
    "start": "465569",
    "end": "474529"
  },
  {
    "text": "you know the classification engine say there's a specific signature so AV is a",
    "start": "474529",
    "end": "480569"
  },
  {
    "text": "classic example of this it's a very much signature base so we just have to bypass the signature and that's the component",
    "start": "480569",
    "end": "487680"
  },
  {
    "text": "we're attacking the classification component there and then alerting and response so and we somehow prevent an",
    "start": "487680",
    "end": "494999"
  },
  {
    "text": "alert from ever being sent off to the sock to be analyzed so we can disable a",
    "start": "494999",
    "end": "500039"
  },
  {
    "text": "log forwarder if that's what they're using to ship to essentially ship off that or we could use a firewall to block",
    "start": "500039",
    "end": "505559"
  },
  {
    "text": "any communication of the endpoint to back-end alerting systems so it sounds",
    "start": "505559",
    "end": "510599"
  },
  {
    "text": "like what you're referring to is like a macro and a micro evasion strategy yep yep exactly so you have at a micro level",
    "start": "510599",
    "end": "517979"
  },
  {
    "text": "you have what's occurring on an endpoint or some other part of the network but if if detection occurs there the overall",
    "start": "517979",
    "end": "525600"
  },
  {
    "text": "goal of the organization at deep identifying that there's an attacker is",
    "start": "525600",
    "end": "530880"
  },
  {
    "text": "not complete so the endpoint alerting has occurred but somehow that that alert needs to",
    "start": "530880",
    "end": "537270"
  },
  {
    "text": "also be transported to the back end so that sock the sock and the security team at an organizational level becomes aware",
    "start": "537270",
    "end": "543960"
  },
  {
    "text": "of the detection as well so you can subvert it at the micro level on the end",
    "start": "543960",
    "end": "549150"
  },
  {
    "text": "point so you can subvert detection there and if you can also subvert detection at",
    "start": "549150",
    "end": "554370"
  },
  {
    "text": "the back row level of preventing the sock or the organization from knowing about the alert then you you are",
    "start": "554370",
    "end": "560220"
  },
  {
    "text": "successful as an attacker so we found that categorizing the holistic evasion",
    "start": "560220",
    "end": "566460"
  },
  {
    "text": "methodology as such or the detection methodology as such as although while",
    "start": "566460",
    "end": "571800"
  },
  {
    "text": "each of these events may seem obvious and intuitive we tend to like to have",
    "start": "571800",
    "end": "577050"
  },
  {
    "text": "them written out because each category will have separate evasion strategies",
    "start": "577050",
    "end": "583470"
  },
  {
    "text": "and tactics evolved involved in each one of them so what was our rationale for",
    "start": "583470",
    "end": "592860"
  },
  {
    "text": "targeting system on specifically again defenders use it heavily I know of some vendors that actually take dependencies",
    "start": "592860",
    "end": "599700"
  },
  {
    "text": "on it some of which those products we've run into and in enterprises so again",
    "start": "599700",
    "end": "606990"
  },
  {
    "text": "we're not here to pick on sis Mon per se we actually have a lot of nice things to say and some of the tradecraft that will",
    "start": "606990",
    "end": "614160"
  },
  {
    "text": "cover bypasses not only or evades and bypasses not only sis Mon but is likely",
    "start": "614160",
    "end": "619950"
  },
  {
    "text": "to evade other products as well so we're",
    "start": "619950",
    "end": "626310"
  },
  {
    "text": "gonna cific we focus on data collector subversion strategies like we mentioned sis Mon is a data collector so that fits",
    "start": "626310",
    "end": "633300"
  },
  {
    "text": "in right with step 3 in that date in the detection methodology so we're gonna",
    "start": "633300",
    "end": "639570"
  },
  {
    "text": "apply some strategies that we've come up with to subvert and data collectors our",
    "start": "639570",
    "end": "645390"
  },
  {
    "text": "interest as attackers is tampering evasion opportunities and any part of",
    "start": "645390",
    "end": "651690"
  },
  {
    "text": "the attack surface that we could take advantage of so if there's any vulnerabilities in our experience most",
    "start": "651690",
    "end": "657060"
  },
  {
    "text": "vendors but tend to focus on the attack surface analysis maybe pay attention to",
    "start": "657060",
    "end": "663420"
  },
  {
    "text": "the tampering part of it but very few our attention to or putting a lot of",
    "start": "663420",
    "end": "668840"
  },
  {
    "text": "research into the evasion aspect of things as well they acknowledge the the tavis threat yes so again we're gonna",
    "start": "668840",
    "end": "677870"
  },
  {
    "text": "focus on the data collectors and system on is that the strategies we will be talking about are you know number one",
    "start": "677870",
    "end": "684820"
  },
  {
    "text": "familiarization and scoping of your of your research data source resilience",
    "start": "684820",
    "end": "690350"
  },
  {
    "text": "auditing footprint and attack surface analysis data collection implementation",
    "start": "690350",
    "end": "695990"
  },
  {
    "text": "analysis and the configuration of the tool so that type of analysis so step",
    "start": "695990",
    "end": "704210"
  },
  {
    "start": "702000",
    "end": "702000"
  },
  {
    "text": "number one tool familiar is Asian and scoping a big part of this is just understanding what the purpose of the",
    "start": "704210",
    "end": "709760"
  },
  {
    "text": "tool is and understanding the guarantees so what do we mean by guarantees this is",
    "start": "709760",
    "end": "715550"
  },
  {
    "text": "tampering guarantees under which circumstances can an attacker or does a",
    "start": "715550",
    "end": "721010"
  },
  {
    "text": "product protect protect against an attacker and also the collection guarantees of that tool so what events",
    "start": "721010",
    "end": "729320"
  },
  {
    "text": "does the the tool claim that it is collecting and does it do so correct",
    "start": "729320",
    "end": "734350"
  },
  {
    "text": "correctly and then understanding the threat models so kind of going along with that tampering guarantee what type",
    "start": "734350",
    "end": "741590"
  },
  {
    "text": "of attacker is the tool secure against",
    "start": "741590",
    "end": "747280"
  },
  {
    "text": "so is this a low privileged attacker is it an administrator is it somebody in the kernel which which aspect of attack",
    "start": "747280",
    "end": "754580"
  },
  {
    "text": "or what type of attacker does the product protect against and in general I just getting comfortable with the tool",
    "start": "754580",
    "end": "761060"
  },
  {
    "text": "so and just installing it configuring it using it seeing how it's used as it from",
    "start": "761060",
    "end": "766760"
  },
  {
    "text": "an organ organization so this bond taking the same approach so this one is",
    "start": "766760",
    "end": "773780"
  },
  {
    "text": "a user mode activity sensor so it's not going to be monitoring things inside of",
    "start": "773780",
    "end": "779300"
  },
  {
    "text": "the kernel that's not its purpose it's just its functions as a standalone",
    "start": "779300",
    "end": "784550"
  },
  {
    "text": "executable and driver that's how it implements this these components there",
    "start": "784550",
    "end": "790130"
  },
  {
    "text": "isn't any sort of centralized deployment and configuration management most organizations are going to end up",
    "start": "790130",
    "end": "796280"
  },
  {
    "text": "deploying it through some third-party tool I could be secm could be pío name your favorite tool there are",
    "start": "796280",
    "end": "804300"
  },
  {
    "text": "like Matt mentioned there's no analysis capabilities inside of sis Mon it's a",
    "start": "804300",
    "end": "809399"
  },
  {
    "text": "data collector you write data collection rules analysis takes place in with your",
    "start": "809399",
    "end": "814860"
  },
  {
    "text": "detection rules inside of something like a sim notice that Lee mentioned data collection rules versus detection rules",
    "start": "814860",
    "end": "823580"
  },
  {
    "text": "that's an important distinction I think and again that guarantees of sis mom is",
    "start": "823580",
    "end": "829830"
  },
  {
    "text": "that it's resistant against a non administrator so once an attacker",
    "start": "829830",
    "end": "834990"
  },
  {
    "text": "becomes admin all other protections that it has in place are no longer guaranteed",
    "start": "834990",
    "end": "840560"
  },
  {
    "text": "in addition those data sources from which sis mom pulls events it it has",
    "start": "840560",
    "end": "848850"
  },
  {
    "text": "guarantees that it is comprehensively collecting those at unless there are",
    "start": "848850",
    "end": "855089"
  },
  {
    "text": "filtering rules in place so this is important because back end sock analysts",
    "start": "855089",
    "end": "860520"
  },
  {
    "text": "are assuming that everything that sis Mon is reporting is the the whole",
    "start": "860520",
    "end": "865980"
  },
  {
    "text": "picture that nothing is being filtered and that it's comprehensive so that's the guarantee that system ax is making",
    "start": "865980",
    "end": "871680"
  },
  {
    "text": "unless there's filtering rules in place so data source for data source",
    "start": "871680",
    "end": "877709"
  },
  {
    "start": "875000",
    "end": "875000"
  },
  {
    "text": "resilience auditing this is a critical step that we would take when assessing a",
    "start": "877709",
    "end": "883320"
  },
  {
    "text": "new product in this case this Mon so the questions that we would ask ourselves are one what events and event fields",
    "start": "883320",
    "end": "890880"
  },
  {
    "text": "does this product capture and of those event fields and event types that exist",
    "start": "890880",
    "end": "896510"
  },
  {
    "text": "what of those can be directly or indirectly influenced by an evasive",
    "start": "896510",
    "end": "903149"
  },
  {
    "text": "attacker and finally what fields do defenders typically use when building",
    "start": "903149",
    "end": "909630"
  },
  {
    "text": "collection rules because armed with that knowledge we can exploit naive detection",
    "start": "909630",
    "end": "918450"
  },
  {
    "text": "or rule creation methodology that your your typical defender might have so",
    "start": "918450",
    "end": "926970"
  },
  {
    "text": "first we would look at whether or not there are generic rule evasions so we",
    "start": "926970",
    "end": "933750"
  },
  {
    "text": "have to identify what can be logged and what attributes of the event can be influenced so sis Mon supports all of",
    "start": "933750",
    "end": "941010"
  },
  {
    "text": "the following event types so you actually have some pretty good coverage and it is pretty understandable why",
    "start": "941010",
    "end": "948180"
  },
  {
    "text": "defenders really likes this mod because it really is an outstanding supplementary source of event data so",
    "start": "948180",
    "end": "956550"
  },
  {
    "text": "I'm gonna go through a more detailed example covering process create in just a moment but our methodology would be",
    "start": "956550",
    "end": "964440"
  },
  {
    "text": "looking through each of these event types for example we'll cover wynia event soon and we have a new generic",
    "start": "964440",
    "end": "971670"
  },
  {
    "text": "whimmy event evasion such that it would never be logged in the first place for things that are not directly under our",
    "start": "971670",
    "end": "978510"
  },
  {
    "text": "control we could fall back to either influencing what fields can be modified",
    "start": "978510",
    "end": "985470"
  },
  {
    "text": "by us or exploit the rule engine itself",
    "start": "985470",
    "end": "990930"
  },
  {
    "text": "so if we get access to a configuration we can build an evasion strategy that is",
    "start": "990930",
    "end": "996570"
  },
  {
    "text": "specific to that configuration so one thing I wanted to mention was for example the image load event type one of",
    "start": "996570",
    "end": "1003589"
  },
  {
    "text": "the fields that it captures is signature related information for a long time and maybe up until now a lot of defenders",
    "start": "1003589",
    "end": "1010310"
  },
  {
    "text": "still assume that it is a non-trivial process or not even possible to evade",
    "start": "1010310",
    "end": "1017420"
  },
  {
    "text": "signature analysis whereby you'd have something indicating that a signature is",
    "start": "1017420",
    "end": "1023510"
  },
  {
    "text": "valid and say that it is signed by Microsoft so both of those aspects of",
    "start": "1023510",
    "end": "1028730"
  },
  {
    "text": "code signing can be completely subverted and there's various types of attacks I",
    "start": "1028730",
    "end": "1033949"
  },
  {
    "text": "have a white paper that covers one such class of attacks where signature",
    "start": "1033949",
    "end": "1039438"
  },
  {
    "text": "analysis can be completely evaded so I just want to mention that well let's dive into process create events",
    "start": "1039439",
    "end": "1045500"
  },
  {
    "text": "specifically now this this diagram that I have here just be mindful it's",
    "start": "1045500",
    "end": "1051320"
  },
  {
    "text": "extremely subjective the column on the left and the green is the are the fields",
    "start": "1051320",
    "end": "1056990"
  },
  {
    "text": "that are directly influenza batac ER now the reason it's subjective is because",
    "start": "1056990",
    "end": "1063679"
  },
  {
    "text": "you know this could certainly depend on your initial point of entry whether you came from an exploit a macro",
    "start": "1063679",
    "end": "1069440"
  },
  {
    "text": "where post exploitation factors might not be directly in influenceable this",
    "start": "1069440",
    "end": "1076790"
  },
  {
    "text": "was developed more from the perspective of a true post exploitation scenario so",
    "start": "1076790",
    "end": "1083360"
  },
  {
    "text": "a column in the middle could potentially be influenced by an attacker and then",
    "start": "1083360",
    "end": "1088400"
  },
  {
    "text": "the red ones generally generally speaking you don't have much control if",
    "start": "1088400",
    "end": "1093410"
  },
  {
    "text": "at all over any of those now I didn't just blindly accept that those in the",
    "start": "1093410",
    "end": "1099620"
  },
  {
    "text": "red would not be directly influenced about for example there was a time when",
    "start": "1099620",
    "end": "1104720"
  },
  {
    "text": "I didn't understand how the process good was actually built until I reversed the",
    "start": "1104720",
    "end": "1110620"
  },
  {
    "text": "system on service and learned that is actually comprised of the Machine gooood",
    "start": "1110620",
    "end": "1118400"
  },
  {
    "text": "which can be retrieved from the registry so if you wanted to tamper with that you would you'd have to be admin the time of",
    "start": "1118400",
    "end": "1124520"
  },
  {
    "text": "process start and also the token ID so I had to understand how it was derived so",
    "start": "1124520",
    "end": "1133190"
  },
  {
    "text": "that I could be confident that I was actually placing it in the red in the red category instead of making",
    "start": "1133190",
    "end": "1138740"
  },
  {
    "text": "assumptions because it's those naive assumptions that we as evasive attackers are trying to take advantage of so this",
    "start": "1138740",
    "end": "1148460"
  },
  {
    "text": "is kind of what our goal is when we are auditing configurations specifically so",
    "start": "1148460",
    "end": "1154880"
  },
  {
    "text": "we want to go from landing in our target environment where we're shrouded by the",
    "start": "1154880",
    "end": "1161090"
  },
  {
    "text": "fog of war and so the by the fog of war the analogy would be we haven't we",
    "start": "1161090",
    "end": "1168260"
  },
  {
    "text": "haven't obtained the security configurations in that environment yet our goal ideally is to obtain that",
    "start": "1168260",
    "end": "1175070"
  },
  {
    "text": "configuration ideally without getting caught so in that timeframe between operating getting obtaining situational",
    "start": "1175070",
    "end": "1182390"
  },
  {
    "text": "awareness and ideally not getting caught that is inherently a much more high-risk environment where we're going to have to",
    "start": "1182390",
    "end": "1189440"
  },
  {
    "text": "prioritize using tradecraft such as for example like the generic whimmy evasions",
    "start": "1189440",
    "end": "1195620"
  },
  {
    "text": "really any generic evasion such that the data source would not even",
    "start": "1195620",
    "end": "1200850"
  },
  {
    "text": "enter or be logged by by system on so we need to be mindful that the ultimate",
    "start": "1200850",
    "end": "1206580"
  },
  {
    "text": "goal is obtaining the specific configuration for that environment so in",
    "start": "1206580",
    "end": "1211800"
  },
  {
    "text": "system on your do system on deck see - see now - see provides a nice way to",
    "start": "1211800",
    "end": "1219120"
  },
  {
    "text": "parse out the the rules blob which is contained within the registry considering we also consider attack",
    "start": "1219120",
    "end": "1227100"
  },
  {
    "text": "surface analysis of system on I didn't dive into it too much but I did really",
    "start": "1227100",
    "end": "1232140"
  },
  {
    "text": "need to understand how the binary rules blob in the registry was formed so I did",
    "start": "1232140",
    "end": "1237810"
  },
  {
    "text": "write a parser for that it's a PowerShell module called PS system on Tools so I use that a lot and it offers",
    "start": "1237810",
    "end": "1244800"
  },
  {
    "text": "an alternative way to recover and parse a binary system on configuration so the",
    "start": "1244800",
    "end": "1255360"
  },
  {
    "start": "1252000",
    "end": "1252000"
  },
  {
    "text": "the third step is data are the third strategy is data collection and implementation analysis so this entails",
    "start": "1255360",
    "end": "1263270"
  },
  {
    "text": "understanding what the data sources are for for the collection tool so that",
    "start": "1263270",
    "end": "1269400"
  },
  {
    "text": "could be an e GW provider it could be a kernel driver that a mini filter driver",
    "start": "1269400",
    "end": "1274500"
  },
  {
    "text": "that's queuing up events and then also understanding how do defenders actually",
    "start": "1274500",
    "end": "1280710"
  },
  {
    "text": "use those event fields when they're building out their detection rules and then also understanding is the clue the",
    "start": "1280710",
    "end": "1287100"
  },
  {
    "text": "tool makes a claim and a supposed guarantee that it collects all the data for a field or for a specific event we",
    "start": "1287100",
    "end": "1294540"
  },
  {
    "text": "need to verify that that collection is correct all right so let's talk about",
    "start": "1294540",
    "end": "1302460"
  },
  {
    "text": "the winny event event in sis Mun so our goal is to identify a technique such",
    "start": "1302460",
    "end": "1307740"
  },
  {
    "text": "that we need persistence would never be logged in the first place so we're not talking about evasion in this case",
    "start": "1307740",
    "end": "1313800"
  },
  {
    "text": "ideally we want to tamper with or just bypass that the ability for system on to",
    "start": "1313800",
    "end": "1320130"
  },
  {
    "text": "collect that data in the first place so our strategy is pretty simple we just",
    "start": "1320130",
    "end": "1325200"
  },
  {
    "text": "have to figure out how we need persistence is actually is actually being achieved within the code so this",
    "start": "1325200",
    "end": "1333420"
  },
  {
    "text": "actually didn't require a ton of reverse-engineering in this case I literally just ran strings on sis",
    "start": "1333420",
    "end": "1339940"
  },
  {
    "text": "Mon install that the implementation of whimmy persistence is as follows so this",
    "start": "1339940",
    "end": "1348370"
  },
  {
    "text": "is a WMA query language query so or wql",
    "start": "1348370",
    "end": "1354700"
  },
  {
    "text": "for short now when you register wql event queries they are going to be specific to WMI",
    "start": "1354700",
    "end": "1363070"
  },
  {
    "text": "namespace so there's a ton of WMI classes and they're all organized and stored in different namespaces so the",
    "start": "1363070",
    "end": "1372010"
  },
  {
    "text": "reason that this is specific to the root subscription namespace is because well that is the most common namespace in",
    "start": "1372010",
    "end": "1378670"
  },
  {
    "text": "which the three components of WMI persistence and that's event filters",
    "start": "1378670",
    "end": "1383800"
  },
  {
    "text": "event consumers and filter to consumer bindings would would live in so let's parse this out a little bit so",
    "start": "1383800",
    "end": "1390700"
  },
  {
    "text": "select star so that refers to give me all properties from an instance operation event and that is the",
    "start": "1390700",
    "end": "1397810"
  },
  {
    "text": "superclass of an instance creation instance modification and instance deletion event so this is casting a",
    "start": "1397810",
    "end": "1405760"
  },
  {
    "text": "relatively wide net on W my persistence on whether you're basically creating or",
    "start": "1405760",
    "end": "1411580"
  },
  {
    "text": "modifying existing like in the case of modification modifying existing legitimate W my persistence where the",
    "start": "1411580",
    "end": "1420220"
  },
  {
    "text": "target instance is of what W my class type event consumer so a consumer is",
    "start": "1420220",
    "end": "1425370"
  },
  {
    "text": "where you insert code so that could be a command line event consumer so execute",
    "start": "1425370",
    "end": "1430630"
  },
  {
    "text": "power shell eggsy whatever it could be an active script event consumer or you're executing inline windows script",
    "start": "1430630",
    "end": "1436360"
  },
  {
    "text": "host code like VB script or J script or the target instance is an event filter",
    "start": "1436360",
    "end": "1441790"
  },
  {
    "text": "an event filter defines the event that you want to trigger on in the form of something like this a wql event query or",
    "start": "1441790",
    "end": "1450490"
  },
  {
    "text": "it's a filter to consumer binding this is the thing that binds the filter and consumer together and actually registers",
    "start": "1450490",
    "end": "1457990"
  },
  {
    "text": "the WMI persistence so I know from",
    "start": "1457990",
    "end": "1463150"
  },
  {
    "text": "previous experience that it's not just the root subscription namespace that these persistence these WMI persistence",
    "start": "1463150",
    "end": "1470409"
  },
  {
    "text": "artifacts actually live in they also live in the root default namespace so Microsoft the developers of sis Mon just",
    "start": "1470409",
    "end": "1478409"
  },
  {
    "text": "happened to neglect this one fortunately that will be a really easy fix for them",
    "start": "1478409",
    "end": "1484029"
  },
  {
    "text": "to implement they would just put this same event query and bind it to the root",
    "start": "1484029",
    "end": "1489220"
  },
  {
    "text": "default namespace autoruns has WMI persistence tab and it already",
    "start": "1489220",
    "end": "1494980"
  },
  {
    "text": "captures root subscription and root default based persistence so I wouldn't",
    "start": "1494980",
    "end": "1502059"
  },
  {
    "text": "be extremely satisfied with doing WMI persistence on an op using the root",
    "start": "1502059",
    "end": "1507429"
  },
  {
    "text": "default namespace or one because I'm kind of burning it right here and because it's easy to fix so that may not",
    "start": "1507429",
    "end": "1514809"
  },
  {
    "text": "last forever so can we do better so while on our team we like to come up",
    "start": "1514809",
    "end": "1521980"
  },
  {
    "text": "with with a base of tradecraft eventually release it for others to build detections off of but we're always",
    "start": "1521980",
    "end": "1529809"
  },
  {
    "text": "asking ourselves like can we do better so when this technique eventually is",
    "start": "1529809",
    "end": "1534880"
  },
  {
    "text": "burnt and there are mitigations and or security optics for it we still need to",
    "start": "1534880",
    "end": "1540159"
  },
  {
    "text": "be thinking of the the latest and greatest things so that we can try to win always be winning the the cat and",
    "start": "1540159",
    "end": "1546700"
  },
  {
    "text": "mouse game that's all this is it's just a constant cat and mouse game so I",
    "start": "1546700",
    "end": "1551980"
  },
  {
    "text": "wanted to know if W my persistence was possible outside of the existing known W",
    "start": "1551980",
    "end": "1559149"
  },
  {
    "text": "WI namespaces so I was reading some documentation and this one came up and it turns out that every namespace in WMI",
    "start": "1559149",
    "end": "1567510"
  },
  {
    "text": "is automatically populated with system classes so a system class is any class",
    "start": "1567510",
    "end": "1572799"
  },
  {
    "text": "that starts with underscore underscore three of which are event filter event",
    "start": "1572799",
    "end": "1577899"
  },
  {
    "text": "consumer and filter to consumer binding now what you don't get are these",
    "start": "1577899",
    "end": "1582970"
  },
  {
    "text": "standard Microsoft event consumers which would be like active script event consumer command line event consumer and",
    "start": "1582970",
    "end": "1589510"
  },
  {
    "text": "various others so that's a problem that we don't have those exposed to us in a",
    "start": "1589510",
    "end": "1595299"
  },
  {
    "text": "non-standard namespace so what do we do and just to call out what the goal is",
    "start": "1595299",
    "end": "1601299"
  },
  {
    "text": "here is I would like to perform w my persistence in any arbitrary namespace if possible",
    "start": "1601299",
    "end": "1608200"
  },
  {
    "text": "because traditional W my detections up to this point are focused on namespaces",
    "start": "1608200",
    "end": "1614740"
  },
  {
    "text": "so if any namespace could be used then we're going to need to do better with our detection somehow so we need to",
    "start": "1614740",
    "end": "1622480"
  },
  {
    "text": "figure out how to implement different event consumer classes so ideally I'd",
    "start": "1622480",
    "end": "1629470"
  },
  {
    "text": "love to replicate the active script event consumer or command line event consumer in my namespace of choice so I",
    "start": "1629470",
    "end": "1637210"
  },
  {
    "text": "had to understand the implementation of active super active script event consumers in in this case and so where I",
    "start": "1637210",
    "end": "1644139"
  },
  {
    "text": "would start is by looking at a moth file or a managed object format file this defines kind of like the schema of WMI",
    "start": "1644139",
    "end": "1651759"
  },
  {
    "text": "classes methods properties and it also gives you some information about how they're registered so here's the the",
    "start": "1651759",
    "end": "1659139"
  },
  {
    "text": "definition for active script event consumer and what happens next is the",
    "start": "1659139",
    "end": "1664659"
  },
  {
    "text": "consumer is bound to a provider so aw my there's a ton of classes which represent",
    "start": "1664659",
    "end": "1672220"
  },
  {
    "text": "data that can be collected set or methods that can be executed but under the hood there needs to be code that can",
    "start": "1672220",
    "end": "1679360"
  },
  {
    "text": "either supply classes with information or execute methods and so the code that supplies WMI with this functionality is",
    "start": "1679360",
    "end": "1686080"
  },
  {
    "text": "a provider and these are all registered as comm components these providers and",
    "start": "1686080",
    "end": "1693669"
  },
  {
    "text": "so I saw this and note the clsid they're the one that starts with two six six and",
    "start": "1693669",
    "end": "1699539"
  },
  {
    "text": "what happens is the class is bound to that provider and then the provider",
    "start": "1699539",
    "end": "1705159"
  },
  {
    "text": "itself is registered for that specific namespace now just to show you what that",
    "start": "1705159",
    "end": "1711129"
  },
  {
    "text": "particular provider points to in the registry for active script event consumer the backing provider is SCR",
    "start": "1711129",
    "end": "1717850"
  },
  {
    "text": "cons dot exe this is the component that actually executes the VB script or J",
    "start": "1717850",
    "end": "1724419"
  },
  {
    "text": "scripts when active script event consumer is used so our weaponization strategy is is as",
    "start": "1724419",
    "end": "1730840"
  },
  {
    "text": "follows we want to enable an act descriptive and consumer or command line event consumer for any arbitrary namespace and so I was able to",
    "start": "1730840",
    "end": "1737960"
  },
  {
    "text": "achieve this and you can go to this link I'll make it a public just after this talk and I implemented to PowerShell",
    "start": "1737960",
    "end": "1745880"
  },
  {
    "text": "functions and I'll show off the new active script event consumer class so what this does under the hood is it",
    "start": "1745880",
    "end": "1752240"
  },
  {
    "text": "creates an active script event consumer class using the class name of your",
    "start": "1752240",
    "end": "1757279"
  },
  {
    "text": "choosing so it doesn't have to actually be named active script event consumer and it will live in any arbitrary",
    "start": "1757279",
    "end": "1763279"
  },
  {
    "text": "namespace you want so it's gonna bypass all of the classic WMI based detection z' for persistence so let's dive into a",
    "start": "1763279",
    "end": "1773330"
  },
  {
    "text": "demo here all right so I've got PowerShell up and running and what we're",
    "start": "1773330",
    "end": "1779510"
  },
  {
    "text": "gonna do first is just clear out our sis Mon & Whinney operational event logs I",
    "start": "1779510",
    "end": "1785419"
  },
  {
    "text": "don't want it to be overly populated now I want to show you the currently running",
    "start": "1785419",
    "end": "1791600"
  },
  {
    "text": "sis Mon config and all I'm capturing right now are women events now these three women ents refer to detections for",
    "start": "1791600",
    "end": "1799340"
  },
  {
    "text": "the creation or modification or deletion of event consumer instances event filter",
    "start": "1799340",
    "end": "1806179"
  },
  {
    "text": "instances and filter to consumer binding instances now I'm going to load the code",
    "start": "1806179",
    "end": "1815659"
  },
  {
    "text": "that implements new active script event consumer create my class and notice that",
    "start": "1815659",
    "end": "1821120"
  },
  {
    "text": "the namespace I specified is foo so this is gonna live in the root foo namespace and the class is actually called not an",
    "start": "1821120",
    "end": "1828620"
  },
  {
    "text": "active script event consumer just to show you that you can name it whatever you want",
    "start": "1828620",
    "end": "1834049"
  },
  {
    "text": "so confirms that that was created in the root foo namespace now we're going to",
    "start": "1834049",
    "end": "1841220"
  },
  {
    "text": "create a file that our little payload is going to write to so here's a little VB",
    "start": "1841220",
    "end": "1848570"
  },
  {
    "text": "script payload that we're going to run it's just going to show the the day time",
    "start": "1848570",
    "end": "1853580"
  },
  {
    "text": "it's going to execute every 5 seconds using an interval timer instruction or a",
    "start": "1853580",
    "end": "1860380"
  },
  {
    "text": "interval time will time it class select star from timer event where timer ID",
    "start": "1860380",
    "end": "1865520"
  },
  {
    "text": "equals our timer so the event will trigger every 5 seconds and then we're gonna register our event",
    "start": "1865520",
    "end": "1872880"
  },
  {
    "text": "consumer in this case are not an active script event consumer class in the FEU",
    "start": "1872880",
    "end": "1878250"
  },
  {
    "text": "namespace and finally register everything using a filter to consumer",
    "start": "1878250",
    "end": "1883710"
  },
  {
    "text": "binding so let's run that get our persistence going in the non-standard",
    "start": "1883710",
    "end": "1890820"
  },
  {
    "text": "namespace and if everything works out",
    "start": "1890820",
    "end": "1896190"
  },
  {
    "text": "every five seconds we should see our payload executing as system so nothing",
    "start": "1896190",
    "end": "1903029"
  },
  {
    "text": "terribly special about what you're seeing this is still your classic W my persistence the difference being it",
    "start": "1903029",
    "end": "1909539"
  },
  {
    "text": "lives in an arbitrary namespace using an arbitrary class name now just to prove",
    "start": "1909539",
    "end": "1919169"
  },
  {
    "text": "that the that sis ma does not capture it if n ID 21 refers to creation",
    "start": "1919169",
    "end": "1926460"
  },
  {
    "text": "modification or deletion of filter filter to consumer binding instances so",
    "start": "1926460",
    "end": "1933630"
  },
  {
    "text": "we don't have an event for that if this lived enroute subscription it would have captured it but fortunately starting in",
    "start": "1933630",
    "end": "1943110"
  },
  {
    "text": "Windows 10 we have a mitigating detection which i think is amazing in the microsoft windows WMI activity",
    "start": "1943110",
    "end": "1950250"
  },
  {
    "text": "operational event log we get the full context of that persistence so this is a",
    "start": "1950250",
    "end": "1957360"
  },
  {
    "text": "great way to highlight that sis Mon is very much a supplemental data collection",
    "start": "1957360",
    "end": "1963240"
  },
  {
    "text": "tool so there will always be other better supplementary event log sources in this",
    "start": "1963240",
    "end": "1969389"
  },
  {
    "text": "case if you're in a Windows 10 environment then you get this one so this captures the namespace context the",
    "start": "1969389",
    "end": "1975929"
  },
  {
    "text": "name of the event consumer the class name of the event consumer and all of the contexts related to its registration",
    "start": "1975929",
    "end": "1984740"
  },
  {
    "text": "so bringing bringing this back this is all important in part this was an",
    "start": "1990250",
    "end": "1996440"
  },
  {
    "start": "1992000",
    "end": "1992000"
  },
  {
    "text": "important part of the methodology we're verifying that the data collection tool it said it had a guarantee that I",
    "start": "1996440",
    "end": "2002650"
  },
  {
    "text": "collected w my event subscriptions and in this case we verified that that was not quite the case so highlighting the",
    "start": "2002650",
    "end": "2010300"
  },
  {
    "text": "importance of actually taking that's doing that step in that in the methodology the next step that we're",
    "start": "2010300",
    "end": "2016330"
  },
  {
    "text": "going to do that we performed as part of this was the footprint and an attack surface analysis of sis Mon so our goal",
    "start": "2016330",
    "end": "2024070"
  },
  {
    "text": "in this is trying to understand what sis Vaughn adds to the host so what files drivers etc how does the tool behave",
    "start": "2024070",
    "end": "2031750"
  },
  {
    "text": "during operations so that's during installation during its normal use cases when the configuration is updated etc",
    "start": "2031750",
    "end": "2039520"
  },
  {
    "text": "and then what's resources does the tool depend on so building out a dependency",
    "start": "2039520",
    "end": "2044590"
  },
  {
    "text": "tree to identify if there are any technologies that W MA or that sis Mon",
    "start": "2044590",
    "end": "2051100"
  },
  {
    "text": "depends on that we can potentially attack if we can attack those dependent technologies then we can subvert we can",
    "start": "2051100",
    "end": "2057490"
  },
  {
    "text": "potentially subvert system on itself so",
    "start": "2057490",
    "end": "2062040"
  },
  {
    "text": "we're going to just focus on one aspect of this just do the time constraints but we're gonna talk about sis Mons",
    "start": "2062940",
    "end": "2069610"
  },
  {
    "text": "installation so sis Mon like like I mentioned does not have a centralized",
    "start": "2069610",
    "end": "2075220"
  },
  {
    "text": "way to update or or install itself so typically that's either done on a golden",
    "start": "2075220",
    "end": "2080770"
  },
  {
    "text": "image or more often pushed out through an IT administration tool so for example",
    "start": "2080770",
    "end": "2086320"
  },
  {
    "text": "GPO it could be installed through there the installation behavior changes depending on which system on binary is",
    "start": "2086320",
    "end": "2094510"
  },
  {
    "text": "used so when you download this one there's two executables there sis monkey",
    "start": "2094510",
    "end": "2099820"
  },
  {
    "text": "XE and system on 64 exe a lot of people just end up using sis monkey XE because",
    "start": "2099820",
    "end": "2105820"
  },
  {
    "text": "when you run it it actually extracts the 64 bit version so system on that exe is the x86 version and when you run that on",
    "start": "2105820",
    "end": "2112930"
  },
  {
    "text": "a 64-bit system it'll extract the 64-bit version and execute that instead so once",
    "start": "2112930",
    "end": "2122650"
  },
  {
    "text": "some of the interesting thing we noticed that it installed on a machine was there's various files that",
    "start": "2122650",
    "end": "2128800"
  },
  {
    "text": "adds so sis Monda exe and the driver that's a service the system on service",
    "start": "2128800",
    "end": "2133840"
  },
  {
    "text": "the user mode service and the driver component which does a lot of the collection there's you know the services",
    "start": "2133840",
    "end": "2141910"
  },
  {
    "text": "for this vs. spawn and the driver there's all the registry keys associated with the service and the driver one",
    "start": "2141910",
    "end": "2148780"
  },
  {
    "text": "worth standing out is the parameters registry key the third one down that is",
    "start": "2148780",
    "end": "2154750"
  },
  {
    "text": "where the system on configuration file is stored and as Matt mentioned it is",
    "start": "2154750",
    "end": "2160180"
  },
  {
    "text": "only accessible by administrators non-privileged or unprivileged users on",
    "start": "2160180",
    "end": "2165370"
  },
  {
    "text": "a machine cannot access that which is fantastic that that is locked down like that because other things that I think",
    "start": "2165370",
    "end": "2173200"
  },
  {
    "text": "should be locked down which always aren't would be like event logs you know like the PowerShell Event log for",
    "start": "2173200",
    "end": "2178840"
  },
  {
    "text": "example any non admin user can read that to their heart's content and pull all",
    "start": "2178840",
    "end": "2185380"
  },
  {
    "text": "kinds of interesting information for their situational awareness likewise this mod installs an etw provider from",
    "start": "2185380",
    "end": "2192220"
  },
  {
    "text": "which it reads a bunch its events and then it has an event log that that we",
    "start": "2192220",
    "end": "2198010"
  },
  {
    "text": "can also view and access the events from so again the reason why we want to",
    "start": "2198010",
    "end": "2204070"
  },
  {
    "text": "understand what these are because if we if I as an attacker can gain control of any of these components then I can",
    "start": "2204070",
    "end": "2210280"
  },
  {
    "text": "potentially subversive might as a whole and each one of those bullets is a securable object meaning each one of",
    "start": "2210280",
    "end": "2217810"
  },
  {
    "text": "them will have a security descriptor associated with them so that would be part of our analysis is ensuring that",
    "start": "2217810",
    "end": "2224200"
  },
  {
    "text": "yes you indeed have to be admin for each one of those components and we did verify that for these specific",
    "start": "2224200",
    "end": "2230470"
  },
  {
    "text": "components that you do have to be an administrator as I was doing this",
    "start": "2230470",
    "end": "2235510"
  },
  {
    "text": "analysis we did realize a few interesting things so if you are using",
    "start": "2235510",
    "end": "2241000"
  },
  {
    "text": "the 32 bit system on on a 64-bit system that's 60 it auto extracts the 64-bit",
    "start": "2241000",
    "end": "2248500"
  },
  {
    "text": "BIRT 64 bit version of system on to the temp folder usually IT administration",
    "start": "2248500",
    "end": "2256720"
  },
  {
    "text": "software is running system so when this happens and the Installer gets written to the Sidra the",
    "start": "2256720",
    "end": "2262750"
  },
  {
    "text": "C Drive windows temp folder which if which is writable by everybody on the",
    "start": "2262750",
    "end": "2268900"
  },
  {
    "text": "operating system so as you can see here in this proc Wan image this is during",
    "start": "2268900",
    "end": "2274900"
  },
  {
    "text": "the Installer we can see sis Mon it it starts off this the x86 version is in C",
    "start": "2274900",
    "end": "2282100"
  },
  {
    "text": "when a system 32 system on system on de Exe after that runs it extracts the",
    "start": "2282100",
    "end": "2287500"
  },
  {
    "text": "64-bit version to the temp folder so this this and then it executes it so I",
    "start": "2287500",
    "end": "2293770"
  },
  {
    "text": "from an attacker perspective I have a couple different ways I could abuse this a very simple one is through DLL",
    "start": "2293770",
    "end": "2299200"
  },
  {
    "text": "hijacking I can just drop a DLL that system on is looking for and I did verify that there are several and then",
    "start": "2299200",
    "end": "2306460"
  },
  {
    "text": "you can you know potentially elevate your privileges privileges to system you",
    "start": "2306460",
    "end": "2311710"
  },
  {
    "text": "can also use symlink redirection - there's a time of check and a time of use type of attack that you can do there",
    "start": "2311710",
    "end": "2319119"
  },
  {
    "text": "that's beyond the scope of this talk vibes yeah big thanks to James for chat for that research in addition to just",
    "start": "2319119",
    "end": "2327520"
  },
  {
    "text": "the installer file itself when sis Mon is installed it use what do you call it",
    "start": "2327520",
    "end": "2335710"
  },
  {
    "text": "web web you what win event you tilde XE to install that the event log and how it",
    "start": "2335710",
    "end": "2343630"
  },
  {
    "text": "does this is during installation it copies a XML manifest to the temp folder",
    "start": "2343630",
    "end": "2349450"
  },
  {
    "text": "and exploitation of this take takes a little bit of a little finesse so as you",
    "start": "2349450",
    "end": "2357910"
  },
  {
    "text": "can see in this screenshot here the highlighted items show where that file",
    "start": "2357910",
    "end": "2364000"
  },
  {
    "text": "is added so the first highlighted item at the end you can see it's dropping it",
    "start": "2364000",
    "end": "2369369"
  },
  {
    "text": "to see windows temp and then it's called man and then for numbers dot temp so",
    "start": "2369369",
    "end": "2375760"
  },
  {
    "text": "that's gonna sis plan attempts to I done to find a non-existent file and it uses",
    "start": "2375760",
    "end": "2381670"
  },
  {
    "text": "that same format so man for numbers then TMP so I had the idea of well what if I",
    "start": "2381670",
    "end": "2388930"
  },
  {
    "text": "just exhaust that name that character set so those numbers are always going to be you know alphanumeric",
    "start": "2388930",
    "end": "2394940"
  },
  {
    "text": "so if I add that's gonna be 36 potential characters 36 to the fourth because",
    "start": "2394940",
    "end": "2401539"
  },
  {
    "text": "there's four characters so I wrote 65535 files to the temp folder and then",
    "start": "2401539",
    "end": "2407989"
  },
  {
    "text": "removed write access to them so sis Mon could not write write to him and when that happened an interesting behavior",
    "start": "2407989",
    "end": "2414200"
  },
  {
    "text": "occurred it always created the file C Drive man or that created the file of Man 1 TMP so at that point at a",
    "start": "2414200",
    "end": "2421849"
  },
  {
    "text": "predictable location to where system on was always writing his file and I could potentially use these James's symlink",
    "start": "2421849",
    "end": "2429529"
  },
  {
    "text": "attack to regain control over the the event manifest so this is interesting",
    "start": "2429529",
    "end": "2435229"
  },
  {
    "text": "because during the installation it uninstalls the existing the existing",
    "start": "2435229",
    "end": "2441940"
  },
  {
    "text": "event log and then it will reinstall it so using this I could potentially uninstall any event log on the system or",
    "start": "2441940",
    "end": "2448940"
  },
  {
    "text": "abuse that XML file in a bunch of other ways so what Lee just covered maybe not",
    "start": "2448940",
    "end": "2456440"
  },
  {
    "text": "the sexiest form of privilege escalation but it's definitely one of those like why and weight vectors but considering",
    "start": "2456440",
    "end": "2465160"
  },
  {
    "text": "you know administrators are eventually going to update system onto a later version as long as you're already",
    "start": "2465160",
    "end": "2472190"
  },
  {
    "text": "embedded and you can lie in wait in C Windows 10 then you'll be good",
    "start": "2472190",
    "end": "2477259"
  },
  {
    "text": "eventually another part of attack surface analysis and really just knowing",
    "start": "2477259",
    "end": "2482839"
  },
  {
    "text": "like what is the overall footprint of any security product would be if there",
    "start": "2482839",
    "end": "2488390"
  },
  {
    "text": "is a driver component the communication mechanism the the interface between the",
    "start": "2488390",
    "end": "2493969"
  },
  {
    "text": "service and driver so the system on driver has an i octal interface we",
    "start": "2493969",
    "end": "2500359"
  },
  {
    "text": "didn't find anything that would have obviously been exploitable but we just wanted we really just wanted to",
    "start": "2500359",
    "end": "2506479"
  },
  {
    "text": "understand what I octaves were available and the context of how they were used so",
    "start": "2506479",
    "end": "2512390"
  },
  {
    "text": "there aren't that there really aren't any extremely interesting attack",
    "start": "2512390",
    "end": "2517670"
  },
  {
    "text": "scenarios here there might be a few if you're already admin but we didn't know",
    "start": "2517670",
    "end": "2523039"
  },
  {
    "text": "going into it that we wouldn't find anything fruitful but we needed to look anyway and you in order to get a handle",
    "start": "2523039",
    "end": "2529010"
  },
  {
    "text": "to the driver you need to have se debug privilege so the set of users and groups",
    "start": "2529010",
    "end": "2534710"
  },
  {
    "text": "who can have se debug privilege by default will be administrators but we",
    "start": "2534710",
    "end": "2541039"
  },
  {
    "text": "have seen scenarios where unprivileged users have been added via GPO to to",
    "start": "2541039",
    "end": "2547130"
  },
  {
    "text": "acquire se debug privilege so now we're talk about configuration analysis so I",
    "start": "2547130",
    "end": "2553490"
  },
  {
    "start": "2549000",
    "end": "2549000"
  },
  {
    "text": "covered a generic evasion specifically related to WMI but we still want to take",
    "start": "2553490",
    "end": "2560299"
  },
  {
    "text": "a holistic approach to evasion so we're not we're not going to have generic evasions for everything if we did that'd",
    "start": "2560299",
    "end": "2566990"
  },
  {
    "text": "be great but that is pretty unrealistic but let's say that we were able to",
    "start": "2566990",
    "end": "2572059"
  },
  {
    "text": "obtain a configuration our goal primarily would be to blend in with the",
    "start": "2572059",
    "end": "2578420"
  },
  {
    "text": "noise and system on lends itself to having an attacker blend and really",
    "start": "2578420",
    "end": "2583670"
  },
  {
    "text": "easily because in system on you can define a bunch of include rules and then exclude rules and it only takes a single",
    "start": "2583670",
    "end": "2592039"
  },
  {
    "text": "exclude rule for you to completely evade that specific event type so we're gonna",
    "start": "2592039",
    "end": "2600319"
  },
  {
    "text": "use Swift on Security's canonical system on config sorry I'm not not picking on",
    "start": "2600319",
    "end": "2605720"
  },
  {
    "text": "you but it's actually a really good configuration but it there are places",
    "start": "2605720",
    "end": "2611930"
  },
  {
    "text": "where we might be able to blend in so here's our evasion scenario where we",
    "start": "2611930",
    "end": "2617119"
  },
  {
    "text": "possibly obtained the configuration potentially without even needing to be admin if the deployment scenario is such",
    "start": "2617119",
    "end": "2623390"
  },
  {
    "text": "that we could obtain the XML on disk we likely will already have access to that XML versus the binary configuration",
    "start": "2623390",
    "end": "2630579"
  },
  {
    "text": "which is locked down or if it was pushed via GPO we wouldn't have direct access to the",
    "start": "2630579",
    "end": "2637130"
  },
  {
    "text": "binary rules blob but we would as a domain user be able to read that GPO so",
    "start": "2637130",
    "end": "2643849"
  },
  {
    "text": "this is our plan of attack we're going to identify the attacker influenceable exclude rules and build a",
    "start": "2643849",
    "end": "2650510"
  },
  {
    "text": "overall evasion strategy using those exclude rules so here are the process",
    "start": "2650510",
    "end": "2656270"
  },
  {
    "text": "create rules that I identified as being interesting and the reason is one of the",
    "start": "2656270",
    "end": "2662650"
  },
  {
    "text": "event conditions that I really like is the contains condition and that's",
    "start": "2662650",
    "end": "2668630"
  },
  {
    "text": "because I could have anywhere in my command line this thing that will be evaded so if I have anywhere in my",
    "start": "2668630",
    "end": "2675440"
  },
  {
    "text": "command line acro read 32 and that extra components then I'll evade all process",
    "start": "2675440",
    "end": "2680690"
  },
  {
    "text": "create rules same for file create time we got another really good contains rule",
    "start": "2680690",
    "end": "2686060"
  },
  {
    "text": "so setup can be anywhere in the image path Network connect we have one is not",
    "start": "2686060",
    "end": "2692360"
  },
  {
    "text": "quite as good so the file name must be onedrive dot exe in order for us to",
    "start": "2692360",
    "end": "2697880"
  },
  {
    "text": "evade network connections and that's based on the image condition process",
    "start": "2697880",
    "end": "2703190"
  },
  {
    "text": "terminate there weren't any good evasion candidates so we would have to fall back to like tradecraft avoidance and one of",
    "start": "2703190",
    "end": "2711380"
  },
  {
    "text": "the more obvious ones in this case was we'd want to avoid starting a process and terminating it within a path of C C",
    "start": "2711380",
    "end": "2720650"
  },
  {
    "text": "users now driver loads aren't entirely relevance like in our scenario where we",
    "start": "2720650",
    "end": "2727580"
  },
  {
    "text": "may not even want to drop drivers but there's still some evasion opportunities",
    "start": "2727580",
    "end": "2733190"
  },
  {
    "text": "assuming that we could load test sign code now create remote thread Ivan tested this recently but Casey posted",
    "start": "2733190",
    "end": "2740300"
  },
  {
    "text": "awhile ago that there is a generic evasion for create mote thread if you use the cue user a PC API file creates",
    "start": "2740300",
    "end": "2747980"
  },
  {
    "text": "there weren't really any ideal exclude rules so we would have to resort to tradecraft avoidance a registry event so",
    "start": "2747980",
    "end": "2757280"
  },
  {
    "text": "we can avoid all registry events if our path and file name ends with as follows",
    "start": "2757280",
    "end": "2762530"
  },
  {
    "text": "now the problem is oh and we already have a generic evasion for WMI events so",
    "start": "2762530",
    "end": "2769369"
  },
  {
    "text": "the problem that we've run into is the following look at the third and the fourth conditions where the file name",
    "start": "2769369",
    "end": "2776810"
  },
  {
    "text": "would need to end with one drive and that path including integrator dot exe so one would have aid network",
    "start": "2776810",
    "end": "2783560"
  },
  {
    "text": "connections the other would avoid registry events so what we we need to do",
    "start": "2783560",
    "end": "2789890"
  },
  {
    "text": "to have a more holistic evasion what be as follows so here's one instance of what avoiding or evading most of the",
    "start": "2789890",
    "end": "2797900"
  },
  {
    "text": "rules would look like by combining those exclude rules together so think about",
    "start": "2797900",
    "end": "2803780"
  },
  {
    "text": "whether or not you would actually be able to detect that in your environment and those of you who know PowerShell",
    "start": "2803780",
    "end": "2810349"
  },
  {
    "text": "pretty well might be able to recognize that that is PowerShell running that evades most of these system on rules so",
    "start": "2810349",
    "end": "2818750"
  },
  {
    "text": "our conclusions about our analysis of sis Mon again this is we were just analyzing it from a data collector",
    "start": "2818750",
    "end": "2825400"
  },
  {
    "text": "perspective so from a tampering perspective it's effective against non",
    "start": "2825400",
    "end": "2830599"
  },
  {
    "text": "administrators that's kind of defined once you're an admin all bets are lost there are no guarantees about an",
    "start": "2830599",
    "end": "2836750"
  },
  {
    "text": "attacker modifying or subverting system on from an attack surface analysis",
    "start": "2836750",
    "end": "2842089"
  },
  {
    "text": "system on is actually has has a pretty small attack surface there's a couple weaknesses that I showed with the",
    "start": "2842089",
    "end": "2847520"
  },
  {
    "text": "privilege escalation opportunities but overall easily fixable in terms of evasion rule enumeration is",
    "start": "2847520",
    "end": "2856250"
  },
  {
    "text": "critical for an attacker in order to do this likewise an attacker could take",
    "start": "2856250",
    "end": "2861410"
  },
  {
    "text": "advantage of just really loud events that typically aren't analyzed but",
    "start": "2861410",
    "end": "2867339"
  },
  {
    "text": "analyzing that config file is super important for the attacker in addition",
    "start": "2867339",
    "end": "2872990"
  },
  {
    "text": "our collection the collection rules themselves leave us wanting they in",
    "start": "2872990",
    "end": "2879140"
  },
  {
    "text": "specific the exclude rules because when there is an excludable it is so easy to build an evasion using that so if there",
    "start": "2879140",
    "end": "2885770"
  },
  {
    "text": "were some way that we could build better collection rules to allow us to exclude",
    "start": "2885770",
    "end": "2892910"
  },
  {
    "text": "stuff in a more targeted manner overall you know suspend it's great it's a great",
    "start": "2892910",
    "end": "2898849"
  },
  {
    "text": "additional data source for collecting events but in order to actually use it",
    "start": "2898849",
    "end": "2904970"
  },
  {
    "text": "you need supplementary tools to actually use it for detection purposes within an",
    "start": "2904970",
    "end": "2910640"
  },
  {
    "text": "organization you need several other tools in order to take advantage of it so be that log forwarding and as well as",
    "start": "2910640",
    "end": "2919190"
  },
  {
    "text": "you need you know detection engineering so once you have a sim actually manually",
    "start": "2919190",
    "end": "2924380"
  },
  {
    "text": "building out those rules to detect attacker activity overall in",
    "start": "2924380",
    "end": "2933119"
  },
  {
    "text": "conclusion attackers are going to continue subvert end points no matter what vendors we ask the question are you",
    "start": "2933119",
    "end": "2941460"
  },
  {
    "text": "doing subversion research on your products beyond just attack surface analysis and tap maybe tampering",
    "start": "2941460",
    "end": "2947609"
  },
  {
    "text": "protection evasion resilience is a big gap area that we see in the industry and",
    "start": "2947609",
    "end": "2955319"
  },
  {
    "text": "we encourage others to focus efforts on that defenders are you do you understand",
    "start": "2955319",
    "end": "2963089"
  },
  {
    "text": "the threat model that your products are protect against and are you aware of how",
    "start": "2963089",
    "end": "2968700"
  },
  {
    "text": "resilient they are to evasion underneath so we encourage defenders to take this",
    "start": "2968700",
    "end": "2973710"
  },
  {
    "text": "methodology and start applying it to their own product so they can get better insight into the efficacy of their",
    "start": "2973710",
    "end": "2980549"
  },
  {
    "text": "products perfect and thank you all very much again we didn't wear this for",
    "start": "2980549",
    "end": "2987569"
  },
  {
    "text": "nothing so feel free to we'd love it if you could donate through the Muscular Dystrophy Association we means a lot to",
    "start": "2987569",
    "end": "2995369"
  },
  {
    "text": "us so thank you and we'll take questions in the breakout room [Applause]",
    "start": "2995369",
    "end": "3001380"
  }
]