[
  {
    "text": "Welcome back, everyone. We took a brief hiatus last week.",
    "start": "3933",
    "end": "10433"
  },
  {
    "text": "we didn't stream. But we're back this week with our reimagination of content layer, kind of talking",
    "start": "11133",
    "end": "17933"
  },
  {
    "text": "about what we're trying to do with using the latest",
    "start": "18000",
    "end": "24599"
  },
  {
    "text": "and greatest from effect to make the speed and experience with content layer better than it currently is.",
    "start": "24766",
    "end": "32133"
  },
  {
    "text": "And the last time that we met, we were just kind of reviewing what we had done previously.",
    "start": "32666",
    "end": "39866"
  },
  {
    "text": "I believe we had been working on this config builder, which",
    "start": "40433",
    "end": "46166"
  },
  {
    "text": "is responsible for listening to our ESBuild results.",
    "start": "46266",
    "end": "52166"
  },
  {
    "text": "So the ESBuild service-- I guess we can just familiarize ourselves with everything we did last time.",
    "start": "52566",
    "end": "58333"
  },
  {
    "text": "The ESBuild-- yes. Maybe it's a config builder.",
    "start": "58833",
    "end": "64133"
  },
  {
    "text": "I was pretty sure I had an ESBuild service in here. Oh, yeah, there was one somewhere.",
    "start": "66966",
    "end": "71900"
  },
  {
    "text": "Weird that it wasn't. Anyways, this ESBuild service that we have essentially",
    "start": "73099",
    "end": "78466"
  },
  {
    "text": "listens to the content layer configuration file. And every time there's changes, it",
    "start": "78800",
    "end": "84066"
  },
  {
    "text": "emits those changes into an effect queue. And we kind of hook into that",
    "start": "84133",
    "end": "90566"
  },
  {
    "text": "the ESBuild plug-in lifecycle here to allow us to",
    "start": "90566",
    "end": "96199"
  },
  {
    "text": "write into that queue. And then the config",
    "start": "96199",
    "end": "104266"
  },
  {
    "text": "builder listens to those results. So essentially, it allows us",
    "start": "104266",
    "end": "111066"
  },
  {
    "text": "to take from that results queue forever and then run a build on that",
    "start": "111066",
    "end": "119900"
  },
  {
    "text": "result, which we started to sketch out last time but",
    "start": "119900",
    "end": "125799"
  },
  {
    "text": "didn't really get too far with. And then once we're done with the build, we write to the subscription ref, which then we",
    "start": "125800",
    "end": "132265"
  },
  {
    "text": "were planning on essentially using elsewhere in the application to listen to build changes that",
    "start": "132266",
    "end": "139533"
  },
  {
    "text": "are happening. But for now, I think Tim and I were working last time on this build script.",
    "start": "139533",
    "end": "148433"
  },
  {
    "text": "And we had just started testing it out. And I think we had been doing",
    "start": "148433",
    "end": "154333"
  },
  {
    "text": "that with this little scratch pad main file that I had come up with.",
    "start": "154333",
    "end": "165699"
  },
  {
    "text": "And I think all this does is it grabs the CLI that we put together and runs it.",
    "start": "167366",
    "end": "171933"
  },
  {
    "text": "And I think we also had sworn we had a",
    "start": "173000",
    "end": "180400"
  },
  {
    "text": "content layer config in here somewhere. But anyways, why don't we run this and",
    "start": "180400",
    "end": "189833"
  },
  {
    "text": "just see if it blows up?",
    "start": "189833",
    "end": "192665"
  },
  {
    "text": "Yes. OK.",
    "start": "203333",
    "end": "205066"
  },
  {
    "text": "So-- It's a code config is missing.",
    "start": "211966",
    "end": "214099"
  },
  {
    "text": "An error has occurred, I guess. Yeah, we definitely need to improve the error messaging",
    "start": "217433",
    "end": "223566"
  },
  {
    "text": "experience. But let's go ahead and",
    "start": "223599",
    "end": "233000"
  },
  {
    "text": "quit out of this for a sec. And is this enough?",
    "start": "233000",
    "end": "243400"
  },
  {
    "text": "No.",
    "start": "247733",
    "end": "248000"
  },
  {
    "text": "Maybe we should just log out the errors. Yeah, not a bad idea.",
    "start": "263866",
    "end": "269433"
  },
  {
    "text": "Let's do that on the esbuild service, because I think that's where they're coming from.",
    "start": "272333",
    "end": "276566"
  },
  {
    "text": "OK. Could not resolve content layer config.ts.",
    "start": "300099",
    "end": "305099"
  },
  {
    "text": "Perhaps that's because--",
    "start": "312266",
    "end": "313900"
  },
  {
    "text": "That's weird. That because it's empty?",
    "start": "338599",
    "end": "342733"
  },
  {
    "text": "Maybe.",
    "start": "353966",
    "end": "354199"
  },
  {
    "text": "Let's see.",
    "start": "361733",
    "end": "362099"
  },
  {
    "text": "It's still not happy.",
    "start": "385300",
    "end": "386465"
  },
  {
    "text": "Let's look at the config I'm passing to esbuild, because if I recall--",
    "start": "392500",
    "end": "397166"
  },
  {
    "text": "I don't know why a telescope doesn't find certain files. But the config I set up, but--",
    "start": "404066",
    "end": "409900"
  },
  {
    "text": "packages core. So in esbuild, we don't",
    "start": "411833",
    "end": "419500"
  },
  {
    "text": "provide the build options here. We provide them-- is it here?",
    "start": "419500",
    "end": "424466"
  },
  {
    "text": "In the CLI at the moment. Oh, yeah, you're right. You're right.",
    "start": "425133",
    "end": "429733"
  },
  {
    "text": "Is it because it's using the absolute working directory?",
    "start": "456733",
    "end": "460933"
  },
  {
    "text": "The path looks right in the error message. So the absolute working directory,",
    "start": "462599",
    "end": "467432"
  },
  {
    "text": "I believe, has to do with output, not input.",
    "start": "469000",
    "end": "473432"
  },
  {
    "text": "It's OK. I think.",
    "start": "474599",
    "end": "477166"
  },
  {
    "text": "How did we have this working last time? Did I spell something wrong?",
    "start": "484900",
    "end": "489566"
  },
  {
    "text": "Maybe it's because it's using ASM, and it's not on the exports.",
    "start": "491699",
    "end": "495900"
  },
  {
    "text": "Content-life-config.ts, right?",
    "start": "498800",
    "end": "502233"
  },
  {
    "text": "Default is content-layer.config.ts.",
    "start": "504633",
    "end": "507866"
  },
  {
    "text": "I don't think so. I mean, we had everything--",
    "start": "512899",
    "end": "517899"
  },
  {
    "text": "everything was set up just like this the last time.",
    "start": "518600",
    "end": "521966"
  },
  {
    "text": "Maybe it's something dumb like-- I think it has to be",
    "start": "533633",
    "end": "538800"
  },
  {
    "text": "in the working directory here or something. I don't think this is the case, but--",
    "start": "538800",
    "end": "543966"
  },
  {
    "text": "This is weird.",
    "start": "570399",
    "end": "571466"
  },
  {
    "text": "Very strange. All right, let's think for a sec. Maybe we just comment",
    "start": "617333",
    "end": "623100"
  },
  {
    "text": "out that working directory and see what happens.",
    "start": "623100",
    "end": "626733"
  },
  {
    "text": "The absolute working directory? Yeah.",
    "start": "628266",
    "end": "630133"
  },
  {
    "text": "All right, Tim. Why do you always have to be right?",
    "start": "647833",
    "end": "649766"
  },
  {
    "text": "That's weird, though, because I was pretty sure the absolute working directory-- let me look this up.",
    "start": "653600",
    "end": "658865"
  },
  {
    "text": "I was pretty sure that",
    "start": "659500",
    "end": "666000"
  },
  {
    "text": "this had to do with the--",
    "start": "667633",
    "end": "670633"
  },
  {
    "text": "the input or the output, not the input. Is there like an output directory option?",
    "start": "677733",
    "end": "684233"
  },
  {
    "text": "There is an output dir, which we have-- We're just using out file right now.",
    "start": "685866",
    "end": "691600"
  },
  {
    "text": "Yeah, because we're compiling to a single file, and this is like the only output we produce.",
    "start": "692699",
    "end": "698399"
  },
  {
    "text": "And I could be totally wrong. It could be that the absolute working directory is like where the files",
    "start": "704199",
    "end": "709365"
  },
  {
    "text": "are that we're looking for.",
    "start": "709366",
    "end": "710500"
  },
  {
    "text": "Let's really use this link. API, esbuild.",
    "start": "717800",
    "end": "723566"
  },
  {
    "text": "Working directory. Specify the working directory to use for the build.",
    "start": "731166",
    "end": "737600"
  },
  {
    "text": "It normally defaults to the current working directory of the process you're using in a call esbuild API.",
    "start": "737600",
    "end": "742166"
  },
  {
    "text": "The working directory is used by esbuild for a few different things, including resolving relative paths given as API options",
    "start": "743899",
    "end": "751266"
  },
  {
    "text": "to absolute paths and pretty printing absolute paths as relative paths in log messages.",
    "start": "751500",
    "end": "757865"
  },
  {
    "text": "So I guess it is input, not output. Yeah, sounds like it.",
    "start": "758899",
    "end": "764633"
  },
  {
    "text": "All right. Output directory optioned. Oh, yeah, there's an output directory optioned.",
    "start": "765199",
    "end": "771433"
  },
  {
    "text": "So we set that to .content layer. Out there.",
    "start": "775399",
    "end": "781966"
  },
  {
    "text": "It's good to be-- Yeah, because I think at the moment, we're actually-- yeah, we're writing this.",
    "start": "792500",
    "end": "798500"
  },
  {
    "text": "Yeah, we're going to the current directory we're going to do.",
    "start": "801000",
    "end": "803699"
  },
  {
    "text": "So then let's try this one more time. And let's pass the absolute--",
    "start": "806966",
    "end": "812833"
  },
  {
    "text": "let's leave the absolute working directory blank, and let's pass an absolute path and see if that just solves the problem for now.",
    "start": "812966",
    "end": "818833"
  },
  {
    "text": "Cannot use both out file and out there.",
    "start": "822266",
    "end": "824466"
  },
  {
    "text": "OK. I guess if we just prefix out file with a directory.",
    "start": "827366",
    "end": "831433"
  },
  {
    "text": "I wonder if the directory has to exist. I think we went through this last time.",
    "start": "834899",
    "end": "840365"
  },
  {
    "text": "Something-- this is like coming back to me. Oh, maybe not.",
    "start": "841433",
    "end": "845133"
  },
  {
    "text": "Yeah, I think we can. Cool.",
    "start": "846466",
    "end": "851000"
  },
  {
    "text": "Cool, and this should have nothing in it. Great. All right, I guess we've",
    "start": "853066",
    "end": "858766"
  },
  {
    "text": "defined some config now. Yeah, so let's go--",
    "start": "858766",
    "end": "863000"
  },
  {
    "text": "let's go back to here.",
    "start": "866433",
    "end": "869933"
  },
  {
    "text": "So on the left here--",
    "start": "874600",
    "end": "878733"
  },
  {
    "text": "oh, but we're going to-- oh, shoot. We're going to want to be able to import from our packages, right?",
    "start": "882666",
    "end": "887399"
  },
  {
    "text": "Yeah. I think I have everything set up to do that, but let's see.",
    "start": "888433",
    "end": "896000"
  },
  {
    "text": "Maybe not.",
    "start": "898533",
    "end": "911433"
  },
  {
    "text": "Content layer core.",
    "start": "922966",
    "end": "923833"
  },
  {
    "text": "Still not happy.",
    "start": "931000",
    "end": "937633"
  },
  {
    "text": "Let's see, a spilled happy though. I don't know, let's find out.",
    "start": "941500",
    "end": "946433"
  },
  {
    "text": "No, don't open a window. Write that.",
    "start": "954433",
    "end": "959032"
  },
  {
    "text": "It does look like he has build wrote something. Maybe over here we can watch.",
    "start": "962433",
    "end": "966300"
  },
  {
    "text": "It wrote zero bytes though. True.",
    "start": "967833",
    "end": "971433"
  },
  {
    "text": "I guess it strips unused imports, so maybe--",
    "start": "977933",
    "end": "980500"
  },
  {
    "text": "Explore default in this case.",
    "start": "983899",
    "end": "986833"
  },
  {
    "text": "There we go. All right. Maybe I just need to--",
    "start": "998166",
    "end": "1005933"
  },
  {
    "text": "Okay. It might not be included in the TS config.",
    "start": "1009433",
    "end": "1013800"
  },
  {
    "text": "That's true. I'll check that in a second. Let's open this over here.",
    "start": "1016666",
    "end": "1021766"
  },
  {
    "text": "Yes. Cool. I wonder--",
    "start": "1024100",
    "end": "1030865"
  },
  {
    "text": "I wonder if we should be compiling this like this, or if we should be including",
    "start": "1034133",
    "end": "1039600"
  },
  {
    "text": "it as an external at some point.",
    "start": "1039600",
    "end": "1042065"
  },
  {
    "text": "I don't know This works.",
    "start": "1048766",
    "end": "1051300"
  },
  {
    "text": "Let me just see really quick-- Can you change the-- The kind of like the ES level?",
    "start": "1054033",
    "end": "1062699"
  },
  {
    "text": "It looks like it's-- ES40. Like the Iqma script level.",
    "start": "1064500",
    "end": "1072266"
  },
  {
    "text": "Iqma Scripts 2022 maybe.",
    "start": "1074133",
    "end": "1076800"
  },
  {
    "text": "Three as well, dude. Yeah.",
    "start": "1079833",
    "end": "1082933"
  },
  {
    "text": "I see what I got. Target. Let's see what the docs say here.",
    "start": "1091666",
    "end": "1097699"
  },
  {
    "text": "Target. No, this is just like node. I don't know, I can do target.",
    "start": "1098233",
    "end": "1104199"
  },
  {
    "text": "Yes. Okay. What did you want me to set this to?",
    "start": "1104500",
    "end": "1107132"
  },
  {
    "text": "Does it give you options? I think I can specify-- It says in the docs I can specify",
    "start": "1110533",
    "end": "1117666"
  },
  {
    "text": "JavaScript language versions like ES2020, et cetera.",
    "start": "1117666",
    "end": "1121600"
  },
  {
    "text": "Yeah. Yeah, maybe ES2020.",
    "start": "1122833",
    "end": "1126566"
  },
  {
    "text": "Yeah, that didn't seem to change anything. If you just-- I do colon E, and that",
    "start": "1148633",
    "end": "1157833"
  },
  {
    "text": "usually rereads the buffer. Yeah.",
    "start": "1157833",
    "end": "1160399"
  },
  {
    "text": "Yeah. Maybe it just uses var or anything.",
    "start": "1176000",
    "end": "1177699"
  },
  {
    "text": "Yeah, maybe. I'm sorry about that right now. I think in the current version of Content",
    "start": "1183166",
    "end": "1191166"
  },
  {
    "text": "Layer, the packages themselves are marked as externals.",
    "start": "1191166",
    "end": "1195266"
  },
  {
    "text": "I can set the target to a node version if you want. So you can just put in like node 18.",
    "start": "1196933",
    "end": "1203100"
  },
  {
    "text": "19. No, no, no, 18.",
    "start": "1205133",
    "end": "1208433"
  },
  {
    "text": "Yes. It will.",
    "start": "1227833",
    "end": "1230766"
  },
  {
    "text": "All right. Well, we wanted to test--",
    "start": "1235733",
    "end": "1244166"
  },
  {
    "text": "if--",
    "start": "1246433",
    "end": "1248666"
  },
  {
    "text": "We essentially wanted to test if-- I guess we need to import that file here.",
    "start": "1253899",
    "end": "1261433"
  },
  {
    "text": "Then check if it-- We'll just see what we get.",
    "start": "1263366",
    "end": "1267733"
  },
  {
    "text": "It looks like it's setting up the symbol properly. So it's good.",
    "start": "1268399",
    "end": "1272433"
  },
  {
    "text": "Now, top guard should work. Let's take a look.",
    "start": "1276433",
    "end": "1282500"
  },
  {
    "text": "Import. Well, at the moment, we don't have the",
    "start": "1283766",
    "end": "1294266"
  },
  {
    "text": "absolute path, but we can compute it, right? So here--",
    "start": "1294266",
    "end": "1300966"
  },
  {
    "text": "Yeah, that's just the object key.",
    "start": "1302433",
    "end": "1305366"
  },
  {
    "text": "So--",
    "start": "1309133",
    "end": "1309333"
  },
  {
    "text": "Interesting. Result.output--",
    "start": "1326433",
    "end": "1331398"
  },
  {
    "text": "No, result.meta file.output.",
    "start": "1333433",
    "end": "1336066"
  },
  {
    "text": "Meta file.",
    "start": "1339033",
    "end": "1339433"
  },
  {
    "text": "What did we want to do? We wanted to--",
    "start": "1360133",
    "end": "1363266"
  },
  {
    "text": "We wanted to import this file. Yeah.",
    "start": "1365233",
    "end": "1369000"
  },
  {
    "text": "Will that work? It doesn't have a file extension. I guess for now, we can just append--",
    "start": "1373500",
    "end": "1379000"
  },
  {
    "text": "Actually, you're right. I don't know. I'm sorry. I don't know.",
    "start": "1382266",
    "end": "1389266"
  },
  {
    "text": "I think in the current version of content layer-- Let me look.",
    "start": "1390966",
    "end": "1395866"
  },
  {
    "text": "But I think in the current-- Considering it's version like a self-contained bundled file, can you even?",
    "start": "1396699",
    "end": "1402898"
  },
  {
    "text": "I know. Can we what? Sorry. Just evaluate it. I'm not sure how it exports. We're up to eval then. Okay. One problem that would",
    "start": "1403433",
    "end": "1418300"
  },
  {
    "text": "solve is cache busting. So we don't create a memory leak with lots of imports.",
    "start": "1418300",
    "end": "1426300"
  },
  {
    "text": "So you're saying like, literally use like eval like that? Yeah.",
    "start": "1427466",
    "end": "1431699"
  },
  {
    "text": "Does this-- Wait, does it-- We would have to read",
    "start": "1433100",
    "end": "1438232"
  },
  {
    "text": "the file in this one. Yeah.",
    "start": "1438233",
    "end": "1442666"
  },
  {
    "text": "This just feels so dirty. It's probably-- No, it",
    "start": "1445433",
    "end": "1452733"
  },
  {
    "text": "probably has some sandboxing tools. I remember you last--",
    "start": "1452733",
    "end": "1457699"
  },
  {
    "text": "Last time we had spoken, I remember you had mentioned that you were writing-- By the way, related to memory leak, you",
    "start": "1459133",
    "end": "1464500"
  },
  {
    "text": "had written something in the past that you said had worked around that memory leak issue or something?",
    "start": "1464500",
    "end": "1470300"
  },
  {
    "text": "Uses-- It uses the common JS APIs though.",
    "start": "1473033",
    "end": "1481300"
  },
  {
    "text": "Or used-- Got it. It was before ASM was a thing.",
    "start": "1482666",
    "end": "1487433"
  },
  {
    "text": "Well, for now, we can grab object.key. Let's just be like really--",
    "start": "1493433",
    "end": "1497799"
  },
  {
    "text": "So, that gets us the file path.",
    "start": "1512133",
    "end": "1517800"
  },
  {
    "text": "And then--",
    "start": "1525633",
    "end": "1526399"
  },
  {
    "text": "One second. I am fairly certain that the current",
    "start": "1531066",
    "end": "1538433"
  },
  {
    "text": "version of content layer does this.",
    "start": "1538433",
    "end": "1541233"
  },
  {
    "text": "Does this import? Just give me one second.",
    "start": "1543733",
    "end": "1548766"
  },
  {
    "text": "I'm trying to find it.",
    "start": "1549233",
    "end": "1550199"
  },
  {
    "text": "It looks like a node there is-- There's a VM module that you can use to compile modules.",
    "start": "1557066",
    "end": "1566266"
  },
  {
    "text": "Yeah, that's what Mike had been saying, I think, one or two times ago. I was talking about potentially using an",
    "start": "1570800",
    "end": "1579832"
  },
  {
    "text": "isolate or something like that to read the module in.",
    "start": "1579833",
    "end": "1584566"
  },
  {
    "text": "But we didn't go too far with it when we had spoken about it that time.",
    "start": "1585533",
    "end": "1590633"
  },
  {
    "text": "But in content layer currently, this is how it's done. It is literally file.",
    "start": "1593333",
    "end": "1598666"
  },
  {
    "text": "I'm going to do this like the dirty way.",
    "start": "1600899",
    "end": "1605600"
  },
  {
    "text": "And then we'll clean this up. Looks like it's-- There's an experimental-- It's behind a flag at the moment.",
    "start": "1607533",
    "end": "1613300"
  },
  {
    "text": "Oh, isn't it?",
    "start": "1615699",
    "end": "1617666"
  },
  {
    "text": ".source.txt module.",
    "start": "1621433",
    "end": "1623433"
  },
  {
    "text": "And then outputs.",
    "start": "1637199",
    "end": "1638398"
  },
  {
    "text": "Oh, my God. There we go. And then we can do--",
    "start": "1689166",
    "end": "1694665"
  },
  {
    "text": "Let's just see if this works. Because I believe-- I mean, in the",
    "start": "1701033",
    "end": "1707100"
  },
  {
    "text": "current version of content layer, it uses like a file import path. And then the current date is like",
    "start": "1707100",
    "end": "1715366"
  },
  {
    "text": "appended to bust the cache. But that still means we're leaving a bunch of imports around.",
    "start": "1715366",
    "end": "1720800"
  },
  {
    "text": "And memory. So let's just see what this looks like.",
    "start": "1723433",
    "end": "1729399"
  },
  {
    "text": "Okay. So now we can do--",
    "start": "1731266",
    "end": "1742065"
  },
  {
    "text": "yield console.log.",
    "start": "1743966",
    "end": "1747433"
  },
  {
    "text": "imported.default. All right.",
    "start": "1760933",
    "end": "1770899"
  },
  {
    "text": "So that at least does allow us to check if it's a config. The other thing we could do if we wanted",
    "start": "1773433",
    "end": "1780799"
  },
  {
    "text": "to avoid all of this type ID gymnastics with config is we could probably figure",
    "start": "1780800",
    "end": "1786966"
  },
  {
    "text": "out a schema where-- like an effect schema, which just",
    "start": "1786966",
    "end": "1793666"
  },
  {
    "text": "validates the structure of this. And for documents, since we don't know the exact structure of the documents at",
    "start": "1793666",
    "end": "1801299"
  },
  {
    "text": "runtime, maybe we could come up with a filter or something for documents to make sure that the array only contains documents. But-- but-- yeah, that would be like",
    "start": "1801300",
    "end": "1812500"
  },
  {
    "text": "another option if we wanted to avoid the type ID business because--",
    "start": "1812500",
    "end": "1816666"
  },
  {
    "text": "The problem is the document can contain closures.",
    "start": "1820533",
    "end": "1823800"
  },
  {
    "text": "And-- I don't know, using schema to validate functions and that",
    "start": "1826899",
    "end": "1833466"
  },
  {
    "text": "kind of stuff doesn't seem-- It's a part of--",
    "start": "1833466",
    "end": "1836966"
  },
  {
    "text": "No, that's fair. That is fair.",
    "start": "1840300",
    "end": "1842566"
  },
  {
    "text": "I do think that we have to come up with a better solution for like actually importing the content layer config file",
    "start": "1845866",
    "end": "1853899"
  },
  {
    "text": "into the current build process because, like I said, the current",
    "start": "1853899",
    "end": "1859800"
  },
  {
    "text": "strategy that is used by--",
    "start": "1859800",
    "end": "1862433"
  },
  {
    "text": "content layer is essentially this.",
    "start": "1866433",
    "end": "1870699"
  },
  {
    "text": "I thought the outputs that already have like a few--",
    "start": "1875433",
    "end": "1879966"
  },
  {
    "text": "because they have the identifier on the end. Yeah, I think-- I'm not exactly sure--",
    "start": "1882666",
    "end": "1888399"
  },
  {
    "text": "The comment in the code base previously",
    "start": "1889433",
    "end": "1898266"
  },
  {
    "text": "was that that suffix was required for reloading in watch mode.",
    "start": "1898266",
    "end": "1904633"
  },
  {
    "text": "But we still have the-- like you said, we still have that hash, which should change",
    "start": "1906566",
    "end": "1912266"
  },
  {
    "text": "if we-- if the content of the config file changes. Yeah.",
    "start": "1912266",
    "end": "1916333"
  },
  {
    "text": "I'm just going to quickly--",
    "start": "1919566",
    "end": "1923100"
  },
  {
    "text": "quickly see if the VM module will help us. Yeah, it might be like an interesting",
    "start": "1925133",
    "end": "1930666"
  },
  {
    "text": "thing for us to focus on with the time we have left to see if we can like figure out a better strategy",
    "start": "1930666",
    "end": "1936166"
  },
  {
    "text": "for importing this file. In the meantime, I'm going to port over",
    "start": "1936166",
    "end": "1942199"
  },
  {
    "text": "some code that I think will at least help us with grabbing the",
    "start": "1942199",
    "end": "1947866"
  },
  {
    "text": "outfile path that we need. So-- So--",
    "start": "1947866",
    "end": "1950966"
  },
  {
    "text": "const outfile path.",
    "start": "1954133",
    "end": "1957866"
  },
  {
    "text": ".map .file",
    "start": "1970433",
    "end": "1975399"
  },
  {
    "text": ".keys",
    "start": "1978566",
    "end": "1980266"
  },
  {
    "text": "Now we have a slightly more correct.",
    "start": "2143766",
    "end": "2145066"
  },
  {
    "text": "Sorry about that. I added a little bit of code just to make--",
    "start": "2170399",
    "end": "2175300"
  },
  {
    "text": "finding that-- finding the correct key that we want to",
    "start": "2176800",
    "end": "2183666"
  },
  {
    "text": "import a little bit more robust. But anyways, what have",
    "start": "2183666",
    "end": "2188800"
  },
  {
    "text": "you found so far, Tim? I think if we were to use the node VM",
    "start": "2188800",
    "end": "2197666"
  },
  {
    "text": "module, we would need to compile to a common JS.",
    "start": "2197666",
    "end": "2200932"
  },
  {
    "text": "Oh, really? Yeah.",
    "start": "2203199",
    "end": "2204633"
  },
  {
    "text": "They have like a thing for doing modules, but it's behind the flag right now.",
    "start": "2210666",
    "end": "2218000"
  },
  {
    "text": "Do you think CJS is going to be a problem for the config file?",
    "start": "2218699",
    "end": "2221699"
  },
  {
    "text": "I don't think so. So let's do-- let's try it then. Let's go--",
    "start": "2224199",
    "end": "2230932"
  },
  {
    "text": "Actually, I should be able to-- see why.",
    "start": "2234699",
    "end": "2239399"
  },
  {
    "text": "Hello. It's weird.",
    "start": "2243466",
    "end": "2248899"
  },
  {
    "text": "So with the-- with the S build, if I want to switch, is it just--",
    "start": "2253566",
    "end": "2258799"
  },
  {
    "text": "Yeah. Oh, I'm guessing it's just the full bit.",
    "start": "2260866",
    "end": "2262432"
  },
  {
    "text": "Yeah.",
    "start": "2269466",
    "end": "2269800"
  },
  {
    "text": "No such element exception. That means that the code that I just wrote--",
    "start": "2286300",
    "end": "2292000"
  },
  {
    "text": "That means there could be an error.",
    "start": "2298633",
    "end": "2301300"
  },
  {
    "text": "Oh, I know what it is.",
    "start": "2305300",
    "end": "2306199"
  },
  {
    "text": "Remember the compiled output doesn't have a file extension? It's entirely",
    "start": "2319100",
    "end": "2324199"
  },
  {
    "text": "possible. Let's take a look.",
    "start": "2324199",
    "end": "2326099"
  },
  {
    "text": "Does not.",
    "start": "2330899",
    "end": "2331632"
  },
  {
    "text": "It's weird though. Did it-- it did before though, right?",
    "start": "2338433",
    "end": "2346899"
  },
  {
    "text": "No, it didn't.",
    "start": "2347800",
    "end": "2348399"
  },
  {
    "text": "Wait a minute. And how is this working in the old version of content layer?",
    "start": "2355199",
    "end": "2360066"
  },
  {
    "text": "In content layer, it does have a file extension.",
    "start": "2363333",
    "end": "2366666"
  },
  {
    "text": "Yeah. So--",
    "start": "2369033",
    "end": "2371466"
  },
  {
    "text": "What is the bundle file, dear?",
    "start": "2393066",
    "end": "2395333"
  },
  {
    "text": "No means and neither dependencies.",
    "start": "2398233",
    "end": "2401066"
  },
  {
    "text": "All right. Well, let's just remove the file extension, as you say.",
    "start": "2405433",
    "end": "2409899"
  },
  {
    "text": "Not sure why.",
    "start": "2414800",
    "end": "2415566"
  },
  {
    "text": "Well, now it's just because I'm importing and something that I can't import, but--",
    "start": "2427433",
    "end": "2432500"
  },
  {
    "text": "So instead of importing it to-- if we're going to use the VM module, we didn't just use the process into reader.",
    "start": "2437000",
    "end": "2443300"
  },
  {
    "text": "So it would be like, const FS.",
    "start": "2446066",
    "end": "2449432"
  },
  {
    "text": "So let's see.",
    "start": "2485166",
    "end": "2486433"
  },
  {
    "text": "I'm still going to be using process.currentworkingdirectory for now, but--",
    "start": "2490433",
    "end": "2493866"
  },
  {
    "text": "Let's do one last option about that here.",
    "start": "2497433",
    "end": "2500199"
  },
  {
    "text": "Actually, we can do-- I don't think we would need to modify the path at all because--",
    "start": "2503800",
    "end": "2510265"
  },
  {
    "text": "It would all be relative to the current process. It does? Okay.",
    "start": "2513399",
    "end": "2517599"
  },
  {
    "text": "Read file as a string or read file as a binary? String. Okay.",
    "start": "2526300",
    "end": "2563833"
  },
  {
    "text": "Now what? You need to yield it.",
    "start": "2567699",
    "end": "2572233"
  },
  {
    "text": "And then if you import the VM module--",
    "start": "2577433",
    "end": "2580333"
  },
  {
    "text": "Right now.",
    "start": "2589466",
    "end": "2590433"
  },
  {
    "text": "Okay. The first thing you need to do is create--",
    "start": "2602433",
    "end": "2608933"
  },
  {
    "text": "Well, are we outputting as common JS? We are now, I think,",
    "start": "2610666",
    "end": "2616566"
  },
  {
    "text": "because I changed the output. If we look at the compiled output just to",
    "start": "2616866",
    "end": "2624000"
  },
  {
    "text": "see what looks like.",
    "start": "2624000",
    "end": "2625199"
  },
  {
    "text": "Other both start off P. Okay. All right.",
    "start": "2638066",
    "end": "2644699"
  },
  {
    "text": "So it uses module.export. So first thing you need to do is create like a context that the",
    "start": "2650333",
    "end": "2657033"
  },
  {
    "text": "script will be running. So VM.createContext.",
    "start": "2657033",
    "end": "2660600"
  },
  {
    "text": "And it just takes an object.",
    "start": "2666433",
    "end": "2670533"
  },
  {
    "text": "So it's a plain object. And then just add a module properly with an exports field.",
    "start": "2672966",
    "end": "2679066"
  },
  {
    "text": "Like so? Yeah. And exports would be empty object.",
    "start": "2686000",
    "end": "2691033"
  },
  {
    "text": "And then now we have the context.",
    "start": "2698433",
    "end": "2701533"
  },
  {
    "text": "And now you can go VM.runInContext and parse the tought code.",
    "start": "2705966",
    "end": "2710433"
  },
  {
    "text": "In the context.",
    "start": "2712466",
    "end": "2713266"
  },
  {
    "text": "Yeah, we don't need the result here because it will be attaching the export to the context.",
    "start": "2733833",
    "end": "2738899"
  },
  {
    "text": "Oh, really? So that's the-- Yeah, but that might throw a defect.",
    "start": "2741233",
    "end": "2750899"
  },
  {
    "text": "We need to wrap it in effect dot. Sync or something.",
    "start": "2752166",
    "end": "2757500"
  },
  {
    "text": "Did we hear another attempt? We did. It's called try.",
    "start": "2760666",
    "end": "2764166"
  },
  {
    "text": "But we could just use effect dot sync and keep them as defects.",
    "start": "2767733",
    "end": "2771466"
  },
  {
    "text": "And maybe just log out the context.",
    "start": "2782633",
    "end": "2785733"
  },
  {
    "text": "See what we got.",
    "start": "2796533",
    "end": "2797899"
  },
  {
    "text": "Module module. So it's module not modules. Oh, my bad.",
    "start": "2806066",
    "end": "2810433"
  },
  {
    "text": "Here we go. Okay.",
    "start": "2820066",
    "end": "2824166"
  },
  {
    "text": "So module try exports dot default is what we want.",
    "start": "2829433",
    "end": "2833500"
  },
  {
    "text": "Hey. That's pretty cool.",
    "start": "2842800",
    "end": "2846766"
  },
  {
    "text": "In this way, we don't have to worry about memory links.",
    "start": "2848899",
    "end": "2853300"
  },
  {
    "text": "Yeah, the only downside is obviously we have to emit CJS, but I guess it's not a huge deal since the content layer config",
    "start": "2857399",
    "end": "2864933"
  },
  {
    "text": "is always going to be local. It's not part of like what's being distributed, right?",
    "start": "2864933",
    "end": "2871699"
  },
  {
    "text": "Yeah. The other downside is I won't",
    "start": "2872000",
    "end": "2877399"
  },
  {
    "text": "have any node APIs injected. It just says module, which might be a problem.",
    "start": "2877399",
    "end": "2883500"
  },
  {
    "text": "So if we have plugins that are using like process dot something, they won't work.",
    "start": "2886833",
    "end": "2893066"
  },
  {
    "text": "I see what you're saying.",
    "start": "2896266",
    "end": "2896899"
  },
  {
    "text": "I'm not sure if it has access to require.",
    "start": "2903666",
    "end": "2910199"
  },
  {
    "text": "Inside the VM. Yeah. Context",
    "start": "2915000",
    "end": "2920465"
  },
  {
    "text": "While you're doing that, I am just going to quickly write the code that extracts the hash from the file name as well,",
    "start": "2948066",
    "end": "2954600"
  },
  {
    "text": "because we probably need that.",
    "start": "2954899",
    "end": "2956299"
  },
  {
    "text": "Um.",
    "start": "2963699",
    "end": "2963966"
  },
  {
    "text": "Well, we've got the code that will extract the ESbuild hash at least.",
    "start": "3114466",
    "end": "3119300"
  },
  {
    "text": "You make any progress over there, Tim? I think we could spread in global this",
    "start": "3123100",
    "end": "3132100"
  },
  {
    "text": "and just override the module and export fields.",
    "start": "3132100",
    "end": "3136166"
  },
  {
    "text": "Let's see what happens when I do that. Hello. Oh, yes. You can just pass in require and buffer",
    "start": "3142899",
    "end": "3179566"
  },
  {
    "text": "and that kind of stuff into the context and then the script will get access to this.",
    "start": "3179566",
    "end": "3184466"
  },
  {
    "text": "All right. I guess. Let me just go to check if it gets access",
    "start": "3188966",
    "end": "3197866"
  },
  {
    "text": "to set time out, etc. No, it doesn't.",
    "start": "3197866",
    "end": "3203533"
  },
  {
    "text": "So you're saying you think that like we could potentially pass everything in from the global object into our context or?",
    "start": "3241433",
    "end": "3247599"
  },
  {
    "text": "Yeah. Let me see. I'm going to look there.",
    "start": "3251100",
    "end": "3252533"
  },
  {
    "text": "It's unfortunate that the I mean, I understand, but it's unfortunate that the some supports behind the flag.",
    "start": "3272433",
    "end": "3278699"
  },
  {
    "text": "Yeah.",
    "start": "3280833",
    "end": "3281033"
  },
  {
    "text": "It doesn't. It doesn't.",
    "start": "3313433",
    "end": "3318666"
  },
  {
    "text": "So. How does the newest",
    "start": "3326466",
    "end": "3332399"
  },
  {
    "text": "snippet on this go on? Perfect.",
    "start": "3332399",
    "end": "3335932"
  },
  {
    "text": "And then after we try this out. We'll probably have to wrap up in a bit. It's getting a little bit late here, but",
    "start": "3342866",
    "end": "3349199"
  },
  {
    "text": "I do want to at least try this out.",
    "start": "3349199",
    "end": "3351333"
  },
  {
    "text": "Context equals the in dot create context. In plus.",
    "start": "3360966",
    "end": "3367533"
  },
  {
    "text": "So with this, we should be able to do things like require and buffer and etc.",
    "start": "3404866",
    "end": "3410366"
  },
  {
    "text": "In the content layer config, right? Yeah. Let's try it.",
    "start": "3410666",
    "end": "3415433"
  },
  {
    "text": "I don't know.",
    "start": "3421199",
    "end": "3422099"
  },
  {
    "text": "Well, you'd still use imports here and it will get compiled into requires. So here one thing you can try is just",
    "start": "3427533",
    "end": "3434366"
  },
  {
    "text": "console dot log a buffer or something. I wish are all divided",
    "start": "3434366",
    "end": "3441100"
  },
  {
    "text": "by the node one time.",
    "start": "3441100",
    "end": "3442433"
  },
  {
    "text": "That one too. Cool.",
    "start": "3448433",
    "end": "3453633"
  },
  {
    "text": "Cool. Awesome. All right. I feel like progress is made.",
    "start": "3458333",
    "end": "3464333"
  },
  {
    "text": "I know it was a short stream, but this is I feel like this was we had been thinking",
    "start": "3464633",
    "end": "3470100"
  },
  {
    "text": "this was going to be a bigger problem than it. I mean, I'm sure we'll run into issues with the strategy we've chosen for",
    "start": "3470100",
    "end": "3475966"
  },
  {
    "text": "importing the config file. But for now, I feel like this is I feel like this is a really good start, at least.",
    "start": "3475966",
    "end": "3482366"
  },
  {
    "text": "And if we go back to config builder. So.",
    "start": "3483433",
    "end": "3487800"
  },
  {
    "text": "We've also got access to the ESbuild hash.",
    "start": "3489533",
    "end": "3492099"
  },
  {
    "text": "From the file name as well, which we're probably going to use for I don't know something.",
    "start": "3496333",
    "end": "3501399"
  },
  {
    "text": "Content layer uses this hash for quite a few things like caching and whatnot.",
    "start": "3502433",
    "end": "3508333"
  },
  {
    "text": "So I feel like outputting the hash as an independent field from the",
    "start": "3508866",
    "end": "3514199"
  },
  {
    "text": "build is probably desirable. Cool.",
    "start": "3514199",
    "end": "3518766"
  },
  {
    "text": "This is great. So thank you very much for hopping on for such a short stream.",
    "start": "3519600",
    "end": "3523500"
  },
  {
    "text": "But yeah, I feel like this was good. So we'll try to keep the weekly cadence",
    "start": "3524666",
    "end": "3530399"
  },
  {
    "text": "if we can moving forward. Thanks, everyone.",
    "start": "3530399",
    "end": "3535433"
  }
]