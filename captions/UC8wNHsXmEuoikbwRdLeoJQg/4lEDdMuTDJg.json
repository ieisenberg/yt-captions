[
  {
    "text": "(audience applauds)",
    "start": "0",
    "end": "3041"
  },
  {
    "text": "Hello.",
    "start": "3791",
    "end": "4291"
  },
  {
    "text": "I'm Tim.",
    "start": "4791",
    "end": "5291"
  },
  {
    "text": "Great to see all your beautiful faces here today.",
    "start": "6708",
    "end": "9041"
  },
  {
    "text": "I am the founding engineer at Effectful.",
    "start": "10541",
    "end": "12708"
  },
  {
    "text": "And you can find me in a couple of places on the interweb.",
    "start": "13250",
    "end": "16583"
  },
  {
    "text": "And I'm also in the Effect Discord hanging around.",
    "start": "17458",
    "end": "19916"
  },
  {
    "text": "And I just hack on Effect all day, pretty much.",
    "start": "21541",
    "end": "24583"
  },
  {
    "text": "And today, I'd like to talk to you about Effect Cluster,",
    "start": "25791",
    "end": "27791"
  },
  {
    "text": "as Johannes pointed out to you.",
    "start": "28375",
    "end": "30000"
  },
  {
    "text": "And also, an underlying theme to this",
    "start": "30750",
    "end": "36208"
  },
  {
    "text": "will be Effect RPC as well.",
    "start": "36208",
    "end": "37750"
  },
  {
    "text": "And first, I'd just like to answer the question,",
    "start": "39166",
    "end": "44791"
  },
  {
    "text": "what the heck is Effect Cluster?",
    "start": "45833",
    "end": "47041"
  },
  {
    "text": "Do I need this?",
    "start": "47708",
    "end": "48875"
  },
  {
    "text": "What does it do?",
    "start": "49083",
    "end": "49750"
  },
  {
    "text": "Well, the first thing I'd like to answer--",
    "start": "50666",
    "end": "54125"
  },
  {
    "text": "my first response to that is, there's",
    "start": "55958",
    "end": "59333"
  },
  {
    "text": "TypeScript growing up.",
    "start": "59333",
    "end": "60500"
  },
  {
    "text": "And I think over the past few years,",
    "start": "60500",
    "end": "63500"
  },
  {
    "text": "we've seen an evolution in the TypeScript ecosystem.",
    "start": "63666",
    "end": "67166"
  },
  {
    "text": "If you don't know my history, I started Node.js back",
    "start": "68916",
    "end": "71916"
  },
  {
    "text": "when it was 0.1.",
    "start": "71916",
    "end": "73166"
  },
  {
    "text": "It was hacking on it with Ryan and the team.",
    "start": "73833",
    "end": "76750"
  },
  {
    "text": "But I've kind of--",
    "start": "78208",
    "end": "79083"
  },
  {
    "text": "I stepped away from it for a long time,",
    "start": "79458",
    "end": "80958"
  },
  {
    "text": "just because JavaScript was dynamic.",
    "start": "80958",
    "end": "83375"
  },
  {
    "text": "It didn't have a type system.",
    "start": "83375",
    "end": "84625"
  },
  {
    "text": "I wouldn't want to debug JavaScript in production.",
    "start": "85458",
    "end": "87916"
  },
  {
    "text": "So I was kind of like in the Ruby, Elixir world",
    "start": "89125",
    "end": "92500"
  },
  {
    "text": "for a long time.",
    "start": "92500",
    "end": "93458"
  },
  {
    "text": "And I really fell in love with Elixir,",
    "start": "93958",
    "end": "95458"
  },
  {
    "text": "because it's how it structures--",
    "start": "95750",
    "end": "99166"
  },
  {
    "text": "how it kind of models concurrency",
    "start": "100666",
    "end": "102291"
  },
  {
    "text": "and distributed systems.",
    "start": "102291",
    "end": "103500"
  },
  {
    "text": "So if you're not familiar with",
    "start": "104583",
    "end": "105708"
  },
  {
    "text": "Elixir, who's used Elixir here?",
    "start": "105708",
    "end": "108041"
  },
  {
    "text": "Yeah.",
    "start": "109791",
    "end": "110291"
  },
  {
    "text": "I bet everyone who's used it loves it.",
    "start": "111000",
    "end": "113000"
  },
  {
    "text": "It's a great language.",
    "start": "113000",
    "end": "113916"
  },
  {
    "text": "It has the nice functional aspects",
    "start": "114666",
    "end": "116166"
  },
  {
    "text": "that we know and love here as users of Effect.",
    "start": "116166",
    "end": "118416"
  },
  {
    "text": "But one thing that really shines with Elixir and things",
    "start": "120375",
    "end": "124416"
  },
  {
    "text": "like Akka and all these clustering solutions",
    "start": "124416",
    "end": "127750"
  },
  {
    "text": "is the Actor model.",
    "start": "128000",
    "end": "128916"
  },
  {
    "text": "And TypeScript hasn't really had a kind of like piece",
    "start": "131958",
    "end": "136125"
  },
  {
    "text": "in the game for this.",
    "start": "136125",
    "end": "137833"
  },
  {
    "text": "Like only very recently, we've seen TypeScript kind of take",
    "start": "138333",
    "end": "141583"
  },
  {
    "text": "over the JavaScript ecosystem.",
    "start": "141583",
    "end": "143000"
  },
  {
    "text": "In the beginning, TypeScript",
    "start": "144375",
    "end": "146541"
  },
  {
    "text": "was kind of just like sprinkled",
    "start": "146541",
    "end": "147833"
  },
  {
    "text": "on top of your JavaScript.",
    "start": "148125",
    "end": "149083"
  },
  {
    "text": "And people really struggled with it.",
    "start": "150291",
    "end": "153833"
  },
  {
    "text": "But only over the past few years have",
    "start": "154208",
    "end": "155915"
  },
  {
    "text": "we seen TypeScript-first software being built.",
    "start": "155916",
    "end": "158625"
  },
  {
    "text": "And this is where Effect--",
    "start": "159458",
    "end": "160540"
  },
  {
    "text": "my journey into Effect comes in.",
    "start": "161166",
    "end": "162750"
  },
  {
    "text": "Effect is really TypeScript-first framework",
    "start": "163708",
    "end": "166500"
  },
  {
    "text": "that really makes the most of the type system",
    "start": "166666",
    "end": "169000"
  },
  {
    "text": "to kind of assist you in your development.",
    "start": "169666",
    "end": "171416"
  },
  {
    "text": "Like we have areas as values.",
    "start": "171833",
    "end": "173458"
  },
  {
    "text": "We represent dependency ejection in the type system.",
    "start": "173875",
    "end": "176500"
  },
  {
    "text": "So Effect fully leverages TypeScript",
    "start": "178500",
    "end": "180541"
  },
  {
    "text": "to make your development easier and more production ready.",
    "start": "180750",
    "end": "186333"
  },
  {
    "text": "So we're actually starting into this phase in TypeScript",
    "start": "187583",
    "end": "190290"
  },
  {
    "text": "where we're actually getting some of the nice things",
    "start": "190291",
    "end": "192291"
  },
  {
    "text": "that other languages have had for a long time.",
    "start": "192291",
    "end": "194708"
  },
  {
    "text": "Like if you've been using Scala",
    "start": "195166",
    "end": "196625"
  },
  {
    "text": "or Elixir, as I mentioned before,",
    "start": "196625",
    "end": "198625"
  },
  {
    "text": "or dare I say Java.",
    "start": "199291",
    "end": "201000"
  },
  {
    "text": "You've had these frameworks that are like enterprise grade",
    "start": "202083",
    "end": "206165"
  },
  {
    "text": "production ready--",
    "start": "206625",
    "end": "207333"
  },
  {
    "text": "help you to create production ready systems.",
    "start": "208083",
    "end": "210375"
  },
  {
    "text": "And for Effect, Effect Cluster is",
    "start": "211750",
    "end": "213916"
  },
  {
    "text": "like a step in that direction.",
    "start": "213916",
    "end": "215041"
  },
  {
    "text": "So we're bringing the power of",
    "start": "216208",
    "end": "217958"
  },
  {
    "text": "these kind of like distributed",
    "start": "217958",
    "end": "222458"
  },
  {
    "text": "system solutions to TypeScript.",
    "start": "223500",
    "end": "225083"
  },
  {
    "text": "And they all kind of revolve around this single writer",
    "start": "226166",
    "end": "228625"
  },
  {
    "text": "principle, which is write should go to one place.",
    "start": "228791",
    "end": "231916"
  },
  {
    "text": "Otherwise, you introduce lots of issues like contention.",
    "start": "232708",
    "end": "235790"
  },
  {
    "text": "And the list goes on.",
    "start": "236375",
    "end": "238000"
  },
  {
    "text": "But I won't get into that.",
    "start": "238000",
    "end": "238916"
  },
  {
    "text": "And one other thing a Cluster is aiming to do",
    "start": "240000",
    "end": "242916"
  },
  {
    "text": "is allow you to write business logic in simple building",
    "start": "242916",
    "end": "246291"
  },
  {
    "text": "blocks that we call entities.",
    "start": "246375",
    "end": "247666"
  },
  {
    "text": "Just to bring back to Elixir, you have the Gen Server model,",
    "start": "249083",
    "end": "251958"
  },
  {
    "text": "which allows you to build your business logic",
    "start": "252166",
    "end": "255583"
  },
  {
    "text": "in these kind of like building blocks.",
    "start": "255583",
    "end": "257375"
  },
  {
    "text": "And the other thing it allows you to do",
    "start": "258541",
    "end": "260207"
  },
  {
    "text": "is treat multiple machines or like Kubernetes",
    "start": "260208",
    "end": "264583"
  },
  {
    "text": "nodes as one single unit.",
    "start": "265125",
    "end": "266875"
  },
  {
    "text": "So drawing back to Elixir, you can have like",
    "start": "268166",
    "end": "271500"
  },
  {
    "text": "a Beam cluster.",
    "start": "271500",
    "end": "272125"
  },
  {
    "text": "And you don't need to really worry",
    "start": "273083",
    "end": "274750"
  },
  {
    "text": "about where something is on the cluster.",
    "start": "274833",
    "end": "276250"
  },
  {
    "text": "You just kind of like reference it by like an ID that you",
    "start": "276500",
    "end": "280875"
  },
  {
    "text": "define.",
    "start": "280916",
    "end": "281416"
  },
  {
    "text": "So why use the Effect Cluster?",
    "start": "283125",
    "end": "284333"
  },
  {
    "text": "It just makes it a lot easier to write distributed systems.",
    "start": "285291",
    "end": "288416"
  },
  {
    "text": "If you have more than one computer, which you probably",
    "start": "289458",
    "end": "292375"
  },
  {
    "text": "do in production, when you use Effect Cluster,",
    "start": "292458",
    "end": "296583"
  },
  {
    "text": "you don't have to worry about--",
    "start": "296833",
    "end": "298083"
  },
  {
    "text": "you don't have to think anymore about like,",
    "start": "298833",
    "end": "301708"
  },
  {
    "text": "what node is this pod on?",
    "start": "302125",
    "end": "304583"
  },
  {
    "text": "What is its IP address?",
    "start": "304583",
    "end": "306083"
  },
  {
    "text": "What is its port?",
    "start": "306083",
    "end": "306833"
  },
  {
    "text": "You just need to think about your business logic.",
    "start": "307958",
    "end": "310958"
  },
  {
    "text": "You just think about your entities.",
    "start": "310958",
    "end": "312333"
  },
  {
    "text": "Heavily relies on the Effect Schema to model your domain.",
    "start": "315000",
    "end": "317375"
  },
  {
    "text": "And because of that, we can derive a lot of things.",
    "start": "318208",
    "end": "320958"
  },
  {
    "text": "So you don't have to think about your communication layer.",
    "start": "321166",
    "end": "323457"
  },
  {
    "text": "So Schema will make sure like",
    "start": "324416",
    "end": "326041"
  },
  {
    "text": "whatever message you're sending,",
    "start": "326041",
    "end": "327750"
  },
  {
    "text": "it will be properly serialized.",
    "start": "327750",
    "end": "329250"
  },
  {
    "text": "And if it just so happens that the entity was",
    "start": "330041",
    "end": "332541"
  },
  {
    "text": "on the same machine, it will just send it locally.",
    "start": "332541",
    "end": "335541"
  },
  {
    "text": "So whether an entity is living on a different machine",
    "start": "337000",
    "end": "340250"
  },
  {
    "text": "or on the same one, it will just make sure your message is",
    "start": "340500",
    "end": "343083"
  },
  {
    "text": "delivered for you.",
    "start": "343083",
    "end": "343791"
  },
  {
    "text": "And you also don't need to think about the distribution",
    "start": "344375",
    "end": "346166"
  },
  {
    "text": "of work.",
    "start": "346166",
    "end": "346750"
  },
  {
    "text": "So the more entities you have, Effect Cluster",
    "start": "347708",
    "end": "351250"
  },
  {
    "text": "is what we call like a sharding framework.",
    "start": "351708",
    "end": "353500"
  },
  {
    "text": "And it will make sure everything is evenly",
    "start": "354291",
    "end": "357375"
  },
  {
    "text": "distributed over all of the machines in your cluster.",
    "start": "357458",
    "end": "360541"
  },
  {
    "text": "So I'll quickly cover how does it work.",
    "start": "364000",
    "end": "366291"
  },
  {
    "text": "And it's heavily inspired by Shardcake,",
    "start": "366583",
    "end": "369583"
  },
  {
    "text": "which is Scala library for ZIO.",
    "start": "369833",
    "end": "374416"
  },
  {
    "text": "So a Cluster has multiple Runners.",
    "start": "376041",
    "end": "377500"
  },
  {
    "text": "And you can think of these like a single machine",
    "start": "377750",
    "end": "380625"
  },
  {
    "text": "in your Cluster.",
    "start": "380958",
    "end": "381500"
  },
  {
    "text": "And each Runner is assigned Shards.",
    "start": "382500",
    "end": "384208"
  },
  {
    "text": "And the Shard is a unit of distribution in the Cluster.",
    "start": "384750",
    "end": "388666"
  },
  {
    "text": "So let's say you--",
    "start": "389500",
    "end": "390791"
  },
  {
    "text": "and the number of shards is fixed.",
    "start": "392083",
    "end": "394291"
  },
  {
    "text": "So you would have 300 shards.",
    "start": "394541",
    "end": "396457"
  },
  {
    "text": "And your number of runners might grow and expand",
    "start": "397375",
    "end": "400250"
  },
  {
    "text": "as your cluster might auto scale.",
    "start": "400250",
    "end": "402583"
  },
  {
    "text": "And regardless of how many Runners you have or machines",
    "start": "404333",
    "end": "407000"
  },
  {
    "text": "you have in your Cluster, the 300 shards",
    "start": "407000",
    "end": "409625"
  },
  {
    "text": "are always evenly distributed.",
    "start": "409625",
    "end": "411166"
  },
  {
    "text": "So if you had 300 shards and 100 Runners,",
    "start": "412125",
    "end": "415208"
  },
  {
    "text": "each runner would have three shards.",
    "start": "415666",
    "end": "417291"
  },
  {
    "text": "And the your entities are allocated to the shards.",
    "start": "419291",
    "end": "422332"
  },
  {
    "text": "And in the Effect Cluster right",
    "start": "422375",
    "end": "428041"
  },
  {
    "text": "now, you have one shard manager.",
    "start": "428041",
    "end": "429541"
  },
  {
    "text": "And its only job is to assign shards to your Runners.",
    "start": "430125",
    "end": "434041"
  },
  {
    "text": "And that can operate with downtime.",
    "start": "436583",
    "end": "439000"
  },
  {
    "text": "So if your shard manager goes down,",
    "start": "439291",
    "end": "440916"
  },
  {
    "text": "the cluster will continue to operate.",
    "start": "441125",
    "end": "442583"
  },
  {
    "text": "And when it goes back up, great.",
    "start": "443291",
    "end": "444916"
  },
  {
    "text": "So over the past, the Cluster has had a long journey.",
    "start": "447000",
    "end": "449291"
  },
  {
    "text": "Mattia started the work last year.",
    "start": "450458",
    "end": "452416"
  },
  {
    "text": "And he talked about it at the previous Effect Days.",
    "start": "452416",
    "end": "454375"
  },
  {
    "text": "So shout out to Mattia.",
    "start": "455208",
    "end": "456208"
  },
  {
    "text": "But we started to take a step",
    "start": "458166",
    "end": "459916"
  },
  {
    "text": "back and think about a few things.",
    "start": "459916",
    "end": "461375"
  },
  {
    "text": "What if persistence was woven into the messaging layer?",
    "start": "461916",
    "end": "464416"
  },
  {
    "text": "So in shardcake, messaging is all done over the network.",
    "start": "465583",
    "end": "470833"
  },
  {
    "text": "And if your server is down, then the message won't be sent.",
    "start": "471833",
    "end": "475583"
  },
  {
    "text": "It won't be delivered.",
    "start": "475791",
    "end": "476416"
  },
  {
    "text": "So what if persistence could be",
    "start": "477333",
    "end": "479875"
  },
  {
    "text": "woven into the messaging layer?",
    "start": "479875",
    "end": "481166"
  },
  {
    "text": "So even if one of the runners was down,",
    "start": "481500",
    "end": "484791"
  },
  {
    "text": "and you send a message when it comes back up,",
    "start": "485250",
    "end": "487291"
  },
  {
    "text": "it then processes it.",
    "start": "487291",
    "end": "488416"
  },
  {
    "text": "So we want to ensure that messages are always eventually",
    "start": "490541",
    "end": "493500"
  },
  {
    "text": "delivered in some scenarios.",
    "start": "493625",
    "end": "494875"
  },
  {
    "text": "So we want to have the ability to",
    "start": "496000",
    "end": "497625"
  },
  {
    "text": "turn this persistence on and off.",
    "start": "497625",
    "end": "499166"
  },
  {
    "text": "Maybe you want a volatile message.",
    "start": "499666",
    "end": "501125"
  },
  {
    "text": "Maybe you want a persisted one.",
    "start": "501375",
    "end": "503333"
  },
  {
    "text": "And by doing this, we add kind of resilience to our system.",
    "start": "505000",
    "end": "511000"
  },
  {
    "text": "So if a pod goes down or if a client goes down,",
    "start": "511916",
    "end": "514541"
  },
  {
    "text": "when they come back up, they",
    "start": "514958",
    "end": "516083"
  },
  {
    "text": "can resume where they left off.",
    "start": "516083",
    "end": "517750"
  },
  {
    "text": "And we live in a world where chaos happens.",
    "start": "518625",
    "end": "522166"
  },
  {
    "text": "If you've been in distributed systems for a while,",
    "start": "524583",
    "end": "527000"
  },
  {
    "text": "you've heard of the chaos monkey.",
    "start": "527000",
    "end": "528208"
  },
  {
    "text": "Pods go down.",
    "start": "529791",
    "end": "530708"
  },
  {
    "text": "Communities like to reschedule things sometimes.",
    "start": "532125",
    "end": "534500"
  },
  {
    "text": "Resilience is quite important in this day and age.",
    "start": "535333",
    "end": "537916"
  },
  {
    "text": "And the other kind of benefit of this",
    "start": "539333",
    "end": "541291"
  },
  {
    "text": "is we get deduplication of messages.",
    "start": "541416",
    "end": "544083"
  },
  {
    "text": "So if your client restarts and",
    "start": "544500",
    "end": "546458"
  },
  {
    "text": "tries to send the same message",
    "start": "546458",
    "end": "547791"
  },
  {
    "text": "again, with persistence, we can identify that, hey,",
    "start": "547875",
    "end": "552791"
  },
  {
    "text": "this is the same message you sent last time.",
    "start": "552791",
    "end": "554458"
  },
  {
    "text": "So we'll just subscribe to the previous one.",
    "start": "554916",
    "end": "557250"
  },
  {
    "text": "You sent.",
    "start": "557833",
    "end": "558333"
  },
  {
    "text": "So the other thing we wanted to do in this rewrite",
    "start": "560458",
    "end": "562250"
  },
  {
    "text": "is improve the developer experience",
    "start": "562250",
    "end": "564208"
  },
  {
    "text": "of writing your entities.",
    "start": "564208",
    "end": "565458"
  },
  {
    "text": "And we wanted to improve the networking performance.",
    "start": "566958",
    "end": "570208"
  },
  {
    "text": "And to do this, we rewrote the Effect RPC package.",
    "start": "571083",
    "end": "575041"
  },
  {
    "text": "So it has an entirely new API with a more modular design.",
    "start": "576541",
    "end": "580041"
  },
  {
    "text": "So you can swap parts of the framework and in it.",
    "start": "580041",
    "end": "583416"
  },
  {
    "text": "So you could, let's say, swap HTTP for WebSockets.",
    "start": "583625",
    "end": "587666"
  },
  {
    "text": "Or if you wanted to use raw TCP sockets,",
    "start": "587958",
    "end": "590208"
  },
  {
    "text": "you could.",
    "start": "590333",
    "end": "590833"
  },
  {
    "text": "And you can also swap out the serialization.",
    "start": "591500",
    "end": "593500"
  },
  {
    "text": "So you could use JSON, message pack.",
    "start": "593875",
    "end": "596000"
  },
  {
    "text": "We might add more later.",
    "start": "596333",
    "end": "597250"
  },
  {
    "text": "And it now powers all of the communication",
    "start": "599041",
    "end": "602250"
  },
  {
    "text": "within the Effect Cluster.",
    "start": "602625",
    "end": "603625"
  },
  {
    "text": "So that's enough talking.",
    "start": "606416",
    "end": "607291"
  },
  {
    "text": "I'm now going to get into demo mode.",
    "start": "607625",
    "end": "609000"
  },
  {
    "text": "And to do that, I'll first show you",
    "start": "610708",
    "end": "615250"
  },
  {
    "text": "what the API for Cluster looks like.",
    "start": "616291",
    "end": "619041"
  },
  {
    "text": "So we go here, Effect Days.",
    "start": "619833",
    "end": "623833"
  },
  {
    "text": "First I'll go over the Schema.",
    "start": "627583",
    "end": "628958"
  },
  {
    "text": "So in Effect Cluster--",
    "start": "630166",
    "end": "631000"
  },
  {
    "text": "sorry for you who don't like light mode.",
    "start": "631583",
    "end": "634875"
  },
  {
    "text": "But I do.",
    "start": "638083",
    "end": "639000"
  },
  {
    "text": "So here we have--",
    "start": "642125",
    "end": "643791"
  },
  {
    "text": "maybe I'll start with the Entity API.",
    "start": "645208",
    "end": "648291"
  },
  {
    "text": "So here we have defined an entity called a battleship.",
    "start": "648791",
    "end": "651916"
  },
  {
    "text": "So this demo today is about distributed battleships.",
    "start": "652833",
    "end": "655708"
  },
  {
    "text": "And I've defined three procedure calls for this entity.",
    "start": "656958",
    "end": "659708"
  },
  {
    "text": "We can shoot a battleship.",
    "start": "662125",
    "end": "663291"
  },
  {
    "text": "We can shoot it with some delay.",
    "start": "664166",
    "end": "665583"
  },
  {
    "text": "And we can also shoot it into the future.",
    "start": "667041",
    "end": "670000"
  },
  {
    "text": "Maybe that should be named to shoot in the future",
    "start": "670000",
    "end": "672583"
  },
  {
    "text": "or something, but naming things is hard.",
    "start": "672583",
    "end": "675541"
  },
  {
    "text": "And I'm also annotating this entity",
    "start": "677083",
    "end": "678791"
  },
  {
    "text": "to say all the messages for this entity will be persisted.",
    "start": "678791",
    "end": "682875"
  },
  {
    "text": "And you can also override that.",
    "start": "686666",
    "end": "689000"
  },
  {
    "text": "So here we could go annotate, cluster schema not persisted.",
    "start": "689000",
    "end": "694291"
  },
  {
    "text": "And then we could save files.",
    "start": "694833",
    "end": "695541"
  },
  {
    "text": "And then only these two will be persisted.",
    "start": "698833",
    "end": "701000"
  },
  {
    "text": "And that one will be a normal network volatile message.",
    "start": "701000",
    "end": "704416"
  },
  {
    "text": "So here I have a couple of special payloads.",
    "start": "706875",
    "end": "710625"
  },
  {
    "text": "So we'll take a look at this one first.",
    "start": "710625",
    "end": "711791"
  },
  {
    "text": "So here we define the--",
    "start": "713791",
    "end": "715458"
  },
  {
    "text": "we're going to define the delay for this bullet.",
    "start": "716666",
    "end": "719500"
  },
  {
    "text": "And we're also going to implement primary key.",
    "start": "720500",
    "end": "722458"
  },
  {
    "text": "And by implementing primary key, we",
    "start": "723291",
    "end": "724875"
  },
  {
    "text": "opt into the deduplication of messages.",
    "start": "725500",
    "end": "728083"
  },
  {
    "text": "So we can say here, for every message that's",
    "start": "730291",
    "end": "733583"
  },
  {
    "text": "sent to this entity with this",
    "start": "733625",
    "end": "736708"
  },
  {
    "text": "target, only ever send it once.",
    "start": "736708",
    "end": "740083"
  },
  {
    "text": "And then we can make sure,",
    "start": "741250",
    "end": "742375"
  },
  {
    "text": "like, if the client tries to send it",
    "start": "742375",
    "end": "743500"
  },
  {
    "text": "again, it will then subscribe",
    "start": "743500",
    "end": "744666"
  },
  {
    "text": "to the previous message result.",
    "start": "744666",
    "end": "746125"
  },
  {
    "text": "And then the other payload here is",
    "start": "747875",
    "end": "749750"
  },
  {
    "text": "we're using another kind of",
    "start": "750041",
    "end": "751708"
  },
  {
    "text": "like interface called DeliverAt.",
    "start": "751708",
    "end": "753750"
  },
  {
    "text": "And by doing that, we can say this message will only",
    "start": "754791",
    "end": "759541"
  },
  {
    "text": "be delivered to the entity at this point in time.",
    "start": "759625",
    "end": "763541"
  },
  {
    "text": "So by doing that, you could",
    "start": "764916",
    "end": "765875"
  },
  {
    "text": "say, send this message six months",
    "start": "765875",
    "end": "767750"
  },
  {
    "text": "to the future.",
    "start": "768166",
    "end": "768875"
  },
  {
    "text": "And in six months time, the entity",
    "start": "769250",
    "end": "770708"
  },
  {
    "text": "will then receive the message.",
    "start": "770708",
    "end": "771791"
  },
  {
    "text": "So that's kind of the entity API.",
    "start": "773916",
    "end": "775708"
  },
  {
    "text": "And then when it comes to implementing your runner,",
    "start": "776500",
    "end": "782541"
  },
  {
    "text": "you first need to implement your procedures.",
    "start": "784875",
    "end": "787750"
  },
  {
    "text": "So here we're providing",
    "start": "789291",
    "end": "790500"
  },
  {
    "text": "effects for each of those procedures",
    "start": "790500",
    "end": "795250"
  },
  {
    "text": "that we defined.",
    "start": "795250",
    "end": "795916"
  },
  {
    "text": "So when we shoot, we're just going to log boom.",
    "start": "796250",
    "end": "798000"
  },
  {
    "text": "And we're just going to add some annotations to the log.",
    "start": "800041",
    "end": "802041"
  },
  {
    "text": "Shoot with delay, we'll just sleep for a period of time",
    "start": "803000",
    "end": "805500"
  },
  {
    "text": "and then say done.",
    "start": "805500",
    "end": "806291"
  },
  {
    "text": "And then because we're using like the DeliverAt trait",
    "start": "807541",
    "end": "811708"
  },
  {
    "text": "or interface we saw earlier, when this message is finally",
    "start": "812750",
    "end": "816958"
  },
  {
    "text": "sent to the entity, we're just",
    "start": "817166",
    "end": "818708"
  },
  {
    "text": "going to say, hey, we got it.",
    "start": "818708",
    "end": "819916"
  },
  {
    "text": "It's done.",
    "start": "819916",
    "end": "820416"
  },
  {
    "text": "And then because I wanted to celebrate the best module,",
    "start": "822291",
    "end": "825000"
  },
  {
    "text": "we have at Effect, Cron.",
    "start": "825000",
    "end": "826125"
  },
  {
    "text": "I was paid to say that by Sebastian.",
    "start": "827875",
    "end": "829375"
  },
  {
    "text": "I've added a cronship to the cluster.",
    "start": "833208",
    "end": "836291"
  },
  {
    "text": "And this kind of demonstrates singletons.",
    "start": "836666",
    "end": "838500"
  },
  {
    "text": "So we have entities, but another thing",
    "start": "839250",
    "end": "841000"
  },
  {
    "text": "that we have in cluster is singletons.",
    "start": "841000",
    "end": "842416"
  },
  {
    "text": "And a singleton represents a single running",
    "start": "843083",
    "end": "845666"
  },
  {
    "text": "in your cluster.",
    "start": "845875",
    "end": "847083"
  },
  {
    "text": "So no matter how many runners you have in your cluster,",
    "start": "848291",
    "end": "851250"
  },
  {
    "text": "this will only be running in one place somewhere.",
    "start": "851500",
    "end": "854250"
  },
  {
    "text": "And when this thing boots up, it",
    "start": "855583",
    "end": "857000"
  },
  {
    "text": "will say the cronship is sailing.",
    "start": "857000",
    "end": "858208"
  },
  {
    "text": "When it shuts down, it will sink.",
    "start": "859125",
    "end": "860666"
  },
  {
    "text": "Every minute, it will use cron",
    "start": "861958",
    "end": "863666"
  },
  {
    "text": "to say the cronship is croning.",
    "start": "863666",
    "end": "865250"
  },
  {
    "text": "And then at the end, we merge all of the stuff",
    "start": "867416",
    "end": "870458"
  },
  {
    "text": "we want to run on our cluster.",
    "start": "870708",
    "end": "872000"
  },
  {
    "text": "And we kind of like--",
    "start": "872416",
    "end": "873208"
  },
  {
    "text": "in Platform Node, we have a bunch of cluster modules",
    "start": "874166",
    "end": "877291"
  },
  {
    "text": "for defining the layers for cluster.",
    "start": "877500",
    "end": "879458"
  },
  {
    "text": "So here, I'm using TCP sockets.",
    "start": "880375",
    "end": "883958"
  },
  {
    "text": "And I'll use the SQL Message Storage back end.",
    "start": "884916",
    "end": "887458"
  },
  {
    "text": "And I will then provide my SQL client.",
    "start": "888083",
    "end": "890000"
  },
  {
    "text": "And also in here, I've got a couple of clients.",
    "start": "891833",
    "end": "894458"
  },
  {
    "text": "So you can also connect to your cluster,",
    "start": "895625",
    "end": "897416"
  },
  {
    "text": "but without participating and running the entities,",
    "start": "897541",
    "end": "901833"
  },
  {
    "text": "you could have client-only participants.",
    "start": "901958",
    "end": "904291"
  },
  {
    "text": "So here, we're grabbing the client for a battleship,",
    "start": "905958",
    "end": "908708"
  },
  {
    "text": "and then just firing messages at it.",
    "start": "909625",
    "end": "912166"
  },
  {
    "text": "And then we also have one for persisted messages,",
    "start": "913458",
    "end": "915750"
  },
  {
    "text": "and one that goes really fast.",
    "start": "916333",
    "end": "918541"
  },
  {
    "text": "So let's see how this works.",
    "start": "919000",
    "end": "920416"
  },
  {
    "text": "Hopefully, I can talk to a cluster.",
    "start": "925833",
    "end": "927625"
  },
  {
    "text": "Yeah, there we go.",
    "start": "927666",
    "end": "931541"
  },
  {
    "text": "So I've got a cluster of 100 nodes on it, just for fun.",
    "start": "932083",
    "end": "935208"
  },
  {
    "text": "So the first thing we'll do is get Postgres up.",
    "start": "937291",
    "end": "941250"
  },
  {
    "text": "So there it is, splitting up.",
    "start": "946458",
    "end": "947625"
  },
  {
    "text": "And the kind of like-- one thing we need in a cluster",
    "start": "951416",
    "end": "953833"
  },
  {
    "text": "is the shard manager.",
    "start": "954041",
    "end": "954833"
  },
  {
    "text": "So we'll spin that up.",
    "start": "955541",
    "end": "960041"
  },
  {
    "text": "Shard manager.",
    "start": "961791",
    "end": "962291"
  },
  {
    "text": "And that will crash unless Postgres is up.",
    "start": "965041",
    "end": "967916"
  },
  {
    "text": "There we go.",
    "start": "967916",
    "end": "968416"
  },
  {
    "text": "Good.",
    "start": "972375",
    "end": "972708"
  },
  {
    "text": "We've got a shard manager.",
    "start": "972708",
    "end": "973375"
  },
  {
    "text": "So now we're ready to deploy our runners.",
    "start": "974166",
    "end": "976166"
  },
  {
    "text": "So all you really need for a cluster",
    "start": "977125",
    "end": "978333"
  },
  {
    "text": "is if you don't have to use our persisted messaging,",
    "start": "978541",
    "end": "983208"
  },
  {
    "text": "but in this case, we do.",
    "start": "983375",
    "end": "985291"
  },
  {
    "text": "So we've got Postgres.",
    "start": "985583",
    "end": "986666"
  },
  {
    "text": "So the first thing we'll do is deploy our battleships.",
    "start": "988083",
    "end": "993541"
  },
  {
    "text": "So those are all of our runner services.",
    "start": "995791",
    "end": "997458"
  },
  {
    "text": "There we go.",
    "start": "999166",
    "end": "999666"
  },
  {
    "text": "And we're running.",
    "start": "1003833",
    "end": "1004333"
  },
  {
    "text": "And there we go.",
    "start": "1004708",
    "end": "1005166"
  },
  {
    "text": "The Cronship is up.",
    "start": "1005166",
    "end": "1006041"
  },
  {
    "text": "Sailing and cronning.",
    "start": "1007208",
    "end": "1007958"
  },
  {
    "text": "That's what we like to see.",
    "start": "1008375",
    "end": "1009250"
  },
  {
    "text": "Because we've only got one pod, the singleton is on this.",
    "start": "1010625",
    "end": "1015666"
  },
  {
    "text": "But if we were to scale this up to 10,",
    "start": "1016583",
    "end": "1019750"
  },
  {
    "text": "then it might move to another pod to ensure.",
    "start": "1020041",
    "end": "1022375"
  },
  {
    "text": "So when you spin up more runners,",
    "start": "1023041",
    "end": "1025583"
  },
  {
    "text": "then the shard manager will redistribute the shards.",
    "start": "1026000",
    "end": "1028125"
  },
  {
    "text": "And then you might see the crong ship",
    "start": "1029166",
    "end": "1032208"
  },
  {
    "text": "move to another runner if the shard is reassigned.",
    "start": "1032208",
    "end": "1035791"
  },
  {
    "text": "And the cluster will always make sure",
    "start": "1038291",
    "end": "1040791"
  },
  {
    "text": "a shard is only if we're running in one place.",
    "start": "1041041",
    "end": "1042791"
  },
  {
    "text": "So you never get the duplication of processing",
    "start": "1043708",
    "end": "1047750"
  },
  {
    "text": "or duplication of entities.",
    "start": "1048000",
    "end": "1050083"
  },
  {
    "text": "So I'll scale that back down to one.",
    "start": "1052000",
    "end": "1053583"
  },
  {
    "text": "So the next thing we'll do is deploy one of the clients.",
    "start": "1055500",
    "end": "1059083"
  },
  {
    "text": "I think it was the shooter.",
    "start": "1059625",
    "end": "1060583"
  },
  {
    "text": "So this is-- are we disabled persistence for this message?",
    "start": "1069916",
    "end": "1076208"
  },
  {
    "text": "So this is just an example of normal messaging",
    "start": "1076208",
    "end": "1078583"
  },
  {
    "text": "over the network.",
    "start": "1079750",
    "end": "1080416"
  },
  {
    "text": "So we're shooting ships.",
    "start": "1081875",
    "end": "1082750"
  },
  {
    "text": "And then if we go here, we'll see the bullets coming in.",
    "start": "1084291",
    "end": "1088000"
  },
  {
    "text": "And it going boom, boom, boom.",
    "start": "1088000",
    "end": "1089125"
  },
  {
    "text": "Great.",
    "start": "1091625",
    "end": "1092125"
  },
  {
    "text": "Our battleships are dying.",
    "start": "1092875",
    "end": "1093708"
  },
  {
    "text": "And if we scale this to zero, then those messages",
    "start": "1095625",
    "end": "1098500"
  },
  {
    "text": "will fail to send because--",
    "start": "1098500",
    "end": "1101000"
  },
  {
    "text": "yeah, it's frozen--",
    "start": "1101666",
    "end": "1102333"
  },
  {
    "text": "because those messages are reliant on the network only.",
    "start": "1103458",
    "end": "1106791"
  },
  {
    "text": "So next thing we'll take a quick look at is persistence.",
    "start": "1108916",
    "end": "1112291"
  },
  {
    "text": "So if we--",
    "start": "1113791",
    "end": "1114500"
  },
  {
    "text": "I think I called it slow shooter.",
    "start": "1115083",
    "end": "1117208"
  },
  {
    "text": "There we go.",
    "start": "1126750",
    "end": "1127333"
  },
  {
    "text": "So we can see it's sending off",
    "start": "1130250",
    "end": "1131291"
  },
  {
    "text": "a bunch of persisted messages.",
    "start": "1131291",
    "end": "1132916"
  },
  {
    "text": "And then sometime later, the battleships will respond.",
    "start": "1133208",
    "end": "1138500"
  },
  {
    "text": "So here we can see the messages have been received.",
    "start": "1139166",
    "end": "1141416"
  },
  {
    "text": "And but this time, all the messages now persisted.",
    "start": "1142250",
    "end": "1145291"
  },
  {
    "text": "And just to demonstrate that, see",
    "start": "1148000",
    "end": "1150166"
  },
  {
    "text": "we've got our results back.",
    "start": "1150500",
    "end": "1151583"
  },
  {
    "text": "I'm going to turn off all of our battleships.",
    "start": "1152666",
    "end": "1157458"
  },
  {
    "text": "I'm just going to--",
    "start": "1160250",
    "end": "1161208"
  },
  {
    "text": "well, I'll quickly demonstrate the deduplication aspect.",
    "start": "1162250",
    "end": "1165375"
  },
  {
    "text": "So if I restart there.",
    "start": "1165708",
    "end": "1166958"
  },
  {
    "text": "Because all the messages would have the same ID.",
    "start": "1173000",
    "end": "1175125"
  },
  {
    "text": "There should have been a response here.",
    "start": "1189750",
    "end": "1190541"
  },
  {
    "text": "Oh, yeah.",
    "start": "1193875",
    "end": "1194333"
  },
  {
    "text": "Sorry.",
    "start": "1194333",
    "end": "1194666"
  },
  {
    "text": "It did work.",
    "start": "1194666",
    "end": "1195166"
  },
  {
    "text": "Try that again.",
    "start": "1197958",
    "end": "1198458"
  },
  {
    "text": "So they got responses even though the server was down.",
    "start": "1202041",
    "end": "1205666"
  },
  {
    "text": "No, they didn't.",
    "start": "1207291",
    "end": "1207791"
  },
  {
    "text": "So Yeah, there we go.",
    "start": "1233458",
    "end": "1236458"
  },
  {
    "text": "So if we then spin that down and then restart client.",
    "start": "1238750",
    "end": "1246666"
  },
  {
    "text": "OK, for some reason, it's not working.",
    "start": "1254250",
    "end": "1255250"
  },
  {
    "text": "It worked before.",
    "start": "1255541",
    "end": "1256333"
  },
  {
    "text": "So the other thing I wanted to demonstrate--",
    "start": "1260833",
    "end": "1264041"
  },
  {
    "text": "OK, I'm not sure what's going on.",
    "start": "1270250",
    "end": "1271583"
  },
  {
    "text": "I'll have to debug that later.",
    "start": "1272041",
    "end": "1273083"
  },
  {
    "text": "The other thing I wanted to demonstrate",
    "start": "1275125",
    "end": "1276375"
  },
  {
    "text": "is the distribution of work.",
    "start": "1276375",
    "end": "1277833"
  },
  {
    "text": "So if we spin that down to zero and then",
    "start": "1278666",
    "end": "1284291"
  },
  {
    "text": "do like 100 battleships and then spam them with messages.",
    "start": "1285041",
    "end": "1294000"
  },
  {
    "text": "All of those messages will be then equally",
    "start": "1300541",
    "end": "1309125"
  },
  {
    "text": "distributed over the cluster.",
    "start": "1309333",
    "end": "1311208"
  },
  {
    "text": "So here, we're firing",
    "start": "1318375",
    "end": "1319791"
  },
  {
    "text": "thousands of messages into the cluster.",
    "start": "1319791",
    "end": "1323291"
  },
  {
    "text": "If we look in here and look at the logs for each one,",
    "start": "1324125",
    "end": "1327041"
  },
  {
    "text": "we can see the messages evenly being distributed",
    "start": "1327041",
    "end": "1331500"
  },
  {
    "text": "over all of your runners.",
    "start": "1331875",
    "end": "1332916"
  },
  {
    "text": "All right, well, that was all for the demo.",
    "start": "1337833",
    "end": "1342125"
  },
  {
    "text": "So what's next?",
    "start": "1344458",
    "end": "1345125"
  },
  {
    "text": "The next part of this was looking at workflows.",
    "start": "1346208",
    "end": "1348625"
  },
  {
    "text": "So using these building blocks, this kind of persistence",
    "start": "1349958",
    "end": "1353583"
  },
  {
    "text": "we've added to messaging, we wanted to then do",
    "start": "1353875",
    "end": "1356083"
  },
  {
    "text": "durable workflows, which you can kind of think",
    "start": "1357250",
    "end": "1361083"
  },
  {
    "text": "of as durable effects.",
    "start": "1361083",
    "end": "1362208"
  },
  {
    "text": "And we also want to make sure the effect cluster back end",
    "start": "1363000",
    "end": "1366375"
  },
  {
    "text": "is optional so you can then work.",
    "start": "1366375",
    "end": "1367791"
  },
  {
    "text": "If you wanted to swap out the workflow back end",
    "start": "1368416",
    "end": "1371375"
  },
  {
    "text": "with something else, cluster would be optional.",
    "start": "1371666",
    "end": "1374166"
  },
  {
    "text": "Another thing we want to look at for cluster",
    "start": "1375458",
    "end": "1377000"
  },
  {
    "text": "is browser support.",
    "start": "1377125",
    "end": "1378000"
  },
  {
    "text": "So you could have a cluster in the browser.",
    "start": "1378250",
    "end": "1379916"
  },
  {
    "text": "So if you're doing a single page application,",
    "start": "1381500",
    "end": "1384250"
  },
  {
    "text": "you could then distribute work using Web Workers.",
    "start": "1384666",
    "end": "1386916"
  },
  {
    "text": "Another thing we'll look at is runner-parallelism.",
    "start": "1390125",
    "end": "1392458"
  },
  {
    "text": "So Node.js is single-threaded.",
    "start": "1392875",
    "end": "1397458"
  },
  {
    "text": "So we need to look at a way to make sure",
    "start": "1398125",
    "end": "1399583"
  },
  {
    "text": "if your machine has 4 CPU cores,",
    "start": "1400000",
    "end": "1401916"
  },
  {
    "text": "that each one of those cores is being used.",
    "start": "1402375",
    "end": "1404500"
  },
  {
    "text": "And then we also want to look at adding more resilience",
    "start": "1405833",
    "end": "1408000"
  },
  {
    "text": "to the shar manager.",
    "start": "1408000",
    "end": "1408791"
  },
  {
    "text": "So right now, you only have one shy manager,",
    "start": "1409208",
    "end": "1411750"
  },
  {
    "text": "but then we might need to look at some of that leader",
    "start": "1412333",
    "end": "1414041"
  },
  {
    "text": "elections.",
    "start": "1414125",
    "end": "1414625"
  },
  {
    "text": "So you could have three shard managers.",
    "start": "1414958",
    "end": "1416500"
  },
  {
    "text": "And if one of them goes down, another one is elected,",
    "start": "1417291",
    "end": "1419291"
  },
  {
    "text": "and then it adds resilience to that.",
    "start": "1420000",
    "end": "1422708"
  },
  {
    "text": "And also like an API gateway proxy.",
    "start": "1423750",
    "end": "1425666"
  },
  {
    "text": "So for the outside world to talk to your cluster,",
    "start": "1425916",
    "end": "1428375"
  },
  {
    "text": "it could go through like a gateway proxy",
    "start": "1429208",
    "end": "1431708"
  },
  {
    "text": "and then have a similar API to the client",
    "start": "1432458",
    "end": "1434750"
  },
  {
    "text": "we looked at earlier, but doesn't",
    "start": "1434750",
    "end": "1436791"
  },
  {
    "text": "have to connect to the cluster directly.",
    "start": "1436791",
    "end": "1439750"
  },
  {
    "text": "So when can you use it? now?",
    "start": "1442666",
    "end": "1446166"
  },
  {
    "text": "I just need to merge a PR.",
    "start": "1447166",
    "end": "1448333"
  },
  {
    "text": "But it's very, very alpha at the moment.",
    "start": "1451250",
    "end": "1454833"
  },
  {
    "text": "And there will likely be bugs, as you probably just saw.",
    "start": "1455000",
    "end": "1457291"
  },
  {
    "text": "So we're definitely looking for feedback.",
    "start": "1458416",
    "end": "1460291"
  },
  {
    "text": "And please don't run your production workloads on it yet.",
    "start": "1461250",
    "end": "1464041"
  },
  {
    "text": "But yeah, hopefully you're",
    "start": "1465958",
    "end": "1467958"
  },
  {
    "text": "going to idea what cluster is about",
    "start": "1467958",
    "end": "1469208"
  },
  {
    "text": "and what we've been working on for the past little while.",
    "start": "1469208",
    "end": "1471291"
  },
  {
    "text": "And hopefully you guys use it and love it.",
    "start": "1472000",
    "end": "1476666"
  },
  {
    "text": "Thank you.",
    "start": "1477750",
    "end": "1479916"
  },
  {
    "text": "(audience applauds)",
    "start": "1479916",
    "end": "1481916"
  }
]