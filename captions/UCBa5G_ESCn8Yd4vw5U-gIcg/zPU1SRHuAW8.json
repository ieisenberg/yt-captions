[
  {
    "start": "0",
    "end": "163000"
  },
  {
    "text": "Portion, and then a group portion. You'll be assigned groups in advance, um,",
    "start": "4010",
    "end": "9255"
  },
  {
    "text": "and there'll be numbers on the chairs for the room that you're in so you'll know where to go sit. And the way that it will work is you'll first",
    "start": "9255",
    "end": "15570"
  },
  {
    "text": "do the individual part, you'll turn that in, and then you'll receive another exam for the group part, and then go in and discuss your answers,",
    "start": "15570",
    "end": "22320"
  },
  {
    "text": "agree on them, and then scratch that off to see if you got it right, and then when you're done, you'll hand that in as your group one.",
    "start": "22320",
    "end": "27990"
  },
  {
    "text": "[NOISE] And, yeah. Uh, just, logist- logistical question.",
    "start": "27990",
    "end": "33930"
  },
  {
    "text": "So we're splitting into the two groups again without being asked later? Yes. Okay. Great question. [inaudible] asked is whether or not we're splitting into two rooms,",
    "start": "33930",
    "end": "40950"
  },
  {
    "text": "yes, we're again gonna do that, um, and that will be your assignment. Um, I think it's likely to be the same as last time,",
    "start": "40950",
    "end": "46220"
  },
  {
    "text": "but I will confirm that. We might make it slightly different because some SC- SCPD students will be joining us for this one that didn't before and vice-versa.",
    "start": "46220",
    "end": "52715"
  },
  {
    "text": "So it's possible, particularly, if you are right on the borderline, we'll, um, you'll be in a different room this time. So we'll announce that. Um, [NOISE] just as a reminder, right now,",
    "start": "52715",
    "end": "60690"
  },
  {
    "text": "we're basically done with all of the assignments so this is a great chance to be focusing on the projects. Um, you should have been getting feedback about all of those along with, with, um,",
    "start": "60690",
    "end": "68815"
  },
  {
    "text": "with a little bit of information back about your project and the person who graded it, will have signed that.",
    "start": "68815",
    "end": "74700"
  },
  {
    "text": "So that's a great TA to go ask questions of and their office hours are on Piazza. Um, but you're welcome to go to any of the office hours to ask about project questions.",
    "start": "74700",
    "end": "81740"
  },
  {
    "text": "[NOISE] And that poster session will be [NOISE] at the time,",
    "start": "81740",
    "end": "86924"
  },
  {
    "text": "the original time announced. It is sub-optimal but what can you do? We're gonna meet in the morning on, uh, the last day of finals.",
    "start": "86925",
    "end": "93710"
  },
  {
    "text": "[NOISE] So that was the one that we are assigned. Anybody else have any other questions about this?",
    "start": "93710",
    "end": "99755"
  },
  {
    "text": "Who here went to Chelsea's talk on Monday? [NOISE] Okay. She does, uh, for those of you who did- didn't get to see it,",
    "start": "99755",
    "end": "106260"
  },
  {
    "text": "Chelsea's talk will be online, it's a really nice talk about meta-reinforcement learning. It will be covered on the quiz next week,",
    "start": "106260",
    "end": "111920"
  },
  {
    "text": "but pretty light, um, because you haven't had much exposure to that idea. So again, just as a recap for the quiz.",
    "start": "111920",
    "end": "117530"
  },
  {
    "text": "The quiz will cover everything, um, in the course. But things that you didn't have a chance to actually think about, um,",
    "start": "117530",
    "end": "123659"
  },
  {
    "text": "uh, because you didn't get practice on it with an assignment, uh, we will test more lightly. It also will be multiple choice.",
    "start": "123660",
    "end": "130054"
  },
  {
    "text": "I highly recommend that you take the quiz from last year ignoring any topics that we haven't covered, [NOISE] um, and do that without looking at the answers.",
    "start": "130055",
    "end": "138050"
  },
  {
    "text": "Um, one of the robust finding for educational research is that forced recall is incredibly effective at helping people learn.",
    "start": "138050",
    "end": "144710"
  },
  {
    "text": "Forced recall is a nice way for testing [LAUGHTER]. So, um, this is, of course, in the case where you're not getting assessed by it so you just can use that to,",
    "start": "144710",
    "end": "152550"
  },
  {
    "text": "to check whether or not you understand these things and look at anythi- re-look up anything [NOISE] that might- you might have questions about.",
    "start": "152550",
    "end": "158970"
  },
  {
    "text": "Any other questions? All right.",
    "start": "158990",
    "end": "164010"
  },
  {
    "text": "So let's go ahead and get started. Um, we're gonna talk today about batch reinforcement learning, and in particular, safe batch reinforcement learning,",
    "start": "164010",
    "end": "170610"
  },
  {
    "text": "I'll define that what that is. Um, this is a topic that I think is extremely important,",
    "start": "170610",
    "end": "175620"
  },
  {
    "text": "we do a lot of work on it in my own lab. And most of the topics I'm gonna focus on today will be work that came out of,",
    "start": "175620",
    "end": "181430"
  },
  {
    "text": "uh, work that was done by my postdoc, Phil Thomas, who's now a professor at UMass Amherst, but the work he did before he worked with me, um,",
    "start": "181430",
    "end": "187715"
  },
  {
    "text": "some of our joint work, and I'll also highlight some other related work.",
    "start": "187715",
    "end": "191280"
  },
  {
    "text": "So let's think about a simple case. Um, let's think about doing a scientific experiment, um,",
    "start": "193420",
    "end": "198545"
  },
  {
    "text": "where you have a group of people who we're- we're gonna call the A group, and they get to first do this particular type of fractions problem.",
    "start": "198545",
    "end": "205025"
  },
  {
    "text": "This is a fractions problem for one of our tutoring systems, um, uh, where people are having to add fractions",
    "start": "205025",
    "end": "210379"
  },
  {
    "text": "together and then reduce the sum to the lowest terms. And then they have to do something where they do cross multiplication,",
    "start": "210380",
    "end": "216025"
  },
  {
    "text": "um, and then after that, they get an exam. [NOISE] And, again, an average score of a 95.",
    "start": "216025",
    "end": "222370"
  },
  {
    "text": "And then we have the B group that does the same activities but in the opposite order,",
    "start": "222370",
    "end": "227495"
  },
  {
    "text": "and then they get an average score of 92. And the question is, for a new student, what should we do?",
    "start": "227495",
    "end": "234000"
  },
  {
    "text": "[NOISE] And what would I- what would- what additional information might you want to know in order to be able to answer this question?",
    "start": "234000",
    "end": "241790"
  },
  {
    "text": "So feel free to shout that out. So what would you need to do for like now, a new student comes along?",
    "start": "241790",
    "end": "247550"
  },
  {
    "text": "[NOISE] Now,",
    "start": "247550",
    "end": "256730"
  },
  {
    "text": "let's imagine our objective is to get a high score on this exam, for that student to get a high score on this exam.",
    "start": "256730",
    "end": "263480"
  },
  {
    "text": "So what- which sequence of activities would you give to that new student in order to maximize their probability that they get a good score on this exam,",
    "start": "263480",
    "end": "270919"
  },
  {
    "text": "indicating hopefully that they've learned the material? So, yeah.",
    "start": "270919",
    "end": "276629"
  },
  {
    "text": "Do you know how big A and B are? So one great question. [inaudible] to say, um, how big is this group?",
    "start": "276630",
    "end": "282390"
  },
  {
    "text": "Um, so how large is an A and B?",
    "start": "282390",
    "end": "288525"
  },
  {
    "text": "And you might want to know this for a number of reasons. For example, if the number of people in group A is 1, and the number of people in group B is 2,",
    "start": "288525",
    "end": "294935"
  },
  {
    "text": "maybe these are just sort of statistical noise between these di- distinctions. What else might you want to know?",
    "start": "294935",
    "end": "299990"
  },
  {
    "text": "[NOISE] Um, the variance. Yes. So I suggest that you might want to know the variance.",
    "start": "299990",
    "end": "305300"
  },
  {
    "text": "That's another thing you might want to know. This is just the mean. So what is the variance?",
    "start": "305300",
    "end": "309889"
  },
  {
    "text": "What other pieces of information might you want to know? Yeah.",
    "start": "310650",
    "end": "318735"
  },
  {
    "text": "Probably the difference between the median and the mean. Yeah. So other sort of forms of statistics about,",
    "start": "318735",
    "end": "324950"
  },
  {
    "text": "sort of, you know, the distribution. I'm- I'm thinking about something also more, um, in a different direction. Yeah.",
    "start": "324950",
    "end": "330935"
  },
  {
    "text": "Um, the people in the group. So is that bigger group A is all high school students, group B is all like lower grade or something like that.",
    "start": "330935",
    "end": "337895"
  },
  {
    "text": "Exactly. So maybe the- maybe group A is kindergartners and maybe group B is, um, you know, high schoolers and [LAUGHTER],",
    "start": "337895",
    "end": "345360"
  },
  {
    "text": "we're all regressing [LAUGHTER]. So yeah. So- so who's in these groups? [NOISE] And in addition to that,",
    "start": "345360",
    "end": "353240"
  },
  {
    "text": "often, you'd want to know who was the new student. So is the new student then a kindergartner or a high schooler? Okay. So there's really a lot of additional information that you'd",
    "start": "353240",
    "end": "361130"
  },
  {
    "text": "want to know in order to be able to answer this question precisely, uh, and it involves a lot of different challenges.",
    "start": "361130",
    "end": "366380"
  },
  {
    "text": "And one of the challenges here is that, um, if group B is different than group A,",
    "start": "366380",
    "end": "373689"
  },
  {
    "text": "then we have this fundamental issue of, um, censored data. You don't get to know what would have happened in group A if they had had",
    "start": "373690",
    "end": "380810"
  },
  {
    "text": "the same seq- or in the group B if they'd had the same sequence of interventions as in group A. So this is sort of the fundamental challenge that you'll never know",
    "start": "380810",
    "end": "388280"
  },
  {
    "text": "what it would be like if you were at Harvard right now, um, but, uh, but there's this, uh, you only get to observe the outcome for the action that's taken.",
    "start": "388280",
    "end": "395300"
  },
  {
    "text": "We've seen that a lot in reinforcement learning, and that's true in this case too where we have old data, um, about sequences of decisions,",
    "start": "395300",
    "end": "401270"
  },
  {
    "text": "and so it requires this kind of actual reasoning. Another thing that it involves is, um, generalization.",
    "start": "401270",
    "end": "407255"
  },
  {
    "text": "So here's a simple example where you can think of it basically as being just two actions. Each of the two different prob- each of",
    "start": "407255",
    "end": "413960"
  },
  {
    "text": "the two different problems and you can think of this as the reward. The delayed reward may be of a reward of 0,",
    "start": "413960",
    "end": "419449"
  },
  {
    "text": "reward of 0, and then a reward of the test score. And so here there's only two actions,",
    "start": "419450",
    "end": "426560"
  },
  {
    "text": "and who knows how big the state space is, it depends how we'd want to model students. Um, [NOISE] but we don't want to think about",
    "start": "426560",
    "end": "433190"
  },
  {
    "text": "combinatorially all the different orders of actions. Um, and even if we're writing down a decision policy,",
    "start": "433190",
    "end": "438680"
  },
  {
    "text": "that might start to be very large very quickly. And so we're gonna need to be able to do some form of generalization,",
    "start": "438680",
    "end": "443780"
  },
  {
    "text": "either cross states, or actions, or both so that we don't have to run a combinatorial number of experiments to",
    "start": "443780",
    "end": "449210"
  },
  {
    "text": "figure out what's most effective for student learning. [NOISE] So we're gonna talk about",
    "start": "449210",
    "end": "455090"
  },
  {
    "text": "this problem today in the context of batch reinforcement learning which we can also think of as being offline. So this has to be offline batch RL,",
    "start": "455090",
    "end": "464670"
  },
  {
    "text": "and this is frequently gonna generally be off policy. Now, we've seen a lot of off-policy learning before,",
    "start": "464670",
    "end": "470550"
  },
  {
    "text": "Q-learning uses an off-policy algorithm. Um, but I want to distinguish here that what we're gonna be mostly focusing on today is the case where someone has already collected the data.",
    "start": "470550",
    "end": "478745"
  },
  {
    "text": "So we already have a prior set of data, um, and then we're gonna want to use it to make better decisions going forward.",
    "start": "478745",
    "end": "484620"
  },
  {
    "text": "Now, this problem comes up not just, um, in the case that I just mentioned, but in a huge number of different domains.",
    "start": "484880",
    "end": "490925"
  },
  {
    "start": "485000",
    "end": "554000"
  },
  {
    "text": "You could argue that areas like econom- economics, um, and statistics, and epidemiology are constantly asking these sort of questions.",
    "start": "490925",
    "end": "497780"
  },
  {
    "text": "Um, it comes up in things like maintenance, you know, um, what sort of order of, um, actions do you want to do to make sure that your machines,",
    "start": "497780",
    "end": "504210"
  },
  {
    "text": "your cars run for longest. Um, it comes up in health care, like what sort of sequence of activity should we give to",
    "start": "504210",
    "end": "509690"
  },
  {
    "text": "patients in order to maximize their outcomes, their quality-adjusted life years. And in many of these cases, it's gonna be state-dependent because what's gonna work",
    "start": "509690",
    "end": "518150"
  },
  {
    "text": "best for patient A is gonna be different than what works best [NOISE] for patient B. [NOISE] Now, one of the big challenges here too is",
    "start": "518150",
    "end": "524720"
  },
  {
    "text": "that when we think about a lot of the cases where we have this old data, it's gonna be high-stake scenarios,",
    "start": "524720",
    "end": "530120"
  },
  {
    "text": "which means that whether it's because we have really expensive, you know, nuclear power equipment which we don't want to go wrong, um,",
    "start": "530120",
    "end": "536675"
  },
  {
    "text": "or we're treating people, um, for, you know, really significant diseases, then we wanna",
    "start": "536675",
    "end": "541699"
  },
  {
    "text": "make sure that we make good decisions in the future. So we might may or may not have a lot of data, um,",
    "start": "541700",
    "end": "547810"
  },
  {
    "text": "but the data that we have is precious and we wanna make as good decisions as possible from that.",
    "start": "547810",
    "end": "553470"
  },
  {
    "text": "So that means we need to have some form of confidence in how well it's gonna work going forward.",
    "start": "553900",
    "end": "560255"
  },
  {
    "start": "554000",
    "end": "655000"
  },
  {
    "text": "So we would really like to have some sort of upper and lower bounds on its performance before we deploy it.",
    "start": "560255",
    "end": "565580"
  },
  {
    "text": "Um, and in general, we just want good methods to try to estimate, um, if we do this counterfactual reasoning, if we think about how well people, or, you know,",
    "start": "565580",
    "end": "573050"
  },
  {
    "text": "how much more healthy people might be if we were to treat them in a different way, um, how confident can we be before we convince a doctor to go actually deploy this.",
    "start": "573050",
    "end": "581850"
  },
  {
    "text": "So what I'm gonna talk about today is thinking about sort of this general question of how can we do batch safe reinforcement learning.",
    "start": "582370",
    "end": "591235"
  },
  {
    "text": "Safety can mean a lot of different things. Um, when I'm talking about safety today, I'm mostly gonna be thinking about this in terms of this confidence.",
    "start": "591235",
    "end": "598370"
  },
  {
    "text": "This ability to say, um, before we deploy something, how good do we know it is. Um, now, there's different forms of safety.",
    "start": "598370",
    "end": "605360"
  },
  {
    "text": "There's things like safe exploration, making sure you don't make mistakes online, there's risk sensitivity,",
    "start": "605360",
    "end": "610550"
  },
  {
    "text": "thinking about the fact that, um, each of us is only gonna experience one outcome, not the expectation, um,",
    "start": "610550",
    "end": "616035"
  },
  {
    "text": "so we may want to think about the full distribution instead of averaging. But what we're gonna talk about today is mostly still thinking about",
    "start": "616035",
    "end": "622190"
  },
  {
    "text": "expected outcomes but thinking about being confident in the expected outcomes. And so, in general,",
    "start": "622190",
    "end": "629705"
  },
  {
    "text": "we would like to really be able to say with high confidence this new decision policy we're gonna deploy for patients,",
    "start": "629705",
    "end": "636145"
  },
  {
    "text": "or for nuclear power plants, or for other sorts of high-stakes scenarios, we think it's better.",
    "start": "636145",
    "end": "641195"
  },
  {
    "text": "We think it is better than what we're currently doing. And why might you want this? You might want to, sort of, to guarantee kind of",
    "start": "641195",
    "end": "646910"
  },
  {
    "text": "monotonic improvement particularly in these high-stakes domains, which is something that we've seen earlier this quarter. [NOISE] Okay.",
    "start": "646910",
    "end": "652940"
  },
  {
    "text": "[NOISE] So let's talk just briefly about some of the notation, some of this will be familiar.",
    "start": "652940",
    "end": "658750"
  },
  {
    "start": "655000",
    "end": "1071000"
  },
  {
    "text": "I just wanna make sure that, we're all on board with that, and then I'll talk about sort of some of the different steps we might think about to try to create batch,",
    "start": "658750",
    "end": "665200"
  },
  {
    "text": "um, safe reinforcement learning algorithms. So whereas usually gonna use pi to denote a policy,",
    "start": "665200",
    "end": "672190"
  },
  {
    "text": "um, we're gonna use T or H to denote a trajectory. I'll often use big D to denote the data that we have access to.",
    "start": "672190",
    "end": "680860"
  },
  {
    "text": "This is like [NOISE] electronic medical records systems, um, or you know data about power-plants, etc.",
    "start": "680860",
    "end": "686650"
  },
  {
    "text": "And for most of this, we're gonna assume that we know what the behavior policy is.",
    "start": "686650",
    "end": "692449"
  },
  {
    "text": "So we know what was the mapping of states to actions,",
    "start": "693000",
    "end": "698035"
  },
  {
    "text": "or it could have been histories to actions that was used to gather the data. [NOISE] Can anybody give me an example where that might not be reasonable,",
    "start": "698035",
    "end": "705250"
  },
  {
    "text": "where we might not know the behavior policy? [NOISE] [inaudible] actions, and we don't know the questions.",
    "start": "705250",
    "end": "714759"
  },
  {
    "text": "Exactly. In many, many cases where the data is generated from humans, um, we will not know what pi_b is.",
    "start": "714760",
    "end": "719995"
  },
  {
    "text": "So when we look at medical health data, we typically don't know what pi_b is. So, you know, if this is generated by doctors,",
    "start": "719995",
    "end": "727060"
  },
  {
    "text": "[NOISE] we typically don't know what pi_b will be.",
    "start": "727060",
    "end": "733450"
  },
  {
    "text": "There's obviously guidance, but we don't typically have access to, um, the exact policy people used and, and if we did,",
    "start": "733450",
    "end": "740529"
  },
  {
    "text": "they probably wouldn't have phrased it as like, you know, a stochastic process. [NOISE] But like when someone comes into their office with probability 0.5,",
    "start": "740530",
    "end": "746980"
  },
  {
    "text": "they're gonna treat them with this person 0.5. They probably think of it, in deterministic terms and they probably wouldn't think of it in terms of these if-then rules.",
    "start": "746980",
    "end": "753445"
  },
  {
    "text": "So there are many cases where [NOISE] we don't have that. Um, we've done some work on that recently, other people have as well.",
    "start": "753445",
    "end": "758590"
  },
  {
    "text": "I might talk about that briefly at the end. But for most of today, we're gonna assume that we have access to this. So can someone give me an example,",
    "start": "758590",
    "end": "764050"
  },
  {
    "text": "where it is reasonable to assume that we have pi_b? [NOISE] Sure.",
    "start": "764050",
    "end": "776740"
  },
  {
    "text": "[NOISE] [inaudible] is based on a [inaudible] set of guidelines or something? Yeah. So in some cases, you know, [NOISE] [inaudible] like sometimes you have like an algorithm to make a decision or,",
    "start": "776740",
    "end": "785470"
  },
  {
    "text": "you know, a clear set of guidelines. Were you gonna say something similar or different? A little different. Um, so if you have a power plant with maintenance records,",
    "start": "785470",
    "end": "793629"
  },
  {
    "text": "ah, [NOISE] like an established maintenance plan that has records [NOISE] match the plan then you basically have pi_b.",
    "start": "793630",
    "end": "799855"
  },
  {
    "text": "That's right. Yeah. So in those real cases where you have these fixed protocols. Another example, I often think about is, you know when your decisions were made by reinforcement learning [LAUGHTER] agents,",
    "start": "799855",
    "end": "807745"
  },
  {
    "text": "or, or they're made by supervised learning agents. Um, if you go to a lot of different,",
    "start": "807745",
    "end": "812905"
  },
  {
    "text": "ah, like how, you know, Google serves ads. We know exactly how it serves ads, it has to all be logged. And there's a, there's an algorithm that is making that decision.",
    "start": "812905",
    "end": "820000"
  },
  {
    "text": "So in many cases, [NOISE] we have access to the code that is being used to generate algorithms automa- ah,",
    "start": "820000",
    "end": "826060"
  },
  {
    "text": "generate decisions [NOISE] automatically. In that case, we can just look it up, as long as we've saved it.",
    "start": "826060",
    "end": "831430"
  },
  {
    "text": "So, and our objective is usual is to think about how do we get good, good policies out, and good policies with good values.",
    "start": "831430",
    "end": "839720"
  },
  {
    "text": "Um, when we think about trying to do safe batch reinforcement learning in a setting,",
    "start": "840990",
    "end": "846834"
  },
  {
    "text": "we're gonna be thinking about, how do we take that old data? So we're gonna take our data's input and push it through some black box,",
    "start": "846835",
    "end": "853855"
  },
  {
    "text": "and get out a policy that we think is good. So we're gonna have sort of some algorithm or transformation that",
    "start": "853855",
    "end": "859750"
  },
  {
    "text": "is instead of interacting with the real-world, and getting to make [NOISE] decisions and choose its data, it's just taking this fixed data,",
    "start": "859750",
    "end": "865420"
  },
  {
    "text": "and it'll put a policy, and one thing that we would like is that, if we feed data into our algorithm,",
    "start": "865420",
    "end": "871870"
  },
  {
    "text": "and our algorithm could be stochastic, then the value of the policy it outputs.",
    "start": "871870",
    "end": "877029"
  },
  {
    "text": "So we can think A(D). So that's, you know, this is being our algorithm A, it's gonna output some policy.",
    "start": "877030",
    "end": "884755"
  },
  {
    "text": "That might be a deterministic function, that might be a stochastic function. Whatever policy it outputs, we want it to be good.",
    "start": "884755",
    "end": "891490"
  },
  {
    "text": "Ideally, at least as good as the behavior policy [NOISE]. So that's what this first equation says, is it says the value of whatever policy is output,",
    "start": "891490",
    "end": "898990"
  },
  {
    "text": "by our algorithm when we feed in some data set. We would [NOISE] like it to be as good, as what [NOISE] the behavior policy that generated that dataset,",
    "start": "898990",
    "end": "907630"
  },
  {
    "text": "um, whatever that value was. So this is sort of [NOISE] the value of the policy used to generate the data.",
    "start": "907630",
    "end": "919540"
  },
  {
    "text": "Now, we don't normally, we're not normally given via pi_b, um, directly.",
    "start": "922860",
    "end": "928720"
  },
  {
    "text": "But can anybody give me an example of how we might learn that? [NOISE] Given a dataset,",
    "start": "928720",
    "end": "933970"
  },
  {
    "text": "which was generated on policy, from that policy generated, um, using that policy. Yeah.",
    "start": "933970",
    "end": "942430"
  },
  {
    "text": "Just do like dynamic programming or whatever on that small [inaudible] approximately.",
    "start": "942430",
    "end": "948310"
  },
  {
    "text": "Yeah. So I think, like one thing is that, you know, you could use that data. Um, I don't know if you could do dynamic programming,",
    "start": "948310",
    "end": "953860"
  },
  {
    "text": "because you don't necessarily have access to the transition and reward models. But you could do something like Monte Carlo estimation, could average the reward, um,",
    "start": "953860",
    "end": "960564"
  },
  {
    "text": "let's assume in the dataset that you can see states, actions and rewards. Um, so you could certainly just average it, you know, average over all the trajectories.",
    "start": "960565",
    "end": "967270"
  },
  {
    "text": "So we can get an estimate, we can estimate p pi_b,",
    "start": "967270",
    "end": "972940"
  },
  {
    "text": "by looking at, let's imagine, it's an epic- episodic problem. So you can look at sum over all,",
    "start": "972940",
    "end": "978820"
  },
  {
    "text": "equals 1 to number of trajectories, of the return for that trajectory. This is a return.",
    "start": "978820",
    "end": "986215"
  },
  {
    "text": "Which is essentially just doing Monte Carlo estimation, because you know that that data was generated on policy,",
    "start": "986215",
    "end": "992199"
  },
  {
    "text": "[NOISE] and so you can just average. [NOISE] So that'll give us a way to estimate the pi_b but then we",
    "start": "992200",
    "end": "997270"
  },
  {
    "text": "need some way to estimate V of our algorithm, outputting D. Um,",
    "start": "997270",
    "end": "1002685"
  },
  {
    "text": "and that means we're gonna have to do something off policy, because in general we're gonna be wanting to find policies that are better than pi_b,",
    "start": "1002685",
    "end": "1009180"
  },
  {
    "text": "which means that they would have had to be making some different decisions. And I'll just highlight here that you know,",
    "start": "1009180",
    "end": "1015780"
  },
  {
    "text": "sometimes you might not just want to be better than the existing behavior policy, but you might need to be substantially better.",
    "start": "1015780",
    "end": "1021330"
  },
  {
    "text": "Um, often, if we're thinking about real production systems, it costs time, and money, and effort, whenever we want to change protocols.",
    "start": "1021330",
    "end": "1028125"
  },
  {
    "text": "If you want to get doctors to change the way they're making decisions, we want to change things in a power plant, there's often overhead.",
    "start": "1028125",
    "end": "1033135"
  },
  {
    "text": "So often, you might not just need to be better than the existing sort of state of the art, you need to be significantly better.",
    "start": "1033135",
    "end": "1038760"
  },
  {
    "text": "So the same types of ideas we're talking about for relative to sort of the current um, performance, you can always add a delta to",
    "start": "1038760",
    "end": "1045870"
  },
  {
    "text": "that because they have to be at least this much better. And so again, just to sort of summarize,",
    "start": "1045870",
    "end": "1051780"
  },
  {
    "text": "what does this equation says? It says, I want to have situations, where the policy that's output,",
    "start": "1051780",
    "end": "1057284"
  },
  {
    "text": "when I plug in my dataset, I want that to be better than my existing policy with high probability.",
    "start": "1057285",
    "end": "1063090"
  },
  {
    "text": "So delta here, you know, is gonna be something between 0 and 1.",
    "start": "1063090",
    "end": "1068320"
  },
  {
    "text": "So now, let's talk about how we might do this. Um, we're going to start with off-policy policy evaluation.",
    "start": "1070820",
    "end": "1076920"
  },
  {
    "start": "1071000",
    "end": "1507000"
  },
  {
    "text": "[NOISE] So the idea in this case,",
    "start": "1076920",
    "end": "1083010"
  },
  {
    "text": "well, okay, first of all, go through all three of these really briefly. Um, and then we'll, we'll go step through them more slowly.",
    "start": "1083010",
    "end": "1088695"
  },
  {
    "text": "So the three things in terms of stuff we might want to do safe batch reinforcement learning, and there's tons of variants for each of these depending on the setting we're looking at,",
    "start": "1088695",
    "end": "1096945"
  },
  {
    "text": "is we need to re do- have to do this off-policy batch policy evaluation. Which is we need to be able to take our old data,",
    "start": "1096945",
    "end": "1104534"
  },
  {
    "text": "and then use it to estimate how good an alternative policy would do. We might want to get confidence bounds over how good that is.",
    "start": "1104535",
    "end": "1111300"
  },
  {
    "text": "So this could just allow us to get some estimate of V A(D), or V pi_e.",
    "start": "1111300",
    "end": "1117940"
  },
  {
    "text": "Pi_e is often used to denote an evaluation policy, a policy we wanna evaluate.",
    "start": "1118910",
    "end": "1124110"
  },
  {
    "text": "So the first thing is just doing off-policy policy evaluation. The second thing is saying how would we know how good that estimate is,",
    "start": "1124110",
    "end": "1130350"
  },
  {
    "text": "so this is an estimate could be really good, could be bad, so you might want to have some uncertainty, over this estimate.",
    "start": "1130350",
    "end": "1137830"
  },
  {
    "text": "So that we can quantify how good or bad it is. And then finally, we might want to be able to actually,",
    "start": "1138260",
    "end": "1144990"
  },
  {
    "text": "take like, you know, an argmax over possible policies. So you might want to be able to do something like argmax,",
    "start": "1144990",
    "end": "1151919"
  },
  {
    "text": "[NOISE] pi V pi_e, with some confidence bounds.",
    "start": "1151919",
    "end": "1160029"
  },
  {
    "text": "So in general, you're not gonna just want to be able to evaluate how good alternative policies will be,",
    "start": "1162320",
    "end": "1167730"
  },
  {
    "text": "you're gonna wanna figure out a good policy to deploy in the future, which is gonna require us to do optimization because we don't normally know what that good policy is yet.",
    "start": "1167730",
    "end": "1174885"
  },
  {
    "text": "So typically, we're gonna end up evaluating a number of different policies.",
    "start": "1174885",
    "end": "1178780"
  },
  {
    "text": "So we can think of it as sort of the first part is we're gonna take our historical data,",
    "start": "1180860",
    "end": "1186059"
  },
  {
    "text": "take a proposed policy, plug it into some algorithm that we haven't talked about yet, and get out an estimate of the value of that policy,",
    "start": "1186060",
    "end": "1193810"
  },
  {
    "text": "and we're gonna talk about how to do important sampling [NOISE] with that. And then after that, we're gonna go into the high-confidence,",
    "start": "1194150",
    "end": "1202635"
  },
  {
    "text": "um, policy evaluation and safe policy improvement. To get confidence bounds, we're gonna look at Hoeffding.",
    "start": "1202635",
    "end": "1208649"
  },
  {
    "text": "We've seen Hoeffding before, um, as something that we looked at when we were starting to talk about exploration.",
    "start": "1208650",
    "end": "1214695"
  },
  {
    "text": "So when we look at high-confidence and then think back- think back to exploration.",
    "start": "1214695",
    "end": "1220059"
  },
  {
    "text": "So in exploration, we're often trying to quantify how uncertain we were about the value of a policy or",
    "start": "1222770",
    "end": "1228210"
  },
  {
    "text": "its models in order to be optimistic with respect to how good it could be and use that to drive exploration.",
    "start": "1228210",
    "end": "1233670"
  },
  {
    "text": "But we also could have computed confidence bounds that are lower bounds on how good things could be, and that's gonna be useful here when we try to",
    "start": "1233670",
    "end": "1240180"
  },
  {
    "text": "figure out how good policies are before we deploy them. And we'll do Hoeffding inequality for that,",
    "start": "1240180",
    "end": "1246405"
  },
  {
    "text": "and then finally we're gonna be able to wanna do things like safe policy improvement, which is can you answer the question of saying,",
    "start": "1246405",
    "end": "1252000"
  },
  {
    "text": "if someone gives you some data and they say, \"Hey, can you give me a better policy?\" Can one have an algorithm that either gives a better policy that it is",
    "start": "1252000",
    "end": "1259170"
  },
  {
    "text": "actually better like when you go and deploy it with high probability? Or can the algorithm also know its limitations and say,",
    "start": "1259170",
    "end": "1265635"
  },
  {
    "text": "\"Nope, there's no- there's no way for me to give you a policy that's better.\"",
    "start": "1265635",
    "end": "1271065"
  },
  {
    "text": "So I think it's also really nice to have algorithms that are aware of their own limitations. We're doing quite a bit of work on that in my lab right now,",
    "start": "1271065",
    "end": "1278130"
  },
  {
    "text": "um, so that when people who are using these, particularly for human in the loop systems, um, that they can understand if the algorithm is giving out garbage or not.",
    "start": "1278130",
    "end": "1285750"
  },
  {
    "text": "And so in this case, the idea is that sometimes if you have very little data, you can't do improvement in an, uh, confident way.",
    "start": "1285750",
    "end": "1292529"
  },
  {
    "text": "So for that example I showed you before, we had like two different ways of teaching students, and someone, you know,",
    "start": "1292530",
    "end": "1298170"
  },
  {
    "text": "made the good point of saying, how many people are in each of these. If only one person has tried either of these and someone says,",
    "start": "1298170",
    "end": "1303810"
  },
  {
    "text": "\"Can you definitely tell me what's going to be better for students in the future?\" You should say, \"No.\" [LAUGHTER] Because there is only one data point,",
    "start": "1303810",
    "end": "1309794"
  },
  {
    "text": "like there's no way we would have enough data from, you know, one data point in each group to be able to confidently say in the future how we should teach students.",
    "start": "1309795",
    "end": "1317129"
  },
  {
    "text": "So I think that the safe policy improvement needs us to be able to both say when we can be confident about deploying better policies in the future or when we can't.",
    "start": "1317130",
    "end": "1327520"
  },
  {
    "text": "So we're gonna look at sort of a- a pipeline for how to answer that sort of question.",
    "start": "1328430",
    "end": "1334080"
  },
  {
    "text": "All right. So let's first go back, go and think about off-policy policy evaluation.",
    "start": "1334080",
    "end": "1339880"
  },
  {
    "text": "So the aim of this, um, is to get a- an off-policy estimate that is unbiased.",
    "start": "1340070",
    "end": "1348450"
  },
  {
    "text": "So we want to get sort of a really, you know, a good estimate of how, um, how good an alternative decision policy would be.",
    "start": "1348450",
    "end": "1354960"
  },
  {
    "text": "So we have data right now, which is sampled, um,",
    "start": "1354960",
    "end": "1360000"
  },
  {
    "text": "under some policy, let's call it a behavior policy Pi 2. So we have like this dataset.",
    "start": "1360000",
    "end": "1365400"
  },
  {
    "text": "This is D, which is giving us through these samples of these trajectories,",
    "start": "1365400",
    "end": "1371415"
  },
  {
    "text": "and then we want to use them to evaluate how good an alternative policy would be. And while we could do this for something like Q-learning,",
    "start": "1371415",
    "end": "1378915"
  },
  {
    "text": "we want to do it with a different method that's gonna allow us to get better confidence intervals, um, and where it's going to be an unbiased estimator.",
    "start": "1378915",
    "end": "1387240"
  },
  {
    "text": "So in Q-learning, if we think back to sort of what Q-learning was doing, you know, Q-learning is off-policy.",
    "start": "1387240",
    "end": "1392370"
  },
  {
    "text": "We could do this with Q-learning. Q-learning is off-policy, and it- it samples and it bootstraps.",
    "start": "1392370",
    "end": "1400540"
  },
  {
    "text": "And because it samples and bootstraps, it can be biased, okay?",
    "start": "1404180",
    "end": "1412529"
  },
  {
    "text": "And so we're wanna do a different thing right now, which still allows us to be off-policy,",
    "start": "1412530",
    "end": "1417630"
  },
  {
    "text": "but in a way that we're not biased, that our estimator might not systematically be, um, above or below, particularly because right now we're always gonna have finite data.",
    "start": "1417630",
    "end": "1425625"
  },
  {
    "text": "We're never gonna be in the asymptotic regime where we have tons and tons and tons of data, um, and we can sort of assume this went away.",
    "start": "1425625",
    "end": "1431684"
  },
  {
    "text": "So again let's think about the return. G_t is the return. It's just how much reward we got under a policy, you know,",
    "start": "1431685",
    "end": "1439260"
  },
  {
    "text": "either over a finite number of steps like for one episode or across all time. And our policy is just or the value of",
    "start": "1439260",
    "end": "1446370"
  },
  {
    "text": "a policy again is just the expected discounted reward of that. So the nice thing is that if Pi 2 is stochastic,",
    "start": "1446370",
    "end": "1454235"
  },
  {
    "text": "the data that you're using- that you're gathering from your behavior policy, then you can use it to do off-policy evaluation.",
    "start": "1454235",
    "end": "1459850"
  },
  {
    "text": "This would have been essential for doing Q-learning too. And one of the nice things is that because we're",
    "start": "1459850",
    "end": "1465030"
  },
  {
    "text": "kind of following this Monte Carlo type frame work, you don't need a model and you don't need to be Markov.",
    "start": "1465030",
    "end": "1471940"
  },
  {
    "text": "That's really nice because we're gonna end up getting an estimator that is, um, unbiased and it does not rely on the Markov assumption holding.",
    "start": "1471940",
    "end": "1481080"
  },
  {
    "text": "And in many cases, the Markov assumption is not gonna hold, particularly when we start to think about patient data or other cases",
    "start": "1481080",
    "end": "1487620"
  },
  {
    "text": "where we just have a set of features that happen to have been recorded in our dataset, and who knows whether or not that system is Markov or not.",
    "start": "1487620",
    "end": "1494220"
  },
  {
    "text": "We've certainly seen in some of our projects that it is not. And that in some of those cases, if you make the assumption that the world is Markov,",
    "start": "1494220",
    "end": "1500760"
  },
  {
    "text": "you have really bad estimates of how good, you know, an alternative way of teaching students might do.",
    "start": "1500760",
    "end": "1506340"
  },
  {
    "text": "Okay. So why is this a hard problem? Well, um, it's because we have a distribution mismatch, okay?",
    "start": "1506340",
    "end": "1513030"
  },
  {
    "start": "1507000",
    "end": "1676000"
  },
  {
    "text": "So if we look at, um, imagine we just had a two-state process,",
    "start": "1513030",
    "end": "1518908"
  },
  {
    "text": "where we thought about, you know, kind of this is S and this is- or like we can say this is the probability of your next state S prime,",
    "start": "1518909",
    "end": "1528510"
  },
  {
    "text": "and I've sort of made it smooth. We can think of a Gaussian here, and this is under pi behavior.",
    "start": "1528510",
    "end": "1534510"
  },
  {
    "text": "Under pi evaluation, it might look different, okay, versus this.",
    "start": "1534510",
    "end": "1540075"
  },
  {
    "text": "In general, the distribution of returns you're gonna get, the sequence of the state-action, reward,",
    "start": "1540075",
    "end": "1546179"
  },
  {
    "text": "next state, next action, next reward, so this sort of trajectory.",
    "start": "1546180",
    "end": "1552525"
  },
  {
    "text": "The distribution of trajectory is gonna be different under different policies. So the distribution of",
    "start": "1552525",
    "end": "1561480"
  },
  {
    "text": "tau here is not gonna look like the distribution of tau here.",
    "start": "1561480",
    "end": "1568720"
  },
  {
    "text": "If it looks identical, what does that say about the value of the two policies?",
    "start": "1569000",
    "end": "1574920"
  },
  {
    "text": "[inaudible]. Sorry what? [inaudible]. Exactly. So what you said is correct.",
    "start": "1574920",
    "end": "1580665"
  },
  {
    "text": "If, um, I- if the distribution of states and actions that you get under both of these policies are identical,",
    "start": "1580665",
    "end": "1586320"
  },
  {
    "text": "then the value is identical. And we saw this idea also in imitation learning when we are gonna be doing sort of state action,",
    "start": "1586320",
    "end": "1592304"
  },
  {
    "text": "uh, or- or state feature matching. Now in this case, we're talking about not just states and actions,",
    "start": "1592305",
    "end": "1597870"
  },
  {
    "text": "we're talking about full distributions or full trajectories because we're not making the Markov assumption, but the idea is exactly the same.",
    "start": "1597870",
    "end": "1603450"
  },
  {
    "text": "The only way we define the- the value is basically the probability of a trajectory and the value of that or,",
    "start": "1603450",
    "end": "1611040"
  },
  {
    "text": "you know, the sum of rewards in that trajectory. So if a distribution is identical,",
    "start": "1611040",
    "end": "1618600"
  },
  {
    "text": "then the value is identical. We don't care if the policies are different because we already know how to estimate the value.",
    "start": "1618600",
    "end": "1623640"
  },
  {
    "text": "[NOISE] So the key problem here is that they're gonna look different, which means that you would have went- done different things under different policy.",
    "start": "1623640",
    "end": "1631395"
  },
  {
    "text": "So it's like, you know, right now, maybe you go and visit this part of the state space a lot, [NOISE] excuse me, [NOISE] and this part infrequently.",
    "start": "1631395",
    "end": "1641985"
  },
  {
    "text": "And now you're gonna have an alternative policy, which only goes here infrequently and goes over there a lot.",
    "start": "1641985",
    "end": "1647740"
  },
  {
    "text": "[NOISE] Excuse me. But thinking about it in this way gives us an idea about how we can look at our existing data over there and make it look more like that.",
    "start": "1648650",
    "end": "1658180"
  },
  {
    "text": "Does anybody have any idea of how we could do that? So if someone gives you a bunch of trajectories, um,",
    "start": "1658310",
    "end": "1664080"
  },
  {
    "text": "how might you maybe change them so they look like the distribution you care about? Yeah?",
    "start": "1664080",
    "end": "1670245"
  },
  {
    "text": "Importance sampling. Right. So we can do importance sampling here, okay? So let's just review and refresh importance sampling.",
    "start": "1670245",
    "end": "1680340"
  },
  {
    "start": "1676000",
    "end": "1806000"
  },
  {
    "text": "So the idea is that for any distribution, um, we can reweigh them to get an unbiased sample, okay?",
    "start": "1680340",
    "end": "1686625"
  },
  {
    "text": "So let's imagine that we have data generated from, um, or we want data generated from some distribution q,",
    "start": "1686625",
    "end": "1693990"
  },
  {
    "text": "we wanna estimate f(x), okay? So we'd have- wanna get f(x) under the probability distribution q(x).",
    "start": "1693990",
    "end": "1702615"
  },
  {
    "text": "So we can multiply and divide by the same thing, let's incorporate another distribution.",
    "start": "1702615",
    "end": "1708735"
  },
  {
    "text": "It's just a different distribution over x times q(x), f(x), dx, okay?",
    "start": "1708735",
    "end": "1717975"
  },
  {
    "text": "So we can just rewrite this as being equal to integral over x probability of x times this quantity, which is q(x),",
    "start": "1717975",
    "end": "1726390"
  },
  {
    "text": "divided by p(x) times f(x),",
    "start": "1726390",
    "end": "1731020"
  },
  {
    "text": "and let's imagine that we actually have data from q(x). So we want data from q(x) but we have data from p(x).",
    "start": "1731630",
    "end": "1739575"
  },
  {
    "text": "So we can approximate this by 1 over n, sum over i, q(xi) divided by p(xi) f(xi),",
    "start": "1739575",
    "end": "1750000"
  },
  {
    "text": "where xi is sampled from p(x).",
    "start": "1750000",
    "end": "1755920"
  },
  {
    "text": "I remember when I first learned about this a number of years ago and I thought it was a really lovely insight just to say we're just gonna reweight our data.",
    "start": "1758660",
    "end": "1765000"
  },
  {
    "text": "And so we're gonna focus on, um, the data points that come from, you know, that- that are ones that we would sample under the distribution we care about.",
    "start": "1765000",
    "end": "1773145"
  },
  {
    "text": "We're just gonna reweigh them so they look like they're having the same probability, um, that they would under- under q(x).",
    "start": "1773145",
    "end": "1779415"
  },
  {
    "text": "In our case, under our desired policy. Okay. So importance sampling works for any distribution mismatch.",
    "start": "1779415",
    "end": "1787140"
  },
  {
    "text": "If you have data from one distribution you wish you had it from another, um, those can come up in things like physics. Often you have really rare events like Higgs bosons.",
    "start": "1787140",
    "end": "1794804"
  },
  {
    "text": "And in those cases, you might, um, there are different scenarios where you could reweigh things, um, so you can get an estimate of the true- the true expectation.",
    "start": "1794805",
    "end": "1802424"
  },
  {
    "text": "Okay. This is for just generic distributions. Let's remind ourselves how this works for- for the reinforcement learning setting.",
    "start": "1802425",
    "end": "1809655"
  },
  {
    "start": "1806000",
    "end": "2187000"
  },
  {
    "text": "So again, we're gonna have our episodes. We can call them h, we can call them tau, which is a sequence of states, actions, and rewards.",
    "start": "1809655",
    "end": "1817269"
  },
  {
    "text": "And then if we wanna do importance sampling or let me just write this out. So, um, in this case,",
    "start": "1818210",
    "end": "1823725"
  },
  {
    "text": "we're gonna wanna get something like p of hj under our desired policy, okay?",
    "start": "1823725",
    "end": "1830549"
  },
  {
    "text": "So what does that gonna be? That's gonna be our probability of our initial state. Let's assume that's identical no matter what policy that you're in,",
    "start": "1830550",
    "end": "1839580"
  },
  {
    "text": "and then we're gonna have the probability of taking a particular action,",
    "start": "1839580",
    "end": "1845669"
  },
  {
    "text": "given we're in that state, times the probability that we go to a next state and the probability of the reward we saw.",
    "start": "1845670",
    "end": "1856600"
  },
  {
    "text": "And we can sum that over j = 1 up to n - 1 or lj - 1.",
    "start": "1858470",
    "end": "1866970"
  },
  {
    "text": "So we just repeatedly look at what was the probability we pick the action, the transition model, and the reward model.",
    "start": "1866970",
    "end": "1878650"
  },
  {
    "text": "So that's how what we have for, um, the probability of a history. And then if we wanna do this for importance sampling,",
    "start": "1881120",
    "end": "1888330"
  },
  {
    "text": "so what we want is we wanna have, um, the probability of this history, um, we need to be able to compute this ratio of q(x) divided by p(x),",
    "start": "1888330",
    "end": "1896295"
  },
  {
    "text": "which for us is gonna be the probability of a history j under or the evaluation policy divided by",
    "start": "1896295",
    "end": "1902190"
  },
  {
    "text": "the probability of a history j under the behavior policy. So- and we wanna do this and we're hoping that everything is gonna",
    "start": "1902190",
    "end": "1909780"
  },
  {
    "text": "cancel because we don't have access to the dynamics model or the reward model. So unfortunately, just like what we saw in some of the policy gradient work, it will.",
    "start": "1909780",
    "end": "1919230"
  },
  {
    "text": "So if we have probability of hj divided by pi b, we're gonna have again the initial state distribution,",
    "start": "1919230",
    "end": "1927779"
  },
  {
    "text": "which will be the same in both cases, and then we have this ratio of probabilities,",
    "start": "1927780",
    "end": "1935024"
  },
  {
    "text": "the probability of aj divided by sj. And this is under pi e,",
    "start": "1935024",
    "end": "1941685"
  },
  {
    "text": "probability of aj divided, um, given sj for pi b,",
    "start": "1941685",
    "end": "1947730"
  },
  {
    "text": "and then the transition model and reward model.",
    "start": "1947730",
    "end": "1957910"
  },
  {
    "text": "Okay. And so this is nice because this cancels and this cancels.",
    "start": "1962870",
    "end": "1971470"
  },
  {
    "text": "Because the dynamics of the world is what determines the next state and the dynamics of the world is what determines the reward.",
    "start": "1971470",
    "end": "1977745"
  },
  {
    "text": "And notice here just to make this not incredibly long, I- here, I've made a Markov assumption. So this is the Markov version.",
    "start": "1977745",
    "end": "1984420"
  },
  {
    "text": "[NOISE] But you could do, um, you could condition on the full history.",
    "start": "1984420",
    "end": "1989740"
  },
  {
    "text": "So this trick does not require us- does not require the system to be Markov.",
    "start": "1990470",
    "end": "1996495"
  },
  {
    "text": "Because no matter whether your- your dynamics depend on the full history or the immediate last step, they're gonna be the same in the behavior policy and in the dynamics.",
    "start": "1996495",
    "end": "2004565"
  },
  {
    "text": "And in the evaluation policies, you can cancel these and same for the reward model. So this- this, um,",
    "start": "2004565",
    "end": "2010175"
  },
  {
    "text": "insight does not require a Markovian assumption. And what that means is that we just end up getting this ratio of, um,",
    "start": "2010175",
    "end": "2017585"
  },
  {
    "text": "the way we would pick actions under the evaluation policy divided by the ratio",
    "start": "2017585",
    "end": "2023929"
  },
  {
    "text": "of the way we would pick actions under the behavior policy. Yeah?",
    "start": "2023930",
    "end": "2030500"
  },
  {
    "text": "Assuming that, uh, same trajectory is generated by two different policies.",
    "start": "2030500",
    "end": "2035675"
  },
  {
    "text": "Great question. Um, yes, we're assuming the same trajectory was generated by two different policies. Yes. So we're saying for this trajectory,",
    "start": "2035675",
    "end": "2041179"
  },
  {
    "text": "what's the probability you would have seen this under the behavior policy versus the evaluation policy?",
    "start": "2041180",
    "end": "2046355"
  },
  {
    "text": "And so if it was more likely under the evaluation policy, we wanna upweight whatever reward we got for that trajectory.",
    "start": "2046355",
    "end": "2054049"
  },
  {
    "text": "And if it's less likely under that evaluation policy, we wanna downweight it. So the intuition is that we have a bunch of, um,",
    "start": "2054050",
    "end": "2060830"
  },
  {
    "text": "uh, trajectories and their sum of rewards. So we kind of have these h, you know, h_1, G_1 pairs.",
    "start": "2060830",
    "end": "2068819"
  },
  {
    "text": "So we have these sort of trajectory, sum of rewards.",
    "start": "2069250",
    "end": "2075179"
  },
  {
    "text": "And if we had the same behavior policy as the evaluation policy in order to know how good that evaluation policy is,",
    "start": "2075460",
    "end": "2082639"
  },
  {
    "text": "we just average all of those G's but they are different. And so what we wanna do is we wanna say for",
    "start": "2082640",
    "end": "2088565"
  },
  {
    "text": "h's that are more likely under an evaluation policy, upweight those. For h's that are less likely under a evaluation policy,",
    "start": "2088565",
    "end": "2096605"
  },
  {
    "text": "downweight those so that you get, um, a true expectation when you do those G evaluation, G weightings.",
    "start": "2096605",
    "end": "2104130"
  },
  {
    "text": "Does that makes sense? Does anybody have any questions about that part? So this is just so far telling us how we re-weight our data.",
    "start": "2105850",
    "end": "2112849"
  },
  {
    "text": "It's allowing us to get a distribution that looks more like the distribution of trajectories we would get under our evaluation policy. Yeah?",
    "start": "2112850",
    "end": "2121380"
  },
  {
    "text": "In the final, ah, the final row, we have denominator, ah, the behavior policy.",
    "start": "2124930",
    "end": "2131375"
  },
  {
    "text": "We get that as empirically? Good question. You know, where does the behavior policy come from,",
    "start": "2131375",
    "end": "2137300"
  },
  {
    "text": "basically like- like what is these probabilities? Is that the question? So I think it depends, So in the case,",
    "start": "2137300",
    "end": "2143300"
  },
  {
    "text": "um- if you're- if it's a machine learning algorithm, you still generate your data, you just know it. Like you would just look up in your algorithm and",
    "start": "2143300",
    "end": "2148910"
  },
  {
    "text": "see what the probability distribution is. And for today, we're going to assume that this is known and it's perfect.",
    "start": "2148910",
    "end": "2154640"
  },
  {
    "text": "Um, that is obviously not true when we get into people data. In those cases, um,",
    "start": "2154640",
    "end": "2159770"
  },
  {
    "text": "there's a couple of different things you can do. One is that you can build estimators that are robust to this being wrong.",
    "start": "2159770",
    "end": "2165180"
  },
  {
    "text": "So you can use other ways to try to kind of be doubly robust if that estimator is wrong. In others you can take the empirical distribution.",
    "start": "2165180",
    "end": "2171160"
  },
  {
    "text": "And actually there's some cool work recently, I think was from Peter Stone's lab at UT Austin, showing that sometimes you- it's better to",
    "start": "2171160",
    "end": "2177310"
  },
  {
    "text": "use the empirical estimate then even if you know the true estimate. Like in terms of the resulting estimator, which is kinda cool.",
    "start": "2177310",
    "end": "2184620"
  },
  {
    "text": "Okay, so this is just writing that out in LaTex instead of me hand-writing it,",
    "start": "2186400",
    "end": "2191855"
  },
  {
    "text": "um, and so this just writes out, um, [NOISE] the- the probability of a history. And now we can see that equation that I put here.",
    "start": "2191855",
    "end": "2200000"
  },
  {
    "start": "2197000",
    "end": "2605000"
  },
  {
    "text": "So, um, you know, the value of the policy that you wanna evaluate, um, is gonna be this ratio of history's times the return of that history.",
    "start": "2200000",
    "end": "2208520"
  },
  {
    "text": "And what we said here is, and this is, you know, one over n,",
    "start": "2208520",
    "end": "2214730"
  },
  {
    "text": "is that this is simply the probability of taking each of",
    "start": "2214730",
    "end": "2219770"
  },
  {
    "text": "those actions or I'll write it just in terms of the Pi notation.",
    "start": "2219770",
    "end": "2225575"
  },
  {
    "text": "So this is Pi e of aj given sji,",
    "start": "2225575",
    "end": "2232790"
  },
  {
    "text": "i equals one to the- the length of your trajectory divide by Pi b aji.",
    "start": "2232790",
    "end": "2242970"
  },
  {
    "text": "All times the return of that particular history. [NOISE] So the beautiful thing is you can- this is an unbiased estimator.",
    "start": "2245680",
    "end": "2255920"
  },
  {
    "text": "This really does give you a good estimate of the value under a few assumptions, um, which I'll ask you guys about in a second.",
    "start": "2255920",
    "end": "2262865"
  },
  {
    "text": "And, um, you don't need to know the dynamics, so no dynamics.",
    "start": "2262865",
    "end": "2268160"
  },
  {
    "text": "No reward. No need to be Markov.",
    "start": "2268890",
    "end": "2275510"
  },
  {
    "text": "Can anybody, um, [NOISE] tell me case where maybe this doesn't work. So, I was just seeing that if you use this for running,",
    "start": "2277270",
    "end": "2284795"
  },
  {
    "text": "then starting from your initial policy to your final policy, they couldn't be that different, right? Because otherwise then you- the",
    "start": "2284795",
    "end": "2290870"
  },
  {
    "text": "samples [BACKGROUND] from the previous strikers won't be useful. That's a good question. That's exactly what I was asking about is, you know,",
    "start": "2290870",
    "end": "2296195"
  },
  {
    "text": "how different can Pi e and Pi b [BACKGROUND] and allow us to do this. So can- that was exactly what I was about to ask you guys about.",
    "start": "2296195",
    "end": "2301580"
  },
  {
    "text": "So, can anyone give me, uh, what they think might be a condition for this estimator to be valid. Like, where might be some cases where you would expect this might do",
    "start": "2301580",
    "end": "2310670"
  },
  {
    "text": "badly in terms of differences between the evaluation policy and the behavior policy?",
    "start": "2310670",
    "end": "2315740"
  },
  {
    "text": "And it has to do with the probability of taking actions in a certain state.",
    "start": "2315740",
    "end": "2325520"
  },
  {
    "text": "If either of those probabilities are too small, you are gonna have things blow up in bad ways.",
    "start": "2325520",
    "end": "2331790"
  },
  {
    "text": "Yeah, so in which that, either of these probabilities are too small. This might be bad. Which of these ways is worse? If they- uh, it's not [inaudible].",
    "start": "2331790",
    "end": "2339410"
  },
  {
    "text": "Right. So pi b is really small or at, you know, 0 [LAUGHTER]. Um, this could be really bad now.",
    "start": "2339410",
    "end": "2346565"
  },
  {
    "text": "Um, pi b can't ever be 0 and us observe something. So that's good, because we're getting data from pi b.",
    "start": "2346565",
    "end": "2353690"
  },
  {
    "text": "And so we have never observed a trajectory under which pi b is 0 but it could be really, really small.",
    "start": "2353690",
    "end": "2359464"
  },
  {
    "text": "So it could be, you know, you see something and it's incredibly unlikely there, but your behavior policy would have generated that.",
    "start": "2359465",
    "end": "2366035"
  },
  {
    "text": "Um, and what if it is 0? So it might be 0 for some actions.",
    "start": "2366035",
    "end": "2372425"
  },
  {
    "text": "What would that do if it's 0 in places where pi e is not 0 ? So what happens if pi b of a some particular a is equal to 0, uh,",
    "start": "2372425",
    "end": "2384035"
  },
  {
    "text": "but pi e of a greater than 0 is,",
    "start": "2384035",
    "end": "2390845"
  },
  {
    "text": "you know, greater than 0, might be 1. [NOISE] What might be bad there? Like do you think this is a- let's raise hands for a second.",
    "start": "2390845",
    "end": "2399130"
  },
  {
    "text": "If that happened, do you think we are hu- let's raise your hands, either yes if you think this is a good estimator or no if you think, oh, that's rough.",
    "start": "2399130",
    "end": "2405765"
  },
  {
    "text": "So if the behavior policy is 0 probability of taking an action, but the evaluation policy has a positive probability of taking an action.",
    "start": "2405765",
    "end": "2413494"
  },
  {
    "text": "Raise your hand if you think, um, this estimator could be really bad. That's right.",
    "start": "2413495",
    "end": "2419645"
  },
  {
    "text": "Yes. So, you know, if there are cases where you're just never trying actions, like you never saw actions in your data that",
    "start": "2419645",
    "end": "2424940"
  },
  {
    "text": "your new evaluation policy would take, you can't use this. So we often call this as coverage. So coverage or support.",
    "start": "2424940",
    "end": "2432720"
  },
  {
    "text": "So we often make a few basic assumptions in order for this to be valid. So our coverage or support normally means that pi b of",
    "start": "2432720",
    "end": "2439630"
  },
  {
    "text": "a given s has to be greater than 0 for all a and s, such that pi e of a given s is greater than 0.",
    "start": "2439630",
    "end": "2448925"
  },
  {
    "text": "So you kind of have to have support over. It doesn't have to be non-zero everywhere. But for anything that you might want to evaluate,",
    "start": "2448925",
    "end": "2454714"
  },
  {
    "text": "for anywhere if you're really going to generate data from your evaluation policy and it might take an action,",
    "start": "2454715",
    "end": "2459800"
  },
  {
    "text": "you need to be able to get to that state and you need to be able to take that action with some non-zero probability. Yeah.",
    "start": "2459800",
    "end": "2465635"
  },
  {
    "text": "So terminology questions. So, we're calling pi b is the same as pi 2 in the other part, right?",
    "start": "2465635",
    "end": "2472835"
  },
  {
    "text": "That's right. Okay. Originally I thought you said that the evaluation policy was the one that you observed the data from. That's incorrect?",
    "start": "2472835",
    "end": "2478295"
  },
  {
    "text": "Thanks for making me clarify that. Um, the- the- the behavior policy is always one you observe data from,",
    "start": "2478295",
    "end": "2483680"
  },
  {
    "text": "evaluation is the way you wanna look at. And, I apologize, notation often here is a little bit [NOISE] snaggly because I think, um,",
    "start": "2483680",
    "end": "2490895"
  },
  {
    "text": "people sometimes call the evaluation policy the target policy or evaluation policy or, you know, one or two, um,",
    "start": "2490895",
    "end": "2497150"
  },
  {
    "text": "and most of the time, the policy used to gather the data is called the behavior policy. Yeah.",
    "start": "2497150",
    "end": "2503840"
  },
  {
    "text": "[inaudible] you just like not include it in the product.",
    "start": "2503840",
    "end": "2509915"
  },
  {
    "text": "Question is whether or not what if they're both 0, um, is that a problem? Would you ever get data from that?",
    "start": "2509915",
    "end": "2515570"
  },
  {
    "text": "So, yes. So if they're both 0, it's okay. So you don't actually have to- it does not require you to",
    "start": "2515570",
    "end": "2520880"
  },
  {
    "text": "take- to have a non-zero probability of taking every action in every state. Um, so it can be okay.",
    "start": "2520880",
    "end": "2527869"
  },
  {
    "text": "So pi b of a given s can't equal 0, if pi e of a given s is equal to 0.",
    "start": "2527870",
    "end": "2536330"
  },
  {
    "text": "It's fine for that to be the case. You just can't have any case where you would never have either reached the state or generated",
    "start": "2536330",
    "end": "2543200"
  },
  {
    "text": "that action for things that you could have potentially done under your, um, evaluation policy.",
    "start": "2543200",
    "end": "2549319"
  },
  {
    "text": "And that doesn't sound too strict. Um, but in practice, that can be a big deal.",
    "start": "2549320",
    "end": "2554330"
  },
  {
    "text": "So if you think about like Montezuma's Revenge, excuse me, or different forms of Atari, like under a random behavior policy,",
    "start": "2554330",
    "end": "2560960"
  },
  {
    "text": "you're never gonna get to see a lot of states, and you're never gonna take actions in those states. Like you're just- uh, it's incredibly unlikely,",
    "start": "2560960",
    "end": "2567380"
  },
  {
    "text": "unless you have an enormous amount of data. So in practice, you can think of sort of the behavior policy you have is kinda of defining like,",
    "start": "2567380",
    "end": "2574115"
  },
  {
    "text": "um, like a ball [NOISE] under which you can evaluate other potential policies. So if you have like- it's not actually a sphere,",
    "start": "2574115",
    "end": "2582335"
  },
  {
    "text": "but like, you know, if it's, um, if you have a behavior policy here, you can think of kind of having some distance metric under which you can still get",
    "start": "2582335",
    "end": "2589580"
  },
  {
    "text": "good estimates of pi e. So you kind of have a radius,",
    "start": "2589580",
    "end": "2595025"
  },
  {
    "text": "and it depends on these are sort of essentially the- the policies for which you have support over and anything else you can't evaluate.",
    "start": "2595025",
    "end": "2603060"
  },
  {
    "text": "Okay, all right. So just to summarize there, um, you know, importance sampling is this beautiful idea that works for lots of statistics,",
    "start": "2604210",
    "end": "2611930"
  },
  {
    "start": "2605000",
    "end": "2672000"
  },
  {
    "text": "including for reinforcement learning. I think- The first introduction to this, um- I think it was first used for RL I think in,",
    "start": "2611930",
    "end": "2620390"
  },
  {
    "text": "um, Doina Precup's paper, Precup 2000? Around then. It's been around for a lot longer, but, um,",
    "start": "2620390",
    "end": "2626765"
  },
  {
    "text": "but I think for reinforcement learning, that was their first introduction of using this. And of course these ideas also come up in policy gradients type- type methods.",
    "start": "2626765",
    "end": "2633769"
  },
  {
    "text": "Um, and the great thing is thi- is, is this unbiased and consistent estimator,",
    "start": "2633770",
    "end": "2638810"
  },
  {
    "text": "just as a refresher consistent means that asymptotically it really will give you the right estimate.",
    "start": "2638810",
    "end": "2643820"
  },
  {
    "text": "So, you know, as n goes to infinity, the r estimated v pi e goes to e pi e. Just kind of a nice sanity check.",
    "start": "2643820",
    "end": "2656050"
  },
  {
    "text": "As you get more and more data, you will get the right estimator. Um, and just to check here, this is, you know,",
    "start": "2656050",
    "end": "2661435"
  },
  {
    "text": "under- under a few assumptions. You have to have support.",
    "start": "2661435",
    "end": "2666730"
  },
  {
    "text": "[BACKGROUND]",
    "start": "2666730",
    "end": "2672665"
  },
  {
    "start": "2672000",
    "end": "2798000"
  },
  {
    "text": "All right. Now, um, in our particular case, I- we can leverage a few aspects of the fact that this is a temporal process.",
    "start": "2672665",
    "end": "2680675"
  },
  {
    "text": "So again, like what we saw for policy gradient type work, um, we'll call policy gradient methods.",
    "start": "2680675",
    "end": "2688235"
  },
  {
    "text": "We can leverage the fact that, um, the future can't affect past rewards. So when we think about generating these importance ratios,",
    "start": "2688235",
    "end": "2696380"
  },
  {
    "text": "we only have to for a particular time step t, um, instead of multiplying it by- so I guess just to back up for there.",
    "start": "2696380",
    "end": "2705710"
  },
  {
    "text": "Remember that Gt is defined to be equal to, [NOISE] you know, the rewards, [NOISE] like the sum of rewards.",
    "start": "2705710",
    "end": "2713990"
  },
  {
    "text": "So when we think about this equation for importance sampling, um, let me just go back to here.",
    "start": "2713990",
    "end": "2719540"
  },
  {
    "text": "So this could be expanded into, you know, r_1 + gamma times r_2 + gamma squared times r_3, dot, dot, dot.",
    "start": "2719540",
    "end": "2728450"
  },
  {
    "text": "And right now in that equation, that's like multiplying your full product of importance ratios,",
    "start": "2728450",
    "end": "2735469"
  },
  {
    "text": "times e to the rewards. Um, so we're not doing any, it's the same ratio of probability of action given by probability of action,",
    "start": "2735469",
    "end": "2745135"
  },
  {
    "text": "multiplied by each of these different reward terms. But since, you know,",
    "start": "2745135",
    "end": "2750309"
  },
  {
    "text": "r_3 can't be affected by any actions that are in r_4 longer. In some ways you're just- this isn't wrong.",
    "start": "2750310",
    "end": "2757210"
  },
  {
    "text": "It's just that you're introducing additional variance. So similar to what we saw, um,",
    "start": "2757210",
    "end": "2763385"
  },
  {
    "text": "in policy gradient stuff, we don't actually- we only have to multiply by that product of ratios,",
    "start": "2763385",
    "end": "2769145"
  },
  {
    "text": "up to the time point at which we got that reward. So this allows us to get to per-decision importance sampling.",
    "start": "2769145",
    "end": "2775444"
  },
  {
    "text": "So this is only up to- only [NOISE] up to",
    "start": "2775445",
    "end": "2780635"
  },
  {
    "text": "point got reward [NOISE] because the- the future can't inputs past rewards.",
    "start": "2780635",
    "end": "2787790"
  },
  {
    "text": "And again, this is independent of it being Markov or not. So this is just the fact that it's a temporal process and we can't go back in time.",
    "start": "2787790",
    "end": "2795299"
  },
  {
    "text": "All right. So another thing just in general is that, um, in importance sampling, um,",
    "start": "2797950",
    "end": "2804575"
  },
  {
    "start": "2798000",
    "end": "3008000"
  },
  {
    "text": "we're just sort of these weights, these weights to these products. You know, products of like,",
    "start": "2804575",
    "end": "2809660"
  },
  {
    "text": "um, picking an action under different policies.",
    "start": "2809660",
    "end": "2813930"
  },
  {
    "text": "So we often call these weight terms nicely and confusingly with",
    "start": "2815110",
    "end": "2820160"
  },
  {
    "text": "all the weights we talked about with function approximation. Um, and weighted importance sampling compared to importance sampling just renormalizes by the sum of weights.",
    "start": "2820160",
    "end": "2828210"
  },
  {
    "text": "The reason you might wanna do this is that as we were talking about before, if your pi_b is really tiny.",
    "start": "2828820",
    "end": "2835190"
  },
  {
    "text": "So let's say this, this might be super tiny, super small [NOISE] for some trajectories,",
    "start": "2835190",
    "end": "2843500"
  },
  {
    "text": "then that can mean that your importance weight for those trajectories is enormous. In fact, we have,",
    "start": "2843500",
    "end": "2849515"
  },
  {
    "text": "um, a proof that, you know, that generally the size of your importance weights can grow exponentially with the horizon.",
    "start": "2849515",
    "end": "2854869"
  },
  {
    "text": "Um, uh, and so these importance weights can be incredibly large in some cases.",
    "start": "2854870",
    "end": "2860375"
  },
  {
    "text": "And so what weighted importance sampling does is it just renormalizes. So effectively, you're making it",
    "start": "2860375",
    "end": "2865940"
  },
  {
    "text": "so all your importance weights are somewhere between 0 and 1. Then you're using that when you're reweighting your distribution.",
    "start": "2865940",
    "end": "2873210"
  },
  {
    "text": "So when you do this, this is something that's very common, um, to do again this pre- predates the reinforcement learning side,",
    "start": "2874030",
    "end": "2880880"
  },
  {
    "text": "but has also been used in reinforcement learning. Um, this is, uh, this is biased, um, still consistent.",
    "start": "2880880",
    "end": "2889640"
  },
  {
    "text": "[NOISE] So that means asymptotically it's going to get to the right thing and lower variance.",
    "start": "2889640",
    "end": "2895700"
  },
  {
    "text": "[NOISE] So we're essentially going to play, um, the bias variance trade-off that we've often seen.",
    "start": "2895700",
    "end": "2903050"
  },
  {
    "text": "We can make Q learning versus Monte Carlo estimates. Monte Carlo were unbiased but very high-variance. Q Learning bootstrap so it's biased but",
    "start": "2903050",
    "end": "2910040"
  },
  {
    "text": "often much better because you're so much lower variance. Weighted importance sampling is much lower variance empirically much,",
    "start": "2910040",
    "end": "2915590"
  },
  {
    "text": "much better, most of the time, particularly for small amounts of data. Yeah. Yeah. I was wondering if you could comment on, um,",
    "start": "2915590",
    "end": "2922820"
  },
  {
    "text": "you know, before you're saying that we were intentionally designing something to be unbiased. So we're going to ignore certain techniques and now we're reintroducing bias at the end?",
    "start": "2922820",
    "end": "2930319"
  },
  {
    "text": "Right. I guess, what is the intuition behind when it's okay, I guess, to introduce bias and like when and why?",
    "start": "2930320",
    "end": "2937365"
  },
  {
    "text": "It's great one. Okay. So you just made a big deal before about saying let's go for unbiased estimators and now you're telling us that we're going to go back to bias in,",
    "start": "2937365",
    "end": "2943580"
  },
  {
    "text": "[LAUGHTER] that- that case, you know, how do we make decisions about when this is okay? Um, I think it totally depends on the domain.",
    "start": "2943580",
    "end": "2948890"
  },
  {
    "text": "Uh, and it als- I think one challenge and issue that comes up is, if things are unbiased,",
    "start": "2948890",
    "end": "2954410"
  },
  {
    "text": "it's often easier to have confidence intervals around them. We know better how to do that, um, when it's biased, it's often hard to quantify.",
    "start": "2954410",
    "end": "2961295"
  },
  {
    "text": "Um, I think, uh, I'll talk briefly a little bit later about times where we really just want to directly optimize for bias plus variance.",
    "start": "2961295",
    "end": "2967925"
  },
  {
    "text": "Like we want to look at accuracy, mean squared error, just the sum of bias and variance. And so then I think you can- it provides you a way to",
    "start": "2967925",
    "end": "2974000"
  },
  {
    "text": "directly trade-off between those two because you're like, I know I want to minimize the mean squared error. And that's the sum of these two, that gives me a way like,",
    "start": "2974000",
    "end": "2980420"
  },
  {
    "text": "a principled way, how to trade those off. I think another thing I often like just for sort of a sanity  check is that,",
    "start": "2980420",
    "end": "2986220"
  },
  {
    "text": "if it's biased but still consistent, um, that's sort of a nice sanity check. It's like okay maybe there's a small amount of bias early on,",
    "start": "2986220",
    "end": "2992589"
  },
  {
    "text": "but eventually if I get a lot of data, it's really given me the right answer. And some of the function approximation stuff we solve for Q learning.",
    "start": "2992590",
    "end": "2998500"
  },
  {
    "text": "That's not true, like we just, all bets are off, who knows what's happening asymptotically. But again, it depends on the- depends on the day.",
    "start": "2998500",
    "end": "3005530"
  },
  {
    "text": "It's a great question. It's a big challenge in that area. Okay. So as I was just saying in this case,",
    "start": "3005530",
    "end": "3011455"
  },
  {
    "start": "3008000",
    "end": "3048000"
  },
  {
    "text": "um, you know, weighted importance sampling, it's strongly consistent. You're going to converge, um,",
    "start": "3011455",
    "end": "3016930"
  },
  {
    "text": "if you have a finite horizon or, um, one behavior policy or bounded rewards, and, uh,",
    "start": "3016930",
    "end": "3022224"
  },
  {
    "text": "Phil and I, so that if you'd look at Thomas and Brunskill. [NOISE] We think about this for",
    "start": "3022225",
    "end": "3028224"
  },
  {
    "text": "the RL case in our ICML 2016 paper. It's one reference for this.",
    "start": "3028225",
    "end": "3034490"
  },
  {
    "text": "Okay. So we're going to have these estimates. Um, they may be,",
    "start": "3034920",
    "end": "3040780"
  },
  {
    "text": "if we're using weighted importance sampling, there might be a little bit bias, but lower variance. Otherwise, there might be high variance but low bias, or zero bias.",
    "start": "3040780",
    "end": "3047875"
  },
  {
    "text": "What's something else we could do? So, uh, let's briefly talk about control variance and be thinking in your head again at back to policy gradient,",
    "start": "3047875",
    "end": "3055240"
  },
  {
    "start": "3048000",
    "end": "3267000"
  },
  {
    "text": "and thinking about baselines. So just from a statistics perspective, um, you know, if we have an X,",
    "start": "3055240",
    "end": "3060940"
  },
  {
    "text": "we have the mean of that variable, um, if it's unbiased, it means that our estimate of the mean is matching the true expectation,",
    "start": "3060940",
    "end": "3068350"
  },
  {
    "text": "and then we have our variance. So let's imagine that we just kinda shift these estimates.",
    "start": "3068350",
    "end": "3075474"
  },
  {
    "text": "Okay. So we're just going to subtract a random variable Y,",
    "start": "3075475",
    "end": "3080950"
  },
  {
    "text": "and then in your head you can think about this as like a Q function, something like that. So, you know, Y might be a Q function,",
    "start": "3080950",
    "end": "3088280"
  },
  {
    "text": "and expected value of Y might be a V. Do you think about Q being,",
    "start": "3089250",
    "end": "3098485"
  },
  {
    "text": "um, as an a, an expected value of Y being an average over all the actions you could take in that state.",
    "start": "3098485",
    "end": "3104905"
  },
  {
    "text": "So then, i- if you redefine your mu so, um, X is gonna be like, let's,",
    "start": "3104905",
    "end": "3110530"
  },
  {
    "text": "we're gonna be going back towards trying to get our estimate of V_pi_e. [NOISE] Then if you subtract off something else and add on this expectation,",
    "start": "3110530",
    "end": "3119020"
  },
  {
    "text": "you still get an unbiased estimator. [NOISE] So we can just write that out here. So X - Y + expected value of Y,",
    "start": "3119020",
    "end": "3127285"
  },
  {
    "text": "just equal to expected value of X, minus expected value of Y,",
    "start": "3127285",
    "end": "3133075"
  },
  {
    "text": "plus expected value of Y.",
    "start": "3133075",
    "end": "3135890"
  },
  {
    "text": "So you can do this. I mean, you can do this in statistics. You can subtract a variable and add on its expectation and on average,",
    "start": "3139080",
    "end": "3146020"
  },
  {
    "text": "that does not change the mean of your original X. But you might ask, \"Why would I do that?\"",
    "start": "3146020",
    "end": "3151060"
  },
  {
    "text": "[LAUGHTER] So you can do this for anything like any- these are where X and Y are random variables.",
    "start": "3151060",
    "end": "3156250"
  },
  {
    "text": "So these are general, just any random variables, where Y is conc- called a control variant.",
    "start": "3156250",
    "end": "3162339"
  },
  {
    "text": "And this may be useful if it allows you to reduce variance. And that means that. You know.",
    "start": "3162340",
    "end": "3167560"
  },
  {
    "text": "Y has to have something to do with X. Okay. If you just subtract off something random, this is probably not going to be helpful.",
    "start": "3167560",
    "end": "3172645"
  },
  {
    "text": "But if you subtract off something that allows you to have some insight on X, in our case we're gonna be interested in things that allows us to help predict the value,",
    "start": "3172645",
    "end": "3179635"
  },
  {
    "text": "um, then we might get a lower variance. So we can look this by looking at what is the variance of this weird quantity mu hat,",
    "start": "3179635",
    "end": "3186520"
  },
  {
    "text": "where we had this X - Y + the expected value of Y. [NOISE] We can write it down as follows,",
    "start": "3186520",
    "end": "3193134"
  },
  {
    "text": "X - Y + the expected value of Y. Now, the variance of the expected value of Y,",
    "start": "3193135",
    "end": "3198310"
  },
  {
    "text": "there's no more variability in that so we can just say that's the variance of X - Y. [NOISE] So what that means is that we're gonna get something which is variance of X,",
    "start": "3198310",
    "end": "3207865"
  },
  {
    "text": "variance of Y, and the covariance of the two. So if it is the case that the covariance of X and Y, meaning that the, you know,",
    "start": "3207865",
    "end": "3215860"
  },
  {
    "text": "there is relationship between these two variables, one of them is giving us information about the other. If that is bigger than the variance of Y,",
    "start": "3215860",
    "end": "3222775"
  },
  {
    "text": "then you're going to have a win. Then you're gonna have that the resulting estimator. So if this is true,",
    "start": "3222775",
    "end": "3228295"
  },
  {
    "text": "if true- if true, variance of mu hat is gonna be [NOISE] less than variance of X.",
    "start": "3228295",
    "end": "3240230"
  },
  {
    "text": "So this is nice because it means that we didn't change the mean and we reduced the variance,",
    "start": "3241020",
    "end": "3247405"
  },
  {
    "text": "which in some ways, kind of seems like a free lunch but it's not really a free lunch because we're using information that is actually telling us something about X.",
    "start": "3247405",
    "end": "3254349"
  },
  {
    "text": "And this is very similar to us using a baseline term and policy gradient. Where instead of just relying on the Monte Carlo returns,",
    "start": "3254350",
    "end": "3260875"
  },
  {
    "text": "we could also subtract off a baseline like the value function. [NOISE] So you can do this in importance sampling as well.",
    "start": "3260875",
    "end": "3270625"
  },
  {
    "start": "3267000",
    "end": "3456000"
  },
  {
    "text": "Um, so where X is the importance sampling estimator and Y is some control variate.",
    "start": "3270625",
    "end": "3276100"
  },
  {
    "text": "Typically, you know, this can either be a Q function which you build from an approximate model of the Markov decision process.",
    "start": "3276100",
    "end": "3282985"
  },
  {
    "text": "It can be a Q function from Q learning. Um, this gives you some way to get- we can think of this as Q, you know,",
    "start": "3282985",
    "end": "3292120"
  },
  {
    "text": "some- some estimate [NOISE] of state-action [NOISE] value, okay.",
    "start": "3292120",
    "end": "3303190"
  },
  {
    "text": "And doing this is called a doubly robust estimator.",
    "start": "3304800",
    "end": "3309895"
  },
  {
    "text": "Doubly robust estimator is again, um, where in statistics for a long time, um, in around 2011, were brought over to the,",
    "start": "3309895",
    "end": "3317920"
  },
  {
    "text": "I remember were brought to the multi-armed bandit community, like the machine-learning multi-armed bandit community with Dudik et al.",
    "start": "3317920",
    "end": "3329060"
  },
  {
    "text": "And why do they call it doubly robust? Well, the idea is that, um, if you use information both from like your normal importance sampling, um,",
    "start": "3329220",
    "end": "3337240"
  },
  {
    "text": "plus some control variate like a Q value estimate, um, you can be robust too if either of those are wrong.",
    "start": "3337240",
    "end": "3344725"
  },
  {
    "text": "So either if you have a poor model or you have a bad estimate if your control variate is bad.",
    "start": "3344725",
    "end": "3349990"
  },
  {
    "text": "[NOISE] So you know, why would this be important?",
    "start": "3349990",
    "end": "3355450"
  },
  {
    "text": "Well, if we go back to sort of questions, some other people's questions, um, an alternative is just to like do Q learning on your data, right?",
    "start": "3355450",
    "end": "3361450"
  },
  {
    "text": "But Q learning might be biased or it might be a horrible estimate and who knows if it's good? Um, but it might be good.",
    "start": "3361450",
    "end": "3366654"
  },
  {
    "text": "So if it's great- good you'd like to be able to say, \"We've got a good estimate.\" Or if it's bad,",
    "start": "3366655",
    "end": "3371710"
  },
  {
    "text": "you'd like to say that it's with your importance sampling can compensate for that, and this says that either if you have a bad model,",
    "start": "3371710",
    "end": "3378625"
  },
  {
    "text": "um, or you have error in your estimates of pi B. So this is like those cases where we've got data from positions,",
    "start": "3378625",
    "end": "3384670"
  },
  {
    "text": "so we don't really know what the behavior policy is. So if you have inaccuracies there, then you, um,",
    "start": "3384670",
    "end": "3390430"
  },
  {
    "text": "also would like to if it turns out your control variate is accurate, then you could also do well. Now, if- in some cases both of these are bad and in that case,",
    "start": "3390430",
    "end": "3397885"
  },
  {
    "text": "kind of all bets are still off. But it gives you more robustness about different parts of what you're you're trying to estimate how good your evaluation policy is.",
    "start": "3397885",
    "end": "3406060"
  },
  {
    "text": "Okay, and Bill and I discussed sort of different ways",
    "start": "3406060",
    "end": "3411400"
  },
  {
    "text": "to do this as well as doing it in a weighted way, so incorporating weighted importance sampling.",
    "start": "3411400",
    "end": "3416740"
  },
  {
    "text": "So what does this allow you to do? Okay, I'll- I'll briefly show the equation. Then essentially, the idea here is these are like the importance sampling weights.",
    "start": "3416740",
    "end": "3425315"
  },
  {
    "text": "This is the raw returns and then we can add and subtract.",
    "start": "3425315",
    "end": "3431190"
  },
  {
    "text": "This was Y and this is the expected value of Y and these can be computed",
    "start": "3431190",
    "end": "3437010"
  },
  {
    "text": "by computing like Q learning or doing like an empirical model and doing dynamic programming on it.",
    "start": "3437010",
    "end": "3443080"
  },
  {
    "text": "You could get these sort of estimates of Q of pi E in lots of different ways, um, and they might be good or they might be bad.",
    "start": "3443080",
    "end": "3449440"
  },
  {
    "text": "But you can plug them in and often, they're gonna end up helping you in terms of variance. So let's see empirically what this does.",
    "start": "3449440",
    "end": "3455680"
  },
  {
    "text": "[NOISE] So this is a really small Gridworld. Think something on the order of like,",
    "start": "3455680",
    "end": "3461710"
  },
  {
    "start": "3456000",
    "end": "3600000"
  },
  {
    "text": "you know, maybe five-by-five, four-by-four. This is a really small world and we're using it to try to illustrate and understand,",
    "start": "3461710",
    "end": "3468895"
  },
  {
    "text": "um, the benefits of these different types of techniques. So what's on the x-axis? This is the amount of data.",
    "start": "3468895",
    "end": "3474234"
  },
  {
    "text": "So this is the size of the dataset. What's on the y-axis? This is mean squared error.",
    "start": "3474235",
    "end": "3480625"
  },
  {
    "text": "This is the difference between our estimate of the evaluation policy and the true evaluation policy,",
    "start": "3480625",
    "end": "3486940"
  },
  {
    "text": "and you want this to be small. So smaller, better and this is a log scale.",
    "start": "3486940",
    "end": "3492640"
  },
  {
    "text": "[NOISE] So what do we see here? So one thing you could do is you could build an approximate model with your data.",
    "start": "3492640",
    "end": "3499615"
  },
  {
    "text": "That model might be wrong like maybe, you're making a Markov assumption and it's wrong. Or maybe, um, you know,",
    "start": "3499615",
    "end": "3504790"
  },
  {
    "text": "there's other parts where you just can't estimate well. So this is the model-based. So this is just we use a model,",
    "start": "3504790",
    "end": "3510175"
  },
  {
    "text": "and we compute V pi e for that model.",
    "start": "3510175",
    "end": "3515260"
  },
  {
    "text": "So we take our data, we build an MDP model, then we, um, use that to- then that's like a simulator and then we can",
    "start": "3515260",
    "end": "3521950"
  },
  {
    "text": "just compute V_pi e. So you can see here it's flat. Um, in this case, um, I'd have to remember here.",
    "start": "3521950",
    "end": "3527500"
  },
  {
    "text": "I think we are using a different dataset. Either I- I would have to double check whether or not just after we have that number of episodes,",
    "start": "3527500",
    "end": "3533620"
  },
  {
    "text": "the model just doesn't change with further data. Like the model just isn't great. Maybe we're not using all the features that we should be, um,",
    "start": "3533620",
    "end": "3540175"
  },
  {
    "text": "or the world isn't really Markov, and so you kind of have this fixed bias. Your model can be asymptotically wrong.",
    "start": "3540175",
    "end": "3545545"
  },
  {
    "text": "The estimates you get from it can be asymptotically wrong if your model is not a good fit to the environment. [NOISE] The- the second thing we can do is we can do importance sampling.",
    "start": "3545545",
    "end": "3556070"
  },
  {
    "text": "So importance sampling is unbiased. It's going down as we get more data as we would hope.",
    "start": "3556380",
    "end": "3561700"
  },
  {
    "text": "Eventually, it should collapse to 0. Um, but we'd like to do better than that.",
    "start": "3561700",
    "end": "3566710"
  },
  {
    "text": "So now this is per decision importance sampling. You can see you get a benefit from leveraging the fact",
    "start": "3566710",
    "end": "3572230"
  },
  {
    "text": "that rewards can't be influenced by future decisions. That reduces the variance, kind of gives you this nice kind of automatic shift down.",
    "start": "3572230",
    "end": "3580520"
  },
  {
    "text": "Um, if you do doubly robust, you get a significant bump. So what's doubly robust doing again?",
    "start": "3580920",
    "end": "3586240"
  },
  {
    "text": "It's combining our approximate model plus IS. So you can see again, here we're getting,",
    "start": "3586240",
    "end": "3592930"
  },
  {
    "text": "ah, a significant bump. Now, I talk about this mostly in terms of mean squared error but I think it's really important to think about what mean squared error means.",
    "start": "3592930",
    "end": "3601045"
  },
  {
    "text": "Um, so mean squared error here is, you know, how accurately are we estimating this V_pi E minus the true one?",
    "start": "3601045",
    "end": "3608740"
  },
  {
    "text": "But we can alternatively think about this in terms of how much data we need to get a good estimate. So look at this. This is- you want a mean squared error of 1.",
    "start": "3608740",
    "end": "3619060"
  },
  {
    "text": "Maybe that's sufficient. Maybe that's not. That means that under a per decision important sampling estimator,",
    "start": "3619060",
    "end": "3627100"
  },
  {
    "text": "you would need 2,000 episodes and with doubly robust, you'd need less than 200.",
    "start": "3627100",
    "end": "3632275"
  },
  {
    "text": "So that's awesome because it means that we need like an order of magnitude less data, in order to get good estimates,",
    "start": "3632275",
    "end": "3638680"
  },
  {
    "text": "and a lot of real world applications we just don't have enough data. You know, there might not be a lot of patients with a particular condition and",
    "start": "3638680",
    "end": "3645654"
  },
  {
    "text": "you'd really like to still be able to make good decisions for them, and so you need estimators that need much less data to give you good answers.",
    "start": "3645655",
    "end": "3652045"
  },
  {
    "text": "And so that's why this is important. Okay? Right. And then in these cases,",
    "start": "3652045",
    "end": "3658450"
  },
  {
    "text": "we can see also that if you do weighted importance sampling [NOISE] and weighted throughput decision, that also ends up helping a lot.",
    "start": "3658450",
    "end": "3664510"
  },
  {
    "text": "[NOISE] Here, is if you do weighted doubly robust,",
    "start": "3664510",
    "end": "3670315"
  },
  {
    "text": "again, sort of answering that question of when should you do, you know, how do you trade off between this bias and variance?",
    "start": "3670315",
    "end": "3675670"
  },
  {
    "text": "Um, here, we can see that if we do some form of weighted, uh, doubly robust which is one of the things we introduced in our ICML paper.",
    "start": "3675670",
    "end": "3682030"
  },
  {
    "text": "You again get a really big gain. So we had this to there, and this to there, right?",
    "start": "3682030",
    "end": "3688630"
  },
  {
    "text": "So now you are needing like five episodes to get to the same. So again, some of these improvements can be- this is of course Gridworld, right?",
    "start": "3688630",
    "end": "3695890"
  },
  {
    "text": "Like this- you- you need- one needs to look at this also for the particular domain one's interested in. But it indicates there are just some of these cases by being, um,",
    "start": "3695890",
    "end": "3702970"
  },
  {
    "text": "a little bit better in terms of these estimators, you can get substantial gains in terms of how accurate your estimators are.",
    "start": "3702970",
    "end": "3708490"
  },
  {
    "text": "[NOISE] All right, again to continue on this slide of like, how do you balance between variance, um, and bias.",
    "start": "3708490",
    "end": "3715375"
  },
  {
    "text": "One thing that Phil and I thought about is, okay, well, you know, you might want to have, um, low bias and variance, ah,",
    "start": "3715375",
    "end": "3721165"
  },
  {
    "text": "and- and how do you do this trade-off, let's just think about optimizing for it directly. So our magic estimator just tries to directly- directly minimize mean squared error.",
    "start": "3721165",
    "end": "3733734"
  },
  {
    "text": "Okay. So- so again let's say mean squared error is gonna be, you know, it's a function of bias and variance.",
    "start": "3733735",
    "end": "3741290"
  },
  {
    "text": "So if you knew what bias and variance was, you could hopefully just optimize this directly.",
    "start": "3742260",
    "end": "3747790"
  },
  {
    "text": "Do we know what bias is? So bias again just to remember is bias is the difference",
    "start": "3747790",
    "end": "3753520"
  },
  {
    "text": "between this minus this. That's bias.",
    "start": "3753520",
    "end": "3759410"
  },
  {
    "text": "Do we know that? No, unfortunately, if we knew that,",
    "start": "3760830",
    "end": "3766165"
  },
  {
    "text": "if we knew the bias, then we wouldn't have to do anything else because we would know exactly what the real value was.",
    "start": "3766165",
    "end": "3771865"
  },
  {
    "text": "So a big challenge when we're trying to do this work is how do you get a good estimate of bias? Or like an under or overestimated bias?",
    "start": "3771865",
    "end": "3778990"
  },
  {
    "text": "And just briefly, the idea that we had there is to say, if you can get confidence intervals, which you can using importance sampling.",
    "start": "3778990",
    "end": "3786010"
  },
  {
    "text": "So let's say, I have these, you know, this is my estimate from importance sampling. And I have some uncertainty over it.",
    "start": "3786010",
    "end": "3792355"
  },
  {
    "text": "So this gives me some estimate, [NOISE] with some upper and lower bounds. So you know, I'm like, you can do, ah,",
    "start": "3792355",
    "end": "3799089"
  },
  {
    "text": "let's say the value is 5 plus or minus 2. Okay. And then let's say I have a model, um,",
    "start": "3799090",
    "end": "3805585"
  },
  {
    "text": "I have a model that I built from this data and then I used it to evaluate and I got another estimate up here.",
    "start": "3805585",
    "end": "3811224"
  },
  {
    "text": "So I have a V_pi, and this is using a model. Okay, so let's say this is 8.",
    "start": "3811225",
    "end": "3818290"
  },
  {
    "text": "So what is the minimum bias my model has to have?",
    "start": "3818290",
    "end": "3823190"
  },
  {
    "text": "How could you use these confidence intervals to get like a lower bound on how- how bad my- assume these confidence intervals are correct.",
    "start": "3824610",
    "end": "3832075"
  },
  {
    "text": "Now that these are real confidence intervals so we know the real value has to be between 3 and 7.",
    "start": "3832075",
    "end": "3837145"
  },
  {
    "text": "What's the- what's the minimum bias that my model would have? One right, because it's this difference, okay.",
    "start": "3837145",
    "end": "3845859"
  },
  {
    "text": "So this gives you a lower bound on the bias. So how far off you are from these confidence intervals that gives you a lower bound on the bias?",
    "start": "3845860",
    "end": "3852684"
  },
  {
    "text": "It's optimistic, your bias- your model might be way more biased. Um, uh, but it gives you a way to quantify what that bias is,",
    "start": "3852685",
    "end": "3858940"
  },
  {
    "text": "and that's what we use in this approach. So we combine our importance sampling estimators and think about how variable they are.",
    "start": "3858940",
    "end": "3864490"
  },
  {
    "text": "We have to get an estimate of their variance, um, as well as the bias on the model, and that allows us to figure out how to trade off between these.",
    "start": "3864490",
    "end": "3871645"
  },
  {
    "text": "And again, you get, um, you get a really substantial gain often. This is still Gridworld but, um,",
    "start": "3871645",
    "end": "3880000"
  },
  {
    "text": "you're gonna get again [NOISE] roughly an order by magnitude difference in some domains.",
    "start": "3880000",
    "end": "3887275"
  },
  {
    "text": "You're gonna need an order of magnitude less data.",
    "start": "3887275",
    "end": "3890690"
  },
  {
    "text": "And in this case, I've just zoomed in so you don't even see some of these other methods because they're so much higher up.",
    "start": "3892680",
    "end": "3897910"
  },
  {
    "text": "[NOISE] Okay, so, you know, that's one thing that we could do to try to get sort of",
    "start": "3897910",
    "end": "3903490"
  },
  {
    "text": "good off-policy policy evaluation estimates. Um, I haven't talked to you too much so far about like how are we gonna get these confidence bounds over those.",
    "start": "3903490",
    "end": "3910075"
  },
  {
    "text": "But I've mentioned sort of a number of different ways that we could try to get just an estimate of, you know, V_pi E. So we want to get some estimate of",
    "start": "3910075",
    "end": "3916795"
  },
  {
    "text": "this new alternative policy that we might wanna unleash on the wild. Um, I'll- I'm gonna skip this part, I'll just say briefly,",
    "start": "3916795",
    "end": "3924789"
  },
  {
    "text": "you know, there are some subtleties here with whether or not, um, ah, you know, what's the support of your behavior policy, um,",
    "start": "3924790",
    "end": "3931210"
  },
  {
    "text": "and how we do some different weighting and can we improve over this sort of weighted importance sampling? Um, [NOISE]. The answer is, is yes.",
    "start": "3931210",
    "end": "3938694"
  },
  {
    "text": "You can do some slightly different weightings, um, and I'll- I'll defer that. And then also, another really important question,",
    "start": "3938695",
    "end": "3944490"
  },
  {
    "text": "really important in practice is that, um, your distributions are often non-stationary. You know, imagine that like you're looking at",
    "start": "3944490",
    "end": "3950920"
  },
  {
    "text": "patient data and during that time period like some new food pyramid came out from the Food and Drug Administration and so everyone changed how they're eating.",
    "start": "3950920",
    "end": "3958195"
  },
  {
    "text": "Um, so now that, you know, the dynamics of your patients are gonna be really different than before. So you'd like to be able to identify whether or not you",
    "start": "3958195",
    "end": "3964420"
  },
  {
    "text": "have sort of non-stationarity in your data-set. Like if the dynamics model of the world is changing. So we have some other ideas about how to handle that.",
    "start": "3964420",
    "end": "3971680"
  },
  {
    "text": "[NOISE] Okay, but now let's go to and say, let's assume we've done this off-policy policy evaluation.",
    "start": "3971680",
    "end": "3976840"
  },
  {
    "text": "We've gotten out some estimate, um, of these, how good our alternative policy would be,",
    "start": "3976840",
    "end": "3981850"
  },
  {
    "text": "and we want to go beyond that and we want to get some confidence over it. So again remember we're trying to move to a world where we can say, you know,",
    "start": "3981850",
    "end": "3988300"
  },
  {
    "text": "the probability that the policy output by our algorithm being better than our previous policy, [NOISE] is high.",
    "start": "3988300",
    "end": "3999820"
  },
  {
    "text": "So with high probability we're gonna give you a policy that's better, which means not only do we need to have an estimate on how good that policy is but",
    "start": "3999820",
    "end": "4005970"
  },
  {
    "text": "how much better it is or not than your behavior policy. Okay. How would we do that?",
    "start": "4005970",
    "end": "4011355"
  },
  {
    "text": "So let's first consider using importance sampling plots Hoeffding's inequality. Again let's think back to what we are doing with exploration,",
    "start": "4011355",
    "end": "4018609"
  },
  {
    "text": "to do high confidence off-policy policy evaluation. So just as a refresher, mountain car is the simple control task,",
    "start": "4019460",
    "end": "4026339"
  },
  {
    "text": "[NOISE] where, you know, you have your agent trying to reach here, we get high reward.",
    "start": "4026340",
    "end": "4033130"
  },
  {
    "text": "And we're gonna have data gathered from some behavior policy and we want to try to learn a better policy from it,",
    "start": "4033890",
    "end": "4039990"
  },
  {
    "text": "and be able to get competence bounds over its performance. Okay, so remember that in Hoeffding's inequality,",
    "start": "4039990",
    "end": "4046050"
  },
  {
    "text": "it's a way to look at how different your- your mean is from, um, your average so far.",
    "start": "4046050",
    "end": "4051840"
  },
  {
    "text": "So how different can we- how can your- how different can your empirical mean be [NOISE] minus your true mean?",
    "start": "4051840",
    "end": "4059580"
  },
  {
    "text": "[NOISE] And it gives you a bound on that in terms of the amount of data you have.",
    "start": "4059580",
    "end": "4065625"
  },
  {
    "text": "Okay, so it's a function of the amount of data you have. And it depends on the range of your variables, okay.",
    "start": "4065625",
    "end": "4073785"
  },
  {
    "text": "So thought about about this for arms, which might have rewards of between 0 and 1, and then b would be 1.",
    "start": "4073785",
    "end": "4079050"
  },
  {
    "text": "Okay, so we can use Hoeffding's inequality also, we talked about it briefly for, um, uh, [NOISE] you can use a model-based reinforcement learning.",
    "start": "4079050",
    "end": "4086145"
  },
  {
    "text": "Let's think about using that in the context of this off-policy evaluation. So we can also use it using our old data to try to estimate, um,",
    "start": "4086145",
    "end": "4093000"
  },
  {
    "text": "what the- what our upper or lower bounds might be on the value of the evaluation policy. [NOISE] So let's imagine that we use 100,000 trajectories.",
    "start": "4093000",
    "end": "4102045"
  },
  {
    "text": "And the evaluation policy's true performance is 0.19. And if we use Hoeffding's inequality,",
    "start": "4102045",
    "end": "4107880"
  },
  {
    "text": "we're very confident that the new policy has at least -5 million.",
    "start": "4107880",
    "end": "4113739"
  },
  {
    "text": "Okay. And we know that the real reward is somewhere between 0 and 1.",
    "start": "4114890",
    "end": "4120600"
  },
  {
    "text": "But Hoeffding's inequality gives us this bound of -5 million, and that's true, right?",
    "start": "4120600",
    "end": "4126299"
  },
  {
    "text": "Like [LAUGHTER] you know, is like 0.19 is greater than -5 million.",
    "start": "4126300",
    "end": "4132250"
  },
  {
    "text": "But it's not particularly informative. Um, like we know that the real returns",
    "start": "4132890",
    "end": "4138089"
  },
  {
    "text": "for the- for this domain is somewhere between 0 and 1. And if we use Hoeffding's inequality there,",
    "start": "4138090",
    "end": "4143745"
  },
  {
    "text": "we're getting something that we'd call is vacuous. Okay, so you're getting a bound that is true but entirely uninformative.",
    "start": "4143745",
    "end": "4150375"
  },
  {
    "text": "Because it is incredibly negative, right? Like we know that this is the true- true value is- for all policy is between 0 and 1.",
    "start": "4150375",
    "end": "4160079"
  },
  {
    "text": "[NOISE] Okay. So why did this happen?",
    "start": "4160080",
    "end": "4165134"
  },
  {
    "text": "Um, [NOISE] let's look at importance sampling. Importance sampling says we're gonna take this product of weights.",
    "start": "4165135",
    "end": "4171975"
  },
  {
    "text": "Okay, and as we've talked about before, this might be pretty small.",
    "start": "4171975",
    "end": "4177549"
  },
  {
    "text": "So let's imagine this is like, you know, 0.1. So then you have 10 to the L. Like if you take a series of actions,",
    "start": "4178400",
    "end": "4189210"
  },
  {
    "text": "let's say for every single action of that trajectory it was pretty unlikely [NOISE] which you often need in domains like mountain car,",
    "start": "4189210",
    "end": "4195090"
  },
  {
    "text": "because in mountain car you have to take a pretty specific sequence of actions in order to finally see some reward at the end,",
    "start": "4195090",
    "end": "4200985"
  },
  {
    "text": "and under a policy [NOISE] that is not optimal, it might be pretty unlikely to see those series of actions. So let's say, you know, most of your data you never get up the hill,",
    "start": "4200985",
    "end": "4208305"
  },
  {
    "text": "in like one or two of your data points you actually get up to the top of the hill, and those were very rare trajectories.",
    "start": "4208305",
    "end": "4213615"
  },
  {
    "text": "Which means your, um, importance sampling weights are gonna be extremely high. It's gonna be this, you know,",
    "start": "4213615",
    "end": "4219165"
  },
  {
    "text": "1 divided by 0.1 up to the L. [NOISE] That's just enormous you know.",
    "start": "4219165",
    "end": "4225735"
  },
  {
    "text": "Um, so these can start to be incredibly large. And Hoeffding's Inequality depends on this.",
    "start": "4225735",
    "end": "4235455"
  },
  {
    "text": "The range of the potential returns you have. What are the range of our potential returns? The range of our potential returns are g times or",
    "start": "4235455",
    "end": "4243990"
  },
  {
    "text": "product of i equals 1 to t of our importance weights. [NOISE]",
    "start": "4243990",
    "end": "4253140"
  },
  {
    "text": "So b is equal to max over this. It says, \"In the maximum case,",
    "start": "4253140",
    "end": "4258600"
  },
  {
    "text": "what could it look like, your return is?\" [NOISE]. And so it's gonna depend most on what your real range is.",
    "start": "4258600",
    "end": "4264120"
  },
  {
    "text": "Our real [NOISE] b is going to be between 0 and 1, and this product of importance sampling weights,",
    "start": "4264120",
    "end": "4269235"
  },
  {
    "text": "and that's where the problem is. The product of importance sampling weights can be enormous. Okay.",
    "start": "4269235",
    "end": "4274745"
  },
  {
    "text": "Because you have really unlikely sequence of actions, and then you get this blow up. All right.",
    "start": "4274745",
    "end": "4281940"
  },
  {
    "text": "So if we look at that here, we can get this distribution, um, and some of the, some of these are incredibly large,",
    "start": "4281940",
    "end": "4288120"
  },
  {
    "text": "and that means that our Hoeffding Inequality ended up being, because Hoeffding again is you subtract b,",
    "start": "4288120",
    "end": "4294630"
  },
  {
    "text": "basically -b times square root of 1 over n. So if b, let's say- let's say,",
    "start": "4294630",
    "end": "4300300"
  },
  {
    "text": "your trajectory lengths are something like 200, which is pretty, somewhat reasonable for Monte Carlo, I'm sorry, for mountain car.",
    "start": "4300300",
    "end": "4306495"
  },
  {
    "text": "Then you'd have something like 1 over 0.1 to the 200 times 1,",
    "start": "4306495",
    "end": "4313110"
  },
  {
    "text": "times the square root of 1 over n, roughly right? And so [NOISE] you'd have just this crazy,",
    "start": "4313110",
    "end": "4318929"
  },
  {
    "text": "crazy large term and you're subtracting this. So that would mean that your bounds are vacuous,",
    "start": "4318930",
    "end": "4324960"
  },
  {
    "text": "basically I have no idea how good this evaluation policy would be. So does anybody have any questions about that, about why that issue occurs?",
    "start": "4324960",
    "end": "4332670"
  },
  {
    "text": "Okay. So the insight that Phil had in some of his previous work is, just get rid of those, just cut it down.",
    "start": "4332670",
    "end": "4340140"
  },
  {
    "text": "Um, so if you remove this tail, what does that do to your expected value?",
    "start": "4340140",
    "end": "4346395"
  },
  {
    "text": "It just decreases it. So if you ignore those like really, really crazy high returns [NOISE] you're",
    "start": "4346395",
    "end": "4353640"
  },
  {
    "text": "not gonna get an estimate anymore that's as good, but it's just gonna get smaller. You're not gonna overestimate it.",
    "start": "4353640",
    "end": "4360450"
  },
  {
    "text": "So again, if we're thinking about say policy improvement, we're concerned about deploying policies that are worse than we think they are in practice.",
    "start": "4360450",
    "end": "4366435"
  },
  {
    "text": "What this is gonna do, is say, we're gonna underestimate how good our behavior policy is, or our evaluation policy is.",
    "start": "4366435",
    "end": "4372989"
  },
  {
    "text": "And so if we underestimate it, that's okay because that's safe, like if we don't deploy things that actually would have been good,",
    "start": "4372990",
    "end": "4378390"
  },
  {
    "text": "maybe there's a lost opportunity cost, but it's not gonna be bad for the world, um, so that's what the insight was,",
    "start": "4378390",
    "end": "4385050"
  },
  {
    "text": "for here is that you can like remove this upper tail. And so you don't need to read the proof, ah, um,",
    "start": "4385050",
    "end": "4390750"
  },
  {
    "text": "but the idea is that you can basically define a new confidence interval, that is conservative [NOISE].",
    "start": "4390750",
    "end": "4398730"
  },
  {
    "text": "And you can think about how you choose that conservatism, depending also on the amount of data you have.",
    "start": "4398730",
    "end": "4403925"
  },
  {
    "text": "So here's the beautiful take-home, um, so let's say that you kind of use 20% of your data to figure out exactly how to tune this confidence interval,",
    "start": "4403925",
    "end": "4411290"
  },
  {
    "text": "so this is sort of sets your confidence interval. And then your next part to compute your lower bound,",
    "start": "4411290",
    "end": "4417195"
  },
  {
    "text": "so for mountain car with the same amount of data, you've got 100k trajectories. So this is the new estimator,",
    "start": "4417195",
    "end": "4424320"
  },
  {
    "text": "and you get the, um, the mu, the estimator of the V pi, so this is a lower bound on V pi e. [NOISE] It says it's gonna be at least 0.145,",
    "start": "4424320",
    "end": "4435435"
  },
  {
    "text": "and the true value is 0.19. And this is compared to all these other forms of concentration inequalities,",
    "start": "4435435",
    "end": "4441929"
  },
  {
    "text": "which were all, except for Anderson, really, really bad [NOISE]. So things like Chernoff-Hoeffding and these other",
    "start": "4441930",
    "end": "4447720"
  },
  {
    "text": "ones you don't have to be familiar with all of these. But basically, it just says if you'd used other approaches, to try to get this lower bound [NOISE] they would have been entirely vacuous,",
    "start": "4447720",
    "end": "4455040"
  },
  {
    "text": "whereas this one says, \"Okay. We're not sure exactly how good it is. It's gonna be at least 0.145,",
    "start": "4455040",
    "end": "4460380"
  },
  {
    "text": "and the real value is 0.19.\" It's not perfect, but you know, if- if your behavior policy was 0.05,",
    "start": "4460380",
    "end": "4466920"
  },
  {
    "text": "that would be good enough to say you should use a new thing [NOISE].",
    "start": "4466920",
    "end": "4472350"
  },
  {
    "text": "So, um, they use this idea for digital marketing, this is some work that Phil had done in collaboration with some colleagues over at Adobe.",
    "start": "4472350",
    "end": "4478380"
  },
  {
    "text": "Um, and the nice thing about this is you can say, you know, if I want it, I'll figure it out, if I [NOISE] am gonna deploy something, and get, um,",
    "start": "4478380",
    "end": "4485280"
  },
  {
    "text": "more effective digital marketing, and I have access to our previous data. [NOISE] Can I say with what confidence,",
    "start": "4485280",
    "end": "4491625"
  },
  {
    "text": "I can deploy something that's gonna, you know, generate higher clicks, get more revenue. [NOISE] And these confidence bounds turn out to be tight",
    "start": "4491625",
    "end": "4498780"
  },
  {
    "text": "enough that you can actually know that the new policy is gonna be better, which is pretty cool. [NOISE] [inaudible] Yeah. You can also,",
    "start": "4498780",
    "end": "4507585"
  },
  {
    "text": "so this is one form of trying to get those confidence bounds, turns out you can also use t-tests and empirically that's often very good.",
    "start": "4507585",
    "end": "4513630"
  },
  {
    "text": "Um, and some of you guys might have seen some of these in, ah, some of your statistics class. I'll just really briefly take, because we're almost out of time,",
    "start": "4513630",
    "end": "4520740"
  },
  {
    "text": "that you can combine these ideas, and then think about trying to get these lower bounds, um, here, and combine it with optimization.",
    "start": "4520740",
    "end": "4526860"
  },
  {
    "text": "So you can think about doing this for a number of different policies, trying to compute lower bounds on all of them. And then using that information to try to",
    "start": "4526860",
    "end": "4533490"
  },
  {
    "text": "decide which one to deploy in the future, in a way that is safe. Okay. So you can sort of say, \"I'm gonna use some of my data to optimize,",
    "start": "4533490",
    "end": "4540660"
  },
  {
    "text": "some of my data to, um, ah, to try to evaluate the resulting one, and make sure that it's got a good confidence bound before I deploy it.",
    "start": "4540660",
    "end": "4547560"
  },
  {
    "text": "[NOISE] And again, you can do this in digital marketing, some of the other work that Phil Thomas and I have looked at is,",
    "start": "4547560",
    "end": "4554804"
  },
  {
    "text": "using a diabetes simulator, and looking at whether or not we can infer higher-performing policies for things like [NOISE] insulin regulation,",
    "start": "4554805",
    "end": "4562589"
  },
  {
    "text": "um, ah, using similar ideas in something that in a way that you could be, um, with high-confidence better before you deploy it.",
    "start": "4562589",
    "end": "4570700"
  },
  {
    "text": "I'm gonna skip briefly through this. This- this is a really big ba- ah,",
    "start": "4571550",
    "end": "4577230"
  },
  {
    "text": "like this is an increasingly, ah, big area of work in the community. Um, I think a lot of people are thinking about,",
    "start": "4577230",
    "end": "4583230"
  },
  {
    "text": "it is counterfactual reasoning issue because we have more and more data from electronic medical records systems, that we'd like to use to improve patient health.",
    "start": "4583230",
    "end": "4589965"
  },
  {
    "text": "We have data, um, you know, on- on online platforms etc. There's a lot of additional challenges, things like how do you deal with long horizons?",
    "start": "4589965",
    "end": "4597015"
  },
  {
    "text": "Um, [NOISE] the fact that importance sampling can be unfair, ah, [NOISE] what do I mean by that?",
    "start": "4597015",
    "end": "4602115"
  },
  {
    "text": "I mean that, essentially, different policies when you evaluate them, might have different amounts of variance depending on",
    "start": "4602115",
    "end": "4608610"
  },
  {
    "text": "how well they match to your behavior policy. Because of that, it may be hard to decide which of those you should deploy.",
    "start": "4608610",
    "end": "4614355"
  },
  {
    "text": "Um, we have various work thinking about when the behavior policy is unknown. Where we combine these ideas with deep neural networks,",
    "start": "4614355",
    "end": "4620445"
  },
  {
    "text": "um, and we're also thinking about transfer learning. So I know Chelsea talked about meta-learning on Monday. Um, one of the interesting ideas here is,",
    "start": "4620445",
    "end": "4627315"
  },
  {
    "text": "you're building these forms of models. Can you kinda use the same ideas of fine tuning in the reinforcement learning case?",
    "start": "4627315",
    "end": "4633614"
  },
  {
    "text": "So can you think about building models for our policy evaluation that leveraged as data that does not match the policy you care about?",
    "start": "4633615",
    "end": "4640785"
  },
  {
    "text": "In order to get generally better models, you know, things like health care, I think that can be pretty helpful. [NOISE] But there's a lot of additional work on this,",
    "start": "4640785",
    "end": "4647550"
  },
  {
    "text": "and there's a number of other groups that are thinking about these types of ideas. Um, and also on campus if you're interested in these ideas in general.",
    "start": "4647550",
    "end": "4655800"
  },
  {
    "text": "There's also a number of great colleagues that are thinking about this from other perspectives. People coming at it from the perspective of economics,",
    "start": "4655800",
    "end": "4661694"
  },
  {
    "text": "or statistics, or epidemiology. And it's been really fun to try to get to collaborate with these people as well.",
    "start": "4661694",
    "end": "4666735"
  },
  {
    "text": "So just to pop-up a level briefly, um, the goal in these cases is to think about if you have some set of data,",
    "start": "4666735",
    "end": "4673619"
  },
  {
    "text": "we're gonna go from data to a good new policy [NOISE].",
    "start": "4673620",
    "end": "4680070"
  },
  {
    "text": "Okay. And you want it to be good in a way that you know something about the quality of it before you deploy it. And so that's really what's sort of safe off-policy policy evaluation and selection,",
    "start": "4680070",
    "end": "4688710"
  },
  {
    "text": "or optimization is about. And so in terms of the things that you should understand from here, you should be able to define and apply importance sampling [NOISE] ,",
    "start": "4688710",
    "end": "4696660"
  },
  {
    "text": "know some limitations of importance sampling. [NOISE] List a couple of- of alternatives. Know, you- why you might want to be able to do this sort of safe reinforcement learning,",
    "start": "4696660",
    "end": "4704850"
  },
  {
    "text": "like what sort of applications this might be important in. [NOISE] And sort of the- define what type of guarantees we're getting in these scenarios.",
    "start": "4704850",
    "end": "4712900"
  },
  {
    "text": "So that's it, and then next week, we'll have the quiz on Monday, and then on Wednesday we'll talk about Monte Carlo tree search. Thanks.",
    "start": "4713030",
    "end": "4720460"
  }
]