[
  {
    "start": "0",
    "end": "82000"
  },
  {
    "text": "All right. Welcome back everybody. Um, before we get started today,",
    "start": "5000",
    "end": "10050"
  },
  {
    "text": "I- does anybody have any questions about logistics, or midterm, or anything like that? We'll be doing a midterm review on Monday,",
    "start": "10050",
    "end": "16710"
  },
  {
    "text": "and the midterm will be on Wednesday. Because there's a number of people in the class, we're gonna be spreading everybody across a couple of rooms,",
    "start": "16710",
    "end": "23430"
  },
  {
    "text": "and will be, er, sending instructions out about that. Does anybody have any other logistics questions? Yeah.",
    "start": "23430",
    "end": "31380"
  },
  {
    "text": "Midterm is during class time right? Midterm is during class time. Um, instructions will also be on the web,",
    "start": "31380",
    "end": "36500"
  },
  {
    "text": "but you're allowed to bring a one-page, um, of written notes, um, aside from that everything is closed book. Yeah.",
    "start": "36500",
    "end": "43130"
  },
  {
    "text": "Is it okay to type said notes [NOISE] or it has to be handwritten? I think we've already issued a policy on that,",
    "start": "43130",
    "end": "48900"
  },
  {
    "text": "Let me just double-check and see what it is. Okay. [BACKGROUND]",
    "start": "48900",
    "end": "56820"
  },
  {
    "text": "All right. Okay. Lets go ahead and get started. Um, before we do that, I just want to say thank you to all of you that, ah,",
    "start": "56820",
    "end": "62960"
  },
  {
    "text": "participated in the class feedback survey. It's really helpful to me and to everybody else to understand what's helping you learn and what's not helping you learn.",
    "start": "62960",
    "end": "70380"
  },
  {
    "text": "Okay. So in terms of, um, the responses, so note, you know, all of these things there's about 230 people registered in the class.",
    "start": "70910",
    "end": "79220"
  },
  {
    "text": "Um, so for some of you if you didn't give me feedback, it's hard for me to know what- what's helping you or not helping you learn. So we're just gonna go with what people gave us feedback on.",
    "start": "79220",
    "end": "87005"
  },
  {
    "start": "82000",
    "end": "323000"
  },
  {
    "text": "Um, about 65% of you thought it's the right pace, about 27% of you thought it's going too fast,",
    "start": "87005",
    "end": "93600"
  },
  {
    "text": "and there's only about 8% of people that think it's going too slowly. Um, so we're gonna keep roughly in the same pace as what we've had before.",
    "start": "93600",
    "end": "102095"
  },
  {
    "text": "Um, a number of people noted that they wished it was like a semester-long course. Um, I will mention there's a number of other classes that",
    "start": "102095",
    "end": "109250"
  },
  {
    "text": "do reinforcement learning and I highly encourage you to take them. I- I offer an advanced class, and also Ben Van Roy offers a class normally in the spring that's more theoretical.",
    "start": "109250",
    "end": "118420"
  },
  {
    "text": "This was super controversial. I didn't think it would be this split. Um, so we offer sessions on Thursday and Friday.",
    "start": "118420",
    "end": "124880"
  },
  {
    "text": "Attendance has been really low. Um, I think we've had around like, three to seven people showing up for these sessions.",
    "start": "124880",
    "end": "131575"
  },
  {
    "text": "Um, so we thought this was gonna be something that everybody wanted to take out. Because it's about evenly split,",
    "start": "131575",
    "end": "137210"
  },
  {
    "text": "I asked all the TAs to compare that people that are coming to their office hours versus the people that are coming to the sessions.",
    "start": "137210",
    "end": "143165"
  },
  {
    "text": "Um, we probably have about 4 to 5x people trying to go to office hours than trying to go to sessions.",
    "start": "143165",
    "end": "149194"
  },
  {
    "text": "So we're going to switch this to office hours. Just so that we can kind of, serve as many people as we can.",
    "start": "149195",
    "end": "155655"
  },
  {
    "text": "Um, so let me just write that there. So we're gonna switch to office hours.",
    "start": "155655",
    "end": "161255"
  },
  {
    "text": "Now, the sessions will still be offered on the other days, and they'll still be recorded. So for anybody who wanted to go to them on Thursday and Friday, you can still go,",
    "start": "161255",
    "end": "169444"
  },
  {
    "text": "you can still participate on Zoom or you can watch the recorded lecture. Um, but we're gonna switch this to office hours",
    "start": "169445",
    "end": "175250"
  },
  {
    "text": "because my TAs have been saying they've had a number of office hours where they've either had to stay really late or they feel like they're not getting to some people.",
    "start": "175250",
    "end": "182090"
  },
  {
    "text": "And so again, just in terms of serving the most people. I will say when I was going through these responses,",
    "start": "182090",
    "end": "188330"
  },
  {
    "text": "it really made me think about the fact that in reinforcement learning and sort of sequential decision making in general, um, we're always optimizing for expected rewards [LAUGHTER]",
    "start": "188330",
    "end": "196070"
  },
  {
    "text": "And so that's kind of exactly the same thing we're doing here is that, I know that everybody needs slightly different things,",
    "start": "196070",
    "end": "201770"
  },
  {
    "text": "and we're just trying to do our best job and expectation. Um, but it's exactly why things like intelligent tutoring systems and other stuff might be better.",
    "start": "201770",
    "end": "209255"
  },
  {
    "text": "Um, okay. In terms of things that people thought were working well for them, we've got a number of positive remarks about",
    "start": "209255",
    "end": "216410"
  },
  {
    "text": "doing worked examples in class, doing derivations. Um, a lot of people really like the fact that my iPad had problems on Monday,",
    "start": "216410",
    "end": "223800"
  },
  {
    "text": "um, and so we did things on the board. So we'll try to keep doing the same amount or more of derivations.",
    "start": "223800",
    "end": "230420"
  },
  {
    "text": "Um, people also were generally really positive about the homeworks. In terms of things, er,",
    "start": "230420",
    "end": "236174"
  },
  {
    "text": "we saw repeatedly, so- so what I did is I got, I just co- collated, sort of all the free responses and tried to look for common themes.",
    "start": "236175",
    "end": "243020"
  },
  {
    "text": "And anything that came up, you know, three or five times or more, I considered was a common issue that people would love addressed.",
    "start": "243020",
    "end": "249995"
  },
  {
    "text": "Um, people would love even more focused on the big picture explaining, um, as well as connecting from the toy examples to real-world examples.",
    "start": "249995",
    "end": "257299"
  },
  {
    "text": "So we'll try to do that where we can. Um, I'll also try to make sure that I'm speaking loudly throughout.",
    "start": "257300",
    "end": "262850"
  },
  {
    "text": "Several people said that sometimes it was occasionally hard to hear, so I'll try to do a better job on that.",
    "start": "262850",
    "end": "268009"
  },
  {
    "text": "If you can't hear me in the back please feel free to raise your hand. Um, and people would like even more examples, um, worked examples.",
    "start": "268010",
    "end": "274900"
  },
  {
    "text": "And so in particular, we're going to try to make sure that in sessions, we emphasize worked examples even more.",
    "start": "274900",
    "end": "281790"
  },
  {
    "text": "And let me just say again, if this was not one of the things that you were most concerned about,",
    "start": "284240",
    "end": "289250"
  },
  {
    "text": "I'm sorry, we can't address all of them this term. Um, er, we definitely and it was kind of amusing to go through this,",
    "start": "289250",
    "end": "294889"
  },
  {
    "text": "would have people saying exactly opposite things. Sometimes right in a row, um, in terms of how it was collated about things like,",
    "start": "294890",
    "end": "301190"
  },
  {
    "text": "some people don't like the fact that the slides have gaps and I do derivations in class. And a number of other people really like that I do derivations in class.",
    "start": "301190",
    "end": "309410"
  },
  {
    "text": "Um, some people felt like it was moving too slowly, other people said it was moving way too fast. Um, so again, we're just gonna try to do the best job we can to address",
    "start": "309410",
    "end": "317180"
  },
  {
    "text": "everybody's needs. All right. So today we're going to continue talking about policy search,",
    "start": "317180",
    "end": "323390"
  },
  {
    "start": "323000",
    "end": "380000"
  },
  {
    "text": "which as I said before, is probably the most important reinforcement learning thing you'll learn this term. [LAUGHTER]",
    "start": "323390",
    "end": "330259"
  },
  {
    "text": "Um, I think this is used really very widely right now, um, in order to optimize functions.",
    "start": "330260",
    "end": "336035"
  },
  {
    "text": "And we can again think of policy search here as a lot of things are gonna sound similar to",
    "start": "336035",
    "end": "341120"
  },
  {
    "text": "when we were doing value function approximation. And what we're thinking about here is having a parameterized policy.",
    "start": "341120",
    "end": "346925"
  },
  {
    "text": "Often we're going to use theta to parameterize It, but we could use W or anything else. But we have a policy that's parameterized.",
    "start": "346925",
    "end": "353750"
  },
  {
    "text": "Um, and then we have some value of that policy. And what we're going to want to be doing, is trying to find, you know,",
    "start": "353750",
    "end": "360255"
  },
  {
    "text": "a good optima, trying to maximize the value, um, of that policy.",
    "start": "360255",
    "end": "365900"
  },
  {
    "text": "And one of the reasons why we did this right after imitation learning was to connect it with the idea of, um,",
    "start": "365900",
    "end": "370950"
  },
  {
    "text": "you have to choose a policy class, a way to specify that parameterization.",
    "start": "370950",
    "end": "376040"
  },
  {
    "text": "And so because of that inherently, it's a place to put in structure. Okay. So just as a recap,",
    "start": "376040",
    "end": "382975"
  },
  {
    "start": "380000",
    "end": "413000"
  },
  {
    "text": "I mentioned that we've done a lot of work so far, on model-free value-based methods. We're starting to do work on direct policy search methods now.",
    "start": "382975",
    "end": "390425"
  },
  {
    "text": "Um, and today we'll also start to talk more about Actor-Critic methods, where we maintain both. We maintain both an explicit parameterized policy",
    "start": "390425",
    "end": "398045"
  },
  {
    "text": "and an explicit parameterized value function. And also throughout all of, you know,",
    "start": "398045",
    "end": "403520"
  },
  {
    "text": "the last couple of weeks including yesterday or Monday and today, we're mostly going to be talking about cases where we want to",
    "start": "403520",
    "end": "409220"
  },
  {
    "text": "be able to work in really really large state spaces. So I'm just gonna do a brief refresher of last time.",
    "start": "409220",
    "end": "416330"
  },
  {
    "start": "413000",
    "end": "465000"
  },
  {
    "text": "Why do we want to do this? Well, we're going to generally be able to guarantee that we converge to a local optima.",
    "start": "416330",
    "end": "421400"
  },
  {
    "text": "We don't always have those guarantees for value function based methods. Um, er, and that might be important.",
    "start": "421400",
    "end": "428270"
  },
  {
    "text": "Er, it's a nice property to have. Um, the downside is that, if you use policy gradient methods,",
    "start": "428270",
    "end": "434510"
  },
  {
    "text": "typically we only converge to a local optima. The last time I showed you the exoskeleton example,",
    "start": "434510",
    "end": "439580"
  },
  {
    "text": "where they are using a global optima approach. So there are other ones which can policy based RL",
    "start": "439580",
    "end": "446120"
  },
  {
    "text": "isn't inherently always going to get you to a local solution, but the gradient based methods typically will.",
    "start": "446120",
    "end": "451775"
  },
  {
    "text": "And the other issue that we were talking about, uh, um, as ways to try to address this is, um,",
    "start": "451775",
    "end": "457319"
  },
  {
    "text": "or- or as tools to address the fact that evaluating a policy itself might be rather inefficient, and high-variance.",
    "start": "457320",
    "end": "464010"
  },
  {
    "text": "So what we are defining before is a policy gradient where, um, now, er,",
    "start": "465290",
    "end": "471575"
  },
  {
    "text": "before we'd sort of thought about these things being parameterized by a theta, so we can either think of the value being, uh,",
    "start": "471575",
    "end": "477295"
  },
  {
    "text": "the policy being parameterized by a theta or pi of theta means parameterized. But we're often going to talk about value functions because ultimately,",
    "start": "477295",
    "end": "485365"
  },
  {
    "text": "the value function depends on the policy and the policy depends on the parameters.",
    "start": "485365",
    "end": "489949"
  },
  {
    "start": "491000",
    "end": "1654000"
  },
  {
    "text": "And when we think about what we want out of these algorithms, typically what we'd really like is to try to converge to a really good local optima.",
    "start": "491640",
    "end": "499340"
  },
  {
    "text": "Often we don't have very much control over that. Um, but the things we often do have control over is things",
    "start": "499340",
    "end": "504730"
  },
  {
    "text": "like how quickly we converge to that local optima. Um, and so we want to use sort of go as quickly as we can down that gradient,",
    "start": "504730",
    "end": "512839"
  },
  {
    "text": "if we're doing a gradient-based method, um, and use our data as well as we can.",
    "start": "512840",
    "end": "517980"
  },
  {
    "text": "So one of the things we're gonna talk more about today, is when we're doing this sort of policy gradient technique.",
    "start": "520300",
    "end": "527975"
  },
  {
    "text": "So we're going to be sort of moving down. Now, we're gonna have our gradient.",
    "start": "527975",
    "end": "533120"
  },
  {
    "text": "We're gonna have our functions. This is B pi, and this is our parameterized pi. And as we're moving down towards some local gradient,",
    "start": "533120",
    "end": "543784"
  },
  {
    "text": "um, it would be nice if when we update our policy, that it is monotonically improving.",
    "start": "543784",
    "end": "551404"
  },
  {
    "text": "So can anybody give me a reason why we might want monotonic improvement? Yeah.",
    "start": "551405",
    "end": "557440"
  },
  {
    "text": "To help guarantee convergence. Answer is right. Can help guarantee convergence absolutely.",
    "start": "557440",
    "end": "562760"
  },
  {
    "text": "And while I love math as much as many of you, um, that- that is a great reason. But perhaps, I was also thinking of like",
    "start": "562760",
    "end": "567830"
  },
  {
    "text": "an empirical reason why we might want that as well. Yeah, in the back.",
    "start": "567830",
    "end": "571620"
  },
  {
    "text": "[inaudible] like in a high-stakes situation. So what we've seen before in fact, um, one of my students, ah,",
    "start": "576270",
    "end": "583060"
  },
  {
    "text": "[inaudible] was giving a practice job talk yesterday, and he was showing this graph for DQN,",
    "start": "583060",
    "end": "588490"
  },
  {
    "text": "which looks something like this. Where this is, like, the performance,",
    "start": "588490",
    "end": "594280"
  },
  {
    "text": "this is the reward, and this is time.",
    "start": "594280",
    "end": "598190"
  },
  {
    "text": "Of course, it doesn't always look like this. And typically when you go to- um, when you read papers, people smooth over many,",
    "start": "600090",
    "end": "606430"
  },
  {
    "text": "many runs, but often it looks something like that. That as you're going across multiple episodes or across multiple time steps, like,",
    "start": "606430",
    "end": "612670"
  },
  {
    "text": "you're really getting a very jagged up and down performance of your- of your val- of the policy that you're running as you do DQN.",
    "start": "612670",
    "end": "620415"
  },
  {
    "text": "So why might that not be good in, like, a high-stakes situation. Yeah, over there. And name first, please.",
    "start": "620415",
    "end": "626680"
  },
  {
    "text": "If, like, it's something high-stakes and you have something good and then it goes down, people are going to be upset with you that now it's done something worse,",
    "start": "626790",
    "end": "634900"
  },
  {
    "text": "even if it will later go back up. Yeah, what was said is that if the system is a high-stakes scenario,",
    "start": "634900",
    "end": "640390"
  },
  {
    "text": "um, if you do- you know, if your policy works pretty well and then the next one, next episode, it works really badly,",
    "start": "640390",
    "end": "646045"
  },
  {
    "text": "even if it might go up later, um, you know, your boss still might fire you [LAUGHTER]. I mean, I'm joking, but I think that people are often",
    "start": "646045",
    "end": "652810"
  },
  {
    "text": "loss averse and also it's often not tolerable, um, in- it might not be okay, you know,",
    "start": "652810",
    "end": "658120"
  },
  {
    "text": "in a company to say, well, this quarter we did really well and next quarter we're going to do, you know, worse, but then eventually, you know,",
    "start": "658120",
    "end": "663580"
  },
  {
    "text": "after many, ah, quarters we're going to do well. Like we often may wanna ensure that we're sort of monotonically going up.",
    "start": "663580",
    "end": "669295"
  },
  {
    "text": "Um, and in the case of something like patient treatment or other sorts of high-stakes scenarios or airplanes or stuff like that,",
    "start": "669295",
    "end": "675384"
  },
  {
    "text": "um, it just probably will not be tolerable to people, if you say we're- we're going to do much worse for this period of time.",
    "start": "675385",
    "end": "681220"
  },
  {
    "text": "Ah, no- now there are exceptions to all of this, but I think there are many cases, where you'd really like monotonic improvement,",
    "start": "681220",
    "end": "686710"
  },
  {
    "text": "i- if you can. Ah, so I think it's a really- in addition to the theoretical, ah, benefits, ah, it can help us prove things.",
    "start": "686710",
    "end": "692920"
  },
  {
    "text": "Ah, it also can just be, um, something that's sort of appealing for people to be actually be able to deploy.",
    "start": "692920",
    "end": "698740"
  },
  {
    "text": "And we know that in general that people are very risk- like, very loss averse. So having policies that are monotonically improving, um,",
    "start": "698740",
    "end": "706210"
  },
  {
    "text": "can be very nice and DQN and a lot of the value based methods do not have those guarantees. Um, we can talk more also about whether that's always possible,",
    "start": "706210",
    "end": "714985"
  },
  {
    "text": "um, in terms of if you wanted to get to a global optima. Yes. Just to be clear, the monotonic improvement in these cases",
    "start": "714985",
    "end": "722440"
  },
  {
    "text": "are data that you have access to or have seen, right? So technically like if there's a distribution in terms of",
    "start": "722440",
    "end": "728200"
  },
  {
    "text": "your life environment where it may differ somewhat from your actual simulation or,",
    "start": "728200",
    "end": "734005"
  },
  {
    "text": "ah, environment, you may not necessarily quantify or improve it, given all that secret data. Is that right? Yeah, which is to say,",
    "start": "734005",
    "end": "741135"
  },
  {
    "text": "when we're gonna be- what's- you know, what is this monotonic improvement? What are the conditions under which this will be guaranteed or possible?",
    "start": "741135",
    "end": "746774"
  },
  {
    "text": "And are we sort of doing this based on our previous data and making some assumptions about the future da- future data that's collected.",
    "start": "746775",
    "end": "752720"
  },
  {
    "text": "Absolutely. We're gonna assume that we're still on the same decision process and that it's stationary. And what I mean by that is that the transition model and",
    "start": "752720",
    "end": "759100"
  },
  {
    "text": "the reward model is the same across- you know, you might not have observed all the states yet, but it's the same across episodes.",
    "start": "759100",
    "end": "765325"
  },
  {
    "text": "So we're not dealing with the fact that, you know, um, customer preferences have totally changed or,",
    "start": "765325",
    "end": "770785"
  },
  {
    "text": "um, you know, climate change is changing your environment. We are dealing with the fact that if the world is stationary,",
    "start": "770785",
    "end": "777130"
  },
  {
    "text": "that then we're going to be guaranteed to have monotonic improvement. Now the other thing that I'm going to show you that in some cases we can guarantee that.",
    "start": "777130",
    "end": "784285"
  },
  {
    "text": "Um, the other really important thing to know is, this is going to- we're going to hope to show monotonic improvement in expectation.",
    "start": "784285",
    "end": "791485"
  },
  {
    "text": "So- so the value function has expected reward. So what we're going to be able to hope to say is the series of policies that we're deploying in",
    "start": "791485",
    "end": "798160"
  },
  {
    "text": "the environment that their value function is going up. So what does that mean? That means that V_Pi1 we would like that to be less than or equal",
    "start": "798160",
    "end": "806800"
  },
  {
    "text": "to V_Pi2 less than or equal to V_Pi3 dot-dot-dot, where this is, sort of, um,",
    "start": "806800",
    "end": "812980"
  },
  {
    "text": "the policy we deploy on each iteration or each round.",
    "start": "812980",
    "end": "821269"
  },
  {
    "text": "Ah, but it doesn't guarantee that for a single run this policy is better.",
    "start": "825240",
    "end": "831625"
  },
  {
    "text": "So you could easily have it that it on average you're deploying a policy that is better,",
    "start": "831625",
    "end": "836695"
  },
  {
    "text": "you know, for your airplanes or for patient treatment, et cetera, but for individual patients that might be worse. A- and I think a really interesting active area of research right now is,",
    "start": "836695",
    "end": "846190"
  },
  {
    "text": "um, safe reinforcement learning, um, and safe exploration. And a lot of different people are thinking about this,",
    "start": "846190",
    "end": "851904"
  },
  {
    "text": "um, including a number of people here at Stanford. And one of the things that we're looking at in our group is, how do you really efficiently get to a safe solution?",
    "start": "851905",
    "end": "858820"
  },
  {
    "text": "What do you mean by safe in this case? I mean you might not want to max- maximize expected reward. You might want to be able to maximize,",
    "start": "858820",
    "end": "865210"
  },
  {
    "text": "um, some sort of risk averse criteria. And we'd like to figure out ways to really efficiently get to that solution.",
    "start": "865210",
    "end": "870715"
  },
  {
    "text": "But there's lots of really interesting stuff that says, you know, how do we try to do policy search? Or how do we do this improvement in cases",
    "start": "870715",
    "end": "876910"
  },
  {
    "text": "where we don't just care about expected outcomes? All right. So what we're gonna be trying to do today is move towards,",
    "start": "876910",
    "end": "884580"
  },
  {
    "text": "sort of, ideally, not just monotonic improvements, but large monotonic improvements. Um, as you might guess,",
    "start": "884580",
    "end": "889995"
  },
  {
    "text": "it is easier to try to achieve small monotonic improvements than it would be to guarantee really large monotonic improvements.",
    "start": "889995",
    "end": "896970"
  },
  {
    "text": "Um, does anybody have any intuition for why that would be true?",
    "start": "896970",
    "end": "900730"
  },
  {
    "text": "That might be harder. Um, this kind of goes back to the state distributions.",
    "start": "902290",
    "end": "908440"
  },
  {
    "text": "So if you change your policy a lot, um, does the state- can the state",
    "start": "908440",
    "end": "914290"
  },
  {
    "text": "distribution change a lot in terms of the states you visit? So- so intuitively that should- the answer should be yes.",
    "start": "914290",
    "end": "922630"
  },
  {
    "text": "So we've talked some about how any policy induces, um, a state distribution, like if you run it for a long time",
    "start": "922630",
    "end": "928690"
  },
  {
    "text": "you're going to have sort of a stationary distribution over states. Um, and if your policy is really different than your old policy,",
    "start": "928690",
    "end": "935605"
  },
  {
    "text": "then that state distribution might look really different, which means you might not have very much data. Um, whereas if you have almost exactly the same policy as before,",
    "start": "935605",
    "end": "944815"
  },
  {
    "text": "um, you're probably going to be able to have a really good notion of what that value is in the estimate. But we'll get more into that later.",
    "start": "944815",
    "end": "950785"
  },
  {
    "text": "So what we're going do today is to try to think about moving beyond what we were talking about last time, where we're trying to do policy gradient methods.",
    "start": "950785",
    "end": "956980"
  },
  {
    "text": "And we're trying to do it in a way that was sort of efficient. We're going to talk about other ways to make it more efficient,",
    "start": "956980",
    "end": "962845"
  },
  {
    "text": "ah, and less noisy, and then try to go towards monotonic improvement.",
    "start": "962845",
    "end": "967189"
  },
  {
    "text": "All right. So that things that we talked about last time, is we started off when we said what can we do in terms of policy gradient?",
    "start": "968160",
    "end": "974320"
  },
  {
    "text": "One thing we could do is, kind of, you do Monte Carlo returns. So these are Monte Carlo returns.",
    "start": "974320",
    "end": "981319"
  },
  {
    "text": "And sometimes people use big R of Tau, where Tau, this is a trajectory.",
    "start": "982590",
    "end": "988640"
  },
  {
    "text": "So you could just run out your policy till the world terminates or each steps or however you're defining your episodes,",
    "start": "989430",
    "end": "997089"
  },
  {
    "text": "um, and then look at the reward and you'll look at their reward across, you know, per time step. We can also use, um,",
    "start": "997090",
    "end": "1005260"
  },
  {
    "text": "G_i_t to denote the reward we get from time-step t and- and in Episode i.",
    "start": "1005450",
    "end": "1011520"
  },
  {
    "text": "And what we've said before is that, um, this is an unbiased estimate of the gradient, but it's really noisy.",
    "start": "1011520",
    "end": "1017505"
  },
  {
    "text": "And so we started talking about additional structure we could use in the reinforcement learning problem, where we were assuming the world is Markov,",
    "start": "1017505",
    "end": "1024360"
  },
  {
    "text": "um, to try to reduce the variance of this estimate. And so what we talked about last time was using temporal structure,",
    "start": "1024360",
    "end": "1031740"
  },
  {
    "text": "which we did some on the board. And the intuition there was the reward you get at some time point,",
    "start": "1031740",
    "end": "1037935"
  },
  {
    "text": "um, uh, can be- is not influenced by the later decisions you make.",
    "start": "1037935",
    "end": "1042944"
  },
  {
    "text": "So you didn't have to take kind of this complete product of the probability of action given the states,",
    "start": "1042945",
    "end": "1048735"
  },
  {
    "text": "because future actions don't retroactively change our earlier rewards for intuition.",
    "start": "1048735",
    "end": "1055080"
  },
  {
    "text": "So what we're going to start talking about now is, um, other things, which is baselines and alternatives to Monte Carlo. Okay.",
    "start": "1055080",
    "end": "1064019"
  },
  {
    "text": "So what's the baseline? Well, a baseline is as let's still think about looking at, um, the sum of rewards we get from this time-step onwards.",
    "start": "1064020",
    "end": "1071295"
  },
  {
    "text": "So this is the same thing that we've often called GT. So this is the reward we get from this time-step till the end of the episode.",
    "start": "1071295",
    "end": "1080250"
  },
  {
    "text": "And we're gonna subtract a baseline that depends on the state. And what I'm going to show shortly is that by",
    "start": "1080250",
    "end": "1088200"
  },
  {
    "text": "subtracting this baseline which depends only on the state, your resulting gradient estimator can still be unbiased,",
    "start": "1088200",
    "end": "1094125"
  },
  {
    "text": "but it might not, have much lower variance. And in particular often a really good choice is the expected return,",
    "start": "1094125",
    "end": "1099960"
  },
  {
    "text": "which is basically the value function. And so why would we do this? We'll then we can kind of look at we- increasing the log probability of an action,",
    "start": "1099960",
    "end": "1108795"
  },
  {
    "text": "proportional to how much better it is than a baseline. Which in general is going to end up being sort of a",
    "start": "1108795",
    "end": "1115860"
  },
  {
    "text": "little bit like an advantage function. So why is this true? Okay. So, um, what are we going to try to do here?",
    "start": "1115860",
    "end": "1124080"
  },
  {
    "text": "We're gonna say we have this high-variance estimate right now. If we don't have, so imagine we didn't have this, we don't have that.",
    "start": "1124080",
    "end": "1130995"
  },
  {
    "text": "We have our, the standard estimate we were talking about last time. And what I want to convince you is that if we",
    "start": "1130995",
    "end": "1136500"
  },
  {
    "text": "subtract off this thing which is a function of the state, that an expectation that additional term we're subtracting off is zero.",
    "start": "1136500",
    "end": "1143804"
  },
  {
    "text": "Meaning that our estimator is still unbiased. So I said our original estimator is unbiased.",
    "start": "1143805",
    "end": "1150165"
  },
  {
    "text": "We're subtracting off this weird thing, we want to show that the resulting estimator is still unbiased. And the way we do that is by showing there's,",
    "start": "1150165",
    "end": "1157155"
  },
  {
    "text": "the goal is to show, [NOISE] that this is equal to zero.",
    "start": "1157155",
    "end": "1165159"
  },
  {
    "text": "So that's what we're gonna try and do, and if we can show that then that's gonna justify why we can subtract this random thing.",
    "start": "1165470",
    "end": "1172080"
  },
  {
    "text": "And then we can start to talk about what that random thing should be. But first, we're just going to show no matter what that random thing is. If it's a function only of the state,",
    "start": "1172080",
    "end": "1178605"
  },
  {
    "text": "that this, um, expectation is 0. So how do we do this? Well, first of all noted on the outside there's an expectation over tau.",
    "start": "1178605",
    "end": "1187125"
  },
  {
    "text": "That is all the trajectories we might encounter by running our current policy. Okay. So what I'm gonna do first is I'm just going to split it into two parts.",
    "start": "1187125",
    "end": "1195870"
  },
  {
    "text": "So this is still tau. And all I've done here is I've split it into the first part which is all the way up to time step t,",
    "start": "1195870",
    "end": "1204180"
  },
  {
    "text": "and the second part which is on time step, um, t, all the way to the end. So I've just sort of decomposed, that,",
    "start": "1204180",
    "end": "1211514"
  },
  {
    "text": "I-I I've just written out what, um, ah, a trajectory is, and then decomposed into two parts. So I'm just decomposing the trajectory.",
    "start": "1211515",
    "end": "1217650"
  },
  {
    "text": "[NOISE] And once we do that, then we can see that the baseline term is only a function of S_t.",
    "start": "1217650",
    "end": "1226679"
  },
  {
    "text": "[NOISE] So we can pull it out of this inner term.",
    "start": "1226680",
    "end": "1230410"
  },
  {
    "text": "Right. So we're gonna pull this out because it doesn't depend on any of these future time steps.",
    "start": "1233660",
    "end": "1240434"
  },
  {
    "text": "It's independent of those. [BACKGROUND]",
    "start": "1240435",
    "end": "1252840"
  },
  {
    "text": "Okay. Then the next thing we're gonna do is we're going to,",
    "start": "1252840",
    "end": "1257985"
  },
  {
    "text": "uh, write out or note the fact that in this case. That all we have in this inner term here is S_t and a_t.",
    "start": "1257985",
    "end": "1267885"
  },
  {
    "text": "So we can drop all the future terms. Again that's sort of the prob- the the only thing in",
    "start": "1267885",
    "end": "1274020"
  },
  {
    "text": "here is the probability of the action a_time-step t, given the state t and theta. So we don't need to worry about the future states or the future actions that are taken,",
    "start": "1274020",
    "end": "1282630"
  },
  {
    "text": "um, we- we're independent of those. So now, so we just pull it up, first we pulled out baseline.",
    "start": "1282630",
    "end": "1288880"
  },
  {
    "text": "And now, we're going to drop those things that we don't need to depend on. [NOISE]",
    "start": "1289820",
    "end": "1298169"
  },
  {
    "text": "So all we have here is an expectation over the action that's taken.",
    "start": "1298170",
    "end": "1302440"
  },
  {
    "text": "Okay. And now what I'm gonna do is I'm going to read it, so what is this expectation?",
    "start": "1306980",
    "end": "1312900"
  },
  {
    "text": "It's an expectation over a_t. What is the problem, you know, what is that expectation? We're just going to write that out explicitly,",
    "start": "1312900",
    "end": "1318915"
  },
  {
    "text": "that depends on the policy that we have.",
    "start": "1318915",
    "end": "1321970"
  },
  {
    "text": "So we're going to sum over a_t, the probability of that a_t,",
    "start": "1325700",
    "end": "1331320"
  },
  {
    "text": "which of course just depends on the policy that we're following, times the derivative of log.",
    "start": "1331320",
    "end": "1338049"
  },
  {
    "text": "So that is me writing out the expectation, and I'm gonna take the derivative of the log.",
    "start": "1342290",
    "end": "1347730"
  },
  {
    "text": "[NOISE]",
    "start": "1347730",
    "end": "1365610"
  },
  {
    "text": "So that's just gonna be the derivative with respect to the policy itself.",
    "start": "1365610",
    "end": "1370210"
  },
  {
    "text": "Divided by pi of a_t, s t theta.",
    "start": "1371890",
    "end": "1378575"
  },
  {
    "text": "Okay. But now we note that there's a term on the numerator and a term on the,",
    "start": "1378575",
    "end": "1383764"
  },
  {
    "text": "denominator that we can cancel. So this starts to simplify [NOISE] b of S_t times the sum over a_t,",
    "start": "1383765",
    "end": "1395810"
  },
  {
    "text": "just the derivative of the policy.",
    "start": "1395810",
    "end": "1399120"
  },
  {
    "text": "Just canceled numerator and denominator there. And now we note that we can reverse the sum and the derivative.",
    "start": "1401450",
    "end": "1410620"
  },
  {
    "text": "This is the others, that kind of critical step of this proof.",
    "start": "1413510",
    "end": "1418240"
  },
  {
    "text": "So now what we're gonna do here is we're going to move the derivative out. [NOISE] Well, this is just 1,",
    "start": "1418730",
    "end": "1431415"
  },
  {
    "text": "because the probability that we select some action, under our policy always has to be 1.",
    "start": "1431415",
    "end": "1437025"
  },
  {
    "text": "And so now we see that we're just taking the derivative of 1.",
    "start": "1437025",
    "end": "1441400"
  },
  {
    "text": "So we are trying to take the derivative of 1, and of course that's a constant so this is equal to 0.",
    "start": "1445790",
    "end": "1451080"
  },
  {
    "text": "[NOISE] So that's pretty cool. So that means that we have added in this baseline.",
    "start": "1451080",
    "end": "1457530"
  },
  {
    "text": "That is some function that depends on the state, and we haven't said we told me, you know, we haven't talked about all the different ways we",
    "start": "1457530",
    "end": "1463679"
  },
  {
    "text": "could compute that gap or we say it doesn't matter what it is. No matter what you added there it's always unbiased.",
    "start": "1463680",
    "end": "1471120"
  },
  {
    "text": "So just to check our understanding for a second if we go back to this equation,",
    "start": "1471120",
    "end": "1476940"
  },
  {
    "text": "if I set b of S_t, to be a constant everywhere,",
    "start": "1476940",
    "end": "1483450"
  },
  {
    "text": "is the gradient estimator still unbiased. [NOISE]",
    "start": "1483450",
    "end": "1494700"
  },
  {
    "text": "Just take like one minute and talk to your neighbor, and say, so based on what I just said if b of S_t is equal to a constant,",
    "start": "1494700",
    "end": "1502095"
  },
  {
    "text": "this is like a constant, for all S_t is the gradient estimator unbiased,",
    "start": "1502095",
    "end": "1515339"
  },
  {
    "text": "just take like one second or one minute and talk to your neighbor. [BACKGROUND]",
    "start": "1515339",
    "end": "1566735"
  },
  {
    "text": "All right. So let's start with, um, everybody here thinks it's still unbiased, vote? Yes. Great. Okay, yes.",
    "start": "1566735",
    "end": "1573500"
  },
  {
    "text": "It has to still be unbiased, now it's a function not even of s, just a constant. And so it's definitely a function of an s,",
    "start": "1573500",
    "end": "1579410"
  },
  {
    "text": "it's a tri- trivial function where it doesn't matter what the value of s is, and so it's still unbiased.",
    "start": "1579410",
    "end": "1584790"
  },
  {
    "text": "Just to note here, um, if s was a fu- if, um, the baseline was a function of state and action,",
    "start": "1584890",
    "end": "1592190"
  },
  {
    "text": "do you think this proof would go through? No. No. No. Right. Because one of the things that we did at the very beginning is",
    "start": "1592190",
    "end": "1597350"
  },
  {
    "text": "we moved b of S_t all the way out. And if it depended on the action too, we couldn't have done that.",
    "start": "1597350",
    "end": "1603125"
  },
  {
    "text": "So this is specific to this being only a function of the state. Yes.",
    "start": "1603125",
    "end": "1608750"
  },
  {
    "text": "[inaudible] functions b that do not give you an un-",
    "start": "1608750",
    "end": "1614390"
  },
  {
    "text": "an unbiased estimate state. So I don't know, is there any functions of b? b is only a function of the state, all of them are unbiased.",
    "start": "1614390",
    "end": "1621845"
  },
  {
    "text": "Yeah, so it is always unbiased. There could be really- I mean, just like what I put here, um, you could just put in a constant and it might not reduce your variance at all.",
    "start": "1621845",
    "end": "1630770"
  },
  {
    "text": "So there's certainly unuseful definitions of a baseline, um, but all of them are unbiased. So they're not gonna affect, ah,",
    "start": "1630770",
    "end": "1637115"
  },
  {
    "text": "whether or not your estimator is unbiased. They could make your estimator potentially worse if they're really bad,",
    "start": "1637115",
    "end": "1642385"
  },
  {
    "text": "um, or [NOISE] they're really themselves, um, very bad estimators potentially, um, and they certainly couldn't make it better [NOISE] by choosing good choices.",
    "start": "1642385",
    "end": "1651960"
  },
  {
    "text": "Okay. All right. So this ends up allowing us",
    "start": "1651960",
    "end": "1657679"
  },
  {
    "start": "1654000",
    "end": "2070000"
  },
  {
    "text": "to define what's sort of known as the vanilla policy gradient algorithm. Um, so vanilla policy gradient operates by,",
    "start": "1657680",
    "end": "1664505"
  },
  {
    "text": "we collect a bunch of trajectories using our current policy. And then for each time step inside of the trajectory we",
    "start": "1664505",
    "end": "1670070"
  },
  {
    "text": "compute the return from that time step to the end. Um, and then we compute the advantage estimate.",
    "start": "1670070",
    "end": "1676174"
  },
  {
    "text": "So, all right, we'll write out vanilla policy gradient. [NOISE] Okay.",
    "start": "1676175",
    "end": "1687440"
  },
  {
    "text": "So vanilla policy gradient works as follows. You start up, you initialize the policy with",
    "start": "1687440",
    "end": "1692600"
  },
  {
    "text": "some parameter theta and you need to start with some estimate of the baseline. Okay. So what happens with vanilla policy gradient,",
    "start": "1692600",
    "end": "1699770"
  },
  {
    "text": "is for iterations i = 1, 2 dot, dot, dot. We're gonna collect a set of trajectories using your current policy.",
    "start": "1699770",
    "end": "1714120"
  },
  {
    "text": "And then for each time step, for t = 1 dot,",
    "start": "1715900",
    "end": "1722000"
  },
  {
    "text": "dot, dot, the length of your trajectory i, then you do two things.",
    "start": "1722000",
    "end": "1727159"
  },
  {
    "text": "You compute the return, which is just equal to the sum of all the returns till the end of the episode.",
    "start": "1727160",
    "end": "1736740"
  },
  {
    "text": "And then you compute the advantage A-hat_i_t,",
    "start": "1737350",
    "end": "1743270"
  },
  {
    "text": "which is just equal to this return. I'll parameterize it with i just to show that that's the i'th trajectory.",
    "start": "1743270",
    "end": "1749659"
  },
  {
    "text": "Um, [NOISE] - b of S_t. So just to note here for a second,",
    "start": "1749660",
    "end": "1757790"
  },
  {
    "text": "um, this is a return of the sum of rewards till the end of the episode.",
    "start": "1757790",
    "end": "1763055"
  },
  {
    "text": "This is a baseline which is like a fixed function. Um, so this could be, you know,",
    "start": "1763055",
    "end": "1769280"
  },
  {
    "text": "a deep neural network, this could be a table lookup. Ah, but this is a function and you input",
    "start": "1769280",
    "end": "1774529"
  },
  {
    "text": "the state at time step t and trajectory i [NOISE] and you output a scalar. So that's what the baseline is doing there.",
    "start": "1774530",
    "end": "1781774"
  },
  {
    "text": "And then wha- um, in vanilla policy gradient we do is, then we refit the baseline.",
    "start": "1781775",
    "end": "1786965"
  },
  {
    "text": "So in this case, the baseline is gonna be an estimate of the average of the Gs [NOISE].",
    "start": "1786965",
    "end": "1794570"
  },
  {
    "text": "So in vanilla policy base, bu- um, vanilla policy gradient. What we do is the next step is,",
    "start": "1794570",
    "end": "1801530"
  },
  {
    "text": "we sum over all the trajectories we've got so far. We just sum over all the time steps.",
    "start": "1801530",
    "end": "1806585"
  },
  {
    "text": "Um, we do basically, just a least squares fit. [NOISE]",
    "start": "1806585",
    "end": "1816230"
  },
  {
    "text": "So note this can be done with like su- this is supervised learning. We just have some a baseline function that can be parameterized [NOISE].",
    "start": "1816230",
    "end": "1824030"
  },
  {
    "text": "I'll make sure to put an i there. So the baseline function that can be parameterized with some totally other weights or parameters,",
    "start": "1824030",
    "end": "1830630"
  },
  {
    "text": "um, and then we have our returns g that we've seen so far and we just try to minimize that distance.",
    "start": "1830630",
    "end": "1835715"
  },
  {
    "text": "And so then the baseline is really, er, representing the expected sum of rewards. Um, note that this is in some ways a little bit funny, right?",
    "start": "1835715",
    "end": "1844130"
  },
  {
    "text": "Because we're using all of our data that we've ever seen. So this can either be done over, um,",
    "start": "1844130",
    "end": "1850835"
  },
  {
    "text": "all the data you you've ever, ever seen or it can be done over just the most recent round. There's lots of choices for how to do the baseline.",
    "start": "1850835",
    "end": "1857645"
  },
  {
    "text": "Um, I- if you use all the data you've ever, ever seen, um, then which is what this would do.",
    "start": "1857645",
    "end": "1865145"
  },
  {
    "text": "Um, then you could be averaging over lots of different policies, because you've got data from different policies.",
    "start": "1865145",
    "end": "1872375"
  },
  {
    "text": "If you just do this over the most recent round, then you're just gonna be getting an estimate of essentially V_Pi i- V_Pi i,",
    "start": "1872375",
    "end": "1880085"
  },
  {
    "text": "like the- the iteration. This is gonna end up approximating. All right.",
    "start": "1880085",
    "end": "1885610"
  },
  {
    "text": "If you ju- are only doing it over, um, the trajectories, if you don't do this,",
    "start": "1885610",
    "end": "1890650"
  },
  {
    "text": "but you sum it over the trajectories for this round. I guess the way I've written this is a little bit unclear.",
    "start": "1890650",
    "end": "1897320"
  },
  {
    "text": "So let me see if I can make that a bit clearer. So let's say that we have a- a- a- we have d trajectories. So if we do it this way,",
    "start": "1897320",
    "end": "1906680"
  },
  {
    "text": "then that's exactly equal to V_Pi i. So i now is the iteration, d is the trajectories we've gathered just on iteration i.",
    "start": "1906680",
    "end": "1914450"
  },
  {
    "text": "So this is only averaging over, um, the policies for this particular- the- the trajectories for this particular policy.",
    "start": "1914450",
    "end": "1922410"
  },
  {
    "text": "I said a lot a bit out of order. Does anybody have any questions about exactly what we're doing in this case?",
    "start": "1924520",
    "end": "1930080"
  },
  {
    "text": "So normally, in this situation there's a number of series of rounds. This is for each- So we're gonna have a series of pi's, basically.",
    "start": "1930080",
    "end": "1939695"
  },
  {
    "text": "And then for each policy, we're gonna have a set of trajectories. And for each trajectory we have a set of time steps.",
    "start": "1939695",
    "end": "1946070"
  },
  {
    "text": "And what this is saying here is average over all the trajectories you have for the current policy,",
    "start": "1946070",
    "end": "1951410"
  },
  {
    "text": "and fit the baseline to that. All right. And then once you have that,",
    "start": "1951410",
    "end": "1956585"
  },
  {
    "text": "so this gives you the baseline. Um, and then we do update the policy using your gradient.",
    "start": "1956585",
    "end": "1968460"
  },
  {
    "text": "And it's gonna be a sum of terms that include these derivatives with respect to",
    "start": "1972610",
    "end": "1978530"
  },
  {
    "text": "the policy and your advantage function.",
    "start": "1978530",
    "end": "1985055"
  },
  {
    "text": "Okay. So you're gonna take in this advantage function that you computed over here.",
    "start": "1985055",
    "end": "1990350"
  },
  {
    "text": "And then you're gonna be multiplying it by what was the probability of the actions given the state and theta.",
    "start": "1990350",
    "end": "1997220"
  },
  {
    "text": "The log derivative of that. And then we plug that,",
    "start": "1997220",
    "end": "2003565"
  },
  {
    "text": "this gr- this estimate of the gradient, into something like stochastic gradient descent or ADAM or something else.",
    "start": "2003565",
    "end": "2014900"
  },
  {
    "text": "So this has been vanilla policy gradient. [NOISE]",
    "start": "2015000",
    "end": "2025565"
  },
  {
    "text": "And what we're going to see during the rest of today is just a number of different slight variants on this basic template.",
    "start": "2025565",
    "end": "2031865"
  },
  {
    "text": "So I'll get to you in just a second, but I just want to emphasize that if you- if you- when you walk away from unders- like from what I'd like you to understand,",
    "start": "2031865",
    "end": "2039320"
  },
  {
    "text": "from the- the main idea for policy gradient, is essentially what's on the board right now. Is that, what we're doing is we are running,",
    "start": "2039320",
    "end": "2046460"
  },
  {
    "text": "we take one policy, we get a bunch of data from it, and then we have to fit something like an advantage,",
    "start": "2046460",
    "end": "2052773"
  },
  {
    "text": "and there's going to be different ways to compute that. We could end up doing bootstrapping, to do some sort of TD estimate,",
    "start": "2052774",
    "end": "2058024"
  },
  {
    "text": "or we can just directly use the returns. We often use a baseline, um, that we're fitting over time.",
    "start": "2058025",
    "end": "2064534"
  },
  {
    "text": "And then we're going to update the policy, and have to choose some step size with respect to the gradient.",
    "start": "2064535",
    "end": "2070865"
  },
  {
    "start": "2070000",
    "end": "2138000"
  },
  {
    "text": "So this is sort of the most important thing. Is to say, hey, there's this basic template for almost all policy gradient algorithms,",
    "start": "2070865",
    "end": "2076610"
  },
  {
    "text": "I can choose different things to kind of plug in here, and I can choose different ways to take my step sizes.",
    "start": "2076610",
    "end": "2082250"
  },
  {
    "text": "Um, and that's going to define a whole bunch of the different policy gradient algorithms that you see.",
    "start": "2082250",
    "end": "2087544"
  },
  {
    "text": "So what function are we using to represent i so that we can take its gradient?",
    "start": "2087545",
    "end": "2093319"
  },
  {
    "text": "Great question. So, um, is asking, you know, how- how do we represent, um, the policy so we can take its gradient.",
    "start": "2093320",
    "end": "2098869"
  },
  {
    "text": "We have to be able to take this here. Um, we talked briefly about this last time, um, but it was also on the board near the end, Gaussians work,",
    "start": "2098870",
    "end": "2106340"
  },
  {
    "text": "Softmaxes both are- are- are- are- both of those you can analytically take the derivative and often we use deep neural networks or shallow deep neural networks.",
    "start": "2106340",
    "end": "2114695"
  },
  {
    "text": "Yes. I saw a question back there? And name first, please. Ah, I was wondering if there's any, ah,",
    "start": "2114695",
    "end": "2121250"
  },
  {
    "text": "issue with like non-states- if we're getting like b of- the baseline with the neural networks, there's like non-stationary issues with that?",
    "start": "2121250",
    "end": "2129710"
  },
  {
    "text": "Yeah, it's a great question. So, ah, the question I believe is to say, um, you're asking me about the baseline, right?",
    "start": "2129710",
    "end": "2135529"
  },
  {
    "text": "So like how- are there non-stationary issues with that? Empirically what a lot of people, including myself,",
    "start": "2135530",
    "end": "2141394"
  },
  {
    "start": "2138000",
    "end": "2173000"
  },
  {
    "text": "have wondered is, um, we have all this other data. So when we're estimating the gradient right now,",
    "start": "2141395",
    "end": "2147890"
  },
  {
    "text": "typically we're running the policy, just you know, for D trajectories and then we're estimating a gradient with that.",
    "start": "2147890",
    "end": "2153125"
  },
  {
    "text": "Um, and could we maybe use other data to do that, but then ends up being off policy,",
    "start": "2153125",
    "end": "2158180"
  },
  {
    "text": "because then you're mixing together data you've gathered from different policies. Empirically, I think people often end up using only the data from the current run,",
    "start": "2158180",
    "end": "2166535"
  },
  {
    "text": "and then you're essentially just estimating V_Pi, with this and you're not necessarily mixing data for many other policies.",
    "start": "2166535",
    "end": "2173315"
  },
  {
    "start": "2173000",
    "end": "2268000"
  },
  {
    "text": "Empirically, it seems like often, it's really helpful to be on policy. A- and you could reweight the old data,",
    "start": "2173315",
    "end": "2179570"
  },
  {
    "text": "ah, but that introduces variance. And so empirically often, it's best. I think the jury is still out on it.",
    "start": "2179570",
    "end": "2185795"
  },
  {
    "text": "There's ongoing research on it. We've looked at it, Sergey Levine's group has looked at it, but most of the time using the on-policy data makes sense.",
    "start": "2185795",
    "end": "2193565"
  },
  {
    "text": "Yeah, is there another question? And name first, please. I just want to confirm, so when you saying refit baseline,",
    "start": "2193565",
    "end": "2198950"
  },
  {
    "text": "we're setting baseline equal to the value that minimizes the function error. [NOISE]",
    "start": "2198950",
    "end": "2204500"
  },
  {
    "text": "Perfect. Yeah, for error, if we do this if we're only averaging over the data points that we have for this current policy,",
    "start": "2204500",
    "end": "2210380"
  },
  {
    "text": "when we do this, it's essentially- it- it's essentially the same as when we were doing Monte Carlo policy evaluation.",
    "start": "2210380",
    "end": "2216470"
  },
  {
    "text": "So this is almost exactly like Monte Carlo policy eval. Where we have a fixed policy and then we have a parameterized function to represent it.",
    "start": "2216470",
    "end": "2226115"
  },
  {
    "text": "Um, and then we just want to fit those parameters so we can best estimate the policy value using Monte Carlo.",
    "start": "2226115",
    "end": "2233790"
  },
  {
    "text": "Okay. So I'm going to- there's a little bit of information about auto diff you can check it in the slides.",
    "start": "2236590",
    "end": "2241790"
  },
  {
    "text": "Um, uh, the things we're going to go through next, um, is thinking about this aspect as I was saying,",
    "start": "2241790",
    "end": "2249980"
  },
  {
    "text": "and then we'll talk some about this. So this part is going to be where we think about monotonic improvement.",
    "start": "2249980",
    "end": "2259280"
  },
  {
    "text": "Because once we have a gradient, we have to figure out how far to go. An- and can we guarantee, um,",
    "start": "2259280",
    "end": "2264545"
  },
  {
    "text": "depending on how far we go, whether or not we're going to get a monotonic improvement. Um, and this part is about sort of giving better estimates of our gradient,",
    "start": "2264545",
    "end": "2272780"
  },
  {
    "start": "2268000",
    "end": "2294000"
  },
  {
    "text": "ideally with less data, um, and reducing the variance of it. So they're both important,",
    "start": "2272780",
    "end": "2277985"
  },
  {
    "text": "they're doing slightly different things. All right. So let's talk about,",
    "start": "2277985",
    "end": "2283220"
  },
  {
    "text": "ah, could we move this up, please? Thank you.",
    "start": "2283220",
    "end": "2289740"
  },
  {
    "text": "Okay. So like we sort of started talking about before, um, well, let's- let's talk about first the baseline.",
    "start": "2292810",
    "end": "2301085"
  },
  {
    "start": "2294000",
    "end": "2358000"
  },
  {
    "text": "So how should we choose the baseline?",
    "start": "2301085",
    "end": "2303780"
  },
  {
    "text": "Um, one thing that we can do for the baseline, is just to- like what that what we're seeing there,",
    "start": "2306610",
    "end": "2313010"
  },
  {
    "text": "which is an empirical estimate of V_Pi i. So we could say, in general, we wanna just have- use V_Pi i as a baseline.",
    "start": "2313010",
    "end": "2321450"
  },
  {
    "text": "That means we have to compute it somehow. And the way we estimate that could be from Monte Carlo",
    "start": "2321450",
    "end": "2327470"
  },
  {
    "text": "or it could be from TD methods. All right. So what we've seen so far,",
    "start": "2327470",
    "end": "2334310"
  },
  {
    "text": "is using these as a- so- so I guess just to be clear here,",
    "start": "2334310",
    "end": "2339590"
  },
  {
    "text": "there's a couple different places we're going to be able to maybe switch between doing Monte Carlo returns and doing something TD-like.",
    "start": "2339590",
    "end": "2345590"
  },
  {
    "text": "One is here, and another is our baseline. Okay. So we have a baseline function here that we're sort of subtracting off.",
    "start": "2345590",
    "end": "2353900"
  },
  {
    "text": "And we also have a G_t prime here, okay? And so if we think about our general equation again,",
    "start": "2353900",
    "end": "2361910"
  },
  {
    "start": "2358000",
    "end": "2432000"
  },
  {
    "text": "so what we have in this case is we have delta theta, v of theta. This is our parameter, this is specifying our policy parameters.",
    "start": "2361910",
    "end": "2369215"
  },
  {
    "text": "And we've said this is approximately equal to 1 over m sum over i = 1 to m of some reward- Well, I'll put this inside.",
    "start": "2369215",
    "end": "2380030"
  },
  {
    "text": "Sum over t = 0 to t - 1, of,- I change my mind.",
    "start": "2380030",
    "end": "2388355"
  },
  {
    "text": "Okay. I'm going to put this out here because it's going to end up being sort of a function we can use in lots of different ways. Okay.",
    "start": "2388355",
    "end": "2394710"
  },
  {
    "text": "So this is our basic equation we've been working with. We've said the derivative of the value with respect to our policy parameter is",
    "start": "2405670",
    "end": "2412700"
  },
  {
    "text": "approximately as sum over m trajectories, where we've sampled those trajectories from that policy,",
    "start": "2412700",
    "end": "2419210"
  },
  {
    "text": "times the total reward we've gotten on that trajectory, times the sum over all time steps of the derivative of the policy with respect to,",
    "start": "2419210",
    "end": "2427910"
  },
  {
    "text": "um- given the action we took in the state we were in. All right. And we said it was very noisy, um, but unbiased.",
    "start": "2427910",
    "end": "2435050"
  },
  {
    "text": "And now we can think of changing this as a target.",
    "start": "2435050",
    "end": "2440135"
  },
  {
    "text": "So this here was an unbiased estimator of the value of the policy. And now we can think about substituting other things in. All right.",
    "start": "2440135",
    "end": "2448220"
  },
  {
    "text": "So we can imagine doing all sorts of things here. We cou- we could do, um, you know,",
    "start": "2448220",
    "end": "2454130"
  },
  {
    "text": "TD or MC methods. If we do it with a value function or if we try to",
    "start": "2454130",
    "end": "2463220"
  },
  {
    "text": "explicitly compute a value function or a- or a state action value function, then we typically call this a critic.",
    "start": "2463220",
    "end": "2469970"
  },
  {
    "text": "So a critic computes V or Q.",
    "start": "2469970",
    "end": "2480290"
  },
  {
    "text": "So when we talk about actor-critic methods, that's when we have an explicit parameterized representation of the policy,",
    "start": "2480290",
    "end": "2485930"
  },
  {
    "text": "and we have an explicit generally parameterized representation of the value or the state-action value.",
    "start": "2485930",
    "end": "2491434"
  },
  {
    "text": "And if we have that, then we can imagine using that to change what our target is.",
    "start": "2491435",
    "end": "2497340"
  },
  {
    "text": "I want to emphasize here that so, actor-critic methods combine these two,",
    "start": "2499150",
    "end": "2504575"
  },
  {
    "text": "combine policy plus critics. And probably the most popular one of this is A3C,",
    "start": "2504575",
    "end": "2511070"
  },
  {
    "text": "which is by Mnich et al, this was introduced in 2016 ICML.",
    "start": "2511070",
    "end": "2518400"
  },
  {
    "text": "And it's been hugely popular. This is a version for deep neural networks. Um, but actor-critic ideas themselves have been around for a lot longer than that.",
    "start": "2518770",
    "end": "2526895"
  },
  {
    "text": "But A3C is one of the most popular versions of this for deep neural nets. All right.",
    "start": "2526895",
    "end": "2532925"
  },
  {
    "start": "2531000",
    "end": "3005000"
  },
  {
    "text": "So how do we do sort of policy gradient formulas with value functions? What you could do instead here, I shall put on this side.",
    "start": "2532925",
    "end": "2543890"
  },
  {
    "text": "What you could do is, you could have almost the same equation as we had before. So derivative with respect to the value function is equal to",
    "start": "2543890",
    "end": "2552860"
  },
  {
    "text": "an expectation with respect to the trajectories that you might encounter,",
    "start": "2552860",
    "end": "2558005"
  },
  {
    "text": "the sum over all the time steps in that trajectory, times the derivative with respect to your policy parameters,",
    "start": "2558005",
    "end": "2572780"
  },
  {
    "text": "times Q of S_t,",
    "start": "2574050",
    "end": "2579085"
  },
  {
    "text": "w - b of S_t. So instead of having your Monte Carlo estimates in here,",
    "start": "2579085",
    "end": "2587330"
  },
  {
    "text": "you could plug in your estimate of the Q function.",
    "start": "2587330",
    "end": "2590460"
  },
  {
    "text": "And another way to represent that here is if we think this is an estimate of the value,",
    "start": "2592560",
    "end": "2600475"
  },
  {
    "text": "and this is basically our advantage function again. But it could be our- so we had an advantage function over here.",
    "start": "2600475",
    "end": "2608125"
  },
  {
    "text": "You define that advantage function here, but this one was a function of the Monte Carlo returns for that episode.",
    "start": "2608125",
    "end": "2614425"
  },
  {
    "text": "This is a different advantage function which is the Q function which- where this could be maintained by a critic,",
    "start": "2614425",
    "end": "2621730"
  },
  {
    "text": "minus your baseline, which is an estimate the value function. So they look pretty similar,",
    "start": "2621730",
    "end": "2628030"
  },
  {
    "text": "but you can plug in different choices here. And these are going to have different trade offs. So the Monte Carlo estimate of",
    "start": "2628030",
    "end": "2633940"
  },
  {
    "text": "the return is an unbiased estimate of the value of the current policy. This is going to be biased generally,",
    "start": "2633940",
    "end": "2640495"
  },
  {
    "text": "but lower variance. All right.",
    "start": "2640495",
    "end": "2646015"
  },
  {
    "text": "So I also want to emphasize here that when we think about, um, kind of getting this estimator,",
    "start": "2646015",
    "end": "2654040"
  },
  {
    "text": "which we often say the critic is going to compute this estimator, um,",
    "start": "2654040",
    "end": "2659080"
  },
  {
    "text": "It doesn't have to be only either a TD estimate or a Monte Carlo estimate,",
    "start": "2659080",
    "end": "2664645"
  },
  {
    "text": "but you can interpolate between these. It's often known as n-step returns. So what does that mean?",
    "start": "2664645",
    "end": "2671710"
  },
  {
    "text": "So let's call- let's write this in a slightly, well, I'll call this here. So let's put this is a hat.",
    "start": "2671710",
    "end": "2678145"
  },
  {
    "text": "Okay? Just to note that you can think of this as kind of just a function. It's going to be an estimate of your state action value function.",
    "start": "2678145",
    "end": "2685630"
  },
  {
    "text": "And so what we could have is we could have an estimator.",
    "start": "2685630",
    "end": "2690589"
  },
  {
    "text": "I could have estimator of the value from time-step t onwards,",
    "start": "2691590",
    "end": "2697495"
  },
  {
    "text": "which is equal to the actual, this is the actual one we got on time-step i, so I'm going to call this.",
    "start": "2697495",
    "end": "2703945"
  },
  {
    "text": "I'm going to call this sort of i, 1. And this is going to be then the actual reward you got on time-step t in episode i,",
    "start": "2703945",
    "end": "2713049"
  },
  {
    "text": "+ gamma V of S_t + 1 i.",
    "start": "2713050",
    "end": "2719125"
  },
  {
    "text": "So this should look almost exactly like TD(0) style estimates. We talked about this before.",
    "start": "2719125",
    "end": "2726069"
  },
  {
    "text": "So this says, I got- I look at the actual, immediate one-step reward I got and then I bootstrap.",
    "start": "2726070",
    "end": "2732205"
  },
  {
    "text": "I add in the value. So this would be- I get this value function for my critic.",
    "start": "2732205",
    "end": "2737454"
  },
  {
    "text": "And I would plug that in and then that would be my target. That then I would use in this equation.",
    "start": "2737455",
    "end": "2742690"
  },
  {
    "text": "Okay. So that would be one thing you do- you can do. So we've seen this,",
    "start": "2742690",
    "end": "2748525"
  },
  {
    "text": "and we've seen a lot of this, which I'm going to call the infinite or Monte Carlo version.",
    "start": "2748525",
    "end": "2755465"
  },
  {
    "text": "And this one is you sum over all t prime, all the way to the end of the episode of gamma 2.",
    "start": "2755465",
    "end": "2764010"
  },
  {
    "text": "The t prime minus t times r t prime.",
    "start": "2764010",
    "end": "2770030"
  },
  {
    "text": "So this is the Monte Carlo return, where we just sum up, we don't do any bootstrapping, and we sum up all the rewards at the end of the episodes.",
    "start": "2770030",
    "end": "2776050"
  },
  {
    "text": "But as you can see here, there should be, you know, there's probably some way to interpolate between these two. And these are often known as n step returns.",
    "start": "2776050",
    "end": "2783985"
  },
  {
    "text": "And so for example, you could do this, you could say, I'm going to add in the reward at time step i and",
    "start": "2783985",
    "end": "2790660"
  },
  {
    "text": "the reward I got at time step t + 1. And then I'm going to bootstrap.",
    "start": "2790660",
    "end": "2798200"
  },
  {
    "text": "So this is just sort of one of the estimators that are in between these two extremes.",
    "start": "2803010",
    "end": "2808195"
  },
  {
    "text": "One is you only take in one step of reward, another one is do you sum up all the rewards, and then there's a whole bunch of interpolation you could do",
    "start": "2808195",
    "end": "2814660"
  },
  {
    "text": "between those. Why would you want to do that? Well, this one is generally going to be somewhat biased, but low variance.",
    "start": "2814660",
    "end": "2821500"
  },
  {
    "text": "This is going to be unbiased, but really high variance. And there's no reason to assume that the best solution is on either of those two extremes.",
    "start": "2821500",
    "end": "2828070"
  },
  {
    "text": "And so you could interpolate between a TD estimate and a Monte Carlo estimate.",
    "start": "2828070",
    "end": "2834110"
  },
  {
    "text": "And all of these just form returns that then you could subtract off a baseline for too.",
    "start": "2834540",
    "end": "2841960"
  },
  {
    "text": "So traditional and all this would probably be sort of hyper-parameter that we can choose through validation or cross-validation.",
    "start": "2841960",
    "end": "2848545"
  },
  {
    "text": "Right. Is that what people do here? Is that kinda too computationally intensive? So you just have to pick something.",
    "start": "2848545",
    "end": "2853660"
  },
  {
    "text": "Question is if we were doing standard machine-learning, this would be just considered as some sort of hyper parameter.",
    "start": "2853660",
    "end": "2858850"
  },
  {
    "text": "You could turn this into n and you would decide like how many steps do you do- do people do. And the question was do- do people do that in",
    "start": "2858850",
    "end": "2865390"
  },
  {
    "text": "reinforcement learning or is it that considered too expensive? You certainly could. I- I think it's an interesting question.",
    "start": "2865390",
    "end": "2871255"
  },
  {
    "text": "I feel like the tricks that people do in this case, [NOISE] I think I probably see more of this but it varies [NOISE] more using the TD(0),",
    "start": "2871255",
    "end": "2879940"
  },
  {
    "text": "doing a lot of bootstrapping, but it probably depends on your application domain. Another thing that it would likely depend on is if your domain is really Markov or not.",
    "start": "2879940",
    "end": "2888174"
  },
  {
    "text": "So this case this is still working, and this is giving you a real estimate of the return of your policy even if your domain isn't Markov.",
    "start": "2888175",
    "end": "2894625"
  },
  {
    "text": "This case you're making a much stronger Markovian assumption. So you also might want to make- do different things depending on your domain.",
    "start": "2894625",
    "end": "2902845"
  },
  {
    "text": "And also how expensive it is to collect data. All right.",
    "start": "2902845",
    "end": "2908290"
  },
  {
    "text": "So this gives us sort of a different way to plug things in to that vanilla policy gradient algorithm I put over there.",
    "start": "2908290",
    "end": "2915355"
  },
  {
    "text": "So you could plug in these sort of targets instead, over there to trade off between bias and variance,",
    "start": "2915355",
    "end": "2922720"
  },
  {
    "text": "when you're doing this estimate of the gradient. So what this is doing here is it's changing what our targets are,",
    "start": "2922720",
    "end": "2928165"
  },
  {
    "text": "and it's changing how we're computing our gradient [NOISE]. But then the next thing I wanna talk about is this part.",
    "start": "2928165",
    "end": "2935904"
  },
  {
    "text": "Which is once we've actually got our gradient, however we've chosen to get it. We have to actually figure out how far to go along that gradient.",
    "start": "2935905",
    "end": "2944050"
  },
  {
    "text": "[NOISE] So why might this be important?",
    "start": "2944050",
    "end": "2949780"
  },
  {
    "text": "Well, it might be important because,",
    "start": "2949780",
    "end": "2954940"
  },
  {
    "text": "this is just a local approximation. You're giving your local estimate of the gradient. Yeah.",
    "start": "2954940",
    "end": "2960130"
  },
  {
    "text": "How often do you update the parameters of the critic? The question was how often do you update the parameters of the critic?",
    "start": "2960130",
    "end": "2968155"
  },
  {
    "text": "It's a great question, again, it depends. So you can either- you can do this often asynchronously.",
    "start": "2968155",
    "end": "2973585"
  },
  {
    "text": "So you can have different threads and different networks for your critic and for your policy and principle,",
    "start": "2973585",
    "end": "2979510"
  },
  {
    "text": "you could just be updating your critic all the time like, you know, you can be using DQN for this and doing lots and lots of backups.",
    "start": "2979510",
    "end": "2984984"
  },
  {
    "text": "In general, it depends, I think you'd have a schedule. Yeah. So often you might do something like 10 or 100,",
    "start": "2984985",
    "end": "2992710"
  },
  {
    "text": "it really varies by application, um. Uh, but there's no reason that the critic",
    "start": "2992710",
    "end": "2997870"
  },
  {
    "text": "needs to be updated only on the same schedule at which you're updating the policy. And doing it asynchronously often makes a lot of sense.",
    "start": "2997870",
    "end": "3004450"
  },
  {
    "text": "All right. So if we think about what's happening here, here's our parameterized policy. Here's our value. We have some crazy function.",
    "start": "3005060",
    "end": "3012930"
  },
  {
    "text": "Okay. And then we are computing our gradient. And this gradient, locally is pretty good.",
    "start": "3012930",
    "end": "3024660"
  },
  {
    "text": "So kinda round here things like linear and things look pretty good. But of course, as we get further out like here, it's gonna be bad.",
    "start": "3024660",
    "end": "3032295"
  },
  {
    "text": "Like if we- if we try to follow the gradient too far, we're going to get an estimate that's very different",
    "start": "3032295",
    "end": "3037320"
  },
  {
    "text": "than the real va- real value function. So when we're taking step sizes in this case,",
    "start": "3037320",
    "end": "3044670"
  },
  {
    "text": "it ends up being important to consider this fact of sort of how far out do you want your step sizes to be. Let me just get this back to one [inaudible] Okay.",
    "start": "3044670",
    "end": "3055660"
  },
  {
    "text": "So we want to figure out how far we should go in the gradient and that's important.",
    "start": "3060950",
    "end": "3066390"
  },
  {
    "text": "Now, you might say, okay this is always true. Right? Like you always need to be careful when you're doing",
    "start": "3066390",
    "end": "3072720"
  },
  {
    "text": "gradient descent or ascent in any supervised learning problem. Whenever you're using stochastic gradient descent.",
    "start": "3072720",
    "end": "3078165"
  },
  {
    "text": "Of course, you don't wanna go too far along your step size because you could overshoot and you're using this linear approximation and it's bad.",
    "start": "3078165",
    "end": "3085770"
  },
  {
    "text": "Why does anybody- does anybody have any sense about why this might be even worse in the reinforcement learning case?",
    "start": "3085770",
    "end": "3092310"
  },
  {
    "text": "Why might it be even more important to think about this step size. And it has to do with where the data comes from. Yeah.",
    "start": "3092310",
    "end": "3102225"
  },
  {
    "text": "So when you have a bad policy that affects the data you collect, and you might just go down a  bad road.",
    "start": "3102225",
    "end": "3109020"
  },
  {
    "text": "Sure. So she's exactly correct. In a supervised learning case, your data is being generated by an IID distribution,",
    "start": "3109020",
    "end": "3116535"
  },
  {
    "text": "it doesn't matter what choices you just made for your stochastic gradient descent. In RL that is determining the next policy we're",
    "start": "3116535",
    "end": "3123240"
  },
  {
    "text": "using inside of our iteration to gather data. So we're not going to, you know, if we take a really bad, if we get really,",
    "start": "3123240",
    "end": "3130694"
  },
  {
    "text": "really bad policies, we just may be getting no data towards the actual optima of this function. So it's even more important to sort of carefully",
    "start": "3130695",
    "end": "3138795"
  },
  {
    "text": "think about where we're going along here and ideally hopefully get monotonic improvement. So this is- this is the really,",
    "start": "3138795",
    "end": "3146069"
  },
  {
    "text": "it's very important in the reinforcement learning case, to think about how we're doing this step size because",
    "start": "3146070",
    "end": "3151304"
  },
  {
    "text": "this determines the data we collect. pi and therefore data.",
    "start": "3151304",
    "end": "3159849"
  },
  {
    "text": "And one version of, um, one of my colleagues talks about a similar problem. He sort of has the picture of the Roadrunner running off the cliff, right?",
    "start": "3164420",
    "end": "3172140"
  },
  {
    "text": "And like them you if you're in a part where your I- your policy is just really really bad. You may get no more useful data.",
    "start": "3172140",
    "end": "3177644"
  },
  {
    "text": "Then you can't get a good estimate there of the gradient and then you're just stuck. You might get in a really really bad optima.",
    "start": "3177645",
    "end": "3183600"
  },
  {
    "start": "3183000",
    "end": "3279000"
  },
  {
    "text": "Okay. So we'd like to think carefully about this part. So one thing that we could do,",
    "start": "3183600",
    "end": "3189990"
  },
  {
    "text": "is do something like line search. So we're talking about right now sort of how do we do, so how to do step sizes.",
    "start": "3189990",
    "end": "3200589"
  },
  {
    "text": "So one thing we could do is try to do some sort of line search along the gradient. [BACKGROUND]",
    "start": "3205700",
    "end": "3219450"
  },
  {
    "text": "And this is, um, okay but it's a little bit expensive. So it's simple but it's expensive.",
    "start": "3219450",
    "end": "3229100"
  },
  {
    "text": "And it tends to sort of ignore where the linear approximation is good.",
    "start": "3231000",
    "end": "3238045"
  },
  {
    "text": "So we'd like to do better than this. Okay. So now we're gonna go back to that point that I mentioned at the start",
    "start": "3238045",
    "end": "3248170"
  },
  {
    "text": "which is what we'd really like to be able to do is when we're doing this updating we would like to ensure monotonic improvement.",
    "start": "3248170",
    "end": "3253885"
  },
  {
    "text": "And so can we kind of choose our step sizes in a way or choose how far along the gradient to go in order to achieve monotonic improvement.",
    "start": "3253885",
    "end": "3261640"
  },
  {
    "text": "So what our goal is gonna be is we'd like to have it. So that V pi of i + 1 is greater than or equal to V pi i.",
    "start": "3261640",
    "end": "3271190"
  },
  {
    "text": "And we're hoping to achieve this by changing how big of a step size we take.",
    "start": "3273780",
    "end": "3279220"
  },
  {
    "start": "3279000",
    "end": "3600000"
  },
  {
    "text": "All right. So let's think about what our- our objective function is again. Um so we're getting- we have our value, our parameterized value.",
    "start": "3279220",
    "end": "3288790"
  },
  {
    "text": "So V of theta is equal to the expected value under our policy that's defined by theta of",
    "start": "3288790",
    "end": "3297850"
  },
  {
    "text": "just the sum over t = 0 to infinity of gamma t_r S_t a_t under our policy.",
    "start": "3297850",
    "end": "3307975"
  },
  {
    "text": "Okay. And this is where we just sort of look at the series of states we get under our policy.",
    "start": "3307975",
    "end": "3314245"
  },
  {
    "text": "So that's our basic equation here in terms of expressing the value of a parameterized policy. And what we would like to do here is we would like",
    "start": "3314245",
    "end": "3322930"
  },
  {
    "text": "to get a new policy that has a better value. But the problem is that we have samples from an old policy.",
    "start": "3322930",
    "end": "3330115"
  },
  {
    "text": "So when we're doing this we're gathering policies with pi i and then we're trying to figure out what our pi i + 1 should be.",
    "start": "3330115",
    "end": "3338575"
  },
  {
    "text": "So this is gonna fundamentally involve. Um so we have access to- we have access to",
    "start": "3338575",
    "end": "3344980"
  },
  {
    "text": "trajectories that are sampled from pi of theta.",
    "start": "3344980",
    "end": "3350545"
  },
  {
    "text": "And we now wanna sort of predict the value of v of pi of theta.",
    "start": "3350545",
    "end": "3359155"
  },
  {
    "text": "I'll put pi i, i + 1. So we'd like to sort of now figure out what a new value would be",
    "start": "3359155",
    "end": "3366069"
  },
  {
    "text": "if we update these, update these parameters in some way and take like a max. You know we'd like to figure out what the new parameters are.",
    "start": "3366070",
    "end": "3374540"
  },
  {
    "text": "But this is fundamentally an off policy problem because we have data from our last policy and we wanna figure out what our next policy should be.",
    "start": "3375900",
    "end": "3384590"
  },
  {
    "text": "Okay. So what we're gonna do is we're gonna first re-express um the value",
    "start": "3385650",
    "end": "3392859"
  },
  {
    "text": "of our policy in terms of the advantage oh- the value of our new policy in terms of the advantage over our old policy.",
    "start": "3392860",
    "end": "3399730"
  },
  {
    "text": "So I'm gonna move down to vanilla policy gradient for now. [NOISE]",
    "start": "3399730",
    "end": "3409599"
  },
  {
    "text": "Okay. So what we have is we have V of Theta tilde. So that could be like our new parameterized policy is",
    "start": "3409600",
    "end": "3418480"
  },
  {
    "text": "gonna be equal to the value of our old parameterized policy. So whatever we had before plus the following.",
    "start": "3418480",
    "end": "3425840"
  },
  {
    "text": "The distribution over the states and actions we'd get if we were to run our new policy. Now we don't know that.",
    "start": "3426270",
    "end": "3433464"
  },
  {
    "text": "But let's ima- let's ignore that for a second of a sum over t = 0 to infinity gamma to the t, the advantage pi.",
    "start": "3433465",
    "end": "3443180"
  },
  {
    "text": "Okay. So this- this just generally holds.",
    "start": "3444930",
    "end": "3451270"
  },
  {
    "text": "Um, this doesn't have to do anything necessarily with being um, parameterized. This is just saying the value of any policy which is here",
    "start": "3451270",
    "end": "3459010"
  },
  {
    "text": "parameterized by pi tilde is equal to the value of another policy plus the sum over the states and actions you'd reach under",
    "start": "3459010",
    "end": "3465550"
  },
  {
    "text": "your target policy of the advantage you get of taking this new policy over the old policy.",
    "start": "3465550",
    "end": "3471920"
  },
  {
    "text": "Okay. So that um, that just expresses how we can say what the va- how uh, the value of a new policy relates to the value of the old policy.",
    "start": "3474030",
    "end": "3481994"
  },
  {
    "text": "It's exactly the same as the old values policy plus the advantage you'd get if you were to run the new policy and look at the state action distribution you'd encounter. Yes?",
    "start": "3481995",
    "end": "3491700"
  },
  {
    "text": "Should the subscript be Pi tilde on the advantage? Should the subscript be Pi tilde on the advantage?",
    "start": "3491700",
    "end": "3498190"
  },
  {
    "text": "[OVERLAPPING] policy? Yeah. So we're doing in it- let me write this up thing. So [inaudible] question is a good one, let me just write this out to be for- for long.",
    "start": "3498190",
    "end": "3505599"
  },
  {
    "text": "Okay, so we've got V of theta plus sum over all the states",
    "start": "3505600",
    "end": "3511340"
  },
  {
    "text": "and we're gonna use mu pi tilde of s. So remember this was the stationary distribution.",
    "start": "3511340",
    "end": "3517435"
  },
  {
    "text": "Um we use this to denote the stationary distribution over states that we'd reach um if we were to run our new policy which is parameterized tilde.",
    "start": "3517435",
    "end": "3526105"
  },
  {
    "text": "This is theta tilde. Okay? Um times the advantage function.",
    "start": "3526105",
    "end": "3533600"
  },
  {
    "text": "Okay. So what this is saying here is this S_t and a_t are under our desired policy.",
    "start": "3536490",
    "end": "3547090"
  },
  {
    "text": "And the advantage here is using the old one. Okay? So this is allowing us to compare.",
    "start": "3547090",
    "end": "3557005"
  },
  {
    "text": "So what does this do? It's allowing us to compare s_a S_t a_t minus",
    "start": "3557005",
    "end": "3566515"
  },
  {
    "text": "Q of S_t our old policy.",
    "start": "3566515",
    "end": "3572089"
  },
  {
    "text": "And this is under- so it's allowing us to compare how much better is that if we take like our new action.",
    "start": "3580980",
    "end": "3590635"
  },
  {
    "text": "Okay? All right. But one of the problems of this is we don't know this.",
    "start": "3590635",
    "end": "3596110"
  },
  {
    "text": "Yeah? Sum over from t = 0 to infinity somewhere?",
    "start": "3596110",
    "end": "3603220"
  },
  {
    "text": "Oh, thank you um. And answering- yeah. Yeah. Yeah. And also again [OVERLAPPING] So the question is is [inaudible]?",
    "start": "3603220",
    "end": "3609850"
  },
  {
    "text": "No. And thank you for make me uh allowing me to clarify that. So in this case what we're doing is we're taking um",
    "start": "3609850",
    "end": "3615310"
  },
  {
    "text": "an expectation over all time-steps and this is saying over the trajectories that we'd get to under our new policy.",
    "start": "3615310",
    "end": "3622645"
  },
  {
    "text": "I've now reformulated and said well we have a stationary distribution over states.",
    "start": "3622645",
    "end": "3627940"
  },
  {
    "text": "If we look at what is the probability of reaching those states and then we weight that by the advantage.",
    "start": "3627940",
    "end": "3634525"
  },
  {
    "text": "So we've went from a time averaging to a state averaging. Does that makes sense?",
    "start": "3634525",
    "end": "3641275"
  },
  {
    "text": "So we can either think of our value function or averaging our value function across time-steps where we can think here is",
    "start": "3641275",
    "end": "3647680"
  },
  {
    "text": "averaging across all the states and what is for each state. What is the relative value you get by following your new policy versus your old policy?",
    "start": "3647680",
    "end": "3654460"
  },
  {
    "text": "[inaudible]. Oh sorry. Thank you. Then that- those are typos.",
    "start": "3654460",
    "end": "3661609"
  },
  {
    "text": "Okay. All right. So this would be under-",
    "start": "3664140",
    "end": "3670520"
  },
  {
    "text": "so we look at the states that- for each state what is the probability we'd reached that state under",
    "start": "3675690",
    "end": "3682599"
  },
  {
    "text": "our new policy and what is the relative advantage?",
    "start": "3682600",
    "end": "3686330"
  },
  {
    "text": "The thing that you're pointing to should not have [inaudible].",
    "start": "3692790",
    "end": "3706180"
  },
  {
    "text": "Oh sorry. We have a tilde over here, this is our value of our original one plus this we get the advantage term over all the states. Yeah.",
    "start": "3706180",
    "end": "3713860"
  },
  {
    "text": "Is there a difference between pi theta tilde and tilde pi?",
    "start": "3713860",
    "end": "3720880"
  },
  {
    "text": "I was just doing this here to make it clear. Pi L- say Pi tilde is also- Pi tilde is",
    "start": "3720880",
    "end": "3727450"
  },
  {
    "text": "parameterized by, this is a policy parameterized by theta tilde. Yeah. I'm just saying it's like in the expectation they wrote in the first slide",
    "start": "3727450",
    "end": "3734980"
  },
  {
    "text": "[inaudible]",
    "start": "3734980",
    "end": "3740680"
  },
  {
    "text": "Okay. We can vote on that side. But either- I- I wanted to just be clear um, often this notation goes back",
    "start": "3740680",
    "end": "3747550"
  },
  {
    "text": "and forth between using do you wanna make the policy explicit as opposed to just the parameters. Um I think it's more clear to have a policy um and parameters here but often we also",
    "start": "3747550",
    "end": "3757750"
  },
  {
    "text": "use the- you can just directly parameterize the value function in terms of theta as opposed to V pi tilde of theta.",
    "start": "3757750",
    "end": "3764110"
  },
  {
    "text": "But I'm gonna just use any of these is fine.",
    "start": "3764110",
    "end": "3769810"
  },
  {
    "text": "Is anybody confused about what this is? I mean if it's easier I can just go like this. Okay. So I can just remove all of this.",
    "start": "3769810",
    "end": "3776395"
  },
  {
    "text": "Okay. So this is just whenever I say pi tilde that's the policy that's parameterized by the new- that's your new policy.",
    "start": "3776395",
    "end": "3783190"
  },
  {
    "text": "Okay. And that's this. I know it's a lot of notation.",
    "start": "3783190",
    "end": "3789280"
  },
  {
    "text": "Does anybody have any questions about that notation last? Yeah? Yeah. Name first please.",
    "start": "3789280",
    "end": "3795460"
  },
  {
    "text": "So I guess I'm a little bit confused mostly just because it's a little bit different from the slides. And I'm just wondering-",
    "start": "3795460",
    "end": "3800920"
  },
  {
    "text": "Shouldn't be different by the slides but I'm trying to go- [LAUGHTER] I was wondering sort in this case do we",
    "start": "3800920",
    "end": "3806170"
  },
  {
    "text": "sum over the possible actions for a given state or as we've noted here do we assume that we take",
    "start": "3806170",
    "end": "3812590"
  },
  {
    "text": "a single action per uh by using the policy which is what we have here on the board?",
    "start": "3812590",
    "end": "3817775"
  },
  {
    "text": "You are right. I forgot that right. I'm gonna go. Repeat that again.",
    "start": "3817775",
    "end": "3826790"
  },
  {
    "text": "Okay. Okay. Let's say V of theta tilde I'll go with the same exact same notation as the slides is equal",
    "start": "3826790",
    "end": "3836980"
  },
  {
    "text": "to V of Theta plus sum over states or",
    "start": "3836980",
    "end": "3843190"
  },
  {
    "text": "stationary distribution over Pi tilde of s. This is the distribution we get.",
    "start": "3843190",
    "end": "3850345"
  },
  {
    "text": "Um this is the discounted weight of distribution under our target policy.",
    "start": "3850345",
    "end": "3856849"
  },
  {
    "text": "Under pi tilde. Okay. Sum over A.",
    "start": "3861990",
    "end": "3869990"
  },
  {
    "text": "Okay. So this is the weighted affair,",
    "start": "3876930",
    "end": "3882135"
  },
  {
    "text": "this is the weighted distribution under the states. We went from the time domain to thinking about the distribution over",
    "start": "3882135",
    "end": "3887610"
  },
  {
    "text": "states times looking at all the actions we might take under our target policy and the relative advantage of each of those",
    "start": "3887610",
    "end": "3896205"
  },
  {
    "text": "over our previous policy, [NOISE] okay?",
    "start": "3896205",
    "end": "3901740"
  },
  {
    "text": "And this should look very, very similar to imitation learning in certain ways, right? Like, so we're again sort of thinking about,",
    "start": "3901740",
    "end": "3907980"
  },
  {
    "text": "um, instead of thinking about subbing rewards over time steps, we're thinking about what is the stationary distribution we might get to under",
    "start": "3907980",
    "end": "3914610"
  },
  {
    "text": "a new policy and how that compares to the stationary distribution we would have had under our old policy.",
    "start": "3914610",
    "end": "3919829"
  },
  {
    "text": "Um, and what we're looking at so far is, we're looking at the [NOISE] stationary distribution under our target policy.",
    "start": "3919830",
    "end": "3926355"
  },
  {
    "text": "The problem is, we don't know this, so we can't calculate this. This is just an expression.",
    "start": "3926355",
    "end": "3931724"
  },
  {
    "text": "Um, uh, but this is unknown [NOISE] because we don't have any samples from pi tilde,",
    "start": "3931725",
    "end": "3940935"
  },
  {
    "text": "we only have samples from pi, okay?",
    "start": "3940935",
    "end": "3945490"
  },
  {
    "text": "So we can't compute this. Why would we, and just to go back, why are we trying to do any of this?",
    "start": "3946010",
    "end": "3951540"
  },
  {
    "text": "We're trying to do this because when we do vanilla policy gradient, [NOISE] we're gonna be trying to figure out a new policy at a,",
    "start": "3951540",
    "end": "3960935"
  },
  {
    "text": "that has a value that's better than our old policy. What we did here is, we tried to estimate the derivative out of the current pol- of the current policy,",
    "start": "3960935",
    "end": "3969994"
  },
  {
    "text": "um, but we don't know anything yet about the value once we take that step. And so what we're trying to do here is to say, well,",
    "start": "3969995",
    "end": "3976470"
  },
  {
    "text": "can we somehow understand what the value will be of a new policy before we execute it?",
    "start": "3976470",
    "end": "3982140"
  },
  {
    "text": "And we're gonna do that by trying to relate it to what is our value of the previous policy plus some sort of distance between the old policy and the new policy,",
    "start": "3982140",
    "end": "3991964"
  },
  {
    "text": "ideally computed in terms of things we can actually evaluate using our current samples. That's where we're trying to go to, okay?",
    "start": "3991965",
    "end": "3998400"
  },
  {
    "text": "[NOISE] Right. So we have this nice expression, but we can't compute it.",
    "start": "3998400",
    "end": "4004040"
  },
  {
    "text": "So we're gonna make up a new objective function, okay?",
    "start": "4004040",
    "end": "4009290"
  },
  {
    "text": "We're gonna do this one sort of backwards because we're [NOISE] gonna make it up, and then, we're gonna show why it's a good thing to do. So what are we trying to do?",
    "start": "4009290",
    "end": "4015845"
  },
  {
    "text": "We'd like to use something like this. If we had this, then we could compare the value of the new policy to the value of the old policy.",
    "start": "4015845",
    "end": "4022835"
  },
  {
    "text": "The problem is, we don't have this because we don't have the, uh, the stationary distribution under the new policy.",
    "start": "4022835",
    "end": "4029555"
  },
  {
    "text": "So what we're gonna do instead is, we're going to define an objective function L_Pi,",
    "start": "4029555",
    "end": "4034910"
  },
  {
    "text": "[NOISE] which is as follows. It's the value of your old policy plus a sum over all your states,",
    "start": "4034910",
    "end": "4042724"
  },
  {
    "text": "the stationary distribu- discounted distribution of your old policy.",
    "start": "4042725",
    "end": "4047885"
  },
  {
    "text": "This is where it's different. So this is [NOISE] the old, your current policy, okay?",
    "start": "4047885",
    "end": "4056075"
  },
  {
    "text": "And then, the rest of the expression looks the same. [NOISE] Now, notice, we can compute this, okay?",
    "start": "4056075",
    "end": "4068180"
  },
  {
    "text": "This is, um, we could just average over all the trajectories we have for the current episode,",
    "start": "4068180",
    "end": "4073820"
  },
  {
    "text": "we could estimate our stationary distribution from our current data, we could know for a new policy what its action or,",
    "start": "4073820",
    "end": "4082700"
  },
  {
    "text": "so if someone gives me a new policy pi, I could evaluate this, and I could also evaluate the advantage, okay,",
    "start": "4082700",
    "end": "4089825"
  },
  {
    "text": "because this advantage is defined only in terms of my previous Pi.",
    "start": "4089825",
    "end": "4094890"
  },
  {
    "text": "So as long as if I have a, uh, a representation of the state action value function",
    "start": "4095050",
    "end": "4100444"
  },
  {
    "text": "for my old policy, I could evaluate this. So now, all of this is evaluatable. [NOISE] This might not be a good thing to do,",
    "start": "4100445",
    "end": "4106970"
  },
  {
    "text": "but we can compute this. [inaudible]",
    "start": "4106970",
    "end": "4114140"
  },
  {
    "text": "and then, like, giving that to pi itself? Yes. [inaudible] in terms of sort of notation where, like, yeah,",
    "start": "4114140",
    "end": "4120080"
  },
  {
    "text": "I'm using pi tilde interchangeably with, you can, they- they're just some new parameters for computing. So our policy is always parameterized by some set of parameters.",
    "start": "4120080",
    "end": "4127819"
  },
  {
    "text": "You can either think of that as just being a new policy, or you can think of that as the new parameters, either is fine.",
    "start": "4127820",
    "end": "4133339"
  },
  {
    "text": "Uh, so could quickly explain why [NOISE] if you're given, um, the pi tilde, why you won't be able to calculate the, uh, new [OVERLAPPING]?",
    "start": "4133340",
    "end": "4144319"
  },
  {
    "text": "You don't have to. So, um, so the question is, if you're given pi to, uh, the new policy, why can you not compute mu? It's a good question because you don't want any data from that.",
    "start": "4144320",
    "end": "4151369"
  },
  {
    "text": "So someone has given you a new polic- [NOISE] the- there could be ways to approximate [NOISE] this, but the only data that you have right now is from [NOISE]",
    "start": "4151370",
    "end": "4158660"
  },
  {
    "text": "the current old policy, [NOISE] from Pi. So you've run this out M times, you've got M trajectories,",
    "start": "4158660",
    "end": "4164795"
  },
  {
    "text": "which are M trajectories gathered under your old policy pi, okay? You don't have [NOISE] any data from pi tilde.",
    "start": "4164795",
    "end": "4172355"
  },
  {
    "text": "And in general, if pi tilde is not the same as pi, you're going to get different trajectories.",
    "start": "4172355",
    "end": "4177980"
  },
  {
    "text": "So you don't have any direct estimate of this. Does that makes sense to everybody?",
    "start": "4177980",
    "end": "4183199"
  },
  {
    "text": "So if we go back to [NOISE] the vanilla policy gradient, what do we do? We had a policy pi_i,",
    "start": "4183200",
    "end": "4188825"
  },
  {
    "text": "we ran it out, and we got D trajectories from that pi_i. We could use that to estimate that mu.",
    "start": "4188825",
    "end": "4195185"
  },
  {
    "text": "That just gives us on policy data of what are the states and actions we experience when we're [NOISE] following Pi_i.",
    "start": "4195185",
    "end": "4201790"
  },
  {
    "text": "We don't have any data of Pi_i + 1 yet, we haven't run it. Okay. Yeah.",
    "start": "4201790",
    "end": "4206875"
  },
  {
    "text": "Uh, just to be clear, to get an estimate of the stationary distribution for the old policy, [NOISE] uh,",
    "start": "4206875",
    "end": "4212060"
  },
  {
    "text": "you basically [NOISE] look at all the data that you have, uh, like, all the trajectories, and see basically what fraction of",
    "start": "4212060",
    "end": "4218600"
  },
  {
    "text": "the time you're spending at one state. Okay. Exactly. So [inaudible] is exactly right.",
    "start": "4218600",
    "end": "4223910"
  },
  {
    "text": "[NOISE] How would you go from this just raw data, these te- D trajectories to mu? You could just count, you know.",
    "start": "4223910",
    "end": "4230165"
  },
  {
    "text": "I mean, in general, if you're in really high dimensions, you want to do something smoother than that, you want to approximate the density function. Um, but essentially, you can just directly,",
    "start": "4230165",
    "end": "4238040"
  },
  {
    "text": "i- in a type of so, you could just count and [NOISE] just like, how many times did I get to this state and take this action, and then, that would give you a direct estimate of, um, the mu's.",
    "start": "4238040",
    "end": "4245210"
  },
  {
    "text": "[NOISE] In general, you're gonna want some sort of parametric function in high dimensions, but you couldn't fit that using, you could,",
    "start": "4245210",
    "end": "4251344"
  },
  {
    "text": "you could imagine this is parameterized itself, and you can fit that using your existing on policy data. Uh, intuitively, does this work because we",
    "start": "4251345",
    "end": "4259460"
  },
  {
    "text": "assume that distribution of the states [NOISE] won't change too much between policies? Oh, yeah. The question is, intuitively, why does this work?",
    "start": "4259460",
    "end": "4266030"
  },
  {
    "text": "I've not told you why this works, I've just said this is something we could do and that it's computable. [NOISE] Um, and I haven't told you yet why this is a good thing to do.",
    "start": "4266030",
    "end": "4273965"
  },
  {
    "text": "But we're gonna show that, um, that this is going to allow us to get to something which is a lower bound,",
    "start": "4273965",
    "end": "4279695"
  },
  {
    "text": "um, and then, we can improve on those lower bounds. Okay. [NOISE] So just a quick thing to notice here,",
    "start": "4279695",
    "end": "4285125"
  },
  {
    "text": "which is, if you do this, if you do L_pi of pi, [NOISE] so that's just what is",
    "start": "4285125",
    "end": "4292550"
  },
  {
    "text": "this objective function if you plug in the old policy there, this is just equal to [NOISE] V of the theta, [NOISE] okay?",
    "start": "4292550",
    "end": "4302585"
  },
  {
    "text": "So if you evaluate [NOISE] this function under the same policy,",
    "start": "4302585",
    "end": "4308014"
  },
  {
    "text": "it just gives you the value, okay? All right? [NOISE] All right.",
    "start": "4308014",
    "end": "4314135"
  },
  {
    "text": "So conservative, [NOISE] I'll just briefly, we'll have to continue this further later, but, um,",
    "start": "4314135",
    "end": "4320000"
  },
  {
    "text": "[NOISE] so we can use this to do what's known as conservative policy iteration. So [NOISE] conservative policy iteration,",
    "start": "4320000",
    "end": "4331500"
  },
  {
    "text": "um, and the intuition here is, let's just first just [NOISE] start with mixed, um, a mixed policy.",
    "start": "4331570",
    "end": "4337790"
  },
  {
    "text": "[NOISE] So imagine that you have a new policy, which is a mix of an, of, um, an old policy and something different.",
    "start": "4337790",
    "end": "4345020"
  },
  {
    "text": "So you have 1 minus alpha times your old policy plus alpha times some new policy pi prime, okay?",
    "start": "4345020",
    "end": "4355730"
  },
  {
    "text": "So that just means, you take some ol- your current existing policy and you [NOISE] mix in something else, okay?",
    "start": "4355730",
    "end": "4361264"
  },
  {
    "text": "Then, in this case, you can guarantee that the value [NOISE] of your new policy is greater than or equal to,",
    "start": "4361265",
    "end": "4368225"
  },
  {
    "text": "if you'd to take this objective function here and you evaluate it with your new policy,",
    "start": "4368225",
    "end": "4374164"
  },
  {
    "text": "so you take your new policy, you evaluate under your old policy, you plug that in, that's computable because you have data from",
    "start": "4374164",
    "end": "4380720"
  },
  {
    "text": "your old policy minus [NOISE] 2 epsilon gamma, 1 minus gamma squared alpha squared, okay?",
    "start": "4380720",
    "end": "4389900"
  },
  {
    "text": "So you can lower bound [NOISE] the value of your new policy in terms of whatever this objective function",
    "start": "4389900",
    "end": "4395630"
  },
  {
    "text": "is when you compute it minus this expression, okay?",
    "start": "4395630",
    "end": "4401330"
  },
  {
    "text": "Um, I just wanna close with two other thoughts, which is, note again that if you plug in alpha = 0,",
    "start": "4401330",
    "end": "4410989"
  },
  {
    "text": "[NOISE] that means that pi new is the same as pi old,",
    "start": "4410990",
    "end": "4417800"
  },
  {
    "text": "and this goes to 0, [NOISE] which means that, and since we know that this is equal to that,",
    "start": "4417800",
    "end": "4424070"
  },
  {
    "text": "that just says that your new policy has to be greater than or equal to your old policy. And since the same, their policies are all the same, this is tight.",
    "start": "4424070",
    "end": "4432300"
  },
  {
    "text": "Okay. So we, um, this is a, a little bit different than we expected because of,",
    "start": "4432460",
    "end": "4437494"
  },
  {
    "text": "um, [NOISE] the technical challenges with PDF. Uh, so what I'll just close with here is that the next steps we'll go from this is to",
    "start": "4437495",
    "end": "4443960"
  },
  {
    "text": "show we can use this to essentially derive a lower bound on the new value function. And we can show basically that if we improve across the lower bounds,",
    "start": "4443960",
    "end": "4453230"
  },
  {
    "text": "that we're guaranteed that the actual value function is monotonically improving. [NOISE] So we will go through that.",
    "start": "4453230",
    "end": "4460295"
  },
  {
    "text": "Um, I haven't decided yet whether we'll go through that on Monday because that's [NOISE] the midterm review or if we'll wait on that until the following week after the midterm.",
    "start": "4460295",
    "end": "4468199"
  },
  {
    "text": "Um, the policy gradient, uh, homework won't be released until after the midterm. So we have a bit more time for that.",
    "start": "4468200",
    "end": "4474110"
  },
  {
    "text": "Um, and I'll go through also, like, the main takeaways with policy gradient stuff when we conclude this part. Thanks.",
    "start": "4474110",
    "end": "4481409"
  }
]