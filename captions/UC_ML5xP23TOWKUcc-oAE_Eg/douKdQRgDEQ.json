[
  {
    "start": "0",
    "end": "130000"
  },
  {
    "text": "welcome to the backend engineering show with your host hussein nasser today we're going to discuss this piece",
    "start": "240",
    "end": "5920"
  },
  {
    "text": "uh from slack engineering",
    "start": "5920",
    "end": "10880"
  },
  {
    "text": "slack recently migrated all their warp sockets connections and architecture",
    "start": "11040",
    "end": "20640"
  },
  {
    "text": "from h a proxy to envoy that does not mean they fully move to an",
    "start": "20640",
    "end": "26160"
  },
  {
    "text": "avoid they just move the websockets architecture and uh there are a lot of",
    "start": "26160",
    "end": "32960"
  },
  {
    "text": "other pieces that are still working on moving them and before we discuss all these kind of things guys uh in any blog in any",
    "start": "32960",
    "end": "39200"
  },
  {
    "text": "engineering blog we as engineers should um be pragmatic",
    "start": "39200",
    "end": "44800"
  },
  {
    "text": "when we read this kind of things like if we see slack move from hey proxy to envoy that does not mean a shape proxy",
    "start": "44800",
    "end": "51440"
  },
  {
    "text": "is bad right and we're gonna see from this article that the reasons slack moved has nothing to",
    "start": "51440",
    "end": "59039"
  },
  {
    "text": "do with limitations in a chat proxy it's just it's just the way slack doing",
    "start": "59039",
    "end": "64720"
  },
  {
    "text": "things that didn't share proxy didn't fit with them and envoy they had more experience in",
    "start": "64720",
    "end": "69840"
  },
  {
    "text": "invoice engineers so they want to instead of maintaining two things they have already had envoy in place instead of maintaining",
    "start": "69840",
    "end": "75520"
  },
  {
    "text": "two systems they want to maintain one they had more engineers who knows envoy then hi proxies they",
    "start": "75520",
    "end": "80560"
  },
  {
    "text": "move to that okay that doesn't mean that jproxy is bad we're gonna we're gonna find out this thing same thing happened with their",
    "start": "80560",
    "end": "86320"
  },
  {
    "text": "ober when we discussed that view a few months ago right the the infamous article they they moved the prom",
    "start": "86320",
    "end": "92799"
  },
  {
    "text": "postgres to mysql postgres community were furious on how that article is written and i believe some",
    "start": "92799",
    "end": "99439"
  },
  {
    "text": "people will be furious with the way this article is written as well you're gonna see for yourself and you make the decision at",
    "start": "99439",
    "end": "105200"
  },
  {
    "text": "the end of the day as an engineer how about we jump into it guys so the title of the article is",
    "start": "105200",
    "end": "110560"
  },
  {
    "text": "migrating millions of concurrent websockets to envoy written by ariane van der stildt",
    "start": "110560",
    "end": "117840"
  },
  {
    "text": "staff engineer staff software engineer site reliability and radha kumari",
    "start": "117840",
    "end": "124880"
  },
  {
    "text": "senior software engineer site reliability in slack let's read the blurb and then",
    "start": "124880",
    "end": "131920"
  },
  {
    "text": "discuss the portions of the article that i want to discuss i'm going to move through uh the entire",
    "start": "131920",
    "end": "138720"
  },
  {
    "text": "article i'm not going to read it all obviously because i'm going to summarize it but uh so if you're listening in this",
    "start": "138720",
    "end": "145280"
  },
  {
    "text": "podcast so i'm gonna try to describe the diagrams if that there are there aren't any many diagrams so that's good right",
    "start": "145280",
    "end": "152000"
  },
  {
    "text": "so we're gonna explain that and uh we'll jump into it slack has a global customer base with millions of simultaneously",
    "start": "152000",
    "end": "157840"
  },
  {
    "text": "connected users at peak time most of the communication between users involves sending time lots of tiny",
    "start": "157840",
    "end": "165040"
  },
  {
    "text": "messages to other each other for much of slack history we've used h.a proxy as a load balancer",
    "start": "165040",
    "end": "171440"
  },
  {
    "text": "for all incoming traffic today we'll talk about problems we face with hip proxy how we solve them with",
    "start": "171440",
    "end": "178080"
  },
  {
    "text": "envoy proxy the steps involved in migration and what comes after",
    "start": "178080",
    "end": "183280"
  },
  {
    "text": "let's dive in so here the first portion of the article talks about",
    "start": "183280",
    "end": "188800"
  },
  {
    "text": "websockets as lack and i'm going to summarize it guys i talked about many times about webstock in this",
    "start": "188800",
    "end": "194800"
  },
  {
    "text": "channel i have effectively i have a playlist here go watch that if you're interested to know if you know anything about soccer",
    "start": "194800",
    "end": "202159"
  },
  {
    "text": "go watch that obviously i always discuss the fundamentals here you so you not see tools like socket io in my channel at",
    "start": "202159",
    "end": "208480"
  },
  {
    "text": "all or fancy stuff like that i always discuss the bare rfc standard fundamentals here all right and",
    "start": "208480",
    "end": "214560"
  },
  {
    "text": "how you build it from scratch websocket is a bi-directional protocol that allows you to send messages from the client to the",
    "start": "214560",
    "end": "221280"
  },
  {
    "text": "server and the server sends messages back to the client and then because it's by direction that means it's stateful right",
    "start": "221280",
    "end": "226480"
  },
  {
    "text": "because there is knowledge between the client and the server they need to know each other thus despite it being built on http",
    "start": "226480",
    "end": "233280"
  },
  {
    "text": "which is stateless it is stateful and it's important to mention that because",
    "start": "233280",
    "end": "238400"
  },
  {
    "text": "it is very critical for load balancing stay load balancing stateful workload is",
    "start": "238400",
    "end": "244640"
  },
  {
    "text": "completely different than load balancing stateless workload like http which is",
    "start": "244640",
    "end": "249680"
  },
  {
    "text": "in my opinion much easier slack did the hard part by moving all websocket connections to them and so",
    "start": "249680",
    "end": "255920"
  },
  {
    "text": "they they explain here okay how do how websocket works obviously it's a just normal http connection the",
    "start": "255920",
    "end": "262560"
  },
  {
    "text": "first time we establish a tcp followed by tls that that makes an http",
    "start": "262560",
    "end": "268400"
  },
  {
    "text": "connection and the first request always is an http get upgrade request",
    "start": "268400",
    "end": "274240"
  },
  {
    "text": "and when proxies see that they know that this is web sockets okay and once you when this is",
    "start": "274240",
    "end": "279600"
  },
  {
    "text": "successful you get back the hdb10101 switching protocol that tells the client that hey that",
    "start": "279600",
    "end": "286800"
  },
  {
    "text": "tunnel has has been established and then everything you send the proxy just leaves it alone",
    "start": "286800",
    "end": "294000"
  },
  {
    "text": "and then forwarded as is to the back end okay so that's that's how it works essentially",
    "start": "294000",
    "end": "301440"
  },
  {
    "text": "baby fuzzin so yeah slack uses uh websockets for all sorts of things messaging",
    "start": "301520",
    "end": "306720"
  },
  {
    "text": "uh presence information whether this is online or not and for bots bots consumes websockets",
    "start": "306720",
    "end": "313199"
  },
  {
    "text": "and to send all sorts of stuff so we have clients and we have back end websocket services",
    "start": "313199",
    "end": "318960"
  },
  {
    "text": "and this logo is socket io which is a tool built on top of socket and this is basically the load balancer which",
    "start": "318960",
    "end": "325039"
  },
  {
    "text": "moves everything to the backend and a very critical point here",
    "start": "325039",
    "end": "330240"
  },
  {
    "text": "that uh that slack mentions here they the ha proxy server terminates the",
    "start": "330240",
    "end": "336479"
  },
  {
    "text": "connection closer to this uh to the client so like if you're in let's say singapore you're gonna be",
    "start": "336479",
    "end": "343520"
  },
  {
    "text": "served from a local ha proxy websocket uh ha proxy load",
    "start": "343520",
    "end": "348560"
  },
  {
    "text": "balancer that will terminate it and you're gonna send the website connection but then the back end could be somewhere",
    "start": "348560",
    "end": "353600"
  },
  {
    "text": "else right that's that explains some part of the latency that they get you remember the average that they have",
    "start": "353600",
    "end": "360000"
  },
  {
    "text": "in january 4th that cross regions that explains",
    "start": "360000",
    "end": "365199"
  },
  {
    "text": "if they it's because that's exactly what they said right the back end could be far apart but the the front end",
    "start": "365199",
    "end": "372080"
  },
  {
    "text": "is very close to the server and obviously we always as back energy we",
    "start": "372080",
    "end": "379680"
  },
  {
    "text": "always remember we always say hey make the servers as close as to each other as possible so you get",
    "start": "379680",
    "end": "386160"
  },
  {
    "text": "minimum latency but looks like this is what happened here right so we have backend services and these are terminated with",
    "start": "386160",
    "end": "392560"
  },
  {
    "text": "essentially stateful proxying and we know how a chairproxy does it right we talked about it many times this",
    "start": "392560",
    "end": "397680"
  },
  {
    "text": "channel it terminates the connection if if it sees if there is an upgrade uh request hdb upgrade",
    "start": "397680",
    "end": "405600"
  },
  {
    "text": "then it basically switched from a layer seven immediately to a layer for uh proxy so it will hook you to one tcp",
    "start": "405600",
    "end": "412960"
  },
  {
    "text": "connection on the back end all right and i keep saying tcp here because i know everything is http one one slash http two right they",
    "start": "412960",
    "end": "420639"
  },
  {
    "text": "didn't specify that that though all right so now we have we know the back end we know the front end we",
    "start": "420639",
    "end": "425919"
  },
  {
    "text": "know the load balancers let's jump into the reasons why why",
    "start": "425919",
    "end": "431840"
  },
  {
    "start": "428000",
    "end": "455000"
  },
  {
    "text": "slack have moved to envoy while we have been using a chair proxy",
    "start": "431840",
    "end": "438639"
  },
  {
    "text": "since the beginning of slack and knew how to operate it as scale there were some operational challenges",
    "start": "438639",
    "end": "445120"
  },
  {
    "text": "that made us consider alternative lack like invoice proxy so let's see what are these",
    "start": "445120",
    "end": "451680"
  },
  {
    "text": "limitations how to start when i first read this okay that implies",
    "start": "451680",
    "end": "457759"
  },
  {
    "text": "that invoice has hot restart but it's a proxy doesn't which is",
    "start": "457759",
    "end": "464000"
  },
  {
    "text": "absolutely not true and if you don't know guys hot restart",
    "start": "464000",
    "end": "469360"
  },
  {
    "text": "is is basically when you want to reload the proxy",
    "start": "469360",
    "end": "474560"
  },
  {
    "text": "with a new set of configuration but you don't want to drop any connection",
    "start": "474560",
    "end": "479680"
  },
  {
    "text": "almost all proxies support this now right it's it was a difficult problem",
    "start": "479680",
    "end": "484960"
  },
  {
    "text": "for for a few years most proxies has solved it like in 2017",
    "start": "484960",
    "end": "490160"
  },
  {
    "text": "every every proxy that i know of have fixed this problem so you can essentially because when you",
    "start": "490160",
    "end": "495840"
  },
  {
    "text": "load the configuration you can change the ports you can add more endpoints you can add more and then how do you maintain the new",
    "start": "495840",
    "end": "501199"
  },
  {
    "text": "process you spin up a new process that's one way to do it and then that the new process gets the",
    "start": "501199",
    "end": "506240"
  },
  {
    "text": "new configuration while the old process just lingers around to content code drain the old connection",
    "start": "506240",
    "end": "512159"
  },
  {
    "text": "and draining is the idea of hey let's just let's just receive the connection but let's just serve the existing",
    "start": "512159",
    "end": "518240"
  },
  {
    "text": "connections but don't accept any new things because you're gonna die eventually that's the idea here",
    "start": "518240",
    "end": "525120"
  },
  {
    "start": "525000",
    "end": "655000"
  },
  {
    "text": "so that's that's how to start so let's read through this portion of the",
    "start": "525120",
    "end": "530640"
  },
  {
    "text": "article at slack it is a common event for backend services and point lists to change that is",
    "start": "530640",
    "end": "536160"
  },
  {
    "text": "essentially the backend services due to instances being added or cycles so yeah uh this is all service",
    "start": "536160",
    "end": "542480"
  },
  {
    "text": "kill it add a new one so the ipad this is changes all the time so you need to update the configuration",
    "start": "542480",
    "end": "548240"
  },
  {
    "text": "very often and i'm going to give them that in a minute the configuration changes a",
    "start": "548240",
    "end": "554480"
  },
  {
    "text": "lot this point goes to envoy",
    "start": "554480",
    "end": "559519"
  },
  {
    "text": "we're going to talk about it in a minute hr proxy provides two ways to update its",
    "start": "559519",
    "end": "564560"
  },
  {
    "text": "configuration and to accommodate changes in the endpoint so we know that at the end point the backend is part of the configuration",
    "start": "564560",
    "end": "571040"
  },
  {
    "text": "so if your backend changes you can update the configuration and when you update the configuration you're going to reload it somehow",
    "start": "571040",
    "end": "577200"
  },
  {
    "text": "there are two ways to do it the first one is the first one is through the runtime api",
    "start": "577200",
    "end": "582480"
  },
  {
    "text": "which i talked about right here i made a whole video about how to uh use the hi proxy runtime api",
    "start": "582480",
    "end": "588959"
  },
  {
    "text": "to update the configuration like add it back and remove it back and you can do that and it's going to do it instantly in",
    "start": "588959",
    "end": "594320"
  },
  {
    "text": "that same instance right so that's essentially i'm not going to use the word ephemeral but",
    "start": "594320",
    "end": "601120"
  },
  {
    "text": "it's not that's not does not persist does that make sense it does not persist you can't have options to persist it but",
    "start": "601120",
    "end": "606160"
  },
  {
    "text": "that you can change it on the flyer just call and run the term api and do it now they say here",
    "start": "606160",
    "end": "611920"
  },
  {
    "text": "we use this approach which is the runtime api with one of our sets of hta proximises and our",
    "start": "611920",
    "end": "617839"
  },
  {
    "text": "experience is described in another blog post the blog post is titled a terrible horrible no good very bad day at slack",
    "start": "617839",
    "end": "626959"
  },
  {
    "text": "you can feel free to read that article but i'm going to summarize it for you there was a huge outage back in may 2020",
    "start": "626959",
    "end": "635600"
  },
  {
    "text": "that i did not cover but at slack that was not the january",
    "start": "635600",
    "end": "640720"
  },
  {
    "text": "2021 that's what the may 2020 the main reason they claimed is that it was it's a proxy but when you",
    "start": "640720",
    "end": "648640"
  },
  {
    "text": "actually read the article and analyze it it has nothing to do with achieve proxy the problem was",
    "start": "648640",
    "end": "654720"
  },
  {
    "text": "again they here's what happened let's summarize this article and then",
    "start": "654720",
    "end": "660880"
  },
  {
    "start": "655000",
    "end": "855000"
  },
  {
    "text": "put a pin in it right we're now we're jumping to another completely different we're going back uh how many months we're getting back um",
    "start": "660880",
    "end": "670160"
  },
  {
    "text": "seven eight nine months ago may 2020 when an outage happened in slack what",
    "start": "670160",
    "end": "677040"
  },
  {
    "text": "happened was because of the pandemic",
    "start": "677040",
    "end": "682720"
  },
  {
    "text": "a lot of people started using slack because everybody at home everybody's working from home so the",
    "start": "682720",
    "end": "688640"
  },
  {
    "text": "amount of sockets and all the connections doubled and tripled",
    "start": "688640",
    "end": "694000"
  },
  {
    "text": "so they had to spin up more back ends they have spin up more backhand that they never",
    "start": "694000",
    "end": "699120"
  },
  {
    "text": "ever hit during the life of slack at all and in the in the pandemic the pandemic",
    "start": "699120",
    "end": "704160"
  },
  {
    "text": "gave us use you've seen all the outages that happened to microsoft google amazon slack all these other",
    "start": "704160",
    "end": "712560"
  },
  {
    "text": "things because of the pandemic we think that we're gonna handle no even the big guys are cannot handle the",
    "start": "712560",
    "end": "717680"
  },
  {
    "text": "load when everybody's at home and it's like going it's like everybody going to the bank and",
    "start": "717680",
    "end": "723200"
  },
  {
    "text": "withdrawing all their money bank don't have that money laying it out right that was that's what",
    "start": "723200",
    "end": "730240"
  },
  {
    "text": "happened and then we're learning that big big guys the big cats are learning great lessons and we oh",
    "start": "730240",
    "end": "738480"
  },
  {
    "text": "and we engineers also learning great lessons which is awesome all right so they had they they started",
    "start": "738480",
    "end": "744000"
  },
  {
    "text": "spinning back ends like there are no tomorrows uh however now with more back-ends you",
    "start": "744000",
    "end": "749120"
  },
  {
    "text": "need to load balance those back-end that means you have to update ha proxy to make it aware of those back-ends but",
    "start": "749120",
    "end": "754480"
  },
  {
    "text": "guess what how do they update a proxy how do you update each proxy unit update run using the runtime api",
    "start": "754480",
    "end": "760959"
  },
  {
    "text": "right well how do you do that well you need to write a client that does the update they did they wrote a custom code to use",
    "start": "760959",
    "end": "768800"
  },
  {
    "text": "the runtime api to update that so as old back-ends go stale they",
    "start": "768800",
    "end": "774000"
  },
  {
    "text": "supposed to remove them and new back-ends are added they add them to this fleet and then update the configuration here's",
    "start": "774000",
    "end": "780399"
  },
  {
    "text": "what happened all of a sudden they see that they the more back-ends they add hprox is not",
    "start": "780399",
    "end": "786880"
  },
  {
    "text": "forwarding traffic to those new back-ends shiny new back-ends so what happened you read the article",
    "start": "786880",
    "end": "794079"
  },
  {
    "text": "more i'm gonna reference a video what happened is there was a bug in the",
    "start": "794079",
    "end": "799279"
  },
  {
    "text": "code they written to update the runtime api",
    "start": "799279",
    "end": "803760"
  },
  {
    "text": "the bug was they did not remove the old back ends that have been",
    "start": "804639",
    "end": "811360"
  },
  {
    "text": "stale from their coach so they kept adding them and as a result the new backend",
    "start": "811360",
    "end": "817440"
  },
  {
    "text": "didn't get any traffic so now you tell me is this the fault of a cha proxy or this is the part of the",
    "start": "817440",
    "end": "822800"
  },
  {
    "text": "client that uses a jproxy so that's that's their excuse that h.a",
    "start": "822800",
    "end": "829040"
  },
  {
    "text": "proxy didn't didn't function right exactly like ober did with the postgres uh moving to",
    "start": "829040",
    "end": "836880"
  },
  {
    "text": "postgres to my sequel it's a lame excuse lack i'm sorry but this is a lame excuse okay it's a",
    "start": "836880",
    "end": "844160"
  },
  {
    "text": "bug in your code so you can't blame your product so they said okay you can't come back at them now moving",
    "start": "844160",
    "end": "850720"
  },
  {
    "text": "back to today writing the writing this article we're gonna move back and say okay",
    "start": "850720",
    "end": "857040"
  },
  {
    "text": "why don't you guys don't use the runtime api use the just use the reload just reload",
    "start": "857040",
    "end": "863680"
  },
  {
    "text": "the whole configuration and they say with every ha proxy reload well we can reload but",
    "start": "863680",
    "end": "870160"
  },
  {
    "text": "remember this is web sockets what is web sockets websocket is a long running connection",
    "start": "870160",
    "end": "877199"
  },
  {
    "text": "that is always alive it's not it's not simple as a stateless request that you send and",
    "start": "877199",
    "end": "882880"
  },
  {
    "text": "then wait wait for a few milliseconds then it's done and you can safely kill it no this is a long running hours connection",
    "start": "882880",
    "end": "890959"
  },
  {
    "text": "so if you reload here's what hip proxy does and here's exactly exact is exactly",
    "start": "890959",
    "end": "896880"
  },
  {
    "text": "what what envoy does they don't mention that which is deceiving i don't like that",
    "start": "896880",
    "end": "903120"
  },
  {
    "text": "envoy and he proxy does exactly the same thing when you reload their configuration they spin up a new process they reload",
    "start": "903120",
    "end": "910079"
  },
  {
    "text": "the configuration and the old process they communicate with with each other the old process and the",
    "start": "910079",
    "end": "917040"
  },
  {
    "text": "new process and then they they essentially exchange information and then the the the old the new process tells the whole",
    "start": "917040",
    "end": "923279"
  },
  {
    "text": "process to start draining connection as we explained and then what will happen is those can though all",
    "start": "923279",
    "end": "929519"
  },
  {
    "text": "process connection will be lingering and running for hours right guess what",
    "start": "929519",
    "end": "936079"
  },
  {
    "text": "invoice has the exact same problem if you do it this way but they didn't mention that i read the",
    "start": "936079",
    "end": "942320"
  },
  {
    "text": "whole thing i'm going to mention it today both haproxy and both envoy when you reload them they",
    "start": "942320",
    "end": "949680"
  },
  {
    "text": "do zero dropping the connection they don't drop the connection h a processor does not drop any connections and during the relearn",
    "start": "949680",
    "end": "955680"
  },
  {
    "text": "nor does envoy but they only mentioned that hell envoy doesn't drop connection it's a proxy they say hey they didn't",
    "start": "955680",
    "end": "961519"
  },
  {
    "text": "say anything they don't mention that http proxy which is again deceiving it's not it's not cool guys if you",
    "start": "961519",
    "end": "969199"
  },
  {
    "text": "you're gonna do your homework if you want to write an article don't write it as a hit piece just do the ways way the things",
    "start": "969199",
    "end": "977519"
  },
  {
    "text": "i don't know guys do you agree with me here do you think don't you don't you think this is unfair a little bit i don't know",
    "start": "977519",
    "end": "984399"
  },
  {
    "text": "okay let's go on but i'm going to give you i'm going to give you now the point the plus point to envoy here's the",
    "start": "984399",
    "end": "991040"
  },
  {
    "text": "possibility to envoy that hip proxy does not have as far as i know",
    "start": "991040",
    "end": "996160"
  },
  {
    "text": "envoy allows us to use dynamically configure clusters and input which means it does not need to be",
    "start": "996160",
    "end": "1002959"
  },
  {
    "text": "reloaded if the endpoint listed that's a plus for envoy i'm gonna give you that",
    "start": "1002959",
    "end": "1008839"
  },
  {
    "text": "because most of the 90 percent of the operation",
    "start": "1008839",
    "end": "1014240"
  },
  {
    "text": "i just made up number from my ass our back end endpoint",
    "start": "1014240",
    "end": "1019839"
  },
  {
    "text": "updates the configurations envoy technically you don't need to",
    "start": "1019839",
    "end": "1025038"
  },
  {
    "text": "change that configuration they have a way to dynamically update that which technically haproxy has the same",
    "start": "1025039",
    "end": "1032319"
  },
  {
    "text": "thing right it's just you have to write code to update the runtime api invoice has it dynamically it could it",
    "start": "1032319",
    "end": "1038880"
  },
  {
    "text": "connect to their uh this the con their console and uh discover services and",
    "start": "1038880",
    "end": "1044160"
  },
  {
    "text": "as you these services start discovering will automatically be loaded in envoy which is very",
    "start": "1044160",
    "end": "1050160"
  },
  {
    "text": "attractive without loading the configuration that's the abstractive",
    "start": "1050160",
    "end": "1055679"
  },
  {
    "text": "point that's where they should focus they should say hey hp proxy doesn't have that we have this it's we don't have to write",
    "start": "1055679",
    "end": "1061280"
  },
  {
    "text": "code envoy just takes care of that that's a plus for envoy okay",
    "start": "1061280",
    "end": "1066720"
  },
  {
    "text": "if you use hi proxy to update back ends through the configuration directly",
    "start": "1066720",
    "end": "1072000"
  },
  {
    "text": "unfortunately we have to reload and when you reload you're gonna have the old processes lingering and",
    "start": "1072000",
    "end": "1079039"
  },
  {
    "text": "the new processes and then you have a lot of processes running and they didn't want that a lot of processes that means a lot of",
    "start": "1079039",
    "end": "1084559"
  },
  {
    "text": "memory that means obviously things can go wrong now invoice has the ability to hot",
    "start": "1084559",
    "end": "1091360"
  },
  {
    "text": "restart itself without dropping any connection so does h a proxy",
    "start": "1091360",
    "end": "1098320"
  },
  {
    "text": "they don't say that obviously right it's like it's like an ad for envoy that's what that's what we're",
    "start": "1099280",
    "end": "1105039"
  },
  {
    "text": "reading we're reading an ad guys it's an ad read here it's an ad read enjoy this ad read for envoy",
    "start": "1105039",
    "end": "1111520"
  },
  {
    "text": "envoy watches file system configuration with i notify update so as the configuration changes they",
    "start": "1111520",
    "end": "1117200"
  },
  {
    "text": "essentially do a hot restart so that uh it it does a",
    "start": "1117200",
    "end": "1122480"
  },
  {
    "text": "hit list of updates essentially so that if they want to change the configuration for invoice which has nothing to do",
    "start": "1122480",
    "end": "1128400"
  },
  {
    "text": "if something has nothing to do with endpoint like something else right i don't know adding a rule for example you have to change the",
    "start": "1128400",
    "end": "1134160"
  },
  {
    "text": "configuration right that requires a restart and when you do a restart",
    "start": "1134160",
    "end": "1139520"
  },
  {
    "text": "guys when you do that you have to mention that they did not mention it if you change a",
    "start": "1139520",
    "end": "1145600"
  },
  {
    "text": "rule in envoy you gotta update the configuration and when you do that new processes will benefit up and all",
    "start": "1145600",
    "end": "1152480"
  },
  {
    "text": "processes will be kept running they did not mention that that's exactly the same thing that",
    "start": "1152480",
    "end": "1157679"
  },
  {
    "text": "they claim that's the limitation of hr proxy they have that and boy have that but the good point",
    "start": "1157679",
    "end": "1164240"
  },
  {
    "text": "here that i'm gonna give them they don't do that as often that's my ex assumption they don't do that as often",
    "start": "1164240",
    "end": "1170480"
  },
  {
    "text": "and as a result they don't run into that problem as often okay",
    "start": "1170480",
    "end": "1175760"
  },
  {
    "text": "so that's a plus for invoice but again the article is written in a very odd way to to as i said as as i said it's an ad",
    "start": "1175760",
    "end": "1183200"
  },
  {
    "text": "read let's add another plus for invoice here okay another plus for invoice",
    "start": "1183200",
    "end": "1190320"
  },
  {
    "start": "1190000",
    "end": "1330000"
  },
  {
    "text": "panic routing guys i now they are mentioning the january 4th",
    "start": "1190640",
    "end": "1195760"
  },
  {
    "text": "2021 outage which i covered right here if you want to interested if you're interested read go watch my video full analysis about the",
    "start": "1195760",
    "end": "1202880"
  },
  {
    "text": "outage it was very very interesting uh to learn it was essentially a as as a result from",
    "start": "1202880",
    "end": "1208880"
  },
  {
    "text": "amazon their their cloud provider there was like a network latency",
    "start": "1208880",
    "end": "1214000"
  },
  {
    "text": "and that caused all sorts of havoc right but envoy actually helped them here",
    "start": "1214000",
    "end": "1221120"
  },
  {
    "text": "now when a back-end is marked unhealthy h a proxy or any other proxy will",
    "start": "1221120",
    "end": "1227760"
  },
  {
    "text": "naturally will not forward traffic to it as far as we know right",
    "start": "1227760",
    "end": "1232880"
  },
  {
    "text": "but envoy here has a mood that cause panic routing they say hey",
    "start": "1232880",
    "end": "1238559"
  },
  {
    "text": "there's a lot of unhealthy back end services that is a little bit suspicious",
    "start": "1238559",
    "end": "1243840"
  },
  {
    "text": "i'm going to ignore the status of the health i'm gonna forward the traffic anyway to",
    "start": "1243840",
    "end": "1251280"
  },
  {
    "text": "it that's called panic routing and it did help it was very helpful during our january fourth coat code this",
    "start": "1251280",
    "end": "1259200"
  },
  {
    "text": "was very helpful during our january 4 2021 outage which was caused by a widespread network",
    "start": "1259200",
    "end": "1264480"
  },
  {
    "text": "problems in our infrastructure here they mentioned because of the above coat because of the above reasons",
    "start": "1264480",
    "end": "1270000"
  },
  {
    "text": "in 2019 we decided to migrate our ingers load balance tiers from hi proxy to envoy",
    "start": "1270000",
    "end": "1275600"
  },
  {
    "text": "proxy starting with the websocket stack the major goals of the migration were to improved operability",
    "start": "1275600",
    "end": "1282320"
  },
  {
    "text": "access to new features that invoice provides and more standardization by moving from hi proxy to envoy across all of stack",
    "start": "1282320",
    "end": "1289520"
  },
  {
    "text": "we would eliminate the need for our team to know two quirks of pieces of software i",
    "start": "1289520",
    "end": "1295360"
  },
  {
    "text": "believe that is the major reason guys because the the engineers at slack have",
    "start": "1295360",
    "end": "1302480"
  },
  {
    "text": "more experience with envoy apparently they might hire new guys they want to instant",
    "start": "1302480",
    "end": "1308960"
  },
  {
    "text": "maintaining two software they wanted to maintain one which makes sense fiscally and financially and everything",
    "start": "1308960",
    "end": "1314720"
  },
  {
    "text": "right makes sense right so they just say moved it but the way they wrote this article is just",
    "start": "1314720",
    "end": "1321360"
  },
  {
    "text": "they they painted the proxy proxy as like the the worst thing which is which is not good in my",
    "start": "1321360",
    "end": "1327679"
  },
  {
    "text": "opinion i don't like that to manage to manage to build and release pipeline",
    "start": "1327679",
    "end": "1333679"
  },
  {
    "start": "1330000",
    "end": "1355000"
  },
  {
    "text": "and so on by then we were already using invoice proxy as the data plane in our service mesh",
    "start": "1333679",
    "end": "1339760"
  },
  {
    "text": "we also have experience in void developer in-house so we have ready access to invo",
    "start": "1339760",
    "end": "1346000"
  },
  {
    "text": "expertise right the next section is not interesting for me it's just how they use chef to update they generate their envoy",
    "start": "1346000",
    "end": "1352240"
  },
  {
    "text": "configuration you can read it for yourself but um let's skip all that stuff right here's here's the interesting part",
    "start": "1352240",
    "end": "1358320"
  },
  {
    "start": "1355000",
    "end": "1560000"
  },
  {
    "text": "migration to production uh before we migrate that i'm gonna",
    "start": "1358320",
    "end": "1365360"
  },
  {
    "text": "mention something that they did not mention here um and the fact that they didn't mention",
    "start": "1365360",
    "end": "1371919"
  },
  {
    "text": "it that means they are not using it i'm assuming and here is it there is this a beautiful",
    "start": "1371919",
    "end": "1377120"
  },
  {
    "text": "rfc that's called rfc841 i i talked about it right here and it's essentially the bootstrapping",
    "start": "1377120",
    "end": "1383760"
  },
  {
    "text": "of whop sockets on top of hdb2 okay guys when we use websockets on",
    "start": "1383760",
    "end": "1390080"
  },
  {
    "text": "http1 we're going to have a one-to-one connection with every single client to a back-end",
    "start": "1390080",
    "end": "1395440"
  },
  {
    "text": "connection to a back-end server to a back-end tcp connection which is wasteful if you have slack",
    "start": "1395440",
    "end": "1400960"
  },
  {
    "text": "amount of connections millions of connection right if we used http 2 on the back end",
    "start": "1400960",
    "end": "1408880"
  },
  {
    "text": "and it doesn't matter what we're using the front end",
    "start": "1408880",
    "end": "1413840"
  },
  {
    "text": "slack can multiplex websocket connection into http stream so",
    "start": "1414159",
    "end": "1421919"
  },
  {
    "text": "you can have effectively one tcp connection uh having hdb2 right and then",
    "start": "1421919",
    "end": "1430320"
  },
  {
    "text": "if you have a websocket connection coming from h1 client from the front end you can multiplex",
    "start": "1430320",
    "end": "1436720"
  },
  {
    "text": "that into an h2 stream in a single stream in a bigger tcp connection",
    "start": "1436720",
    "end": "1442880"
  },
  {
    "text": "so now you have one tcp cancer server i know thousands of clients i think that the maximum is 200 streams",
    "start": "1442880",
    "end": "1449279"
  },
  {
    "text": "but you can flip and play with that so now you minimize the number of tcp connections which is obviously better it's better to have",
    "start": "1449279",
    "end": "1456480"
  },
  {
    "text": "less connections than more connections right so that is a feature of invoice that is",
    "start": "1456480",
    "end": "1462000"
  },
  {
    "text": "not yet available in here proxy yet they didn't mention that i don't know why are they not aware of",
    "start": "1462000",
    "end": "1468480"
  },
  {
    "text": "that because that seems like a very attractive feature for you guys at slack",
    "start": "1468480",
    "end": "1475919"
  },
  {
    "text": "you're going to have a single tcp connection with multiplexed warp socket connections now you've just",
    "start": "1475919",
    "end": "1481600"
  },
  {
    "text": "minimized the number of connections that you're backing i'm just interested if they are considering this or not that would be",
    "start": "1481600",
    "end": "1487679"
  },
  {
    "text": "very interesting too if they studied that or not because invoice they can just lie this up",
    "start": "1487679",
    "end": "1493039"
  },
  {
    "text": "with a with a configuration right if their backend is hdb2 i'm assuming that their actual end those",
    "start": "1493039",
    "end": "1499679"
  },
  {
    "text": "guys those puppies the backing is hdb11 maybe and essentially hdb11 with tls",
    "start": "1499679",
    "end": "1505840"
  },
  {
    "text": "that's my assumption right again i might be wrong in anything i say here it would be good to have someone from",
    "start": "1505840",
    "end": "1511360"
  },
  {
    "text": "slack comment on this it'll be really good all right now that we mentioned the rfc841 which i",
    "start": "1511360",
    "end": "1517440"
  },
  {
    "text": "explained that uh hp proxy is actually developing that feature right now in two four and that's going",
    "start": "1517440",
    "end": "1524240"
  },
  {
    "text": "to be there obviously guys i'm not sponsored by any of that envoy or proxy or anything i just",
    "start": "1524240",
    "end": "1530559"
  },
  {
    "text": "i'm an engineer that gives you my personal opinion you can take it or leave it right and then and you get to decide",
    "start": "1530559",
    "end": "1537279"
  },
  {
    "text": "whether this product is good or this product is as a fit for you again really depends on",
    "start": "1537279",
    "end": "1542799"
  },
  {
    "text": "your use case so this is a migration of the of production and i absolutely loved this the way they did this",
    "start": "1542799",
    "end": "1548880"
  },
  {
    "text": "absolutely love them they use that uh obviously this is the dwss",
    "start": "1548880",
    "end": "1554080"
  },
  {
    "text": "dns entry primary wss primary.select.com the dns at the dns they did a weighted traffic",
    "start": "1554080",
    "end": "1561120"
  },
  {
    "start": "1560000",
    "end": "1625000"
  },
  {
    "text": "so that for the listeners here we're describing a diagram",
    "start": "1561120",
    "end": "1567120"
  },
  {
    "text": "with two boxes the upper box is h a proxy no network load balancer",
    "start": "1567120",
    "end": "1573679"
  },
  {
    "text": "and the lower box is the invoice network load balancer and there's the name server here with",
    "start": "1573679",
    "end": "1578880"
  },
  {
    "text": "two arrows going to the upper box and the lower block the upper box taking seventy percent uh",
    "start": "1578880",
    "end": "1584640"
  },
  {
    "text": "of the traffic that means seventy percent of the resolutions of the dns goes to the hi",
    "start": "1584640",
    "end": "1590000"
  },
  {
    "text": "proxy and 25 goes to the envoy beautiful i love this this is how they essentially migrated everything",
    "start": "1590000",
    "end": "1596960"
  },
  {
    "text": "so slowly they decreased the amount of the routed weighted router to higher proxy",
    "start": "1596960",
    "end": "1603120"
  },
  {
    "text": "and they moved everything to invoice and until a share proxy essentially took zero",
    "start": "1603120",
    "end": "1608400"
  },
  {
    "text": "connections and they moved everything to envoy they ran into a few problems while doing that but they fixed all of them",
    "start": "1608400",
    "end": "1615039"
  },
  {
    "text": "obviously so um and yeah that's how they migrated into the production which i absolutely loved",
    "start": "1615039",
    "end": "1621760"
  },
  {
    "text": "very they they it was it was boring and good so it was smooth right here uh they",
    "start": "1621760",
    "end": "1629919"
  },
  {
    "start": "1625000",
    "end": "1685000"
  },
  {
    "text": "they take a hit at the high proxy config which i could we found that old h.a proxy config",
    "start": "1629919",
    "end": "1635679"
  },
  {
    "text": "had grown organically over time it was largely shaped by the model that ship proxy uses",
    "start": "1635679",
    "end": "1641039"
  },
  {
    "text": "one large configuration that includes all listeners invoice configuration model uses much more defined scopes",
    "start": "1641039",
    "end": "1647200"
  },
  {
    "text": "that is than hip proxy model once a listener is returned only the rule inside the listener apply",
    "start": "1647200",
    "end": "1654880"
  },
  {
    "text": "to the request once a route is entered only the rules apply we know how",
    "start": "1654880",
    "end": "1659919"
  },
  {
    "text": "how this configuration looks like an invoice it's a nested rule so it's like you can read it this",
    "start": "1659919",
    "end": "1665760"
  },
  {
    "text": "way but what they mention is like it took us a lot of time to extract what",
    "start": "1665760",
    "end": "1672159"
  },
  {
    "text": "was important in the old ha proxy configuration which from what was effectively technical debt so",
    "start": "1672159",
    "end": "1677279"
  },
  {
    "text": "they had a lot of rules from the actual proxy configuration they didn't know why do we have it but they they have it",
    "start": "1677279",
    "end": "1684080"
  },
  {
    "text": "laying around essentially right so to them maybe it's a personal thing but",
    "start": "1684080",
    "end": "1689600"
  },
  {
    "start": "1685000",
    "end": "1835000"
  },
  {
    "text": "to them looks like slack prefer invoice configuration reading engine invoice configuration",
    "start": "1689600",
    "end": "1695919"
  },
  {
    "text": "over here proxy i'm going to leave you as a listener and now i'm going to show you two configuration",
    "start": "1695919",
    "end": "1701520"
  },
  {
    "text": "the first one is an hr proxy though the first one is an hr proxy configuration the second one is envoy",
    "start": "1701520",
    "end": "1707120"
  },
  {
    "text": "they are identical okay but look at h a proxy configuration and look at",
    "start": "1707120",
    "end": "1712240"
  },
  {
    "text": "envoy and you tell me which one is simpler to read",
    "start": "1712240",
    "end": "1717520"
  },
  {
    "text": "to me it's definitely hi proxy right that being said i do not know how",
    "start": "1717520",
    "end": "1724960"
  },
  {
    "text": "big is the configuration as slack and how large and how that scales with a lot of requests",
    "start": "1724960",
    "end": "1730880"
  },
  {
    "text": "i'm i'm not gonna guess that invoice gonna be less size because at as a smaller",
    "start": "1730880",
    "end": "1736960"
  },
  {
    "text": "if i'm building a smaller hdb server and i wrote only 10 lines for a jproxy config versus i don't know 36 or 40 lines",
    "start": "1736960",
    "end": "1745120"
  },
  {
    "text": "and it's harder to read and you guys go watch my envoy video and see the pain how i pulled my teeth writing",
    "start": "1745120",
    "end": "1752159"
  },
  {
    "text": "those configuration because invoice written in a way again i'm not dissing any",
    "start": "1752159",
    "end": "1757760"
  },
  {
    "text": "technology here i'm giving you my personal opinion and you can see the pain that i went through writing those configurations they have",
    "start": "1757760",
    "end": "1764000"
  },
  {
    "text": "these large class names and i understand why they have that because they want to make envoy",
    "start": "1764000",
    "end": "1770159"
  },
  {
    "text": "extensible you know the whole mantra of open for extension closed for modification which we know",
    "start": "1770159",
    "end": "1776640"
  },
  {
    "text": "about this is the object-oriented mantra right so that's why they have class names so you can write your own class name to be",
    "start": "1776640",
    "end": "1782799"
  },
  {
    "text": "anything so you can extend and void that's why envoy became popular and a lot of like stu essentially built on top of",
    "start": "1782799",
    "end": "1790080"
  },
  {
    "text": "invoice because you can easily extend it which is nice but to end users engineers reading that thing",
    "start": "1790080",
    "end": "1796559"
  },
  {
    "text": "is just a completely unreadable very very hard you can argue that hey let's say what how many times how much",
    "start": "1796559",
    "end": "1803600"
  },
  {
    "text": "time do you spend reading configuration well a lot actually so i want my configuration to be simple",
    "start": "1803600",
    "end": "1809039"
  },
  {
    "text": "and the other atrocious thing is they use this stinking thing that's called the ammo which i absolutely hate right and",
    "start": "1809039",
    "end": "1817600"
  },
  {
    "text": "i think that will struggle with spaces and taps and all that stuff right so you have to have tools to write",
    "start": "1817600",
    "end": "1823279"
  },
  {
    "text": "configuration which is like what uh yeah so invoice is good",
    "start": "1823279",
    "end": "1829840"
  },
  {
    "text": "h8 proxy is good guys both of them are good some features uh",
    "start": "1829840",
    "end": "1836240"
  },
  {
    "start": "1835000",
    "end": "1930000"
  },
  {
    "text": "some features that envoy essentially are better for slack in this case the",
    "start": "1836240",
    "end": "1843200"
  },
  {
    "text": "http 2 uh websocket socket on the double hdb2 is a good one they didn't mention i",
    "start": "1843200",
    "end": "1849039"
  },
  {
    "text": "don't know if they're using it or not or are they planning to he proxy does not have that yet they are developing",
    "start": "1849039",
    "end": "1855279"
  },
  {
    "text": "there but again the idea of features is moved because any any proxy unless it's an",
    "start": "1855279",
    "end": "1861919"
  },
  {
    "text": "architectural low-level change any proxy can implement any feature and can catch up so features having",
    "start": "1861919",
    "end": "1868559"
  },
  {
    "text": "features is not really uh a criteria i guess for that's one of the",
    "start": "1868559",
    "end": "1875760"
  },
  {
    "text": "criteria but it's not the major criteria because proxies can pick it up software can pick",
    "start": "1875760",
    "end": "1880799"
  },
  {
    "text": "up features like that easily especially if you have teams behind it but",
    "start": "1880799",
    "end": "1886240"
  },
  {
    "text": "the simplicity the scalability of the things and then envoy did have an edge over here proxy i",
    "start": "1886240",
    "end": "1894480"
  },
  {
    "text": "gotta say the dynamic input loading is an edge for envoy overhead proxy",
    "start": "1894480",
    "end": "1902640"
  },
  {
    "text": "so that means they don't have to reload it as often but sometimes they do have it to reload it",
    "start": "1902640",
    "end": "1908320"
  },
  {
    "text": "all right here's another feature i forgot to mention and i'm not sure if aj proxy supports",
    "start": "1908320",
    "end": "1913919"
  },
  {
    "text": "that but here's the thing in case and they don't mention this here they actually uh let's go through that",
    "start": "1913919",
    "end": "1921360"
  },
  {
    "text": "actually the hotter is starting let's go up through invite now read through now we're reading through the hot",
    "start": "1921360",
    "end": "1926799"
  },
  {
    "text": "restart feature in in envoy and i'm not sure that he proxy or other",
    "start": "1926799",
    "end": "1931840"
  },
  {
    "start": "1930000",
    "end": "2096000"
  },
  {
    "text": "proxies support that this is this is a game changer this is good stuff so let's read it in this discuss",
    "start": "1931840",
    "end": "1938799"
  },
  {
    "text": "code invoice supported was designed so that it will work correctly even if the new process",
    "start": "1938799",
    "end": "1944399"
  },
  {
    "text": "that is being spun up obviously after you reload the configuration and the old invoice process are running",
    "start": "1944399",
    "end": "1950799"
  },
  {
    "text": "inside different containers so you could be different containers",
    "start": "1950799",
    "end": "1956320"
  },
  {
    "text": "different operating systems all together different machines",
    "start": "1956320",
    "end": "1963200"
  },
  {
    "text": "communication between the processes takes place only using unix domains so we talked about the communication",
    "start": "1963200",
    "end": "1968720"
  },
  {
    "text": "between the processes itself which he proxy does right the picture box is",
    "start": "1968720",
    "end": "1974080"
  },
  {
    "text": "still communicated between the old process and the new process to to effectively kind of gossip and tell the old process",
    "start": "1974080",
    "end": "1981200"
  },
  {
    "text": "hey start draining hey stop accepting connection hey do this hey do that copy copy the list file",
    "start": "1981200",
    "end": "1988399"
  },
  {
    "text": "descriptors give me the your listener sockets all that stuff there is happening invoice here says hey",
    "start": "1988399",
    "end": "1996080"
  },
  {
    "text": "we do that even if you reload in a completely",
    "start": "1996080",
    "end": "2001200"
  },
  {
    "text": "different process we will find that old process and we're going to communicate with it",
    "start": "2001200",
    "end": "2006559"
  },
  {
    "text": "so in kubernetes this thing is really powerful right in kubernetes where everything is",
    "start": "2006559",
    "end": "2012240"
  },
  {
    "text": "stateless where you can shut down and reload and the new process will be in a completely different container that's a",
    "start": "2012240",
    "end": "2018399"
  },
  {
    "text": "plus and i'm pretty sure other processes will start picking this up as they become",
    "start": "2018399",
    "end": "2024240"
  },
  {
    "text": "cloud native all right guys that is it for me today i think i",
    "start": "2024240",
    "end": "2030559"
  },
  {
    "text": "discussed all that i wanted to discuss what do you think about this article regardless of whatever i said here",
    "start": "2030559",
    "end": "2037120"
  },
  {
    "text": "i love technology i love these kind of discussions right and i believe we learned a lot",
    "start": "2037120",
    "end": "2044080"
  },
  {
    "text": "from this article so ariane and rada thank you so much for an absolutely",
    "start": "2044080",
    "end": "2049839"
  },
  {
    "text": "amazing well-written article we have obviously we with every article we have criticism so",
    "start": "2049839",
    "end": "2055118"
  },
  {
    "text": "let's take it with a sportsmanship here and yeah at the end of the day hyperboxes",
    "start": "2055119",
    "end": "2060240"
  },
  {
    "text": "didn't work for slack they moved to envoy and they're happy so i commend all the engineers",
    "start": "2060240",
    "end": "2066720"
  },
  {
    "text": "uh slack who worked very hard to do the migration to implement this thing",
    "start": "2066720",
    "end": "2072480"
  },
  {
    "text": "and they wrote obviously a lot of code to get this running it wasn't smooth because",
    "start": "2072480",
    "end": "2078320"
  },
  {
    "text": "they found that there are features that are in nature proxy that is not available in invoice so they started",
    "start": "2078320",
    "end": "2084320"
  },
  {
    "text": "they had to rewrite this stuff and shaft their custom configuration all right guys what do you think about",
    "start": "2084320",
    "end": "2089919"
  },
  {
    "text": "this article let me know in the comment section below i'm gonna see you on the next one you guys stay awesome goodbye",
    "start": "2089919",
    "end": "2098159"
  }
]