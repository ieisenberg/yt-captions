[
  {
    "start": "0",
    "end": "60000"
  },
  {
    "text": "database logs are a critical component of any dbms",
    "start": "799",
    "end": "6399"
  },
  {
    "text": "system in order to ensure durability and",
    "start": "6399",
    "end": "12000"
  },
  {
    "text": "crash recovery if you will so logs like",
    "start": "12000",
    "end": "17039"
  },
  {
    "text": "uh i'm referring to logs such as the right ahead log or wall for short",
    "start": "17039",
    "end": "24240"
  },
  {
    "text": "wal that is uh the redo logs",
    "start": "24240",
    "end": "29279"
  },
  {
    "text": "and the undo logs uh these are the only three that i know there might be other type of logs that",
    "start": "29279",
    "end": "35920"
  },
  {
    "text": "are there for specific implementation but i think these are the three most popular",
    "start": "35920",
    "end": "41520"
  },
  {
    "text": "uh in fact you can argue that the wall is actually identical to the redo logs",
    "start": "41520",
    "end": "48399"
  },
  {
    "text": "you know and i'm gonna talk about all of this in this episode of the backend engineering show it's been a while",
    "start": "48399",
    "end": "54160"
  },
  {
    "text": "and i'm almost recovered now so i can do videos like this yay",
    "start": "54160",
    "end": "60079"
  },
  {
    "start": "60000",
    "end": "210000"
  },
  {
    "text": "nice coffee time speaking of coffee i partnered with a company called",
    "start": "60079",
    "end": "66880"
  },
  {
    "text": "clemeter they do fantastic",
    "start": "66880",
    "end": "72320"
  },
  {
    "text": "coffee you know when you brew coffee um there are so many things that you need",
    "start": "72320",
    "end": "80080"
  },
  {
    "text": "to do uh to to nail the quantity of the beans",
    "start": "80080",
    "end": "88479"
  },
  {
    "text": "first to grind them in a specific size how coarse how fine the",
    "start": "88479",
    "end": "96400"
  },
  {
    "text": "the beans need to be grinded and once you grind it then",
    "start": "96400",
    "end": "102000"
  },
  {
    "text": "you brew them by basically pouring water into them right",
    "start": "102000",
    "end": "107119"
  },
  {
    "text": "and the temperature of water really affect the taste of the final",
    "start": "107119",
    "end": "113840"
  },
  {
    "text": "product which is the coffee you can get into warm uh",
    "start": "113840",
    "end": "119840"
  },
  {
    "text": "warm coffee if you put too cold of a coffee then you get basically",
    "start": "119840",
    "end": "125920"
  },
  {
    "text": "water flavored coffee you know if you will or coffee flavored water if you were too hot then you feel the burn",
    "start": "125920",
    "end": "132640"
  },
  {
    "text": "and that's what you basically taste in diners coffees and it's like always like burned and some people enjoy the burned",
    "start": "132640",
    "end": "138720"
  },
  {
    "text": "flavor that's why we have dark roast and this is like a side of me that i don't talk about in this youtube",
    "start": "138720",
    "end": "145200"
  },
  {
    "text": "channel i usually talk about an instagram but uh cometier",
    "start": "145200",
    "end": "151360"
  },
  {
    "text": "what they do is they they nail all these parameters in a perfect manner",
    "start": "151519",
    "end": "156800"
  },
  {
    "text": "and then brew the coffee for you",
    "start": "156800",
    "end": "162959"
  },
  {
    "text": "and then they flash freeze it at that moment of time and they send you these nice capsules so",
    "start": "162959",
    "end": "170400"
  },
  {
    "text": "what you do is you take these capsules and you just",
    "start": "170400",
    "end": "176319"
  },
  {
    "text": "take it out put in a glass water pour hot water and that's it",
    "start": "176319",
    "end": "182879"
  },
  {
    "text": "you enjoy that cup of color and this is actually committee this is um",
    "start": "182879",
    "end": "190560"
  },
  {
    "text": "dominance making this is onyx coffee so it's a medium roast but it's fantastic",
    "start": "190560",
    "end": "195680"
  },
  {
    "text": "so i'll leave it i'll leave a link below if you're interested go to commentary.com",
    "start": "195680",
    "end": "201280"
  },
  {
    "text": "for uh twenty dollar off your first order and thank you for coming here",
    "start": "201280",
    "end": "207920"
  },
  {
    "text": "welcome to the backend engineering show with your host hussein nasser and",
    "start": "207920",
    "end": "214319"
  },
  {
    "start": "210000",
    "end": "360000"
  },
  {
    "text": "if we really think about durability in database system",
    "start": "214319",
    "end": "222000"
  },
  {
    "text": "you are you really need to think about how do you persist data right",
    "start": "222000",
    "end": "230879"
  },
  {
    "text": "well you might say i say okay you have tables you have data structures on those tables such as",
    "start": "230879",
    "end": "236400"
  },
  {
    "text": "indexes indexes sequences constraints stuff like that",
    "start": "236400",
    "end": "241840"
  },
  {
    "text": "and these live in files because that's what we have today file system so",
    "start": "241840",
    "end": "247200"
  },
  {
    "text": "we have to work with files you might argue with that no we can work with block storage directly",
    "start": "247200",
    "end": "253200"
  },
  {
    "text": "but most generic implementations work with files and there are pros and cons",
    "start": "253200",
    "end": "258880"
  },
  {
    "text": "right to that right and i like to always think about this",
    "start": "258880",
    "end": "265600"
  },
  {
    "text": "think about there is not only one way to do thing and never pitch and hold your thing into one",
    "start": "265600",
    "end": "273520"
  },
  {
    "text": "thing you know always look outside the box as cheesy as it may sound",
    "start": "273520",
    "end": "278880"
  },
  {
    "text": "you know trying to look outside the box and then understand why",
    "start": "278880",
    "end": "286479"
  },
  {
    "text": "do you do you say the things you say",
    "start": "287040",
    "end": "292960"
  },
  {
    "text": "you know so if things live in files and we're working with data files so table live in",
    "start": "292960",
    "end": "299520"
  },
  {
    "text": "a data file indexes live in a data file and this is up to you as the database implementer to whether to put these two",
    "start": "299520",
    "end": "307039"
  },
  {
    "text": "into one file or put them in separate files there are pros and cons for both cases right",
    "start": "307039",
    "end": "313120"
  },
  {
    "text": "and whether you put all indexes in one file or put each index in one file in its own",
    "start": "313120",
    "end": "320000"
  },
  {
    "text": "file it all really depends on the implementation then this is something we never think",
    "start": "320000",
    "end": "327039"
  },
  {
    "text": "about as back in engineers like because hey it's behind",
    "start": "327039",
    "end": "332160"
  },
  {
    "text": "black box and the database does this thing but it's good to understand how databases are going to the database is",
    "start": "332160",
    "end": "337919"
  },
  {
    "text": "just a program at the end of the day right it's now really",
    "start": "337919",
    "end": "343199"
  },
  {
    "text": "well what i was about to say rocket science but you can argue it is as complex as rocket",
    "start": "343199",
    "end": "350160"
  },
  {
    "text": "science database engineer um",
    "start": "350160",
    "end": "355199"
  },
  {
    "text": "so when when i make a change as a transaction i begin my transaction i",
    "start": "355199",
    "end": "360960"
  },
  {
    "start": "360000",
    "end": "570000"
  },
  {
    "text": "start changing my table the changes that i make to my table will trigger side behavior",
    "start": "360960",
    "end": "368080"
  },
  {
    "text": "to update indexes and these indexes need to be updated as a result",
    "start": "368080",
    "end": "374880"
  },
  {
    "text": "and the tables need to be updated as a result the tables consist of pages and the",
    "start": "374880",
    "end": "380479"
  },
  {
    "text": "pages are touched and getting dirty and there's a little at the end of the day we we gonna say",
    "start": "380479",
    "end": "387120"
  },
  {
    "text": "commit my changes i just made a bunch of changes go ahead and commit them",
    "start": "387120",
    "end": "393400"
  },
  {
    "text": "now if i say commit my changes",
    "start": "394240",
    "end": "400000"
  },
  {
    "text": "what does that mean it means logically",
    "start": "400560",
    "end": "407039"
  },
  {
    "text": "i want anything that's highest high level speak everything that i wrote i want to be",
    "start": "407039",
    "end": "414400"
  },
  {
    "text": "there forever i want to see it next time i read",
    "start": "414400",
    "end": "420840"
  },
  {
    "text": "right and this means i want it to be doable that means if the",
    "start": "420840",
    "end": "426080"
  },
  {
    "text": "day was shut down after i successfully committed",
    "start": "426080",
    "end": "431440"
  },
  {
    "text": "that's another thing what does it mean to successfully commit it means i receive a successful",
    "start": "431440",
    "end": "437840"
  },
  {
    "text": "synchronous response from my commit operation so i say",
    "start": "437840",
    "end": "442880"
  },
  {
    "text": "yep all done when you tell me yup all done i assume that even if i shut you",
    "start": "442880",
    "end": "449280"
  },
  {
    "text": "there down in that second if i unplug you i come back",
    "start": "449280",
    "end": "455919"
  },
  {
    "text": "everything that i wrote should be there so if we go back to this commit operation for a minute",
    "start": "455919",
    "end": "462800"
  },
  {
    "text": "and ask yourself how is this actually implemented how can i implement it let's",
    "start": "462800",
    "end": "468160"
  },
  {
    "text": "not get pigeonholed again with implementation one way you would implement it and say",
    "start": "468160",
    "end": "474080"
  },
  {
    "text": "okay anytime i write if i begin my transaction i start",
    "start": "474080",
    "end": "480160"
  },
  {
    "text": "updating a row and inserting a new row and i doing all these changes and i update the indexes",
    "start": "480160",
    "end": "486000"
  },
  {
    "text": "i am going to make all these changes in memory because you see if i want to",
    "start": "486000",
    "end": "491919"
  },
  {
    "text": "update row number seven i need to fetch the page where row number seven lives",
    "start": "491919",
    "end": "498160"
  },
  {
    "text": "and update the page in memory that's what i'm gonna do that's one implementation i'm gonna write in memory",
    "start": "498160",
    "end": "505360"
  },
  {
    "text": "then i'm going to insert a new row on the same page in memory and then i'm going to insert another row",
    "start": "505360",
    "end": "511280"
  },
  {
    "text": "but this tables cluster so the page is at the end at the tail of the table so i need to",
    "start": "511280",
    "end": "516959"
  },
  {
    "text": "fish that page which put in the pool the buffer pool the memory and then right there to it and i keep",
    "start": "516959",
    "end": "523839"
  },
  {
    "text": "writing to memory writing to my writing memory and that's fine because these changes are dirty and i",
    "start": "523839",
    "end": "531040"
  },
  {
    "text": "didn't commit right now if i say if the client tells me to commit",
    "start": "531040",
    "end": "538560"
  },
  {
    "text": "i'll take everything that i have in memory and i literally just",
    "start": "538560",
    "end": "543760"
  },
  {
    "text": "flush it to disk that means i am overwriting the same location where the page existed",
    "start": "543760",
    "end": "552000"
  },
  {
    "text": "in the file with my changes and you can see if you make a lot of",
    "start": "552000",
    "end": "558720"
  },
  {
    "text": "changes the commit operation will be slow right this implementation",
    "start": "558720",
    "end": "565440"
  },
  {
    "text": "naturally because all of this stuff is your memory and you have to take time to persist these changing to disk trash",
    "start": "565440",
    "end": "574000"
  },
  {
    "start": "570000",
    "end": "660000"
  },
  {
    "text": "rises you as you write them to disk you're taking a hit you're going to the",
    "start": "574000",
    "end": "580560"
  },
  {
    "text": "disk and writing these different pages and that might take a while to write all",
    "start": "580560",
    "end": "586080"
  },
  {
    "text": "this and the problem here is not the time per se of this implementation the problem here",
    "start": "586080",
    "end": "592800"
  },
  {
    "text": "what happened if i if you wrote half of these pages and the database crash in the middle of your commit",
    "start": "592800",
    "end": "600240"
  },
  {
    "text": "that is dangerous why",
    "start": "603360",
    "end": "609040"
  },
  {
    "text": "because you just flushed something and you changed the presentation of the table",
    "start": "609040",
    "end": "617120"
  },
  {
    "text": "for a transaction that was half asked it was half committed",
    "start": "617120",
    "end": "623519"
  },
  {
    "text": "and what does it mean to have commit well it doesn't mean anything have committed transaction is a rolled",
    "start": "623519",
    "end": "628720"
  },
  {
    "text": "back transaction is a bad transaction and should not be considered",
    "start": "628720",
    "end": "634399"
  },
  {
    "text": "that's rule number one in acid transactions atomicity right",
    "start": "634399",
    "end": "640640"
  },
  {
    "text": "so that's a problem that implementation sucks right but it was so good because my",
    "start": "640880",
    "end": "647920"
  },
  {
    "text": "rights were so fast right because i am writing all my changes are in memory",
    "start": "647920",
    "end": "653600"
  },
  {
    "text": "but that sucks so what people did what computer scientists did",
    "start": "653600",
    "end": "659519"
  },
  {
    "text": "we said okay computer sciences said this what if",
    "start": "659519",
    "end": "664560"
  },
  {
    "start": "660000",
    "end": "1380000"
  },
  {
    "text": "as i am writing these dirty changes",
    "start": "664560",
    "end": "669760"
  },
  {
    "text": "i keep a log an actual journal",
    "start": "669760",
    "end": "675760"
  },
  {
    "text": "of what exactly changed not the whole thing because remember",
    "start": "675760",
    "end": "681760"
  },
  {
    "text": "when you pull a page of 6 kilobyte eight kilobyte page depending on the ssd size",
    "start": "681760",
    "end": "687120"
  },
  {
    "text": "and the database page size and how they agree on that and you change",
    "start": "687120",
    "end": "693600"
  },
  {
    "text": "one byte or you change 32 bits or whatever the",
    "start": "693600",
    "end": "699279"
  },
  {
    "text": "size you of the row you change and you said flush",
    "start": "699279",
    "end": "704399"
  },
  {
    "text": "there is no flush one byte when it comes to disk not until we get byte addressability on",
    "start": "704399",
    "end": "712240"
  },
  {
    "text": "it on ssds and hard drives it doesn't exist today you've the minimum size is",
    "start": "712240",
    "end": "718240"
  },
  {
    "text": "called and people argue about this it's called a page i believe in ssd",
    "start": "718240",
    "end": "723360"
  },
  {
    "text": "sometimes it's called the block sometimes it's called erasable unit in a database in heart this is called",
    "start": "723360",
    "end": "730079"
  },
  {
    "text": "sector there is a specific size and we don't care what is called because names don't",
    "start": "730079",
    "end": "735200"
  },
  {
    "text": "go anywhere to be honest this is i've been in this business for a long time and everybody invents a name from their",
    "start": "735200",
    "end": "741360"
  },
  {
    "text": "ass okay so you can invent your own name from your own ass",
    "start": "741360",
    "end": "746399"
  },
  {
    "text": "and be satisfied with that but what what the technology does not",
    "start": "746399",
    "end": "751519"
  },
  {
    "text": "allow us to write one byte because of physical limitation of the disk okay",
    "start": "751519",
    "end": "756639"
  },
  {
    "text": "because it's not worth it to write one byte i believe that's the reason so we write a bunch of them so if i change",
    "start": "756639",
    "end": "764160"
  },
  {
    "text": "something that i have to write 8k even if i change one thing right and",
    "start": "764160",
    "end": "770000"
  },
  {
    "text": "that's that's costly so that back to what computer scientists say okay because we have this limitation",
    "start": "770000",
    "end": "777519"
  },
  {
    "text": "and instead of i changed one thing let's keep a log of that thing that",
    "start": "777519",
    "end": "783920"
  },
  {
    "text": "changed that's a good idea and let's make sure that that log",
    "start": "783920",
    "end": "791440"
  },
  {
    "text": "is immediately persisted to disk because that log",
    "start": "791440",
    "end": "796959"
  },
  {
    "text": "that uh journal is the source of truth",
    "start": "796959",
    "end": "804639"
  },
  {
    "text": "you change this row a became b and row",
    "start": "804639",
    "end": "809680"
  },
  {
    "text": "column 7 in row 6 became this value and the",
    "start": "809680",
    "end": "814720"
  },
  {
    "text": "string hello becomes word you make changes you can't you just",
    "start": "814720",
    "end": "820079"
  },
  {
    "text": "journal the changes and this is called the right ahead log and it's called",
    "start": "820079",
    "end": "825199"
  },
  {
    "text": "right ahead because you're writing ahead of time almost like you're predicting",
    "start": "825199",
    "end": "831920"
  },
  {
    "text": "what's gonna change because that's that's that's what's gonna change",
    "start": "832000",
    "end": "838760"
  },
  {
    "text": "so",
    "start": "842720",
    "end": "844959"
  },
  {
    "text": "if i write this now and i have this log and i make sure every right i do",
    "start": "848399",
    "end": "855360"
  },
  {
    "text": "to the wall to the right ahead log is persisted to disk",
    "start": "855360",
    "end": "862000"
  },
  {
    "text": "then that's nice because i can keep my dirty pages in memory",
    "start": "862160",
    "end": "869279"
  },
  {
    "text": "and now if i say commit",
    "start": "869760",
    "end": "875440"
  },
  {
    "text": "i already written all the changes to the log i have a journal",
    "start": "877760",
    "end": "884560"
  },
  {
    "text": "of every possible thing that my transaction did and all other transactions as well",
    "start": "884560",
    "end": "890480"
  },
  {
    "text": "so i can replay this if i want to",
    "start": "890480",
    "end": "897279"
  },
  {
    "text": "so now let's let's take this into consideration again you have a presentation",
    "start": "897360",
    "end": "902560"
  },
  {
    "text": "of what the page looks like or the table looks like on disk you pulled it into memory and you start",
    "start": "902560",
    "end": "909760"
  },
  {
    "text": "making the changes in memory you still make the changes to that page in memory but you also take note of what these",
    "start": "909760",
    "end": "918079"
  },
  {
    "text": "tiny changes just what changed into this wall so the wall will be so compact and",
    "start": "918079",
    "end": "924800"
  },
  {
    "text": "it's also compressed and done all sorts of stuff to it and you flush the changes",
    "start": "924800",
    "end": "930560"
  },
  {
    "text": "to disk you keep those in memory you might say hey what you're not flushing this",
    "start": "930560",
    "end": "936399"
  },
  {
    "text": "it's okay not to flush it we're gonna talk about it we're going to need to flush it eventually but not immediately",
    "start": "936399",
    "end": "942399"
  },
  {
    "text": "because this are expensive these are large pages so now you keep all these changes",
    "start": "942399",
    "end": "950800"
  },
  {
    "text": "and now you say commit commit the transaction",
    "start": "951040",
    "end": "956079"
  },
  {
    "text": "what is the minimum amount of work that the database need to do to commit",
    "start": "956079",
    "end": "962240"
  },
  {
    "text": "well all i have to do is just commit make sure all the walls committed",
    "start": "962240",
    "end": "968399"
  },
  {
    "text": "and if the walls committed we can persist the fact that this transaction is successfully committed and we can",
    "start": "968399",
    "end": "975440"
  },
  {
    "text": "crash if we want you might say i'm saying the pages are old",
    "start": "975440",
    "end": "980560"
  },
  {
    "text": "that's true the pages in the disk still is in its original representation but the memory",
    "start": "980560",
    "end": "988240"
  },
  {
    "text": "was the final one it was it was everything we made the changes was in the memory",
    "start": "988240",
    "end": "995440"
  },
  {
    "text": "we don't have to commit that we can try later but we don't have to",
    "start": "995440",
    "end": "1001519"
  },
  {
    "text": "so let's do take this consideration that i committed and i committed all the changes in the wall",
    "start": "1001519",
    "end": "1007199"
  },
  {
    "text": "or the right ahead log and boom my database crashed but i committed",
    "start": "1007199",
    "end": "1014959"
  },
  {
    "text": "it comes back up it detected that",
    "start": "1014959",
    "end": "1020160"
  },
  {
    "text": "well the page now is completely out of sync with the wall right because the",
    "start": "1020160",
    "end": "1025280"
  },
  {
    "text": "wall is ahead in this case the right ahead log is literally ahead",
    "start": "1025280",
    "end": "1031280"
  },
  {
    "text": "of the data files the data files was the old original one so the database knows",
    "start": "1031280",
    "end": "1037120"
  },
  {
    "text": "this how does it know because there are records of this and says oh wait a",
    "start": "1037120",
    "end": "1042558"
  },
  {
    "text": "minute it starts off as a oop wait a minute",
    "start": "1042559",
    "end": "1047600"
  },
  {
    "text": "this is old i can't let people read this because nobody reads from the wall",
    "start": "1047600",
    "end": "1053440"
  },
  {
    "text": "that's another question i got from the database course uh what if i can i read it from the wall can my transaction go",
    "start": "1053440",
    "end": "1059600"
  },
  {
    "text": "to the wall and read it that's a bad idea well you can let's not say anything is a bad idea",
    "start": "1059600",
    "end": "1066000"
  },
  {
    "text": "it's just you can if you can do anything you want you own the software if you're building it you own the software you can write",
    "start": "1066000",
    "end": "1072480"
  },
  {
    "text": "anything you do you own it you can you can decide hey let's write",
    "start": "1072480",
    "end": "1078320"
  },
  {
    "text": "from the let's read from the wall the changes but the work that you have to do is",
    "start": "1078320",
    "end": "1084640"
  },
  {
    "text": "enormous and clients don't necessarily want to do that they want to read a nice tucked in",
    "start": "1084640",
    "end": "1090640"
  },
  {
    "text": "page and they want to just crack the rows and read them they don't want to just",
    "start": "1090640",
    "end": "1096640"
  },
  {
    "text": "figure things out here because remember this only has the changes you still need more stuff so you'll end up reading",
    "start": "1096640",
    "end": "1102559"
  },
  {
    "text": "multiple places so it can be done but it's hard so the database crashed and stored back",
    "start": "1102559",
    "end": "1109520"
  },
  {
    "text": "and then it detected that there was a crash",
    "start": "1109520",
    "end": "1114720"
  },
  {
    "text": "and the page that is on this is out of sync the wall is ahead of us",
    "start": "1114720",
    "end": "1120960"
  },
  {
    "text": "right the right ahead log is way ahead of us so the wall is ahead",
    "start": "1120960",
    "end": "1128720"
  },
  {
    "text": "so what does the database do takes that page and then reads it into memory he says",
    "start": "1129120",
    "end": "1136240"
  },
  {
    "text": "wait a minute let me apply",
    "start": "1136240",
    "end": "1141520"
  },
  {
    "text": "the changes in the wall to this page and then starts",
    "start": "1141520",
    "end": "1147120"
  },
  {
    "text": "redoing the changes because at one point we did that changes this is a redo of",
    "start": "1147120",
    "end": "1154559"
  },
  {
    "text": "these changes so you start to redo these changes applying these changes again because",
    "start": "1154559",
    "end": "1160799"
  },
  {
    "text": "this is have been done at one point right but we lost it now we're redoing it",
    "start": "1160799",
    "end": "1166480"
  },
  {
    "text": "that's why the wall is also called the redo log so we're redoing these changes so take",
    "start": "1166480",
    "end": "1173440"
  },
  {
    "text": "that beautiful old stale page which is consistent by the way because at that moment of time",
    "start": "1173440",
    "end": "1179600"
  },
  {
    "text": "we didn't then apply that that that that all the changes that that transaction or",
    "start": "1179600",
    "end": "1184720"
  },
  {
    "text": "other transaction made until we are done with the wall",
    "start": "1184720",
    "end": "1190320"
  },
  {
    "text": "and now that page is freshly dirty with the latest changes so i can have clients",
    "start": "1190400",
    "end": "1197919"
  },
  {
    "text": "read from this dirty page and i can safely flush this page to disk",
    "start": "1197919",
    "end": "1206240"
  },
  {
    "text": "right and now when you flush this",
    "start": "1206240",
    "end": "1213120"
  },
  {
    "text": "page to disk you're you're now consistent with the wall effect you might say now",
    "start": "1213120",
    "end": "1220720"
  },
  {
    "text": "now this is a very good point right we talked about the data files on the indexes and we talked about the wall",
    "start": "1220720",
    "end": "1228159"
  },
  {
    "text": "and how often should i flush data files to disk it's up really it's all of this",
    "start": "1228159",
    "end": "1234720"
  },
  {
    "text": "is configurable for you as a dba you know there is a something called the",
    "start": "1234720",
    "end": "1240559"
  },
  {
    "text": "wall size how big the wall can get the wall shouldn't",
    "start": "1240559",
    "end": "1245919"
  },
  {
    "text": "you think about shouldn't go infinity right because once i flush",
    "start": "1245919",
    "end": "1253039"
  },
  {
    "text": "that dirty changes the wall",
    "start": "1253039",
    "end": "1258480"
  },
  {
    "text": "can be purged right because those changes are already synced",
    "start": "1258480",
    "end": "1265440"
  },
  {
    "text": "with the data files there is no point for me to keep these old walls",
    "start": "1265440",
    "end": "1270559"
  },
  {
    "text": "all changes because those changes has been completely the only purpose of the wall was in case of a crash",
    "start": "1270559",
    "end": "1277919"
  },
  {
    "text": "i can recover and redo the changes and if you did them and all the data files are in sync why",
    "start": "1277919",
    "end": "1284720"
  },
  {
    "text": "the heck do you keep them around it's just wasted space that's why the wall is also presented",
    "start": "1284720",
    "end": "1291360"
  },
  {
    "text": "sometimes as a circle right you you whoa whoa whoa your right right",
    "start": "1291360",
    "end": "1296720"
  },
  {
    "text": "change it just changes and once you end the end of the circle that",
    "start": "1296720",
    "end": "1302640"
  },
  {
    "text": "means it's time to flush the wall is almost full go and flush every",
    "start": "1302640",
    "end": "1308320"
  },
  {
    "text": "data file that the page and memory down",
    "start": "1308320",
    "end": "1313679"
  },
  {
    "text": "to disk and if the flushing was successful go and purge the wall",
    "start": "1313679",
    "end": "1319280"
  },
  {
    "text": "he might say he's saying isn't this the same problem that you originally start when you started this show you talked about that what happened if while you're",
    "start": "1319280",
    "end": "1327360"
  },
  {
    "text": "flushing that page the database crash that's fine because",
    "start": "1327360",
    "end": "1332799"
  },
  {
    "text": "we know right we know the moment where the",
    "start": "1332799",
    "end": "1338320"
  },
  {
    "text": "the pages were consistent and we know that the wall is not whatever's in the wall is the truth",
    "start": "1338320",
    "end": "1345679"
  },
  {
    "text": "so you go back and you say okay from this point that's when things were good",
    "start": "1345679",
    "end": "1351520"
  },
  {
    "text": "that changes all garbage so you need to remove all these changes",
    "start": "1351520",
    "end": "1357679"
  },
  {
    "text": "and then you have to reapply them again so that's that's another thing that the database",
    "start": "1357679",
    "end": "1364400"
  },
  {
    "text": "do so in the case of a car so it's a complicated process right they take care",
    "start": "1364400",
    "end": "1369760"
  },
  {
    "text": "of all of these situations so the that process that we talked about just",
    "start": "1369760",
    "end": "1375679"
  },
  {
    "text": "now where the flushing of these dirty pages",
    "start": "1375679",
    "end": "1381760"
  },
  {
    "start": "1380000",
    "end": "1620000"
  },
  {
    "text": "so that we can get rid of the wall is called check pointing",
    "start": "1381760",
    "end": "1386799"
  },
  {
    "text": "and it really happens at the most random",
    "start": "1386799",
    "end": "1392000"
  },
  {
    "text": "time because check pointing if you think about it",
    "start": "1392000",
    "end": "1397440"
  },
  {
    "text": "is a data intensive i o intensive operation",
    "start": "1397440",
    "end": "1403120"
  },
  {
    "text": "because now while i'm doing check pointing it depends really on the database",
    "start": "1403120",
    "end": "1408400"
  },
  {
    "text": "implementation but i believe things need to get paused",
    "start": "1408400",
    "end": "1414799"
  },
  {
    "text": "during checkpointing because you really need to make sure that north new things comes to the wall as",
    "start": "1414799",
    "end": "1420799"
  },
  {
    "text": "you checkpoint you can you can you can argue that hey i'm gonna put a checkpoint pawn on my",
    "start": "1420799",
    "end": "1426240"
  },
  {
    "text": "wall this is where i'm checkpointing right now right everything flush everything to disk and then yeah the",
    "start": "1426240",
    "end": "1432640"
  },
  {
    "text": "wall can continue to grow and transaction can keep coming in and you can implement something like that right",
    "start": "1432640",
    "end": "1438240"
  },
  {
    "text": "with a little bit of finesse engineering i guess right",
    "start": "1438240",
    "end": "1443840"
  },
  {
    "text": "uh yeah i believe it's going to be a little bit complex but this checkpointing operation and",
    "start": "1443840",
    "end": "1449440"
  },
  {
    "text": "postgres warns about it my sequel warns about it every database warns about it",
    "start": "1449440",
    "end": "1454480"
  },
  {
    "text": "because hey just watch out for this because cpu",
    "start": "1454480",
    "end": "1460000"
  },
  {
    "text": "ram disk activity will spike as checkpoint happens",
    "start": "1460000",
    "end": "1466320"
  },
  {
    "text": "and this can happen at the most random places you might have a very high intensive workload",
    "start": "1466320",
    "end": "1473200"
  },
  {
    "text": "right that is happening at the same time as a checkpoint and that will suffer as a result do you want to suffer",
    "start": "1473200",
    "end": "1479919"
  },
  {
    "text": "well life is suffering unfortunately so we all need to suffer",
    "start": "1479919",
    "end": "1486760"
  },
  {
    "text": "so yeah sometimes we cannot escape this stuff but you have you can understand now that",
    "start": "1486799",
    "end": "1493840"
  },
  {
    "text": "if this happens right this explains why sometimes the query takes a fraction of a millisecond",
    "start": "1493840",
    "end": "1501440"
  },
  {
    "text": "sometimes it takes 50 milliseconds out of nowhere like what is this because the database might be",
    "start": "1501440",
    "end": "1508640"
  },
  {
    "text": "doing something so what do you do well you try to make the wall as short as",
    "start": "1508640",
    "end": "1514960"
  },
  {
    "text": "possible right as small as possible if you make a wall small as small as possible then the",
    "start": "1514960",
    "end": "1521840"
  },
  {
    "text": "checkpoint size will be smaller so the flushing will be more frequent the checkpointing one will be more frequent",
    "start": "1521840",
    "end": "1529360"
  },
  {
    "text": "and in this case you're only flushing certain amount of",
    "start": "1529360",
    "end": "1534799"
  },
  {
    "text": "data as a given time and that could be tolerable and it will be almost consistent and you can argue",
    "start": "1534799",
    "end": "1542000"
  },
  {
    "text": "that let's make the wall is so large such that uh yeah i don't want to deal",
    "start": "1542000",
    "end": "1547200"
  },
  {
    "text": "with checkpoint in until i don't know certain time right",
    "start": "1547200",
    "end": "1552640"
  },
  {
    "text": "but if you kept that that for a long time then it can also",
    "start": "1552640",
    "end": "1558720"
  },
  {
    "text": "grow into other problems right everything is a trade-off unfortunately i don't have solutions to any of this",
    "start": "1558720",
    "end": "1565279"
  },
  {
    "text": "stuff it's just understanding that this exists and we have to deal with them",
    "start": "1565279",
    "end": "1570880"
  },
  {
    "text": "all for white for dual ability we are doing all of this for durability",
    "start": "1570880",
    "end": "1576080"
  },
  {
    "text": "we want to be durable and want to recover and be consistent in case of a crash",
    "start": "1576080",
    "end": "1582159"
  },
  {
    "text": "if you can guarantee that you'll never crash remove the wall i dare you",
    "start": "1582159",
    "end": "1588640"
  },
  {
    "text": "remove the wall",
    "start": "1588640",
    "end": "1593000"
  },
  {
    "text": "some say computer scientists built a wall",
    "start": "1598000",
    "end": "1603360"
  },
  {
    "text": "and the dbas paid for it",
    "start": "1603360",
    "end": "1608400"
  },
  {
    "text": "get it no that was a bad joke all right",
    "start": "1608400",
    "end": "1615519"
  },
  {
    "text": "so we talked about redo logs which is the wall the right ahead log",
    "start": "1618080",
    "end": "1623840"
  },
  {
    "start": "1620000",
    "end": "1980000"
  },
  {
    "text": "and and go go to their configuration and you'll get to see this plastered everywhere wall this wall that wall time",
    "start": "1623840",
    "end": "1631360"
  },
  {
    "text": "all this wool flush time or do you want fsync or not right",
    "start": "1631360",
    "end": "1637679"
  },
  {
    "text": "yeah let's talk about this actually the fsync in the wall so you see",
    "start": "1637679",
    "end": "1643039"
  },
  {
    "text": "if you are building your database on top of an operating system",
    "start": "1643039",
    "end": "1648080"
  },
  {
    "text": "you might say what kind of stupid statement is that i'm saying what else are you going to build your",
    "start": "1648080",
    "end": "1653279"
  },
  {
    "text": "database on hey i have to be very specific because you might build",
    "start": "1653279",
    "end": "1659600"
  },
  {
    "text": "your own operating system that is a database yeah because you might you might you might build your own os that",
    "start": "1659600",
    "end": "1666480"
  },
  {
    "text": "happens to be a database without the bloat of the operating system",
    "start": "1666480",
    "end": "1673279"
  },
  {
    "text": "but if you decide if like any database there is to build your database that lives on top",
    "start": "1673279",
    "end": "1680480"
  },
  {
    "text": "of this blow that is called the os the general purpose",
    "start": "1680480",
    "end": "1685600"
  },
  {
    "text": "right os then you have to live with the rules of the os which is linux or windows or mac",
    "start": "1685600",
    "end": "1694480"
  },
  {
    "text": "or temple os is that an os then",
    "start": "1695039",
    "end": "1700240"
  },
  {
    "text": "there is there is something that the operating system does because its general purpose it doesn't trust any app",
    "start": "1700559",
    "end": "1706480"
  },
  {
    "text": "it says hey all apps are stupid so if the day if so so",
    "start": "1706480",
    "end": "1712559"
  },
  {
    "text": "the apps tend to do some repetitive job they write to the same",
    "start": "1712559",
    "end": "1718320"
  },
  {
    "text": "file multiple times in the same microsecond you know if the operating system let",
    "start": "1718320",
    "end": "1725360"
  },
  {
    "text": "that right go to disk immediately your ssd will be",
    "start": "1725360",
    "end": "1732000"
  },
  {
    "text": "dead effectively right in in a few years let's say right",
    "start": "1732000",
    "end": "1739360"
  },
  {
    "text": "right because like how many times do you write save control as controllers controllers imagine all these rights",
    "start": "1739360",
    "end": "1744799"
  },
  {
    "text": "going immediately right no",
    "start": "1744799",
    "end": "1750960"
  },
  {
    "text": "uh what the operating system has is like it has a file system cache so",
    "start": "1750960",
    "end": "1756000"
  },
  {
    "text": "if you write something it says do you really want to write it let's just just wait let's buffer these rights",
    "start": "1756000",
    "end": "1762320"
  },
  {
    "text": "so it it it buffers these rights in memory and it keeps them in memory",
    "start": "1762320",
    "end": "1768880"
  },
  {
    "text": "in the cache hoping that it might the same page will receive more rights because",
    "start": "1768880",
    "end": "1775840"
  },
  {
    "text": "same problem right because if i write one byte i have to flush the",
    "start": "1775840",
    "end": "1780960"
  },
  {
    "text": "whole disk it's just not worth it not this whole page right it's just not worth it so let's just wait for more",
    "start": "1780960",
    "end": "1787600"
  },
  {
    "text": "rights that hopefully this dirty page receives so i can flush the whole page",
    "start": "1787600",
    "end": "1793200"
  },
  {
    "text": "with with rich dirty rights",
    "start": "1793200",
    "end": "1798240"
  },
  {
    "text": "the more rights the page receives in memory like the better the economics of writing",
    "start": "1798240",
    "end": "1804480"
  },
  {
    "text": "a page because otherwise if you write if you change one character and that writes to desk and",
    "start": "1804480",
    "end": "1810640"
  },
  {
    "text": "then you change another character and that writes to disk you're writing 8k 8k 8k 8k",
    "start": "1810640",
    "end": "1817520"
  },
  {
    "text": "8k 8k every microsecond every millisecond that",
    "start": "1817520",
    "end": "1824240"
  },
  {
    "text": "you're writing and that's too much right uh so the operating system has the cache",
    "start": "1824240",
    "end": "1830240"
  },
  {
    "text": "and waits for this cache to film then flush that chat cache to disk",
    "start": "1830240",
    "end": "1836799"
  },
  {
    "text": "right so",
    "start": "1836799",
    "end": "1842240"
  },
  {
    "text": "that's a problem we talked about the wall the right headlock right if i if i'm if i told you to",
    "start": "1843919",
    "end": "1853760"
  },
  {
    "text": "flush the wall change that wall i i want to make sure the wall is actually persist don't put",
    "start": "1853760",
    "end": "1860080"
  },
  {
    "text": "it in a cache don't try to be smart don't try to be efficient operating system",
    "start": "1860080",
    "end": "1867120"
  },
  {
    "text": "go to disk i want a way to bypass this cache that",
    "start": "1867120",
    "end": "1873200"
  },
  {
    "text": "you have right so that's why most databases",
    "start": "1873200",
    "end": "1879760"
  },
  {
    "text": "in certain operations right like the wall because wall is critical right it says",
    "start": "1879760",
    "end": "1885679"
  },
  {
    "text": "tiny things but we need to flush them directly to risk",
    "start": "1885679",
    "end": "1892158"
  },
  {
    "text": "and that's called fsync that obviously is called liftsync so if if sync is enabled which is the",
    "start": "1894720",
    "end": "1901200"
  },
  {
    "text": "default i believe then no if everything is disabled",
    "start": "1901200",
    "end": "1907120"
  },
  {
    "text": "right which is off that's the default then it goes to the cache if if sync is enabled the force the sync",
    "start": "1907120",
    "end": "1914480"
  },
  {
    "text": "make the change go directly to disk bypass it's it's it's a make it as a",
    "start": "1914480",
    "end": "1920640"
  },
  {
    "text": "right through cache okay punch through a hole through the cache",
    "start": "1920640",
    "end": "1926960"
  },
  {
    "text": "so yeah you can turn it off if you want and you gotta get a little bit more speed but in",
    "start": "1927679",
    "end": "1932880"
  },
  {
    "text": "a danger of uh losing your data i have that option off by the way in my testing data because i don't care it's a",
    "start": "1932880",
    "end": "1939200"
  },
  {
    "text": "testing data and i load the data on a daily basis so if there is a crash which is very highly",
    "start": "1939200",
    "end": "1945519"
  },
  {
    "text": "unlikely i just reordered again and i didn't really notice much difference to be honest but never mind",
    "start": "1945519",
    "end": "1953360"
  },
  {
    "text": "so databases have this enabled most of the time not necessarily postgres doesn't have it",
    "start": "1953360",
    "end": "1959840"
  },
  {
    "text": "enabled for like reading and writing pages because we know that it's okay uh",
    "start": "1959840",
    "end": "1964880"
  },
  {
    "text": "let's write it to the cache and or operating system cache let's read it from the operating system cache",
    "start": "1964880",
    "end": "1970960"
  },
  {
    "text": "and that's fine so if you think about it postgres has almost two caches the cache in the",
    "start": "1970960",
    "end": "1977039"
  },
  {
    "text": "buffer pool like i think it's called the working memory or maybe it's called the buffer form i",
    "start": "1977039",
    "end": "1983440"
  },
  {
    "start": "1980000",
    "end": "2441000"
  },
  {
    "text": "forgot and then there is the operating system cache itself",
    "start": "1983440",
    "end": "1989240"
  },
  {
    "text": "two layers of caching so yeah so there's something to watch",
    "start": "1990000",
    "end": "1995840"
  },
  {
    "text": "out for right so yeah database engineering is very complex so the final thing we're going to talk",
    "start": "1995840",
    "end": "2001840"
  },
  {
    "text": "about is the undo log",
    "start": "2001840",
    "end": "2005840"
  },
  {
    "text": "who's saying iro changes right",
    "start": "2007360",
    "end": "2014240"
  },
  {
    "text": "and by the way not all databases have this and undo log thing postgres doesn't because it does",
    "start": "2014640",
    "end": "2021440"
  },
  {
    "text": "it differently the undo log was designed specifically",
    "start": "2021440",
    "end": "2028080"
  },
  {
    "text": "for give me the state of the row",
    "start": "2028080",
    "end": "2034240"
  },
  {
    "text": "before it was changed am i saying what",
    "start": "2034240",
    "end": "2041120"
  },
  {
    "text": "why why are you doing this well if you are in a running transaction a",
    "start": "2041120",
    "end": "2047200"
  },
  {
    "text": "long-running transaction you're changing changing changing changing right",
    "start": "2047200",
    "end": "2052800"
  },
  {
    "text": "right you're making changes directly to the page right in memory and you're writing the changes you made",
    "start": "2052879",
    "end": "2060720"
  },
  {
    "text": "to the wall so now",
    "start": "2060720",
    "end": "2065440"
  },
  {
    "text": "what happened to transactions that started before you",
    "start": "2066079",
    "end": "2074960"
  },
  {
    "text": "right transaction have this thing that's called isolation level",
    "start": "2074960",
    "end": "2080720"
  },
  {
    "text": "since they started before you make this change and you still didn't commit right in almost all isolation levels",
    "start": "2080720",
    "end": "2088560"
  },
  {
    "text": "accelerated and committed those transactions need the old state of",
    "start": "2088560",
    "end": "2095679"
  },
  {
    "text": "the row before you changed it so it cannot read from the page that is",
    "start": "2095679",
    "end": "2101040"
  },
  {
    "text": "dirty because it has the latest stuff it does not need the related stuff",
    "start": "2101040",
    "end": "2107599"
  },
  {
    "text": "it needs the old state so what the database do",
    "start": "2107920",
    "end": "2112960"
  },
  {
    "text": "is they keep a record of the undue log specifically",
    "start": "2112960",
    "end": "2118960"
  },
  {
    "text": "how this role looked like in its entirety right",
    "start": "2118960",
    "end": "2124160"
  },
  {
    "text": "in a old row in a in a specific log area that's",
    "start": "2124160",
    "end": "2130720"
  },
  {
    "text": "called the undo log oracle sql server i believe",
    "start": "2130720",
    "end": "2136720"
  },
  {
    "text": "uh i'm not 100 sure about sql server but my sequel and oracle have this model",
    "start": "2136720",
    "end": "2141920"
  },
  {
    "text": "which is the undo log right postgres doesn't because it uses versioning",
    "start": "2141920",
    "end": "2148880"
  },
  {
    "text": "a virgin is the row postgres makes the changes in the page right it",
    "start": "2148880",
    "end": "2156560"
  },
  {
    "text": "if you made an update it's a new role in postgres so the old row already lives",
    "start": "2156560",
    "end": "2161920"
  },
  {
    "text": "which is perfect right i i love this design like much better if you think about it",
    "start": "2161920",
    "end": "2168160"
  },
  {
    "text": "again it's all personal at the end of the day preferences",
    "start": "2168160",
    "end": "2173520"
  },
  {
    "text": "but now all transactions that want to read rows that have been",
    "start": "2173520",
    "end": "2179920"
  },
  {
    "text": "changed those rows don't exist on the page so that they have to do a little bit",
    "start": "2179920",
    "end": "2185680"
  },
  {
    "text": "more extra work they have to go to the undo log crack it open",
    "start": "2185680",
    "end": "2191200"
  },
  {
    "text": "i don't know what that means crack it open just want to make sure that it's slower that's why i said that",
    "start": "2191200",
    "end": "2198000"
  },
  {
    "text": "and then take the page the row from the page and then",
    "start": "2198000",
    "end": "2203280"
  },
  {
    "text": "undo the changes that because the row is latest you want to undo the changes you",
    "start": "2203280",
    "end": "2209359"
  },
  {
    "text": "want to apply changes to make it older if you will right",
    "start": "2209359",
    "end": "2215520"
  },
  {
    "text": "so you want to undo these changes so that uh",
    "start": "2215520",
    "end": "2221760"
  },
  {
    "text": "it goes back effectively to the old state so you can read it",
    "start": "2221760",
    "end": "2229680"
  },
  {
    "text": "so a little bit more work for older transactions",
    "start": "2229680",
    "end": "2236800"
  },
  {
    "text": "or for that matter newer transactions right because",
    "start": "2236800",
    "end": "2242800"
  },
  {
    "text": "the problem is we have a transaction that did not commit we have a long running transaction",
    "start": "2242800",
    "end": "2249760"
  },
  {
    "text": "that's why a long-running transaction is is the worse for performance reasons",
    "start": "2249760",
    "end": "2255599"
  },
  {
    "text": "because we the undo log will keep filling up and those transactions will have to go to the log",
    "start": "2255599",
    "end": "2262320"
  },
  {
    "text": "and crack it open and apply the changes and roll back if you will to read the",
    "start": "2262320",
    "end": "2268480"
  },
  {
    "text": "old roads it has to do this all the time and you might say you can do all sorts of caching but this is work that the",
    "start": "2268480",
    "end": "2275520"
  },
  {
    "text": "databases has to do if you think about right it's all work",
    "start": "2275520",
    "end": "2280960"
  },
  {
    "text": "saying do you persist the undo log i believe you should",
    "start": "2280960",
    "end": "2286320"
  },
  {
    "text": "right let's think this through you should do the same with the undo log as you do",
    "start": "2286320",
    "end": "2291520"
  },
  {
    "text": "with the redo log because the reader lock tells you what's the final state right",
    "start": "2291520",
    "end": "2299119"
  },
  {
    "text": "the undo log tells you the the older states",
    "start": "2299119",
    "end": "2306320"
  },
  {
    "text": "right and the correct way to do this is in case of a crash you're going to have a",
    "start": "2306320",
    "end": "2312480"
  },
  {
    "text": "bunch of wall which is the reduce log and then you're going to have the undo logs",
    "start": "2312480",
    "end": "2319040"
  },
  {
    "text": "and you've got to have a state of the page as it existed in desk so in",
    "start": "2319040",
    "end": "2324400"
  },
  {
    "text": "case of a crash you have the undo log you have the redo log you have the old page okay so what do you do",
    "start": "2324400",
    "end": "2330800"
  },
  {
    "text": "the correct order is take that page and whatever is in the wall is the truth apply all the wall changes",
    "start": "2330800",
    "end": "2339359"
  },
  {
    "text": "apply all of them and then because you might have applied stuff",
    "start": "2339680",
    "end": "2344800"
  },
  {
    "text": "from a transaction that have been rolled back right go and take the undo log and then redo",
    "start": "2344800",
    "end": "2353440"
  },
  {
    "text": "redo undo the changes up until the point",
    "start": "2353440",
    "end": "2358720"
  },
  {
    "text": "where the transaction has been rolled back all right so you're going to read what you do",
    "start": "2358720",
    "end": "2364240"
  },
  {
    "text": "and then undo undo undo and until you reach a consistent state right",
    "start": "2364240",
    "end": "2370640"
  },
  {
    "text": "that's one one implementation that i can think of right can you not persist undo log and",
    "start": "2370640",
    "end": "2377520"
  },
  {
    "text": "only apply the redo logs for transaction that has committed",
    "start": "2377520",
    "end": "2382560"
  },
  {
    "text": "i suppose you can but then you have to differentiate",
    "start": "2382560",
    "end": "2388720"
  },
  {
    "text": "uh committed transactions versus not committed transaction in the wall",
    "start": "2388720",
    "end": "2394720"
  },
  {
    "text": "right which i believe that information doesn't exist a wall has changes and it",
    "start": "2394720",
    "end": "2399760"
  },
  {
    "text": "doesn't know if this is from this transaction versus that transaction i suppose you can store this information",
    "start": "2399760",
    "end": "2405839"
  },
  {
    "text": "another data file containing the transactions that are",
    "start": "2405839",
    "end": "2411440"
  },
  {
    "text": "being committed but it's just easier this way i don't know",
    "start": "2411440",
    "end": "2416560"
  },
  {
    "text": "guys this has been an episode of the back engineering show discussing the logs",
    "start": "2416560",
    "end": "2422000"
  },
  {
    "text": "of the database and pretty sure i missed some of this stuff but i believe that's the one of",
    "start": "2422000",
    "end": "2427920"
  },
  {
    "text": "the most important things you know logs undo log wall and",
    "start": "2427920",
    "end": "2434160"
  },
  {
    "text": "the radio logs can i see in the next one hope you enjoyed this one stay awesome goodbye",
    "start": "2434160",
    "end": "2442240"
  }
]