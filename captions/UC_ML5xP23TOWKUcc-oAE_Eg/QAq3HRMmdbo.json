[
  {
    "start": "0",
    "end": "30000"
  },
  {
    "text": "this company have improved cfa's producers rights by over",
    "start": "160",
    "end": "5759"
  },
  {
    "text": "82% by switching file systems but the way they got there is",
    "start": "5759",
    "end": "12840"
  },
  {
    "text": "beautifully written in this technical blog that I want to share with you in",
    "start": "12840",
    "end": "18359"
  },
  {
    "text": "this episode of the back Eng Jing show how about we jump into it so this company is called algro the title of",
    "start": "18359",
    "end": "24400"
  },
  {
    "text": "this blog is unlocking cfast potential by tackling tail latency with",
    "start": "24400",
    "end": "32238"
  },
  {
    "start": "30000",
    "end": "155000"
  },
  {
    "text": "ebpf not the best clickbait title if you ask me but the content is beautiful you",
    "start": "32239",
    "end": "40120"
  },
  {
    "text": "know the way they went into details of showing them you know showing us how",
    "start": "40120",
    "end": "46640"
  },
  {
    "text": "they got there by using out of the box tooling you know they rarely you know go",
    "start": "46640",
    "end": "54800"
  },
  {
    "text": "go and recompile source code also kka is open source you know they could have recompiled and and did all this stuff",
    "start": "54800",
    "end": "62039"
  },
  {
    "text": "but no they used out of the box tooling which I love you know this is a way to look transparently into things they",
    "start": "62039",
    "end": "69280"
  },
  {
    "text": "traced Kafka they parsed the protocols of TKA the TCP binary protocol they use",
    "start": "69280",
    "end": "76840"
  },
  {
    "text": "the protocol the the pro binary protocol that kfka use on top of TCP TCP is it",
    "start": "76840",
    "end": "83840"
  },
  {
    "text": "own it's a protocol but Kafka uses its own binary on top of that they passed",
    "start": "83840",
    "end": "89079"
  },
  {
    "text": "that to find out the request and the slow request and responses then they match that with the",
    "start": "89079",
    "end": "97799"
  },
  {
    "text": "kernel they trace the kernel to find out what is the corresponding what happened and they found out that there is a",
    "start": "97799",
    "end": "103200"
  },
  {
    "text": "Slowdown in the file system which is called ext4 know then they dove into the kernel",
    "start": "103200",
    "end": "109520"
  },
  {
    "text": "of all these calls the file system calls and they found exactly where the problem is spoiler is it was a lock when it",
    "start": "109520",
    "end": "116960"
  },
  {
    "text": "comes to a commit to those file systems they eventually did uh some certain",
    "start": "116960",
    "end": "122960"
  },
  {
    "text": "configuration to the file system to improve those latencies and they eventually decided to switch the file",
    "start": "122960",
    "end": "128239"
  },
  {
    "text": "system Al together to a new file system called xfs which gave them this beautiful boost 82% now take so they",
    "start": "128239",
    "end": "137680"
  },
  {
    "text": "didn't go all the way and explain why xfs is faster in that particular case",
    "start": "137680",
    "end": "144640"
  },
  {
    "text": "than ext4 so take that word result this does not mean ext4 is bad it's just it",
    "start": "144640",
    "end": "150800"
  },
  {
    "text": "depends on the use cases so let's dive into",
    "start": "150800",
    "end": "157200"
  },
  {
    "start": "155000",
    "end": "300000"
  },
  {
    "text": "this Kafka we all know Kafka do we I in a video years ago this that video needs",
    "start": "157200",
    "end": "165280"
  },
  {
    "text": "a desperate refresh cfco is this beautiful publish subscribe system you",
    "start": "165280",
    "end": "174920"
  },
  {
    "text": "it's allowed for asynchronous consumption yeah this is Kafka so this",
    "start": "174920",
    "end": "180120"
  },
  {
    "text": "is it is the uh asynchronous way of communication it's one of the design",
    "start": "180120",
    "end": "186120"
  },
  {
    "text": "pattern I like to explain and in my backend course where usually when you send a request like how do how do you",
    "start": "186120",
    "end": "193120"
  },
  {
    "text": "consume stuff you know from two different party I have something to give you I have something to to read you know",
    "start": "193120",
    "end": "200959"
  },
  {
    "text": "there's two entities they need to read from each other how do you do that you can let them talk to each other but they",
    "start": "200959",
    "end": "206760"
  },
  {
    "text": "will be completely out of sync you know some times I have data to publish I have",
    "start": "206760",
    "end": "212400"
  },
  {
    "text": "some to send but the client is not ready to consume you know they're this is not",
    "start": "212400",
    "end": "217760"
  },
  {
    "text": "always one to one so people invented this idea it's like all right let's take",
    "start": "217760",
    "end": "222840"
  },
  {
    "text": "your data publish it somewhere and then forget about it that's it forget about consum who's consuming it who's going to",
    "start": "222840",
    "end": "228560"
  },
  {
    "text": "read it forget about it just move on right so you you're publishing to something called a broker and then and",
    "start": "228560",
    "end": "234959"
  },
  {
    "text": "and or producing that's the word us it and then there's a consumer on the other end",
    "start": "234959",
    "end": "240680"
  },
  {
    "text": "that that that you know on its Pace on its own pace consumes those you know the",
    "start": "240680",
    "end": "247400"
  },
  {
    "text": "content that you publish you know and there is so many things you can do here you know how to you consume it do you",
    "start": "247400",
    "end": "253680"
  },
  {
    "text": "want it pushed do you want long PLL do you want to short PLL it do you just do",
    "start": "253680",
    "end": "259000"
  },
  {
    "text": "it on on demand whenever I feel like it I'm going to request I'm not interested in latest update and and all of this",
    "start": "259000",
    "end": "266199"
  },
  {
    "text": "stuff is I explained so that's kavka you publish you produce so you write to that",
    "start": "266199",
    "end": "272400"
  },
  {
    "text": "Brokers there's a right so that gives back to this we're writing to this",
    "start": "272400",
    "end": "277840"
  },
  {
    "text": "beautiful broker and this is where things get slower yeah and I'm going to I'm not going to read every single word",
    "start": "277840",
    "end": "285000"
  },
  {
    "text": "here because first of all it's going to take me being slow it's going to take me seven hours to read second I really need",
    "start": "285000",
    "end": "291759"
  },
  {
    "text": "to give credit to those guys you read to go visit this page because if I read the",
    "start": "291759",
    "end": "296960"
  },
  {
    "text": "whole thing then you there is no reason for you to check the blog isn't right mass and I apologize I cannot read",
    "start": "296960",
    "end": "303479"
  },
  {
    "start": "300000",
    "end": "430000"
  },
  {
    "text": "the names I'll try my best uh the authors always CRI the authors mass",
    "start": "303479",
    "end": "311479"
  },
  {
    "text": "m these are European names of course P",
    "start": "311479",
    "end": "318120"
  },
  {
    "text": "Rosco I apologize from the bottom of my koni okay so I produce request and they",
    "start": "318120",
    "end": "328160"
  },
  {
    "text": "saw that these request are suffering you know these requests",
    "start": "328160",
    "end": "334560"
  },
  {
    "text": "are being suffered look at this look at all this stuff what is this what is",
    "start": "334560",
    "end": "341479"
  },
  {
    "text": "this 3 seconds yiki 3 seconds to",
    "start": "341479",
    "end": "347720"
  },
  {
    "text": "write to produce to the C to the Kafka broker you know this is not consumption",
    "start": "347720",
    "end": "353960"
  },
  {
    "text": "consumption is read only right I mean there is a little bit of a ride when you consum you you move the position of",
    "start": "353960",
    "end": "360000"
  },
  {
    "text": "where you're writing so there's a tiny write but there's nothing really a problem when it comes to reading so",
    "start": "360000",
    "end": "366479"
  },
  {
    "text": "there's no problem with reading there's the most problem with writing right that's the the they that they faced",
    "start": "366479",
    "end": "372720"
  },
  {
    "text": "right of course they they can be read problems but they did not see it they didn't talk about it here so we're",
    "start": "372720",
    "end": "378759"
  },
  {
    "text": "writing we're seeing at p999 I talk about these latencies but yeah so they",
    "start": "378759",
    "end": "384680"
  },
  {
    "text": "found that the more of course every time you add a nine you're you're picking up the slower request you know so this this",
    "start": "384680",
    "end": "392120"
  },
  {
    "text": "999 is three and two 9es I think it's 1 second which is this somewhere over here",
    "start": "392120",
    "end": "398800"
  },
  {
    "text": "and I have a video explaining these latencies like 999 if yeah so you have three",
    "start": "398800",
    "end": "405120"
  },
  {
    "text": "seconds and this is slow of course right in the worst case scenario so what there so that's that's the problem we know the",
    "start": "405120",
    "end": "412000"
  },
  {
    "text": "problem well they they just know that the",
    "start": "412000",
    "end": "417039"
  },
  {
    "text": "producer is slow they don't know what requ they have no idea zero transparency from",
    "start": "417039",
    "end": "423800"
  },
  {
    "text": "Kafka the first thing they think all right we need to trace Kafka and guess",
    "start": "423800",
    "end": "429800"
  },
  {
    "text": "what I was surprised there is no metrix when it comes to Kafka that",
    "start": "429800",
    "end": "436000"
  },
  {
    "start": "430000",
    "end": "720000"
  },
  {
    "text": "captures hey this we sent a request this is we logging the request I'm I'm pretty",
    "start": "436000",
    "end": "442919"
  },
  {
    "text": "sure there is they might have missed this because I'll be surprised to see that there is no logging when it comes",
    "start": "442919",
    "end": "449520"
  },
  {
    "text": "comes to Kafka when it comes to hey someone just made a producer request to this message to this topic to this",
    "start": "449520",
    "end": "457000"
  },
  {
    "text": "partition and it took this much and it arrives there is nothing like that apparently they had to roll their own",
    "start": "457000",
    "end": "463319"
  },
  {
    "text": "and this is March 2024 so maybe there something like that doesn't exist is Kafka that fast that",
    "start": "463319",
    "end": "471759"
  },
  {
    "text": "nobody actually decided to write something like that I'm surprised you Kafka experts let me know in the comment",
    "start": "471759",
    "end": "478639"
  },
  {
    "text": "section below so we have a Slowdown we have slowdown so they say hey let's write a tool that parses the",
    "start": "478639",
    "end": "487280"
  },
  {
    "text": "protocol I love this I absolutely love this look at this look at this they said",
    "start": "487280",
    "end": "492919"
  },
  {
    "text": "all right well the kfka is basically built on TCP you don't really get much options",
    "start": "492919",
    "end": "499759"
  },
  {
    "text": "really right either TCP or UDP to be honest I don't get much options so so",
    "start": "499759",
    "end": "504840"
  },
  {
    "text": "it's a b out protocol it's it's own protocol and what did I say what do I",
    "start": "504840",
    "end": "511039"
  },
  {
    "text": "keep saying about uh requests and responses you know the the concept of a",
    "start": "511039",
    "end": "517159"
  },
  {
    "text": "request and response doesn't exist in TCP it's a higher level application Level in this case Kafka so you need to",
    "start": "517159",
    "end": "525360"
  },
  {
    "text": "understand what a request is and what a response is and they had to parse that",
    "start": "525360",
    "end": "530480"
  },
  {
    "text": "they have to read these segments read read and start parsing the protocols oh we we just got something producer so",
    "start": "530480",
    "end": "538160"
  },
  {
    "text": "they put this code on the broker side right oh just got a request right so",
    "start": "538160",
    "end": "543839"
  },
  {
    "text": "they had they built a parser essentially and then they captured all",
    "start": "543839",
    "end": "549519"
  },
  {
    "text": "this information which message and now we have a request you you don't know how",
    "start": "549519",
    "end": "554600"
  },
  {
    "text": "long the request took you just said oh I got the request so using TCB which a tool I used many times in this",
    "start": "554600",
    "end": "562040"
  },
  {
    "text": "channel H also wire shark is a beautiful other tool you can use but you they they",
    "start": "562040",
    "end": "568800"
  },
  {
    "text": "they waited so they have they have they passed this they know a request but then to to know how long a request took you",
    "start": "568800",
    "end": "575519"
  },
  {
    "text": "need to wait for the response which is basically the commit says hey I got your response whatever that I",
    "start": "575519",
    "end": "582240"
  },
  {
    "text": "think we send back the position uh or or like an acknowledgement say",
    "start": "582240",
    "end": "588399"
  },
  {
    "text": "acknowledgement we position the consumer the producer will just send an act act",
    "start": "588399",
    "end": "594000"
  },
  {
    "text": "got it so they got it thankfully that resp response has also the message ID",
    "start": "594000",
    "end": "601160"
  },
  {
    "text": "and the topic so they made they was able to uh you know link the request with the",
    "start": "601160",
    "end": "606920"
  },
  {
    "text": "response and just like that you can uh they they got the arri time and they got",
    "start": "606920",
    "end": "613839"
  },
  {
    "text": "the end time too okay so you have this particular thing of course there is",
    "start": "613839",
    "end": "619600"
  },
  {
    "text": "additional time for processing the request itself okay so this tells me",
    "start": "619600",
    "end": "626079"
  },
  {
    "text": "that this they did this this without using TLS because if they are TLS they",
    "start": "626079",
    "end": "632920"
  },
  {
    "text": "are completely blind right I suppose they have to decrypt it which is I suppose you can do CU we' showned",
    "start": "632920",
    "end": "641320"
  },
  {
    "text": "that in this channel how to decrypt TLS traffic using curl at least uh by by by",
    "start": "641320",
    "end": "648200"
  },
  {
    "text": "setting a specific environment variable and you can decrypt it cuz you own everything essentially and you tell the",
    "start": "648200",
    "end": "654959"
  },
  {
    "text": "tool hey tool write your keys and you the symmetric keys and let the wire",
    "start": "654959",
    "end": "661079"
  },
  {
    "text": "shark read from those keys and you can decrypt it but for this they had to disable TLS because it's okay you can",
    "start": "661079",
    "end": "667639"
  },
  {
    "text": "disable TS I'm just I'm just uh uh you know what was called the tracing I'm I'm",
    "start": "667639",
    "end": "674040"
  },
  {
    "text": "doing monitoring disabled TLS who cares nobody's consuming my system right now but they better hopefully enabled TLS",
    "start": "674040",
    "end": "681000"
  },
  {
    "text": "after all of this stuff right especially if this whole stuff is in the cloud all",
    "start": "681000",
    "end": "686279"
  },
  {
    "text": "right so we now have requests we know the message that written the topic the",
    "start": "686279",
    "end": "692160"
  },
  {
    "text": "partition and they loan the latencies it's 500 see 500 500 this is just example 500 millisecond 500 milliseconds",
    "start": "692160",
    "end": "697760"
  },
  {
    "text": "5 millisecond so so we know they found a way to find all the slow",
    "start": "697760",
    "end": "704959"
  },
  {
    "text": "request that's all what they got now well by",
    "start": "704959",
    "end": "710600"
  },
  {
    "text": "knowing the slow requests what",
    "start": "710600",
    "end": "717399"
  },
  {
    "text": "we we need to know where is the time being spent now we know that the produce",
    "start": "717800",
    "end": "723920"
  },
  {
    "start": "720000",
    "end": "960000"
  },
  {
    "text": "is just as simply like he spends a little bit of time on kfka but the almost time they just writing so that's",
    "start": "723920",
    "end": "730000"
  },
  {
    "text": "what they did next they traced dynamically using",
    "start": "730000",
    "end": "735120"
  },
  {
    "text": "ebpf you know Berkeley file system uh Berkeley packet",
    "start": "735120",
    "end": "741079"
  },
  {
    "text": "filter the right calls because I said all right Kafka is",
    "start": "741079",
    "end": "747279"
  },
  {
    "text": "not doing much we're just writing to the to the file system so let's capture the",
    "start": "747279",
    "end": "752880"
  },
  {
    "text": "right calls to the file system that's what they did so they started um they",
    "start": "752880",
    "end": "759720"
  },
  {
    "text": "started tracing Kafka with this approach right and they found that when they",
    "start": "759720",
    "end": "767760"
  },
  {
    "text": "started capturing this now they have remember we have the request which is a blind a request that took x amount of",
    "start": "767760",
    "end": "774399"
  },
  {
    "text": "time but they don't know how do they know all of this",
    "start": "774399",
    "end": "779800"
  },
  {
    "text": "Fleet of right system file system calls to the file system how do they know that",
    "start": "779800",
    "end": "786120"
  },
  {
    "text": "which right corresponds to which request that is a really challenging thing to do",
    "start": "786120",
    "end": "791279"
  },
  {
    "text": "and they did it brilliantly so they traced this ext4",
    "start": "791279",
    "end": "797480"
  },
  {
    "text": "because that's the file system right using this ext4 slower uh uh epbf",
    "start": "797480",
    "end": "805279"
  },
  {
    "text": "extension know and they managed to find the right file system right",
    "start": "805279",
    "end": "813600"
  },
  {
    "text": "calls which which is that how you write to the file system captured it and they know the",
    "start": "813600",
    "end": "819680"
  },
  {
    "text": "file but if you know the file you know the Parent Directory and guess what the Parent Directory in Kafka is the topic",
    "start": "819680",
    "end": "826760"
  },
  {
    "text": "the file is what the message ID the partition yes the file the file the",
    "start": "826760",
    "end": "832199"
  },
  {
    "text": "segment file is the partition itself you know so we have topic and we know the",
    "start": "832199",
    "end": "837360"
  },
  {
    "text": "partition so they part using the file name and The Parent Directory they know",
    "start": "837360",
    "end": "843160"
  },
  {
    "text": "exactly and which thread made that request which is very important because that's another thing it's a",
    "start": "843160",
    "end": "848959"
  },
  {
    "text": "multi-threaded system so you having multiple threads competing on the same file that's a recipe for you know con",
    "start": "848959",
    "end": "857839"
  },
  {
    "text": "contention but now they have all this information they partition ID topic name and here's here's what they built they",
    "start": "857839",
    "end": "864320"
  },
  {
    "text": "linked it back to the request because if you know the topic you know the message you know all of the stuff",
    "start": "864320",
    "end": "869920"
  },
  {
    "text": "you can bring all of this together into a single beautiful table now they know",
    "start": "869920",
    "end": "877240"
  },
  {
    "text": "the request they know the latency they know the message they know the topic they know the partition and they know",
    "start": "877240",
    "end": "882519"
  },
  {
    "text": "the latency okay we know everything now everything is there and all they s is",
    "start": "882519",
    "end": "889199"
  },
  {
    "text": "like all right so we can correspond how long a right call talk right a file",
    "start": "889199",
    "end": "895800"
  },
  {
    "text": "system right call Talk versus is the how long the request took and if the request",
    "start": "895800",
    "end": "903240"
  },
  {
    "text": "is equal to the amount of time to write to the file system or eventually to desk",
    "start": "903240",
    "end": "911079"
  },
  {
    "text": "then that whole thing that whole request is just spent writing to disk that's",
    "start": "911079",
    "end": "917279"
  },
  {
    "text": "cool and they found a lot of requests like that the entire time processing the",
    "start": "917279",
    "end": "923440"
  },
  {
    "text": "request is just right which is this whatever 50 millisecond what",
    "start": "923440",
    "end": "929759"
  },
  {
    "text": "15 but then they saw slow rights",
    "start": "929759",
    "end": "935920"
  },
  {
    "text": "some slow rights some requests that had they are slow request",
    "start": "936199",
    "end": "943600"
  },
  {
    "text": "but with a faster rights it's like what",
    "start": "943600",
    "end": "949639"
  },
  {
    "text": "how there are slow request but with a faster r that means there is a bunch of",
    "start": "949639",
    "end": "955800"
  },
  {
    "text": "space and if you're listening to this we're showing a trffic where there is a",
    "start": "955800",
    "end": "961240"
  },
  {
    "start": "960000",
    "end": "1260000"
  },
  {
    "text": "a whole request from request to end that is a huge but then there is a tiny box",
    "start": "961240",
    "end": "968199"
  },
  {
    "text": "that says okay the file system talk only this much but there is a big question mark we have no idea what happened",
    "start": "968199",
    "end": "974720"
  },
  {
    "text": "before that and you might guess what it they figured it out it's a lock right",
    "start": "974720",
    "end": "980399"
  },
  {
    "text": "and I'm not going to go into detail what that kind lock is actually you know that",
    "start": "980399",
    "end": "985759"
  },
  {
    "text": "knowing me I of course I have to go into the details but it's essentially waiting",
    "start": "985759",
    "end": "992600"
  },
  {
    "text": "for a lock or waiting for a permission to ride",
    "start": "992600",
    "end": "999399"
  },
  {
    "text": "to the fire so before we actually did the ride we did something we just waited",
    "start": "999399",
    "end": "1004440"
  },
  {
    "text": "this thread that try to attempt to do the ride to producing their ride it was",
    "start": "1004440",
    "end": "1010319"
  },
  {
    "text": "just waiting was blocked why because well the file system this comes back to",
    "start": "1010319",
    "end": "1016319"
  },
  {
    "text": "the file system you guys file system and I talk about this in my new operating system it's really if you kind",
    "start": "1016319",
    "end": "1024079"
  },
  {
    "text": "of dive deep into it it has metadata right because we decided that",
    "start": "1024079",
    "end": "1030280"
  },
  {
    "text": "file people need to work with files in directory right we decided that because we like",
    "start": "1030280",
    "end": "1037760"
  },
  {
    "text": "directories and files and well what is that this is all meta data because there",
    "start": "1037760",
    "end": "1044160"
  },
  {
    "text": "is the data you write I won't write blocks of data but then there is the",
    "start": "1044160",
    "end": "1050520"
  },
  {
    "text": "ability to track the size of the file and the permission of the file and this",
    "start": "1050520",
    "end": "1056480"
  },
  {
    "text": "file lives in this directory and this file this directory has these files and this file all this",
    "start": "1056480",
    "end": "1063360"
  },
  {
    "text": "metadata belong to the file system that is not really user data well it is you might know what I'm",
    "start": "1063360",
    "end": "1070520"
  },
  {
    "text": "saying but is if I write my produce",
    "start": "1070520",
    "end": "1075720"
  },
  {
    "text": "content like I sent I don't know adjacent file I don't really care if it's in this file",
    "start": "1075720",
    "end": "1082919"
  },
  {
    "text": "or this directory yet it's it's an what's it's a WR",
    "start": "1082919",
    "end": "1090720"
  },
  {
    "text": "amplification side effect right you decided to add this",
    "start": "1090720",
    "end": "1096720"
  },
  {
    "text": "metadata just to write my stuff right it's on you and this metadata has a",
    "start": "1096720",
    "end": "1105200"
  },
  {
    "text": "cost and all of this stuff is in something called an iode an index node and every file system implements this",
    "start": "1105200",
    "end": "1112039"
  },
  {
    "text": "slightly differently now this is where a file system behaves almost identically to a",
    "start": "1112039",
    "end": "1117919"
  },
  {
    "text": "database well file system directories and files",
    "start": "1117919",
    "end": "1123440"
  },
  {
    "text": "really need to be consistent if I if I no two threads can delete one thread can",
    "start": "1123440",
    "end": "1130559"
  },
  {
    "text": "rename a file and other can delete it you cannot do that or one can change the content and the one can move it to",
    "start": "1130559",
    "end": "1137120"
  },
  {
    "text": "another directly you need to stay consistent and the moment you introduce",
    "start": "1137120",
    "end": "1142720"
  },
  {
    "text": "this stuff you need to journal it you need a wall right ahead log and that's",
    "start": "1142720",
    "end": "1150200"
  },
  {
    "text": "what almost all file systems are journaled as is that all changes that",
    "start": "1150200",
    "end": "1156080"
  },
  {
    "text": "you are making first are written to a different St called the journal is hey",
    "start": "1156080",
    "end": "1161559"
  },
  {
    "text": "someone on this date made this change the one this me this change to this file that's it and then there's the whole",
    "start": "1161559",
    "end": "1168320"
  },
  {
    "text": "thing which is the actual content and the blocks of the data right we don't",
    "start": "1168320",
    "end": "1174240"
  },
  {
    "text": "write directly to those exactly like with the database we're doing well in the database we write to the wall and",
    "start": "1174240",
    "end": "1180400"
  },
  {
    "text": "then we write to the pages in memory and then we it's safe we say all right we",
    "start": "1180400",
    "end": "1186440"
  },
  {
    "text": "can flush safely the journal while the pages are in memory also up to date of",
    "start": "1186440",
    "end": "1192360"
  },
  {
    "text": "course you have to write to them right but if we crash the pages on disc are different but that's fine if we came",
    "start": "1192360",
    "end": "1199640"
  },
  {
    "text": "back I'll replay the journal is it reply or replay replay I always confus this",
    "start": "1199640",
    "end": "1205240"
  },
  {
    "text": "reply Replay play to play it we want to replay it we want to replay all of these",
    "start": "1205240",
    "end": "1211720"
  },
  {
    "text": "things back to the old last checkpoint that's exactly how file systems work",
    "start": "1211720",
    "end": "1217960"
  },
  {
    "text": "right to stay consistent so that's journaling and and you cannot start",
    "start": "1217960",
    "end": "1223159"
  },
  {
    "text": "journaling from two different thread on the same thing if a transaction and they call it also transaction if someone is",
    "start": "1223159",
    "end": "1228679"
  },
  {
    "text": "doing some changes on a file the other threads are especially when you're journaling when you're committing",
    "start": "1228679",
    "end": "1235919"
  },
  {
    "text": "stuff and that is basically where most of the time is spent you can go into the",
    "start": "1235919",
    "end": "1241159"
  },
  {
    "text": "details of which uh kernel functions are actually doing the Locking and that's",
    "start": "1241159",
    "end": "1246520"
  },
  {
    "text": "how ext4 is essentially implemented and this is the function it's called Dirty I",
    "start": "1246520",
    "end": "1251880"
  },
  {
    "text": "know so they did all sorts of monitoring they all right what can we do what can",
    "start": "1251880",
    "end": "1257640"
  },
  {
    "text": "we make how can we make make this faster you guys how can we make this you know",
    "start": "1257640",
    "end": "1262760"
  },
  {
    "start": "1260000",
    "end": "1560000"
  },
  {
    "text": "more Haku how how can we make it faster",
    "start": "1262760",
    "end": "1269440"
  },
  {
    "text": "well you can disable journaling that's one option disable all together you can you",
    "start": "1269440",
    "end": "1277120"
  },
  {
    "text": "can can you do that in databases you can in databases we tell",
    "start": "1277120",
    "end": "1282360"
  },
  {
    "text": "you to disable fsync so that we we have to journal but we don't force you to to",
    "start": "1282360",
    "end": "1291440"
  },
  {
    "text": "sink those walls back to dis it says H it's all right it's all right if you",
    "start": "1291440",
    "end": "1297240"
  },
  {
    "text": "don't so that's one option they said nope that's dangerous if you don't Journal you are corrupt basically right",
    "start": "1297240",
    "end": "1305919"
  },
  {
    "text": "what they what they said here without journaling we we would risk long recovery in case of a crash I don't know",
    "start": "1305919",
    "end": "1311720"
  },
  {
    "text": "if that's true I think you're straight up corrupted right I don't know how you not journal and be consistent I don't",
    "start": "1311720",
    "end": "1319120"
  },
  {
    "text": "think it's possible cuz in case of a crash while rewriting this beautiful block of data",
    "start": "1319120",
    "end": "1325159"
  },
  {
    "text": "let's say you wrote and that's how you know the LBA is presented by the desk",
    "start": "1325159",
    "end": "1330559"
  },
  {
    "text": "all right you might write one file system block 4 kilobyte but it's segmented into eight",
    "start": "1330559",
    "end": "1337480"
  },
  {
    "text": "lbas right so you you're writing eight lbas and Depends over in the in the physical uh logical physical sector size",
    "start": "1337480",
    "end": "1346480"
  },
  {
    "text": "how big that is compared to you block size that if that's out of s you're",
    "start": "1346480",
    "end": "1351919"
  },
  {
    "text": "screwed you get you're anatomic in case of a crash of course some people says hey I live on the edge we live on the",
    "start": "1351919",
    "end": "1359480"
  },
  {
    "text": "edge it's okay we can decrease so that's our question decrease",
    "start": "1359480",
    "end": "1365559"
  },
  {
    "text": "the commit interval let's decrease it right how often we are flushing the wall",
    "start": "1365559",
    "end": "1371279"
  },
  {
    "text": "or the journal it's like all right uh the default is 5 Second Every 5 Second let's flush it right if you don't flush",
    "start": "1371279",
    "end": "1379120"
  },
  {
    "text": "the kernel the journal you are risking what you're risking longer recovery CU",
    "start": "1379120",
    "end": "1385080"
  },
  {
    "text": "you're accumulating all this beautiful world changes in your memory and in case of a of a crash basically you lost these",
    "start": "1385080",
    "end": "1393520"
  },
  {
    "text": "changes alt together I think right so how often you want to commit",
    "start": "1393520",
    "end": "1398679"
  },
  {
    "text": "these changes is up to you like it's every 5 Seconds you can reduce it the if",
    "start": "1398679",
    "end": "1404480"
  },
  {
    "text": "you reduce it you have less changes to write of course and as a result you of",
    "start": "1404480",
    "end": "1411600"
  },
  {
    "text": "course you're writing more but you're writing less I mean you're writing a little bit less so you can if you",
    "start": "1411600",
    "end": "1418159"
  },
  {
    "text": "increase it you're not going to dis as often and as a result it improves the",
    "start": "1418159",
    "end": "1424520"
  },
  {
    "text": "performance they said nah didn't help much they said all right let's change",
    "start": "1424520",
    "end": "1429799"
  },
  {
    "text": "the journaling mode all together and instead of doing an order right that is let's write to the metadata and then and",
    "start": "1429799",
    "end": "1437360"
  },
  {
    "text": "then flush the content itself well let's do it a write back that's another approach write back means what is right",
    "start": "1437360",
    "end": "1443840"
  },
  {
    "text": "back that's right write back it guarantees that the data is written to the main file system so when I do a an",
    "start": "1443840",
    "end": "1449480"
  },
  {
    "text": "actual file write I don't care about the metadata of the file write my content later flush your metadata file system I",
    "start": "1449480",
    "end": "1457679"
  },
  {
    "text": "don't care about that okay and there is an actual option in at least post gr",
    "start": "1457679",
    "end": "1462720"
  },
  {
    "text": "called if data sync like well it's an a system call but you can switch it such",
    "start": "1462720",
    "end": "1467760"
  },
  {
    "text": "that hey sync the data not if sync if sync means sync everything to desk right anything you",
    "start": "1467760",
    "end": "1475679"
  },
  {
    "text": "have in the page cach cuz all everything what we're talking about is almost in the page cach right some of it is the",
    "start": "1475679",
    "end": "1482840"
  },
  {
    "text": "and the file system me uh dedicated place for memory",
    "start": "1482840",
    "end": "1488880"
  },
  {
    "text": "but then yeah you're doing all this stuff let me write my data that's what I care about your file systems stuff I",
    "start": "1488880",
    "end": "1495559"
  },
  {
    "text": "don't care about write it later but you're of course there's always a risk involved with all this stuff but how",
    "start": "1495559",
    "end": "1502440"
  },
  {
    "text": "often all this crashes some people take their care uh chances and say all right",
    "start": "1502440",
    "end": "1508000"
  },
  {
    "text": "let's let's lose some data and some of these stuff are repairable and operating",
    "start": "1508000",
    "end": "1513720"
  },
  {
    "text": "systems all file systems come with a repair mechanism all right so they they did Le change they did a right back and",
    "start": "1513720",
    "end": "1520360"
  },
  {
    "text": "they improve from 3 seconds all the way to 800 millisecond so the right back improved so the F data sync is actually",
    "start": "1520360",
    "end": "1526840"
  },
  {
    "text": "very good so you can do fast comments that's another approach right if you switch to fast comments it's",
    "start": "1526840",
    "end": "1534279"
  },
  {
    "text": "a it's a better approach to committing those file system changes right so they",
    "start": "1534279",
    "end": "1541279"
  },
  {
    "text": "they saw some little bit of better approach there is a little bit of better performance with fast commit they did",
    "start": "1541279",
    "end": "1547200"
  },
  {
    "text": "that so I just like this journey through the blog it's like hey we're making it better better so they reduced it all the",
    "start": "1547200",
    "end": "1553880"
  },
  {
    "text": "way to 500 millisecond but look at that they still their average seems like to be in in the 250 right that's their",
    "start": "1553880",
    "end": "1561279"
  },
  {
    "start": "1560000",
    "end": "1890000"
  },
  {
    "text": "average right but now their tail latency is now way down which is good all right",
    "start": "1561279",
    "end": "1567159"
  },
  {
    "text": "so the finally they decided to switch all all file systems all together and here is",
    "start": "1567159",
    "end": "1574440"
  },
  {
    "text": "where I'm I'm waiting for a part two of this blog because they switch file",
    "start": "1574440",
    "end": "1580919"
  },
  {
    "text": "system and because kfka really writes huge append only large files they found",
    "start": "1580919",
    "end": "1588960"
  },
  {
    "text": "that xfs is better why I absolutely have no",
    "start": "1588960",
    "end": "1596279"
  },
  {
    "text": "idea right I didn't dive into the intricacies of xfs or X xd4 to be honest",
    "start": "1596279",
    "end": "1606320"
  },
  {
    "text": "right this is something I want to do you know this really they could be you can write a",
    "start": "1606320",
    "end": "1613360"
  },
  {
    "text": "whole book about how xfs work or how xt4 work cuz there are just so much more you",
    "start": "1613360",
    "end": "1620320"
  },
  {
    "text": "know I'm I talk about this in an overview here as a you know as a podcast",
    "start": "1620320",
    "end": "1625840"
  },
  {
    "text": "but there's so much so much here so they switched to xfs and look at the",
    "start": "1625840",
    "end": "1630880"
  },
  {
    "text": "difference here all of these you know tail latencies of course they didn't they",
    "start": "1630880",
    "end": "1637640"
  },
  {
    "text": "show the base right they didn't show the changes you no with fast commit that's",
    "start": "1637640",
    "end": "1643440"
  },
  {
    "text": "the latest thing with xfs they still saw some",
    "start": "1643440",
    "end": "1650399"
  },
  {
    "text": "tail but it caps at 500 milliseconds just like the fast Comming but it's",
    "start": "1650399",
    "end": "1656440"
  },
  {
    "text": "way better you see it's almost an average almost for those listening we're",
    "start": "1656440",
    "end": "1663159"
  },
  {
    "text": "seeing uh what 20 millisecond average",
    "start": "1663159",
    "end": "1669080"
  },
  {
    "text": "maybe perhaps less you know so this is a a video I",
    "start": "1669080",
    "end": "1676000"
  },
  {
    "text": "wanted to make to go into you know the details of how you can",
    "start": "1676000",
    "end": "1681279"
  },
  {
    "text": "elegantly trace the engineering",
    "start": "1681279",
    "end": "1686880"
  },
  {
    "text": "art of having a problem and slowly just sculpturing it slowly just you know",
    "start": "1686880",
    "end": "1694360"
  },
  {
    "text": "going through every single thing and getting to the bottom of it",
    "start": "1694360",
    "end": "1700120"
  },
  {
    "text": "and they did a good job they switched to xfs now I don't think xfs has no",
    "start": "1700120",
    "end": "1707320"
  },
  {
    "text": "problems we're going to hear back from those guys later maybe I don't know in a year or",
    "start": "1707320",
    "end": "1714600"
  },
  {
    "text": "two and we always do with with these things like oh we switch and it's so much faster then they come two years",
    "start": "1714600",
    "end": "1721320"
  },
  {
    "text": "later and says actually we fixed this and that broke we",
    "start": "1721320",
    "end": "1726559"
  },
  {
    "text": "fixed that and that yeah it's always the case like look just look at Discord like they move from Mingo mango DB to",
    "start": "1726559",
    "end": "1734840"
  },
  {
    "text": "what to Cassandra and then to Sila May right because every move there was a",
    "start": "1734840",
    "end": "1741600"
  },
  {
    "text": "problem to them they saw something and then something else uh pops up right",
    "start": "1741600",
    "end": "1746720"
  },
  {
    "text": "especially with you as you become also popular you get more load workload and",
    "start": "1746720",
    "end": "1752120"
  },
  {
    "text": "as a result you get more uh no problems More Money More Problems as they say",
    "start": "1752120",
    "end": "1757720"
  },
  {
    "text": "right so shout out to them guys",
    "start": "1757720",
    "end": "1763640"
  },
  {
    "text": "great uh Mass MOSI",
    "start": "1763640",
    "end": "1769080"
  },
  {
    "text": "Miki and then P Risco you guys that's a fantastic blog I",
    "start": "1769080",
    "end": "1777159"
  },
  {
    "text": "I can encourage you to read it you know and uh not only read it read the links",
    "start": "1777159",
    "end": "1782919"
  },
  {
    "text": "you guys read the links they they provide a beautiful beautiful you know resources you know all these link they",
    "start": "1782919",
    "end": "1789679"
  },
  {
    "text": "say hey we found this tool it's called async profiler we found this Tool uh I don't know",
    "start": "1789679",
    "end": "1795279"
  },
  {
    "text": "xt4 whatever you know slower that's the epbf and we wrote this and we wrote that",
    "start": "1795279",
    "end": "1800960"
  },
  {
    "text": "I really hope they they Upstream their changes to kfka know how did they you",
    "start": "1800960",
    "end": "1807440"
  },
  {
    "text": "know capture the request all the way to the false system this is really I I don't think it's like a one tool like",
    "start": "1807440",
    "end": "1813600"
  },
  {
    "text": "they use many tools and to link this together it's like it's going to be really nice to have this in Kafka you",
    "start": "1813600",
    "end": "1820640"
  },
  {
    "text": "know they actually contemplated the idea to contribute they for cka add the",
    "start": "1820640",
    "end": "1826919"
  },
  {
    "text": "logging and and then put it back but even that will not give them the file",
    "start": "1826919",
    "end": "1833880"
  },
  {
    "text": "system you know timing CU you don't have access to that low low level thing",
    "start": "1833880",
    "end": "1840559"
  },
  {
    "text": "you um do you yeah because you're just making a",
    "start": "1840559",
    "end": "1845720"
  },
  {
    "text": "Boop you're making a OPP posex right and God knows the colonel does billions of",
    "start": "1845720",
    "end": "1851440"
  },
  {
    "text": "things before it does your actual ride right all right guys that's what I wanted to talk about uh yeah we're back",
    "start": "1851440",
    "end": "1858200"
  },
  {
    "text": "uh sorry about uh the Hiatus uh I've been working as you might know my operating system course and it's been",
    "start": "1858200",
    "end": "1864559"
  },
  {
    "text": "taking a long time with family and all that stuff but yeah hopefully we'll came",
    "start": "1864559",
    "end": "1870039"
  },
  {
    "text": "back to the Cadence uh producing more content and thank you so much and check",
    "start": "1870039",
    "end": "1875639"
  },
  {
    "text": "out the course it's os. husin dancer.com fundamentals of operating systems it",
    "start": "1875639",
    "end": "1882440"
  },
  {
    "text": "took two years to build from all the building the content and actually going",
    "start": "1882440",
    "end": "1888080"
  },
  {
    "text": "through all this stuff see you on the next one",
    "start": "1888080",
    "end": "1891919"
  }
]