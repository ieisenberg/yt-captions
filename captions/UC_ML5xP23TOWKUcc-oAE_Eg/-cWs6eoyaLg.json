[
  {
    "start": "0",
    "end": "113000"
  },
  {
    "text": "varnish is a reverse proxy web accelerator written in C and designed to improve the HTTP performance by using",
    "start": "30",
    "end": "7259"
  },
  {
    "text": "server-side caching in this video I'm going to go through how varnish works",
    "start": "7259",
    "end": "13200"
  },
  {
    "text": "we're gonna spin up a varnish docker container and we're gonna set up an HTTP",
    "start": "13200",
    "end": "18840"
  },
  {
    "text": "and https varnish configuration and finally as always we're gonna talk about",
    "start": "18840",
    "end": "25410"
  },
  {
    "text": "the pros and cons of this deck if you're new here welcome my name is Hussein and in this channel we'll discuss all sorts",
    "start": "25410",
    "end": "32189"
  },
  {
    "text": "of software engineering by example so if we were to become a better software engineer consider subscribing and hit",
    "start": "32189",
    "end": "37649"
  },
  {
    "text": "that be like and so you get notified every time I upload a new video well that's it let's just jump into this",
    "start": "37649",
    "end": "43680"
  },
  {
    "text": "varnish this is we're gonna discuss first of all I'm gonna talk about just normally the classic HTTP architecture",
    "start": "43680",
    "end": "50789"
  },
  {
    "text": "without any caching then we're gonna insert varnish and see how it does what",
    "start": "50789",
    "end": "56100"
  },
  {
    "text": "actually does right I'm gonna talk about how varnish works then I'm gonna show up",
    "start": "56100",
    "end": "61770"
  },
  {
    "text": "some demos where we it will actually set up varnish so spin up a docker container",
    "start": "61770",
    "end": "67260"
  },
  {
    "text": "with varnish I have a Bosphorus database a little bit of an Express application",
    "start": "67260",
    "end": "72689"
  },
  {
    "text": "that I've built and we will insert varnish on top of that and see how it",
    "start": "72689",
    "end": "77939"
  },
  {
    "text": "performs right and then we're gonna do the same thing but we're gonna use since",
    "start": "77939",
    "end": "83460"
  },
  {
    "text": "Warner's doesn't work well with HTTP out of the box we're gonna insert an HTTP",
    "start": "83460",
    "end": "89579"
  },
  {
    "text": "TLS Terminator in front of varnish to protect our traffic because you know",
    "start": "89579",
    "end": "95869"
  },
  {
    "text": "HTTP alone is bad right you don't want to send your traffic just as pure HTTP",
    "start": "95869",
    "end": "101460"
  },
  {
    "text": "so you want to encrypt it with HTTPS so we're gonna talk about how we gonna do that and then finally we're gonna talk about",
    "start": "101460",
    "end": "107430"
  },
  {
    "text": "the pros and cons of this beautiful tack so let's just jump into it so a classic",
    "start": "107430",
    "end": "113759"
  },
  {
    "start": "113000",
    "end": "230000"
  },
  {
    "text": "architecture is this here here's let's say I have a server here that is running",
    "start": "113759",
    "end": "119460"
  },
  {
    "text": "on port 215 okay it's an HTTP server and similarly this is not GS for example and",
    "start": "119460",
    "end": "126630"
  },
  {
    "text": "we have a database 4 5 4 3 2 probably this Postgres right and you have some",
    "start": "126630",
    "end": "133260"
  },
  {
    "text": "sort of fooling can actually pulling going on at the back end as if we want to know more about connection pulling been a",
    "start": "133260",
    "end": "138390"
  },
  {
    "text": "reference video here so so essentially the nodejs is connecting to the database the polkas database and and querying any",
    "start": "138390",
    "end": "145770"
  },
  {
    "text": "requests right so that's that's what it does right sending sequel queries so the",
    "start": "145770",
    "end": "150780"
  },
  {
    "text": "client will send a get request right to the server and you you might have seen",
    "start": "150780",
    "end": "156600"
  },
  {
    "text": "what happened right so that get give me all employees the route will hit the",
    "start": "156600",
    "end": "162300"
  },
  {
    "text": "note GS application here or any application really and that will translate into a sequel query to the",
    "start": "162300",
    "end": "168360"
  },
  {
    "text": "Postgres database and then that the sequel result will give you a results as",
    "start": "168360",
    "end": "173730"
  },
  {
    "text": "an almost our way or an asset and then that will be translated to a jason's and back to the client right and if another",
    "start": "173730",
    "end": "180390"
  },
  {
    "text": "client has made the same exact request you would do the same exact thing you're gonna head the server and the database",
    "start": "180390",
    "end": "187260"
  },
  {
    "text": "all the time right and it you can see that how expensive this gets right",
    "start": "187260",
    "end": "192330"
  },
  {
    "text": "you're hitting the server on you're hitting the database despite the data didn't really change right that's that's",
    "start": "192330",
    "end": "197940"
  },
  {
    "text": "essentially the limitation that we have here we're overloading the server there is memory being allocated",
    "start": "197940",
    "end": "204510"
  },
  {
    "text": "there is CPU cycles being wasted that just I'm an amazing man that the",
    "start": "204510",
    "end": "210840"
  },
  {
    "text": "Postgres database there is also obviously the CPUs of the database there",
    "start": "210840",
    "end": "216450"
  },
  {
    "text": "is the crunch that is happening in the backend right it depends on how expensive the query is so everything",
    "start": "216450",
    "end": "222900"
  },
  {
    "text": "actually matter right so if you what you want to minimize the the load on these",
    "start": "222900",
    "end": "228750"
  },
  {
    "text": "guys as much as possible meat varnish so varnish what it does like if you make a request the same thing you insert the",
    "start": "228750",
    "end": "235470"
  },
  {
    "start": "230000",
    "end": "470000"
  },
  {
    "text": "varnish it's a it's nothing but a glorified reverse proxy that does a lot",
    "start": "235470",
    "end": "240510"
  },
  {
    "text": "of stuff right reverse proxy if you don't know is as a proxy that makes the",
    "start": "240510",
    "end": "245730"
  },
  {
    "text": "request on your behalf right and hides the identity of the server from you or as a user so I know",
    "start": "245730",
    "end": "253410"
  },
  {
    "text": "we made a video about reverse proxies persue proxy I'm gonna reference any of you know interested guys but you would",
    "start": "253410",
    "end": "258420"
  },
  {
    "text": "make a request to varnish a varnish give me employees and you would hit the varnish will make the request right they",
    "start": "258420",
    "end": "266160"
  },
  {
    "text": "say hey I don't have the employees I'm sorry so it male will make the request the server and add",
    "start": "266160",
    "end": "271669"
  },
  {
    "text": "the server obviously will just propagate the results to the database and it will get back the results right so let's",
    "start": "271669",
    "end": "277220"
  },
  {
    "text": "repeat that see see what happens here right so you see that three of them hopefully the blinking actually works",
    "start": "277220",
    "end": "283970"
  },
  {
    "text": "but yeah so there the varnish will this case will cache the employees result get",
    "start": "283970",
    "end": "288979"
  },
  {
    "text": "back the results and then if you make another request it will only hit the cache it will not bother the server",
    "start": "288979",
    "end": "296210"
  },
  {
    "text": "because it nothing changed and there is a complex cache invalidation happening",
    "start": "296210",
    "end": "302360"
  },
  {
    "text": "on the back in here how do you know that this actually changed or not it's a very complex system to build we made a",
    "start": "302360",
    "end": "308870"
  },
  {
    "text": "mention that Lawrence in this case happened to be running on 8080 so if another client made another request just",
    "start": "308870",
    "end": "315919"
  },
  {
    "text": "given the results frame so varnish plays here as a reverse proxy and it also",
    "start": "315919",
    "end": "321050"
  },
  {
    "text": "plays as a load balancer which is amazing right sweet so how varnish works",
    "start": "321050",
    "end": "327740"
  },
  {
    "text": "as we described works as a layer seven reverse proxy so what does that mean why",
    "start": "327740",
    "end": "333020"
  },
  {
    "text": "did I insert layer seven there layer seven because it's an application reverse proxy so it works at the",
    "start": "333020",
    "end": "339409"
  },
  {
    "text": "application level and guess what if you're in an application level you have to look at the data to understand what's",
    "start": "339409",
    "end": "347900"
  },
  {
    "text": "going on right because well we're caching right for caching something we're looking at the HTTP content",
    "start": "347900",
    "end": "354380"
  },
  {
    "text": "it cannot be encrypted I cannot cache encrypted stuff it's useless",
    "start": "354380",
    "end": "359629"
  },
  {
    "text": "right so what do we do is basically varnish design is works only an HTTP",
    "start": "359629",
    "end": "368169"
  },
  {
    "text": "unencrypted HTTP right so that sounds scary but we're gonna get to it right so",
    "start": "368169",
    "end": "374120"
  },
  {
    "text": "so that's why I said layer seven reverse proxy and not layer four because you cannot really do much caching layer four",
    "start": "374120",
    "end": "381889"
  },
  {
    "text": "right and I'm gonna reference a video between layer seven layer four load balancers and proxies you guys",
    "start": "381889",
    "end": "387529"
  },
  {
    "text": "interested to watch that video how does it cache a cache by default anything that is get requests if you",
    "start": "387529",
    "end": "394159"
  },
  {
    "text": "make a get request it will look at that okay give the course are very semantically it's",
    "start": "394159",
    "end": "400639"
  },
  {
    "text": "cashable because it's unimportant because they are safe right and we made a video so hope to get vs pose I'm gonna",
    "start": "400639",
    "end": "408889"
  },
  {
    "text": "reference it here guys so you can just give the idea of what is the difference between get and post but I'm like post",
    "start": "408889",
    "end": "414919"
  },
  {
    "text": "requests they cannot be cached because they are not coding code safe right",
    "start": "414919",
    "end": "420080"
  },
  {
    "text": "it can also prefetch the comment says hey you just made index dot HTML most of the time if you made index Toshima you",
    "start": "420080",
    "end": "427189"
  },
  {
    "text": "can request main j as you're gonna cost main dot CSS you're gonna quest these images so I'm gonna have I'm gonna catch",
    "start": "427189",
    "end": "434270"
  },
  {
    "text": "them I'm ready for you babe right whenever you are ready okay and I'm gonna talk a little bit",
    "start": "434270",
    "end": "440689"
  },
  {
    "text": "about front end and back in here and we're gonna be clear about the back and anything behind varnish is called the",
    "start": "440689",
    "end": "449240"
  },
  {
    "text": "back end here okay I know these terms are very overloaded these two terms but",
    "start": "449240",
    "end": "454580"
  },
  {
    "text": "anything behind varnish is back in anything in front of varnish is called a",
    "start": "454580",
    "end": "459710"
  },
  {
    "text": "front end doesn't have to be a browser right it's just it could be another but",
    "start": "459710",
    "end": "465009"
  },
  {
    "text": "HTTP sir HTTP server like engine X or caddy right or hitch all right show some",
    "start": "465009",
    "end": "471680"
  },
  {
    "start": "470000",
    "end": "1103000"
  },
  {
    "text": "demo guys so here's we're gonna build I have here a Postgres database running on",
    "start": "471680",
    "end": "478099"
  },
  {
    "text": "four five four three TS a docker instance with an employee's table that the same example we gave and I have a",
    "start": "478099",
    "end": "485870"
  },
  {
    "text": "node.js application that basically have an endpoint to get the employees list of",
    "start": "485870",
    "end": "492529"
  },
  {
    "text": "employees which translates into a query to their Postgres database and we have built exactly what what i'm describing",
    "start": "492529",
    "end": "498469"
  },
  {
    "text": "now don't go through the code guys so if you're interested you just know how this works",
    "start": "498469",
    "end": "503599"
  },
  {
    "text": "i'm gonna reference a video here where we built this thing from scratch we spin",
    "start": "503599",
    "end": "509149"
  },
  {
    "text": "up the Postgres database for in docker we spin up no GS and we wrote the code JavaScript and do all this fancy stuff",
    "start": "509149",
    "end": "516078"
  },
  {
    "text": "to communicate but we still good what I want to do is I want to insert a varnish I'm gonna spin up a docker container and",
    "start": "516079",
    "end": "522289"
  },
  {
    "text": "then I'm gonna configure varnish to point to this guy because it doesn't",
    "start": "522289",
    "end": "527899"
  },
  {
    "text": "know right you and that's happening through what is called the varnish configure",
    "start": "527899",
    "end": "533649"
  },
  {
    "text": "language I think vcl that configuration language is very rich and can do a lot",
    "start": "533649",
    "end": "539019"
  },
  {
    "text": "of things in the language and you one of the things you do most important thing is where is your back-end you till your",
    "start": "539019",
    "end": "547540"
  },
  {
    "text": "varnish what's your back-end and we're gonna talk about that okay so what will happen essentially if you",
    "start": "547540",
    "end": "552790"
  },
  {
    "text": "make a good request to the employee email and you get back the results okay",
    "start": "552790",
    "end": "557860"
  },
  {
    "text": "sweet and any in the new request will only hit the cache so let's just jump",
    "start": "557860",
    "end": "563800"
  },
  {
    "text": "into the car alright guys so here's the nodejs application that we have promised",
    "start": "563800",
    "end": "569199"
  },
  {
    "text": "right and here is the endpoint it's running on port 215 and this is all",
    "start": "569199",
    "end": "574720"
  },
  {
    "text": "running on my machine which is called Husain Mac that's the endpoints called employees so if you make a request right",
    "start": "574720",
    "end": "581439"
  },
  {
    "text": "it goes to this server and this is the output on the backend on the server itself which is on my machine right",
    "start": "581439",
    "end": "587679"
  },
  {
    "text": "but essentially every time I request I get the all the employees back alright and I want you to pay attention to this",
    "start": "587679",
    "end": "593980"
  },
  {
    "text": "time Stan I intentionally added a timestamp every request comes I print the current date right so every time i",
    "start": "593980",
    "end": "600819"
  },
  {
    "text": "refresh you can see that hey we printed the table which is this is the which is what we returned to the client and we",
    "start": "600819",
    "end": "607899"
  },
  {
    "text": "also printed the date and time so you can see that it's so you can see like every time i refresh this increase like",
    "start": "607899",
    "end": "615579"
  },
  {
    "text": "32 right then 35 36 37 so like every second I can every time i refresh I'm",
    "start": "615579",
    "end": "623050"
  },
  {
    "text": "gonna hit the database so that's without varnish right so I'm gonna leave that here and I'm gonna show you just here if",
    "start": "623050",
    "end": "630100"
  },
  {
    "text": "I go to more tools and go to developer tools here and I gonna refresh click",
    "start": "630100",
    "end": "635410"
  },
  {
    "text": "here and you can see see it's powered by",
    "start": "635410",
    "end": "643809"
  },
  {
    "text": "Express because that's what I'm running on okay so that's the responsibility",
    "start": "643809",
    "end": "648990"
  },
  {
    "text": "where it's coming from and it's obviously obviously it is HTTP just pure",
    "start": "648990",
    "end": "654459"
  },
  {
    "text": "HTTP 1 1 1 let's insert varnish so how do we do that so what we're gonna do",
    "start": "654459",
    "end": "660160"
  },
  {
    "text": "first we're gonna spin up the docker container for varnish that is not hard",
    "start": "660160",
    "end": "665949"
  },
  {
    "text": "the second step is going to Vienna the VCL configuration which is the default configuration that points us to",
    "start": "665949",
    "end": "673079"
  },
  {
    "text": "Hussein Mac 2:15 forward any requests any HTTP requests for coming to varnish",
    "start": "673079",
    "end": "678899"
  },
  {
    "text": "to my node.js server so let's do that alright so as always you have to have",
    "start": "678899",
    "end": "685949"
  },
  {
    "text": "docker installs the moment you can say docker and you get some output or you can do docker hello",
    "start": "685949",
    "end": "691709"
  },
  {
    "text": "docker run hello - board that means you have running you have docker running or",
    "start": "691709",
    "end": "698850"
  },
  {
    "text": "obviously I have that's the first time I run how the word if you see like hey hello from docker you are good to go",
    "start": "698850",
    "end": "705089"
  },
  {
    "text": "right that's that's essentially what do you need to get docker once you have docker you can do all of my tutorials",
    "start": "705089",
    "end": "710550"
  },
  {
    "text": "essentially all crash courses I run I rely on docker cuz I don't want to pull",
    "start": "710550",
    "end": "715559"
  },
  {
    "text": "it your database with with the garbage right eager and it's also finish uninstalling just docker and stop the",
    "start": "715559",
    "end": "721649"
  },
  {
    "text": "container remove it right it's just very simple alright so what do you want to do is basically do it for docker run and as",
    "start": "721649",
    "end": "728369"
  },
  {
    "text": "always give your container name I'm gonna call it varnish ok and that's the name of that container and I want to",
    "start": "728369",
    "end": "735749"
  },
  {
    "text": "expose the porch right so the port's that is running on this container by",
    "start": "735749",
    "end": "741990"
  },
  {
    "text": "default is gonna be port 80 right but I want to expose port 8080 as we explained",
    "start": "741990",
    "end": "748230"
  },
  {
    "text": "in the demo right now I want to expose hop varnish to my host as port 8080 but",
    "start": "748230",
    "end": "754920"
  },
  {
    "text": "this guy is essentially what is running locally in the varnish container so I",
    "start": "754920",
    "end": "761100"
  },
  {
    "text": "want to map port 80 to port 8080 to the public and when I say public I mean my",
    "start": "761100",
    "end": "766589"
  },
  {
    "text": "machine okay and then finally it's really easy all you have to do is just do varnish okay and then when you run",
    "start": "766589",
    "end": "775499"
  },
  {
    "text": "this puppy you're gonna download if it doesn't exist and we're gonna start the",
    "start": "775499",
    "end": "782399"
  },
  {
    "text": "docker container immediately yeah so I'm gonna kill the docker container immediately because I want to start",
    "start": "782399",
    "end": "789170"
  },
  {
    "text": "working and on writing my VCL file and then the next step is one I'm going to",
    "start": "789170",
    "end": "795119"
  },
  {
    "text": "copy the VCL file the varnish configuration language that that configuration that tells me",
    "start": "795119",
    "end": "801450"
  },
  {
    "text": "hey point any requests coming to varnish to the employees end point which is",
    "start": "801450",
    "end": "807600"
  },
  {
    "text": "running on port 215 remember so how do I do that so let's go ahead created the",
    "start": "807600",
    "end": "812940"
  },
  {
    "text": "folder called varnish here just to put my stuff in it I'm gonna have our nish alright I'm gonna create a then default",
    "start": "812940",
    "end": "822930"
  },
  {
    "text": "dot VCL and here's how you do it so the first step is we're gonna insert and you",
    "start": "822930",
    "end": "830130"
  },
  {
    "text": "define the language version vcl 400k the",
    "start": "830130",
    "end": "835500"
  },
  {
    "text": "next step is the back end right what is your back-end as varnish right and we talked about back and pride and my",
    "start": "835500",
    "end": "841620"
  },
  {
    "text": "back-end is essentially it's called default right and that's but it looks",
    "start": "841620",
    "end": "847320"
  },
  {
    "text": "very Jason II but not really Jason very similar essentially to H a proxy if you guys watched my video there and then",
    "start": "847320",
    "end": "854760"
  },
  {
    "text": "what do you do essentially is a ok my back-end host is called what guys it's",
    "start": "854760",
    "end": "859860"
  },
  {
    "text": "called the same Mac right but that's not enough what is your back-end port my back in port is called 215 and then you",
    "start": "859860",
    "end": "867000"
  },
  {
    "text": "end up with a semicolon I didn't do any of those so I'm gonna go ahead and do that and we're ready quit right Q and",
    "start": "867000",
    "end": "875820"
  },
  {
    "text": "you can by the way write it in any language I just want to be fancy and write it with vim okay just show you",
    "start": "875820",
    "end": "881730"
  },
  {
    "text": "that I'm fancy and I like to invent right a lot of people do that alright so I just want to fit in with other people",
    "start": "881730",
    "end": "887220"
  },
  {
    "text": "that write in vim again I'm joking guys by the way if you couldn't tell okay so",
    "start": "887220",
    "end": "893670"
  },
  {
    "text": "here's the default does VCL so next step is I'm gonna copy that guy right which is in my machine obviously into my",
    "start": "893670",
    "end": "900810"
  },
  {
    "text": "varnish docker container so how do I do that so you do docker copy and I love docker",
    "start": "900810",
    "end": "907860"
  },
  {
    "text": "command line because this is exactly very similar to the Linux command line okay or unix okay and on the mop going",
    "start": "907860",
    "end": "914760"
  },
  {
    "text": "after me okay docker copy and then you say what do you want to copy I want to copy",
    "start": "914760",
    "end": "920340"
  },
  {
    "text": "default of a CL and where do you want to copy it okay you want to copy it to which container",
    "start": "920340",
    "end": "925710"
  },
  {
    "text": "it's called varnish that's why we called it you cannot call it you can call anything you want right and then you add",
    "start": "925710",
    "end": "931140"
  },
  {
    "text": "a colon and then the path here is called / Etsy varnish",
    "start": "931140",
    "end": "936200"
  },
  {
    "text": "okay and that will essentially copy that file into the varnish remember the",
    "start": "936200",
    "end": "941690"
  },
  {
    "text": "containers stop so what do we do docker start varnish or good to go guys",
    "start": "941690",
    "end": "948410"
  },
  {
    "text": "so what varnish is running on what port guys 8080 remember so now if I go to my",
    "start": "948410",
    "end": "954350"
  },
  {
    "text": "browser and I say Husain Mac 8080 alright that will poke me to varnish and",
    "start": "954350",
    "end": "959720"
  },
  {
    "text": "varnish will point me to what to Hossein Mac 215 which is running the Express node.js application which will hit the",
    "start": "959720",
    "end": "966890"
  },
  {
    "text": "Postgres database which is another container on my machine so many containers all right so this guy still",
    "start": "966890",
    "end": "973730"
  },
  {
    "text": "works obviously and every time i refresh I hit the time stamp obviously here right damn bad that just shows me that",
    "start": "973730",
    "end": "980210"
  },
  {
    "text": "hey you just hit the database okay you just hit me as a server okay so if I go here and I say Hussein mock 8080",
    "start": "980210",
    "end": "988010"
  },
  {
    "text": "employees the first time I hit it I got you can see that there is a time right",
    "start": "988010",
    "end": "993440"
  },
  {
    "text": "but subsequent requests this this guy they didn't change but you get a request",
    "start": "993440",
    "end": "998930"
  },
  {
    "text": "how powerful is this right so that I can refresh all day right this is hitting",
    "start": "998930",
    "end": "1005980"
  },
  {
    "text": "varnish and varnish is caching the JSON response which is what eight items okay",
    "start": "1005980",
    "end": "1011830"
  },
  {
    "text": "and it's gonna stay there right until someone make a change to the database",
    "start": "1011830",
    "end": "1017110"
  },
  {
    "text": "right and I notice like if I insert the row in the data base varnish kind of lags behind and it still gives me the",
    "start": "1017110",
    "end": "1023200"
  },
  {
    "text": "old copy of the jason so it's like eight employees but if I add another employee",
    "start": "1023200",
    "end": "1030000"
  },
  {
    "text": "right that employee is not refreshed immediately in the cache because how",
    "start": "1030000",
    "end": "1036310"
  },
  {
    "text": "would why would varnish know you're responsible manually to invalidate the",
    "start": "1036310",
    "end": "1042220"
  },
  {
    "text": "cache some of the time sometimes varnish does some of the things to to to kind of invalidate the cache but essentially if",
    "start": "1042220",
    "end": "1049720"
  },
  {
    "text": "I go here I can refresh all day it's still 18 right but go to 15 - 15 refresh",
    "start": "1049720",
    "end": "1057010"
  },
  {
    "text": "refresh refresh every time we refresh this guy's changed that is amazing isn't",
    "start": "1057010",
    "end": "1062440"
  },
  {
    "text": "it right I go here refresh refresh refresh refresh sweet so that's essentially varnish in a",
    "start": "1062440",
    "end": "1070950"
  },
  {
    "text": "nutshell guys okay so Hussein this is unencrypted this is dangerous",
    "start": "1070950",
    "end": "1077910"
  },
  {
    "text": "not secure I do not like this I can't use varnish insecure how do I secure my",
    "start": "1077910",
    "end": "1085230"
  },
  {
    "text": "varnish make me secure it how do I do this well you can insert",
    "start": "1085230",
    "end": "1091530"
  },
  {
    "text": "something on top of varnish that is securi right is that even a word right",
    "start": "1091530",
    "end": "1098340"
  },
  {
    "text": "there is it it's a basically secure and that will forward the request of varnish which will Doris for the request of your",
    "start": "1098340",
    "end": "1104100"
  },
  {
    "start": "1103000",
    "end": "1723000"
  },
  {
    "text": "back-end server okay you can obviously do that so let's just jump into it alright guys so we have set up an",
    "start": "1104100",
    "end": "1111000"
  },
  {
    "text": "insecure HTTP varnish setup and it was very easy as you guys so it's not hard",
    "start": "1111000",
    "end": "1116360"
  },
  {
    "text": "but how do this do the same thing but it is a secure back-end now I want to",
    "start": "1116360",
    "end": "1121920"
  },
  {
    "text": "secure my architecture ok so what we're gonna do here a lot of people use engine",
    "start": "1121920",
    "end": "1127140"
  },
  {
    "text": "X and put it as a TLS Terminator it's a game a reverse proxy that has HTTP",
    "start": "1127140",
    "end": "1135270"
  },
  {
    "text": "support in it and what we want to do here is that reverse proxy will make the",
    "start": "1135270",
    "end": "1140970"
  },
  {
    "text": "request to varnish as an unencrypted HTTP request right and so you can do",
    "start": "1140970",
    "end": "1147780"
  },
  {
    "text": "that right so this guy in this case I'm gonna use caddy all right which is a",
    "start": "1147780",
    "end": "1153150"
  },
  {
    "text": "beautiful server and we made a video about caddy I'm gonna reference it here so I'm not just gonna use caddy as just",
    "start": "1153150",
    "end": "1158820"
  },
  {
    "text": "an HTTP to secure server web server I'm gonna use it here as a reverse proxy and",
    "start": "1158820",
    "end": "1165840"
  },
  {
    "text": "yes you can do that so thank you Matt Matt was the author of caddy so there's",
    "start": "1165840",
    "end": "1171750"
  },
  {
    "text": "a lot of features on this beast of a software man so what we're gonna do here essentially",
    "start": "1171750",
    "end": "1177270"
  },
  {
    "text": "we're gonna make a request so as a client you do not know any of these guys anymore right you just hidden reverse",
    "start": "1177270",
    "end": "1184710"
  },
  {
    "text": "proxy guys the definition of reverse proxy you hide the identity of the server you don't know any of these guys",
    "start": "1184710",
    "end": "1190410"
  },
  {
    "text": "anymore you know this puppy that's only what do you know you make a request",
    "start": "1190410",
    "end": "1196700"
  },
  {
    "text": "so but the first request will head caddie right obviously there will be a tcp community plaques TCP connection",
    "start": "1197210",
    "end": "1207740"
  },
  {
    "text": "between the client here right so that's pretty fast right but this guy and the",
    "start": "1207740",
    "end": "1213200"
  },
  {
    "text": "backend this will be HTTP 1 because this guy only support HTTP right varnish only",
    "start": "1213200",
    "end": "1219590"
  },
  {
    "text": "support HTTP guys that's so you have to know that right yes the new versions of varnish support",
    "start": "1219590",
    "end": "1226669"
  },
  {
    "text": "HTTP as similar thing where you they add another extra layer but varnishes stuff",
    "start": "1226669",
    "end": "1233779"
  },
  {
    "text": "has to be HTTP because it needs to look if you need to look has to be unencrypted ok so if you know you had",
    "start": "1233779",
    "end": "1240470"
  },
  {
    "text": "that and you're gonna hit the note yes sir when you have the database right so one one thing here Before we jump into",
    "start": "1240470",
    "end": "1246409"
  },
  {
    "text": "this demo guys you might want to wonder it's like what if this in my cloud was what if this was in my cloud you're",
    "start": "1246409",
    "end": "1251960"
  },
  {
    "text": "forcing me to use my back-end is now really on HTTP the same at my back-end",
    "start": "1251960",
    "end": "1257419"
  },
  {
    "text": "is HTTP maybe maybe you have engine XE you're running and varnish on top of it well varnish doesn't support HTTP",
    "start": "1257419",
    "end": "1266059"
  },
  {
    "text": "back-end react right in an open source at least in the the furnish Plus which",
    "start": "1266059",
    "end": "1272659"
  },
  {
    "text": "is the paid software the varnish can make HTTP connection on the backend",
    "start": "1272659",
    "end": "1279830"
  },
  {
    "text": "alright that feature is missing in the open source you cannot make an HTTP",
    "start": "1279830",
    "end": "1285620"
  },
  {
    "text": "request to an encrypted back-end so let's just jump into it and do this guy's so four layers of system right so",
    "start": "1285620",
    "end": "1293450"
  },
  {
    "text": "there's a lot of stuff and as we discussed this is called the front-end this is called the backing ok how about",
    "start": "1293450",
    "end": "1299570"
  },
  {
    "text": "we do this set up so up until here we have all of that set up we have this guy where this is all we have this guy so",
    "start": "1299570",
    "end": "1305630"
  },
  {
    "text": "what we're missing is just this guy alright guys so what we need to do is go in and spin up a caddy web server and",
    "start": "1305630",
    "end": "1312320"
  },
  {
    "text": "that caddy web server has to be pointing to my varnish setup right which is",
    "start": "1312320",
    "end": "1321080"
  },
  {
    "text": "running on port 8080 what we need to do is first we're gonna write some configuration to do that",
    "start": "1321080",
    "end": "1326419"
  },
  {
    "text": "the second thing which we already I already did on the background is you have to make caddy run on port 80",
    "start": "1326419",
    "end": "1333470"
  },
  {
    "text": "and import 443 and you have to register a DNS name right my DNS name is called",
    "start": "1333470",
    "end": "1340730"
  },
  {
    "text": "my host to DNS net okay that DNS entry",
    "start": "1340730",
    "end": "1346940"
  },
  {
    "text": "which is register no IP points to my public IP address which is now which is",
    "start": "1346940",
    "end": "1353120"
  },
  {
    "text": "which is which is running my router obviously and my router is mapped to my machine which is her st. Mac okay I have",
    "start": "1353120",
    "end": "1360409"
  },
  {
    "text": "done I'm not gonna do this in this video because I've done it in the Cadi video so if you're interested to know how to",
    "start": "1360409",
    "end": "1365690"
  },
  {
    "text": "set up an HTTP to secure web server go watch that video I'm gonna reference it",
    "start": "1365690",
    "end": "1371450"
  },
  {
    "text": "here okay so that I'm gonna assume that I have done that obviously okay so what",
    "start": "1371450",
    "end": "1376940"
  },
  {
    "text": "we're gonna do here is like let's create a folder called NIC directory caddy red and then let's go and then what we need",
    "start": "1376940",
    "end": "1384320"
  },
  {
    "text": "to do is create a caddy file very similar to a VC L language rights like so I'm gonna use then because we're",
    "start": "1384320",
    "end": "1391340"
  },
  {
    "text": "fancy alright and then cold caddy for has to be capped capital letter C okay",
    "start": "1391340",
    "end": "1396529"
  },
  {
    "text": "and then when you create that file here's where you're gonna write my host is called my host to the DD n s net and",
    "start": "1396529",
    "end": "1407240"
  },
  {
    "text": "then again looks better EJ Singh II but not really so what we need to do is",
    "start": "1407240",
    "end": "1413179"
  },
  {
    "text": "essentially proxy anything that goes to caddy into what into my local machine",
    "start": "1413179",
    "end": "1421539"
  },
  {
    "text": "which is one two seven zero zero one or local host or say Mac on which port the",
    "start": "1421539",
    "end": "1429049"
  },
  {
    "text": "varnish port right I want everything that goes into port 443 or 80 through",
    "start": "1429049",
    "end": "1434210"
  },
  {
    "text": "caddy to go funnel through port 8080 and then we're gonna just save and we're",
    "start": "1434210",
    "end": "1442009"
  },
  {
    "text": "done so clearing the screen once now I write caddy what will happen here is",
    "start": "1442009",
    "end": "1448850"
  },
  {
    "text": "caddy will detect there is a caddy file on the the same file it will start",
    "start": "1448850",
    "end": "1453950"
  },
  {
    "text": "listening on port 443 and it will support a single port 80 and that's my",
    "start": "1453950",
    "end": "1459169"
  },
  {
    "text": "website now guys this is a public website if I gave you this you'll my servers I'm gonna I tried remember to",
    "start": "1459169",
    "end": "1465799"
  },
  {
    "text": "disable that after the video okay let's talk about a little bit before we jump into right so this guy is pointing to my",
    "start": "1465799",
    "end": "1473539"
  },
  {
    "text": "router right this DNS entry point to my router my router has two rules port",
    "start": "1473539",
    "end": "1478909"
  },
  {
    "text": "forwarding rules 80 and 443 ports are forwarded to my Husein Mac machine on",
    "start": "1478909",
    "end": "1485710"
  },
  {
    "text": "port 443 and port 80 where Kali is listening and caddy have a rule that",
    "start": "1485710",
    "end": "1493580"
  },
  {
    "text": "says hey I need a course that comes to you on port for 40 or 80 please forward",
    "start": "1493580",
    "end": "1499249"
  },
  {
    "text": "it to the same local host machine which happens to be the same Mac on port 8080 which is varnish and then varnish will",
    "start": "1499249",
    "end": "1506690"
  },
  {
    "text": "do its magic to talk to the nodejs Express application which is running on",
    "start": "1506690",
    "end": "1511789"
  },
  {
    "text": "four to fifteen and then to fifteen will point to the PostGIS database which is running on port five four three two Wow",
    "start": "1511789",
    "end": "1519460"
  },
  {
    "text": "let's see how it works all right so my host the DNS dotnet right let's add HTTP",
    "start": "1519460",
    "end": "1526340"
  },
  {
    "text": "because we're fancy like that right and then slash employees and you can see and",
    "start": "1526340",
    "end": "1535309"
  },
  {
    "text": "you can see that we're hitting that but the database is not getting hit because it's being cached by varnish cool this",
    "start": "1535309",
    "end": "1542539"
  },
  {
    "text": "stuff guys right so this guy is the public one is HTTPS secure alright guys",
    "start": "1542539",
    "end": "1550309"
  },
  {
    "text": "so let's go through all these layers now the first layer is I would say Mac 215 that is the node.js application okay so",
    "start": "1550309",
    "end": "1559789"
  },
  {
    "text": "if i refresh this every time i'm gonna hit the database obviously there is no cash okay if i go to the developer tools",
    "start": "1559789",
    "end": "1566149"
  },
  {
    "text": "and i record you can see that i'm using HTTP 1 1 because it's on secure right",
    "start": "1566149",
    "end": "1571220"
  },
  {
    "text": "that's the only thing we can use when it's unsecure ok if I hit this guy look",
    "start": "1571220",
    "end": "1576499"
  },
  {
    "text": "at this the response header it's only Express and make sense because no js' is",
    "start": "1576499",
    "end": "1583070"
  },
  {
    "text": "the is the thing powering this application that's running on port 250",
    "start": "1583070",
    "end": "1588679"
  },
  {
    "text": "let's go one layer up this is varnish if",
    "start": "1588679",
    "end": "1594679"
  },
  {
    "text": "I do var now varnish is a reverse proxy that talks to the node.js application so",
    "start": "1594679",
    "end": "1601289"
  },
  {
    "text": "let's talk let's take a look what happens here record still using one one",
    "start": "1601289",
    "end": "1606419"
  },
  {
    "text": "because I make sense stone must not really secure by clicking employees what happened response hitter",
    "start": "1606419",
    "end": "1612320"
  },
  {
    "text": "it adds the varnish header via ok because it adds the via and it's just",
    "start": "1612320",
    "end": "1619049"
  },
  {
    "text": "like hey this is a proxy but it's like hey you're communicating to me to the server through me right still a reverse",
    "start": "1619049",
    "end": "1626190"
  },
  {
    "text": "proxy because I don't know the server I don't know that the IP address of the",
    "start": "1626190",
    "end": "1631679"
  },
  {
    "text": "back-end server okay then no J's is is hidden from me kind of right well I know it's running",
    "start": "1631679",
    "end": "1637980"
  },
  {
    "text": "no J's because varnish actually added those requests back as a result right",
    "start": "1637980",
    "end": "1643950"
  },
  {
    "text": "and just it told me that hey via it came it came from me by the way so that I",
    "start": "1643950",
    "end": "1649919"
  },
  {
    "text": "started to add that that header for you and that's the back end Express server essentially okay and it adds also this",
    "start": "1649919",
    "end": "1656940"
  },
  {
    "text": "thing which I don't really know what it is there has to be some some caching mechanisms all right",
    "start": "1656940",
    "end": "1662940"
  },
  {
    "text": "let's find the final thing here guys the final thing I am running caddy right so",
    "start": "1662940",
    "end": "1670530"
  },
  {
    "text": "what will happen here is when I record no this guy's is too beautiful stuff and",
    "start": "1670530",
    "end": "1676140"
  },
  {
    "text": "if I click on this guy look at that a response header three layers first the",
    "start": "1676140",
    "end": "1682590"
  },
  {
    "text": "server's caddy right because that's the application that you're communicating with right but it went from caddy",
    "start": "1682590",
    "end": "1690929"
  },
  {
    "text": "through varnish and from varnish it went and was powered by Express so you can",
    "start": "1690929",
    "end": "1697200"
  },
  {
    "text": "essentially see the entire stack in the headers and that's because varnish",
    "start": "1697200",
    "end": "1703200"
  },
  {
    "text": "actually rewrites the header add stuff changes stuff that's one of the features of of varnish because it's just",
    "start": "1703200",
    "end": "1710220"
  },
  {
    "text": "basically it's a reverse proxy and proxies can change the headers if it is a layer 7 proxy which it is right all",
    "start": "1710220",
    "end": "1718590"
  },
  {
    "text": "right guys let's go back to the slides and talk about pros and cons all right guys varnish pros and cons is this",
    "start": "1718590",
    "end": "1727470"
  },
  {
    "start": "1723000",
    "end": "2366000"
  },
  {
    "text": "technology perfect no nothing is perfect in life all right so let's discuss the pros of this",
    "start": "1727470",
    "end": "1735120"
  },
  {
    "text": "technology so the first advantage there's a lot of advantages amantha's good stuff so the first advantage that clearly it's",
    "start": "1735120",
    "end": "1742260"
  },
  {
    "text": "the caching and prefetching of documents right so unlike Redis where you as a",
    "start": "1742260",
    "end": "1749640"
  },
  {
    "text": "developer responsible for caching stuff this actually caches on your behalf",
    "start": "1749640",
    "end": "1756690"
  },
  {
    "text": "kind of double-edged sword right because you don't you have control right stuff",
    "start": "1756690",
    "end": "1762570"
  },
  {
    "text": "but sometimes you don't write you don't know what happens is with a varnish cached or not there's unpredictability",
    "start": "1762570",
    "end": "1768780"
  },
  {
    "text": "and this is kind can get scary right a lot of people use Redis because of this right I want to cache my stuff my own way",
    "start": "1768780",
    "end": "1776760"
  },
  {
    "text": "right if I want to make a request I'm gonna cash that stuff only if I need to right and I'm gonna invalidate it only",
    "start": "1776760",
    "end": "1783090"
  },
  {
    "text": "if I need to I'm responsible right a lot of people like the control here and right is but if you just want things to",
    "start": "1783090",
    "end": "1789870"
  },
  {
    "text": "work magically use varnish because it will cache for you it will prefetch documents I say hey I'm gonna request",
    "start": "1789870",
    "end": "1797580"
  },
  {
    "text": "the index.html but hey and extra Shema will also pull these images will also",
    "start": "1797580",
    "end": "1803640"
  },
  {
    "text": "pull these javascript files main CSS PDFs I don't know so we don't have to",
    "start": "1803640",
    "end": "1810600"
  },
  {
    "text": "bother the backend servers and the database right with the request if I",
    "start": "1810600",
    "end": "1816030"
  },
  {
    "text": "have all these tokens so I'm gonna go ahead and prefetch them resolving DNS host name and documents so if you're",
    "start": "1816030",
    "end": "1822030"
  },
  {
    "text": "like fetching an index.html file HTML sometimes post to our URLs right and",
    "start": "1822030",
    "end": "1828270"
  },
  {
    "text": "this URLs were their links whether images JavaScript files anything right",
    "start": "1828270",
    "end": "1834650"
  },
  {
    "text": "these doesn't necessarily point to euro same domain they point to multiple",
    "start": "1834650",
    "end": "1839880"
  },
  {
    "text": "domains and that could be expensive to to resolve the dns every time right so",
    "start": "1839880",
    "end": "1845940"
  },
  {
    "text": "what what varnish does is the moment is start it caches and resolves the DNS",
    "start": "1845940",
    "end": "1853980"
  },
  {
    "text": "names every request comes in right and it remembers the DNS IP address",
    "start": "1853980",
    "end": "1860880"
  },
  {
    "text": "essentially it matches the host named back to an IP address all right that could be also a double-edged sword",
    "start": "1860880",
    "end": "1868060"
  },
  {
    "text": "where hey you're cashing to one IP but what if I have my DNS set up as a kind",
    "start": "1868060",
    "end": "1875740"
  },
  {
    "text": "of a load balancer like a high availability I want my DNS to point to this IP sometimes I wanted to point to",
    "start": "1875740",
    "end": "1882010"
  },
  {
    "text": "this IP something few as varnish then it's always going to point to one IP address on I realize I'm talking about",
    "start": "1882010",
    "end": "1888340"
  },
  {
    "text": "that disadvantage in the same time I'm talking about the advantages but yes it's beneficial because that extra UDP",
    "start": "1888340",
    "end": "1896140"
  },
  {
    "text": "requests to get the DNS which is not really much if you think about it but saves few milliseconds few milliseconds",
    "start": "1896140",
    "end": "1904330"
  },
  {
    "text": "can add up do you have a lot of DNS right especially if you're flooded with",
    "start": "1904330",
    "end": "1909610"
  },
  {
    "text": "DNS requests right so having one central place to to make all that stuff resolve",
    "start": "1909610",
    "end": "1915070"
  },
  {
    "text": "it in documents can speed up things okay rewrite script to authorize code I haven't seen an example of that but",
    "start": "1915070",
    "end": "1921670"
  },
  {
    "text": "that's what they claim they do varnish right so like if there's a complex",
    "start": "1921670",
    "end": "1927340"
  },
  {
    "text": "JavaScript code okay that can be written in a more optimal way they will do that",
    "start": "1927340",
    "end": "1933640"
  },
  {
    "text": "for you right on they all like you request an document and they know like hey you're writing it this way by we can",
    "start": "1933640",
    "end": "1939460"
  },
  {
    "text": "rewrite it to do this way let giving the same output a little dangerous but they",
    "start": "1939460",
    "end": "1945490"
  },
  {
    "text": "do that right if there's something unnecessary they will optimize the JavaScript again because they can look",
    "start": "1945490",
    "end": "1950830"
  },
  {
    "text": "at your data they can look at everything you're doing so varnish if you're really",
    "start": "1950830",
    "end": "1956140"
  },
  {
    "text": "worried about security you gotta really think hard about varnish right because",
    "start": "1956140",
    "end": "1961540"
  },
  {
    "text": "if orange was exploited you're done dude okay because it's everything is cached",
    "start": "1961540",
    "end": "1968380"
  },
  {
    "text": "your ADA is cached right so yeah same",
    "start": "1968380",
    "end": "1973930"
  },
  {
    "text": "thing with the layer 7 load balancing so speed of load balancing yeah",
    "start": "1973930",
    "end": "1980740"
  },
  {
    "text": "orange supports that because it servers proxy it's built in the features of",
    "start": "1980740",
    "end": "1986350"
  },
  {
    "text": "reverse proxy where it can act like a load balancer if you want it to so you",
    "start": "1986350",
    "end": "1992860"
  },
  {
    "text": "have like you make a request of varnish I'm gonna three backends right in my case and my",
    "start": "1992860",
    "end": "1999000"
  },
  {
    "text": "demo that I did I had one back-end but you can have two nothing stopping you from adding two backends right I should",
    "start": "1999000",
    "end": "2005870"
  },
  {
    "text": "have done that I think but it's really easy just spin up another node.js and literally just add an extra line in the",
    "start": "2005870",
    "end": "2012470"
  },
  {
    "text": "VCL to point to the extra back-end and you're done so yeah doubles at the load balancer",
    "start": "2012470",
    "end": "2017810"
  },
  {
    "text": "back incredible I didn't talk about that but this is powerful stuff right so this is comes back to the multiplexing it's",
    "start": "2017810",
    "end": "2024140"
  },
  {
    "text": "not really multiplexing but I like to call it that so what happens here is when varnish",
    "start": "2024140",
    "end": "2030860"
  },
  {
    "text": "starts you say hey okay there is a very similar to a proxy by the way you spin up varnish and he says hey my back end",
    "start": "2030860",
    "end": "2038060"
  },
  {
    "text": "is Amb right I'm gonna go ahead and establish TCP connections to my back-end",
    "start": "2038060",
    "end": "2044060"
  },
  {
    "text": "right just to get ready to execute stuff and it knows it can do this because it",
    "start": "2044060",
    "end": "2051110"
  },
  {
    "text": "knows it only supports HTTP on the backend oh yeah so if start with a pool",
    "start": "2051110",
    "end": "2056658"
  },
  {
    "text": "of connection and every request if required only it will hit the backend",
    "start": "2056659",
    "end": "2063110"
  },
  {
    "text": "using one of the pool of connection you can set up how many connections and an",
    "start": "2063110",
    "end": "2068120"
  },
  {
    "text": "old I don't know that jazz rhyme you can set up how many maximum connection in the backend and all that stuff right so",
    "start": "2068120",
    "end": "2074540"
  },
  {
    "text": "yeah so can the connection can be busy and all that stuff right so yeah but an only support HTTP in the backend right",
    "start": "2074540",
    "end": "2081710"
  },
  {
    "text": "the varnish plus I think supports HTTP if you add like an SSL a call true okay",
    "start": "2081710",
    "end": "2089540"
  },
  {
    "text": "if you have the moment you enable that SSL parameter if you have varnish plus",
    "start": "2089540",
    "end": "2095540"
  },
  {
    "text": "if you paid for that software you can make request on the back end that are",
    "start": "2095540",
    "end": "2102430"
  },
  {
    "text": "secure right if you're back in here when I say back in is whatever behind varnish",
    "start": "2102430",
    "end": "2107780"
  },
  {
    "text": "it is HTTP by default varnish open-source will not work with it you",
    "start": "2107780",
    "end": "2113330"
  },
  {
    "text": "have to have varnish varnish modules that's a powerful stuff so you can extend your varnish with mods",
    "start": "2113330",
    "end": "2119920"
  },
  {
    "text": "essentially right to do stuff so hey make a request what do you want to do I want to rewrite the headers which",
    "start": "2119920",
    "end": "2126110"
  },
  {
    "text": "varnish does by the way the rewrite headers as we saw like it as via header and it can also add other",
    "start": "2126110",
    "end": "2132580"
  },
  {
    "text": "headers if you want to rain you can you can write your own v mods to do very",
    "start": "2132580",
    "end": "2139150"
  },
  {
    "text": "fancy stuff like enable post request caching if you want to write because you",
    "start": "2139150",
    "end": "2146320"
  },
  {
    "text": "know varnish caches only get requests because they are safe and each side",
    "start": "2146320",
    "end": "2152620"
  },
  {
    "text": "includes that's a very interesting one a very very modern stuff right this edge side includes all right and I don't know",
    "start": "2152620",
    "end": "2160390"
  },
  {
    "text": "if you guys heard about this concept of edge computing but essentially varnish plays very important role in this thing",
    "start": "2160390",
    "end": "2167710"
  },
  {
    "text": "and CloudFlare if you heard about this big content delivery network they",
    "start": "2167710",
    "end": "2174340"
  },
  {
    "text": "heavily cache pages based on this right and they cache these pages they can",
    "start": "2174340",
    "end": "2183430"
  },
  {
    "text": "guarantee better delivery to your clients for centrally right instead of",
    "start": "2183430",
    "end": "2188860"
  },
  {
    "text": "having two goal ways go to the backend server to pull a piece of content like a document or javascript file they can't",
    "start": "2188860",
    "end": "2195640"
  },
  {
    "text": "cash it and here's the problem though with caching pages you know their pages",
    "start": "2195640",
    "end": "2202300"
  },
  {
    "text": "is not always static this is not 1991 okay it's not everything is a marquis",
    "start": "2202300",
    "end": "2209200"
  },
  {
    "text": "squared and the flashy images right it's it's more fancier we have dynamic pages",
    "start": "2209200",
    "end": "2216250"
  },
  {
    "text": "we have personalized pages like if I log into a page the page will show up",
    "start": "2216250",
    "end": "2221380"
  },
  {
    "text": "personalized as like hello Hussain hello John Doe hello Jane Doe hello whatever",
    "start": "2221380",
    "end": "2228310"
  },
  {
    "text": "right but the rest of the page is almost static right sometimes it changes right",
    "start": "2228310",
    "end": "2233620"
  },
  {
    "text": "so what they says okay obviously you cannot cache these pages anymore because they are their friend right right if",
    "start": "2233620",
    "end": "2240820"
  },
  {
    "text": "there's one text that is different the whole page is different so what do you do you catch every single page where",
    "start": "2240820",
    "end": "2247750"
  },
  {
    "text": "every single name that's absolutely useless right you cannot cash that pages you will end up",
    "start": "2247750",
    "end": "2255400"
  },
  {
    "text": "caching all essentially every single permutation of the page just because I said hello John or hello Hussain or war",
    "start": "2255400",
    "end": "2263180"
  },
  {
    "text": "Oh Ally right it's the same thing right so meet edge side includes each side",
    "start": "2263180",
    "end": "2268880"
  },
  {
    "text": "includes essentially I'm gonna I'm gonna in the video as a b-roll showing you an example of how looks but the whole page",
    "start": "2268880",
    "end": "2275930"
  },
  {
    "text": "will look the same the part that changes you mark it up with a special markup",
    "start": "2275930",
    "end": "2281690"
  },
  {
    "text": "language called ESI right which is called the edge side includes so you say",
    "start": "2281690",
    "end": "2287150"
  },
  {
    "text": "hey if yes I include name whatever first name I you say something like that right",
    "start": "2287150",
    "end": "2293569"
  },
  {
    "text": "and if you did that the hell page can be cash because now it's all similar right",
    "start": "2293569",
    "end": "2300290"
  },
  {
    "text": "what is still saying you're not gonna return first name to the user there's a thing there is the varnish who does",
    "start": "2300290",
    "end": "2306430"
  },
  {
    "text": "varnish will take the continum and won't because it's cash didn't have to go back",
    "start": "2306430",
    "end": "2311990"
  },
  {
    "text": "to the server because hey it looks the same thing right and it will look at the ESI include page okay the include markup and",
    "start": "2311990",
    "end": "2319940"
  },
  {
    "text": "it will replace it with the dynamic content right powerful stuff guys I",
    "start": "2319940",
    "end": "2325609"
  },
  {
    "text": "recently learned about this is this is powerful stuff right I know CloudFlare is doing it know with each computing and",
    "start": "2325609",
    "end": "2333680"
  },
  {
    "text": "all stuff some people do fancy stuff on the front and in the edge when I say",
    "start": "2333680",
    "end": "2338869"
  },
  {
    "text": "edge here this is is it this is essentially caches HTTP accelerate or proxies right before hitting the backend",
    "start": "2338869",
    "end": "2346490"
  },
  {
    "text": "you write cool I think they call it walkers or something like that web workers I think",
    "start": "2346490",
    "end": "2353119"
  },
  {
    "text": "that's what they call it ok so web workers that generate ESI",
    "start": "2353119",
    "end": "2358160"
  },
  {
    "text": "and replace content on the fly right so you still get the benefit of caching the",
    "start": "2358160",
    "end": "2363710"
  },
  {
    "text": "page but you can change dynamically is this perfect no sorry since varnish is a cache we're gonna",
    "start": "2363710",
    "end": "2370819"
  },
  {
    "start": "2366000",
    "end": "2773000"
  },
  {
    "text": "give this first disadvantage nobody can escape this cache invalidation it's the",
    "start": "2370819",
    "end": "2379280"
  },
  {
    "text": "hardest problem in computer science it's a big claim but I am willing to say that",
    "start": "2379280",
    "end": "2386359"
  },
  {
    "text": "in my 15 years carrier this bug was the hardest to find of them all every time",
    "start": "2386359",
    "end": "2393559"
  },
  {
    "text": "we spend 5 days a bug it's because of cache invalidation",
    "start": "2393559",
    "end": "2401020"
  },
  {
    "text": "every time they are very nasty very nasty I'm talking from databases layer",
    "start": "2401020",
    "end": "2409760"
  },
  {
    "text": "from server layer from anything really",
    "start": "2409760",
    "end": "2415040"
  },
  {
    "text": "right and all stages this is the nastiest thing cache invalidation how",
    "start": "2415040",
    "end": "2420110"
  },
  {
    "text": "can I guarantee that the cache is no longer valid and I want to invalidate it",
    "start": "2420110",
    "end": "2426260"
  },
  {
    "text": "because it's something changed the data has changed it's a very hard problem to",
    "start": "2426260",
    "end": "2432470"
  },
  {
    "text": "solve some people solve it with the cache right through and all that stuff but Redis you have more control over",
    "start": "2432470",
    "end": "2439730"
  },
  {
    "text": "this thing that varnish there are tools that allow you to invalidate like purge",
    "start": "2439730",
    "end": "2446240"
  },
  {
    "text": "and ban and what they call the other thing as well forgot what it's called right the we can't you can essentially",
    "start": "2446240",
    "end": "2452870"
  },
  {
    "text": "invalidating time-to-live right you can you can you can you have tools to invalidate self but still it's very",
    "start": "2452870",
    "end": "2459080"
  },
  {
    "text": "technical very if they built right so you have to be very careful about this",
    "start": "2459080",
    "end": "2464630"
  },
  {
    "text": "cache invalidation if you don't really care if the user is served a little bit older content yeah",
    "start": "2464630",
    "end": "2472100"
  },
  {
    "text": "but sometimes like if a tweet has been deleted and varnish still returning it",
    "start": "2472100",
    "end": "2478250"
  },
  {
    "text": "that can be nasty right so you gotta be careful with this if you delete maybe",
    "start": "2478250",
    "end": "2483590"
  },
  {
    "text": "you want to just go ahead and purge that okay that's there's the purge method that actually purges that content for",
    "start": "2483590",
    "end": "2490940"
  },
  {
    "text": "you and varnish alright one of the disadvantages only works on an encrypted HTTP at least on",
    "start": "2490940",
    "end": "2495950"
  },
  {
    "text": "the open source version I know that I'm not talking about here the whole presentation here guys doesn't talk about the paid software may have more",
    "start": "2495950",
    "end": "2504050"
  },
  {
    "text": "features but the open source version only works on HTTP and it has to write",
    "start": "2504050",
    "end": "2509210"
  },
  {
    "text": "because it has to look at the data to cache it otherwise how it does it look how does it do it right so if you have",
    "start": "2509210",
    "end": "2515240"
  },
  {
    "text": "if you have a secure website you have to a certain point unencrypted send it",
    "start": "2515240",
    "end": "2523790"
  },
  {
    "text": "plain text to the varnish software so it",
    "start": "2523790",
    "end": "2530839"
  },
  {
    "text": "cache it and then if you want to eat you can encrypt it back obviously this is",
    "start": "2530839",
    "end": "2536719"
  },
  {
    "text": "not supported the backend HTTPS for varnish is not supporting open-source",
    "start": "2536719",
    "end": "2542089"
  },
  {
    "text": "at least for today a like in November 20 1901 were supported it's not not to be",
    "start": "2542089",
    "end": "2547789"
  },
  {
    "text": "supported but if you if you think about it you can you can play some tricks you",
    "start": "2547789",
    "end": "2554419"
  },
  {
    "text": "can insert another layer like a reverse proxy back end that is insecure with",
    "start": "2554419",
    "end": "2560209"
  },
  {
    "text": "varnish and then your self name like in certain ng acts at the back end but you",
    "start": "2560209",
    "end": "2565219"
  },
  {
    "text": "end up like inserting a lot of layers at that point it just kills your performance right so for HTTP front end",
    "start": "2565219",
    "end": "2571509"
  },
  {
    "text": "right you can terminate TLS well we have to terminate TOS right now I'm with",
    "start": "2571509",
    "end": "2577759"
  },
  {
    "text": "terminal TLS whether your caddy like we did use nginx or hitch which comes by",
    "start": "2577759",
    "end": "2584529"
  },
  {
    "text": "default with varnish I think as it like as a separate layer right hitch proxies",
    "start": "2584529",
    "end": "2590150"
  },
  {
    "text": "at HTTP to proxy and then caddies also db2 which always has to be HTTPS right",
    "start": "2590150",
    "end": "2596239"
  },
  {
    "text": "by default HTTP has to be like that right so yeah in the front end you get a",
    "start": "2596239",
    "end": "2601789"
  },
  {
    "text": "terminate the TLS so you can send unencrypted stuff and that's by itself",
    "start": "2601789",
    "end": "2607239"
  },
  {
    "text": "very scary right because that layer now if someone sniffs between varnish and",
    "start": "2607239",
    "end": "2614589"
  },
  {
    "text": "the TLS terminate or they'll be able to see your content right and similarly to",
    "start": "2614589",
    "end": "2621890"
  },
  {
    "text": "the backend especially in a cloud setup that stuff is dangerous for HTTP back-end there's no solution as we",
    "start": "2621890",
    "end": "2628039"
  },
  {
    "text": "talked about and barn is open source right unless you're using varnish plus I",
    "start": "2628039",
    "end": "2633979"
  },
  {
    "text": "think it's called which supports HTTP connection to a secure back-end right by",
    "start": "2633979",
    "end": "2641929"
  },
  {
    "text": "default by default open source doesn't support it yeah well we talked about we",
    "start": "2641929",
    "end": "2647659"
  },
  {
    "text": "can you can insert another layer a secure layer on the backend but that's",
    "start": "2647659",
    "end": "2653029"
  },
  {
    "text": "still useless if you think about because you just transmitted HTTP clean HTTP for",
    "start": "2653029",
    "end": "2658519"
  },
  {
    "text": "awhile right then you end up securing and it's just useless all right can't cash post request whoa",
    "start": "2658519",
    "end": "2664700"
  },
  {
    "text": "that does make sense because most requests are not cacheable by default because the HTTP standard says hey post",
    "start": "2664700",
    "end": "2671180"
  },
  {
    "text": "request is not I'd important they are not safe because they change the back end that's the semantics of HTTP but",
    "start": "2671180",
    "end": "2678380"
  },
  {
    "text": "here's the thing guys remember a few we made a video about graph QL and graph QL always uses post even for queries and",
    "start": "2678380",
    "end": "2687049"
  },
  {
    "text": "there's a reason for that right because graph QL by default since a huge QL payload right to the server",
    "start": "2687049",
    "end": "2697970"
  },
  {
    "text": "and guess what and get right it cannot use git for that because git has a limit",
    "start": "2697970",
    "end": "2703970"
  },
  {
    "text": "right because it doesn't have a body so it has a limit because everything is put in the URL parameters and if you put",
    "start": "2703970",
    "end": "2711650"
  },
  {
    "text": "everything on the URL parameter you have a limit of two thousand characters or two thousand bytes all right that's why",
    "start": "2711650",
    "end": "2718430"
  },
  {
    "text": "graph QL uses post only for normal queries so guess what varnish is useless",
    "start": "2718430",
    "end": "2726589"
  },
  {
    "text": "for you if you are using the graph here if you put varnish on in front of graph",
    "start": "2726589",
    "end": "2731930"
  },
  {
    "text": "QL you varnish is absolutely useless out of the box because it's gonna pass all",
    "start": "2731930",
    "end": "2738859"
  },
  {
    "text": "that request to the graph key well anyway so you didn't catch anything right well that can be mitigated by",
    "start": "2738859",
    "end": "2746569"
  },
  {
    "text": "writing a mod varnish mod that actually caches certain post requests based on",
    "start": "2746569",
    "end": "2753319"
  },
  {
    "text": "certain attributes but that's hard to do right because how do you know what post",
    "start": "2753319",
    "end": "2759049"
  },
  {
    "text": "request you should cache or what post request that you shouldn't cache well that's a challenge but you can do it",
    "start": "2759049",
    "end": "2766549"
  },
  {
    "text": "it's just hard to do that comes back to wise people prefer to use Redis and have",
    "start": "2766549",
    "end": "2772640"
  },
  {
    "text": "full control full responsibility on the caching versus things that ends here",
    "start": "2772640",
    "end": "2778250"
  },
  {
    "start": "2773000",
    "end": "2975000"
  },
  {
    "text": "it's like you put something implying and you hope everything is cached that's not true now you have to know how this stuff",
    "start": "2778250",
    "end": "2785510"
  },
  {
    "text": "works guys and we talked about this if you have like a you invested in a beautiful back and http2 and then right",
    "start": "2785510",
    "end": "2793520"
  },
  {
    "text": "everything is secure right and then you have this you used HTTP - and you said hey let's insert varnish",
    "start": "2793520",
    "end": "2800450"
  },
  {
    "text": "in the end in the front end like in the front of this and so we can look at caches stuff",
    "start": "2800450",
    "end": "2805970"
  },
  {
    "text": "nope nope you just lost that you just",
    "start": "2805970",
    "end": "2811850"
  },
  {
    "text": "lost the benefit HTTP - the moment you put varnish in front of an HTTP - server",
    "start": "2811850",
    "end": "2818150"
  },
  {
    "text": "you lost HTTP - you don't have that anymore you have to communicate pure",
    "start": "2818150",
    "end": "2824980"
  },
  {
    "text": "HTTP with the server which obviously downgrades your server to http one one",
    "start": "2824980",
    "end": "2830300"
  },
  {
    "text": "alright which is not as fast as HTTP 2 because the C db2 is multiplexing right",
    "start": "2830300",
    "end": "2837010"
  },
  {
    "text": "that can be debated because first point varnish plus support ich das SL",
    "start": "2837010",
    "end": "2843710"
  },
  {
    "text": "connections on the back and so I'm not sure whether varnish + supports HTTP -",
    "start": "2843710",
    "end": "2851240"
  },
  {
    "text": "as a client to a server that supports this gdb to that point I'm pretty sure",
    "start": "2851240",
    "end": "2857690"
  },
  {
    "text": "they do but I did I had woman my research I haven't seen that explicitly written so I'm not gonna say anything of",
    "start": "2857690",
    "end": "2864740"
  },
  {
    "text": "that yeah so that's one point the second point is well how frequently you gonna",
    "start": "2864740",
    "end": "2871640"
  },
  {
    "text": "hit the back in anyway that's like think about that right varnish is gonna start caching stuff preemptively right if it",
    "start": "2871640",
    "end": "2878810"
  },
  {
    "text": "catches up preemptively then that's good stuff right scissors doesn't really matter it's not like the",
    "start": "2878810",
    "end": "2886040"
  },
  {
    "text": "client is waiting for varnish to make that a quest for it right that's just one time but as as varnish start caching",
    "start": "2886040",
    "end": "2894950"
  },
  {
    "text": "stuff that won't be a problem anyway but just be aware of it be aware of this",
    "start": "2894950",
    "end": "2901820"
  },
  {
    "text": "stuff guys there's a lot of stuff summary a long video guys I know I know",
    "start": "2901820",
    "end": "2908120"
  },
  {
    "text": "but essentially we talked about classic HTTP architecture right how just normal",
    "start": "2908120",
    "end": "2914480"
  },
  {
    "text": "stuff works have a web server a database you make a request to the web server that web server next to request on this",
    "start": "2914480",
    "end": "2921710"
  },
  {
    "text": "behalf to the database Ryan and then gives you back the results we insert varnish and we beautifully were able to",
    "start": "2921710",
    "end": "2929720"
  },
  {
    "text": "cache Braco that looks similar obviously varnish has this algorithm right that dudes that's",
    "start": "2929720",
    "end": "2936759"
  },
  {
    "text": "that right we also set up an HTTP varnish like this is pure HTTP setup",
    "start": "2936759",
    "end": "2942670"
  },
  {
    "text": "varnish configuration and we also set up HTTP varnish and as in the front end",
    "start": "2942670",
    "end": "2948549"
  },
  {
    "text": "because we couldn't do it in the back end because that's what varnish doesn't support back-end HTTP as long as as",
    "start": "2948549",
    "end": "2955359"
  },
  {
    "text": "again November 2019 it does not and only support it on varnish Plus which is the",
    "start": "2955359",
    "end": "2962440"
  },
  {
    "text": "paid version right so we we did that caddy we put carry on front because a beautiful thing instead of nginx to",
    "start": "2962440",
    "end": "2968469"
  },
  {
    "text": "spice things up like we put as a TLS Terminator and we take the we talked about TLS termination guys if I'm gonna",
    "start": "2968469",
    "end": "2973959"
  },
  {
    "text": "reference the video if you're interested guys to know about that I'm finding out we're gonna talk about the pores and cause guys so what do you think are you",
    "start": "2973959",
    "end": "2980410"
  },
  {
    "start": "2975000",
    "end": "3014000"
  },
  {
    "text": "gonna use varnish what project are you getting is varnish for leave your thoughts in this so let's have a",
    "start": "2980410",
    "end": "2986199"
  },
  {
    "text": "discussion on the comment section so I get what team are you on are you team varnish we're install and",
    "start": "2986199",
    "end": "2993999"
  },
  {
    "text": "forget about it or are you team ad hoc cash like Redis we're hey I want to have",
    "start": "2993999",
    "end": "3001529"
  },
  {
    "text": "full control of my cache essentially I want to have full control of my cache and I want to catch anything I want not",
    "start": "3001529",
    "end": "3008190"
  },
  {
    "text": "just as TTP request right I hope you enjoyed this video I'm gonna see on the next one you guys stay awesome",
    "start": "3008190",
    "end": "3015019"
  }
]