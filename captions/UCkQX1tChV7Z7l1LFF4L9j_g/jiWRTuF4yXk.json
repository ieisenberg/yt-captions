[
  {
    "text": "thank you all for coming this is a talk as Jonas mentioned of the the ugly layer",
    "start": "4000",
    "end": "11799"
  },
  {
    "text": "beneath your microservices right all the infrastructure under the hood that it's gonna take to make them work and some of",
    "start": "11799",
    "end": "18130"
  },
  {
    "text": "the lessons we learned there's not a great term for this I'm just gonna use the word DevOps although it's not super",
    "start": "18130",
    "end": "24220"
  },
  {
    "text": "well defined and one of the things I want to share is kind of a confession about DevOps to start the talk off start",
    "start": "24220",
    "end": "32500"
  },
  {
    "text": "the talk off the a there is okay there's a limited range on this thing so here's the confession the the DevOps industry",
    "start": "32500",
    "end": "40629"
  },
  {
    "text": "is very much in the stone Age's and I don't say that to be mean or you know to",
    "start": "40629",
    "end": "47019"
  },
  {
    "text": "insult anybody I just mean literally we are still new to this right we have only been doing DevOps at least as a term for",
    "start": "47019",
    "end": "53319"
  },
  {
    "text": "a few years still figuring out how to do it but what's scary about that is we're",
    "start": "53319",
    "end": "58510"
  },
  {
    "text": "being asked to build things that are very modern right we're being asked to put together these amazing cutting-edge",
    "start": "58510",
    "end": "63909"
  },
  {
    "text": "infrastructures but I feel like the tooling we're using to do it looks something like that right now you",
    "start": "63909",
    "end": "70510"
  },
  {
    "text": "wouldn't know that if if all you did was you know read blog posts read the headlines everything sounds really",
    "start": "70510",
    "end": "75730"
  },
  {
    "text": "cutting edge right half the talks here half the blog posts out there they're gonna be about oh my god kubernetes and",
    "start": "75730",
    "end": "81130"
  },
  {
    "text": "docker and micro services and service meshes and all these unbelievable things that sound really cutting-edge but for",
    "start": "81130",
    "end": "89800"
  },
  {
    "text": "me as a developer on a day to day basis it doesn't feel quite so cutting edge",
    "start": "89800",
    "end": "95140"
  },
  {
    "text": "right that's not what my day-to-day experience feels like my day-to-day experience with DevOps feels a little",
    "start": "95140",
    "end": "100570"
  },
  {
    "text": "more like that okay you're like cooking pizza on an iron with a blow",
    "start": "100570",
    "end": "108500"
  },
  {
    "text": "dryer right this is this is your hashtag for this talk this is DevOps right like this is what it feels like right",
    "start": "108500",
    "end": "113770"
  },
  {
    "text": "sometimes it feels more like that right where you're like okay I guess I guess",
    "start": "113770",
    "end": "120470"
  },
  {
    "text": "that works but what why are we doing it like this and nothing seems to fit together quite",
    "start": "120470",
    "end": "126619"
  },
  {
    "text": "right everything's just weirdly connected it's just what's happening here right and",
    "start": "126619",
    "end": "132200"
  },
  {
    "text": "then you have you know like this is probably your company's CI CD pipeline right that's what it looks like so",
    "start": "132200",
    "end": "139190"
  },
  {
    "text": "that's what DevOps feels like to me and I feel like we don't admit that often enough right we don't admit the fact",
    "start": "139190",
    "end": "145130"
  },
  {
    "text": "that building things for production is hard it's really hard it actually takes",
    "start": "145130",
    "end": "152239"
  },
  {
    "text": "a lot of work to go to production it's really stressful it's really time-consuming we've worked with a whole",
    "start": "152239",
    "end": "159860"
  },
  {
    "text": "bunch of companies and also at previous jobs and the the numbers we found look something like this of the bear with me",
    "start": "159860",
    "end": "167420"
  },
  {
    "text": "this controller is infrastructure it's hard the numbers look something like",
    "start": "167420",
    "end": "172730"
  },
  {
    "text": "this if you are trying to deploy infrastructure for production use cases",
    "start": "172730",
    "end": "177859"
  },
  {
    "text": "and you're using a managed service in other words something that's managed for you by a cloud provider like AWS or",
    "start": "177859",
    "end": "183290"
  },
  {
    "text": "Azure you should expect that before you're ready to use that thing in production you're gonna spend around two",
    "start": "183290",
    "end": "188510"
  },
  {
    "text": "weeks if you're gonna go build your own distributed system on top of that you know go run a bunch of node or Ruby or",
    "start": "188510",
    "end": "194450"
  },
  {
    "text": "play apps build your little micro services you're gonna easily double that two to four weeks if those things are",
    "start": "194450",
    "end": "200390"
  },
  {
    "text": "stateless if they're stateful if it's a distributed system that needs to write data to disk and lose that data now we",
    "start": "200390",
    "end": "208280"
  },
  {
    "text": "go up an order of magnitude now we're talking to get to a production quality deployment of that we're talking two to",
    "start": "208280",
    "end": "213890"
  },
  {
    "text": "four months for each of these distributed systems so if your team is thinking of adopting the elks stack or",
    "start": "213890",
    "end": "219079"
  },
  {
    "text": "if you're thinking of adopting MongoDB or any of these large complicated systems it's gonna take you months to",
    "start": "219079",
    "end": "225350"
  },
  {
    "text": "operationalize them and then finally the entire cloud architecture right you want to go build the entire thing go to prod",
    "start": "225350",
    "end": "231069"
  },
  {
    "text": "on AWS Azure Google Cloud it's six to 24",
    "start": "231069",
    "end": "236209"
  },
  {
    "text": "months and six months it's your tiny little and 24 months and up is much more realistic for larger companies and these",
    "start": "236209",
    "end": "243200"
  },
  {
    "text": "are like best-case scenarios right so this stuff takes only long time and I as",
    "start": "243200",
    "end": "248659"
  },
  {
    "text": "an industry I don't know that we talk about this enough people like to come up here and tell you we win and not tell you that they spent three years you know",
    "start": "248659",
    "end": "254930"
  },
  {
    "text": "working on that thing so there are some things that are getting better in this industry though one of the ones that",
    "start": "254930",
    "end": "261590"
  },
  {
    "text": "makes me personally very happy is this idea of managing more and more of our infrastructure as code as opposed to",
    "start": "261590",
    "end": "267080"
  },
  {
    "text": "managing it manually by clicking around we're now managing more and more of our infrastructure as code and you're seeing",
    "start": "267080",
    "end": "274160"
  },
  {
    "text": "that across the stack so we used to provision the infrastructure manually now we have a lot of infrastructure as",
    "start": "274160",
    "end": "279169"
  },
  {
    "text": "code tools which the configure servers manually now we have a lot of configuration management tools and so on and so forth so all of this stuff is",
    "start": "279169",
    "end": "285740"
  },
  {
    "text": "being managed as code and I think that's that's a game changer I think that's hugely valuable oops",
    "start": "285740",
    "end": "293560"
  },
  {
    "text": "because code gives you a tremendous number of benefits hopefully your developers you believe in that but you",
    "start": "293560",
    "end": "299690"
  },
  {
    "text": "know things like automation right instead of deploying something manually over and over again spending hours you",
    "start": "299690",
    "end": "305030"
  },
  {
    "text": "let the computer do it computers really good at doing the same thing over and over again you get version control so",
    "start": "305030",
    "end": "310190"
  },
  {
    "text": "when something breaks the entire history of your infrastructure is in a version control system and you can just go look",
    "start": "310190",
    "end": "315200"
  },
  {
    "text": "at the commit log to find out what changed you can code review those changes right you can't code review somebody manually deploying something",
    "start": "315200",
    "end": "321440"
  },
  {
    "text": "you can write automated tests which we'll talk about a little later for your infrastructure again you can't write",
    "start": "321440",
    "end": "327470"
  },
  {
    "text": "automated tests if you do things by hand your code acts as documentation so how",
    "start": "327470",
    "end": "332990"
  },
  {
    "text": "your infrastructure works is captured in code rather than in some sysadmin x' head and you get code reuse which means",
    "start": "332990",
    "end": "339860"
  },
  {
    "text": "you can use code that you've written earlier you can use code written by others so that's kind of the genesis of",
    "start": "339860",
    "end": "346580"
  },
  {
    "text": "this talk as i work at a company called grunt work and we've built a reusable library of infrastructure code using a",
    "start": "346580",
    "end": "354349"
  },
  {
    "text": "variety of technologies and we basically have these pre-built solutions for a whole bunch of different types of infrastructure and along the way we've",
    "start": "354349",
    "end": "362539"
  },
  {
    "text": "deployed this infrastructure for hundreds of companies they're using in production and it's over three hundred",
    "start": "362539",
    "end": "367820"
  },
  {
    "text": "thousand lines of code this is actually really old number so it's probably at this stage so we've written a lot of",
    "start": "367820",
    "end": "375000"
  },
  {
    "text": "infrastructure code and my goal in this talk is to share basically the things we",
    "start": "375000",
    "end": "380490"
  },
  {
    "text": "got wrong or to share the lessons we've learned along the way so please you go out there and you're starting to use your microservices as you're starting to",
    "start": "380490",
    "end": "386820"
  },
  {
    "text": "deploy all of this stuff you can benefit from some of these lessons not make the same mistakes that we did",
    "start": "386820",
    "end": "392180"
  },
  {
    "text": "I'm Evgeny Brickman go by the nickname Jim I'm one of the cofounders of grunt",
    "start": "392180",
    "end": "398640"
  },
  {
    "text": "work and the author of a couple books terraform up and running and hello",
    "start": "398640",
    "end": "404700"
  },
  {
    "text": "startup both of which talked quite a bit about this DevOps stuff so if you're interested in learning more grab yourself a copy today here are the",
    "start": "404700",
    "end": "412050"
  },
  {
    "text": "things I'm gonna chat with you about so the first thing I'll do is I'll give you guys the the checklist and what I mean",
    "start": "412050",
    "end": "417570"
  },
  {
    "text": "by that is we're going to talk about why infrastructure work takes as long as it does then we're going to talk about some",
    "start": "417570",
    "end": "423720"
  },
  {
    "text": "of the tools that we use in the lessons from that we'll talk about how to build reusable infrastructure modules how to",
    "start": "423720",
    "end": "429360"
  },
  {
    "text": "test them and how to release them so it's a good amount to cover let me get rolling so we'll start by chatting about",
    "start": "429360",
    "end": "435960"
  },
  {
    "text": "the checklist I've generally found that there's really two groups of people",
    "start": "435960",
    "end": "441720"
  },
  {
    "text": "there's the people that have gone through the process of deploying a whole bunch of infrastructure have suffered",
    "start": "441720",
    "end": "448110"
  },
  {
    "text": "the pain have spent those six to 24 months and understand it and then there's the people who haven't for",
    "start": "448110",
    "end": "453660"
  },
  {
    "text": "newbies and when they see these numbers right when they see that it's gonna take them six to 24 months to get live for",
    "start": "453660",
    "end": "459390"
  },
  {
    "text": "production infrastructure they tend to look like that alright you gotta be kidding me it's 2019 can't possibly take",
    "start": "459390",
    "end": "466650"
  },
  {
    "text": "that long right you have a lot of overconfident engineers for like ah maybe other people take that long I'll",
    "start": "466650",
    "end": "473010"
  },
  {
    "text": "get this done in a couple weeks no you won't it's just not gonna happen it's gonna take a long time if you're",
    "start": "473010",
    "end": "480480"
  },
  {
    "text": "doing it from scratch now the question is why I'm sure many of you have experienced this right you expect it to deploy this thing in a week",
    "start": "480480",
    "end": "486900"
  },
  {
    "text": "and it took you three months so where did that time go why does this stuff take so long I think there's really two",
    "start": "486900",
    "end": "493730"
  },
  {
    "text": "main factors and a play into this the first one is something called yak",
    "start": "493730",
    "end": "499740"
  },
  {
    "text": "shaving how many of you are familiar with this term so less than half the room okay for the",
    "start": "499740",
    "end": "506360"
  },
  {
    "text": "other half of you you're welcome this is my gift to you today this is one of my favorite terms and I promise you you",
    "start": "506360",
    "end": "512209"
  },
  {
    "text": "will use this term after I introduce it to the other half of the room is smiling because you know why so what is the",
    "start": "512209",
    "end": "517909"
  },
  {
    "text": "Akshay ting so yak saving is basically this long list of tests that you do before the thing you actually wanted to",
    "start": "517909",
    "end": "524180"
  },
  {
    "text": "do and the best explanation I've seen of this comes from Seth Godin blog and he",
    "start": "524180",
    "end": "529850"
  },
  {
    "text": "tells a little story like this right so you get up one morning and you decide you're gonna wax your car so yeah cool",
    "start": "529850",
    "end": "535910"
  },
  {
    "text": "it's gonna be great gonna be a fun Saturday morning you go to the backyard you grab your hose and the hose is broken okay no problem I'll go over to",
    "start": "535910",
    "end": "543199"
  },
  {
    "text": "the to Home Depot I'll go buy a new hose you get in your car you're just about to head out and remember oh to get to Home",
    "start": "543199",
    "end": "548959"
  },
  {
    "text": "Depot I have to go through a whole bunch of toll booths and I need an EZ Pass otherwise I'm gonna be paying tolls all",
    "start": "548959",
    "end": "554839"
  },
  {
    "text": "day long so no problem I'll go grab the EZ Pass from my neighbor you're just about to head to your neighbor's house when you remember oh wait I borrowed",
    "start": "554839",
    "end": "561260"
  },
  {
    "text": "pillows last week I should return those otherwise he's not gonna give me the EZ Pass so you go find the pillows and you",
    "start": "561260",
    "end": "567019"
  },
  {
    "text": "find out all the yak hair has fallen out of the pillows while you were borrowing them and so the next thing you know",
    "start": "567019",
    "end": "572120"
  },
  {
    "text": "you're at a zoo shaving a yak also you can wax your car okay that's the action",
    "start": "572120",
    "end": "578959"
  },
  {
    "text": "if you're a programmer you know exactly what I'm talking about you've run into this a thousand times right all you",
    "start": "578959",
    "end": "584089"
  },
  {
    "text": "wanted to do was change the little button color on some part of your product and for some reason you're over here dealing with some like teal a",
    "start": "584089",
    "end": "590029"
  },
  {
    "text": "certificate issue and then you're fixing some C ICD pipeline thing and you seem to be moving backwards and sideways",
    "start": "590029",
    "end": "595610"
  },
  {
    "text": "rather than the direction you wanna go so that's yak shaving and I would argue that this in the DevOps space is",
    "start": "595610",
    "end": "602140"
  },
  {
    "text": "incidental complexity it's basically the tools that we have they're all really tightly coupled they're not super well",
    "start": "602140",
    "end": "607399"
  },
  {
    "text": "designed again remember we're still in the Stone Age us we're still learning how to do this and so as a result when",
    "start": "607399",
    "end": "612560"
  },
  {
    "text": "you try to like move one little piece that's stuck to everything else and you seem to just get into these endless yak",
    "start": "612560",
    "end": "617839"
  },
  {
    "text": "shaves so that's reason number one now the second reason is what I would argue is",
    "start": "617839",
    "end": "623839"
  },
  {
    "text": "the essential complexity of infrastructure so this is the part of the problem that's actually real that's",
    "start": "623839",
    "end": "629300"
  },
  {
    "text": "there that you have to solve and I think most people aren't aware of what most of it is so to",
    "start": "629300",
    "end": "635829"
  },
  {
    "text": "share with you kind of what we've learned in the space is I'm gonna share with you guys the what we call our",
    "start": "635829",
    "end": "641290"
  },
  {
    "text": "production grade infrastructure checklist so this is the checklist we go through when we're building infrastructure that is meant to be used",
    "start": "641290",
    "end": "647379"
  },
  {
    "text": "in production infrastructure that you are willing to bet your company on right because if you're gonna go put your company's data in some database you want",
    "start": "647379",
    "end": "655119"
  },
  {
    "text": "to know that it's not going to lose it tomorrow and take your company out of business all right so this is what I mean by production grade so here's the",
    "start": "655119",
    "end": "662110"
  },
  {
    "text": "first part of the checklist and this is the part that most people are very aware of right you want to deploy some piece",
    "start": "662110",
    "end": "668709"
  },
  {
    "text": "of infrastructure kafka elq your microservices whatever it is you realize okay I got installed some software I",
    "start": "668709",
    "end": "674860"
  },
  {
    "text": "have to configure it tell it what port numbers to use what paths to use on the hard drive I have to get some",
    "start": "674860",
    "end": "680799"
  },
  {
    "text": "infrastructure provision it might be virtual infrastructure in a cloud and then I have to deploy that software",
    "start": "680799",
    "end": "685899"
  },
  {
    "text": "across my infrastructure when you ask somebody to estimate how long it will take to deploy something these are the",
    "start": "685899",
    "end": "691839"
  },
  {
    "text": "things 99% of developers are thinking of these are the obvious ones but this is page one out of four and that's the",
    "start": "691839",
    "end": "698679"
  },
  {
    "text": "other three pages are just as important and most people don't take them into account when they're doing their estimates so here's where the real pain",
    "start": "698679",
    "end": "705879"
  },
  {
    "text": "comes in so let's like a page to page two has things that I think most of you",
    "start": "705879",
    "end": "712389"
  },
  {
    "text": "would agree are equally important right things like security how are you gonna encrypt the data in transit TLS",
    "start": "712389",
    "end": "718420"
  },
  {
    "text": "certificates how are you gonna do authentication are you gonna manage secrets server hardening each of these",
    "start": "718420",
    "end": "724509"
  },
  {
    "text": "things can be weeks of work monitoring for this new piece of infrastructure right what metrics are you gathering",
    "start": "724509",
    "end": "730059"
  },
  {
    "text": "what alerts is it going to trigger when those metrics are not where they should be logs you got to rotate them on disk you",
    "start": "730059",
    "end": "736779"
  },
  {
    "text": "can aggregate them to some central endpoint backup and restore again if you're gonna put some data in a database",
    "start": "736779",
    "end": "741790"
  },
  {
    "text": "you want to be confident that data isn't gonna disappear tomorrow this stuff takes time that's two let's go look at",
    "start": "741790",
    "end": "748720"
  },
  {
    "text": "page three how about networking right",
    "start": "748720",
    "end": "754360"
  },
  {
    "text": "especially if you're thinking about microservices here today I know a lot of you have to think about how we're gonna do service discovery and all the other",
    "start": "754360",
    "end": "760419"
  },
  {
    "text": "things you're doing with things like a service mesh how do you handle IP addresses how do you do all the subnets how are you gonna manage SSH access or",
    "start": "760419",
    "end": "767079"
  },
  {
    "text": "VPN access to your infrastructure right these are optional you have to do these things and this is where the time ends up going",
    "start": "767079",
    "end": "773340"
  },
  {
    "text": "when you're deploying piece of infrastructure you need to make it highly available heard a lot about that today scalability performance and then",
    "start": "773340",
    "end": "781470"
  },
  {
    "text": "finally page four which most people do not get to things like cost optimization right how do you make it so this thing",
    "start": "781470",
    "end": "787680"
  },
  {
    "text": "doesn't bankrupt your company that seems pretty important documentation almost nobody gets to write what did you do why",
    "start": "787680",
    "end": "793290"
  },
  {
    "text": "did you do it and then automated testing so again very few people get to this they just don't",
    "start": "793290",
    "end": "799200"
  },
  {
    "text": "think of it right you think how long is it gonna take me to deploy something and you're thinking of page one basically install configure deploy I'm done and",
    "start": "799200",
    "end": "805710"
  },
  {
    "text": "you're forgetting about three other pages of really important stuff now not every piece of infrastructure needs",
    "start": "805710",
    "end": "811470"
  },
  {
    "text": "every single one of these items but you need most of them and so the takeaway here is when you go to build something",
    "start": "811470",
    "end": "818790"
  },
  {
    "text": "in the future when your boss says how long is it gonna take you to deploy X go",
    "start": "818790",
    "end": "824130"
  },
  {
    "text": "through that checklist go through that checklist and make a very conscious decision that we will do and 2n TLS or",
    "start": "824130",
    "end": "830610"
  },
  {
    "text": "we won't we will do think about SSH access or we won't figure those out make those explicit your time estimate will",
    "start": "830610",
    "end": "836550"
  },
  {
    "text": "at least be directionally correct you'll still be off by quite a bit because of yak shaving but at least you'll be a",
    "start": "836550",
    "end": "842130"
  },
  {
    "text": "little closer so hopefully that checklist is useful you can find a more complete version of",
    "start": "842130",
    "end": "847620"
  },
  {
    "text": "it on the grunt work website grunt work dot IO it's in the footer you can also just search for the production readiness",
    "start": "847620",
    "end": "853460"
  },
  {
    "text": "checklist that's a really complete version of this use it we use it all the time it's really valuable ok",
    "start": "853460",
    "end": "861750"
  },
  {
    "text": "second item is we'll chat a little bit about the tools that we use so something",
    "start": "861750",
    "end": "868620"
  },
  {
    "text": "that a lot of people ask is what tools do we use to implement that checklist I know what I need to do how do I actually",
    "start": "868620",
    "end": "875010"
  },
  {
    "text": "do it and I'll go over the tools that we use but something important to understand is that this is not a",
    "start": "875010",
    "end": "880830"
  },
  {
    "text": "recommendation to you you're gonna have your own requirements you're gonna have your own use cases the reason I bring",
    "start": "880830",
    "end": "885959"
  },
  {
    "text": "this up is a little bit different and I'll cover that in just a second so just to answer the question at grunt work the",
    "start": "885959",
    "end": "891300"
  },
  {
    "text": "tools that we use we like things that let us manage our infrastructures code of course we like things that are",
    "start": "891300",
    "end": "897150"
  },
  {
    "text": "open-source things that have large communities support multiple providers multiple cloud",
    "start": "897150",
    "end": "903450"
  },
  {
    "text": "that have strong support for reuse and composition of the code composable pieces are important at the",
    "start": "903450",
    "end": "909270"
  },
  {
    "text": "infrastructure layer as well we'll talk about that in a bit we like tools that don't require us to run other tools just to use those tools",
    "start": "909270",
    "end": "915810"
  },
  {
    "text": "and we like the idea of immutable infrastructure so we'll cover all of that a little bit later so the tools",
    "start": "915810",
    "end": "921870"
  },
  {
    "text": "that we're using as of today looks something like this come on",
    "start": "921870",
    "end": "927890"
  },
  {
    "text": "there we go at the basic layer all of our general networking load balancers",
    "start": "927890",
    "end": "934920"
  },
  {
    "text": "all the integrations with services all the server's themselves which are usually virtual servers all of that we",
    "start": "934920",
    "end": "940320"
  },
  {
    "text": "deploy and manage using terraform which lets us do it all s code using HDL is",
    "start": "940320",
    "end": "946080"
  },
  {
    "text": "the language on top of that those servers are running some sort of virtual machine images in Amazon for example",
    "start": "946080",
    "end": "953250"
  },
  {
    "text": "those are Amazon machine images and we define and manage those as code using Packer and other open source tool lets",
    "start": "953250",
    "end": "960810"
  },
  {
    "text": "you manage things as code now some of those virtual machine images run some sort of docker agent that might be",
    "start": "960810",
    "end": "967620"
  },
  {
    "text": "something to do with the kubernetes or ECS or some other docker cluster and so those servers form into a docker cluster",
    "start": "967620",
    "end": "973650"
  },
  {
    "text": "and in that cluster we're gonna run any of our docker workloads so all sorts of",
    "start": "973650",
    "end": "979020"
  },
  {
    "text": "containers and darker lets us define how to deploy and manage those services as code usually using something like a",
    "start": "979020",
    "end": "985140"
  },
  {
    "text": "docker file and then the hidden layer under the hood that most people don't tell you about but it's always there is",
    "start": "985140",
    "end": "991230"
  },
  {
    "text": "all of this stuff is glued together using a combination of basically this is our duct-tape write bash script go for",
    "start": "991230",
    "end": "997860"
  },
  {
    "text": "binaries Python scripts when we can use them so that's a stack but here's the thing these are great tools if you can",
    "start": "997860",
    "end": "1005030"
  },
  {
    "text": "use them great but that's not really the takeaway here the real takeaway here is that whatever toolset fits your company",
    "start": "1005030",
    "end": "1011870"
  },
  {
    "text": "whatever you end up picking isn't gonna be enough right you could pick the most perfect tools that you could copy",
    "start": "1011870",
    "end": "1017089"
  },
  {
    "text": "exactly what we did or come up with something different and it won't matter at all unless you also change the behavior of your team and give them the",
    "start": "1017089",
    "end": "1024438"
  },
  {
    "text": "time to learn these tools and so infrastructures code is not useful just",
    "start": "1024439",
    "end": "1030199"
  },
  {
    "text": "in and of itself it only is useful when combined with a change in how your works on a day to day basis and I'll",
    "start": "1030199",
    "end": "1036279"
  },
  {
    "text": "give you a really simple example of where this is absolutely critical so most of your team if you're not using",
    "start": "1036279",
    "end": "1041678"
  },
  {
    "text": "infrastructure as code tools it's probably used to doing something like",
    "start": "1041679",
    "end": "1047288"
  },
  {
    "text": "this you need to make a change to the infrastructure you do it manually and you do it directly you SSH to a server",
    "start": "1047289",
    "end": "1052360"
  },
  {
    "text": "you connect to it you run some command tada I made the change that I needed to now what we're saying is when you",
    "start": "1052360",
    "end": "1058210"
  },
  {
    "text": "introduce any of those tools chef puppet terraform whatever it is you're saying that now we have this layer of",
    "start": "1058210",
    "end": "1064210"
  },
  {
    "text": "indirection now to make a change I have to go check out some code I have to change the code and then I have to run",
    "start": "1064210",
    "end": "1070779"
  },
  {
    "text": "some tool or some process and that's the thing that's gonna change my infrastructure and that's great but the",
    "start": "1070779",
    "end": "1076149"
  },
  {
    "text": "thing to remember is that these pieces in the middle they take time to learn to",
    "start": "1076149",
    "end": "1081190"
  },
  {
    "text": "understand to internalize not like five minutes of time like weeks months",
    "start": "1081190",
    "end": "1086200"
  },
  {
    "text": "potentially for your team to get used to this it takes much longer than doing it directly and so here's what's gonna",
    "start": "1086200",
    "end": "1092139"
  },
  {
    "text": "happen and if you don't prevent this upfront I guarantee this will happen no matter what tools you're using you're gonna",
    "start": "1092139",
    "end": "1099100"
  },
  {
    "text": "have an outage something is going to go wrong and now your ops person your dev",
    "start": "1099100",
    "end": "1104289"
  },
  {
    "text": "ops your system man whoever it is is gonna have to make a change a choice they can spend five minutes making a fix",
    "start": "1104289",
    "end": "1112000"
  },
  {
    "text": "directly and they know how to do that already or they can spend two weeks or two months learning those tools what are",
    "start": "1112000",
    "end": "1118840"
  },
  {
    "text": "they going to choose during the outage pretty clearly they're gonna make the change by hand what does that lead to",
    "start": "1118840",
    "end": "1124860"
  },
  {
    "text": "well it turns out with infrastructures code if you're making changes manually then the code that you worked so hard on",
    "start": "1124860",
    "end": "1131799"
  },
  {
    "text": "does not represent reality anymore it does not match what's actually deployed what's actually running so as a result",
    "start": "1131799",
    "end": "1138309"
  },
  {
    "text": "the next person that tries to use your code is going to get an error and guess",
    "start": "1138309",
    "end": "1143740"
  },
  {
    "text": "what they're gonna do they're gonna say that this this infrastructures code thing doesn't work I'm gonna go back and I'm gonna make a change manually and",
    "start": "1143740",
    "end": "1150159"
  },
  {
    "text": "that's gonna screw over the next person the next person and you might have spent three months writing the most amazing code and in a week of outages all of it",
    "start": "1150159",
    "end": "1156399"
  },
  {
    "text": "becomes useless and no one's using it and that's a problem because changing things by hand does not skip right if",
    "start": "1156399",
    "end": "1161980"
  },
  {
    "text": "you're a three person company sure whatever do whatever you need to do but as you grow it does not scale to do",
    "start": "1161980",
    "end": "1167110"
  },
  {
    "text": "things manually whereas code does so it's worth the time to use these tools only if you",
    "start": "1167110",
    "end": "1173260"
  },
  {
    "text": "can also afford the time to let everybody learn them internalize them make them part of their process and I'll",
    "start": "1173260",
    "end": "1179140"
  },
  {
    "text": "describe a little bit what that process looks like in just a second but if you don't do that don't bother with the",
    "start": "1179140",
    "end": "1184870"
  },
  {
    "text": "tools they're not there's no silver bullets right it's not going to actually solve anything for you okay third lesson",
    "start": "1184870",
    "end": "1192370"
  },
  {
    "text": "we've learned as we wrote this huge library of code is how to build reusable",
    "start": "1192370",
    "end": "1197590"
  },
  {
    "text": "nice modules and the motivation comes that comes from the following most",
    "start": "1197590",
    "end": "1203530"
  },
  {
    "text": "people when they start using infrastructures code in any of these",
    "start": "1203530",
    "end": "1208600"
  },
  {
    "text": "tools they basically try to define all of their infrastructure in a single file or maybe a single set of files that are",
    "start": "1208600",
    "end": "1214750"
  },
  {
    "text": "all deployed and managed together so all of your environments dev stage QA prod everything defined in one place now this",
    "start": "1214750",
    "end": "1223120"
  },
  {
    "text": "has a huge huge number of downsides right for example it's gonna run slower just because there's more data to fetch",
    "start": "1223120",
    "end": "1229690"
  },
  {
    "text": "more data to update it's gonna be harder to understand nobody can read 200,000 lines of terraform and make any real",
    "start": "1229690",
    "end": "1235390"
  },
  {
    "text": "sense of them it's gonna be harder to review both the code review the changes to code review any kind of plan outputs",
    "start": "1235390",
    "end": "1240909"
  },
  {
    "text": "that you get it's harder to test we'll talk about testing having all your infrastructure in one place basically",
    "start": "1240909",
    "end": "1246429"
  },
  {
    "text": "makes testing impossible harder to reuse the code to use the code also you need",
    "start": "1246429",
    "end": "1252940"
  },
  {
    "text": "to have admin administrator permissions right since the code touches all of the infrastructure to run it at all you need",
    "start": "1252940",
    "end": "1258220"
  },
  {
    "text": "to have permissions to touch all of the infrastructure limits your concurrency also if all of your environments are",
    "start": "1258220",
    "end": "1264490"
  },
  {
    "text": "defined in one set of files then a little typo anywhere will break everything you're working on making some",
    "start": "1264490",
    "end": "1270610"
  },
  {
    "text": "silly change in stage and you take down prod so that's a problem and so the",
    "start": "1270610",
    "end": "1275860"
  },
  {
    "text": "argument that I want to make is that large modules by that I mean like a large amount of infrastructure code in",
    "start": "1275860",
    "end": "1281679"
  },
  {
    "text": "one place are a bad idea this is not a novel concept right at the end of the",
    "start": "1281679",
    "end": "1287110"
  },
  {
    "text": "day infrastructure as code the important part here is it's still code and we know this in every other programming language",
    "start": "1287110",
    "end": "1293409"
  },
  {
    "text": "right if you wrote in Java a single function that was 200,000 lines long",
    "start": "1293409",
    "end": "1298770"
  },
  {
    "text": "that probably wouldn't get through your code process right we know not to build gigantic amounts of code in one place",
    "start": "1298770",
    "end": "1305349"
  },
  {
    "text": "and every other language in every other environment but for some reason when people go to infrastructure code they assume that somehow different and they",
    "start": "1305349",
    "end": "1311379"
  },
  {
    "text": "forget all the practices that they've learned and they shove everything into one place so that's a bad idea that is going to hurt almost immediately and",
    "start": "1311379",
    "end": "1318700"
  },
  {
    "text": "it's only gonna get worse as your company grows so what you want to do is",
    "start": "1318700",
    "end": "1323789"
  },
  {
    "text": "you do not want to build big modules at the very least to protect against the last issue I mentioned the outages you",
    "start": "1323789",
    "end": "1330519"
  },
  {
    "text": "want to make sure that your environments are isolated from each other that's why you have separate environments but even",
    "start": "1330519",
    "end": "1336070"
  },
  {
    "text": "within an environment you want to isolate the different pieces from each other so for example if you have some",
    "start": "1336070",
    "end": "1341889"
  },
  {
    "text": "code that deploys your VP sees basically the network topology all the subnets the route tables IP addressing",
    "start": "1341889",
    "end": "1349419"
  },
  {
    "text": "that's probably code that you set up once and you're probably not going to touch it again for a really long time but you probably also have code that",
    "start": "1349419",
    "end": "1356320"
  },
  {
    "text": "deploys your micro services your individual apps and you might deploy those ten times per day so if both of",
    "start": "1356320",
    "end": "1362499"
  },
  {
    "text": "those types of code live in one place if they're deployed together if they're managed together then ten times per day",
    "start": "1362499",
    "end": "1367779"
  },
  {
    "text": "you're putting your entire VPC at risk of a silly typo of a human error of some",
    "start": "1367779",
    "end": "1373239"
  },
  {
    "text": "just minor thing that can take down the entire network for your entire production site that's not a good thing",
    "start": "1373239",
    "end": "1379899"
  },
  {
    "text": "to do and so generally speaking because the cost of getting it wrong here is so high you want to isolate different",
    "start": "1379899",
    "end": "1386889"
  },
  {
    "text": "components of your infrastructure from each other as well where a component is based on how often it's deployed if it's",
    "start": "1386889",
    "end": "1393190"
  },
  {
    "text": "deployed together risk levels right so typically your networking is separate from your data stores is separate from",
    "start": "1393190",
    "end": "1398830"
  },
  {
    "text": "your apps that's kind of the basic breakdown but that only fixes the issue of well I broke everything all the other",
    "start": "1398830",
    "end": "1405190"
  },
  {
    "text": "issues would remain if that's all you did right you still have to think about the fact that it runs slower the thing that it's harder to test the fact that",
    "start": "1405190",
    "end": "1410889"
  },
  {
    "text": "it's harder to reuse the code so really the way I want you to think about your architecture when you're working on infrastructure code is if this is your",
    "start": "1410889",
    "end": "1417700"
  },
  {
    "text": "architecture right you have all sorts of servers and load balancers databases caches queues etc then the way to think",
    "start": "1417700",
    "end": "1424419"
  },
  {
    "text": "of this as infrastructure code is not I'm gonna sit down and write that the way to think about it is I'm gonna go",
    "start": "1424419",
    "end": "1430299"
  },
  {
    "text": "and create a bunch of standalone little modules for each of those pieces or just like in functional programming you",
    "start": "1430299",
    "end": "1436510"
  },
  {
    "text": "wouldn't write one function you write a bunch of individual little functions each responsible for one thing and then",
    "start": "1436510",
    "end": "1441910"
  },
  {
    "text": "you compose them all together that's how you should think about infrastructure code as well I call these modules that",
    "start": "1441910",
    "end": "1448300"
  },
  {
    "text": "seems to be the generic term in the infrastructure world but really they're no different than functions they take in some inputs they produce some output and",
    "start": "1448300",
    "end": "1454330"
  },
  {
    "text": "you should be able to compose them together so typically what that looks like is you start by breaking down your",
    "start": "1454330",
    "end": "1461110"
  },
  {
    "text": "environments so dev stage and prod live in separate folders they're separated from a code perspective within each",
    "start": "1461110",
    "end": "1468520"
  },
  {
    "text": "environment you have those different components so as I said your networking layer separate from your database layer",
    "start": "1468520",
    "end": "1474940"
  },
  {
    "text": "separate from your app layer under the hood those things are using reusable",
    "start": "1474940",
    "end": "1479950"
  },
  {
    "text": "modules basically functions to implement them so it's not like those are copied and pasted under the hood they're using",
    "start": "1479950",
    "end": "1486250"
  },
  {
    "text": "a shared library that you can build out and that library itself should be made again from even simpler pieces again",
    "start": "1486250",
    "end": "1493390"
  },
  {
    "text": "this is there's nothing new here that I'm telling you other than just whatever programming practices you would use in your java code in your Scala code in",
    "start": "1493390",
    "end": "1500590"
  },
  {
    "text": "your Python code use them in your infrastructure code as well it's still code the same practices tend to apply so",
    "start": "1500590",
    "end": "1507700"
  },
  {
    "text": "I'll show you a really quick example just of what the infrastructure code can look like just to build your your",
    "start": "1507700",
    "end": "1513490"
  },
  {
    "text": "intuition around this example I'll look at really quickly here is there's a set",
    "start": "1513490",
    "end": "1522430"
  },
  {
    "text": "of there's my mouse there's a set of modules that are open source",
    "start": "1522430",
    "end": "1528250"
  },
  {
    "text": "I'll make the font a little bigger for something called default for deploying Vault on AWS",
    "start": "1528250",
    "end": "1534070"
  },
  {
    "text": "so vault is an open source tool for storing secrets things like database",
    "start": "1534070",
    "end": "1540190"
  },
  {
    "text": "passwords TLS certificates all that stuff you need a secure way to store it vault is a nice open store solution but",
    "start": "1540190",
    "end": "1547750"
  },
  {
    "text": "it's a reasonably complicated piece of infrastructure vault itself is a distributed system so you typically run",
    "start": "1547750",
    "end": "1553180"
  },
  {
    "text": "three vault servers it tend the recommended way to run it is with",
    "start": "1553180",
    "end": "1558190"
  },
  {
    "text": "another system called console which is itself a distributed key-value store and you typically run five of those servers",
    "start": "1558190",
    "end": "1563950"
  },
  {
    "text": "there's all sorts of networking things TLS certs you have to worry about so there's a decent of things to think through and so you",
    "start": "1563950",
    "end": "1571299"
  },
  {
    "text": "can look at this later on after the talk if you're interested just to see an example of how you can build reusable",
    "start": "1571299",
    "end": "1576730"
  },
  {
    "text": "code to do this I'll show you the vault code checked out here in on my computer",
    "start": "1576730",
    "end": "1583990"
  },
  {
    "text": "I don't know if you can read that maybe make the font a little bigger let's try",
    "start": "1583990",
    "end": "1591900"
  },
  {
    "text": "that a little better all right well over here there's",
    "start": "1591900",
    "end": "1596950"
  },
  {
    "text": "basically three main folders examples modules and tests the rest of the stuff you can ignore examples modules tests so",
    "start": "1596950",
    "end": "1604840"
  },
  {
    "text": "the modules folder is going to have the core implementation for vault and the thing to notice a here is there isn't",
    "start": "1604840",
    "end": "1611049"
  },
  {
    "text": "just one vault module that deploys all of Ault and all of console and all of those dependencies it actually consists",
    "start": "1611049",
    "end": "1617500"
  },
  {
    "text": "of a bunch of small sub modules in other words basically smaller functions that get combined to make bigger ones so for",
    "start": "1617500",
    "end": "1624490"
  },
  {
    "text": "example here there's one module called vault cluster and this happens to be terraformed code that deploys an auto",
    "start": "1624490",
    "end": "1632200"
  },
  {
    "text": "scaling group and a launch configuration basically a bunch of infrastructure to run a cluster of servers for vault now",
    "start": "1632200",
    "end": "1638529"
  },
  {
    "text": "that's one module in here and that's all it does separate from that we have another one for example to attach",
    "start": "1638529",
    "end": "1644799"
  },
  {
    "text": "security group rules these are essentially the firewall rules for what traffic can go in and out of halt that's",
    "start": "1644799",
    "end": "1650890"
  },
  {
    "text": "also terraform code and it lives in a completely separate module and even separate from that or other things like",
    "start": "1650890",
    "end": "1657010"
  },
  {
    "text": "install vault this happens to be a bash script that can install a specific version of vaults that you specify on a",
    "start": "1657010",
    "end": "1662860"
  },
  {
    "text": "linux server so as you can see it's a bunch of these separate orthogonal standalone pieces why why build it this",
    "start": "1662860",
    "end": "1669159"
  },
  {
    "text": "way one thing that's really important understand is you get a lot more reuse",
    "start": "1669159",
    "end": "1675279"
  },
  {
    "text": "out of it this way and I don't mean just in some hypothetical like you're not going to need it approach I mean even",
    "start": "1675279",
    "end": "1680740"
  },
  {
    "text": "within a single company if you're running vault in production you'll probably deploy it like that right",
    "start": "1680740",
    "end": "1685960"
  },
  {
    "text": "three vault servers maybe five console servers separate clusters scaled separately but in your pre-production",
    "start": "1685960",
    "end": "1693039"
  },
  {
    "text": "environments you're not going to do that that's really expensive why waste you might run it all on a single cluster might even run it on a single server if",
    "start": "1693039",
    "end": "1700330"
  },
  {
    "text": "you write your code as one giant super module it's really hard to make it support both use cases",
    "start": "1700330",
    "end": "1705690"
  },
  {
    "text": "whereas if you build it out of these small individual LEGO building blocks you can compose them and combine them in",
    "start": "1705690",
    "end": "1711370"
  },
  {
    "text": "many different combinations so I can use for example the firewall security group rules for vault and I can attach those",
    "start": "1711370",
    "end": "1717580"
  },
  {
    "text": "to another module that deploys console because there's separate pieces and I can combine them in different ways so",
    "start": "1717580",
    "end": "1723520"
  },
  {
    "text": "exactly like functional programming nothing different here we're just it's a different language than you might be used to so we have a bunch of these",
    "start": "1723520",
    "end": "1729909"
  },
  {
    "text": "standalone little pieces and then in the examples folder we show you the different ways to put them together this",
    "start": "1729909",
    "end": "1735700"
  },
  {
    "text": "is basically think of it as executable documentation right so we have an example in here of how to run a private",
    "start": "1735700",
    "end": "1741490"
  },
  {
    "text": "vault cluster and under the hood this thing is using some of those little sub modules that I showed you earlier and",
    "start": "1741490",
    "end": "1747340"
  },
  {
    "text": "it's combining them with some modules from another repo that run console and a",
    "start": "1747340",
    "end": "1752380"
  },
  {
    "text": "bunch of other stuff so it shows you one way to assemble these building blocks and there's also examples here of how to",
    "start": "1752380",
    "end": "1757510"
  },
  {
    "text": "build for example a virtual machine image this is a using Packer so all",
    "start": "1757510",
    "end": "1762610"
  },
  {
    "text": "sorts of examples know how to do this stuff now why why bother writing all of this example code well for one thing",
    "start": "1762610",
    "end": "1769210"
  },
  {
    "text": "this is documentation right so this is good for your team to have access to but the other really critical reason we",
    "start": "1769210",
    "end": "1774340"
  },
  {
    "text": "always write these example code is the test folder so in here we have automated",
    "start": "1774340",
    "end": "1780640"
  },
  {
    "text": "tests and the way we test our infrastructure code is we're going to deploy those examples the examples are",
    "start": "1780640",
    "end": "1787210"
  },
  {
    "text": "how we're gonna test everything which creates a really nice virtual virtuous cycle right we create a bunch of reusable code we show you ways to put it",
    "start": "1787210",
    "end": "1794230"
  },
  {
    "text": "together in the examples folder and then we have tests that after every commit ensure the examples do what they should",
    "start": "1794230",
    "end": "1799929"
  },
  {
    "text": "which means the underlying modules do what they should so I'll show you what the tests look like in just a minute but",
    "start": "1799929",
    "end": "1805929"
  },
  {
    "text": "that's your basic folder structure of how to build reusable composable modules",
    "start": "1805929",
    "end": "1812110"
  },
  {
    "text": "I have small pieces that each do one thing right UNIX philosophy says this functional programming says this you",
    "start": "1812110",
    "end": "1818500"
  },
  {
    "text": "should do it in infrastructure world as well so walk through these things let's get forward okay so that's the key",
    "start": "1818500",
    "end": "1826840"
  },
  {
    "text": "takeaway is if you open up your codebase for chef puppet terraform whatever tools",
    "start": "1826840",
    "end": "1832840"
  },
  {
    "text": "you're using and you see one folder that has two million lines of code that should be a huge red flag that",
    "start": "1832840",
    "end": "1839029"
  },
  {
    "text": "should be a code smell just like it would be in any other language so small reusable composable pieces we have a",
    "start": "1839029",
    "end": "1845659"
  },
  {
    "text": "very large library of code and this has been the route to success to build code that is actually that we're usable",
    "start": "1845659",
    "end": "1850730"
  },
  {
    "text": "testable that you can code review etc okay I've mentioned testing a few times",
    "start": "1850730",
    "end": "1856570"
  },
  {
    "text": "let me quickly talk about how that works so one of the things we've learned",
    "start": "1856570",
    "end": "1862519"
  },
  {
    "text": "building out this library even before we built this library when we tried to use some of the open source things that are",
    "start": "1862519",
    "end": "1868490"
  },
  {
    "text": "out there is that infrastructure code in particular rots very very quickly right",
    "start": "1868490",
    "end": "1874909"
  },
  {
    "text": "all of the underlying pieces are changing all the cloud providers are changing and releasing things all the time all the tools like terraform and",
    "start": "1874909",
    "end": "1881779"
  },
  {
    "text": "chef they're changing all the time Dockers changing all the time so this code doesn't last very long before it",
    "start": "1881779",
    "end": "1887570"
  },
  {
    "text": "starts to break down so really this is just another way of saying that infrastructure code that does not have",
    "start": "1887570",
    "end": "1893659"
  },
  {
    "text": "automated tests is broken and I mean that both that's like a moral take away",
    "start": "1893659",
    "end": "1899360"
  },
  {
    "text": "you know lesson for today but I also mean that very literally we have found every single time that we have written a",
    "start": "1899360",
    "end": "1904549"
  },
  {
    "text": "non-trivial piece of infrastructure test that it to the best of our ability manually even sometimes run it in",
    "start": "1904549",
    "end": "1910820"
  },
  {
    "text": "production taking the time to go and write an automated test for it has almost always revealed non-trivial bugs",
    "start": "1910820",
    "end": "1917750"
  },
  {
    "text": "things that we were missing until then there is some sort of magic that when you take the time to automate a process",
    "start": "1917750",
    "end": "1923629"
  },
  {
    "text": "you discover all sorts of issues and things you didn't realize before in both bugs in your own code which we have",
    "start": "1923629",
    "end": "1930769"
  },
  {
    "text": "plenty of but we found bugs in all of our dependencies too when deploying elasticsearch we actually found several",
    "start": "1930769",
    "end": "1936620"
  },
  {
    "text": "non-trivial bugs in elasticsearch because we had automated tests we found many non-trivial bugs in AWS and google",
    "start": "1936620",
    "end": "1943250"
  },
  {
    "text": "cloud itself and of course in terraform and in docker all the tools were using so these automated tests like I mean",
    "start": "1943250",
    "end": "1949159"
  },
  {
    "text": "this very literal if you have a pile of infrastructure code and some repo that doesn't have tests that code is broken I",
    "start": "1949159",
    "end": "1954320"
  },
  {
    "text": "absolutely guarantee it it's broken so how do you test it well for the",
    "start": "1954320",
    "end": "1959539"
  },
  {
    "text": "general-purpose languages we we more or less know how to test right we can run the code on localhost on your",
    "start": "1959539",
    "end": "1966240"
  },
  {
    "text": "top and you can write unit tests that mock outside dependencies and kind of test your code in isolation so we more",
    "start": "1966240",
    "end": "1973140"
  },
  {
    "text": "or less know how to do that but what do you do for infrastructure code well what makes testing infrastructure code pretty",
    "start": "1973140",
    "end": "1979679"
  },
  {
    "text": "tricky is we don't have localhost if I write terraform code to deploy an AWS V",
    "start": "1979679",
    "end": "1985860"
  },
  {
    "text": "PC or Google Cloud V PC I can't run that on my own laptop there's no local host",
    "start": "1985860",
    "end": "1991440"
  },
  {
    "text": "equivalent for that I also can't really do unit testing because if you think about what your infrastructure code is",
    "start": "1991440",
    "end": "1997290"
  },
  {
    "text": "doing most of what that code does is talk to the outside world it talks to AWS or Google Cloud or Asher if I try to",
    "start": "1997290",
    "end": "2005030"
  },
  {
    "text": "mock the outside world there's nothing left right there's nothing left to test so I don't really have localhost I don't",
    "start": "2005030",
    "end": "2010700"
  },
  {
    "text": "relate in unit testing so really the only testing you have left with infrastructure code is essentially what you would normally call integration",
    "start": "2010700",
    "end": "2016580"
  },
  {
    "text": "testing sometimes end-to-end testing and the test strategy is going to look like this you're going to deploy your",
    "start": "2016580",
    "end": "2022340"
  },
  {
    "text": "infrastructure for real you're going to validate that it works the way you expect it to and then you're are you going to undo ploys so I'll show you an",
    "start": "2022340",
    "end": "2029840"
  },
  {
    "text": "example of this the example that I'm showing you is written with the help of a tool called terror tests this is an",
    "start": "2029840",
    "end": "2035809"
  },
  {
    "text": "open source library for writing tests in go and it helps you implement that pattern of bring your infrastructure up",
    "start": "2035809",
    "end": "2042440"
  },
  {
    "text": "validate it and then tear the infrastructure back down and originally we built it for terraform that's why it",
    "start": "2042440",
    "end": "2047720"
  },
  {
    "text": "has that name but it now works with Packer with docker with kubernetes with helm charts with AWS with Google Cloud a",
    "start": "2047720",
    "end": "2054800"
  },
  {
    "text": "whole bunch of different things so it's actually a general purpose tool for integration testing but the name has",
    "start": "2054800",
    "end": "2061638"
  },
  {
    "text": "stuck we're not very good at naming things so the tear test philosophy is to basically ask the question how would you",
    "start": "2061639",
    "end": "2067128"
  },
  {
    "text": "have tested this thing manually right so let's look again at that example of",
    "start": "2067129",
    "end": "2072320"
  },
  {
    "text": "vault so okay here's my vault infrastructure I wrote a pile of code to deploy this",
    "start": "2072320",
    "end": "2079658"
  },
  {
    "text": "how do I know it's working well probably the way I would test that it's working as I would connect to each node make",
    "start": "2079659",
    "end": "2086240"
  },
  {
    "text": "sure it's up run some vault commands on them like to initialize the vault cluster to unseal it",
    "start": "2086240",
    "end": "2092030"
  },
  {
    "text": "I'd probably store some data I'd probably read the data back out basically do a bunch of sanity checks that my infrastructure does what it says",
    "start": "2092030",
    "end": "2098570"
  },
  {
    "text": "on the box so the idea with tear test is you're gonna implement exactly those same steps as code that's it it's not magic it's",
    "start": "2098570",
    "end": "2106970"
  },
  {
    "text": "not easy necessarily but it's incredibly effective because what this is gonna do is you're gonna verify that your",
    "start": "2106970",
    "end": "2112850"
  },
  {
    "text": "infrastructure actually does what it should after every single commit rather than waiting until it hits production so",
    "start": "2112850",
    "end": "2119030"
  },
  {
    "text": "let's look at an example for bolt so I mentioned that wood vault we have all of this example code so here's this vault",
    "start": "2119030",
    "end": "2125930"
  },
  {
    "text": "cluster private example that has one particular way to use all our vault modules the test code for it lives in",
    "start": "2125930",
    "end": "2132440"
  },
  {
    "text": "here vault cluster private tests so this is go code that's going to test that",
    "start": "2132440",
    "end": "2137780"
  },
  {
    "text": "code and the test consists of essentially for what we call stages so",
    "start": "2137780",
    "end": "2143510"
  },
  {
    "text": "I'm not gonna cover what the stages are but Biscay four steps the first two if you notice they use the go key word",
    "start": "2143510",
    "end": "2149450"
  },
  {
    "text": "defer this is like a try finally block so that's what you run at the end of the test so really the test starts over here so",
    "start": "2149450",
    "end": "2156740"
  },
  {
    "text": "the first thing we're gonna do is to deploy the cluster then we're gonna validate the cluster and then at the end of the test we're going to tear it down",
    "start": "2156740",
    "end": "2162410"
  },
  {
    "text": "so what's the code actually doing so deploying the cluster whoops if we click",
    "start": "2162410",
    "end": "2168110"
  },
  {
    "text": "through here is a little pile of code that basically says okay and this is using a bunch of the helpers built in to",
    "start": "2168110",
    "end": "2174770"
  },
  {
    "text": "terror tests it says okay my example code or my real code lives in this folder I want to pass certain variables",
    "start": "2174770",
    "end": "2182000"
  },
  {
    "text": "to it that are good for test type so here we do a bunch of like unique names and a bunch of other good practices for tests and then I'm basically just gonna",
    "start": "2182000",
    "end": "2188420"
  },
  {
    "text": "run terraform in it and terraform apply to deploy this so I'm just running my code just like I would have done it",
    "start": "2188420",
    "end": "2194300"
  },
  {
    "text": "manually using some helpers from terror test once that cluster is deployed and all of those terror tests helpers will",
    "start": "2194300",
    "end": "2200600"
  },
  {
    "text": "fail the test if there's any error during deployment now I'm gonna validate that vault does what I what it should so",
    "start": "2200600",
    "end": "2207200"
  },
  {
    "text": "first I'm gonna initialize and unseal my cluster and the way to do that is basically what I described we're first",
    "start": "2207200",
    "end": "2212690"
  },
  {
    "text": "we're gonna wait for the cluster to boot up because we don't know how long that'll take and that code is basically",
    "start": "2212690",
    "end": "2218000"
  },
  {
    "text": "a retry loop that basically says hey ping each node on on the cluster until",
    "start": "2218000",
    "end": "2224150"
  },
  {
    "text": "it's up and running because you don't know exactly how long it will take a micro-services right everything's eventually consistent then I'm gonna",
    "start": "2224150",
    "end": "2232180"
  },
  {
    "text": "initialize vol and the way I do that is I'm gonna run this command right here vault operator",
    "start": "2232180",
    "end": "2237289"
  },
  {
    "text": "in it this is exactly what you would have done manually and I'm gonna do that by SSA Qing to the server and running",
    "start": "2237289",
    "end": "2242599"
  },
  {
    "text": "that command and there's basically one line or inteiro test to ssh to something an executed command then I'm gonna",
    "start": "2242599",
    "end": "2247789"
  },
  {
    "text": "unseal the clips then I'm gonna unseal each of the nodes which is basically just more SSH commands the stem vault",
    "start": "2247789",
    "end": "2254119"
  },
  {
    "text": "operation C etc hopefully you got the idea I am just implementing the steps I would have done manually as code and",
    "start": "2254119",
    "end": "2259849"
  },
  {
    "text": "this code executes after every single commit to the vault repo and that's",
    "start": "2259849",
    "end": "2265490"
  },
  {
    "text": "gonna give me pretty good confidence that my infrastructure does what it should right I now know that if I'd made",
    "start": "2265490",
    "end": "2270950"
  },
  {
    "text": "a commit to the vault repo and it deployed I know that that code can fire up a vault cluster successfully that",
    "start": "2270950",
    "end": "2276349"
  },
  {
    "text": "that I can on initialize and unseal it that I can store data in that cluster and I can read that data back out and we",
    "start": "2276349",
    "end": "2281779"
  },
  {
    "text": "have fancier tests that redeploy the cluster that check for zero downtime deployments that check all sorts of",
    "start": "2281779",
    "end": "2286849"
  },
  {
    "text": "properties but that's the basic testing strategy if you're not doing this then you're basically just doing it in",
    "start": "2286849",
    "end": "2291890"
  },
  {
    "text": "production and letting your users find out when you have bugs which sometimes you have to I mean in some except we all",
    "start": "2291890",
    "end": "2297140"
  },
  {
    "text": "test in production but you can get a tremendous amount of value by doing this sort of testing ahead of time so I",
    "start": "2297140",
    "end": "2303980"
  },
  {
    "text": "walked through terror tests and Tara total pers for working with all these different systems right helpers for",
    "start": "2303980",
    "end": "2310579"
  },
  {
    "text": "making HTTP requests helpers for SSH in helpers for deploying a helmet art to kubernetes etc so it's just trying to",
    "start": "2310579",
    "end": "2317059"
  },
  {
    "text": "give you a nice DSL for writing these tests okay so a couple test tips about",
    "start": "2317059",
    "end": "2323210"
  },
  {
    "text": "tests first of all they're gonna create a lot of stuff right you're constantly bringing up an entire vault cluster in",
    "start": "2323210",
    "end": "2329029"
  },
  {
    "text": "fact our automated test to deploy all of those examples in different flavors so every commit spins up something like 20",
    "start": "2329029",
    "end": "2334670"
  },
  {
    "text": "vault clusters in our AWS accounts so what you don't want to do is run those",
    "start": "2334670",
    "end": "2339740"
  },
  {
    "text": "tests in production because it's gonna kind of mess things up for you but you don't even want to run them in your",
    "start": "2339740",
    "end": "2344930"
  },
  {
    "text": "existing staging or your dev accounts either you actually want to create a completely isolated account you just for",
    "start": "2344930",
    "end": "2350750"
  },
  {
    "text": "automated testing and then what you want to do in that account is run a tool there's cloud nuke there's I forget the",
    "start": "2350750",
    "end": "2358730"
  },
  {
    "text": "name janitor monkey or something like that there's a bunch of tools that can basically blow away an entire count for you and you'll want to run",
    "start": "2358730",
    "end": "2364760"
  },
  {
    "text": "that basically as a cron job because occasionally tests will fail occasionally they'll leave resources behind due to a bug in the test etc so",
    "start": "2364760",
    "end": "2371570"
  },
  {
    "text": "make sure to clean up your accounts the other thing that I'll mention about",
    "start": "2371570",
    "end": "2377860"
  },
  {
    "text": "about testing is this classical test pyramid that you see for pretty much",
    "start": "2377860",
    "end": "2382970"
  },
  {
    "text": "every language where at the bottom you have your unit tests then on top of that you have integration tests and then on",
    "start": "2382970",
    "end": "2388010"
  },
  {
    "text": "top end-to-end tests and it's a pyramid because the idea is you want to have more unit tests smaller number of integration tests very small number of",
    "start": "2388010",
    "end": "2394730"
  },
  {
    "text": "end-to-end tests why because as you go up the pyramid the cost of writing those",
    "start": "2394730",
    "end": "2400250"
  },
  {
    "text": "tests the brittleness of those tests and how long those tests take to run goes up",
    "start": "2400250",
    "end": "2405530"
  },
  {
    "text": "significantly and so it is to your advantage to try to catch as many bugs as you can as close to the bottom of the",
    "start": "2405530",
    "end": "2412250"
  },
  {
    "text": "pyramid as you can now you're going to need all the test types this is not to say one test type is better than another you're going to need all of them",
    "start": "2412250",
    "end": "2417920"
  },
  {
    "text": "but proportion wise this is what you ideally have just because the costs go",
    "start": "2417920",
    "end": "2423320"
  },
  {
    "text": "up so with integration excuse me with infrastructure code it's the same",
    "start": "2423320",
    "end": "2428540"
  },
  {
    "text": "pyramid the only slight gotcha is that we don't have pure unit tests as we",
    "start": "2428540",
    "end": "2435020"
  },
  {
    "text": "discussed you can do some lending you can do some static analysis maybe you can count that as almost a unit test but",
    "start": "2435020",
    "end": "2440060"
  },
  {
    "text": "we don't really have pure unit testing so really your unit test equivalent in infrastructure world is to test",
    "start": "2440060",
    "end": "2446360"
  },
  {
    "text": "individual modules and this is why having small little pieces is so advantageous because you can run a test",
    "start": "2446360",
    "end": "2452780"
  },
  {
    "text": "for an individual module pretty quickly and easily whereas running a test for your entire infrastructure will take hours and hours and hours so small",
    "start": "2452780",
    "end": "2459530"
  },
  {
    "text": "individual modules that's a good thing that's the base of your pyramid then the integration test equivalent is one layer",
    "start": "2459530",
    "end": "2466910"
  },
  {
    "text": "up that's basically a bunch of modules combined together and then finally at the top that might be testing your",
    "start": "2466910",
    "end": "2472550"
  },
  {
    "text": "entire infrastructure and that's pretty rare because the times involved here just to set the expectations for you",
    "start": "2472550",
    "end": "2478430"
  },
  {
    "text": "correctly look like this your unit tests in the infrastructure world take between",
    "start": "2478430",
    "end": "2483560"
  },
  {
    "text": "one and twenty minutes typically they're not sub-second unfortunately integration tests can take",
    "start": "2483560",
    "end": "2488930"
  },
  {
    "text": "from five to sixty minutes and end-to-end tests I mean that depends completely on what your architecture looks like that could take hours and",
    "start": "2488930",
    "end": "2494870"
  },
  {
    "text": "hours and so for your own sanity you want to be as far down the pyramid as you can so this",
    "start": "2494870",
    "end": "2500630"
  },
  {
    "text": "is another reason why small little building blocks are great because you can test those in isolation so key",
    "start": "2500630",
    "end": "2506809"
  },
  {
    "text": "takeaway here infrastructure code that does not have tests is broken go out there write your tests use whatever",
    "start": "2506809",
    "end": "2513049"
  },
  {
    "text": "languages and libraries you prefer but the way to test that is to actually deploy it and see if it works okay final",
    "start": "2513049",
    "end": "2520579"
  },
  {
    "text": "piece for the talk today that I'll used to wrap up is just how you release all of this code how you basically put",
    "start": "2520579",
    "end": "2525589"
  },
  {
    "text": "everything together so here's what its gonna look like hopefully from now on the next time your boss says hey go",
    "start": "2525589",
    "end": "2531019"
  },
  {
    "text": "deploy X this is the process that you're gonna use you're gonna start by going",
    "start": "2531019",
    "end": "2536660"
  },
  {
    "text": "through our checklist because you want to make sure that when your boss asks you for an estimate you actually know",
    "start": "2536660",
    "end": "2542059"
  },
  {
    "text": "what it is that you need to build and you don't forget critical things like data backups and restores you're then",
    "start": "2542059",
    "end": "2548089"
  },
  {
    "text": "gonna go write some code and whatever tools make sense for your team and hopefully you've given your team the time to learn and adapt and internalize",
    "start": "2548089",
    "end": "2555230"
  },
  {
    "text": "those tools you're gonna write tests for that code that actually deploy the code to make",
    "start": "2555230",
    "end": "2561170"
  },
  {
    "text": "sure it works you're then going to have somebody review each of your code changes submit a pull request or merge",
    "start": "2561170",
    "end": "2567109"
  },
  {
    "text": "request and then you're going to release a new version of your code of your library and a version isn't anything",
    "start": "2567109",
    "end": "2573109"
  },
  {
    "text": "fancy this can literally be a gift tag but the point of a version is it's it's a pointer to some immutable bit of code",
    "start": "2573109",
    "end": "2580220"
  },
  {
    "text": "right here is my code to deploy micro service foo version 1.0 here's 1.1 1.2",
    "start": "2580220",
    "end": "2587329"
  },
  {
    "text": "and 1.3 it's some beautiful little artifact and what you can do with that infrastructure code is now you can take",
    "start": "2587329",
    "end": "2593599"
  },
  {
    "text": "your immutable artifact and first you can deploy to some early pre prod environments a dev or QA and test it",
    "start": "2593599",
    "end": "2599930"
  },
  {
    "text": "there and if it works well you can take the same immutable artifact and deploy it in your next environments you can",
    "start": "2599930",
    "end": "2605089"
  },
  {
    "text": "promote it's a staging and since it's the same code it should work the same way and then finally promote it to prod",
    "start": "2605089",
    "end": "2610490"
  },
  {
    "text": "so key takeaway we went from that at the start of the talk with our pizza slice",
    "start": "2610490",
    "end": "2617150"
  },
  {
    "text": "and iron cooking mechanism to this where now we have small reusable modules we've gone through our checklist we've written",
    "start": "2617150",
    "end": "2623599"
  },
  {
    "text": "tests for them with code review them and we're promoting them from to environment that's it thank you very",
    "start": "2623599",
    "end": "2629850"
  },
  {
    "text": "much",
    "start": "2629850",
    "end": "2632000"
  },
  {
    "text": "thanks a lot Jim that was awesome any questions",
    "start": "2638180",
    "end": "2643490"
  },
  {
    "text": "was it too overwhelming yeah back there",
    "start": "2643490",
    "end": "2648830"
  },
  {
    "text": "thanks for that it was great something I was curious about how are you guys",
    "start": "2658050",
    "end": "2663250"
  },
  {
    "text": "managing your deployments of terraform code for a CI CD pipeline are you",
    "start": "2663250",
    "end": "2668500"
  },
  {
    "text": "automatically running terraform or are you running tests on top of that or checks against the plans etc yeah that's",
    "start": "2668500",
    "end": "2676510"
  },
  {
    "text": "that's a great question so CI CD the whole end-to-end pipeline is a pretty",
    "start": "2676510",
    "end": "2681730"
  },
  {
    "text": "long discussion because a lot of it does tie into the specifics of each company that's why there are three million CI CD",
    "start": "2681730",
    "end": "2687880"
  },
  {
    "text": "tools out there because you're trying to implement your custom workflow but the general structure to imagine in your",
    "start": "2687880",
    "end": "2692920"
  },
  {
    "text": "head is at the very basic layer we start over here with the individual standalone",
    "start": "2692920",
    "end": "2698320"
  },
  {
    "text": "modules so like that vault module that I showed you so that lives in its own repo its own little universe it's not it's just there",
    "start": "2698320",
    "end": "2705190"
  },
  {
    "text": "and you have example code and tests for it every commit there gets tested only if it passes the test to do that and",
    "start": "2705190",
    "end": "2711670"
  },
  {
    "text": "release a new version of that code okay so you have a whole bunch of these repos you have one from vault you have one for your VP sees one to deploy kubernetes",
    "start": "2711670",
    "end": "2718450"
  },
  {
    "text": "etc each of those is tested by itself those are your individual building",
    "start": "2718450",
    "end": "2723609"
  },
  {
    "text": "blocks then over here you're going to now assemble those into your particular infrastructure so that might be a",
    "start": "2723609",
    "end": "2729790"
  },
  {
    "text": "separate repo whether its lives in a separate repo or not isn't actually critical but I'm just gonna explain it that way because it just mentally helps",
    "start": "2729790",
    "end": "2735790"
  },
  {
    "text": "to separate them so in a separate repo you're now going to assemble your infrastructure using those modules so",
    "start": "2735790",
    "end": "2741609"
  },
  {
    "text": "you're gonna take vault over here you're gonna deploy in this V PC and you're gonna run kubernetes and this thing and",
    "start": "2741609",
    "end": "2746650"
  },
  {
    "text": "you're gonna connect it with the service discovery mechanism etc and that's again more code that you write now this is if",
    "start": "2746650",
    "end": "2752380"
  },
  {
    "text": "those were your individual units that you were unit testing this way to combine them is essentially the integration testing and so what you want",
    "start": "2752380",
    "end": "2759490"
  },
  {
    "text": "to do is in this repo you're gonna run tests against it after every commit as well or maybe nightly depending how long",
    "start": "2759490",
    "end": "2765700"
  },
  {
    "text": "those take now we're getting into the larger chunks of infrastructure so that's a little slower if those tests",
    "start": "2765700",
    "end": "2771970"
  },
  {
    "text": "pass now you can release a new version of this modules of your infrastructure repo and now you can take those versions",
    "start": "2771970",
    "end": "2778480"
  },
  {
    "text": "and finally in our final repo you deploy them to your actual live environments so",
    "start": "2778480",
    "end": "2783580"
  },
  {
    "text": "you can take version 3.6 that pass tests in this repo which is using ten modules",
    "start": "2783580",
    "end": "2788830"
  },
  {
    "text": "from those repos that also passed us and you're going to deploy that to dev and if it works well you're then gonna deploy it to staging and if that works",
    "start": "2788830",
    "end": "2794960"
  },
  {
    "text": "well you're gonna deploy that same version to production and in those live environments typically you're not gonna",
    "start": "2794960",
    "end": "2800960"
  },
  {
    "text": "spend up with the entire architecture from scratch you could but that probably takes hours and is brittle so usually",
    "start": "2800960",
    "end": "2807080"
  },
  {
    "text": "what most companies do is they just have some kind of smoke test that runs against the already existing environments if you have a dev",
    "start": "2807080",
    "end": "2813170"
  },
  {
    "text": "environment you deployed version 3.6 of your micro service library in there and you're gonna run smoke tests against",
    "start": "2813170",
    "end": "2819350"
  },
  {
    "text": "that environment that's already standing up and do a bunch of sanity checks can I talk to my service can I deploy a new",
    "start": "2819350",
    "end": "2825470"
  },
  {
    "text": "version of it whatever you need to verify and then you do the same thing in staging and production and hopefully by the time you're in Prague the code has",
    "start": "2825470",
    "end": "2831680"
  },
  {
    "text": "been tested across so many layers that you're still gonna have bugs there's always gonna be bugs but it hopefully eliminates a lot of the sillier ones",
    "start": "2831680",
    "end": "2839170"
  },
  {
    "text": "thanks a lot I don't think we have time for any more questions we're out of time but I'm sure",
    "start": "2839170",
    "end": "2844220"
  },
  {
    "text": "Jim's around for a few more minutes here please come up if you have further questions else I'll see you there for",
    "start": "2844220",
    "end": "2850310"
  },
  {
    "text": "the next session so thanks Jim thank you [Applause]",
    "start": "2850310",
    "end": "2856760"
  }
]