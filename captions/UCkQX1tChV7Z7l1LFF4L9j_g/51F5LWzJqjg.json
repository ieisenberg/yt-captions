[
  {
    "text": "so hi everyone um welcome to the mastering c2dm or the Android Cloud",
    "start": "13960",
    "end": "19920"
  },
  {
    "text": "device messaging framework uh my name is Alexander garenta I work for a company called Maracana um here in San Francisco",
    "start": "19920",
    "end": "28080"
  },
  {
    "text": "well here I guess close enough as I said if you'd like to access the slides including the example code that I'll be",
    "start": "28080",
    "end": "34559"
  },
  {
    "text": "showing you later on it's available at that URL you can also scan the QR code if you'd like um so let me just see how",
    "start": "34559",
    "end": "43920"
  },
  {
    "text": "this works I've never actually used Google docs for presentation so how do you actually Advance the next slide is interesting oh there you go okay so um",
    "start": "43920",
    "end": "51960"
  },
  {
    "text": "just a few words about myself um I've been doing Java since 96 Android I guess",
    "start": "51960",
    "end": "57520"
  },
  {
    "text": "for the last two years I um so Mar a company work for is focuses on training",
    "start": "57520",
    "end": "64400"
  },
  {
    "text": "specifically oper software so do I teach among other things Android and Java I um",
    "start": "64400",
    "end": "70320"
  },
  {
    "text": "happen to run the Java User Group in San Francisco as well as the Android User Group um and I'm a co-founder",
    "start": "70320",
    "end": "77680"
  },
  {
    "text": "co-organizer of the HTML 5 user group so all here in San Francisco uh we do a lot",
    "start": "77680",
    "end": "82840"
  },
  {
    "text": "of events uh if any of you are interested in learning more about these things I highly recommend you check out some of the videos we have posted from",
    "start": "82840",
    "end": "89520"
  },
  {
    "text": "our event events from all these user groups on mar.com techtv uh in the past life I've worked",
    "start": "89520",
    "end": "95960"
  },
  {
    "text": "on things like SMS web push MMS things that involve push Technologies if you",
    "start": "95960",
    "end": "101759"
  },
  {
    "text": "will um so as far as the outline so what the goal is for today although to be honest this is my first time teaching or",
    "start": "101759",
    "end": "108439"
  },
  {
    "text": "or or demoing this particular or going over this particular talk so hopefully we'll get to everything uh there's a lot",
    "start": "108439",
    "end": "114799"
  },
  {
    "text": "to cover uh but the outline for today is to uh discuss push versus pool or pool versus push",
    "start": "114799",
    "end": "120759"
  },
  {
    "text": "um discuss c2dm what it is um even talk about some of the other you know non c2dm options you may have uh go over the",
    "start": "120759",
    "end": "128520"
  },
  {
    "text": "requirements limitations uh get a sense of what the big picture is um you know figure out how it works um talk about",
    "start": "128520",
    "end": "135920"
  },
  {
    "text": "the implementation so both from you know signing up for an account uh you know subscribing to for or registering your",
    "start": "135920",
    "end": "142480"
  },
  {
    "text": "app for c2dm um you know your your talk about the app server and things you need to do on the app server uh the you know",
    "start": "142480",
    "end": "149920"
  },
  {
    "text": "additional features of c2dm um such as collapsis uh The annotation um and then",
    "start": "149920",
    "end": "156319"
  },
  {
    "text": "summarize everything and uh give you hopefully guys some time to ask questions okay as far as the assumptions",
    "start": "156319",
    "end": "162959"
  },
  {
    "text": "I make of of you know of you the you know the audience is I hope you all know Java I hope you have some experience",
    "start": "162959",
    "end": "169800"
  },
  {
    "text": "building Android apps it certainly helps if you know what broadcast receivers are what anrs are how to avoid them why you",
    "start": "169800",
    "end": "176959"
  },
  {
    "text": "need to avoid them what services are if you've worked use the intent services that much better um if you know what",
    "start": "176959",
    "end": "183959"
  },
  {
    "text": "permissions at least get a sense for what the security model is on Android uh weight clocks Nah if you haven't used",
    "start": "183959",
    "end": "190599"
  },
  {
    "text": "them don't worry we'll explain them and um you know if you have some basic understanding of HTTP so you know when I",
    "start": "190599",
    "end": "196920"
  },
  {
    "text": "say you know post this HTTP with some parameters and and request togethers hopefully you know what that means if",
    "start": "196920",
    "end": "202720"
  },
  {
    "text": "you don't it's not that hard to figure out there are libraries that they'll do it for you um the back the back end of",
    "start": "202720",
    "end": "209319"
  },
  {
    "text": "uh of the demo application which I hope will be able to get working is actually built in PHP not my first choice but",
    "start": "209319",
    "end": "215360"
  },
  {
    "text": "just because of the you know in framework that we were using on the server side it just tended to be what I",
    "start": "215360",
    "end": "221239"
  },
  {
    "text": "used um so if you know a little bit of PHP helps if you don't don't worry it's all conceptual after anyways so um as",
    "start": "221239",
    "end": "228879"
  },
  {
    "text": "far as the kind of just some of the acknowledgements um a lot of the a lot of what I'm going to say has been said",
    "start": "228879",
    "end": "235400"
  },
  {
    "text": "before okay so hopefully you know we'll dig a Little Deeper but they're really good resources on c2dm specifically from",
    "start": "235400",
    "end": "242400"
  },
  {
    "text": "Google they did a talk on it last at the last Google IO so in the video of it is available online slides there are",
    "start": "242400",
    "end": "249599"
  },
  {
    "text": "available online and then there's a c2dm page a Cod google.com Android c2dm that",
    "start": "249599",
    "end": "256280"
  },
  {
    "text": "has really good resources okay um they give you kind of the steps you need to go through so that's you know that's",
    "start": "256280",
    "end": "262160"
  },
  {
    "text": "where I effectively learned everything from uh but you know the difference is if you've seen these things if you've",
    "start": "262160",
    "end": "268280"
  },
  {
    "text": "gone through these things that this talk hopefully we'll be able to dig a Little Deeper okay let's actually go and walk through the code so that said um why do",
    "start": "268280",
    "end": "277400"
  },
  {
    "text": "we care about this what you know what's the big why behind c2dm and again some of this information comes directly from",
    "start": "277400",
    "end": "283520"
  },
  {
    "text": "actually uh the the the video from last Google from from c2dm talk with Google",
    "start": "283520",
    "end": "289080"
  },
  {
    "text": "IO so basically the requirement is hopefully is to build apps that allow",
    "start": "289080",
    "end": "295240"
  },
  {
    "text": "you know the data on the apps to be kept fresh right so basically we want to um",
    "start": "295240",
    "end": "300880"
  },
  {
    "text": "you know keep apps synced with the cloud um yet we don't want to drain the user's",
    "start": "300880",
    "end": "306560"
  },
  {
    "text": "battery now normally how we tended to do things um especially because the Android",
    "start": "306560",
    "end": "312280"
  },
  {
    "text": "supports background Services is we would you know build some kind of a background services and potentially do you know",
    "start": "312280",
    "end": "318360"
  },
  {
    "text": "polling um that's okay when content changes very frequently um and when",
    "start": "318360",
    "end": "324080"
  },
  {
    "text": "we're okay to have somewhat stale data meaning you know if we if you don't pull frequently enough and data changes in",
    "start": "324080",
    "end": "330240"
  },
  {
    "text": "the server we don't yet sync it we are tolerant of that but um you know or",
    "start": "330240",
    "end": "336400"
  },
  {
    "text": "actually before we get to the butt um you know one of the things we should try to do if we do have to do this is to do",
    "start": "336400",
    "end": "342639"
  },
  {
    "text": "the check for freshness of the server side so the client meaning our Android application assuming we're you know",
    "start": "342639",
    "end": "348880"
  },
  {
    "text": "syncing with the cloud through HTTP which tends to be what most people use these days is we should submit for",
    "start": "348880",
    "end": "354199"
  },
  {
    "text": "example you know request with if modified since we put you know the last Tim stamp of what you know last last",
    "start": "354199",
    "end": "360160"
  },
  {
    "text": "time we fetch the data and the server decides on you know whether the data is new or not and gives us only the new",
    "start": "360160",
    "end": "365680"
  },
  {
    "text": "data um as opposed to us needlessly downloading data you know and then throwing away stuff that we've already",
    "start": "365680",
    "end": "371440"
  },
  {
    "text": "seen before so we want to minimize the the amount of work we have to do in a poll if we decide to do polling in the",
    "start": "371440",
    "end": "377440"
  },
  {
    "text": "first place um that said we want to pull is m is as infrequently as possible of",
    "start": "377440",
    "end": "383400"
  },
  {
    "text": "course that you know the frequency of polling affects the freshness of the data um the reason why is and again this",
    "start": "383400",
    "end": "389720"
  },
  {
    "text": "these numbers come right from from that presentation is you know when your device is Idle um the your baseband",
    "start": "389720",
    "end": "396000"
  },
  {
    "text": "modem is connected to the network um but you know it's drawing something like 5 to 8 milliamps um in a poll even in a",
    "start": "396000",
    "end": "404280"
  },
  {
    "text": "short poll which by the way even if you do a very very short pull the radio stays on for a few more seconds you'll",
    "start": "404280",
    "end": "409880"
  },
  {
    "text": "be looking at you know 115 for a reading and about 200 milliamps for transmitting",
    "start": "409880",
    "end": "415759"
  },
  {
    "text": "data okay depending on what you need to do um so basically works out to roughly",
    "start": "415759",
    "end": "421000"
  },
  {
    "text": "about you know 0.5 milliamp hours you know if you do it every 5 minutes you",
    "start": "421000",
    "end": "426240"
  },
  {
    "text": "can kind of see that's around 144 milliamp hours for example in a day and",
    "start": "426240",
    "end": "431599"
  },
  {
    "text": "you could imagine that that's you know roughly 10% of your battery for just one application if you obviously increase",
    "start": "431599",
    "end": "437639"
  },
  {
    "text": "the or decrease the frequency so you do it like every 15 minutes that obviously changes but still you know the more",
    "start": "437639",
    "end": "443599"
  },
  {
    "text": "applications user run on their phones and a lot of applications want to keep things fresh the you know the harder it",
    "start": "443599",
    "end": "449599"
  },
  {
    "text": "is to or the more strain we put on the battery okay so since poll polling sucks",
    "start": "449599",
    "end": "455919"
  },
  {
    "text": "in general uh what can we do instead so push is obviously you know the the The Logical answer and you know the idea",
    "start": "455919",
    "end": "463039"
  },
  {
    "text": "with push is we get the the freshness of our data but um you know we don't put a",
    "start": "463039",
    "end": "468720"
  },
  {
    "text": "strain on the battery or at least you know this the the the battery and network utilization corresponds to you",
    "start": "468720",
    "end": "474800"
  },
  {
    "text": "know how how basically frequently our data changes rather than how frequent we",
    "start": "474800",
    "end": "480000"
  },
  {
    "text": "for data changes although that even can you know be affected with c2dm as we will explain later so one you know one",
    "start": "480000",
    "end": "487080"
  },
  {
    "text": "options for one of the options for for doing a simple uh push is to do it via you know SMS you could basically you",
    "start": "487080",
    "end": "494520"
  },
  {
    "text": "know get an account with something like click AEL or one of those SMS providers you send an SMS you know from your",
    "start": "494520",
    "end": "500240"
  },
  {
    "text": "server to the app the app intercepts the SMS interprets it as as a notification of some some interesting event and then",
    "start": "500240",
    "end": "507360"
  },
  {
    "text": "goes to your server to fetch data okay we could do WAP push although to be honest I've never actually used WAP push",
    "start": "507360",
    "end": "513479"
  },
  {
    "text": "on on an Android device I've used it before hated it but um we'll explain you know how it differs but it's basically",
    "start": "513479",
    "end": "520200"
  },
  {
    "text": "just sms okay it's still based on SMS um another option we we have is to get a",
    "start": "520200",
    "end": "526959"
  },
  {
    "text": "you know build a persistent connection with their server when I say persistent that sounds like it's expensive but in",
    "start": "526959",
    "end": "533040"
  },
  {
    "text": "reality it's it's imp packet switched if you're not using the connection the radio can actually you know go into the",
    "start": "533040",
    "end": "539120"
  },
  {
    "text": "someone idle mode so it's not really drawing the power um and Android allows this fairly easily by you know",
    "start": "539120",
    "end": "544800"
  },
  {
    "text": "effectively allowing us to build a background service that creates a connection to our server and then needs to react to all these Network changes",
    "start": "544800",
    "end": "552160"
  },
  {
    "text": "and because of the fact that networks tend to be flaky and especially as you switch from different modes right um",
    "start": "552160",
    "end": "558760"
  },
  {
    "text": "this background service would need to you know effectively have the logic to recover from drop connections uh to to",
    "start": "558760",
    "end": "566360"
  },
  {
    "text": "to detect these half open connections because you know in between us and our server there are all these potential you",
    "start": "566360",
    "end": "572920"
  },
  {
    "text": "know whether they're far walls net net switches um or whatever Network gear",
    "start": "572920",
    "end": "578240"
  },
  {
    "text": "that just doesn't like effectively persistent uh persistent connections it tends to close them right so generally",
    "start": "578240",
    "end": "584160"
  },
  {
    "text": "what that would involve is us having some kind of you know periodic checks to ensure that the connections are okay so",
    "start": "584160",
    "end": "590079"
  },
  {
    "text": "that usually it's done with pings right so pings in x uh which kind of looks like pulling but you know there's not",
    "start": "590079",
    "end": "596720"
  },
  {
    "text": "much you can do about it ex you know but it still gives you that persistent connection and then when the server",
    "start": "596720",
    "end": "602720"
  },
  {
    "text": "wants to inform you of some event they just use that connection to your device they drop a message you get it and you",
    "start": "602720",
    "end": "607839"
  },
  {
    "text": "react to it so this is doable but it's not trivial okay and what sucks about it",
    "start": "607839",
    "end": "613320"
  },
  {
    "text": "is as you will see in a moment is if every application were to do this there would be a lot of overhead right versus",
    "start": "613320",
    "end": "619480"
  },
  {
    "text": "using a single framework that everyone can you know uh take advantage of um and",
    "start": "619480",
    "end": "625160"
  },
  {
    "text": "then the last option which is hopefully why you guys are here is the c2dm which is basically Al you know it is",
    "start": "625160",
    "end": "630959"
  },
  {
    "text": "persistent connection uh but since you know effectively Google manages everything for us it's already being",
    "start": "630959",
    "end": "636560"
  },
  {
    "text": "used by Google for the Google apps that we most of us have on the on the on the devices um and it's super easy and it's",
    "start": "636560",
    "end": "643519"
  },
  {
    "text": "free okay so it feels like a no-brainer now we'll see kind of the the differences between these approaches so",
    "start": "643519",
    "end": "649880"
  },
  {
    "text": "just just for the sake of you know I guess completeness if you were to go and do an SMS based notification you could",
    "start": "649880",
    "end": "656600"
  },
  {
    "text": "build some kind of application that has a a receiver which reacts to the SMS",
    "start": "656600",
    "end": "662680"
  },
  {
    "text": "received message for that you need the receive SMS permission and one of the other things I did here is I make my SMS",
    "start": "662680",
    "end": "669920"
  },
  {
    "text": "receiver I changed the priority of it okay the reason why I changed the priority of it is because the SMS received notifications broadcast",
    "start": "669920",
    "end": "676279"
  },
  {
    "text": "notifications are actually sent as a ordered uh broadcast which means that",
    "start": "676279",
    "end": "681720"
  },
  {
    "text": "they're always sent a predetermined sequence of the priority of the different receivers interested in this",
    "start": "681720",
    "end": "687240"
  },
  {
    "text": "okay so if I were to build the Java you know the Java side of it is I would I could build it in in this way so it",
    "start": "687240",
    "end": "693720"
  },
  {
    "text": "would basically be some kind of a receiver that would on receive off my SMS received notification go through or",
    "start": "693720",
    "end": "701600"
  },
  {
    "text": "grab this you know pods or you know pdus effectively extra interpret it as a bite",
    "start": "701600",
    "end": "707800"
  },
  {
    "text": "array parse it into an SMS message decide whether this SMS message is you",
    "start": "707800",
    "end": "713480"
  },
  {
    "text": "know the whether it means it's a notification how we can decide it we can say for example is it from a particular",
    "start": "713480",
    "end": "719000"
  },
  {
    "text": "number number or does the body of the SMS equal some predetermined strength or whatever right and then if it is we",
    "start": "719000",
    "end": "726440"
  },
  {
    "text": "could basically process the notification whatever that means for us and then we can simply call a board broadcast which",
    "start": "726440",
    "end": "733240"
  },
  {
    "text": "means that nobody else would get that SMS message and if we were the first ones to run you know then we're the only",
    "start": "733240",
    "end": "738600"
  },
  {
    "text": "ones to consume that SMS message and you know it's not like it's going to show up in your you know SMS you know message",
    "start": "738600",
    "end": "745600"
  },
  {
    "text": "queue or whatever okay but this still costs money so it's not ideal okay a web",
    "start": "745600",
    "end": "751360"
  },
  {
    "text": "porch is a more structured way to do notifications but it involves a huge amount of well first of all requires you",
    "start": "751360",
    "end": "758760"
  },
  {
    "text": "understand W push you know there's like they have a special um you know format of the message you need to use but",
    "start": "758760",
    "end": "764120"
  },
  {
    "text": "effectively what w push it's a binary SMS with a URL embedded in it which you",
    "start": "764120",
    "end": "770600"
  },
  {
    "text": "know tells your application or you know that you should go and fetch the data from some location okay effectively",
    "start": "770600",
    "end": "776920"
  },
  {
    "text": "that's that's what we want to have right ideally the notification is just to tickle application to get it to do",
    "start": "776920",
    "end": "783079"
  },
  {
    "text": "something okay this I get diagram I just copy paste and sto it from Wikipedia but",
    "start": "783079",
    "end": "788480"
  },
  {
    "text": "um needless to say the whole point is that this is complicated now that's not to say once we see the c2dm diagram",
    "start": "788480",
    "end": "794480"
  },
  {
    "text": "things are going to be super simple but at least once you understand that most of it is taken care of for us you'll",
    "start": "794480",
    "end": "799920"
  },
  {
    "text": "really only focus on only one part of that diagram that we'll see later but there's too much too much over too much",
    "start": "799920",
    "end": "805480"
  },
  {
    "text": "work here and it still cost us money um so if if we were to roll our own connection um or our own persistent",
    "start": "805480",
    "end": "812720"
  },
  {
    "text": "connection as I mentioned we could build a background service we could use an alarm manager on Android to periodically",
    "start": "812720",
    "end": "819440"
  },
  {
    "text": "wake us up well we you know we could then check on this the health of the connection we could grab a away clock in",
    "start": "819440",
    "end": "825959"
  },
  {
    "text": "order to reconnect because that may be a longer you know longer operation we would need to handle um you know things",
    "start": "825959",
    "end": "833079"
  },
  {
    "text": "like Network changes or the user deciding not to support background data or user roaming all these different",
    "start": "833079",
    "end": "838680"
  },
  {
    "text": "things that can happen on the device and we still have to decide how often do we check for the scal of this connection",
    "start": "838680",
    "end": "845680"
  },
  {
    "text": "which is you know again that involves polling and polling as we know drains battery so we want to do it as",
    "start": "845680",
    "end": "851480"
  },
  {
    "text": "frequently as possible but if we if we do it super infrequently to you know to maximize the battery we basically risk",
    "start": "851480",
    "end": "858519"
  },
  {
    "text": "not detecting when the connection is dead and missing some push notifications right um and because presumably all of",
    "start": "858519",
    "end": "865800"
  },
  {
    "text": "our users which we hope we have millions of would have these persistent connections to our servers and as you as",
    "start": "865800",
    "end": "872519"
  },
  {
    "text": "you know there's a limit as to how many connections you know machines tend to like to you know tend to accept that",
    "start": "872519",
    "end": "878079"
  },
  {
    "text": "means that we now need to figure out how to scale our you know back in infrastructure to support all these",
    "start": "878079",
    "end": "884279"
  },
  {
    "text": "connections okay so it just means again more work for us um and what if there",
    "start": "884279",
    "end": "889839"
  },
  {
    "text": "are multiple applications on these devices right are what if every single",
    "start": "889839",
    "end": "894920"
  },
  {
    "text": "one of them were to roll their own are they all going to go and do a background service are they all going to wake up",
    "start": "894920",
    "end": "900079"
  },
  {
    "text": "the radio to test for the health of the connection how is that going to affector battery we can be very well back to",
    "start": "900079",
    "end": "905519"
  },
  {
    "text": "square one you know which is kind of what we would happen with multiple applications of doing their own polling",
    "start": "905519",
    "end": "910600"
  },
  {
    "text": "right so this while possible it's not you know it's not recommended just",
    "start": "910600",
    "end": "916040"
  },
  {
    "text": "because it involves more a lot of work and a lot of overhead and it puts a strain on your server side so see to the",
    "start": "916040",
    "end": "922920"
  },
  {
    "text": "end hopefully this is why you guys are here so basically the idea is Google already has a consistant connection it's",
    "start": "922920",
    "end": "930120"
  },
  {
    "text": "a TCP it's SSL encrypted TCP IP connection between your phone and the",
    "start": "930120",
    "end": "935800"
  },
  {
    "text": "Google servers at all times and it's already there okay why is it already",
    "start": "935800",
    "end": "941440"
  },
  {
    "text": "there all of the Google apps already use it so Market Gmail calendar contacts",
    "start": "941440",
    "end": "946959"
  },
  {
    "text": "voice all of this you know all of for example you get an SMS or you get a you know",
    "start": "946959",
    "end": "952279"
  },
  {
    "text": "uh a message or let's say a g you know new Gmail you know email comes in you",
    "start": "952279",
    "end": "957759"
  },
  {
    "text": "get notified through through that push um you want to for example go to market.android.com you select an app you",
    "start": "957759",
    "end": "963600"
  },
  {
    "text": "want to install you say push to my phone how does the push work through that persistent connection voice you get you",
    "start": "963600",
    "end": "969519"
  },
  {
    "text": "know a voice message that's pushed through the connection effectively everything goes over that one single connection and it's already there okay",
    "start": "969519",
    "end": "977120"
  },
  {
    "text": "so effectively you know what c2dm is is what we just discussed before of having",
    "start": "977120",
    "end": "982800"
  },
  {
    "text": "that persistent connection but we are not doing any any of the work Google is doing it for us or actually letting us",
    "start": "982800",
    "end": "988240"
  },
  {
    "text": "use what already built okay so there is some polling involved I'm just I'll get to you um but that polling basically you",
    "start": "988240",
    "end": "996319"
  },
  {
    "text": "know is being done by Google anyways we're already paying the penalty of it if you will and as you will see later",
    "start": "996319",
    "end": "1002440"
  },
  {
    "text": "it's not actually that big of a penalty so why not take advantage of it so please go ahead that means so that's a",
    "start": "1002440",
    "end": "1009519"
  },
  {
    "text": "good point and we'll come back to that's that's going to come in the next next couple slides on you know the limit requirements and limitations but you're",
    "start": "1009519",
    "end": "1015720"
  },
  {
    "text": "right okay which is not that big of a deal in most cases but nevertheless is it is a potential limitation okay so how",
    "start": "1015720",
    "end": "1023600"
  },
  {
    "text": "you know so exactly you know what is then c2dm um effectively the way I see it it's a lightweight messaging",
    "start": "1023600",
    "end": "1031319"
  },
  {
    "text": "framework plus a service that provides that push functionality of so so",
    "start": "1031319",
    "end": "1038520"
  },
  {
    "text": "basically we can we what it gives us is ability to push our messages from our servers via Google servers to our apps",
    "start": "1038520",
    "end": "1046240"
  },
  {
    "text": "running on our users devices okay that's what it is um it's way more efficient",
    "start": "1046240",
    "end": "1051520"
  },
  {
    "text": "because we basically piggyback and what's already there and you know Google takes care of all of the hard work the",
    "start": "1051520",
    "end": "1058200"
  },
  {
    "text": "message queuing for example if our device is not online and being able to deliver the message later on um you know",
    "start": "1058200",
    "end": "1064440"
  },
  {
    "text": "doing the best effort delivery so you know they'll they they'll keep the message for you know fairly long time",
    "start": "1064440",
    "end": "1070320"
  },
  {
    "text": "retry and so on and so on and they already do the hard work of verifying that the connection between us and",
    "start": "1070320",
    "end": "1076520"
  },
  {
    "text": "Google or our devices in Google is already there um but one thing you need to realize is that the idea the intent of the c2dm is",
    "start": "1076520",
    "end": "1084880"
  },
  {
    "text": "not to deliver content to your devices but rather to wake up your device inform",
    "start": "1084880",
    "end": "1090919"
  },
  {
    "text": "it of some event and have your device fetch content because of the fact that you know your your your messages may be",
    "start": "1090919",
    "end": "1097559"
  },
  {
    "text": "delivered out of order and that its best effort but not guaranteed delivery you",
    "start": "1097559",
    "end": "1103000"
  },
  {
    "text": "generally don't want to have any state in the message you generally don't want to have too much data in the message you're all the real Limited actually in",
    "start": "1103000",
    "end": "1109640"
  },
  {
    "text": "how much data you can have and we'll talk about that in a moment you generally want to use these push",
    "start": "1109640",
    "end": "1115600"
  },
  {
    "text": "messages as you will see just to tickle your application have your application wake up and then do something in",
    "start": "1115600",
    "end": "1121799"
  },
  {
    "text": "response to that okay so what are the requirements and the limitations so",
    "start": "1121799",
    "end": "1127000"
  },
  {
    "text": "first and foremost you need Froyo or you know Android API 8 2.2 or better uh",
    "start": "1127000",
    "end": "1133200"
  },
  {
    "text": "which you know sucks for some of you that are still on to you know a clair um you do need a market app on the device",
    "start": "1133200",
    "end": "1142000"
  },
  {
    "text": "okay now the your apps don't have to be installed through Market they can be side loaded okay they don't have to",
    "start": "1142000",
    "end": "1148120"
  },
  {
    "text": "actually come for Market but there needs to be market and it has to be provisioned with at least one Google",
    "start": "1148120",
    "end": "1154120"
  },
  {
    "text": "account okay now you before you say well that sucks which you know is a fair",
    "start": "1154120",
    "end": "1159440"
  },
  {
    "text": "point it's okay because majority and I don't know the statistic but majority of our users do use market and do have",
    "start": "1159440",
    "end": "1166799"
  },
  {
    "text": "accounts provision with Google okay they may not use it as the primary account but they use it as a way of installing",
    "start": "1166799",
    "end": "1172760"
  },
  {
    "text": "apps yes there's some that don't and yes you may not be able to Target your entire user population but then again",
    "start": "1172760",
    "end": "1179400"
  },
  {
    "text": "are those users the ones you want to Target in the first place um but that's just a side note on the emulator in",
    "start": "1179400",
    "end": "1185400"
  },
  {
    "text": "order to test this you you know to actually test c2dm you need to build a",
    "start": "1185400",
    "end": "1190720"
  },
  {
    "text": "uh an emulator based on the Google api's 8 image so you do not the the vanilla",
    "start": "1190720",
    "end": "1196559"
  },
  {
    "text": "Android image will not do okay and you need to provision at least one Google account okay again you don't have you're",
    "start": "1196559",
    "end": "1204520"
  },
  {
    "text": "actually not going to have Market on the emulator but you'll have the services that are basically provided that",
    "start": "1204520",
    "end": "1211000"
  },
  {
    "text": "includes c2dm as well as that account which is actually going to be able to how how Google manages that connection",
    "start": "1211000",
    "end": "1216960"
  },
  {
    "text": "okay now as far as the limitations so again best effort delivery so our you",
    "start": "1216960",
    "end": "1223000"
  },
  {
    "text": "know our messages can get lost our messages can be delivered out of order so for example if you were building a chat application as Google says in their",
    "start": "1223000",
    "end": "1229640"
  },
  {
    "text": "website you want to deliver the actual chat message via the push because they may Del be delivered out of order or",
    "start": "1229640",
    "end": "1236240"
  },
  {
    "text": "they may not be delivered at all so you do is you tickle the application have the application go to your server and",
    "start": "1236240",
    "end": "1241440"
  },
  {
    "text": "fetch the latest chat history as an example okay just because of how this you know what what promises they",
    "start": "1241440",
    "end": "1248000"
  },
  {
    "text": "effectively offer as part of c2dm the payload of our data that we embed in the message that we push through c2dm that",
    "start": "1248000",
    "end": "1255320"
  },
  {
    "text": "makes it on our device is 1024 bytes so not that we ever expect you to be putting or not we Google expect you to",
    "start": "1255320",
    "end": "1262120"
  },
  {
    "text": "be putting that much data into the messages in the first place there's no support currently for ttls you can't say",
    "start": "1262120",
    "end": "1269960"
  },
  {
    "text": "oh I want my message to Auto expire in two minutes if the device isn't online",
    "start": "1269960",
    "end": "1275440"
  },
  {
    "text": "uh Google tends to keep the message or try the me the message delivery for weeks to up to a month they they don't",
    "start": "1275440",
    "end": "1282320"
  },
  {
    "text": "they haven't necessarily stated what the number is but it's in order of weeks before they probably just discard it",
    "start": "1282320",
    "end": "1288039"
  },
  {
    "text": "okay but chances are you know at that point you know maybe it's no longer relevant anyways um the biggest I would",
    "start": "1288039",
    "end": "1294760"
  },
  {
    "text": "say limitation that I see is the fact that this is still in Labs so it's still",
    "start": "1294760",
    "end": "1299799"
  },
  {
    "text": "a Google Labs project they said that they were going to release it to for you know General use at the end of last year",
    "start": "1299799",
    "end": "1307000"
  },
  {
    "text": "hasn't yet happened I reached out to Google asked them when it's going to happen still haven't heard back so it's",
    "start": "1307000",
    "end": "1313480"
  },
  {
    "text": "it's kind of effectively the reason why this sucks is for two reasons one is you first need to apply for a for a c2dm",
    "start": "1313480",
    "end": "1320520"
  },
  {
    "text": "account so you need to be approved they tend to approve most people I don't know exactly what the approval process looks",
    "start": "1320520",
    "end": "1326080"
  },
  {
    "text": "like they haven't you know been very upfront about it but it's not that hard to get approved okay then what you need",
    "start": "1326080",
    "end": "1331640"
  },
  {
    "text": "to do or the other issue is that the quar quarter limits are not quite clear",
    "start": "1331640",
    "end": "1336960"
  },
  {
    "text": "yet right so what they do is they impose quarter limits on how many you know",
    "start": "1336960",
    "end": "1342039"
  },
  {
    "text": "messages you can send in Aggregate and also how many messages you can send to one particular app on a particular",
    "start": "1342039",
    "end": "1347159"
  },
  {
    "text": "device that are a given given time okay go ahead do we need to be approved even",
    "start": "1347159",
    "end": "1352200"
  },
  {
    "text": "for a test account yes you need to be you need to effectively the way it works is you get you sign up and you will talk",
    "start": "1352200",
    "end": "1357880"
  },
  {
    "text": "about that process you get a developer account and then when you're ready to actually go prime time you you contact",
    "start": "1357880",
    "end": "1364760"
  },
  {
    "text": "them and you tell them hey this is what I build this is what I expect can you you know effectively ask them politely",
    "start": "1364760",
    "end": "1371720"
  },
  {
    "text": "to give you you know the the the quarter limits you expect you're going to need okay so it's somewhat informal somewhat",
    "start": "1371720",
    "end": "1379120"
  },
  {
    "text": "you know undocumented if you will so there's you know somewhat of a risk as to whether or not you'll be approved you",
    "start": "1379120",
    "end": "1385520"
  },
  {
    "text": "may need to talk to them ahead of time before you go and invest heavily in this go ahead that's a good very that's a",
    "start": "1385520",
    "end": "1390720"
  },
  {
    "text": "good point so well but it has to do with also how you build step four which we'll",
    "start": "1390720",
    "end": "1395919"
  },
  {
    "text": "get to because if you cash your off token long enough so you don't have to fre that frequently go and grab it then",
    "start": "1395919",
    "end": "1403440"
  },
  {
    "text": "you may not be prompted for capture CH has to do with whether they expect there too many log whether see too many logins",
    "start": "1403440",
    "end": "1409760"
  },
  {
    "text": "so let's take a look at the big picture Okay so yes it's quite quite you know",
    "start": "1409760",
    "end": "1415320"
  },
  {
    "text": "quite a few steps involved there's 10 of them and in fact there some of them have you know kind of inner steps if you will",
    "start": "1415320",
    "end": "1422600"
  },
  {
    "text": "uh but most of these steps you only have to go through once okay and the rest you know most of the other steps you know",
    "start": "1422600",
    "end": "1428679"
  },
  {
    "text": "tend to happen at least you know almost half of them tend to happen by Google so they're out of our hands anyways so the",
    "start": "1428679",
    "end": "1434919"
  },
  {
    "text": "way works and we'll go through these things and and actually look at the code in detail the way it works is you first",
    "start": "1434919",
    "end": "1440880"
  },
  {
    "text": "the step number zero is basically us getting a um registering for account",
    "start": "1440880",
    "end": "1446640"
  },
  {
    "text": "signing up for a c2dm account so we get Whit listed okay so assuming we have that and we when we do that you will see",
    "start": "1446640",
    "end": "1454559"
  },
  {
    "text": "you provide some kind of an email address okay they call it the sender email address okay what you then do is",
    "start": "1454559",
    "end": "1460159"
  },
  {
    "text": "you build an application which uses c2dm the that application when it gets installed on the device and the user for",
    "start": "1460159",
    "end": "1466200"
  },
  {
    "text": "example selects you know a check box that says I want to keep my application up to date or in sync or whatever you",
    "start": "1466200",
    "end": "1472200"
  },
  {
    "text": "however you build it the application will go and register for C to DM they",
    "start": "1472200",
    "end": "1477600"
  },
  {
    "text": "does so by invoking an internal local service and to it it passes this sender",
    "start": "1477600",
    "end": "1484039"
  },
  {
    "text": "account this special account that Google approved on for you okay what you then do is you send it out uh to Google that",
    "start": "1484039",
    "end": "1492360"
  },
  {
    "text": "somehow communicates with the Google c2dm servers what you get back is some",
    "start": "1492360",
    "end": "1497880"
  },
  {
    "text": "kind of a registration ID that registration ID is unique for that",
    "start": "1497880",
    "end": "1503080"
  },
  {
    "text": "particular app on that particular device right so you may have millions of",
    "start": "1503080",
    "end": "1508159"
  },
  {
    "text": "installations of your app and every installation is going to have a separate registration ID okay what you then do is",
    "start": "1508159",
    "end": "1515880"
  },
  {
    "text": "you send the registration ID so step number two is you send the registration ID to your server from where you'll be",
    "start": "1515880",
    "end": "1521799"
  },
  {
    "text": "doing the push okay so I'm assuming you guys understand that you know push involves having some kind of a server",
    "start": "1521799",
    "end": "1527720"
  },
  {
    "text": "component otherwise what heck we're pushing here right so we push it to our server and our server goes grabs the",
    "start": "1527720",
    "end": "1535600"
  },
  {
    "text": "registration ID and Records it on the server side now we can record a registration ID for the user right if we",
    "start": "1535600",
    "end": "1543440"
  },
  {
    "text": "have a concept of a user on the device or we can record that registration ID for that particular device okay if we",
    "start": "1543440",
    "end": "1550080"
  },
  {
    "text": "know of that particular device so that we can Target that particular device or that particular user in the future what",
    "start": "1550080",
    "end": "1557399"
  },
  {
    "text": "we then do when it comes time to actually send a message to our to our",
    "start": "1557399",
    "end": "1562760"
  },
  {
    "text": "app is we go and talk to something called Google client login service it's",
    "start": "1562760",
    "end": "1569039"
  },
  {
    "text": "something it's basically a Google authentication mechanism that is not tied to c2dm it's used by other services",
    "start": "1569039",
    "end": "1576440"
  },
  {
    "text": "that basically you know the Google has and the way it works is you send a as you will see an HTTP post message uh to",
    "start": "1576440",
    "end": "1583880"
  },
  {
    "text": "this C this client login service and in it you include the type of the service you're trying to authenticate for which",
    "start": "1583880",
    "end": "1590240"
  },
  {
    "text": "is the c2dm the the username which is or email which is basically the email that was used when registering for the",
    "start": "1590240",
    "end": "1596679"
  },
  {
    "text": "account here and your password and what you get back if the authentication is valid you get back some kind of an off",
    "start": "1596679",
    "end": "1603440"
  },
  {
    "text": "token now you're supposed to remember that all token on the server side you're",
    "start": "1603440",
    "end": "1608600"
  },
  {
    "text": "not supposed to constantly go and reauthenticate because if you do then Google this client login Service as you",
    "start": "1608600",
    "end": "1614320"
  },
  {
    "text": "pointed out Frank it can basically go and ask you to uh can prompt you one of those whatever",
    "start": "1614320",
    "end": "1621159"
  },
  {
    "text": "capture challenges right and so then you know how how the heck do you do it because this is all supposed to be automated you can't really do capture on",
    "start": "1621159",
    "end": "1627600"
  },
  {
    "text": "a server which there's no human to actually prove that you know it's you um",
    "start": "1627600",
    "end": "1632840"
  },
  {
    "text": "because this roll account that we use it's not really meant to be tied to a human anyways it's basically one of",
    "start": "1632840",
    "end": "1637960"
  },
  {
    "text": "these just you know a rooll account it's basically an app account go Ahad how do you get the challenge how do you get around it you can't really because you",
    "start": "1637960",
    "end": "1645080"
  },
  {
    "text": "know unless you you know you have connection with the spammers know how to get around it what we did is we had to",
    "start": "1645080",
    "end": "1650320"
  },
  {
    "text": "send an email to like a public mailbox with like 30 people on it and then someone has to jump in and log in",
    "start": "1650320",
    "end": "1655720"
  },
  {
    "text": "quickly and right but for have to have app administrator",
    "start": "1655720",
    "end": "1662000"
  },
  {
    "text": "right or you hire an army like you you hire an army of offshore uh you know",
    "start": "1662000",
    "end": "1667159"
  },
  {
    "text": "capture solvers Capt exactly um no generally the reason why you have get it",
    "start": "1667159",
    "end": "1673559"
  },
  {
    "text": "is because the client login Service uh you know effectively checks on the on the frequency of your logins so you're",
    "start": "1673559",
    "end": "1680039"
  },
  {
    "text": "supposed to cash the token and not and use it as long as you can as long as the",
    "start": "1680039",
    "end": "1685480"
  },
  {
    "text": "c2dm as long as the next step doesn't fail if only the next step fails with a 401 as you will see then you go back and",
    "start": "1685480",
    "end": "1692240"
  },
  {
    "text": "reauthenticate that way you will most likely not get prompted okay now now",
    "start": "1692240",
    "end": "1697679"
  },
  {
    "text": "that we have that token from Google we now go to to factly push our message as",
    "start": "1697679",
    "end": "1702919"
  },
  {
    "text": "you will see our message is going to be a simple HTTP post that post is going to include include the registration ID",
    "start": "1702919",
    "end": "1709679"
  },
  {
    "text": "which allows us to Target a particular device our app on a particular device as",
    "start": "1709679",
    "end": "1714840"
  },
  {
    "text": "well as the data that we want to put in as well as this this off token which we got from the client service now this off",
    "start": "1714840",
    "end": "1721840"
  },
  {
    "text": "token is tied to a particular account that was used to register or create a",
    "start": "1721840",
    "end": "1727519"
  },
  {
    "text": "registration in the first place so if the two don't match that's going to fail",
    "start": "1727519",
    "end": "1732559"
  },
  {
    "text": "okay so the c2dm front end once it gets our post okay it goes and verifies you",
    "start": "1732559",
    "end": "1740720"
  },
  {
    "text": "know that we are you know authentic so verifies your your token it then goes",
    "start": "1740720",
    "end": "1745880"
  },
  {
    "text": "and effectively does two things it cues our message into some kind of a message cue so that if if you know the next",
    "start": "1745880",
    "end": "1753200"
  },
  {
    "text": "steps were to fail the message would be would be persistent right so it tries to you know for Recovery purposes and it",
    "start": "1753200",
    "end": "1759440"
  },
  {
    "text": "then tries to find the actual c2dm messaging excuse me messaging server",
    "start": "1759440",
    "end": "1765159"
  },
  {
    "text": "which is tied to our particular application okay or our particular device I should say because the",
    "start": "1765159",
    "end": "1770399"
  },
  {
    "text": "messaging the connection is not for just our application it's for all applications on the device and so it",
    "start": "1770399",
    "end": "1775480"
  },
  {
    "text": "routes the message to that server now that server goes through a logic of deciding whether the message should be sent right away or whether it should be",
    "start": "1775480",
    "end": "1781960"
  },
  {
    "text": "delayed they we'll see you know see how that works later but at some point hopefully right away it goes and grabs",
    "start": "1781960",
    "end": "1787960"
  },
  {
    "text": "that message and pushes it over that persistent connection to our application our application now gets tick you know",
    "start": "1787960",
    "end": "1794840"
  },
  {
    "text": "gets tickled through effectively a broadcast message we then wake up if we do something",
    "start": "1794840",
    "end": "1801120"
  },
  {
    "text": "that's not trivial we generally go and grab a wake clock we start some kind of a you know intense service we'll talk",
    "start": "1801120",
    "end": "1806360"
  },
  {
    "text": "about that and we'll show some code and then we go and do the work right so we do for example generally generally one",
    "start": "1806360",
    "end": "1812840"
  },
  {
    "text": "of the things that's you know missing here is we generally go and go back to our server to fetch the data that we're",
    "start": "1812840",
    "end": "1818760"
  },
  {
    "text": "so interested in okay assuming that this is just to inform us that something changed um upon successful receipt of",
    "start": "1818760",
    "end": "1826399"
  },
  {
    "text": "the message by the device there's an act that goes back over the same connection to the Google server the Google",
    "start": "1826399",
    "end": "1832200"
  },
  {
    "text": "messaging server then you know now it knows the message was delivered it removes it from the queue in case this",
    "start": "1832200",
    "end": "1838039"
  },
  {
    "text": "connection is severed like for whatever reason you know if this doesn't work then basically the message stays in the",
    "start": "1838039",
    "end": "1844880"
  },
  {
    "text": "queue and you know it retries again later so we'll we'll see how that works",
    "start": "1844880",
    "end": "1850120"
  },
  {
    "text": "now we're going to go through these steps one by one are there any specific questions with",
    "start": "1850120",
    "end": "1856559"
  },
  {
    "text": "this so how do you know whether this is working right so so the qu I mean I guess another way to look at it is there",
    "start": "1856559",
    "end": "1862799"
  },
  {
    "text": "an endtoend you know Act and the way it works is really the way you build your",
    "start": "1862799",
    "end": "1868880"
  },
  {
    "text": "it's you build it into the logic of your application so the idea is your your",
    "start": "1868880",
    "end": "1873960"
  },
  {
    "text": "server pushes the message and that message somehow hopefully makes its way",
    "start": "1873960",
    "end": "1879000"
  },
  {
    "text": "to your app if if your app gets it which involves potentially refreshing the data",
    "start": "1879000",
    "end": "1884720"
  },
  {
    "text": "your app can go back to your server to fetch the data at that point if you include some kind of a token that's",
    "start": "1884720",
    "end": "1890919"
  },
  {
    "text": "unique to that particular notification your server knows that the message was received and if it wasn't it can retrial",
    "start": "1890919",
    "end": "1896279"
  },
  {
    "text": "automatically later as an example so that would be like you know your endtoend you know verification the",
    "start": "1896279",
    "end": "1902679"
  },
  {
    "text": "message was received I don't know if that answers your question so um the",
    "start": "1902679",
    "end": "1907799"
  },
  {
    "text": "we're going to go into the details of these particular steps but just as a big picture are there any questions not so",
    "start": "1907799",
    "end": "1915039"
  },
  {
    "text": "step one and step for you mentioned there so why email address does this have to be the same email address yes",
    "start": "1915039",
    "end": "1921080"
  },
  {
    "text": "this has to be exactly the same email address as the one you use when you sign up for account so the Step Zero is sign up for an account and you and you",
    "start": "1921080",
    "end": "1927519"
  },
  {
    "text": "provide an email address at that point so my ID is TI to the email address and also the all to that send email add",
    "start": "1927519",
    "end": "1933480"
  },
  {
    "text": "that's right they don't match up then step six will fail that's correct and you for example the app that",
    "start": "1933480",
    "end": "1939360"
  },
  {
    "text": "that you I'm going to demo you know what we do is we make that email address be configurable on the server so Step Zero",
    "start": "1939360",
    "end": "1945480"
  },
  {
    "text": "really for us is go to our server fetch that email address so that our app",
    "start": "1945480",
    "end": "1950720"
  },
  {
    "text": "is not you know the email address is not burnt into the app no it doesn't go to everybody so the",
    "start": "1950720",
    "end": "1957679"
  },
  {
    "text": "idea here you this this is a point topoint notification system me or I guess point you know one to many but",
    "start": "1957679",
    "end": "1964200"
  },
  {
    "text": "it's one to to one at a time right so you can't actually send notification to everyone uh from either end when you",
    "start": "1964200",
    "end": "1971440"
  },
  {
    "text": "when you send your notification you target a specific registration ID which targets a specific application on a",
    "start": "1971440",
    "end": "1976760"
  },
  {
    "text": "specific device if yes which is kind like I said you know that's what we how",
    "start": "1976760",
    "end": "1981840"
  },
  {
    "text": "we built it like so I'll show you like you can so the the the email the registration so you're asking",
    "start": "1981840",
    "end": "1987120"
  },
  {
    "text": "registration ID or registration email the registration email for the appliation right so like I said you know our our app the one the one that I'll",
    "start": "1987120",
    "end": "1994039"
  },
  {
    "text": "show you doesn't actually have the registration email built into the app what we do is we the server like our app",
    "start": "1994039",
    "end": "1999760"
  },
  {
    "text": "does an HTTP get on the server to get a registration email and then uses it to register for c2dm so that it's you know",
    "start": "1999760",
    "end": "2006480"
  },
  {
    "text": "it's configurable well you could have you could have multiple registrations with Google and each app could have a",
    "start": "2006480",
    "end": "2012320"
  },
  {
    "text": "different registration email tied to it if you wanted right so like so if you wanted to if if you're affected by",
    "start": "2012320",
    "end": "2018120"
  },
  {
    "text": "effectively uh the the quarter limits exactly that's what I'm afraid so you can busy the other get shut down you can",
    "start": "2018120",
    "end": "2025960"
  },
  {
    "text": "certainly you can certainly do that okay so you can register I mean you could potentially register for multiple email",
    "start": "2025960",
    "end": "2031760"
  },
  {
    "text": "addresses and you know you you spread them across even the same inst installation app I don't know how Google",
    "start": "2031760",
    "end": "2036880"
  },
  {
    "text": "will look at that that's what so that is a good question and this is some something that they're somewhat unclear",
    "start": "2036880",
    "end": "2042039"
  },
  {
    "text": "with as to how they enforce the limits are they able you know are you able to have multiple registrations on",
    "start": "2042039",
    "end": "2047559"
  },
  {
    "text": "effectively the same package ID yes exct right we tried that our company they told us they recommend us to do it we",
    "start": "2047559",
    "end": "2054158"
  },
  {
    "text": "had use one account for all yeah and right so I mean you could potentially release like if this is you know you",
    "start": "2054159",
    "end": "2059398"
  },
  {
    "text": "could release your app multiple times or something like you could have a customer specific app so as long as your package name differs you're good but that's",
    "start": "2059399",
    "end": "2066000"
  },
  {
    "text": "potentially an option so again this this is the part that sucks and this is the part unfortunately as much as I would",
    "start": "2066000",
    "end": "2071720"
  },
  {
    "text": "like to give you answers on it's really it's a Google run service and they haven't been very upfront and clear with",
    "start": "2071720",
    "end": "2078000"
  },
  {
    "text": "how they enforce the sech of limitations okay goad so so the user uninstalls the you have all theale right",
    "start": "2078000",
    "end": "2086079"
  },
  {
    "text": "so that's a good point and thank you for mentioning that so if your app gets uninstalled the the the the app is",
    "start": "2086079",
    "end": "2092158"
  },
  {
    "text": "automatically unregistered from this side right so c2dm knows to refuse",
    "start": "2092159",
    "end": "2098200"
  },
  {
    "text": "future submissions from our server for that registration ID and our server is supposed to basically you know get it",
    "start": "2098200",
    "end": "2104599"
  },
  {
    "text": "gets an error code that says hey this registration ID is invalid so that point the server should deprovision the",
    "start": "2104599",
    "end": "2110400"
  },
  {
    "text": "registration ID it has internally saved for that particular installation and all the right right right of course of",
    "start": "2110400",
    "end": "2116800"
  },
  {
    "text": "course yes although generally if you know if we are on you know if we're online and we unregister our app or",
    "start": "2116800",
    "end": "2124079"
  },
  {
    "text": "maybe as we come online we may get all these messages before we get a chance to unregister",
    "start": "2124079",
    "end": "2129280"
  },
  {
    "text": "um how secure is this whole process so good question the connection between the",
    "start": "2129280",
    "end": "2135480"
  },
  {
    "text": "messaging server and our app is SSL encrypted and we'll see actually Google has a pretty good way of keeping it SSL",
    "start": "2135480",
    "end": "2142079"
  },
  {
    "text": "encrypted because that's actually quite expensive to do not for handshake reasons because the connection gets reestablished so many times um so this",
    "start": "2142079",
    "end": "2149599"
  },
  {
    "text": "is SSL within within the app you know yes your message your raw data is",
    "start": "2149599",
    "end": "2155400"
  },
  {
    "text": "passing through Google servers and it's passing Within in the app through Google infrastructure in the app right and you",
    "start": "2155400",
    "end": "2160760"
  },
  {
    "text": "could argue well you know could they not you know Miss whatever you know does that not that compromise the privacy or",
    "start": "2160760",
    "end": "2166119"
  },
  {
    "text": "the Integrity of my my data now generally you could nothing stopping you from encrypting the data on the server",
    "start": "2166119",
    "end": "2172560"
  },
  {
    "text": "side passing it as encrypted data you know in base 64 encoded message and then having your app decrypted so Google has",
    "start": "2172560",
    "end": "2179119"
  },
  {
    "text": "no knowledge of it anyway but you don't want to build your data in the message",
    "start": "2179119",
    "end": "2185319"
  },
  {
    "text": "me message should not really contain sensitive info the sensitive info should come at the last step when we go and get",
    "start": "2185319",
    "end": "2192520"
  },
  {
    "text": "notified we go to our server and say okay give us the last last data and we generally can do that over SSL and that",
    "start": "2192520",
    "end": "2199280"
  },
  {
    "text": "at that point it's outside of Google's hands anyways or anyone else's right so it is so the way you build your app",
    "start": "2199280",
    "end": "2205560"
  },
  {
    "text": "effectively is up it's up to you to guarantee that Security provide that security okay so let's move on and then",
    "start": "2205560",
    "end": "2210920"
  },
  {
    "text": "we'll see if there are more questions later on so how does it all work right so on the device Google actually has a",
    "start": "2210920",
    "end": "2217920"
  },
  {
    "text": "background service that's running at all times and it's basically has this SSL",
    "start": "2217920",
    "end": "2223319"
  },
  {
    "text": "encrypted connection okay it honors the background data settings if the user says I don't want any background data",
    "start": "2223319",
    "end": "2229000"
  },
  {
    "text": "you know basically maybe on a they're on a you know on a plan one of those steered plans and they don't want to do it you know then it gets turned off and",
    "start": "2229000",
    "end": "2235480"
  },
  {
    "text": "the push doesn't work so that's one other limitation but that's that's actually a good one um it automatically",
    "start": "2235480",
    "end": "2241720"
  },
  {
    "text": "this covers where Network becomes available and unavailable so it automatically starts and stop as needed",
    "start": "2241720",
    "end": "2247359"
  },
  {
    "text": "um it uses heartbeats to to reconnect as necessary so it will actually as you could imagine run periodically so that",
    "start": "2247359",
    "end": "2254839"
  },
  {
    "text": "is polling after all runs periodically tests the the you know the health of the connection and some connections can be",
    "start": "2254839",
    "end": "2261160"
  },
  {
    "text": "half open so it tries to so tries to basically push something to the server and get an act back and if it fails it",
    "start": "2261160",
    "end": "2267000"
  },
  {
    "text": "reestablishes the connection now in the cloud so this is the service part of the c2dm Google provides basically this farm",
    "start": "2267000",
    "end": "2274440"
  },
  {
    "text": "this massive Farm of servers that they have already for their own stuff right",
    "start": "2274440",
    "end": "2279480"
  },
  {
    "text": "and basically one of the features of their Farm in addition to being huge and allowing all these persistent connections is that it has this smart",
    "start": "2279480",
    "end": "2286640"
  },
  {
    "text": "SSL resumption system so that basically SSL as you know involves you know public",
    "start": "2286640",
    "end": "2292000"
  },
  {
    "text": "encryption to establish the session key which is then used through symmetric key encryption for the actual data passing",
    "start": "2292000",
    "end": "2298160"
  },
  {
    "text": "right but the the the public encryption part and the you know the handshake until we get to the session key is quite",
    "start": "2298160",
    "end": "2304319"
  },
  {
    "text": "of kind of expensive especially on a device where battery matters right yes they're getting more powerful but you",
    "start": "2304319",
    "end": "2309960"
  },
  {
    "text": "know batteries are not getting more powerful at least not at the same rate as users demand them to be so what we",
    "start": "2309960",
    "end": "2315040"
  },
  {
    "text": "want is to cat the session key as as long as possible so that when these connections are reestablished we can",
    "start": "2315040",
    "end": "2320599"
  },
  {
    "text": "effectively re reconnect and so Google does that for us um yeah and what's also",
    "start": "2320599",
    "end": "2326280"
  },
  {
    "text": "you know so basically uh the server site can also detect dead connection so you can also push heartbeats from the server",
    "start": "2326280",
    "end": "2332200"
  },
  {
    "text": "side uh so the server side can actually say oh this died so next time around",
    "start": "2332200",
    "end": "2337599"
  },
  {
    "text": "when there's a message to send to the to the device I'm not even going to try now not note that server cannot open a",
    "start": "2337599",
    "end": "2343880"
  },
  {
    "text": "connection to the device right I mean it's the device that has to connect to the server not the other way around um",
    "start": "2343880",
    "end": "2349720"
  },
  {
    "text": "and so what we do right so our job in addition yes there are a lot of steps but our job really is to build a",
    "start": "2349720",
    "end": "2356359"
  },
  {
    "text": "broadcast receiver that can accept these messages and then react to them however we you know want to react to them so",
    "start": "2356359",
    "end": "2364119"
  },
  {
    "text": "let's go through the steps the first step is you know Step Zero if you will to go to",
    "start": "2364119",
    "end": "2370079"
  },
  {
    "text": "this URL and sign up for an account okay they ask you for things like you know uh",
    "start": "2370079",
    "end": "2375720"
  },
  {
    "text": "the name of your app you know the package name of your app it's okay if it hasn't been published yet what how many messages you expect to be sending um you",
    "start": "2375720",
    "end": "2383119"
  },
  {
    "text": "know in to a you know an aggregate or you know uh to a particular device at a time um your content information and the",
    "start": "2383119",
    "end": "2391119"
  },
  {
    "text": "most important this Ro email this Ro email is not meant to be a human email it's kind of like you can call it you",
    "start": "2391119",
    "end": "2397160"
  },
  {
    "text": "know for us is like Android maranao.com whatever it's very abstract okay and",
    "start": "2397160",
    "end": "2403000"
  },
  {
    "text": "this is the email that we're going to use to authenticate to Google and this is the email we're going to use when request the registration ID from c2da",
    "start": "2403000",
    "end": "2410040"
  },
  {
    "text": "okay so that part you need to do on your own you just go to the web page fill out the information wait usually it takes a",
    "start": "2410040",
    "end": "2416480"
  },
  {
    "text": "couple of days you get most of you will get it uh unless you have some naughty things in your package name and you know",
    "start": "2416480",
    "end": "2423520"
  },
  {
    "text": "it'll work what you then do is you you need to set up your your app for c2dm this seems",
    "start": "2423520",
    "end": "2430760"
  },
  {
    "text": "a little overwhelming uh but there not that complicated it's mostly boiler plate you only do it once so it's not a",
    "start": "2430760",
    "end": "2437720"
  },
  {
    "text": "big deal the first thing you notice is that my app has this custom app here I",
    "start": "2437720",
    "end": "2443680"
  },
  {
    "text": "call it my app I don't know how many of you know of this application object that exists in in Android which is",
    "start": "2443680",
    "end": "2450920"
  },
  {
    "text": "effectively a Singleton in the way it works not the way you actually code it but the way it works in runtime and",
    "start": "2450920",
    "end": "2457400"
  },
  {
    "text": "allows you to share stuff through it the reason why I have it is because that's one of the simple ways to share wake",
    "start": "2457400",
    "end": "2463119"
  },
  {
    "text": "locks and I'll explain later on why we use wake locks so for the time being that's not really c2dm specific but it",
    "start": "2463119",
    "end": "2469000"
  },
  {
    "text": "comes into play here's the big part right here's basically Our receiver this",
    "start": "2469000",
    "end": "2474160"
  },
  {
    "text": "is what we go and build now this receiver notice has this permission this",
    "start": "2474160",
    "end": "2480680"
  },
  {
    "text": "you know com Google Android c2dm permission set this basically the reason",
    "start": "2480680",
    "end": "2486480"
  },
  {
    "text": "why you put this permission here is so that we require that the sender of c2dm",
    "start": "2486480",
    "end": "2492119"
  },
  {
    "text": "messages be this Google application this Google service effective way so that doesn't someone else doesn't spoof the",
    "start": "2492119",
    "end": "2498440"
  },
  {
    "text": "messages you asked about security well this helps us uh you know effectively weed out other applications from you",
    "start": "2498440",
    "end": "2504920"
  },
  {
    "text": "know spoofing our notifications what we then do is we register via intent filters for two",
    "start": "2504920",
    "end": "2511160"
  },
  {
    "text": "actions one is the receive which is how we get notified of these messages and",
    "start": "2511160",
    "end": "2517800"
  },
  {
    "text": "then the other one is the registration this is how we get called back when our registration ID is ready this was step",
    "start": "2517800",
    "end": "2524520"
  },
  {
    "text": "number one right so we go to Google internal service we try to register that somehow goes to the cloud and get grabs",
    "start": "2524520",
    "end": "2531599"
  },
  {
    "text": "us assigns this registration ID we now get it and we basically stick it uh we we we accept it via a broadcast receiver",
    "start": "2531599",
    "end": "2539000"
  },
  {
    "text": "call and it's for Action registration it's like an acknowledgement basically so well it's not just the acknowledgement it actually contain",
    "start": "2539000",
    "end": "2545119"
  },
  {
    "text": "that's so so the way we get a registration is asynchronously right so it's a call back effectively it's a call",
    "start": "2545119",
    "end": "2550440"
  },
  {
    "text": "back we request it and at some point in the future that particular event is going to fire and we're going to get it",
    "start": "2550440",
    "end": "2556400"
  },
  {
    "text": "okay you notice that there's categories here that are added uh that effectively allow uh that just to weed out or to",
    "start": "2556400",
    "end": "2563960"
  },
  {
    "text": "better yet to to to avoid having our the broadcast that we're getting go to other",
    "start": "2563960",
    "end": "2569559"
  },
  {
    "text": "applications okay so that's why we have the category of course there's actually a better that's just that's just to",
    "start": "2569559",
    "end": "2574839"
  },
  {
    "text": "simplify or to make it a little more efficient so other applications are not even considered should they try to",
    "start": "2574839",
    "end": "2580000"
  },
  {
    "text": "receive our messages um and they can have their own obviously other applications will have their own",
    "start": "2580000",
    "end": "2585520"
  },
  {
    "text": "broadcast receivers they will subscribe to exactly the same actions but because they have different categories they will",
    "start": "2585520",
    "end": "2590880"
  },
  {
    "text": "only be interested in their own messages that's how that's how the broad even though broadcast messages are you know",
    "start": "2590880",
    "end": "2596480"
  },
  {
    "text": "one to many in this particular case they're one to one one particular application is meant to get it the",
    "start": "2596480",
    "end": "2601960"
  },
  {
    "text": "application shouldn't be running in fact we don't want our application to be running for all intended purposes this is you know that's the whole reason here",
    "start": "2601960",
    "end": "2608240"
  },
  {
    "text": "we want to we don't want to bre waste the battery right so that's that's the whole point of broadcast receivers so",
    "start": "2608240",
    "end": "2613960"
  },
  {
    "text": "they will wake up this this broadcast message that that that you know that effectively we capture through this",
    "start": "2613960",
    "end": "2619000"
  },
  {
    "text": "intent filter will start our entire will launch you know a new doic instance we'll launch application in it we",
    "start": "2619000",
    "end": "2625599"
  },
  {
    "text": "initialize a broadcast receiver and we'll call the onreceive method on it that's exactly how broadcast receivers",
    "start": "2625599",
    "end": "2630880"
  },
  {
    "text": "are meant to work so just to come back to one particular Point here with respect to security how do we",
    "start": "2630880",
    "end": "2637960"
  },
  {
    "text": "ensure that effectively we only get this message okay so one of the things we do",
    "start": "2637960",
    "end": "2644200"
  },
  {
    "text": "is we declare a permission here so notice this particular section so right here we declare a permission now that",
    "start": "2644200",
    "end": "2651880"
  },
  {
    "text": "permission is our package name plus. permission. c2dm message okay it's a",
    "start": "2651880",
    "end": "2659760"
  },
  {
    "text": "predetermined permission name now the reason why we both declare it and use it",
    "start": "2659760",
    "end": "2666000"
  },
  {
    "text": "okay so we need to use our own permission here and it's basically signature level permission so the user will never actually see this the the",
    "start": "2666000",
    "end": "2671720"
  },
  {
    "text": "user who go gets to install your application they will actually never see oh this application requires this",
    "start": "2671720",
    "end": "2677240"
  },
  {
    "text": "particular permission because it's signature level okay so what will happen is that Google",
    "start": "2677240",
    "end": "2682359"
  },
  {
    "text": "c2dm infrastructure on the device when it pushes the message to our application",
    "start": "2682359",
    "end": "2687480"
  },
  {
    "text": "the way will prevent others from effectively declaring their own receiver",
    "start": "2687480",
    "end": "2692839"
  },
  {
    "text": "with exactly the same categories I.E they will be effectively be able ble to intercept their messages so the way they",
    "start": "2692839",
    "end": "2699240"
  },
  {
    "text": "prevent them is because we are the only ones who own this message right sorry this permission so",
    "start": "2699240",
    "end": "2706040"
  },
  {
    "text": "therefore what they do as I will show you in a moment they basic basically push create an intent and when they send",
    "start": "2706040",
    "end": "2711520"
  },
  {
    "text": "a broadcast they add this permission so this permission is predetermined so that's it's some kind of a you know you",
    "start": "2711520",
    "end": "2716839"
  },
  {
    "text": "need to just provide it in such so it's always going to be package name plus permission you know plus you know c2dm",
    "start": "2716839",
    "end": "2722440"
  },
  {
    "text": "message U go ahead actually my question well you want your apps to be to be",
    "start": "2722440",
    "end": "2727559"
  },
  {
    "text": "targeted separately so your each app is going to have a different package name so therefore each app is going to have a",
    "start": "2727559",
    "end": "2732839"
  },
  {
    "text": "different permission and each app is going to have a different category if there are two apps right if they have two different package rooms which is how",
    "start": "2732839",
    "end": "2739240"
  },
  {
    "text": "how you differentiate two apps in the first place you could so you're right in a sense you could you you know in that",
    "start": "2739240",
    "end": "2746200"
  },
  {
    "text": "point because you will presumably sign both apps with the same signature so",
    "start": "2746200",
    "end": "2751280"
  },
  {
    "text": "then you will be you should you could basically use it and you could have both apps be or or basically an app it's are",
    "start": "2751280",
    "end": "2757119"
  },
  {
    "text": "meant to be triggered be triggered by this but that's I don't know why you would do that I don't know what the use case is for that but yes it's possible",
    "start": "2757119",
    "end": "2763200"
  },
  {
    "text": "my authentication that would not be a use good use face case for authentication I",
    "start": "2763200",
    "end": "2768480"
  },
  {
    "text": "mean so it's possible how and why you would do it would be up to you applications",
    "start": "2768480",
    "end": "2774520"
  },
  {
    "text": "sorry right but again you know generally just from what again let's take a look at the big picture what's the idea here",
    "start": "2774520",
    "end": "2781079"
  },
  {
    "text": "we want to Target a particular application we don't if that application gets the message and he wants to",
    "start": "2781079",
    "end": "2786359"
  },
  {
    "text": "internally broadcast it to other applications let it do an its own internal inter internal broadcast it",
    "start": "2786359",
    "end": "2791559"
  },
  {
    "text": "wouldn't make sense to have all these applications be triggered and all these application have to tie into the c2dm",
    "start": "2791559",
    "end": "2796760"
  },
  {
    "text": "that just it's just bad design right you want to minimize your exposure to external interfaces not you know make it",
    "start": "2796760",
    "end": "2802760"
  },
  {
    "text": "bigger okay so um couple of other things you notice here I have a permission to",
    "start": "2802760",
    "end": "2808559"
  },
  {
    "text": "receive uh so I have to require this permission to receive basically c2dm in the first place this just so I can",
    "start": "2808559",
    "end": "2814440"
  },
  {
    "text": "participate in the c2dm framework and just in this particular case because I'll be obviously going to the internet",
    "start": "2814440",
    "end": "2820520"
  },
  {
    "text": "to Reg for registration purposes I also need to grab an internet permission and I need to grab a wake clck okay the Wake",
    "start": "2820520",
    "end": "2827520"
  },
  {
    "text": "locks are really only because I'm going to be doing long running operations so in almost all cases will you need these",
    "start": "2827520",
    "end": "2832960"
  },
  {
    "text": "okay and you'll see later on how how you would use it so uh good so far hoping so",
    "start": "2832960",
    "end": "2840160"
  },
  {
    "text": "this is basically that's step number 1.1 1.2 is where we",
    "start": "2840160",
    "end": "2845440"
  },
  {
    "text": "actually you know kick off the registration process remember we need to register so what we do is we build an",
    "start": "2845440",
    "end": "2851880"
  },
  {
    "text": "intent from for example a service or an application or broadcast receiver application doesn't really matter one of",
    "start": "2851880",
    "end": "2857559"
  },
  {
    "text": "our you know Android you know components if you will and in it we Define this",
    "start": "2857559",
    "end": "2863640"
  },
  {
    "text": "action which is com you know Google Android c2dm intent register okay we",
    "start": "2863640",
    "end": "2869520"
  },
  {
    "text": "then put an extra bit into this intent and this extra seems like kind of",
    "start": "2869520",
    "end": "2875119"
  },
  {
    "text": "cryptic it's some pending intent of a broadcast that just has an internally an",
    "start": "2875119",
    "end": "2880920"
  },
  {
    "text": "empty intent seems like what the heck is this you don't even have to understand what pending intents are nor what this",
    "start": "2880920",
    "end": "2886359"
  },
  {
    "text": "would represent and what those zeros actually mean because think of it this way this pending intent is think of it",
    "start": "2886359",
    "end": "2892640"
  },
  {
    "text": "as just a signature of our app effectively it includes our app's package name that's it okay this is how",
    "start": "2892640",
    "end": "2899839"
  },
  {
    "text": "Google knows that we are the ones who requested this it's just a requirement that we put it here and then the last",
    "start": "2899839",
    "end": "2905839"
  },
  {
    "text": "and most important thing we need to put in here the sender right this basically",
    "start": "2905839",
    "end": "2911040"
  },
  {
    "text": "over here this sender this email address that you see over here is the email address that we basically use when we",
    "start": "2911040",
    "end": "2917200"
  },
  {
    "text": "registered or in Step Zero when we sign up for c2dm email address right that is the wh",
    "start": "2917200",
    "end": "2922880"
  },
  {
    "text": "listed email address okay this you can make configurable as opposed to hardcoding it as as I did in my in my",
    "start": "2922880",
    "end": "2928640"
  },
  {
    "text": "app and then we start our service so we push the this registration intent we say start a service this goes outside of our",
    "start": "2928640",
    "end": "2935240"
  },
  {
    "text": "application scope goes to Google does the registration and sends us back the notification okay so how do we get the",
    "start": "2935240",
    "end": "2941280"
  },
  {
    "text": "notification so this is the completing the registration okay we build a broadcast receiver now again I hope you",
    "start": "2941280",
    "end": "2949200"
  },
  {
    "text": "understand what broadcast receivers are if you don't think of it as components they can get you know triggered or",
    "start": "2949200",
    "end": "2954280"
  },
  {
    "text": "tickled by by anything on the system okay through the use of intents and this broadcast receiver has an on received",
    "start": "2954280",
    "end": "2960520"
  },
  {
    "text": "method in which we grab for example the action so we want to understand what was the action that was in fact that invoked",
    "start": "2960520",
    "end": "2966760"
  },
  {
    "text": "a receiver we test whether the action equals the registration part because the reason why we do this is because they",
    "start": "2966760",
    "end": "2972960"
  },
  {
    "text": "tend to want to reuse the same receiver for both registration and to handle the rece re you know the actual you know the",
    "start": "2972960",
    "end": "2979760"
  },
  {
    "text": "messages at that point we can grab the registration ID at that point we have",
    "start": "2979760",
    "end": "2985000"
  },
  {
    "text": "the registration ID okay or we can have an error in case for example we have not",
    "start": "2985000",
    "end": "2991920"
  },
  {
    "text": "if this sender account that we used wasn't properly uh uh uh registered or",
    "start": "2991920",
    "end": "2997200"
  },
  {
    "text": "we may actually get this unregistered string which just means that we unregistered it's kind of weird like a registration intent is also filed when",
    "start": "2997200",
    "end": "3004079"
  },
  {
    "text": "you unregister as we will talk about later so we test for errors we can test for whether or not we're unregistered",
    "start": "3004079",
    "end": "3010319"
  },
  {
    "text": "but let's assume we are registered that's kind of what we're interested in so we check for whether this is not null",
    "start": "3010319",
    "end": "3015599"
  },
  {
    "text": "and now that we know it's not null we know we are registered on the server side on the c2dm side what we now need",
    "start": "3015599",
    "end": "3021599"
  },
  {
    "text": "to do is take the registration ID and give it to our server so that our server can BAS basically go and Target our",
    "start": "3021599",
    "end": "3028480"
  },
  {
    "text": "particular installation of the app okay now generally because talking to our",
    "start": "3028480",
    "end": "3034079"
  },
  {
    "text": "server is a long running operation right involves iio involves Network which is slow and we only have up to 10 seconds",
    "start": "3034079",
    "end": "3041200"
  },
  {
    "text": "in the broadcast receiver before we get an anr or the application not responsive and you don't want to ever even approach",
    "start": "3041200",
    "end": "3048119"
  },
  {
    "text": "the threshold of 10 seconds you generally don't want to do anything like talking to a server inside of a non-",
    "start": "3048119",
    "end": "3054160"
  },
  {
    "text": "received method we also cannot throw you know create a a thread to do it like or an Asing task because as soon as the on",
    "start": "3054160",
    "end": "3060240"
  },
  {
    "text": "received method is done our broadcast receiver is considered dead so our application can basically be disposed of",
    "start": "3060240",
    "end": "3065599"
  },
  {
    "text": "so you never want to create threads from broadcast receivers so what we do is we create we we effectively have a service",
    "start": "3065599",
    "end": "3072119"
  },
  {
    "text": "do the registration for us or when I say registration I mean pass the registration ID to our server so the way",
    "start": "3072119",
    "end": "3079240"
  },
  {
    "text": "I do it I create an intent let's say I have something called reged service and I go and basically stick this",
    "start": "3079240",
    "end": "3085520"
  },
  {
    "text": "registration ID into the you know the this intent as an extra and then I start",
    "start": "3085520",
    "end": "3090720"
  },
  {
    "text": "a service okay now so you're right so my my application actually the way I built",
    "start": "3090720",
    "end": "3095960"
  },
  {
    "text": "it is actually has already a check boox and then you you know when the user presses in the check box you know that",
    "start": "3095960",
    "end": "3101119"
  },
  {
    "text": "means hey you should be registered and yes you know you may want to record the success or the failure of the",
    "start": "3101119",
    "end": "3106319"
  },
  {
    "text": "registration the way I the way I do it is if it fails to register and I just uncheck their checkbox and maybe I give",
    "start": "3106319",
    "end": "3112440"
  },
  {
    "text": "them like a little toast that says hey you've just failed sure it can be done better okay um so we now start our",
    "start": "3112440",
    "end": "3120119"
  },
  {
    "text": "service okay now the service looks like this now I'm going to assume you guys",
    "start": "3120119",
    "end": "3125880"
  },
  {
    "text": "know what services are okay these are the background processes and the reason why we like Services is because they",
    "start": "3125880",
    "end": "3132680"
  },
  {
    "text": "prevent our application from being disposed of after all all of this can run in the background there may not be",
    "start": "3132680",
    "end": "3137920"
  },
  {
    "text": "any UI any activities associated with our application runs in the background right we don't want it to be killed so",
    "start": "3137920",
    "end": "3143319"
  },
  {
    "text": "Services have higher priority than like's say background applications or stopped applications that just have activities right so the way I do it",
    "start": "3143319",
    "end": "3151839"
  },
  {
    "text": "though is I build a an or extend the intent service the intent service has this on handle intent method which is",
    "start": "3151839",
    "end": "3158920"
  },
  {
    "text": "called by a separate thread so intent service for those you that don't know is effectively think of it as a as a",
    "start": "3158920",
    "end": "3164839"
  },
  {
    "text": "template for how to not have to deal with threading in a service get it",
    "start": "3164839",
    "end": "3169880"
  },
  {
    "text": "basically to be done for you for free so rather than you know override the onart",
    "start": "3169880",
    "end": "3175240"
  },
  {
    "text": "method or on start command we override the on handle intent which is internally",
    "start": "3175240",
    "end": "3181160"
  },
  {
    "text": "invoked in a separate thread okay that's what intent service guarantees for us",
    "start": "3181160",
    "end": "3186559"
  },
  {
    "text": "and it has its own internal thread pools and all that stuff so it's you know makes it super easy for us so what we then do grab the registration ID if we",
    "start": "3186559",
    "end": "3194559"
  },
  {
    "text": "wanted to we can grab the user ID assuming we have a concept of a user okay or you can grab the device ID the",
    "start": "3194559",
    "end": "3201839"
  },
  {
    "text": "way you grab a device ID you grab you know get a reference to this telepan manager um through a system service and",
    "start": "3201839",
    "end": "3208760"
  },
  {
    "text": "then you as the telephon manager for the device ID for that to work though you need to add another permission which is",
    "start": "3208760",
    "end": "3214720"
  },
  {
    "text": "basically this you know uh read phone state so you need to stick that into your you know your your application or",
    "start": "3214720",
    "end": "3221000"
  },
  {
    "text": "your manifest file and at that point we have the registration and we have something that uniquely identifies that",
    "start": "3221000",
    "end": "3227040"
  },
  {
    "text": "particular you know user or device so we take those two pieces of information and we post them or however send them to our",
    "start": "3227040",
    "end": "3235480"
  },
  {
    "text": "server generally using like URL con or HTTP URL connection or https URL connection which I hope you know how to",
    "start": "3235480",
    "end": "3242359"
  },
  {
    "text": "do or if you you can use the even better the Apache uh effectively Commons HTTP",
    "start": "3242359",
    "end": "3247880"
  },
  {
    "text": "client that's built into the Android uh API so it comes with Androids you know provided by the Android apis so that",
    "start": "3247880",
    "end": "3254559"
  },
  {
    "text": "part is outside of the scope of this just because we can talk about that forever it's generally well understood you can just Google it and you'll see",
    "start": "3254559",
    "end": "3260760"
  },
  {
    "text": "how to post you know in Java a simple HTTP uh make an HTTP post okay and we",
    "start": "3260760",
    "end": "3266839"
  },
  {
    "text": "what we're passing to our server is the device ID or the user ID plus the registration ID okay",
    "start": "3266839",
    "end": "3274119"
  },
  {
    "text": "now saving the registration now we're on the server okay however you build a",
    "start": "3274119",
    "end": "3279559"
  },
  {
    "text": "server whether it's PHP or Java or whatever you prefer um we go and Prov",
    "start": "3279559",
    "end": "3285559"
  },
  {
    "text": "provide some kind of a storage mechanism for these registrations and the users it's up to you how you build this for",
    "start": "3285559",
    "end": "3292160"
  },
  {
    "text": "example you know in my little sample application I have a table called use your c2dm in a mySQL database which",
    "start": "3292160",
    "end": "3298040"
  },
  {
    "text": "records two things the user ID which you know is an an integer I guess um and a",
    "start": "3298040",
    "end": "3303920"
  },
  {
    "text": "registration ID okay which is the thing that I got from c2dm in step one okay",
    "start": "3303920",
    "end": "3310400"
  },
  {
    "text": "and I make my registration ID you know be primary or user ID primary of course the limitation of this is that I only",
    "start": "3310400",
    "end": "3316599"
  },
  {
    "text": "allow a user to be registered on one device at a time so if they have multiple Android devices that kind of",
    "start": "3316599",
    "end": "3322160"
  },
  {
    "text": "would you know suck so maybe I should actually use device ID as opposed to user ID",
    "start": "3322160",
    "end": "3327319"
  },
  {
    "text": "whatever okay and then what you know the way I do it is I you know let's say this was a serlet assuming you guys know",
    "start": "3327319",
    "end": "3333599"
  },
  {
    "text": "serlet or at least have seen them or having a general understanding of how to read HTTP parameters I would read",
    "start": "3333599",
    "end": "3339280"
  },
  {
    "text": "basically the user ID and the registration ID or replace this with device ID and then I would simply persist that into my database okay so",
    "start": "3339280",
    "end": "3347920"
  },
  {
    "text": "now I know that information should I want to Target that user in the future uh it can be bigger than 250 in fact",
    "start": "3347920",
    "end": "3354880"
  },
  {
    "text": "it's really big uh it's uh some it's um I don't know",
    "start": "3354880",
    "end": "3360039"
  },
  {
    "text": "feels like maybe 500 characters and I since I don't know it doesn't say how big it can be I just",
    "start": "3360039",
    "end": "3366680"
  },
  {
    "text": "don't want to think about it right so the registration IDs registration IDs are device specific right now if all I",
    "start": "3366680",
    "end": "3374440"
  },
  {
    "text": "had here if I if this is how I did the my server side what would happen is that one device would register first and then",
    "start": "3374440",
    "end": "3381119"
  },
  {
    "text": "the second device would overwrite the previous devices registration because presumably you in this case I would just",
    "start": "3381119",
    "end": "3387000"
  },
  {
    "text": "maybe call as opposed to insert replace you know use the keyword in replace and that will effectively overwrite it if I",
    "start": "3387000",
    "end": "3393760"
  },
  {
    "text": "wanted to I would just add a third column and call it device ID and then I would make the user and the device ID",
    "start": "3393760",
    "end": "3401079"
  },
  {
    "text": "potent be the primary key so combination of two would be the primary key go ahead you don't again you don't have to use it",
    "start": "3401079",
    "end": "3408520"
  },
  {
    "text": "if you wanted to Target a specific device I don't see way you know other ways around it so yes you can argue that",
    "start": "3408520",
    "end": "3414119"
  },
  {
    "text": "there's you know privacy issues per se but not much you can do about it there's no no no way around it and if you know",
    "start": "3414119",
    "end": "3420119"
  },
  {
    "text": "better by all means feel free to share it's it's just an ID I mean it's you know if you want to encrypt it or",
    "start": "3420119",
    "end": "3426400"
  },
  {
    "text": "whatever if you're cons I mean I'm not I don't see I guess if you know all the",
    "start": "3426400",
    "end": "3431720"
  },
  {
    "text": "applications in the world use the device ID and yes if one application leaks it then you can infer things about the user",
    "start": "3431720",
    "end": "3437240"
  },
  {
    "text": "another application somewhere else and yes that raises privacy issues but again that just you know we don't have we",
    "start": "3437240",
    "end": "3442880"
  },
  {
    "text": "canfor unfortunately we don't have the time to go into you know how to best address that some sort thing but you're right I mean it could be potentially",
    "start": "3442880",
    "end": "3449280"
  },
  {
    "text": "something you may need to protect go ahead the app server on the devices then how would the push work so the device",
    "start": "3449280",
    "end": "3455559"
  },
  {
    "text": "would you know inform itself there's already a a built-in you",
    "start": "3455559",
    "end": "3461280"
  },
  {
    "text": "know push mechanism in Android called broadcast receivers I don't see how you know the whole idea is of the c2dm is",
    "start": "3461280",
    "end": "3467000"
  },
  {
    "text": "for the cloud to tell us of something not for something else on the device to tell us or something right so if you do",
    "start": "3467000",
    "end": "3472640"
  },
  {
    "text": "need something like that you just use broadcast receivers and that's that that's how n works it's what's you know",
    "start": "3472640",
    "end": "3477760"
  },
  {
    "text": "built into Android okay so we save this again how we save it is up to you go ahead when we",
    "start": "3477760",
    "end": "3484640"
  },
  {
    "text": "need to we need to unfortunately move up we only have another I don't know how many time how many no so hold on the",
    "start": "3484640",
    "end": "3490480"
  },
  {
    "text": "user ID here is your logical user ID let's say I was let's say which is the",
    "start": "3490480",
    "end": "3496559"
  },
  {
    "text": "app that I have is a Twitter like client okay it's the Twitter user that will be",
    "start": "3496559",
    "end": "3501760"
  },
  {
    "text": "the user ID so I would so basically when I want to Target a particular Twitter user to tell the Twitter user hey your",
    "start": "3501760",
    "end": "3508079"
  },
  {
    "text": "friend has posted something come grab it that so I would know that particular user's",
    "start": "3508079",
    "end": "3513400"
  },
  {
    "text": "registration so this is not in any way shap or form the the Google account they",
    "start": "3513400",
    "end": "3518640"
  },
  {
    "text": "use to sign up for c2dm in the first place they're separate so step number",
    "start": "3518640",
    "end": "3524839"
  },
  {
    "text": "four okay we now go to c2dm oh sorry to",
    "start": "3524839",
    "end": "3529920"
  },
  {
    "text": "client login to grab this all token let me just by the way for one quick second",
    "start": "3529920",
    "end": "3535640"
  },
  {
    "text": "uh let's see if we can go back to the slide just sorry back to the big pictures just so you kind of reconnect",
    "start": "3535640",
    "end": "3541079"
  },
  {
    "text": "to where we are right so we did this we did this we recorded it that was step three now we're doing step four okay so",
    "start": "3541079",
    "end": "3549039"
  },
  {
    "text": "in the step four we go to this client login service the client login service",
    "start": "3549039",
    "end": "3554160"
  },
  {
    "text": "basically it's a simple HTTP request uh it's a post to basically this URL you",
    "start": "3554160",
    "end": "3561200"
  },
  {
    "text": "know www google. accounts you know client login and in that in the post we",
    "start": "3561200",
    "end": "3566960"
  },
  {
    "text": "include these parameters this this these are fixed like this account type equals hosted or Google just put it there you",
    "start": "3566960",
    "end": "3573680"
  },
  {
    "text": "know take it for granted email equals this is your Ro email this is the email that you use when you sign up for c2dm",
    "start": "3573680",
    "end": "3580760"
  },
  {
    "text": "this is the email that was used when your account was basically being uh um you know whatever or when you in step",
    "start": "3580760",
    "end": "3588039"
  },
  {
    "text": "one did the registration you added the sender thing you the password is whatever password you provision with Google the service part this is",
    "start": "3588039",
    "end": "3594760"
  },
  {
    "text": "important we are now here are saying we want to register specific or get an a token that will specifically be used for",
    "start": "3594760",
    "end": "3602000"
  },
  {
    "text": "a2dm Android Cloud device messaging and the source equals it's kind of like a user agent string you can put whatever",
    "start": "3602000",
    "end": "3607480"
  },
  {
    "text": "the heck you want in there and so what we then do you know we format is an HTTP post depending how you do it if you have",
    "start": "3607480",
    "end": "3613839"
  },
  {
    "text": "a client that will do you know all the you know whatever put like a Content length and content type headers for you",
    "start": "3613839",
    "end": "3619799"
  },
  {
    "text": "that's even better and what we then get is some kind of response we hope for a",
    "start": "3619799",
    "end": "3625039"
  },
  {
    "text": "200 response and then and then what we do is we parse that response for a",
    "start": "3625039",
    "end": "3630440"
  },
  {
    "text": "effectively text which is one line which has off equals something and that",
    "start": "3630440",
    "end": "3635599"
  },
  {
    "text": "something is the token that we care about okay this can fail or it can challenge us to do the cture thing which",
    "start": "3635599",
    "end": "3642240"
  },
  {
    "text": "is basically to prove that we're not you know that we're human and this and that but we generally you know hopefully will",
    "start": "3642240",
    "end": "3647920"
  },
  {
    "text": "not have to do that because what we do is we cash this is actually should be bolded we cach this token on the server",
    "start": "3647920",
    "end": "3656839"
  },
  {
    "text": "side okay so for future messages we use it we don't have to go back and reauthenticate we this is like almost a",
    "start": "3656839",
    "end": "3663599"
  },
  {
    "text": "one-time thing periodically you know it may Force us to come back and then we just reauthenticate reauthenticate but",
    "start": "3663599",
    "end": "3669599"
  },
  {
    "text": "it's not the big of a deal so now that we have it now it's a juicy part right",
    "start": "3669599",
    "end": "3675240"
  },
  {
    "text": "all this was just a set up now we want to effectively send messages this is basically why we're doing this in the",
    "start": "3675240",
    "end": "3680640"
  },
  {
    "text": "first place the way we do this is we basically create another http post again",
    "start": "3680640",
    "end": "3686960"
  },
  {
    "text": "from our app server and that post goes to that URL that you see there okay some",
    "start": "3686960",
    "end": "3692000"
  },
  {
    "text": "predetermined URL and that post expects the following parameters okay the",
    "start": "3692000",
    "end": "3697839"
  },
  {
    "text": "parameters are the registration ID well our server knows it because he knows the",
    "start": "3697839",
    "end": "3703039"
  },
  {
    "text": "user so by the way at this point our server is trying to Target a particular application so it should know the",
    "start": "3703039",
    "end": "3709000"
  },
  {
    "text": "registration ID okay the collapse key will explain a little later it's a",
    "start": "3709000",
    "end": "3714160"
  },
  {
    "text": "required parameter I'll explain later on when and how it gets used okay then we",
    "start": "3714160",
    "end": "3719319"
  },
  {
    "text": "can provide a whole bunch of data dot you know name equals value parameters",
    "start": "3719319",
    "end": "3724839"
  },
  {
    "text": "these name equals value become the extras in the intent that you receive on",
    "start": "3724839",
    "end": "3730839"
  },
  {
    "text": "the on the on the on the you know on your app side okay these are arbitrary you don't have to put anything in here",
    "start": "3730839",
    "end": "3736559"
  },
  {
    "text": "if you don't want to but these are arbitrary just name equals values the only limitation is that the colle you",
    "start": "3736559",
    "end": "3742000"
  },
  {
    "text": "know the combined size of the message must not exceed 1024 bytes and then there's",
    "start": "3742000",
    "end": "3747559"
  },
  {
    "text": "another optional parameter called delay while idle and I'll explain later on you'll see how and get that gets used",
    "start": "3747559",
    "end": "3754599"
  },
  {
    "text": "the only other required bit is to basically pass in this authorization header and the authorization header is",
    "start": "3754599",
    "end": "3761480"
  },
  {
    "text": "Google all login space off equals and then your off token this is the thing",
    "start": "3761480",
    "end": "3766680"
  },
  {
    "text": "that we've got in this previous step number five okay that's it we now submit",
    "start": "3766680",
    "end": "3772640"
  },
  {
    "text": "that request we if we get a resp 200 response that has ID equals some number",
    "start": "3772640",
    "end": "3778119"
  },
  {
    "text": "which is not even important because that we can't really corate correlate that ID to anything but we get some kind of",
    "start": "3778119",
    "end": "3783680"
  },
  {
    "text": "response B that's not an error response we're golden okay so there's no as long",
    "start": "3783680",
    "end": "3788839"
  },
  {
    "text": "as there's no error you know error in in the 200 response that means our message was sent out okay at that point there's",
    "start": "3788839",
    "end": "3796000"
  },
  {
    "text": "not much we can do now if you don't mind save your questions until the end just because I know some people have to leave and I want to go through the slides",
    "start": "3796000",
    "end": "3801839"
  },
  {
    "text": "first so um now our message is in the C 2dm front end it was accepted by c2dm",
    "start": "3801839",
    "end": "3807920"
  },
  {
    "text": "front end now what it what it then so we could handle errors and there's all sorts of Errors we can get like CeX",
    "start": "3807920",
    "end": "3814079"
  },
  {
    "text": "seeded device you know CeX seeded this could be like CeX seeded basically you",
    "start": "3814079",
    "end": "3819160"
  },
  {
    "text": "know too many you know messages sent in aggregate or too many messages sent to a particular device um or invalid",
    "start": "3819160",
    "end": "3825720"
  },
  {
    "text": "registration ID or expired registration maybe our app was uninstalled or the",
    "start": "3825720",
    "end": "3830920"
  },
  {
    "text": "user specifically asked to to uninstall it or message too big or missing collapse in case we forgot to include it",
    "start": "3830920",
    "end": "3837119"
  },
  {
    "text": "and I'll explain what collaps key is we may also get a 401 which is which would mean that a client login expired or is",
    "start": "3837119",
    "end": "3844319"
  },
  {
    "text": "was invalid right at this point you know uh that you should go and re reauthenticate with client login okay so",
    "start": "3844319",
    "end": "3851640"
  },
  {
    "text": "you repeat step number five and that's it if the server is busy we may get a",
    "start": "3851640",
    "end": "3857480"
  },
  {
    "text": "503 which will include like a retry after header which means hey don't come",
    "start": "3857480",
    "end": "3862720"
  },
  {
    "text": "back until that time if you do you know Google may you know whatever ban you or",
    "start": "3862720",
    "end": "3868119"
  },
  {
    "text": "somehow other punish you by decreasing your quota or impose a stricter limits okay so you should honor that header my",
    "start": "3868119",
    "end": "3874760"
  },
  {
    "text": "particular code doesn't for sample code doesn't but whatever you should um now",
    "start": "3874760",
    "end": "3880680"
  },
  {
    "text": "step six seven and eight let me just reconnect to what step 6 seven and 8 are so you can see it are basically we do",
    "start": "3880680",
    "end": "3887079"
  },
  {
    "text": "the authentication you know of the token we cue the message we route a deliver for delivery okay those are the steps",
    "start": "3887079",
    "end": "3893599"
  },
  {
    "text": "six seven and eight these are happening in the Cloud so let me just quickly show you uh what those look like so it goes",
    "start": "3893599",
    "end": "3901160"
  },
  {
    "text": "and verifies our or token okay that seems logical it then temporarily cues",
    "start": "3901160",
    "end": "3906960"
  },
  {
    "text": "her message to some kind of a durable store whatever that is okay think of it as a message cue and so these messages",
    "start": "3906960",
    "end": "3913200"
  },
  {
    "text": "are held here until they're either delivered or they expire the expiration is not something we get to control so",
    "start": "3913200",
    "end": "3919880"
  },
  {
    "text": "there's no support for TTL unfortunately at the moment um and it's you know helps with the best effort will automatically",
    "start": "3919880",
    "end": "3926400"
  },
  {
    "text": "retry as necessary if there was now we can kind of come back to the collapse key if",
    "start": "3926400",
    "end": "3932760"
  },
  {
    "text": "there is already a message that's previously been queued which has exactly",
    "start": "3932760",
    "end": "3938200"
  },
  {
    "text": "the same registration ID and the collapse key that message will be replaced so the idea behind the collapse",
    "start": "3938200",
    "end": "3944720"
  },
  {
    "text": "key is let's say your user goes on a on a plane so they put their phone in the",
    "start": "3944720",
    "end": "3949760"
  },
  {
    "text": "in the airplane mode and or they come here and they have no signal right and now they all of a sudden come in into",
    "start": "3949760",
    "end": "3955920"
  },
  {
    "text": "the Zone where they have signal if you've previously sent them a whole bunch of notifications that their",
    "start": "3955920",
    "end": "3961240"
  },
  {
    "text": "friends you know posted some messages to on their profile or something like if it was a Facebook application it doesn't",
    "start": "3961240",
    "end": "3966760"
  },
  {
    "text": "make sense for their application to be tickled you know 50 times if there were 50 posts you only need one tickle right",
    "start": "3966760",
    "end": "3973039"
  },
  {
    "text": "one notification because you just want the the application to go back to your server and fetch all the data right so",
    "start": "3973039",
    "end": "3980000"
  },
  {
    "text": "by having the same collapse key in your messages you ensure that you're effectively replace previous you know",
    "start": "3980000",
    "end": "3988640"
  },
  {
    "text": "not not cached or queed you know notifications for that particular user",
    "start": "3988640",
    "end": "3993720"
  },
  {
    "text": "okay um uh and then finally so what we then do is uh we rout the message to the",
    "start": "3993720",
    "end": "4000400"
  },
  {
    "text": "messaging server which hopefully holds the connection to a device if it's open if it doesn't obviously if it's not open",
    "start": "4000400",
    "end": "4005559"
  },
  {
    "text": "then you know the message stays in the queue and at some Future Point you'll you know re check again so step nine so",
    "start": "4005559",
    "end": "4012680"
  },
  {
    "text": "let's quickly go through this so in Step nine we basically go and uh you know we",
    "start": "4012680",
    "end": "4017839"
  },
  {
    "text": "want to now deliver the message so now the way it works is that we basically first check for whether we should delay",
    "start": "4017839",
    "end": "4024039"
  },
  {
    "text": "the delivery of the message okay this is by the way the messaging servers wanting to deliver the message to our device so",
    "start": "4024039",
    "end": "4029760"
  },
  {
    "text": "it goes and says should we wait now why would we wait well there's basically something called atation which Google",
    "start": "4029760",
    "end": "4036480"
  },
  {
    "text": "automatically implements and you it's not optional you cannot disa this and what it is it effectively prevents our",
    "start": "4036480",
    "end": "4043799"
  },
  {
    "text": "device from getting this constant stream of messages what it will do it will detect if there's a high frequency of",
    "start": "4043799",
    "end": "4050039"
  },
  {
    "text": "messages Target being targeted to a particular particular app and collapse key so registration and collapse key and",
    "start": "4050039",
    "end": "4056559"
  },
  {
    "text": "if there is there these messages May automatically be queed or delayed which",
    "start": "4056559",
    "end": "4062319"
  },
  {
    "text": "will then hopefully if you use same collapse key prevent you know all these messages from being you know streamed to",
    "start": "4062319",
    "end": "4067680"
  },
  {
    "text": "the device you know at some you know very high trate the idea behind this is that we temporarily delay it how",
    "start": "4067680",
    "end": "4074839"
  },
  {
    "text": "temporarily you know it's on order of seconds potentially minutes okay the and we you",
    "start": "4074839",
    "end": "4081440"
  },
  {
    "text": "know the goal is that we prevent spinning up the radio for the delivery of the message for every single message",
    "start": "4081440",
    "end": "4088200"
  },
  {
    "text": "which ultimate goal is protects the battery and if in case our messages are constantly notifying the user you know",
    "start": "4088200",
    "end": "4094480"
  },
  {
    "text": "we potentially are less annoying to our users um so the first few messages are let through and then you know if the con",
    "start": "4094480",
    "end": "4101679"
  },
  {
    "text": "the stream continues at the same rate Google May and this is not well documented as to when or how they decide",
    "start": "4101679",
    "end": "4107640"
  },
  {
    "text": "to do this so don't ask me questions unfortunately about that I can't answer because I don't know um they may",
    "start": "4107640",
    "end": "4113080"
  },
  {
    "text": "basically go and say Hey you know this may have to wait a little and this happens in the cloud on the Google site",
    "start": "4113080",
    "end": "4118838"
  },
  {
    "text": "you may have to wait it's app collapse yes per per per per app which is",
    "start": "4118839",
    "end": "4124640"
  },
  {
    "text": "basically per registration on a particular device okay because I thought app like all the devices for one no",
    "start": "4124640",
    "end": "4130480"
  },
  {
    "text": "sorry it's for for particular yes so it is for so I should actually change it so thanks for po that out okay the other",
    "start": "4130480",
    "end": "4137640"
  },
  {
    "text": "little feature this is controllable by us is something called the lay while idle if you remember that was one of the",
    "start": "4137640",
    "end": "4144000"
  },
  {
    "text": "parameters we could have specified here we just say equals true or equals something and what happens if we do",
    "start": "4144000",
    "end": "4150120"
  },
  {
    "text": "include it is the basically we wait until the device becomes active before",
    "start": "4150120",
    "end": "4155880"
  },
  {
    "text": "we actually send the message now how the heck do we know if the device is active the device because it has this constant",
    "start": "4155880",
    "end": "4161880"
  },
  {
    "text": "connection with Google at all times it automatically tells the connection server when it screen is on if the",
    "start": "4161880",
    "end": "4168758"
  },
  {
    "text": "screen is off maybe you don't care about these messages maybe it doesn't make sense to inform the user who cares right",
    "start": "4168759",
    "end": "4176199"
  },
  {
    "text": "so that's basically if we do include it so there's certain class of applications where we don't care to inform the user",
    "start": "4176199",
    "end": "4181719"
  },
  {
    "text": "if their device is off anyways and it's really just on the the screen being off or on not whether the CPU is off or",
    "start": "4181719",
    "end": "4188920"
  },
  {
    "text": "on and here's finally the message delivery so this is the message now gets",
    "start": "4188920",
    "end": "4194159"
  },
  {
    "text": "sent over the TCP connection that's encrypted to our device something on",
    "start": "4194159",
    "end": "4199360"
  },
  {
    "text": "their device gets the message okay some kind of a service which is actually this thing well actually it's not necessarily",
    "start": "4199360",
    "end": "4205800"
  },
  {
    "text": "this thing this thing goes and pushes the message I just basically scan for what sends the broadcast message and",
    "start": "4205800",
    "end": "4211360"
  },
  {
    "text": "this is basically some Google built-in thing okay and so what it does and this code is just kind of you know it's not",
    "start": "4211360",
    "end": "4220239"
  },
  {
    "text": "real code I mean I invented this I kind of just based on what I expeced them to do I haven't actually I don't have access to their source code but what",
    "start": "4220239",
    "end": "4226080"
  },
  {
    "text": "they do is they build its receive intent in the intent they add category that",
    "start": "4226080",
    "end": "4231600"
  },
  {
    "text": "targets our particular application and then they put all of our data so if we had like data. f equals",
    "start": "4231600",
    "end": "4238520"
  },
  {
    "text": "bar that becomes f equals bar as an extra field okay and so all of our data gets put in here and then they go and",
    "start": "4238520",
    "end": "4245400"
  },
  {
    "text": "send a broadcast which is with our intent but in the broadcast they create a special permission which is our app",
    "start": "4245400",
    "end": "4253440"
  },
  {
    "text": "plus permission plus c2dm message This Is How They ensure that only our app gets the message otherwise other",
    "start": "4253440",
    "end": "4259840"
  },
  {
    "text": "apps May intercept your messages and they can do whatever they want with them okay so if you remember you know well",
    "start": "4259840",
    "end": "4265280"
  },
  {
    "text": "again my slides are available online so you can see go back to the Android manifest XML to see kind of what this looks like okay so this is how we target",
    "start": "4265280",
    "end": "4273280"
  },
  {
    "text": "our particular receiver um receiver now how do we receive the message this is we're almost done okay we basically the",
    "start": "4273280",
    "end": "4280520"
  },
  {
    "text": "first thing is we're going to need to go back to our server when we receive the message the problem is while our device",
    "start": "4280520",
    "end": "4287760"
  },
  {
    "text": "will be woken up okay if when this message comes in the message will only",
    "start": "4287760",
    "end": "4295440"
  },
  {
    "text": "device will be available to us as long as we are in the on received method of the broadcast receiver after the",
    "start": "4295440",
    "end": "4301600"
  },
  {
    "text": "unreceived method is done our device may very well go to sleep in which case us going and fetching the data from the",
    "start": "4301600",
    "end": "4308000"
  },
  {
    "text": "server will not happen so what we need is to grab a wake clck if you don't know",
    "start": "4308000",
    "end": "4313040"
  },
  {
    "text": "what lake wake locks are you know read them go you know to power manager you'll understand it fair it's they're not that",
    "start": "4313040",
    "end": "4318840"
  },
  {
    "text": "complicated so what we do is we basically I created something called a custom application class that basically",
    "start": "4318840",
    "end": "4325360"
  },
  {
    "text": "creates an instance of a and of course it seems that I didn't actually declare the way clock so this is missing",
    "start": "4325360",
    "end": "4332080"
  },
  {
    "text": "actually the Declaration but there's basically some kind of a you know wake clck which we go and fetch from this",
    "start": "4332080",
    "end": "4337560"
  },
  {
    "text": "power manager and we provide methods here for acquire and release and this",
    "start": "4337560",
    "end": "4342960"
  },
  {
    "text": "also checks for if the the Wake lock is only already killed it just returns false as opposed to try to reacquire you",
    "start": "4342960",
    "end": "4349120"
  },
  {
    "text": "know wouldn't work anyways okay so you'll see in a moment how we use this",
    "start": "4349120",
    "end": "4355480"
  },
  {
    "text": "so here's basically us processing the message here's the broadcast receiver that actually gets triggered by C to DM",
    "start": "4355480",
    "end": "4361960"
  },
  {
    "text": "this is the final part right we get the on received method gets invoked we check for whether the action",
    "start": "4361960",
    "end": "4369360"
  },
  {
    "text": "is you know receive action that's the one that we're now interested in we can now go and fetch all of our you know",
    "start": "4369360",
    "end": "4376280"
  },
  {
    "text": "extras like our you know f one F two whatever we need to fetch if they mean something to us if there are no extras",
    "start": "4376280",
    "end": "4382920"
  },
  {
    "text": "who cares now what we do is we grab a reference to our app object which we",
    "start": "4382920",
    "end": "4388960"
  },
  {
    "text": "have implicit reference to is the way Android works okay and through the WB object we try to acquire the W clock if",
    "start": "4388960",
    "end": "4396760"
  },
  {
    "text": "the W clock doesn't if we can't get it it means that we already running this code so we don't want to do it again",
    "start": "4396760",
    "end": "4403560"
  },
  {
    "text": "okay so all only if this works we actually go and acquire the way we then build an intent which",
    "start": "4403560",
    "end": "4410960"
  },
  {
    "text": "basically runs our service which will then refresh the data remember we cannot",
    "start": "4410960",
    "end": "4417320"
  },
  {
    "text": "go back to our server to fetch the most up-to-date data in the on receive method because it's an expensive operation and",
    "start": "4417320",
    "end": "4423719"
  },
  {
    "text": "then you cannot do that from the broadcast receiver so again we go back to service maybe we pass some some kind",
    "start": "4423719",
    "end": "4429840"
  },
  {
    "text": "of a you know information to our service if that's of relevance to our service most likely wouldn't be but let's say",
    "start": "4429840",
    "end": "4435560"
  },
  {
    "text": "there is and now the final part is we basically in our service if we needed to",
    "start": "4435560",
    "end": "4441880"
  },
  {
    "text": "we grab our f one if that means something to us we go to our server back to our server via an HTTP get or or",
    "start": "4441880",
    "end": "4449800"
  },
  {
    "text": "whatever however you want to go to your server right so simple HTP request and you get your data and maybe you store it",
    "start": "4449800",
    "end": "4455400"
  },
  {
    "text": "to a local database in sqi database or something like that and then finally you release the W one and at that point your",
    "start": "4455400",
    "end": "4462639"
  },
  {
    "text": "device may go to sleep of course you could in here do notifications you can",
    "start": "4462639",
    "end": "4468199"
  },
  {
    "text": "put toasts you could launch activities not that you should but you know you could do all sorts of things inside of",
    "start": "4468199",
    "end": "4473960"
  },
  {
    "text": "that on Handler request and again this is one of those intent Services okay so I know we're one minute",
    "start": "4473960",
    "end": "4481320"
  },
  {
    "text": "over but let's wrap it up so the final part is acknowledging the delivery this happens automatically as soon as the",
    "start": "4481320",
    "end": "4488040"
  },
  {
    "text": "message is acknowledged by the device it goes back to Google Google says oh we got it removes it from the from the from",
    "start": "4488040",
    "end": "4494239"
  },
  {
    "text": "the message Q now you know that's it so here it says you know it's easy as 0 to",
    "start": "4494239",
    "end": "4500080"
  },
  {
    "text": "10 seems not that easy but in reality all of this is boiler plate you do this",
    "start": "4500080",
    "end": "4507440"
  },
  {
    "text": "once right and yes it's involves a little bit of setup but it's not that",
    "start": "4507440",
    "end": "4512840"
  },
  {
    "text": "complicated right I mean actually there's more complexity on the server side than on the client side so it's",
    "start": "4512840",
    "end": "4518199"
  },
  {
    "text": "fairly easy to follow okay um if you want to go back to sending more messages",
    "start": "4518199",
    "end": "4524719"
  },
  {
    "text": "you you already have the registration ID you already have the off token you just repeat steps you know five five and",
    "start": "4524719",
    "end": "4531800"
  },
  {
    "text": "effectively Google does everything else so it's super easy you may have to worry about you know if this fails with a 401",
    "start": "4531800",
    "end": "4538159"
  },
  {
    "text": "you may need to reauthenticate if this fails with Cod exceeded or 503 you may need to back off so then potentially and",
    "start": "4538159",
    "end": "4545679"
  },
  {
    "text": "this is the hard part potentially you on the server side may need to build a message queue right in case your you",
    "start": "4545679",
    "end": "4552920"
  },
  {
    "text": "know your your messages aren't being accepted by the by by the Google servers so that you can you can do your own you",
    "start": "4552920",
    "end": "4558600"
  },
  {
    "text": "know retries um and if you want to unregister should you need to you basically",
    "start": "4558600",
    "end": "4564000"
  },
  {
    "text": "unregister through an intent that also goes back to your receiver the same thing fires you now just get unregister",
    "start": "4564000",
    "end": "4570000"
  },
  {
    "text": "and you unreg you go back to your server and un register if you need to um so in",
    "start": "4570000",
    "end": "4575120"
  },
  {
    "text": "summary you know we want to keep the data fresh polling sucks don't use it we",
    "start": "4575120",
    "end": "4581000"
  },
  {
    "text": "want to use push SMS is okay but expensive we we don't we could roll our own persistent connection but that's",
    "start": "4581000",
    "end": "4587440"
  },
  {
    "text": "hard and you know and expensive um c2dm is free um we already leverage what's",
    "start": "4587440",
    "end": "4594120"
  },
  {
    "text": "already there right we can am amortize this one existing connection Google already has across a range of these apps",
    "start": "4594120",
    "end": "4601000"
  },
  {
    "text": "so you know it's much better battery experience or battery life and therefore user experience on the devices um and",
    "start": "4601000",
    "end": "4607560"
  },
  {
    "text": "you know we get these Advanced features like donation you know delay while idle",
    "start": "4607560",
    "end": "4613239"
  },
  {
    "text": "collapse keys and so on and so on the only problem is still in Labs not quite",
    "start": "4613239",
    "end": "4618440"
  },
  {
    "text": "clear on what the terms are so thank you for uh for listening hopefully you learn",
    "start": "4618440",
    "end": "4623880"
  },
  {
    "text": "something um I'll stay around in case you guys have any questions I know some of you want to leave if you want to get",
    "start": "4623880",
    "end": "4629360"
  },
  {
    "text": "these slides as as well as well as the sample code that includes a complete app",
    "start": "4629360",
    "end": "4635280"
  },
  {
    "text": "which I'll explain more I need to actually update this this uh documentation so complete app it",
    "start": "4635280",
    "end": "4640880"
  },
  {
    "text": "includes a server side component everything and it works you can test it out go to that URL for other videos and",
    "start": "4640880",
    "end": "4648600"
  },
  {
    "text": "stuff on Android check out our tech TV so thank you",
    "start": "4648600",
    "end": "4654520"
  },
  {
    "text": "guys",
    "start": "4660400",
    "end": "4663400"
  }
]