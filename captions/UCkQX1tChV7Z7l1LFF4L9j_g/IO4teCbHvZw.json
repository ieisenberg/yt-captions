[
  {
    "start": "0",
    "end": "44000"
  },
  {
    "text": "good afternoon uh thanks for coming to the talk how are you do you like the conference so",
    "start": "4600",
    "end": "11240"
  },
  {
    "text": "far that's weak that's weak more energy do you like the conference so",
    "start": "11240",
    "end": "17039"
  },
  {
    "text": "far now we are talking I know all of you are waiting for lunch so we'll get through this",
    "start": "17039",
    "end": "23320"
  },
  {
    "text": "quickly uh let's get to the important questions first sir what's the lunch menu",
    "start": "23320",
    "end": "30679"
  },
  {
    "text": "it's fine okay all right uh so let's begin uh I'm suchin I lead the video",
    "start": "30679",
    "end": "36640"
  },
  {
    "text": "infra team at Facebook uh the mission for video infra is to make videos and live successful so let's look at what we",
    "start": "36640",
    "end": "43800"
  },
  {
    "text": "actually work on we build an infra that powers the entire uh Facebook video platform we",
    "start": "43800",
    "end": "50760"
  },
  {
    "start": "44000",
    "end": "44000"
  },
  {
    "text": "work on a number of large projects a few examples here we try to make our video uploads",
    "start": "50760",
    "end": "57359"
  },
  {
    "text": "really fast and reliable everybody likes fast everybody likes reliable straightforward we cluster similar",
    "start": "57359",
    "end": "64080"
  },
  {
    "text": "videos together so we can show them in related videos and then rank them better we have built a distributed video",
    "start": "64080",
    "end": "71040"
  },
  {
    "text": "encoding platform where we take a large video file break it up into chunks process it separately encode it in",
    "start": "71040",
    "end": "77360"
  },
  {
    "text": "parallel then put it back together this results in very low latency in transcoding videos again everybody loves",
    "start": "77360",
    "end": "84479"
  },
  {
    "text": "fast not a problem and we build the infra for Facebook live and we will we",
    "start": "84479",
    "end": "90040"
  },
  {
    "text": "talk a lot about Facebook live today raise your hand if you have not used Facebook",
    "start": "90040",
    "end": "96320"
  },
  {
    "text": "live no lunch for you guys all right so super easy to use",
    "start": "96320",
    "end": "102840"
  },
  {
    "text": "we'll go through what live is uh and you guys can try it out uh maybe even while the talk is going on that's fine",
    "start": "102840",
    "end": "109719"
  },
  {
    "text": "too let's talk scale 1.23 billion people access",
    "start": "109719",
    "end": "116520"
  },
  {
    "text": "Facebook each day not in the month not in the year every day 1.23",
    "start": "116520",
    "end": "123039"
  },
  {
    "text": "billion let's put that in perspective the world has about 7 billion people",
    "start": "123039",
    "end": "129280"
  },
  {
    "text": "many of them don't have access to the internet so out of the people that have access to Internet a very large number",
    "start": "129280",
    "end": "136720"
  },
  {
    "text": "access Facebook each day and we consider this a huge responsibility we have to make sure these people get the best",
    "start": "136720",
    "end": "143080"
  },
  {
    "text": "experience possible and we figure out ways to connect allow them to connect to other people across the world in new and",
    "start": "143080",
    "end": "149519"
  },
  {
    "text": "interesting ways and that is where live comes in Facebook live is a live streaming",
    "start": "149519",
    "end": "157120"
  },
  {
    "text": "platform that enables people to broadcast live video streams using just the Facebook mobile app iOS Android we",
    "start": "157120",
    "end": "164760"
  },
  {
    "text": "also have desktop apps and you can go live using a live API if you're a professional using your own encoder so",
    "start": "164760",
    "end": "172680"
  },
  {
    "text": "this enables people to share everyday moments with their friends and followers this allows celebrities to uh reach out",
    "start": "172680",
    "end": "180159"
  },
  {
    "text": "to their fans directly and this also encourages citizen journalism ever since we launched live",
    "start": "180159",
    "end": "186640"
  },
  {
    "text": "to the public we have seen the uptake has been excellent and we love that so",
    "start": "186640",
    "end": "191840"
  },
  {
    "text": "why is life different than just uploading a normal video well the key difference is if",
    "start": "191840",
    "end": "199080"
  },
  {
    "text": "you're uploading a video it could be well-crafted it could be photoshopped with live there is none of that you are",
    "start": "199080",
    "end": "205120"
  },
  {
    "text": "sharing the moment as it is happening that authenticity is what different it's live from just uploading",
    "start": "205120",
    "end": "211239"
  },
  {
    "text": "a normal video the second thing is live is inherently social there is a lot of",
    "start": "211239",
    "end": "217239"
  },
  {
    "text": "interaction people are commenting asking questions while the live stream is going on this way the commenters and viewers",
    "start": "217239",
    "end": "225400"
  },
  {
    "text": "can actually change the direction of the live stream they can ask you to go to something else while the live stream is",
    "start": "225400",
    "end": "231120"
  },
  {
    "text": "going on and so that social nature makes this powerful as well and so the",
    "start": "231120",
    "end": "236799"
  },
  {
    "text": "interactivity the authenticity and sort of sharing the moment as it is happening are the key things that make life",
    "start": "236799",
    "end": "242519"
  },
  {
    "text": "special and different than just normal videos so let's look at the history",
    "start": "242519",
    "end": "249079"
  },
  {
    "text": "where did we start and where are we now it all started in April 2015 in a",
    "start": "249079",
    "end": "257199"
  },
  {
    "text": "hackathon for those of you that are not familiar hackathons are Facebook uh are",
    "start": "257199",
    "end": "262400"
  },
  {
    "text": "almost a near religious event uh people from different teams and disciplines get together to build something new to hack",
    "start": "262400",
    "end": "268919"
  },
  {
    "text": "on things and to to be creative we generally ask people that they should not spend time in hackathon",
    "start": "268919",
    "end": "275280"
  },
  {
    "text": "doing something related to their D job you what's the point right uh and so in",
    "start": "275280",
    "end": "280800"
  },
  {
    "text": "this haathon a group of us got together and we wanted to build a live streaming back",
    "start": "280800",
    "end": "286000"
  },
  {
    "text": "end so this is a photo a two or three software Engineers one production engineer uh TPM and so",
    "start": "286000",
    "end": "293160"
  },
  {
    "text": "on this hack was called hack Under the Stars it was held on the rooftop garden",
    "start": "293160",
    "end": "299240"
  },
  {
    "text": "of Fe books headquarters in Meno Park California uh we worked on it for a couple of days uh one or two",
    "start": "299240",
    "end": "305479"
  },
  {
    "text": "nights the first live stream that went through our system it's very special to",
    "start": "305479",
    "end": "310960"
  },
  {
    "text": "us and you can tell being the Geeks we are we live",
    "start": "310960",
    "end": "316080"
  },
  {
    "text": "stream the clock nothing interesting just the clock now why the clock we wanted to measure",
    "start": "316080",
    "end": "322000"
  },
  {
    "text": "the end to end latency so you live stream a clock and then view it and then you can you can see the difference",
    "start": "322000",
    "end": "328360"
  },
  {
    "text": "perfect right this is what we are we are gigs that's what we do and so remember",
    "start": "328360",
    "end": "333440"
  },
  {
    "text": "people keep talking about the first phone call ever made and the discussion was Mr Watson please come here I need",
    "start": "333440",
    "end": "339800"
  },
  {
    "text": "you well if live ever becomes that big remember 10:03 p.m. end to end latency this is what people are doing on the",
    "start": "339800",
    "end": "345800"
  },
  {
    "text": "first live stream ever uh so we started with the haathon a few months later we",
    "start": "345800",
    "end": "351360"
  },
  {
    "text": "launched it to celebrities Dwayne Johnson uh the Hollywood action hero was our launch",
    "start": "351360",
    "end": "357960"
  },
  {
    "text": "partner he gave us a really good would start and so from hackathon to launching it to celebrities using the mentions app",
    "start": "357960",
    "end": "364120"
  },
  {
    "text": "it was 4 months so we moved really quickly in launching this since then we have had many",
    "start": "364120",
    "end": "371080"
  },
  {
    "text": "memorable live streams uh that I can remember and I'll share a bunch of them throughout the presentation with you",
    "start": "371080",
    "end": "376479"
  },
  {
    "text": "folks there have also been a few that were a little bit haunting like the one from the comedian",
    "start": "376479",
    "end": "382720"
  },
  {
    "text": "Ricky jeris where he went live from his bathtub I did not need to see that come",
    "start": "382720",
    "end": "387880"
  },
  {
    "text": "on right okay uh so mentions happened then",
    "start": "387880",
    "end": "393160"
  },
  {
    "text": "we launch it to users you will see about uh 20 folks here again software Engineers production Engineers uh",
    "start": "393160",
    "end": "399080"
  },
  {
    "text": "designers and so on WE launch it to us this in December 2015 and the three uh",
    "start": "399080",
    "end": "404720"
  },
  {
    "text": "screenshots you see are the initial version of live uh it's not still it's substantially the same uh even now so",
    "start": "404720",
    "end": "412160"
  },
  {
    "text": "again hackathon where we had nothing we started from zero to launching it to all users 8 months and again everything we",
    "start": "412160",
    "end": "418599"
  },
  {
    "text": "launch on the app has to work at scale has to work for those 1.23 billion users who want to use it every single day so",
    "start": "418599",
    "end": "425879"
  },
  {
    "text": "this was a tremendous experience we loved this uh but then that brings us to",
    "start": "425879",
    "end": "431000"
  },
  {
    "text": "why Al like why did we build this in the first place three big reasons engagement most things we do",
    "start": "431000",
    "end": "439639"
  },
  {
    "text": "relate to whether people are going to like this and whether they would use this and does this add value to their",
    "start": "439639",
    "end": "445680"
  },
  {
    "text": "lives when we launched live to users it was clear that we had created something magical",
    "start": "445680",
    "end": "451680"
  },
  {
    "text": "and Powerful the engagement was really good the uptake was good and so we knew we had something on our hands and it it",
    "start": "451680",
    "end": "458280"
  },
  {
    "text": "was worth investing more time and energy into the second reason was public",
    "start": "458280",
    "end": "464759"
  },
  {
    "text": "profiles we wanted celebrities and public figures to have a way to reach out to their fans",
    "start": "464759",
    "end": "471560"
  },
  {
    "text": "directly so here we have wind diesel another Hollywood action hero you'll start seeing a pattern I like explosions",
    "start": "471879",
    "end": "478000"
  },
  {
    "text": "action that kind of thing uh wind diesel goes live fairly frequently that's good",
    "start": "478000",
    "end": "483759"
  },
  {
    "text": "he can reach out to his fans uh his live streams are pretty engaging we have folks like Oprah who go live comedians",
    "start": "483759",
    "end": "491039"
  },
  {
    "text": "like Kevin Hart uh use the platform president Oma when he was in the office",
    "start": "491039",
    "end": "496360"
  },
  {
    "text": "uh used to use live now I think he's busy uh surfing in the Caribbean somewhere uh so don't see live streams",
    "start": "496360",
    "end": "502440"
  },
  {
    "text": "from him anymore and the third something that goes uh to the core of Facebook's",
    "start": "502440",
    "end": "508280"
  },
  {
    "text": "mission is connecting the world we care a lot about making the world more open and connected giving people a voice and",
    "start": "508280",
    "end": "514560"
  },
  {
    "text": "sharing different perspectives that are hard to come by in any other medium so here's an example of uh some",
    "start": "514560",
    "end": "521200"
  },
  {
    "text": "person taking a live stream of what refugees have to go through uh to get to",
    "start": "521200",
    "end": "526279"
  },
  {
    "text": "a better place to have a better home to lead a better life usually the perspectives like these we only get from",
    "start": "526279",
    "end": "533240"
  },
  {
    "text": "the lens of a media house but here you have just a normal person who could go give you that perspective I think this",
    "start": "533240",
    "end": "539640"
  },
  {
    "text": "is very powerful and this was sort of one of the third reasons why we decided to do",
    "start": "539640",
    "end": "545399"
  },
  {
    "text": "live all right we have talked about what is live why we did it uh and the history",
    "start": "545399",
    "end": "550920"
  },
  {
    "text": "of it now let's get into the guts of the",
    "start": "550920",
    "end": "555839"
  },
  {
    "text": "infra we'll talk about eight different sections uh high level architecture and then we'll go deeper into each section",
    "start": "556440",
    "end": "563560"
  },
  {
    "text": "we'll talk about the scaling challenges I will quickly Breeze through protocols and CeX because I know most",
    "start": "563560",
    "end": "569360"
  },
  {
    "text": "most folks here uh don't spend day and night thinking about protocols and video sizes and resolutions so we'll just",
    "start": "569360",
    "end": "574800"
  },
  {
    "text": "Breeze through that then we'll talk about stream inje stream processing and Playback we will go through a couple of",
    "start": "574800",
    "end": "581800"
  },
  {
    "text": "reliabity challenges and some interesting solutions that we came up with and then we'll quickly touch on new",
    "start": "581800",
    "end": "587000"
  },
  {
    "text": "features that are being launched and the lessons that we learned throughout this and again we have live streams",
    "start": "587000",
    "end": "592279"
  },
  {
    "text": "throughout the presentation let's talk high level architecture it all starts with a",
    "start": "592279",
    "end": "598200"
  },
  {
    "text": "broadcast client let's say I want to start a live stream from",
    "start": "598200",
    "end": "603560"
  },
  {
    "text": "here I will my phone uh will create rtmps stream rtmps stands for realtime",
    "start": "603560",
    "end": "610000"
  },
  {
    "text": "messaging protocol s is secure and it will connect to a pop a pop is a point",
    "start": "610000",
    "end": "615120"
  },
  {
    "text": "of presence which is basically a rack of hosts that Facebook owns uh and so it'll",
    "start": "615120",
    "end": "621560"
  },
  {
    "text": "connect to a pop the pop will then forward the connection to a full data",
    "start": "621560",
    "end": "626839"
  },
  {
    "text": "center where encoding can happen so we we create different bit rates different resolutions for a given",
    "start": "626839",
    "end": "632680"
  },
  {
    "text": "stream from there it goes to different pops and so it can go to the playback",
    "start": "632680",
    "end": "638839"
  },
  {
    "text": "clients so if I'm doing the live stream from here I will connect to a pop close to me if people in India and the US are",
    "start": "638839",
    "end": "646160"
  },
  {
    "text": "viewing they'll connect with pops closest to them and we make sure that full pipe uh keeps working with super",
    "start": "646160",
    "end": "651880"
  },
  {
    "text": "low latency latency is actually very important and I'll go into why uh",
    "start": "651880",
    "end": "657279"
  },
  {
    "text": "soon given the network B required for showing all these live streams to the",
    "start": "657279",
    "end": "662600"
  },
  {
    "text": "world we can't just live with our own CDN we also depend on thirdparty CDN uh",
    "start": "662600",
    "end": "668600"
  },
  {
    "text": "to make this work all right let's talk about resource usage compute is a primary resource we",
    "start": "668600",
    "end": "677120"
  },
  {
    "text": "require CPU and compute for Co encoding and decoding streams and for analysis of",
    "start": "677120",
    "end": "682399"
  },
  {
    "text": "media the amount of compute required also depends on number of streams being processed number of encodings we create",
    "start": "682399",
    "end": "689320"
  },
  {
    "text": "the bit rate the resolution Etc we require memory for uncoding and",
    "start": "689320",
    "end": "695040"
  },
  {
    "text": "decoding streams again depends on the bit rates and the resolutions uh more encodings more",
    "start": "695040",
    "end": "702560"
  },
  {
    "text": "memory once a live stream is done we give people the option to store it as a",
    "start": "702560",
    "end": "708160"
  },
  {
    "text": "normal video so they can watch it over and over again they can share it with their near and dear ones and so if they",
    "start": "708160",
    "end": "715000"
  },
  {
    "text": "choose to pick that option then we store it in our long-term storage if they deleted it then it goes away from the",
    "start": "715000",
    "end": "722680"
  },
  {
    "text": "storage and then Network the network required for uploads is not significant",
    "start": "722680",
    "end": "728560"
  },
  {
    "text": "but the network bandid required for playing back a given stream is",
    "start": "728560",
    "end": "733720"
  },
  {
    "text": "significant all right let's look at three scaling challenges that we ran into and then how we solve",
    "start": "734279",
    "end": "741480"
  },
  {
    "text": "them so I've simplified the architecture into three broad pieces the broadcast",
    "start": "741519",
    "end": "746639"
  },
  {
    "text": "clients which is ingest encoding servers which is processing of live streams and then play back",
    "start": "746639",
    "end": "754000"
  },
  {
    "start": "754000",
    "end": "754000"
  },
  {
    "text": "Lance challenge number one was how to deal with number of concurrent uni",
    "start": "754279",
    "end": "760320"
  },
  {
    "text": "streams initially it looked uh to be a tricky challenge but then we",
    "start": "760320",
    "end": "765399"
  },
  {
    "text": "realized this has a nice pattern during the day we get a spike",
    "start": "765399",
    "end": "770680"
  },
  {
    "text": "and then towards the evening or night it goes down because the pattern is predictable we can plan resources",
    "start": "770680",
    "end": "777959"
  },
  {
    "text": "accordingly we we still have to make some key decisions correctly we have to pick an injest protocol that allows us",
    "start": "777959",
    "end": "784120"
  },
  {
    "text": "to work across different kinds of networks it could be cellular networks Wi-Fi and so on it should also be",
    "start": "784120",
    "end": "790160"
  },
  {
    "text": "something that can take advantage of Facebook's Network infrastructure that is spread through the world and we have to plan network",
    "start": "790160",
    "end": "797639"
  },
  {
    "text": "capacity and server side encoding capacity for all these streams the Second Challenge was the",
    "start": "797639",
    "end": "805079"
  },
  {
    "start": "803000",
    "end": "803000"
  },
  {
    "text": "total number of viewers of all streams together turns out this also has a predictable",
    "start": "805079",
    "end": "812480"
  },
  {
    "text": "pattern it is slightly less predictable than the previous one but there is still a reasonable pattern that we can work",
    "start": "812480",
    "end": "819279"
  },
  {
    "text": "around the things that we had to pick correctly were delivery protocol which had to take advantage of Facebook's",
    "start": "819279",
    "end": "826000"
  },
  {
    "text": "network inra uh once again the protocols could be different on the injection side and the delivery side network capacity requirements here",
    "start": "826000",
    "end": "833639"
  },
  {
    "text": "are uh huge and so we have to deal with that with CDN and so on and caching is extremely",
    "start": "833639",
    "end": "839800"
  },
  {
    "text": "important so at this point we were thinking everything seems to be going well like everything has a nice little",
    "start": "839800",
    "end": "845680"
  },
  {
    "text": "pattern we can plan resources everything works well and then just got",
    "start": "845680",
    "end": "851519"
  },
  {
    "text": "real right this is how life works every single time uh and I know some people don't",
    "start": "851519",
    "end": "859320"
  },
  {
    "text": "like nerdy jokes so here's a non- nerdy one for you right uh so this was the",
    "start": "859320",
    "end": "864959"
  },
  {
    "text": "third problem uh that caused us to think a lot about how to solve this the maximum number of viewers of a single",
    "start": "864959",
    "end": "871759"
  },
  {
    "start": "866000",
    "end": "866000"
  },
  {
    "text": "stream now why is this hard because it is unpredictable unpredictability is the",
    "start": "871759",
    "end": "878399"
  },
  {
    "text": "bane of engineering if you can't predict something you can't plan for it it becomes really hard to solve and so",
    "start": "878399",
    "end": "886160"
  },
  {
    "text": "streams could go viral live streams could go viral without any heads up like it is hard for us to know which stream",
    "start": "886160",
    "end": "891839"
  },
  {
    "text": "is going to viral at what point and why because we can't answer that question solving this problem became a",
    "start": "891839",
    "end": "899519"
  },
  {
    "text": "kind of hard and so we had to deal with caching and stream distribution to solve this",
    "start": "899519",
    "end": "904759"
  },
  {
    "text": "reasonably about 105 slides down we will talk about the architecture on the playback side and then I'll explain how",
    "start": "904759",
    "end": "910880"
  },
  {
    "text": "we dealt with this kind of a problem so if I was to summarize how is",
    "start": "910880",
    "end": "917120"
  },
  {
    "start": "914000",
    "end": "914000"
  },
  {
    "text": "Facebook live video different compared to just normal video these were the four",
    "start": "917120",
    "end": "922519"
  },
  {
    "text": "challenges for the Netflix's of the world you already know your content ahead of time so you can cash it in",
    "start": "922519",
    "end": "929920"
  },
  {
    "text": "different parts of uh wherever your CN and pops are but for live content there is no pre-caching the content is getting",
    "start": "929920",
    "end": "937319"
  },
  {
    "text": "created right then we cannot predict that content ahead of time so you can't",
    "start": "937319",
    "end": "943560"
  },
  {
    "text": "pre-cache predicting number of viewers of any stream is not possible for a premium content like if",
    "start": "943600",
    "end": "950519"
  },
  {
    "text": "Netflix is going to launch house of cards they know based on last year roughly how many people would see it we",
    "start": "950519",
    "end": "955600"
  },
  {
    "text": "cannot because random streams become popular and we cannot predict which stream would go popular when and so planning for some of these",
    "start": "955600",
    "end": "962880"
  },
  {
    "text": "Live Events and scaling resources based on that uh is",
    "start": "962880",
    "end": "967920"
  },
  {
    "text": "problematic and then we talked about predicting the concurrent spikes uh which are hard to do so these four",
    "start": "967920",
    "end": "974199"
  },
  {
    "text": "reasons why Facebook live video is very different and harder to solve let's quickly talk through",
    "start": "974199",
    "end": "981199"
  },
  {
    "text": "protocols and CeX there were many requirements but these four turned out to be the most",
    "start": "981199",
    "end": "986480"
  },
  {
    "start": "983000",
    "end": "983000"
  },
  {
    "text": "important time to production we wanted to go from",
    "start": "986480",
    "end": "991519"
  },
  {
    "text": "zero just the hackathon to production in four months and to all users in 8 months this was a very tight timeline so time",
    "start": "991519",
    "end": "998480"
  },
  {
    "text": "to production was very important this man we had to take advantage of everything Facebook had to offer Network",
    "start": "998480",
    "end": "1004639"
  },
  {
    "text": "infra common libraries everything you can't build a full system from scratch and scale it to a billion users in8",
    "start": "1004639",
    "end": "1010079"
  },
  {
    "text": "months just not possible end to end latency matters a",
    "start": "1010079",
    "end": "1015600"
  },
  {
    "text": "lot to live streaming once you buffer and you batch things up interactivity is",
    "start": "1015600",
    "end": "1022399"
  },
  {
    "text": "gone we like the latency to be sub 30 seconds for every stream ideally in",
    "start": "1022399",
    "end": "1027918"
  },
  {
    "text": "single digit seconds with that kind of a goal you cannot have too many buffers",
    "start": "1027919",
    "end": "1033678"
  },
  {
    "text": "throughout your pipeline because every time you buffer you're adding a few seconds of latency and that adds up very",
    "start": "1033679",
    "end": "1040480"
  },
  {
    "text": "quickly if you have latency then it is no longer live we want to actually be even faster than uh Network TV and so on",
    "start": "1040480",
    "end": "1048038"
  },
  {
    "text": "so and and latency matters a lot this because this was going to be part of the Facebook's apps there was a limit on how",
    "start": "1048039",
    "end": "1055360"
  },
  {
    "text": "much we can add to the application size the budget given to us was less than 500",
    "start": "1055360",
    "end": "1062080"
  },
  {
    "text": "KB so let's look at the protocols that we uh considered and which one we",
    "start": "1062520",
    "end": "1068360"
  },
  {
    "text": "picked we looked at web RTC which is based off of UDP which meant it was not",
    "start": "1068360",
    "end": "1074039"
  },
  {
    "text": "compatible with Facebook's Network infra which is tuned for TCP and so we eliminated",
    "start": "1074039",
    "end": "1080480"
  },
  {
    "text": "that HTTP upload would have resulted in a uh horrendous end2end latency not",
    "start": "1080480",
    "end": "1086600"
  },
  {
    "text": "going to work we thought about building our own custom protocols which are optimized for",
    "start": "1086600",
    "end": "1092360"
  },
  {
    "text": "live buil for live time to production was a problem we",
    "start": "1092360",
    "end": "1098000"
  },
  {
    "text": "would have to write our own client libraries our own server libraries tune them well and then launch it to all apps",
    "start": "1098000",
    "end": "1104760"
  },
  {
    "text": "uh unlikely this would have worked in the time frame that we were offered we looked at some propriety protocols",
    "start": "1104760",
    "end": "1111039"
  },
  {
    "text": "which are built for uh use cases like these their application size was a couple of",
    "start": "1111039",
    "end": "1116919"
  },
  {
    "text": "megabytes uh beyond our budget of 500 KB so we couldn't pick that rtmp satisfied",
    "start": "1116919",
    "end": "1123480"
  },
  {
    "text": "all four requirements rtmp realtime messaging protocol is built for uh video streaming",
    "start": "1123480",
    "end": "1130320"
  },
  {
    "text": "so it had the right latency characteristics this is widely used in the industry so there were client",
    "start": "1130320",
    "end": "1136240"
  },
  {
    "text": "libraries and server libraries that we could reuse which meant time to production was reasonable rtmp works over TCP so this",
    "start": "1136240",
    "end": "1145520"
  },
  {
    "text": "is compatible with Facebook's Network infra and the library size was about 100",
    "start": "1145520",
    "end": "1151200"
  },
  {
    "text": "kilobytes much below our budget so great this worked out we picked rtmp and this",
    "start": "1151200",
    "end": "1156360"
  },
  {
    "text": "has worked really well the four encoding properties that",
    "start": "1156360",
    "end": "1162080"
  },
  {
    "start": "1159000",
    "end": "1159000"
  },
  {
    "text": "people need to usually care about when doing something like this or aspect ratio the product requirement was 1 is",
    "start": "1162080",
    "end": "1168039"
  },
  {
    "text": "to one that was very straightforward on the resolution we started with 720 by",
    "start": "1168039",
    "end": "1174120"
  },
  {
    "text": "720 as we launched to users all over the world we realized people may not have",
    "start": "1174120",
    "end": "1180760"
  },
  {
    "text": "enough bandwidth to upload this kind of content continuously we didn't want",
    "start": "1180760",
    "end": "1185919"
  },
  {
    "text": "people to have Jitters or the connection to go away that spoils the experience of viewers and so we started supporting a",
    "start": "1185919",
    "end": "1191799"
  },
  {
    "text": "different resolution 400 by 400 so if you don't have enough bandwidth drop down to a lower bit rate",
    "start": "1191799",
    "end": "1199799"
  },
  {
    "text": "and audio and video codex were standard a and h264 uh these are industry",
    "start": "1200320",
    "end": "1205520"
  },
  {
    "text": "standards nothing special there cool time for a live",
    "start": "1205520",
    "end": "1212760"
  },
  {
    "text": "stream this was an interesting live stream of uh SpaceX launch it was",
    "start": "1212760",
    "end": "1218840"
  },
  {
    "text": "awesome to see this on the platform and a lot of people tuning in commenting and so on there is something beautiful about",
    "start": "1218840",
    "end": "1225600"
  },
  {
    "text": "rocket launches I don't know what that is but definitely gets the nerd in me super excited like every time I see a",
    "start": "1225600",
    "end": "1232159"
  },
  {
    "text": "rock like great maybe it is the explosion I don't know uh the fire and action maybe that's the interesting part",
    "start": "1232159",
    "end": "1238679"
  },
  {
    "text": "when this was happening we were all hoping this doesn't explode right this should and not just a rocket the live",
    "start": "1238679",
    "end": "1245039"
  },
  {
    "text": "streaming back end as well we wanted to make sure it all works fine uh so this",
    "start": "1245039",
    "end": "1250679"
  },
  {
    "text": "went well this was cool I'll show you a different stream later on where uh we were hoping things explode",
    "start": "1250679",
    "end": "1258559"
  },
  {
    "text": "okay let's look at stream inist and",
    "start": "1258919",
    "end": "1262360"
  },
  {
    "start": "1264000",
    "end": "1264000"
  },
  {
    "text": "processing so I briefly mentioned pops before a pop is a has a several racks of",
    "start": "1264440",
    "end": "1272960"
  },
  {
    "text": "hosts which have two responsibilities one to terminate uh",
    "start": "1272960",
    "end": "1280840"
  },
  {
    "text": "incoming connections from clients and then pass these connections over Facebook's network uh which is much more",
    "start": "1280840",
    "end": "1287080"
  },
  {
    "text": "reliable this way the round trip time is significantly lower compared to people connecting from wherever they are uh to",
    "start": "1287080",
    "end": "1293840"
  },
  {
    "text": "our DC and the second is caching pops is where we can cache a bunch of these",
    "start": "1293840",
    "end": "1299559"
  },
  {
    "text": "streams for the playback side not on inje data centers are much bigger",
    "start": "1299559",
    "end": "1305520"
  },
  {
    "text": "compared to Pops and they have many more functions uh we will look into the details of which functions we end up",
    "start": "1305520",
    "end": "1311120"
  },
  {
    "text": "using for live streaming a couple of slides down so when somebody wants to do a live",
    "start": "1311120",
    "end": "1317200"
  },
  {
    "text": "stream they will create a connection to a pop before they create the",
    "start": "1317200",
    "end": "1324720"
  },
  {
    "text": "connection they use out of band API to get three things they get a stream ID",
    "start": "1324720",
    "end": "1330960"
  },
  {
    "text": "they get security tokens and they also get a URI the stream ID is uh important",
    "start": "1330960",
    "end": "1337440"
  },
  {
    "text": "for consistent hashing and I'll talk about that later on security tokens are obvious why we need them and then the",
    "start": "1337440",
    "end": "1344640"
  },
  {
    "text": "URI the URI gets resolved against Facebooks Network INF we load balance it",
    "start": "1344640",
    "end": "1350200"
  },
  {
    "text": "and then uh the client knows which DC or which pop to talk to so in this case you",
    "start": "1350200",
    "end": "1355320"
  },
  {
    "text": "see it is connecting to a pop as soon as the connection is made the pop will forward the connection to a",
    "start": "1355320",
    "end": "1361520"
  },
  {
    "text": "DC this is where the stream ID comes in we need to map a given stream to a",
    "start": "1361520",
    "end": "1366720"
  },
  {
    "text": "particular data center which data center it picks is not super relevant the important part is it picks",
    "start": "1366720",
    "end": "1373960"
  },
  {
    "text": "something such that things are balanced well and then it keeps going to that DC for that stream so we don't have Jitter",
    "start": "1373960",
    "end": "1379919"
  },
  {
    "text": "uh and lag this is a flattened topology of what",
    "start": "1379919",
    "end": "1387440"
  },
  {
    "text": "we just saw broadcast cland connects to a pop connects to a DC now let's get",
    "start": "1387440",
    "end": "1392960"
  },
  {
    "text": "into the details of each one of these there going to be some cool animation here by the",
    "start": "1392960",
    "end": "1398200"
  },
  {
    "start": "1398000",
    "end": "1398000"
  },
  {
    "text": "way you can see I get excited about these things all right so let's go inside a",
    "start": "1398200",
    "end": "1404120"
  },
  {
    "text": "pop uh as I said it has two types of things proxygen hosts which are responsible for terminating the incoming",
    "start": "1404120",
    "end": "1410400"
  },
  {
    "text": "connections and the big cache hosts responsible for caching on the inje side",
    "start": "1410400",
    "end": "1416279"
  },
  {
    "text": "caching is not relevant and so we can ignore that for now so the broadcast client creates a",
    "start": "1416279",
    "end": "1423840"
  },
  {
    "text": "connection with a random proxygen host in it in the pop closest to it the",
    "start": "1423840",
    "end": "1429440"
  },
  {
    "text": "proxygen host has scriptable logic which we can write and determine what to do",
    "start": "1429440",
    "end": "1434679"
  },
  {
    "text": "with a given stream or a given Connection in case of live streams the logic is send this live stream to an",
    "start": "1434679",
    "end": "1440679"
  },
  {
    "text": "appropriate DC data center based on load balancing and so that is what it",
    "start": "1440679",
    "end": "1447720"
  },
  {
    "text": "does now let's look inside the Data Center and see what happens there that is where the real processing happens on",
    "start": "1447720",
    "end": "1453760"
  },
  {
    "text": "the injection",
    "start": "1453760",
    "end": "1456279"
  },
  {
    "text": "side animation so it has three types of hosts uh the proxygen host and the big",
    "start": "1459440",
    "end": "1466080"
  },
  {
    "text": "cash host they have the same function as the two types in the pop and then there are the encoding hosts which is uh which",
    "start": "1466080",
    "end": "1471679"
  },
  {
    "text": "are the owners of a given stream and we do a bunch of processing on the encoding host we will ignore the big cach host",
    "start": "1471679",
    "end": "1478760"
  },
  {
    "text": "for now caching is not relevant on inje side the broadcast client creates a",
    "start": "1478760",
    "end": "1485640"
  },
  {
    "text": "connection the pop forwards a connection to a random proxygen host in that data center the proxygen host does consistent",
    "start": "1485640",
    "end": "1493880"
  },
  {
    "text": "hashing with the stream ID and sends it to an appropriate encoding host which in the",
    "start": "1493880",
    "end": "1499440"
  },
  {
    "text": "DC when we started we were actually doing this mapping based on the source IP and then we realized with Nat and all",
    "start": "1499440",
    "end": "1506200"
  },
  {
    "text": "that fanciness uh we would end up mapping a lot of machines to a a lot of streams to the same machine and this was",
    "start": "1506200",
    "end": "1511760"
  },
  {
    "text": "not cool so we moved to stream ID and that worked out much better this mapping is important for a",
    "start": "1511760",
    "end": "1517279"
  },
  {
    "text": "variety of reasons if a client loses its connection because they move from sell",
    "start": "1517279",
    "end": "1522559"
  },
  {
    "text": "to Wi-Fi uh or the other way around we don't want the stream to have Jitters and so in this this case the connection",
    "start": "1522559",
    "end": "1529000"
  },
  {
    "text": "goes away the broadcast CLI creates a new connection with the new network but",
    "start": "1529000",
    "end": "1534200"
  },
  {
    "text": "uses the same stream ID and so it gets mapped to the same host so viewers of this stream would not",
    "start": "1534200",
    "end": "1541919"
  },
  {
    "text": "even realize that all this happened behind the covers which is exactly how it should",
    "start": "1541919",
    "end": "1548279"
  },
  {
    "text": "be this logic also allows us to deal with planned and unplanned outages at our scale planned outages and",
    "start": "1548279",
    "end": "1556120"
  },
  {
    "text": "unplanned outages happen every day you there's just no way around it and so in this case let's say you lose the",
    "start": "1556120",
    "end": "1561679"
  },
  {
    "text": "encoding host so the connection is gone the end",
    "start": "1561679",
    "end": "1566720"
  },
  {
    "text": "to end connection uh breaks away the broadcast client will create the connection again it will go to the",
    "start": "1566720",
    "end": "1572200"
  },
  {
    "text": "proxygen host the proxygen host will realize that the encoding host which was supposed to be responsible for this is",
    "start": "1572200",
    "end": "1578679"
  },
  {
    "text": "down and it can no longer talk to it it uses consistent hashing to find the next",
    "start": "1578679",
    "end": "1583760"
  },
  {
    "text": "host that should be able to take care of the stream and start sending the data to that host depending on how long it took",
    "start": "1583760",
    "end": "1591240"
  },
  {
    "text": "for us to realize that the host is down there may be a small Jitter but in most cases you wouldn't even notice that all",
    "start": "1591240",
    "end": "1597480"
  },
  {
    "text": "this is happening behind the covers which is great works out well for everybody works out well for us don't",
    "start": "1597480",
    "end": "1602760"
  },
  {
    "text": "get called for on Call issues you works out for users they get a smooth",
    "start": "1602760",
    "end": "1608799"
  },
  {
    "text": "stream awesome so that's what happens inside the DC this is sort of the inje and the uh processing side of things",
    "start": "1609480",
    "end": "1616440"
  },
  {
    "start": "1616000",
    "end": "1616000"
  },
  {
    "text": "let's look at the encoding hosts and what they do encoding hosts do five things the",
    "start": "1616440",
    "end": "1624200"
  },
  {
    "text": "first one is authenticate a stream so they make sure a stream is proper uh and formatted correctly and so",
    "start": "1624200",
    "end": "1632000"
  },
  {
    "text": "on they associate themselves with that stream so now they are the owner they",
    "start": "1632120",
    "end": "1637640"
  },
  {
    "text": "are the source of Truth for this stream this is important because when we want when we talk about playback the playback",
    "start": "1637640",
    "end": "1644840"
  },
  {
    "text": "clients and the pops need to know which host to fetch data from and so encoding hosts are the ones that tie the inje",
    "start": "1644840",
    "end": "1651080"
  },
  {
    "text": "side and the playback side together the encoding hosts create uh",
    "start": "1651080",
    "end": "1657440"
  },
  {
    "text": "several encodings so whatever quality we get we create multiple encodings uh some",
    "start": "1657440",
    "end": "1663120"
  },
  {
    "text": "lower quality with lower bit rate so we can show the live stream without Jitters to people who don't have enough",
    "start": "1663120",
    "end": "1670879"
  },
  {
    "text": "connectivity they create the playback output which is Dash and we'll talk about Dash in the next section",
    "start": "1671440",
    "end": "1679399"
  },
  {
    "text": "and they store media so we talked about how live streams become normal videos",
    "start": "1680559",
    "end": "1685960"
  },
  {
    "text": "those get stored the encoding hosts are responsible for converting them into videos and then putting them out in our",
    "start": "1685960",
    "end": "1691240"
  },
  {
    "text": "long-term storage time for a live stream this one",
    "start": "1691240",
    "end": "1697880"
  },
  {
    "text": "we wanted things to explode and here's why this was a live stream it will show",
    "start": "1697880",
    "end": "1702960"
  },
  {
    "text": "up by the it's not an error I'll click a button and it'll show up uh two employees of Buzz feed decided to find",
    "start": "1702960",
    "end": "1710120"
  },
  {
    "text": "the breaking point of a watermelon by putting rubber bands over it they went on for 45 minutes and put",
    "start": "1710120",
    "end": "1718399"
  },
  {
    "text": "690 rubber bands and then it exploded here it was you'll see the explosion in",
    "start": "1718399",
    "end": "1725519"
  },
  {
    "text": "action see then they proceed to eat it which is",
    "start": "1726360",
    "end": "1732600"
  },
  {
    "text": "fine uh so we have different kinds of live streams there are uh rocket launchers and then there are uh",
    "start": "1732600",
    "end": "1738360"
  },
  {
    "text": "watermelons exploding who's to say one is more important than the other right they're all good engagement work out",
    "start": "1738360",
    "end": "1746200"
  },
  {
    "text": "well all right let's talk about the playback side MC",
    "start": "1746200",
    "end": "1751279"
  },
  {
    "text": "Dash so what is Dash Dash is a streaming protocol over",
    "start": "1751279",
    "end": "1757480"
  },
  {
    "text": "HTTP super simple actually it consists of two types of files a manifest file",
    "start": "1757480",
    "end": "1764200"
  },
  {
    "text": "and media files manifest file is a table of contents it just points to media",
    "start": "1764200",
    "end": "1770480"
  },
  {
    "text": "files so server creates onec segments so",
    "start": "1770480",
    "end": "1775840"
  },
  {
    "text": "as a live stream is being created for each second we end up creating a segment and then update the Manifest to point to",
    "start": "1775840",
    "end": "1782480"
  },
  {
    "text": "this new segment so as the stream is going on the Manifest can keep increasing and so we keep a rolling time",
    "start": "1782480",
    "end": "1788440"
  },
  {
    "text": "window if a stream goes on for several hours it is not super useful to send the entire manifest to all clients the the",
    "start": "1788440",
    "end": "1795919"
  },
  {
    "text": "entire time because this is supposed to be live the client refreshes the Manifest",
    "start": "1795919",
    "end": "1802679"
  },
  {
    "text": "periodically using standard HTTP get when it sees that there are new entries",
    "start": "1802679",
    "end": "1808399"
  },
  {
    "text": "uh in the Manifest file it will go and fetch the corresponding media files again via HTTP get so it's a",
    "start": "1808399",
    "end": "1815720"
  },
  {
    "text": "straightforward protocol uh it also allows different bit rates for the same",
    "start": "1815720",
    "end": "1821039"
  },
  {
    "text": "stream and then syncing them appropriately which is again important when you when your bandwidth is varying",
    "start": "1821039",
    "end": "1827159"
  },
  {
    "text": "which happens a lot so more animations now from the playback",
    "start": "1827159",
    "end": "1833120"
  },
  {
    "start": "1829000",
    "end": "1829000"
  },
  {
    "text": "side so let's consider let's say this playback client is uh somewhere in India",
    "start": "1833120",
    "end": "1838519"
  },
  {
    "text": "and we are going to use the Blue Square which is at the encoding host as the",
    "start": "1838519",
    "end": "1844760"
  },
  {
    "text": "source of Truth or the file being requested it is sort of the precious uh so the playback client will",
    "start": "1844760",
    "end": "1851679"
  },
  {
    "text": "connect to its closest pop and say give me the Manifest file for this stream let's assume this is the first",
    "start": "1851679",
    "end": "1858120"
  },
  {
    "text": "time anybody has requested the Manifest file for this stream so the only place where this is available is on the",
    "start": "1858120",
    "end": "1863159"
  },
  {
    "text": "encoding host the proxygen host checks with its",
    "start": "1863159",
    "end": "1868799"
  },
  {
    "text": "local big cash host to see if something is available the big cash host says Nope there's nothing",
    "start": "1868799",
    "end": "1875000"
  },
  {
    "text": "there the proxygen host then makes a call to the data center that is supposed to be responsible for this stream and",
    "start": "1875000",
    "end": "1881080"
  },
  {
    "text": "connects to a random proxygen host there there it checks locally again with",
    "start": "1881080",
    "end": "1887360"
  },
  {
    "text": "a big cash host again figures out there's nothing on the big cash host either because this is the first time",
    "start": "1887360",
    "end": "1892639"
  },
  {
    "text": "somebody's fetching this manifest and so it knows which encoding host to go to based on the consistent hash",
    "start": "1892639",
    "end": "1898320"
  },
  {
    "text": "consistently hashed stream ID goes to the encoding host gets back the Manifest it then populates the",
    "start": "1898320",
    "end": "1908440"
  },
  {
    "text": "cash sends it back to the proxygen in the pop which in turn again populates",
    "start": "1908440",
    "end": "1913760"
  },
  {
    "text": "its own cash and then sends it out now all of this may seem like a lot of work like why are we populating all these",
    "start": "1913760",
    "end": "1919960"
  },
  {
    "text": "caches this becomes relevant when some other playback land comes in and connects to the same",
    "start": "1919960",
    "end": "1925960"
  },
  {
    "text": "pop there the proxygen host will talk to its local big cash host finds the file",
    "start": "1925960",
    "end": "1931200"
  },
  {
    "text": "sends it back did not even hit the data center so",
    "start": "1931200",
    "end": "1936600"
  },
  {
    "text": "remember we talked about a stream with a large number of uh viewers at that we couldn't predict which stream would be",
    "start": "1936600",
    "end": "1942840"
  },
  {
    "text": "using this two- layer caching architecture we can solve this problem reasonably because the first time",
    "start": "1942840",
    "end": "1948799"
  },
  {
    "text": "somebody connects to a pop we fetch it from the DC everybody else who connects to the same pop no longer needs to go to",
    "start": "1948799",
    "end": "1954760"
  },
  {
    "text": "the DC they get everything they need right from the pop and so you can scale out by pops and DCS separately and have",
    "start": "1954760",
    "end": "1962639"
  },
  {
    "text": "separate caching architecture in both of those places now let's see what happens if",
    "start": "1962639",
    "end": "1967960"
  },
  {
    "text": "let's somebody in the US wants to see this live stream and so they're going to connect to a different pop now this pop",
    "start": "1967960",
    "end": "1975000"
  },
  {
    "text": "doesn't have the Manifest file yet so it goes through the same motions checks with the big cash host doesn't have it",
    "start": "1975000",
    "end": "1981600"
  },
  {
    "text": "goes to the DC checks with the big cash host there finds it fantastic returns it",
    "start": "1981600",
    "end": "1988200"
  },
  {
    "text": "caches it locally and out so roughly you can see that the",
    "start": "1988200",
    "end": "1993360"
  },
  {
    "text": "number of request that the DC would get is equal to the number of Pops because once you have it in the pop you're done",
    "start": "1993360",
    "end": "1998880"
  },
  {
    "text": "that pop will take care of the Manifest file itself now we also need to update the Manifest file periodically and there",
    "start": "1998880",
    "end": "2005200"
  },
  {
    "text": "are two ways to do this one is have a small time to live TTL which is a a",
    "start": "2005200",
    "end": "2011639"
  },
  {
    "text": "common jargon used with caches where this will fall out of cash in say 3 seconds and the next person coming in",
    "start": "2011639",
    "end": "2017320"
  },
  {
    "text": "will go to the DC and fetch the updated manifest file or we can use HTTP push",
    "start": "2017320",
    "end": "2022559"
  },
  {
    "text": "and push this out to uh to the respective pops as required the second",
    "start": "2022559",
    "end": "2028639"
  },
  {
    "text": "one is better than the first one but maybe slightly more complicated I think Todd gave a good talk on async yesterday",
    "start": "2028639",
    "end": "2034519"
  },
  {
    "text": "uh I think the push mechanism sort of ties into that kind of thing",
    "start": "2034519",
    "end": "2039720"
  },
  {
    "text": "all right let's talk about reliability challenges quick reminder this was the",
    "start": "2039840",
    "end": "2046840"
  },
  {
    "text": "original architecture we talked about there is a big problem that we had",
    "start": "2046840",
    "end": "2052720"
  },
  {
    "start": "2050000",
    "end": "2050000"
  },
  {
    "text": "to solve and it was a network problem on the ingestion side if we can't get the",
    "start": "2052720",
    "end": "2057878"
  },
  {
    "text": "stream ingested nobody can see that stream and so ingestion problems end up",
    "start": "2057879",
    "end": "2063440"
  },
  {
    "text": "causing bad user experience across the board and so we had to solve it when the network is bad now if the network is",
    "start": "2063440",
    "end": "2070960"
  },
  {
    "text": "just gone if there is no connectivity there is nothing we can do the stream is just gone uh people will go find",
    "start": "2070960",
    "end": "2076398"
  },
  {
    "text": "something else to watch but if the connectivity is lower the bandwidth has gotten lower than what",
    "start": "2076399",
    "end": "2082000"
  },
  {
    "text": "it was before then we can do interesting things we use something called adaptive",
    "start": "2082000",
    "end": "2087560"
  },
  {
    "text": "bit rate adaptive bit rate is typically used on playback side where uh when you",
    "start": "2087560",
    "end": "2093200"
  },
  {
    "text": "are watching videos you will see if your connect if your bandwidth goes down you start seeing lower quality videos we",
    "start": "2093200",
    "end": "2099640"
  },
  {
    "text": "also apply the same concept on the inje side where if your connectivity goes down or your bandd reduces then we can",
    "start": "2099640",
    "end": "2108000"
  },
  {
    "text": "send in a lower quality stream now this is not something that we like to do",
    "start": "2108000",
    "end": "2113119"
  },
  {
    "text": "because who likes lower quality videos but the choices are either the stream is broken or you see a lower quality stream",
    "start": "2113119",
    "end": "2119720"
  },
  {
    "text": "and so we have to make a compromise there when you think of connectivity",
    "start": "2119720",
    "end": "2125320"
  },
  {
    "text": "problems people typically think of areas like these where you don't know what's going on",
    "start": "2125320",
    "end": "2130920"
  },
  {
    "text": "you'll be surprised to hear that there are connectivity problems in very interesting areas of the",
    "start": "2130920",
    "end": "2137640"
  },
  {
    "text": "world like the White House terrible Wi-Fi we could not believe it they tried",
    "start": "2137640",
    "end": "2144760"
  },
  {
    "text": "to go live a couple of times didn't work and we were like how we never thought that Wi-Fi would be a problem but well",
    "start": "2144760",
    "end": "2150440"
  },
  {
    "text": "they do now we know so dealing with network problems uh three different solutions we",
    "start": "2150440",
    "end": "2157319"
  },
  {
    "start": "2153000",
    "end": "2153000"
  },
  {
    "text": "talked about the Adaptive upload bit rate we can handle temporary connectivity loss by buffering on the",
    "start": "2157319",
    "end": "2164040"
  },
  {
    "text": "client this is one of those times where we are okay with buffering uh to avoid cutting the stream",
    "start": "2164040",
    "end": "2169720"
  },
  {
    "text": "off in the worst case where there is just not enough bandwidth to send a picture stream over we can do a Audio",
    "start": "2169720",
    "end": "2175920"
  },
  {
    "text": "Only broadcast where what you're seeing is more important than what people are seeing uh Audio Only broadcast work",
    "start": "2175920",
    "end": "2184720"
  },
  {
    "start": "2185000",
    "end": "2185000"
  },
  {
    "text": "fine cool let's talk about a second problem Thundering Herd everybody loves thundering",
    "start": "2185680",
    "end": "2190880"
  },
  {
    "text": "herds there's more explosions here so let's say the particular stream",
    "start": "2190880",
    "end": "2196079"
  },
  {
    "text": "is popular and so a bunch of leback clients are asking for uh that stream",
    "start": "2196079",
    "end": "2201680"
  },
  {
    "text": "again we have the blue dot only in the DC at this point the proxygen hosts all make",
    "start": "2201680",
    "end": "2208839"
  },
  {
    "text": "connections with that one big cash host that is supposed to be responsible for the",
    "start": "2208839",
    "end": "2215000"
  },
  {
    "text": "stream we don't allow all the streams to go to the DC right away we block them",
    "start": "2215000",
    "end": "2220160"
  },
  {
    "text": "using a cash blocking timeout this timeout is important because there is no point in sending 50",
    "start": "2220160",
    "end": "2226319"
  },
  {
    "text": "requests over to the DC right away we can send one and the rest of them can wait for the response from this this",
    "start": "2226319",
    "end": "2232839"
  },
  {
    "text": "works well if the response arrives in time sometimes the response doesn't show",
    "start": "2232839",
    "end": "2238560"
  },
  {
    "text": "up in time and then the time out time out expires this unleashes a Thundering Herd everybody who was waiting for the",
    "start": "2238560",
    "end": "2246520"
  },
  {
    "text": "cash to be filled now goes to the",
    "start": "2246520",
    "end": "2250720"
  },
  {
    "text": "DC guess what is going to happen guess fire",
    "start": "2251960",
    "end": "2259480"
  },
  {
    "text": "right so this is bad now the way around this is tuning of cash blocking timeouts",
    "start": "2259480",
    "end": "2266119"
  },
  {
    "start": "2263000",
    "end": "2263000"
  },
  {
    "text": "if the cash blocking timeout is too high then losing even a single request will result in stuttering of the stream or",
    "start": "2266119",
    "end": "2272640"
  },
  {
    "text": "Jitter if it is too low then we get frequent thundering hers so tuning this",
    "start": "2272640",
    "end": "2278400"
  },
  {
    "text": "is a little bit of black magic little bit of art little bit of science uh but we have sort of gotten to a reasonable",
    "start": "2278400",
    "end": "2284200"
  },
  {
    "text": "Place uh over the years all right let's talk about new",
    "start": "2284200",
    "end": "2290240"
  },
  {
    "text": "features this is exciting",
    "start": "2290240",
    "end": "2295520"
  },
  {
    "text": "so going broadcasting live is one experience but wouldn't it be cool to",
    "start": "2295520",
    "end": "2301040"
  },
  {
    "text": "add somebody else to add a viewer into the stream to interact with you so imagine wind diesel goes live and I get",
    "start": "2301040",
    "end": "2308000"
  },
  {
    "text": "to join that broadcast stream and ask him a question directly that would be fantastic and so this is what this",
    "start": "2308000",
    "end": "2313359"
  },
  {
    "text": "feature is it is being rolled out now uh where a broadcaster can add a viewer and",
    "start": "2313359",
    "end": "2318720"
  },
  {
    "text": "then interact with them in real time the infra challenge here is now these two people are talking in real time you",
    "start": "2318720",
    "end": "2325200"
  },
  {
    "text": "can't have seconds of delay it has to be milliseconds for them to have a reasonable conversation while everybody",
    "start": "2325200",
    "end": "2330280"
  },
  {
    "text": "else is watching their conversation so that was an interesting challenge that we we had to look",
    "start": "2330280",
    "end": "2336440"
  },
  {
    "text": "at video tab is out to some people at this point where the key challenge here is we have",
    "start": "2336440",
    "end": "2344200"
  },
  {
    "text": "to pre-buffering video tab allows people to watch top",
    "start": "2344200",
    "end": "2351880"
  },
  {
    "text": "live streams recommended live streams related videos uh or a lot of content",
    "start": "2351880",
    "end": "2357079"
  },
  {
    "text": "from their friends and followers and so on so buffering all of that and pushing it out was an interesting problem to",
    "start": "2357079",
    "end": "2364000"
  },
  {
    "text": "solve we also allow casting of live streams to different screens like your",
    "start": "2364000",
    "end": "2369680"
  },
  {
    "text": "TV Facebook recently launched a Facebook video app uh for TV for Apple TV for uh",
    "start": "2369680",
    "end": "2375880"
  },
  {
    "text": "Samsung TV and Amazon Fire TV and so now you can watch interesting content",
    "start": "2375880",
    "end": "2381400"
  },
  {
    "text": "there the Holy Grail of immersion is 360 Live this is where you can transport a",
    "start": "2381400",
    "end": "2389839"
  },
  {
    "text": "person into a completely different experience as it is happening life super exciting the hard problem",
    "start": "2389839",
    "end": "2397560"
  },
  {
    "text": "though is as if just normal live 720 X 720 was not hard enough now you have to do a 360 view of that entire thing so",
    "start": "2397560",
    "end": "2405599"
  },
  {
    "text": "tuning our entire stack for super high bandwidth streams like these was a",
    "start": "2405599",
    "end": "2411760"
  },
  {
    "text": "challenge now all the people who said they haven't tried Al yet aren't you repenting that you can try it now and",
    "start": "2411800",
    "end": "2418240"
  },
  {
    "text": "you'll see how cool it is okay let's look at some lessons learned",
    "start": "2418240",
    "end": "2425640"
  },
  {
    "text": "large Services can grow from Small Beginnings sometimes it is not possible to predict that something will become so",
    "start": "2427800",
    "end": "2433440"
  },
  {
    "text": "successful or big but you have to start somewhere uh it is better to actually write some code than keep discussing",
    "start": "2433440",
    "end": "2440000"
  },
  {
    "text": "Forever on what the idea architecture should be you have to adapt your service to the",
    "start": "2440000",
    "end": "2447920"
  },
  {
    "text": "network environment that you have to operate in this means bad connectivity bad networks people moving from Wi-Fi to",
    "start": "2447920",
    "end": "2454079"
  },
  {
    "text": "cell and so on dealing with all of those aspects is important to make a product",
    "start": "2454079",
    "end": "2460000"
  },
  {
    "text": "successful reliability and scalability are built into the design you cannot add these",
    "start": "2460000",
    "end": "2466319"
  },
  {
    "text": "later this usually does require more time than people uh like to budget for",
    "start": "2466319",
    "end": "2472599"
  },
  {
    "text": "but I think this is very important hot spots and thundering HS are my best friends at this point they",
    "start": "2472599",
    "end": "2478680"
  },
  {
    "text": "happen in every component and I have to deal with them anyway all of you have to as",
    "start": "2478680",
    "end": "2484200"
  },
  {
    "text": "well the design has to accommodate for plan planed and unplanned outages if you",
    "start": "2484200",
    "end": "2489760"
  },
  {
    "text": "don't things will keep going down on call will be hell you will not be able to get any work done and so dealing with",
    "start": "2489760",
    "end": "2495680"
  },
  {
    "text": "this is very important we have to make compromises to ship large projects we have to",
    "start": "2495680",
    "end": "2502040"
  },
  {
    "text": "compromise a lot in terms of what protocol we use what quality we support and so on but these were important",
    "start": "2502040",
    "end": "2508040"
  },
  {
    "text": "compromises to be able to launch and have a reasonable service it doesn't feel good to make",
    "start": "2508040",
    "end": "2513920"
  },
  {
    "text": "compromises but it is the right thing to do",
    "start": "2513920",
    "end": "2518800"
  },
  {
    "text": "and keep the architecture flexible for future releases doing things like a broadcaster",
    "start": "2519319",
    "end": "2525440"
  },
  {
    "text": "adding a viewer is can be pretty tricky if the architecture is not right and so",
    "start": "2525440",
    "end": "2531240"
  },
  {
    "text": "flexibility is very important when you're working with product teams that are moving way faster than the infrastructure team can move so",
    "start": "2531240",
    "end": "2537480"
  },
  {
    "text": "flexibility becomes key cool these are some of the sources",
    "start": "2537480",
    "end": "2543200"
  },
  {
    "text": "uh a bunch of people helped out with the slides uh the two images of for shed got real and so",
    "start": "2543200",
    "end": "2548680"
  },
  {
    "text": "on all right thank you uh time for",
    "start": "2548680",
    "end": "2554119"
  },
  {
    "text": "questions okay so we have a few minutes before lunch um for questions um one",
    "start": "2559319",
    "end": "2564640"
  },
  {
    "text": "thing that uh Sachin didn't have in his talk which I asked during a preview was um how they deal with porn with what",
    "start": "2564640",
    "end": "2572280"
  },
  {
    "text": "porn porn do you want to uh answer that question here I like action movies not",
    "start": "2572280",
    "end": "2579119"
  },
  {
    "text": "Pawn uh so Pawn has to be dealt with carefully there are a bunch of things if people report Pawn uh then we actually",
    "start": "2579119",
    "end": "2586000"
  },
  {
    "text": "have humans looking at that to take it down uh there are also some automated flows to take down Pawn so it is a",
    "start": "2586000",
    "end": "2591160"
  },
  {
    "text": "combination of those two uh but it's a hard problem all right no pun intended oh my",
    "start": "2591160",
    "end": "2597559"
  },
  {
    "text": "God anybody else any uh any questions we'll probably cut it out in like we we'll take a few",
    "start": "2597559",
    "end": "2604000"
  },
  {
    "text": "questions and since it's lunch I think there's one on there",
    "start": "2604000",
    "end": "2610799"
  },
  {
    "text": "s hi uh first thank you it was very entertaining talk um my question is as",
    "start": "2613000",
    "end": "2619720"
  },
  {
    "text": "far as I understand most viewers of a live stream are more likely to connect to a pop rather than the data center",
    "start": "2619720",
    "end": "2626319"
  },
  {
    "text": "right because they're most likely to be collocated to the live stream M presenter so in that case you I mean it",
    "start": "2626319",
    "end": "2635680"
  },
  {
    "text": "seems that uh latency is not that big of a deal",
    "start": "2635680",
    "end": "2642400"
  },
  {
    "text": "uh because you would rarely connect to Data Center so on a on an a your average",
    "start": "2642400",
    "end": "2647720"
  },
  {
    "text": "case latency shouldn't be that much of a problem is that correct uh actually latency is still a problem because as I",
    "start": "2647720",
    "end": "2654839"
  },
  {
    "text": "said let's say I'm broadcasting from here people could be in different parts of the world not everything so even",
    "start": "2654839",
    "end": "2662160"
  },
  {
    "text": "Engineers like to believe that everything travels at the speed of light but when you send it over 15 networks",
    "start": "2662160",
    "end": "2667720"
  },
  {
    "text": "different peering arrangements and so on a lot of latency gets added uh two we have to encode these streams for to",
    "start": "2667720",
    "end": "2674760"
  },
  {
    "text": "account for the bandwidth available on the viewer side that encoding requires a buffer for it to do a reasonable job and",
    "start": "2674760",
    "end": "2680480"
  },
  {
    "text": "create a good enough quality with a lower bit rate and so that adds latency uh the different protocols I talked",
    "start": "2680480",
    "end": "2686440"
  },
  {
    "text": "about Dash there are other protocols like d hls and so on each one of those have their own requirements on how much",
    "start": "2686440",
    "end": "2692280"
  },
  {
    "text": "buffer they need before they will start playing and so there are several factors that go into that and so l actually is a",
    "start": "2692280",
    "end": "2697839"
  },
  {
    "text": "problem and we have to tune it really well to have a good experience Fair Point thank",
    "start": "2697839",
    "end": "2705200"
  },
  {
    "text": "you hi um thanks for the talk first of all um couple of question on the backand on the data center um do you use",
    "start": "2705200",
    "end": "2712079"
  },
  {
    "text": "containers on the backand and how do you deal with storage how do you provision it how do you keep up with it so uh we",
    "start": "2712079",
    "end": "2719400"
  },
  {
    "text": "use Linux containers and uh on storage we have our own system that we have talked about uh publicly called hyack or",
    "start": "2719400",
    "end": "2726520"
  },
  {
    "text": "ever store and we use that system for uh somebody's",
    "start": "2726520",
    "end": "2732640"
  },
  {
    "text": "weaving uh we have a system called ever store which stores all the photos and videos that we have uh so it's a",
    "start": "2732720",
    "end": "2738800"
  },
  {
    "text": "dedicated system for these kinds of use",
    "start": "2738800",
    "end": "2742960"
  },
  {
    "text": "cases uh I wanted to ask you did you guys consider using the quick protocol instead of a TCP for uploads or",
    "start": "2746119",
    "end": "2751839"
  },
  {
    "text": "streaming uh so we are considering quick now we didn't consider it then because our Network infra is tuned for uh TCP uh",
    "start": "2751839",
    "end": "2759920"
  },
  {
    "text": "and so since time to production was a key requirement we went with whatever was whatever helped us get into",
    "start": "2759920",
    "end": "2765559"
  },
  {
    "text": "production sooner uh but now that we have uh sort of more Headroom if you will uh we are going to try reliable UDP",
    "start": "2765559",
    "end": "2772200"
  },
  {
    "text": "and a bunch of those",
    "start": "2772200",
    "end": "2774838"
  },
  {
    "text": "things hi um you've been talking about uh seconds of latency in your streaming",
    "start": "2778040",
    "end": "2784720"
  },
  {
    "text": "over here okay no that's not me um you've been talking about seconds of latency in your",
    "start": "2784720",
    "end": "2791319"
  },
  {
    "text": "streaming uh but towards the end you talked about a new feature where you're having personto person conversations",
    "start": "2791319",
    "end": "2797480"
  },
  {
    "text": "where you need to be down to milliseconds how are you tackling that uh so to tackle some of those things we",
    "start": "2797480",
    "end": "2804800"
  },
  {
    "text": "have to look at different protocols uh rtmp won't do because it can't do 200 milliseconds or so so we look at a web",
    "start": "2804800",
    "end": "2811559"
  },
  {
    "text": "RTC uh we already have web RTC support for real-time calling uh on messenger so",
    "start": "2811559",
    "end": "2817240"
  },
  {
    "text": "messenger has video calling and uh voice calling and so we can use a similar stack for people talking in real",
    "start": "2817240",
    "end": "2825200"
  },
  {
    "text": "time okay hi uh how do you differentiate between the amount of people who are",
    "start": "2826800",
    "end": "2832520"
  },
  {
    "text": "watching live streams so as because there are live streams which are wordss by I don't know thousands of people and",
    "start": "2832520",
    "end": "2839640"
  },
  {
    "text": "some are wordss by like two or three so you still put those uh meta files into",
    "start": "2839640",
    "end": "2846200"
  },
  {
    "text": "the caches those magic boxes big caches are like components that manage all those things",
    "start": "2846200",
    "end": "2853079"
  },
  {
    "text": "uh yes so it depends on if you have one viewer then the cach is useless but we",
    "start": "2853079",
    "end": "2858520"
  },
  {
    "text": "can't predict that you will have one viewer only so that was just a simplification of like the putting",
    "start": "2858520",
    "end": "2864000"
  },
  {
    "text": "everything into the big cash okay yes so if you have two users uh watching this hopefully they're in the same pop so",
    "start": "2864000",
    "end": "2869920"
  },
  {
    "text": "caching it in that Pop makes sense uh if you have one then yes it is the cach is",
    "start": "2869920",
    "end": "2875160"
  },
  {
    "text": "pretty useless okay",
    "start": "2875160",
    "end": "2878838"
  },
  {
    "text": "thanks You released live first on for celebrities and then for the rest of the public was that done for performance",
    "start": "2881000",
    "end": "2887640"
  },
  {
    "text": "reasons or for marketing reasons sorry I didn't hear the first part You released live first for celebrities and then for",
    "start": "2887640",
    "end": "2893839"
  },
  {
    "text": "the rest of the public was that done for performance reasons or for marketing reasons uh so we wanted to figure out if",
    "start": "2893839",
    "end": "2899440"
  },
  {
    "text": "this is uh something that we should invest in more that is one and two uh it is good to try things out and see how",
    "start": "2899440",
    "end": "2905960"
  },
  {
    "text": "they work uh to validate our assumptions in production if we launch it to all users then it becomes a much larger",
    "start": "2905960",
    "end": "2912680"
  },
  {
    "text": "problem to deal with mistakes get Amplified with celebrities it is a small Set uh but they still end up testing the",
    "start": "2912680",
    "end": "2919440"
  },
  {
    "text": "limits of our infra because celebrity streams will typically have a large number of viewers and so we get all the",
    "start": "2919440",
    "end": "2924960"
  },
  {
    "text": "testing we need uh in production instead of just doing our own shadow testing and so",
    "start": "2924960",
    "end": "2931119"
  },
  {
    "text": "on yeah hi so when you guys started so what was the team size and when when uh",
    "start": "2931119",
    "end": "2937640"
  },
  {
    "text": "the idea becomes the reality how the team uh grown up uh so initially as as I",
    "start": "2937640",
    "end": "2945040"
  },
  {
    "text": "showed you the first picture it was basically a very small uh set of people that built the infrastructure and it was",
    "start": "2945040",
    "end": "2950720"
  },
  {
    "text": "just those people who launched it out on the mentions app uh once we figured out that this is working well uh and we need",
    "start": "2950720",
    "end": "2956640"
  },
  {
    "text": "to invest a bit more to launch it for all users we added a few more people uh I'm not entirely sure we have talked",
    "start": "2956640",
    "end": "2962640"
  },
  {
    "text": "about the team sizes before uh but teams at Facebook are typically very small uh in the morning I think we saw how teams",
    "start": "2962640",
    "end": "2969319"
  },
  {
    "text": "of sizes more than 20 fail miserably uh we have already taken that to heart we typically have very small teams uh a",
    "start": "2969319",
    "end": "2975640"
  },
  {
    "text": "close set of people work together and deliver things if we need more people with different skill sets we form",
    "start": "2975640",
    "end": "2980920"
  },
  {
    "text": "virtual teams uh so there'll be a couple of people from product couple of designers few infra Engineers they sit",
    "start": "2980920",
    "end": "2986520"
  },
  {
    "text": "together for a few months and then uh hammer out the required",
    "start": "2986520",
    "end": "2991960"
  },
  {
    "text": "code uh have you considered using a third Party media server uh at least",
    "start": "2993559",
    "end": "2999720"
  },
  {
    "text": "during your prototyping phase before you develop your own or uh so most things uh",
    "start": "2999720",
    "end": "3007240"
  },
  {
    "text": "in the industry don't work at Facebook scale and so it is okay for a prototype but we know we have to throw that out",
    "start": "3007240",
    "end": "3013440"
  },
  {
    "text": "anyway uh before we put it into production and so we typically uh build our own or if we end up using something",
    "start": "3013440",
    "end": "3020359"
  },
  {
    "text": "that is open source or so on uh like we took uh we use MySQL a lot we make a lot",
    "start": "3020359",
    "end": "3025680"
  },
  {
    "text": "of changes so it can scale and operate uh at our level okay out of curiosity",
    "start": "3025680",
    "end": "3031079"
  },
  {
    "text": "which for your prototype did you use one can use tell which one you used we didn't use a media server we",
    "start": "3031079",
    "end": "3038520"
  },
  {
    "text": "built our own okay thank you one more um I'm curious you say you",
    "start": "3038520",
    "end": "3046960"
  },
  {
    "text": "encode things to um multiple different formats for different devices and things um do you do that on the Fly um in in",
    "start": "3046960",
    "end": "3054680"
  },
  {
    "text": "terms of um creating a new stream uh per set that needs it or do you do",
    "start": "3054680",
    "end": "3059920"
  },
  {
    "text": "them do you do all the different formats ahead of time just in case you need them in which case surely that wastes a lot of CPA uh so uh it is a mix of things we",
    "start": "3059920",
    "end": "3068720"
  },
  {
    "text": "can make uh some assumptions about what formats we are going to need uh but I think that is one area where we need to",
    "start": "3068720",
    "end": "3074319"
  },
  {
    "text": "invest a lot more to save CPU you're right efficiency is starting to become a problem and so we'll look into",
    "start": "3074319",
    "end": "3080280"
  },
  {
    "text": "that okay uh great questions everybody uh I think it's time for lunch if you have further questions please come up to",
    "start": "3080280",
    "end": "3085960"
  },
  {
    "text": "the stage and ask them thank you very much thank you",
    "start": "3085960",
    "end": "3091160"
  }
]