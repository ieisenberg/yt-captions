[
  {
    "start": "0",
    "end": "220000"
  },
  {
    "text": "good afternoon i just landed yesterday i'm a little fuzzy",
    "start": "4720",
    "end": "10160"
  },
  {
    "text": "on the time you know how it goes um but uh thanks for being here everybody",
    "start": "10160",
    "end": "15519"
  },
  {
    "text": "and for bearing with the very exciting fire alarm that happened",
    "start": "15519",
    "end": "20960"
  },
  {
    "text": "earlier it was kind of funny i didn't hear it and i like expect fire alarms to",
    "start": "20960",
    "end": "26080"
  },
  {
    "text": "be like really rude and in your face and then i realized i'm in the uk so they're going to be very polite",
    "start": "26080",
    "end": "31439"
  },
  {
    "text": "fire alarms like if it's no trouble could you possibly see where clear will you see your way clear to",
    "start": "31439",
    "end": "36800"
  },
  {
    "text": "exiting the building when you can um sounds good anyway hi i am tim berglund",
    "start": "36800",
    "end": "42879"
  },
  {
    "text": "and i'm here to talk to you today about kafka as a distributed system i work for a company called confluent we",
    "start": "42879",
    "end": "48960"
  },
  {
    "text": "make a cloud service and an event streaming platform that's based on apache kafka i spend most of my",
    "start": "48960",
    "end": "54879"
  },
  {
    "text": "time talking about kafka itself and kind of the architectures that are arising around uh",
    "start": "54879",
    "end": "62559"
  },
  {
    "text": "event driven things and around events and there's some a lot of exciting things to talk about",
    "start": "62559",
    "end": "68720"
  },
  {
    "text": "today a little bit different um who's familiar with who who uses kafka",
    "start": "68720",
    "end": "77040"
  },
  {
    "text": "right now look at all of you okay who is new to kafka",
    "start": "77040",
    "end": "82720"
  },
  {
    "text": "also good showing like about a third new to kafka that's fine because i'm going to give you a little bit of a primer",
    "start": "82720",
    "end": "89680"
  },
  {
    "text": "on kafka basics we don't have a lot of time for that but i want to just give you the shape of things basically and then i",
    "start": "89680",
    "end": "96640"
  },
  {
    "text": "want to dive into three things how replication works how leader election works and how consumer groups",
    "start": "96640",
    "end": "102640"
  },
  {
    "text": "work in kafka and there are some interesting uh distributed systems problems that you",
    "start": "102640",
    "end": "109040"
  },
  {
    "text": "have to solve to do those things and i thought there's two ways i could do this right one is i could make a",
    "start": "109040",
    "end": "114240"
  },
  {
    "text": "bunch of animations on slides that you could watch as i talk about them and that's fun i like doing that the",
    "start": "114240",
    "end": "119759"
  },
  {
    "text": "other is i have these sharpies and i have these",
    "start": "119759",
    "end": "127439"
  },
  {
    "text": "gigantic post-it notes that i purchased here in london this morning and i'm not even",
    "start": "127439",
    "end": "133920"
  },
  {
    "text": "going to tell you how much i paid for these post-it notes it's a scandal and i want to know who's responsible but",
    "start": "133920",
    "end": "141360"
  },
  {
    "text": "we're going to not worry about that i'm putting it aside because what we're going to do for two of these things is i'm going to",
    "start": "141360",
    "end": "147680"
  },
  {
    "text": "get volunteers up here on stage we're going to act these things out some of you are going to be brokers some of you are going to be consumers",
    "start": "147680",
    "end": "153680"
  },
  {
    "text": "i'm going to be zookeeper in all cases when a zookeeper is necessary so that's what we're going to",
    "start": "153680",
    "end": "158959"
  },
  {
    "text": "do somebody i was talking to some um colleagues uh british colleagues here",
    "start": "158959",
    "end": "164560"
  },
  {
    "text": "this morning who work for for confluent also and they pointed out that that seems like a very american thing to do and it",
    "start": "164560",
    "end": "170000"
  },
  {
    "text": "sounded absolutely terrifying to him well i don't know any other way to be uh i have difficulty",
    "start": "170000",
    "end": "176160"
  },
  {
    "text": "uh pretending to be anybody else so we're gonna do that i think i will need",
    "start": "176160",
    "end": "182080"
  },
  {
    "text": "at i forget at most six there might be one where i need eight volunteers start thinking about whether you want to",
    "start": "182080",
    "end": "188239"
  },
  {
    "text": "be a part of that especially if you're i don't know in the front row you have easy access to the stage but we'll get there it's gonna be a little bit from",
    "start": "188239",
    "end": "194159"
  },
  {
    "text": "now you've got time to psych up for it uh you don't have to talk i'll do all the talking what you're going to do",
    "start": "194159",
    "end": "199280"
  },
  {
    "text": "is you're going to hold this you're going to write numbers on it you might peel one off and stick it on your shirt and write other numbers on it",
    "start": "199280",
    "end": "205120"
  },
  {
    "text": "i've never done this before we're going to see how it goes and you get to be a part of it i should",
    "start": "205120",
    "end": "211360"
  },
  {
    "text": "say i've never done it before i have wanted to do this for years so i am excited that we",
    "start": "211360",
    "end": "218000"
  },
  {
    "text": "finally get to explore the space together anyway so kafka basics just to make sure we're all on the same",
    "start": "218000",
    "end": "224840"
  },
  {
    "start": "220000",
    "end": "337000"
  },
  {
    "text": "page topics now uh kafka is a system for uh managing and logging events",
    "start": "224840",
    "end": "232239"
  },
  {
    "text": "uh one of the the biggest anti-patterns i see for people who are new to kafka and just trying to learn how to think",
    "start": "232239",
    "end": "237280"
  },
  {
    "text": "about it is that they think about it as a cue and that's terrible it's not really a cue it's you the",
    "start": "237280",
    "end": "243599"
  },
  {
    "text": "abstraction you want to think is that it's a log it's a distributed log the difference is that a log stores",
    "start": "243599",
    "end": "249360"
  },
  {
    "text": "things and a queue well doesn't or if it does it does it sort of an incidental way",
    "start": "249360",
    "end": "255280"
  },
  {
    "text": "all right so you have these uh things called topics unfortunately there are message queues",
    "start": "255280",
    "end": "260560"
  },
  {
    "text": "that also have things called topics but we overload terms all the time and you produce",
    "start": "260560",
    "end": "266400"
  },
  {
    "text": "events into that events are modeled as key value pairs that might be important for some of our",
    "start": "266400",
    "end": "271440"
  },
  {
    "text": "uh in-person acted out exercises later um but they they they get produced to these",
    "start": "271440",
    "end": "278639"
  },
  {
    "text": "topics and they're kept in order and that's it and they live in the",
    "start": "278639",
    "end": "284000"
  },
  {
    "text": "topics until you until a time an elapsed time that you specify goes by",
    "start": "284000",
    "end": "291280"
  },
  {
    "text": "so by default that's seven days but you can make it infinity you can make it seven minutes you can make it",
    "start": "291280",
    "end": "296960"
  },
  {
    "text": "whatever you want that um that retention period is a dial you get to set and a kafka topic can be",
    "start": "296960",
    "end": "305360"
  },
  {
    "text": "the place that data goes to live and is the system of record our previous speaker was describing systems uh and",
    "start": "305360",
    "end": "312000"
  },
  {
    "text": "sort of data structures and and things if you were in this room uh that can emerge around a structure",
    "start": "312000",
    "end": "318880"
  },
  {
    "text": "like this when you use a log as your system of records that's what kafka is it is fundamentally a log",
    "start": "318880",
    "end": "324720"
  },
  {
    "text": "however it would not be any fun if it were just one log stored on one server that wouldn't be",
    "start": "324720",
    "end": "331280"
  },
  {
    "text": "very reliable and it wouldn't be very scalable right we want to be able to grow this",
    "start": "331280",
    "end": "336320"
  },
  {
    "text": "beyond just one machine so we're going to partition the log we take that one log that's got",
    "start": "336320",
    "end": "342639"
  },
  {
    "start": "337000",
    "end": "577000"
  },
  {
    "text": "stuff in it and we're going to split it into pieces so now there's one topic in three",
    "start": "342639",
    "end": "349759"
  },
  {
    "text": "partitions and when we act out some of the protocols we're going to go through later i'm going to stick with that three",
    "start": "349759",
    "end": "356000"
  },
  {
    "text": "partitions uh sometimes topics have like 50 partitions and i just wasn't sure how many people",
    "start": "356000",
    "end": "361520"
  },
  {
    "text": "would be in the room and considering what i paid for these post-it notes that would have been like 500 us dollars",
    "start": "361520",
    "end": "366639"
  },
  {
    "text": "to make that work and i think it just would have gotten inconvenient so three is three's a good number we're just going to go with three",
    "start": "366639",
    "end": "372400"
  },
  {
    "text": "um yes you take the log you split it up into pieces and now these logs and by the way these these boxes these logs that's an actual",
    "start": "372400",
    "end": "378560"
  },
  {
    "text": "file right the simplest way to think about that is just as a log file that is stored on a disk somewhere",
    "start": "378560",
    "end": "385120"
  },
  {
    "text": "of course if you really go under the covers it could be several segmented files i mean it",
    "start": "385120",
    "end": "390160"
  },
  {
    "text": "doesn't have to be literally one file but just think of it as there's a file and you append events to that file",
    "start": "390160",
    "end": "395600"
  },
  {
    "text": "but now there's three files we can store them on separate machines those machines by the way i'm going to call them brokers",
    "start": "395600",
    "end": "401759"
  },
  {
    "text": "some of you are going to get to be brokers a little bit you can go home tonight or back to your",
    "start": "401759",
    "end": "406960"
  },
  {
    "text": "hotel if you're traveling here you say today i was a broker and it involved a post-it",
    "start": "406960",
    "end": "412160"
  },
  {
    "text": "note and a sharpie it seemed like it would be harder than that but that's what you got now",
    "start": "412160",
    "end": "418720"
  },
  {
    "text": "here's sort of our first problem that we have to solve this one's really easy when you now have a key value pair and you want to produce that to the topic",
    "start": "418880",
    "end": "426000"
  },
  {
    "text": "you have to decide what partition to write to and the answer to that is a scheme that",
    "start": "426000",
    "end": "431759"
  },
  {
    "text": "shows up all over in all kinds of distributed systems it's called consistent hashing and what we do is we just take the key",
    "start": "431759",
    "end": "437680"
  },
  {
    "text": "and we run it through a hash function it doesn't matter what hash function it is as long as we always use the same one it",
    "start": "437680",
    "end": "442960"
  },
  {
    "text": "doesn't like need to be cryptographically secure or anything like that it just needs to be a hash function that's nice and fast",
    "start": "442960",
    "end": "448800"
  },
  {
    "text": "and all of our producers and all of our brokers are always all of our producers are always using the same hash function",
    "start": "448800",
    "end": "455759"
  },
  {
    "text": "hash function output mod number of partitions gives you the partition number and so",
    "start": "455759",
    "end": "462240"
  },
  {
    "text": "those things will always get produced to the same partition if they have the same key",
    "start": "462240",
    "end": "471199"
  },
  {
    "text": "so um and this is a little bit separate from our concern today so",
    "start": "471199",
    "end": "476240"
  },
  {
    "text": "as quickly as possible i want to get down into some interesting weeds but um ordering in kafka when you're",
    "start": "476240",
    "end": "482400"
  },
  {
    "text": "thinking sort of from an application perspective and not from an operational perspective like we'll be looking at today but from",
    "start": "482400",
    "end": "487759"
  },
  {
    "text": "an application perspective ordering in kafka is by key so once we take up a topic we break it into pieces we",
    "start": "487759",
    "end": "495360"
  },
  {
    "text": "put those pieces on different computers we no longer have a guarantee of global ordering you will never",
    "start": "495360",
    "end": "500960"
  },
  {
    "text": "know globally what the ordering of all the events were however for a given key you'll know those will",
    "start": "500960",
    "end": "507680"
  },
  {
    "text": "always be written to the same log on the same broker and they will always be in order",
    "start": "507680",
    "end": "513760"
  },
  {
    "text": "which when you're brand new to kafka sounds terrible you're like wow i want a cue and why can't i just have something that",
    "start": "513760",
    "end": "519839"
  },
  {
    "text": "acts like a cue it's not broken and you'd be amazed uh how seldom it's actually a problem",
    "start": "519839",
    "end": "526240"
  },
  {
    "text": "it usually doesn't that ordering problem usually doesn't show up and ordering by key is typically what you need every once in",
    "start": "526240",
    "end": "532959"
  },
  {
    "text": "a while you come up with a need for global ordering and those are interesting for how rare",
    "start": "532959",
    "end": "538720"
  },
  {
    "text": "they are and you come up with other ways of solving them with all those ways involve a topic of one partition um but",
    "start": "538720",
    "end": "546880"
  },
  {
    "text": "you know you get there right it's very simple there's one way to do it um by ways",
    "start": "546880",
    "end": "554240"
  },
  {
    "text": "i mean um if you're using kafka you probably have more data than comfortably fits in one partition",
    "start": "554240",
    "end": "561279"
  },
  {
    "text": "right so if you have a global ordering problem you you have some scheme of reducing that",
    "start": "561279",
    "end": "566480"
  },
  {
    "text": "data the kinds of things that you need to order uh in so that it will fit into one partition and i'm just going to leave",
    "start": "566480",
    "end": "572800"
  },
  {
    "text": "that topic for now and produce that remaining key uh yeah so partitions replicas",
    "start": "572800",
    "end": "581360"
  },
  {
    "start": "577000",
    "end": "709000"
  },
  {
    "text": "we're going to talk about how kafka does replication so i just want to tell you what the basic scheme is so everybody's got this",
    "start": "581360",
    "end": "588320"
  },
  {
    "text": "picture in their head here i've got four brokers and one topic",
    "start": "588320",
    "end": "593440"
  },
  {
    "text": "that has four partitions now it does not always need to be that neat right i could have",
    "start": "593440",
    "end": "598560"
  },
  {
    "text": "three brokers and a topic that has 10 partitions these numbers don't need to align at all this just makes this slide pretty so",
    "start": "598560",
    "end": "606160"
  },
  {
    "text": "that's why i picked it and those four partitions i have assigned to the four",
    "start": "606160",
    "end": "612000"
  },
  {
    "text": "brokers this is nice i have scaled out my topic right each one of those machines can handle storage you can handle pub",
    "start": "612000",
    "end": "618480"
  },
  {
    "text": "sub independently the others but if i lose one of those machines i lose my data and that seems bad",
    "start": "618480",
    "end": "624560"
  },
  {
    "text": "so what i'm going to do is i'm going to replicate it and three is a common replication factor this is tunable it doesn't need to be",
    "start": "624560",
    "end": "630560"
  },
  {
    "text": "three sometimes you'll read in tutorials and documentation just the assumption that it's three and",
    "start": "630560",
    "end": "636240"
  },
  {
    "text": "the reality is it almost always is three but it doesn't have to be that's a dial that you set",
    "start": "636240",
    "end": "641440"
  },
  {
    "text": "um but what kafka does is it elects one leader there's one partition",
    "start": "641440",
    "end": "649839"
  },
  {
    "text": "i always say that there's one replica that's the leader so for each partition",
    "start": "650079",
    "end": "656720"
  },
  {
    "text": "we've got three replicas one of those partitions i did it again",
    "start": "656720",
    "end": "662160"
  },
  {
    "text": "one of the it is so hard been doing this for years and the word just won't come out one of those replicas is",
    "start": "662160",
    "end": "668720"
  },
  {
    "text": "the leader and when there's an application that's producing to that topic it does the right to the lead replica",
    "start": "668720",
    "end": "676880"
  },
  {
    "text": "so whatever broker the lead replica is on that's the one it sends the right to",
    "start": "676880",
    "end": "682079"
  },
  {
    "text": "and when you read you read from that leader also i'm going to repeat that later but",
    "start": "682079",
    "end": "688720"
  },
  {
    "text": "the reading and writing is to the leader and the others are there just for redundancy and so that way for example when one of",
    "start": "688720",
    "end": "696079"
  },
  {
    "text": "those goes away the we're able to elect a new leader like we did here where's my pointer",
    "start": "696079",
    "end": "702320"
  },
  {
    "text": "there it is uh now suddenly broker two is the leader for that partition",
    "start": "702320",
    "end": "707600"
  },
  {
    "text": "uh there so basics a few more things i mentioned producers producer is just a program that writes",
    "start": "708640",
    "end": "714800"
  },
  {
    "start": "709000",
    "end": "746000"
  },
  {
    "text": "to a topic it's client application this is what you actually write when you're running a kafka cluster when you're building",
    "start": "714800",
    "end": "720639"
  },
  {
    "text": "applications on kafka you write a program that's a producer and you can do that with an api called",
    "start": "720639",
    "end": "727200"
  },
  {
    "text": "the producer api that's very very low level and just lets you put messages into topics and there's more",
    "start": "727200",
    "end": "732399"
  },
  {
    "text": "there's higher level apis and and other ways to be a consumer that are not quite so explicit",
    "start": "732399",
    "end": "737839"
  },
  {
    "text": "uh that let you deal with higher level abstractions of stream processing uh and not thinking explicitly about you",
    "start": "737839",
    "end": "744000"
  },
  {
    "text": "know putting a message in somewhere consumers likewise um these are ways of getting messages out",
    "start": "744000",
    "end": "752079"
  },
  {
    "start": "746000",
    "end": "1029000"
  },
  {
    "text": "and a couple interesting points that that are distinguishing features of kafka one",
    "start": "752079",
    "end": "758399"
  },
  {
    "text": "is that consuming a message doesn't make the message go away it's just it's non-destructively reading it",
    "start": "758399",
    "end": "764560"
  },
  {
    "text": "so that means i can have more than one consumer on a topic so if i've got some event",
    "start": "764560",
    "end": "770000"
  },
  {
    "text": "stream and i don't know say two services that want to consume that event stream",
    "start": "770000",
    "end": "776639"
  },
  {
    "text": "you know what you folks i'd even give you three if you wanted three or if you wanted a few thousand it would",
    "start": "776639",
    "end": "784000"
  },
  {
    "text": "be okay to have a few thousand different consumers that are consuming from one topic",
    "start": "784000",
    "end": "789600"
  },
  {
    "text": "um because consuming does not destroy you can have many interests on one event",
    "start": "789600",
    "end": "796079"
  },
  {
    "text": "stream many applications that are reading that one event stream and because consuming might be",
    "start": "796079",
    "end": "802240"
  },
  {
    "text": "computationally expensive we can scale out a consumer group you",
    "start": "802240",
    "end": "807680"
  },
  {
    "text": "can just add another instance of a consumer group and that consumer group gets partitions",
    "start": "807680",
    "end": "813680"
  },
  {
    "text": "assigned to it we will act this out this is one of the things that will be reduced to post-it notes on sharpies",
    "start": "813680",
    "end": "819760"
  },
  {
    "text": "and the kinds of people who like to be on stage because this is a volunteer effort so it",
    "start": "819760",
    "end": "825440"
  },
  {
    "text": "has to be people who want to be on stage oh i just i just realized that could be where this whole plan falls apart",
    "start": "825440",
    "end": "831760"
  },
  {
    "text": "no in a room this size there's got to be six people who like attention so anyway uh this is a",
    "start": "831760",
    "end": "840560"
  },
  {
    "text": "hugely important part of kafka that once i've got a consuming application if i deploy a second instance of that",
    "start": "840560",
    "end": "846480"
  },
  {
    "text": "if there are more partitions to distribute like there are three partitions here um i can",
    "start": "846480",
    "end": "852160"
  },
  {
    "text": "deploy yet another instance of that consumer and it will get a partition assigned to it",
    "start": "852160",
    "end": "857360"
  },
  {
    "text": "so i can i can without doing really anything that i'm aware of at the application",
    "start": "857360",
    "end": "862480"
  },
  {
    "text": "level i'm just using the consumer api i get this horizontally scalable uh",
    "start": "862480",
    "end": "868240"
  },
  {
    "text": "thing i become horizontally scalable and that's that's because of the the",
    "start": "868240",
    "end": "873440"
  },
  {
    "text": "consumer group protocol which we're going to look at in some detail",
    "start": "873440",
    "end": "878560"
  },
  {
    "text": "um now uh how much more do i want to say",
    "start": "879279",
    "end": "884800"
  },
  {
    "text": "about that not too much it's super useful it's a thing that gets",
    "start": "884800",
    "end": "892160"
  },
  {
    "text": "reused in a number of interesting ways in different parts of kafka we'll talk about that it's also not uh perfect",
    "start": "892160",
    "end": "900160"
  },
  {
    "text": "the the consumer group thing so it distributes work to some set of workers",
    "start": "900160",
    "end": "906959"
  },
  {
    "text": "that is partitions to consumer group members but there are things it doesn't do and",
    "start": "906959",
    "end": "913680"
  },
  {
    "text": "this is why higher level apis like the kafka streams api and languages like k-sequel exist",
    "start": "913680",
    "end": "920560"
  },
  {
    "text": "because there are some thorny state management prop application side state management problems",
    "start": "920560",
    "end": "925600"
  },
  {
    "text": "that the consumer group pro the consumer group protocol doesn't address and i just want to leave that as a",
    "start": "925600",
    "end": "930639"
  },
  {
    "text": "little flag in your head when if you're new to kafka and you're sort of tickled by the interesting",
    "start": "930639",
    "end": "937600"
  },
  {
    "text": "uh distributed systems problems that i'm that i'm presenting here and you look into kafka more when you",
    "start": "937600",
    "end": "942720"
  },
  {
    "text": "look into kafka as an application programmer um and you're using that consumer group",
    "start": "942720",
    "end": "947759"
  },
  {
    "text": "consumer group api or consumer api and you remember oh tim said this was really cool and look at all this assigning that it's doing of",
    "start": "947759",
    "end": "954000"
  },
  {
    "text": "work and i remember that there are still reasons to look at things like kafka streams",
    "start": "954000",
    "end": "959279"
  },
  {
    "text": "for developing uh stateful stream processing applications rather than just using consumers vanilla",
    "start": "959279",
    "end": "965600"
  },
  {
    "text": "consumers all the time kafka streams of course is built on top of the consumer api",
    "start": "965600",
    "end": "971839"
  },
  {
    "text": "there is no way that really the only thing anybody ever does to kafka",
    "start": "971839",
    "end": "977440"
  },
  {
    "text": "is be a producer or be a consumer that's what you can do kafka has its own communication between",
    "start": "977440",
    "end": "984240"
  },
  {
    "text": "brokers and its own replication problems it's solving and these interesting interactions between clients",
    "start": "984240",
    "end": "990560"
  },
  {
    "text": "and brokers that we're going to get into but as far as you know all you do is you put events into topics",
    "start": "990560",
    "end": "998720"
  },
  {
    "text": "and you get events out of topics and there could be any number of more abstract ways of doing that",
    "start": "998720",
    "end": "1004320"
  },
  {
    "text": "like a functional stream processing api like kafka streams or a streaming sql like k-sql",
    "start": "1004320",
    "end": "1011920"
  },
  {
    "text": "you're still just a producer and a consumer everything's a producer and a consumer so what i've given you so far just this",
    "start": "1011920",
    "end": "1017839"
  },
  {
    "text": "15-minute summary of kafka is actually adequate as a set of",
    "start": "1017839",
    "end": "1023440"
  },
  {
    "text": "abstractions for you to think about it's it's it's it's all that you need for groundwork",
    "start": "1023440",
    "end": "1030240"
  },
  {
    "start": "1029000",
    "end": "1514000"
  },
  {
    "text": "but let's um let's let's get into the the",
    "start": "1031679",
    "end": "1040000"
  },
  {
    "text": "pieces i want to talk about a part of kafka called the controller this is foundational this uh we need",
    "start": "1040000",
    "end": "1048000"
  },
  {
    "text": "the controller to think about how replication works and i want to talk about replication so i want to start with the controller and",
    "start": "1048000",
    "end": "1054799"
  },
  {
    "text": "i want to remind you of some things i just said these are important facts about kafka that we need to keep in mind",
    "start": "1054799",
    "end": "1062720"
  },
  {
    "text": "to think about what the controller is and what it does first of all remember that partitions",
    "start": "1062720",
    "end": "1068400"
  },
  {
    "text": "are replicated all right we take topics we split them into pieces and we take those pieces",
    "start": "1068400",
    "end": "1074000"
  },
  {
    "text": "and we make copies of them now one of the great things architecturally about kafka is that it's",
    "start": "1074000",
    "end": "1081280"
  },
  {
    "text": "a system as i said for dealing with events and what do we know about events as data",
    "start": "1081280",
    "end": "1087360"
  },
  {
    "text": "structures they're immutable right it's so great",
    "start": "1087360",
    "end": "1094559"
  },
  {
    "text": "i mean sometimes it's great it's you think about like events in your life you ever done anything you regret or",
    "start": "1094559",
    "end": "1100960"
  },
  {
    "text": "said anything you regret i mean i i'm not going to tell you but i certainly could um",
    "start": "1100960",
    "end": "1106720"
  },
  {
    "text": "yeah you can't change those things the event has been produced and maybe you'll forget it uh it's hard",
    "start": "1106720",
    "end": "1112640"
  },
  {
    "text": "to set the retention period on your life um except for like when you die but",
    "start": "1112640",
    "end": "1118960"
  },
  {
    "text": "yeah events are immutable sometimes tragically but as data structures that's never a tragedy it's good",
    "start": "1118960",
    "end": "1124880"
  },
  {
    "text": "and that's a great simplifying assumption lets us get away with all kinds of behavior in event driven systems that would be uh",
    "start": "1124880",
    "end": "1131360"
  },
  {
    "text": "harmful when uh with a database based system or sort of an entity based system uh so it's good that",
    "start": "1131360",
    "end": "1139440"
  },
  {
    "text": "events are immutable that's a very helpful thing partitions themselves are not immutable",
    "start": "1139440",
    "end": "1144799"
  },
  {
    "text": "because you add to them right the actual partition and the replica of the partition is a thing that",
    "start": "1144799",
    "end": "1150400"
  },
  {
    "text": "you change and the fact that we're going to replicate partitions means now we have these mutable objects",
    "start": "1150400",
    "end": "1156799"
  },
  {
    "text": "that whose state we need to keep consistent in the system so that's a three-word",
    "start": "1156799",
    "end": "1162480"
  },
  {
    "text": "bullet but it's it's there's lots of pain that results from that okay as i said rights when i'm producing that always",
    "start": "1162480",
    "end": "1169200"
  },
  {
    "text": "goes to the lead replica partitions are replicated there's a leader and followers for n",
    "start": "1169200",
    "end": "1175520"
  },
  {
    "text": "replicas there's one liter there's n minus one followers rights always go to the lead replica",
    "start": "1175520",
    "end": "1181440"
  },
  {
    "text": "followers ask the leader for new rights so",
    "start": "1181440",
    "end": "1188080"
  },
  {
    "text": "i'm a producer i produce to the lead replica of the partition of",
    "start": "1188080",
    "end": "1194559"
  },
  {
    "text": "the topic that i'm writing to i don't then go to the followers and produce to",
    "start": "1194559",
    "end": "1201039"
  },
  {
    "text": "them that follower doesn't then go to its followers and say hey guys",
    "start": "1201039",
    "end": "1206400"
  },
  {
    "text": "i have stuff for you hey guys what are you doing right now i have some rights and it just doesn't do that so those followers have the responsibility of",
    "start": "1206400",
    "end": "1212880"
  },
  {
    "text": "periodically going and asking their leaders for what new rights exist",
    "start": "1212880",
    "end": "1221520"
  },
  {
    "text": "uh we always read from the leader when i'm a consumer and i'm reading i don't read from followers i read from",
    "start": "1221520",
    "end": "1228320"
  },
  {
    "text": "the leader so this makes it easier for us to reason about consistency and i hope when we act this out i hope",
    "start": "1228320",
    "end": "1236960"
  },
  {
    "text": "uh it'll make sense how we how we do this uh why is that asterisk there that is",
    "start": "1236960",
    "end": "1242960"
  },
  {
    "text": "troubling me who put that there okay that's because in um what was it 2.4",
    "start": "1242960",
    "end": "1251200"
  },
  {
    "text": "is it apache okay i'm going to get my versions confused so i'm not going to say a number a recent release we have introduced or",
    "start": "1251200",
    "end": "1259760"
  },
  {
    "text": "the idea has been introduced of a kind of replica that is asynchronous so it's a follower",
    "start": "1259760",
    "end": "1266720"
  },
  {
    "text": "and it's asynchronously replicated and you can get a consumer to read from it it's called an observer replica",
    "start": "1266720",
    "end": "1273039"
  },
  {
    "text": "and that's a footnote google it check it out i'm not talking about observers today but i needed to put that asterisk there",
    "start": "1273039",
    "end": "1278960"
  },
  {
    "text": "because for purposes of keeping this simple i want to say reads always come from the leader and i don't want anybody",
    "start": "1278960",
    "end": "1284960"
  },
  {
    "text": "who knows better to be mad so yes there are observers no we're not going to talk about observers",
    "start": "1284960",
    "end": "1292880"
  },
  {
    "text": "when is a right considered a right is it considered a right when i send it",
    "start": "1294159",
    "end": "1300240"
  },
  {
    "text": "and i hope maybe it got written somewhere is it considered a successful right when the leader",
    "start": "1300240",
    "end": "1306159"
  },
  {
    "text": "acknowledges it and writes it to disk is it considered a right when the leader writes it to disk and all the followers",
    "start": "1306159",
    "end": "1313200"
  },
  {
    "text": "have written it to disk these are all options okay um i these are it's all tunable at",
    "start": "1313200",
    "end": "1319200"
  },
  {
    "text": "the producer level and um that is there just as a note i don't want to talk about the tunable",
    "start": "1319200",
    "end": "1325520"
  },
  {
    "text": "producer settings in detail but um what constitutes a successful write is a thing you get to determine",
    "start": "1325520",
    "end": "1332240"
  },
  {
    "text": "and that is your trade-off of durability versus latency this is also very important when i'm",
    "start": "1332240",
    "end": "1339039"
  },
  {
    "text": "reading i can only read data so i just said what constitutes a successful right is",
    "start": "1339039",
    "end": "1345280"
  },
  {
    "text": "up to you does it have to get to the followers it doesn't have to if you don't want it to but when i'm consuming",
    "start": "1345280",
    "end": "1351679"
  },
  {
    "text": "i can only consume data that has gotten to the followers",
    "start": "1351679",
    "end": "1356799"
  },
  {
    "text": "so consuming i'm only able to see stuff that is fully replicated",
    "start": "1356799",
    "end": "1362960"
  },
  {
    "text": "if you play the part of a consumer later you may have well no you actually if you're playing the part of a consumer you get",
    "start": "1362960",
    "end": "1368400"
  },
  {
    "text": "what you get if you play the part of a lead replica later you may have to know that oh this is going to be complicated",
    "start": "1368400",
    "end": "1374559"
  },
  {
    "text": "all right uh fine what what is the controller the controller is a broker all right there is one broker in the",
    "start": "1374559",
    "end": "1381280"
  },
  {
    "text": "kafka cluster that is elected as the controller there's always one",
    "start": "1381280",
    "end": "1387600"
  },
  {
    "text": "uh the it's by default it's the first broker that comes up in a kafka cluster it gets to be the controller",
    "start": "1387600",
    "end": "1393679"
  },
  {
    "text": "if it goes down well a new one is elected there is always one its job is to monitor the health of all",
    "start": "1393679",
    "end": "1400000"
  },
  {
    "text": "the other brokers in the cluster and when a broker fails",
    "start": "1400000",
    "end": "1408960"
  },
  {
    "text": "remember those brokers we've got all these these partitions scattered all over my cluster right i've",
    "start": "1408960",
    "end": "1416000"
  },
  {
    "text": "got i've got say three brokers let's go with three because we're gonna do three later",
    "start": "1416000",
    "end": "1421120"
  },
  {
    "text": "i should call people up now but you'd be standing for a while i don't wanna do that yet but please have in mind whether you're ready",
    "start": "1421120",
    "end": "1426400"
  },
  {
    "text": "to come up here because i when when it's time it's going to be time um",
    "start": "1426400",
    "end": "1432799"
  },
  {
    "text": "for any given broker you are you are the follower for some partitions and you're the",
    "start": "1435039",
    "end": "1440400"
  },
  {
    "text": "leader for others and when you die and you will die",
    "start": "1440400",
    "end": "1448000"
  },
  {
    "text": "just like you've done things you regret this is another sad fact you're going it means just be such a dark talk it",
    "start": "1448000",
    "end": "1453440"
  },
  {
    "text": "should be a happy thing but distributed systems are are painful i think they bring out the melancholy in all of us",
    "start": "1453440",
    "end": "1459200"
  },
  {
    "text": "um the the replicas for which you are",
    "start": "1459200",
    "end": "1465440"
  },
  {
    "text": "leader now have to go to somebody else so it's the job of the controller",
    "start": "1465440",
    "end": "1470640"
  },
  {
    "text": "to mediate that election of new leaders so some other broker who was a follower",
    "start": "1470640",
    "end": "1477760"
  },
  {
    "text": "replica for that same partition is going to get elected as the leader",
    "start": "1477760",
    "end": "1483120"
  },
  {
    "text": "and the controller mediates that process then when that has happened the",
    "start": "1483120",
    "end": "1488640"
  },
  {
    "text": "controller tells all of the other brokers hey by the way there's a new leader in town for replica",
    "start": "1488640",
    "end": "1496640"
  },
  {
    "text": "6 of topic page views replica six of partition one of topic",
    "start": "1496640",
    "end": "1503039"
  },
  {
    "text": "page views uh all the other brokers need to do that all the brokers know you know have that metadata they all",
    "start": "1503039",
    "end": "1509120"
  },
  {
    "text": "know uh who's got what partition and who's the leader so that that has to get communicated well how does this voting",
    "start": "1509120",
    "end": "1514720"
  },
  {
    "start": "1514000",
    "end": "1759000"
  },
  {
    "text": "work um it's very simple in zookeeper um",
    "start": "1514720",
    "end": "1523200"
  },
  {
    "text": "zookeeper okay so i think of zookeeper as like a hierarchical uh in-memory like a tree like a",
    "start": "1523200",
    "end": "1531200"
  },
  {
    "text": "hierarchical sort of file system looking thing and i can i can write things to paths and i have a path called slash",
    "start": "1531200",
    "end": "1537039"
  },
  {
    "text": "controller in zookeeper and this is a special kind of node",
    "start": "1537039",
    "end": "1542400"
  },
  {
    "text": "the things you write zookeeper are called nodes that's an ephemeral node to create an ephemeral node you just use",
    "start": "1542400",
    "end": "1547600"
  },
  {
    "text": "the api to say hey zookeeper i want an ephemeral node and you the creator of that ephemeral node keep a session to that thing",
    "start": "1547600",
    "end": "1554640"
  },
  {
    "text": "so it's there as long as you're connected to it as long as that session is up and when that session goes away the node",
    "start": "1554640",
    "end": "1560000"
  },
  {
    "text": "goes away it seems convenient we might be able to use that so um when the broker boots it tries to write a little description of itself to",
    "start": "1560000",
    "end": "1566320"
  },
  {
    "text": "that controller node and the first right winds when the controller dies the session expires",
    "start": "1566320",
    "end": "1571520"
  },
  {
    "text": "and the next broker in line now wins because the first broker to right controller",
    "start": "1571520",
    "end": "1576640"
  },
  {
    "text": "became became controller the second broker to come up tried to and is kind of like in line",
    "start": "1576640",
    "end": "1582159"
  },
  {
    "text": "waiting to do that right and it knows it has not become controller until the first session goes away and",
    "start": "1582159",
    "end": "1587760"
  },
  {
    "text": "then it wins so zookeeper gives us this nice way of doing this now",
    "start": "1587760",
    "end": "1593120"
  },
  {
    "text": "pardon me if you're following kafka news there is an important kip or kafka",
    "start": "1593120",
    "end": "1598640"
  },
  {
    "text": "improvement proposal called kip 500 uh that has to do with killing zookeeper and if you operate a",
    "start": "1598640",
    "end": "1605039"
  },
  {
    "text": "kafka cluster you've wanted to kill zookeeper for years it's okay zookeeper really never did anything",
    "start": "1605039",
    "end": "1611039"
  },
  {
    "text": "intentionally to hurt you it's just been this workhorse of an effective little strongly consistent uh quorum",
    "start": "1611039",
    "end": "1617919"
  },
  {
    "text": "thing um but yeah kafka is getting rid of zookeeper um and so a year and a half from now this talk",
    "start": "1617919",
    "end": "1623760"
  },
  {
    "text": "will have to change to talk about how the the post zookeeper world works okay um",
    "start": "1623760",
    "end": "1630720"
  },
  {
    "text": "i'm actually going to skip this and um",
    "start": "1630720",
    "end": "1636480"
  },
  {
    "text": "i'm going gonna go here okay um so uh here's an example of of what the controller might manage a controlled shutdown of a broker say i'm",
    "start": "1638799",
    "end": "1645600"
  },
  {
    "text": "killing a broker right i send a sig term to a broker to the the jvm process that broker then tells the controller",
    "start": "1645600",
    "end": "1650960"
  },
  {
    "text": "hey i'm going down the broker then says okay there are uh",
    "start": "1650960",
    "end": "1657039"
  },
  {
    "text": "300 part replicas for which your leader and i'm going to go through them one at",
    "start": "1657039",
    "end": "1662559"
  },
  {
    "text": "a time and find the next person in line the next broker in line is going to be the new leader for those partitions",
    "start": "1662559",
    "end": "1668480"
  },
  {
    "text": "and i'm going to tell that broker it's the leader for those partitions now and then i'm going to tell everybody else that it's the leader for those",
    "start": "1668480",
    "end": "1674399"
  },
  {
    "text": "partitions now forms the leaders and forms the rest of the brokers likewise if the broker fails same kind",
    "start": "1674399",
    "end": "1681600"
  },
  {
    "text": "of thing there's a broker failure uh scenario",
    "start": "1681600",
    "end": "1687039"
  },
  {
    "text": "uh but this is initiated by the controller when it sees a broker no longer",
    "start": "1687039",
    "end": "1692399"
  },
  {
    "text": "responding so when it sees a broker die it basically just goes through the shutdown scenario so the same thing",
    "start": "1692399",
    "end": "1699039"
  },
  {
    "text": "i already talked about controller failure so that's the controller and that gets us",
    "start": "1700880",
    "end": "1707120"
  },
  {
    "text": "to the replication protocol which relies on the broker",
    "start": "1707120",
    "end": "1713919"
  },
  {
    "text": "which relies on these and these so we're going to start doing things in",
    "start": "1714080",
    "end": "1719520"
  },
  {
    "text": "just a few minutes all right replication remember um just like we talked about some basics with the controller i want to talk about some",
    "start": "1719520",
    "end": "1725279"
  },
  {
    "text": "basics with replication the log is a sequence of records and those",
    "start": "1725279",
    "end": "1731039"
  },
  {
    "text": "records are immutable um we want to replicate each partition each",
    "start": "1731039",
    "end": "1736880"
  },
  {
    "text": "log there's one leader n minus one followers",
    "start": "1736880",
    "end": "1743520"
  },
  {
    "text": "good producers always write to the leader consumers always read from the leader followers query the leader for new",
    "start": "1743520",
    "end": "1750840"
  },
  {
    "text": "replicas so if you're a follower it's your job to reach out to your leader and get the",
    "start": "1750840",
    "end": "1756559"
  },
  {
    "text": "new stuff which gets us to another term so-called",
    "start": "1756559",
    "end": "1763200"
  },
  {
    "start": "1759000",
    "end": "1855000"
  },
  {
    "text": "in-sync replicas better known to the world as isrs um i never was a fan i",
    "start": "1763200",
    "end": "1769679"
  },
  {
    "text": "just age-wise kind of miss them no harm um you know it's fine but uh",
    "start": "1769679",
    "end": "1776559"
  },
  {
    "text": "this joke gets made occasionally so a replica is considered in sync if it is within a certain number",
    "start": "1776559",
    "end": "1783600"
  },
  {
    "text": "of messages or a certain amount of time of the leader by default a replica is",
    "start": "1783600",
    "end": "1789840"
  },
  {
    "text": "out of sync if it is more than 10 seconds behind the leader these are tunable things i can set this",
    "start": "1789840",
    "end": "1795760"
  },
  {
    "text": "to a number of messages in an amount of time but rather than just saying a replica is",
    "start": "1795760",
    "end": "1802000"
  },
  {
    "text": "live or dead we consider a replica in sync or out of sync",
    "start": "1802000",
    "end": "1808320"
  },
  {
    "text": "um so a slow replica may drop out of this list and so the the",
    "start": "1808320",
    "end": "1815440"
  },
  {
    "text": "live followers who are eligible for leader election when we die",
    "start": "1815440",
    "end": "1820640"
  },
  {
    "text": "as leader are the isrs or the nsync replicas you have to be in",
    "start": "1820640",
    "end": "1826640"
  },
  {
    "text": "sync note to be in sync you can still be behind",
    "start": "1826640",
    "end": "1832559"
  },
  {
    "text": "you can still be behind there can be messages that i've got as the leader that none of my followers",
    "start": "1832559",
    "end": "1838640"
  },
  {
    "text": "have think about that that's just going to be true all the time right stuff gets written to me they haven't gotten around to asking they're always behind",
    "start": "1838640",
    "end": "1845200"
  },
  {
    "text": "so in sync is this fuzzy thing but i might be able to elect them as a leader",
    "start": "1845200",
    "end": "1850320"
  },
  {
    "text": "even though they've got messages i don't have and that's okay for reasons that i hope",
    "start": "1850320",
    "end": "1855679"
  },
  {
    "start": "1855000",
    "end": "1971000"
  },
  {
    "text": "are going to be clear all right um recall that for each partition zookeeper in this",
    "start": "1855679",
    "end": "1862000"
  },
  {
    "text": "case played by me um knows the leader a thing called the epic which we're not gonna need",
    "start": "1862000",
    "end": "1867440"
  },
  {
    "text": "and the isr list so for for every partition i know who's the leader and i know what followers are in sync",
    "start": "1867440",
    "end": "1874720"
  },
  {
    "text": "i also can define a thing called the high water mark this is the thing that the leader knows",
    "start": "1874720",
    "end": "1882320"
  },
  {
    "text": "the leader knows the high water mark which is the highest replicated offset offsets just the",
    "start": "1882320",
    "end": "1887360"
  },
  {
    "text": "number of the message in the log common to all the partitions in the isr list like i said",
    "start": "1887360",
    "end": "1892559"
  },
  {
    "text": "i as the leader i will always have messages that you followers don't it's fine i'm not hold your applause um",
    "start": "1892559",
    "end": "1900880"
  },
  {
    "text": "it's always super awkward right like oh it wasn't an applause line um yeah so people are writing to me and",
    "start": "1900880",
    "end": "1906880"
  },
  {
    "text": "the followers are always after that coming and asking for new messages uh so i'm always gonna have stuff they",
    "start": "1906880",
    "end": "1912960"
  },
  {
    "text": "don't um and and they'll be caught up to various levels and i will know because they",
    "start": "1912960",
    "end": "1918960"
  },
  {
    "text": "asked me at the time they asked me what offsets i gave to them and when i send those off and they say",
    "start": "1918960",
    "end": "1925360"
  },
  {
    "text": "okay got em and they acknowledge that then i'll know okay everybody's caught up through",
    "start": "1925360",
    "end": "1930720"
  },
  {
    "text": "offset five hundred 148 six that's my high water mark and i'll get ten new messages produced",
    "start": "1930720",
    "end": "1937440"
  },
  {
    "text": "but my high water mark is still back here and so i'll know i'm ahead of the high water mark but that high water mark",
    "start": "1937440",
    "end": "1943039"
  },
  {
    "text": "means everybody's got those that's important because i am not allowed to expose messages",
    "start": "1943039",
    "end": "1948640"
  },
  {
    "text": "to a reader past the high watermark the contract is for it to be readable it",
    "start": "1948640",
    "end": "1954399"
  },
  {
    "text": "has to be fully replicated any broker can die and i can and i",
    "start": "1954399",
    "end": "1960240"
  },
  {
    "text": "won't lose those messages if i have allowed them to be readable and i just said that got ahead of that",
    "start": "1960240",
    "end": "1967760"
  },
  {
    "text": "bullet should have clicked okay here we are i need three replicas one producer",
    "start": "1967760",
    "end": "1973840"
  },
  {
    "start": "1971000",
    "end": "2154000"
  },
  {
    "text": "one consumer",
    "start": "1973840",
    "end": "1977840"
  },
  {
    "text": "now it's time for volunteers no really i understand",
    "start": "1978880",
    "end": "1987919"
  },
  {
    "text": "they warned me step right up step right up love it",
    "start": "1989519",
    "end": "1997140"
  },
  {
    "text": "[Applause]",
    "start": "1997140",
    "end": "2003519"
  },
  {
    "text": "hmm house lights um ben i didn't even know you're here",
    "start": "2003519",
    "end": "2009440"
  },
  {
    "text": "either we work together ben you're going to be a broker",
    "start": "2009440",
    "end": "2014799"
  },
  {
    "text": "awesome hugh you're a broker roll your broker i need one more person",
    "start": "2014799",
    "end": "2021120"
  },
  {
    "text": "ron you're a um consumer lars you're a producer here we are",
    "start": "2021120",
    "end": "2027760"
  },
  {
    "text": "sharpies sharpies i paid 20 pounds for these sharpies what kind",
    "start": "2027760",
    "end": "2033440"
  },
  {
    "text": "of a world is this all right um so i would like you guys",
    "start": "2033440",
    "end": "2038880"
  },
  {
    "text": "to write uh just b1 in big letters so that they can see them back there",
    "start": "2038880",
    "end": "2043919"
  },
  {
    "text": "b1 b2 b3 you're the brokers um uh just write consumer",
    "start": "2043919",
    "end": "2052000"
  },
  {
    "text": "and do i have yeah i have a producer i have a consumer and write producer and big letters there",
    "start": "2052000",
    "end": "2057040"
  },
  {
    "text": "and probably good if you just take those often",
    "start": "2057040",
    "end": "2062158"
  },
  {
    "text": "just stick them on you",
    "start": "2062639",
    "end": "2074398"
  },
  {
    "text": "i hate it when i do that i actually emceed a kafka summit once and jumped up",
    "start": "2074399",
    "end": "2081200"
  },
  {
    "text": "on stage in nice sprightly tim fashion and my lab fell down in the first five minutes i had no",
    "start": "2081200",
    "end": "2087440"
  },
  {
    "text": "microphone it happens but we're back we're back um okay",
    "start": "2087440",
    "end": "2093358"
  },
  {
    "text": "so um",
    "start": "2093359",
    "end": "2096078"
  },
  {
    "text": "uh ben you are also going to be the leader awesome yes you just want to put like l",
    "start": "2100480",
    "end": "2107520"
  },
  {
    "text": "on there and uh broker three broker one put an f underneath your your broker",
    "start": "2107520",
    "end": "2113040"
  },
  {
    "text": "your followers now um",
    "start": "2113040",
    "end": "2118960"
  },
  {
    "text": "producer i would like your job to come up with the messages all right",
    "start": "2120480",
    "end": "2127440"
  },
  {
    "text": "this is creativity on your part and i would like you to um keep them short so these guys can",
    "start": "2127440",
    "end": "2134160"
  },
  {
    "text": "write them because ben is going to have to write things so i'm thinking positive integers that are small",
    "start": "2134160",
    "end": "2139440"
  },
  {
    "text": "would be good as messages or short words that are easy to spell",
    "start": "2139440",
    "end": "2144560"
  },
  {
    "text": "and so on your your next piece of paper on your pad uh brokers this is going to be your",
    "start": "2144560",
    "end": "2150640"
  },
  {
    "text": "actual log and remember messages are key value pairs we don't need to know that right now",
    "start": "2150640",
    "end": "2157200"
  },
  {
    "start": "2154000",
    "end": "2483000"
  },
  {
    "text": "just the value is fine in fact we'll sometimes people produce messages using no key at all",
    "start": "2157200",
    "end": "2164320"
  },
  {
    "text": "animals right but we're not animals but just keep it simple",
    "start": "2164320",
    "end": "2171280"
  },
  {
    "text": "just a value a number is fine a word is fine too and in fact if you want here's a smaller",
    "start": "2171280",
    "end": "2178640"
  },
  {
    "text": "pad you can actually write your message on that and you can walk it over to ben",
    "start": "2178640",
    "end": "2184560"
  },
  {
    "text": "and now ben you're going to receive that message so producer go ahead and produce",
    "start": "2184560",
    "end": "2191040"
  },
  {
    "text": "okay uh what do we got the number one ladies gentleman round of applause",
    "start": "2193839",
    "end": "2201838"
  },
  {
    "text": "ah yes okay so uh uh producer i'd like you well so now producer hang on a second wait don't do that yet",
    "start": "2203440",
    "end": "2209359"
  },
  {
    "text": "um uh you would need to connect to a",
    "start": "2209359",
    "end": "2214560"
  },
  {
    "text": "bootstrap broker and uh identify the topic that you want to write to",
    "start": "2214560",
    "end": "2220079"
  },
  {
    "text": "and um that that uh you'd get some metadata back",
    "start": "2220079",
    "end": "2226560"
  },
  {
    "text": "saying what partitions that topic had and you would hash your key or if you",
    "start": "2226560",
    "end": "2231760"
  },
  {
    "text": "didn't have a key do some other things and then you'd make a decision uh that that that partition is the one you want",
    "start": "2231760",
    "end": "2238240"
  },
  {
    "text": "to write to okay so we've got i've selected a single partition of this broker and left all that stuff",
    "start": "2238240",
    "end": "2244880"
  },
  {
    "text": "out of the process because it would just be ugly so you know that the",
    "start": "2244880",
    "end": "2249920"
  },
  {
    "text": "bend partition is the one you want to write to and you're going to set go take it over to the leaders you can go take that message",
    "start": "2249920",
    "end": "2255599"
  },
  {
    "text": "over to broker two and give it to him okay now broker two that's one way to log it right you just",
    "start": "2255599",
    "end": "2261839"
  },
  {
    "text": "write that um that actually works you have to assign it an offset yeah it's true yeah so if you want to sign in an offset",
    "start": "2261839",
    "end": "2271040"
  },
  {
    "text": "and i kind of like this okay that's offset zero would you like to produce another number producer yes excellent",
    "start": "2271040",
    "end": "2278480"
  },
  {
    "text": "what if i said no well i would fail you over",
    "start": "2278800",
    "end": "2285839"
  },
  {
    "text": "i can do that 42 excellent number excellent number all right once you go ahead and produce that and um",
    "start": "2286000",
    "end": "2293599"
  },
  {
    "text": "ben if you would assign that on offset please",
    "start": "2293599",
    "end": "2299839"
  },
  {
    "text": "okay good just one more one more and uh this is fine you can stick those on your body wherever you",
    "start": "2300000",
    "end": "2305200"
  },
  {
    "text": "like that no i'm gonna that's no i didn't",
    "start": "2305200",
    "end": "2310240"
  },
  {
    "text": "mean that uh okay good good no this is kafka is untyped it's fine",
    "start": "2310240",
    "end": "2316160"
  },
  {
    "text": "um we're not using schema registry right now which is bozil for the project but hey we're just",
    "start": "2316160",
    "end": "2321520"
  },
  {
    "text": "getting started so okay now um and that is now gonna be uh offset three",
    "start": "2321520",
    "end": "2327040"
  },
  {
    "text": "and i think that's enough messages for now we're gonna do one more don't worry um",
    "start": "2327040",
    "end": "2333680"
  },
  {
    "text": "okay follower one if you could um i know ben looks busy but if you could just ask",
    "start": "2333680",
    "end": "2338839"
  },
  {
    "text": "him ask him ask him if he's got any messages",
    "start": "2338839",
    "end": "2345760"
  },
  {
    "text": "that's not true actually not true and and so ben you would then show you",
    "start": "2346240",
    "end": "2353280"
  },
  {
    "text": "you'd send a copy of them over the network but you can just show him he's right there we don't need to be pedantic",
    "start": "2353280",
    "end": "2360480"
  },
  {
    "text": "and follower one is gonna do that and uh broker three would you also ask the follower if he's got any",
    "start": "2361200",
    "end": "2367280"
  },
  {
    "text": "messages i just want you to write those down",
    "start": "2367280",
    "end": "2370640"
  },
  {
    "text": "okay stop right there at two so you've got two of them written down right um you just had a major gc pause",
    "start": "2372400",
    "end": "2379920"
  },
  {
    "text": "um could you could you turn around okay good consumer uh you would like to",
    "start": "2379920",
    "end": "2386880"
  },
  {
    "text": "read from this topic and you happen to know again making it simple that your follow your your leader is ben and so",
    "start": "2386880",
    "end": "2393440"
  },
  {
    "text": "could you go over to ben and ask him what he's got",
    "start": "2393440",
    "end": "2399280"
  },
  {
    "text": "now which messages can ben expose",
    "start": "2402800",
    "end": "2407200"
  },
  {
    "text": "the high water mark is right here so offset zero and one he can't expose",
    "start": "2408720",
    "end": "2414880"
  },
  {
    "text": "number two he's got it it's in his log okay he's not gonna not write it but it hasn't been replicated",
    "start": "2414880",
    "end": "2421359"
  },
  {
    "text": "because we had a little gc problem over here and so yeah consumer you go ahead and uh you can um you can't take them",
    "start": "2421359",
    "end": "2427280"
  },
  {
    "text": "you can you can get a copy of them yeah you just write them down on your yeah it's not destructive if it",
    "start": "2427280",
    "end": "2433440"
  },
  {
    "text": "were a legacy message queue then it would do that",
    "start": "2433440",
    "end": "2439280"
  },
  {
    "text": "okay good there you go uh all right now broker three uh wake back up and you can go",
    "start": "2439280",
    "end": "2445680"
  },
  {
    "text": "ahead and pull um there you go look you have message two",
    "start": "2445680",
    "end": "2451680"
  },
  {
    "text": "consumer you're uh gonna go ask ben for more messages and now ben can tell you about the cat",
    "start": "2451680",
    "end": "2458480"
  },
  {
    "text": "look at that now there are if we spent all our time on this there are actually some really interesting failure scenarios of",
    "start": "2458800",
    "end": "2465680"
  },
  {
    "text": "times things can break and ways uh just everything that can go wrong and boy we",
    "start": "2465680",
    "end": "2471359"
  },
  {
    "text": "don't have time for that at all i am gonna elect since that i could run over by five minutes i'm taking that five",
    "start": "2471359",
    "end": "2476560"
  },
  {
    "text": "minutes uh folks stay up here could you stay up here you don't mind all right good um let's talk about consumer groups",
    "start": "2476560",
    "end": "2483280"
  },
  {
    "start": "2483000",
    "end": "2626000"
  },
  {
    "text": "and how this works we might have time for this i sort of doubt it but we're going to try dang it",
    "start": "2483280",
    "end": "2489200"
  },
  {
    "text": "all right remember consumer groups this is when and we're going to need some more volunteers for consumers we'll get there",
    "start": "2489200",
    "end": "2495520"
  },
  {
    "text": "um but when you've got more than one application trying to consume from a",
    "start": "2495520",
    "end": "2500720"
  },
  {
    "text": "stream you need to be able to scale that computation out depending on on what it is it's going to have to happen so what we need is a way",
    "start": "2500720",
    "end": "2507760"
  },
  {
    "text": "to assign partitions and uh rather than replicas you guys are going to become",
    "start": "2507760",
    "end": "2512960"
  },
  {
    "text": "partitions we need to be able to sign partitions as consumers enter and leave the group",
    "start": "2512960",
    "end": "2519280"
  },
  {
    "text": "we want the clients to decide how those partitions get assigned",
    "start": "2519280",
    "end": "2525040"
  },
  {
    "text": "because we want brokers to be as stupid as possible and that is an uh an overriding priority in kafka we",
    "start": "2525040",
    "end": "2530800"
  },
  {
    "text": "want brokers to be the dumbest things they can possibly be that's actually a very good thing brokers",
    "start": "2530800",
    "end": "2536160"
  },
  {
    "text": "just don't do much and that allows kafka to be what it is we want to build a scale to on the order",
    "start": "2536160",
    "end": "2541599"
  },
  {
    "text": "of 10 to the four individual consumer groups and 10 to the two consumers in a topic",
    "start": "2541599",
    "end": "2549119"
  },
  {
    "text": "so that's a lot um that's a lot of consumption that we can do and we want this to be strongly",
    "start": "2549119",
    "end": "2554960"
  },
  {
    "text": "consistent so that the group always uh knows once a decision is made",
    "start": "2554960",
    "end": "2560400"
  },
  {
    "text": "that decision is strongly consistent across the group that has some unfortunate side effects",
    "start": "2560400",
    "end": "2566560"
  },
  {
    "text": "uh historically about pausing consumption while this stuff gets figured out to make it strongly consistent and you",
    "start": "2566560",
    "end": "2572400"
  },
  {
    "text": "can't have like people reading while you're just trying to decide what partition goes where okay who are the uh persons in this drama well there's",
    "start": "2572400",
    "end": "2580400"
  },
  {
    "text": "the consumers there's a special consumer called the controller one of those consumers is the",
    "start": "2580400",
    "end": "2585599"
  },
  {
    "text": "boss of the consumers um i'm i'm sorry no one of the consumers",
    "start": "2585599",
    "end": "2592079"
  },
  {
    "text": "is the leader of the group uh there's also a controller of the consumer group and that's one of the brokers that",
    "start": "2592079",
    "end": "2599760"
  },
  {
    "text": "consumes that thing that controls that thing um all right here are",
    "start": "2599760",
    "end": "2606720"
  },
  {
    "text": "our protocol uh operations find coordinator join group sync group",
    "start": "2606720",
    "end": "2614000"
  },
  {
    "text": "heartbeat and leave group now without walking you through each one of these steps i'm going to try to do the acting",
    "start": "2614000",
    "end": "2619920"
  },
  {
    "text": "out of this and if you see me jump around in the slides that's because this is hard to remember all at once",
    "start": "2619920",
    "end": "2626000"
  },
  {
    "text": "so let's try this i have three um that should say three partitions",
    "start": "2626000",
    "end": "2632800"
  },
  {
    "text": "actually and i need one more consumer i need one more person and you sir are now a consumer",
    "start": "2632800",
    "end": "2641359"
  },
  {
    "text": "if you would rename yourself i need another consumer and broker broker broker you're good",
    "start": "2641359",
    "end": "2649599"
  },
  {
    "text": "and instead of leader and follower if you could just write p0 p1 and p2",
    "start": "2649599",
    "end": "2658400"
  },
  {
    "text": "you are partitions of a topic",
    "start": "2658400",
    "end": "2663838"
  },
  {
    "text": "step right up and let's see you are going to be a consumer",
    "start": "2664079",
    "end": "2670880"
  },
  {
    "text": "so if you want to write consumer and label yourself oh yeah that's right i have six",
    "start": "2670880",
    "end": "2676640"
  },
  {
    "text": "partitions i forgot so um you're also p3",
    "start": "2676640",
    "end": "2682160"
  },
  {
    "text": "you're also p4 and you're also p6 wait p5",
    "start": "2682160",
    "end": "2687599"
  },
  {
    "text": "we start counting at zero because we're computer scientists",
    "start": "2687599",
    "end": "2694000"
  },
  {
    "text": "okay if you two could turn around you're you're not on yet",
    "start": "2697119",
    "end": "2703599"
  },
  {
    "text": "and you are all right and by the way this um we don't know any of that that's gone so",
    "start": "2703599",
    "end": "2709680"
  },
  {
    "text": "it's brand new day and as far as data goes i'll just feed you your data just to keep this simple now um",
    "start": "2709680",
    "end": "2719838"
  },
  {
    "text": "you wake up uh you're live for the first time you're a new jvm process you've got your",
    "start": "2720560",
    "end": "2727359"
  },
  {
    "text": "bootstrap broker list which is a list of addresses of brokers that are out there in the world",
    "start": "2727359",
    "end": "2733040"
  },
  {
    "text": "uh and to be a kafka application you don't need to know all of the nodes in a cluster that would be silly you just need to know a few",
    "start": "2733040",
    "end": "2739200"
  },
  {
    "text": "right you have like two or three well-known names that are going to be there in the cluster and the rest of them you don't care so you've got your",
    "start": "2739200",
    "end": "2744400"
  },
  {
    "text": "bootstrap list mr consumer and uh one of them is is broker three here",
    "start": "2744400",
    "end": "2749599"
  },
  {
    "text": "so you wake up and as a part of your protocol you run an operation called find group",
    "start": "2749599",
    "end": "2758839"
  },
  {
    "text": "um and that looks like this oh sorry find coordinators you can send it to your",
    "start": "2758839",
    "end": "2764000"
  },
  {
    "text": "bootstrap broker so you ask broker three you say hey i would like to find my group",
    "start": "2764000",
    "end": "2769440"
  },
  {
    "text": "and what you do is you pass him a thing called your group id that's the name of the application every consumer",
    "start": "2769440",
    "end": "2775040"
  },
  {
    "text": "to configure it it will not start if you don't give it a group id and your group id is",
    "start": "2775040",
    "end": "2782240"
  },
  {
    "text": "qcon i just made that up so that's your that's your group id good and you can stick that right under",
    "start": "2782240",
    "end": "2788960"
  },
  {
    "text": "this one so you wake up you talk to your bootstrap broker which is broker three and you say hey",
    "start": "2788960",
    "end": "2794160"
  },
  {
    "text": "i'm qcon nice to meet you you don't know what to do yet it's okay i'm about to tell you",
    "start": "2794160",
    "end": "2800960"
  },
  {
    "text": "um so what you're going to do is you've got this internal topic called consumer offsets and it's keyed",
    "start": "2800960",
    "end": "2809280"
  },
  {
    "text": "by that so you're going to go to that consumer offsets topic and look at that key and automatically",
    "start": "2809280",
    "end": "2816720"
  },
  {
    "text": "this is this nice way that kafka automatically gives you poor bootstrap broker of knowing who",
    "start": "2816720",
    "end": "2822400"
  },
  {
    "text": "to send him to all right so that partition that that key is going to get written to in that",
    "start": "2822400",
    "end": "2828319"
  },
  {
    "text": "magical internal topic has a leader somewhere remember i'm zookeeper i happen to know",
    "start": "2828319",
    "end": "2833520"
  },
  {
    "text": "again it's ben i pick on my co-worker so you're going to say oh yeah you want to talk to broker 2. go",
    "start": "2833520",
    "end": "2840960"
  },
  {
    "text": "ahead and tell him it was quiet but he did say it okay so you can go back to where you just you",
    "start": "2840960",
    "end": "2847119"
  },
  {
    "text": "just know that now you've got that state okay now you want to say oh good i know",
    "start": "2847119",
    "end": "2852319"
  },
  {
    "text": "who to talk to i'm going to join my group so uh same thing you want to say i'm gonna",
    "start": "2852319",
    "end": "2859040"
  },
  {
    "text": "i'm gonna go ahead and join my group now and what do i know i know my group id i'm brand new i don't know my member id",
    "start": "2859040",
    "end": "2865040"
  },
  {
    "text": "i know i'm a consumer i i know a few other little bits of metadata we don't need to go into those in any kind of",
    "start": "2865040",
    "end": "2870640"
  },
  {
    "text": "detail um but now you can go to ben and you can say hey i would like",
    "start": "2870640",
    "end": "2877599"
  },
  {
    "text": "to join the group sounds like a role-playing game uh level three consumer looking for group right so you go over",
    "start": "2877599",
    "end": "2883760"
  },
  {
    "text": "to ben and say you'd like to join the group yeah and ben",
    "start": "2883760",
    "end": "2891280"
  },
  {
    "text": "you say well you could tell him you're the first one to join this group you are the leader",
    "start": "2891280",
    "end": "2898640"
  },
  {
    "text": "send it back with a member id and we're just going to say your member write m equals one we'll say your member",
    "start": "2898960",
    "end": "2905760"
  },
  {
    "text": "id is one asking people to write backwards on papers stuck to their abdomen super bad plan",
    "start": "2905760",
    "end": "2914800"
  },
  {
    "text": "uh the things you learn right okay now good deal um and now what you're gonna",
    "start": "2914800",
    "end": "2921680"
  },
  {
    "text": "do is you are going to ratify that um you're gonna do a call called sync",
    "start": "2921680",
    "end": "2928640"
  },
  {
    "text": "consumer this is the next step and basically you just go back to ben and you say yep thank you i'm good i got",
    "start": "2928640",
    "end": "2934319"
  },
  {
    "text": "that um i am member one of group q con i'm off and running and at that point",
    "start": "2934319",
    "end": "2942640"
  },
  {
    "text": "the consumer group is ready to go and you can start consuming messages and you don't need to actually consume",
    "start": "2942640",
    "end": "2948400"
  },
  {
    "text": "any messages i want to speed things up a little bit here but you have now properly joined the group",
    "start": "2948400",
    "end": "2954400"
  },
  {
    "text": "something you have to do every few seconds is you have to go back over to ben say hey",
    "start": "2954400",
    "end": "2960160"
  },
  {
    "text": "ben i'm okay which i think is a little clingy and i",
    "start": "2960160",
    "end": "2966559"
  },
  {
    "text": "don't you know people like that right some people would accuse me of being like that i think that's unfair um but you just have every once in a",
    "start": "2966559",
    "end": "2973359"
  },
  {
    "text": "while have to have to do that all right now um another thing ben has to do at this",
    "start": "2973359",
    "end": "2980319"
  },
  {
    "text": "point or actually no ben doesn't have to do this um this my consuming",
    "start": "2980319",
    "end": "2986319"
  },
  {
    "text": "this is over your name what's your name again ron okay so uh another thing ron has to do",
    "start": "2986319",
    "end": "2992000"
  },
  {
    "text": "at this point since he synced ben told him about the partitions in the group ron has to make a decision",
    "start": "2992000",
    "end": "2998480"
  },
  {
    "text": "about what partitions he's going to consume now what partitions are there here zero one two three four five six of them",
    "start": "2998480",
    "end": "3005200"
  },
  {
    "text": "right ron is one consumer guess what he's got all of them",
    "start": "3005200",
    "end": "3010960"
  },
  {
    "text": "that's pretty easy uh he knows what's happening so when you're consuming you're going to consume from all those",
    "start": "3010960",
    "end": "3016319"
  },
  {
    "text": "partitions now if you would turn around and wake up and oh look it's a brand new day you're",
    "start": "3016319",
    "end": "3021520"
  },
  {
    "text": "live for the first time go find your coordinator your bootstrap broker is broker one so why don't you go over to broker one",
    "start": "3021520",
    "end": "3028240"
  },
  {
    "text": "and ask broker one um that tell broker one you wanna find your coordinator",
    "start": "3028240",
    "end": "3033599"
  },
  {
    "text": "broker one introduce him to ben please there okay good deal now you join you",
    "start": "3033599",
    "end": "3040960"
  },
  {
    "text": "say i would like to join the group welcome to the group here's your here's",
    "start": "3040960",
    "end": "3047520"
  },
  {
    "text": "your member id you're now a member of this group you can come back over now when is poor ron going to know that this",
    "start": "3047520",
    "end": "3053119"
  },
  {
    "text": "happened this seems important he doesn't have any partitions he needs partitions ron give them a",
    "start": "3053119",
    "end": "3060400"
  },
  {
    "text": "heartbeat hold on a minute says ben somebody",
    "start": "3060400",
    "end": "3067359"
  },
  {
    "text": "joined your group you need to go back and do a rebalance so ron go back you do a rebalance",
    "start": "3067359",
    "end": "3073680"
  },
  {
    "text": "what ron is going to do now is rejoin the group and you don't have to do that but",
    "start": "3073680",
    "end": "3078960"
  },
  {
    "text": "that that he learns about that at the heartbeat stage that somebody else has joined the group and if you turn around you would do the same thing you'd find",
    "start": "3078960",
    "end": "3085520"
  },
  {
    "text": "your controller you'd join and then the next heartbeat that ron does he's gonna know as the group leader he's gonna know oh i",
    "start": "3085520",
    "end": "3092480"
  },
  {
    "text": "have to do a rebalance let me rejoin and everybody on their next heartbeat they're gonna get their well ron will",
    "start": "3092480",
    "end": "3098640"
  },
  {
    "text": "decide their partition assignments because he's the lead consumer uh and he has that power and",
    "start": "3098640",
    "end": "3104400"
  },
  {
    "text": "they get them uh at their next heartbeat",
    "start": "3104400",
    "end": "3110400"
  },
  {
    "text": "that's the simple version and we're out of time so i hope we saw them we saw replication",
    "start": "3110400",
    "end": "3117440"
  },
  {
    "text": "we saw a leader election um we saw consumer groups um thank you very much for being willing to",
    "start": "3117440",
    "end": "3123280"
  },
  {
    "text": "get up on stage and help me do this and thanks for being here",
    "start": "3123280",
    "end": "3128318"
  },
  {
    "text": "if you want to know more about stuff like this some kafka and listen to podcasts and tutorials and",
    "start": "3130960",
    "end": "3136240"
  },
  {
    "text": "example code go to the url that qr code you're amazing thanks for being here",
    "start": "3136240",
    "end": "3146720"
  }
]