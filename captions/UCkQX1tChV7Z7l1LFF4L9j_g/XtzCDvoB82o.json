[
  {
    "text": "hello and welcome oh I'm really glad to hear to see so many people joined and",
    "start": "3990",
    "end": "9960"
  },
  {
    "text": "came here to listen to my book my name is Akkad Maravich and I'm a",
    "start": "9960",
    "end": "17550"
  },
  {
    "text": "software engineer working Spotify I've been with Spotify for almost four years which is a Trinity for one software",
    "start": "17550",
    "end": "24600"
  },
  {
    "text": "engineer for the past two years I've been working in a team which is maintaining and developing sporophytes",
    "start": "24600",
    "end": "31740"
  },
  {
    "text": "reliable event delivery system before that I was also an infrastructure engineer and I was working on",
    "start": "31740",
    "end": "37950"
  },
  {
    "text": "maintaining and developing Spotify gateways in my free time I like to",
    "start": "37950",
    "end": "45030"
  },
  {
    "text": "travel and in many places I go people find me quite interesting and in some of",
    "start": "45030",
    "end": "50880"
  },
  {
    "text": "the places they're not really afraid to show it as you can see here in the picture but yeah enough about me let's",
    "start": "50880",
    "end": "60480"
  },
  {
    "text": "talk a bit about Spotify Spotify is a",
    "start": "60480",
    "end": "65579"
  },
  {
    "text": "service which aims to provide all of the music of the world to its customers at a",
    "start": "65579",
    "end": "71970"
  },
  {
    "text": "tip of their fingers it is ubiquitous it's available for mobile it's available",
    "start": "71970",
    "end": "77640"
  },
  {
    "text": "for web tests PlayStation cars many different connected speakers pretty much",
    "start": "77640",
    "end": "84210"
  },
  {
    "text": "everywhere a big distinguishing feature for Spotify in the beginning was the",
    "start": "84210",
    "end": "91020"
  },
  {
    "text": "contact in content it has and also the instant playback that the users would",
    "start": "91020",
    "end": "97979"
  },
  {
    "text": "feel once they plus a play button ah but as the time went on this was not enough",
    "start": "97979",
    "end": "104880"
  },
  {
    "text": "in order to stay on the top spot if I needed to start in a waiting uh this is",
    "start": "104880",
    "end": "110790"
  },
  {
    "text": "why at some point started Spotify started investing a lot of ian features built on top of big data so here few of",
    "start": "110790",
    "end": "120390"
  },
  {
    "text": "my favorite features so we have your release radar this is a customized",
    "start": "120390",
    "end": "126840"
  },
  {
    "text": "playlist which comes customized for each users and contains the new releases new",
    "start": "126840",
    "end": "132599"
  },
  {
    "text": "release songs that the user is most probably going to like based on its listening habits then we have fresh vines fresh vines are",
    "start": "132599",
    "end": "142380"
  },
  {
    "text": "the set of playlists which are trying to predict where the music industry or the",
    "start": "142380",
    "end": "147390"
  },
  {
    "text": "music is going to go in the next few months or maybe years we can actually do that by tracking the listening habits of",
    "start": "147390",
    "end": "155190"
  },
  {
    "text": "the users which are marked as hipsters",
    "start": "155190",
    "end": "159500"
  },
  {
    "text": "seriously and this is not something that this is not something that I read",
    "start": "160280",
    "end": "166140"
  },
  {
    "text": "internally in Spotify this was actually a news article that I actually figured out that we have a new feature and then",
    "start": "166140",
    "end": "171240"
  },
  {
    "text": "it it was giving me an explanation how do we do that and finally my favorite",
    "start": "171240",
    "end": "178020"
  },
  {
    "text": "feature so far and favorite feature of many of the Spotify users is discover weekly what discover weekly does it",
    "start": "178020",
    "end": "185580"
  },
  {
    "text": "actually comes with the music that the user is most probably going to like based on its listening habits it comes",
    "start": "185580",
    "end": "191670"
  },
  {
    "text": "fresh every week most of the times this is the only playlist I listen during the",
    "start": "191670",
    "end": "197220"
  },
  {
    "text": "whole week and also one fun fact one of the Spotify my colleagues actually came",
    "start": "197220",
    "end": "203580"
  },
  {
    "text": "and said this is a conspiracy by Spotify because by providing this and by providing you a good recommendations but",
    "start": "203580",
    "end": "210239"
  },
  {
    "text": "if I can actually tell you what to listener and well it seems like it's helpful but those are the cool",
    "start": "210239",
    "end": "218580"
  },
  {
    "text": "features that we use data to produce but",
    "start": "218580",
    "end": "223620"
  },
  {
    "text": "what is more important is that the date is also used for producing a core feature of Spotify which is one of the",
    "start": "223620",
    "end": "230700"
  },
  {
    "text": "pillars on which the Spotify is built in order to stay legal Spotify is paying a",
    "start": "230700",
    "end": "237660"
  },
  {
    "text": "certain amount of money for each of the stream which is generated to the music right holders this amount of money which",
    "start": "237660",
    "end": "244680"
  },
  {
    "text": "is being paid is called a royalty as the Spotify crew as the number of users grew",
    "start": "244680",
    "end": "250860"
  },
  {
    "text": "we can see more listening hours and then you can actually see on the graph this is the amount of royalties we are paying",
    "start": "250860",
    "end": "257660"
  },
  {
    "text": "across the time what the recommendation",
    "start": "257660",
    "end": "263760"
  },
  {
    "text": "features and the royalty calculations have in common is that they're being powered by data which is collected from",
    "start": "263760",
    "end": "270210"
  },
  {
    "text": "this pot my clients and all of the data is being delivered my Spotify ven delivery system",
    "start": "270210",
    "end": "276110"
  },
  {
    "text": "but these two are not the only two features which are powered by our data we have many more other features so the",
    "start": "276110",
    "end": "284550"
  },
  {
    "text": "data is also used for the business intelligence teams it's also used to run our a/b tests also do the crash",
    "start": "284550",
    "end": "290580"
  },
  {
    "text": "reporting and then if you've been to the kill truck talk you can actually also see it's being used to track the ad",
    "start": "290580",
    "end": "296970"
  },
  {
    "text": "click so the star of today's talk is",
    "start": "296970",
    "end": "303960"
  },
  {
    "text": "going to be the spot if it's reliable event delivery system I'm not going to",
    "start": "303960",
    "end": "309330"
  },
  {
    "text": "go that much into the low-level architectural details on how the system is built but I'm rather going to give",
    "start": "309330",
    "end": "315750"
  },
  {
    "text": "you a high-level overview on what our Spotify or what our event delivery",
    "start": "315750",
    "end": "321930"
  },
  {
    "text": "system is to do and why I also focus on some of the key operational aspects of",
    "start": "321930",
    "end": "328650"
  },
  {
    "text": "the system how do we do monitoring how do we scale the system and then finally",
    "start": "328650",
    "end": "333870"
  },
  {
    "text": "how do we do the testing let's start",
    "start": "333870",
    "end": "339060"
  },
  {
    "text": "with the high-level overview most of the data we are having is being",
    "start": "339060",
    "end": "345450"
  },
  {
    "text": "collected from the spotify clients whenever a user action occurs an event",
    "start": "345450",
    "end": "353220"
  },
  {
    "text": "can be generated so for example we have an event which is being generated once the user starts listening to a song we",
    "start": "353220",
    "end": "360120"
  },
  {
    "text": "have another event generated when the user stops listening to a song we have an event when it subscribes to a",
    "start": "360120",
    "end": "366390"
  },
  {
    "text": "playlist and subscribes to a playlist and finally clicks on an ad all in all",
    "start": "366390",
    "end": "371490"
  },
  {
    "text": "there is more than 250 unique event types which are being generated from our",
    "start": "371490",
    "end": "377730"
  },
  {
    "text": "clients we expect this number to grow even further as we work on making the",
    "start": "377730",
    "end": "384300"
  },
  {
    "text": "instrumentation more approachable to the Spotify developers many of these events",
    "start": "384300",
    "end": "390570"
  },
  {
    "text": "are actually varying in a different dimensions we have some events which are small Daz few bytes and then some events",
    "start": "390570",
    "end": "396900"
  },
  {
    "text": "we actually have the messages which are as big as few kilobytes we have events which are being generated",
    "start": "396900",
    "end": "404389"
  },
  {
    "text": "sporadically during the day and we have some other events which are being generated 200,000 times per second in",
    "start": "404389",
    "end": "410990"
  },
  {
    "text": "the peak hours globally and also events are varying on the lost requirements",
    "start": "410990",
    "end": "418010"
  },
  {
    "text": "there having many events are okay with occasional loss but some events like the events which are used in the royalty",
    "start": "418010",
    "end": "424430"
  },
  {
    "text": "calculations are having a strict no loss requirements but beside aquatab come on",
    "start": "424430",
    "end": "436570"
  },
  {
    "text": "but beside are even delivery system needing to take care of different event",
    "start": "436780",
    "end": "442669"
  },
  {
    "text": "types flowing through the system it also needs to deal with the sheer load of",
    "start": "442669",
    "end": "447979"
  },
  {
    "text": "messages which is being generated by 100 million monthly active users that we",
    "start": "447979",
    "end": "453320"
  },
  {
    "text": "have today in order to be able to",
    "start": "453320",
    "end": "459139"
  },
  {
    "text": "iterate faster on our system and also to scale it easily we decided to use as",
    "start": "459139",
    "end": "466010"
  },
  {
    "text": "many Google cloud components as we could so instead of Kafka we're using cloud pub/sub to save state we're using cloud",
    "start": "466010",
    "end": "472820"
  },
  {
    "text": "sequel and datastore to manage infrastructure we're using compute engine all the data that we are",
    "start": "472820",
    "end": "478370"
  },
  {
    "text": "delivering is always delivered to the cloud storage and it can also be delivered to the big word are even",
    "start": "478370",
    "end": "488060"
  },
  {
    "text": "delivery system needs to deliver all the events into the early buckets what the",
    "start": "488060",
    "end": "494510"
  },
  {
    "text": "early bucket means depends on the storage implementation to which we deliver data so in case of the cloud",
    "start": "494510",
    "end": "501320"
  },
  {
    "text": "storage an early bucket is a folder the same thing in the case when we deliver",
    "start": "501320",
    "end": "506900"
  },
  {
    "text": "data to Hadoop in case of bigquery it's a table and in case of hive it's a partition one thing that I like",
    "start": "506900",
    "end": "517550"
  },
  {
    "text": "to point out here is that events are being destined to a bucket or determined",
    "start": "517550",
    "end": "525200"
  },
  {
    "text": "to which bucket they belong to based on the time stamp when they were received by our system and not on the time stamp",
    "start": "525200",
    "end": "532370"
  },
  {
    "text": "when they were generated by our client this might sound a bit of",
    "start": "532370",
    "end": "537380"
  },
  {
    "text": "counterintuitive but the fact is that by doing this we can guarantee the",
    "start": "537380",
    "end": "543110"
  },
  {
    "text": "timeliness of data delivery and we can also guarantee that all we can guarantee",
    "start": "543110",
    "end": "548959"
  },
  {
    "text": "with a high enough confidence that all the events which are destined to a specific bucket for a specific hour we",
    "start": "548959",
    "end": "555230"
  },
  {
    "text": "are going to be delivered to death bucket timeliness is also an important",
    "start": "555230",
    "end": "562399"
  },
  {
    "text": "aspect of our event delivery system the ROI events which are we delivering are",
    "start": "562399",
    "end": "568070"
  },
  {
    "text": "being used potentially by a chain of data jobs in case we we're having delays",
    "start": "568070",
    "end": "574700"
  },
  {
    "text": "we're creating more delays for our customers which in turn generates even more delays for their customers this is",
    "start": "574700",
    "end": "581480"
  },
  {
    "text": "why we internally have a timeliness SLA that we expose to our clients and we",
    "start": "581480",
    "end": "588230"
  },
  {
    "text": "have a process that we follow in case the data is delayed and it also we have a process of how to communicate this",
    "start": "588230",
    "end": "594829"
  },
  {
    "text": "with our customers in order to keep up",
    "start": "594829",
    "end": "600350"
  },
  {
    "text": "with the SLA we need to have our system running 24/7",
    "start": "600350",
    "end": "606190"
  },
  {
    "text": "interesting to note here is that the Spotify is a bit different from other big companies we don't have a operations",
    "start": "606220",
    "end": "613399"
  },
  {
    "text": "team like uber or Google Google or Twitter developers which are developing",
    "start": "613399",
    "end": "620149"
  },
  {
    "text": "the service are responsible operationally responsible for serving being a service being up and running so",
    "start": "620149",
    "end": "630050"
  },
  {
    "text": "I think this is a really good thing because I think this is what pushes good developers to be the great developers",
    "start": "630050",
    "end": "636860"
  },
  {
    "text": "but it's not really the fun thing to do all the time and I definitely know it's",
    "start": "636860",
    "end": "642050"
  },
  {
    "text": "it's not our spouses don't really like it all the time now for example my wife",
    "start": "642050",
    "end": "648470"
  },
  {
    "text": "sometimes when I'm on call she tells me to go on a couch and a one-for-one",
    "start": "648470",
    "end": "653660"
  },
  {
    "text": "colleague his wife actually tells to his kids you know your dad is going to be on call and they were like no but this is",
    "start": "653660",
    "end": "664520"
  },
  {
    "text": "why we also invested a lot in having a good one of our system and also in trying to",
    "start": "664520",
    "end": "672529"
  },
  {
    "text": "automate and make er system auto recover auto heal in many of the failure cases",
    "start": "672529",
    "end": "678680"
  },
  {
    "text": "recruiting of since we're having so many",
    "start": "678680",
    "end": "683750"
  },
  {
    "text": "event types falling to our system we wanted to have a stricter control what",
    "start": "683750",
    "end": "689600"
  },
  {
    "text": "is it going to be delivered this is why we ask all of our customers to define",
    "start": "689600",
    "end": "695449"
  },
  {
    "text": "which events they want to be delivered and events which are not defined as they want to be delivered are completely",
    "start": "695449",
    "end": "702170"
  },
  {
    "text": "filtered out we wanted to do this so we would not waste resources on the events",
    "start": "702170",
    "end": "708350"
  },
  {
    "text": "that we know are never going to be looked at and finally we designed our",
    "start": "708350",
    "end": "716839"
  },
  {
    "text": "event delivery system to deliver 100% of data we acknowledged that there is many",
    "start": "716839",
    "end": "724160"
  },
  {
    "text": "different event types flow into our system and they have different loss requirements but we felt that designing",
    "start": "724160",
    "end": "731149"
  },
  {
    "text": "a system to do a single thing and do that thing well is much easier than",
    "start": "731149",
    "end": "736670"
  },
  {
    "text": "actually having many more use cases since through our event delivery system",
    "start": "736670",
    "end": "742220"
  },
  {
    "text": "we are delivering really important events we use that as a less common denominator and of just designed our",
    "start": "742220",
    "end": "748220"
  },
  {
    "text": "system not to lose any data but designing system to not do that or not",
    "start": "748220",
    "end": "754730"
  },
  {
    "text": "do something is not good enough this is why we also needed to build a monitoring service on top which is tracking all the",
    "start": "754730",
    "end": "762079"
  },
  {
    "text": "outputs and all the inputs and based on that in determines if we have any loss",
    "start": "762079",
    "end": "767120"
  },
  {
    "text": "or not the similar way we have diamond s SLA we also have a completeness SLA and",
    "start": "767120",
    "end": "772959"
  },
  {
    "text": "in case the SLA is broke and we also have an incident process and we're having a process how to communicate this",
    "start": "772959",
    "end": "780050"
  },
  {
    "text": "to our customers",
    "start": "780050",
    "end": "783339"
  },
  {
    "text": "so in order for our system to be running 24/7 and for us to keep up with the SLA",
    "start": "799709",
    "end": "806910"
  },
  {
    "text": "having a good monitoring is a must with",
    "start": "806910",
    "end": "812470"
  },
  {
    "text": "our system we actually recognize that there are three different types of monitoring uh we're having system",
    "start": "812470",
    "end": "818019"
  },
  {
    "text": "monitoring for monitoring the general health of the system we are having data monitoring for monitoring our timeliness",
    "start": "818019",
    "end": "824800"
  },
  {
    "text": "isolates and we're also having a data loss monitoring for monitoring our completeness SLA so we do system",
    "start": "824800",
    "end": "836019"
  },
  {
    "text": "monitoring of our event delivery system exactly the same way like we monitor any of our back-end systems here what I want",
    "start": "836019",
    "end": "845980"
  },
  {
    "text": "to point out is that even if the event delivery system is a just a big box on it it's on this slide it is actually a",
    "start": "845980",
    "end": "852910"
  },
  {
    "text": "complex distributed system with many micro services which are working together to do the same goal we are",
    "start": "852910",
    "end": "860380"
  },
  {
    "text": "having a system monitoring on each of those components and we're also monitoring the third-party services we",
    "start": "860380",
    "end": "865990"
  },
  {
    "text": "are using in our system we're monitoring CPU were monitoring memory we're monitoring everything we could think of",
    "start": "865990",
    "end": "872070"
  },
  {
    "text": "we think the monitoring is really important because it allows us to see",
    "start": "872070",
    "end": "877920"
  },
  {
    "text": "what parts of the system needs optimising and also in case of incidents",
    "start": "877920",
    "end": "883120"
  },
  {
    "text": "it's really easy to pinpoint the actual problem but no matter how good this",
    "start": "883120",
    "end": "889779"
  },
  {
    "text": "monitoring is it doesn't actually allows us to see what our customers see and",
    "start": "889779",
    "end": "895300"
  },
  {
    "text": "what our customers need we did system monitoring we're not actually monitoring the data which is being delivered that",
    "start": "895300",
    "end": "902949"
  },
  {
    "text": "means that sometimes we could have entered some really obscure bugs which would stop delivering the data even if",
    "start": "902949",
    "end": "910750"
  },
  {
    "text": "the health of the system was good enough or it was well not breaking any SLA or not triggering any alarms",
    "start": "910750",
    "end": "917770"
  },
  {
    "text": "so this is why in Spotify we came up with a data monitoring tool Allah",
    "start": "917770",
    "end": "923430"
  },
  {
    "text": "unfortunately it's still not open source but what the data man does is that it",
    "start": "923430",
    "end": "930250"
  },
  {
    "text": "actually allows us it shows us what is actually being happening on the actual storage every bucket you see here on the",
    "start": "930250",
    "end": "938560"
  },
  {
    "text": "right is the actual hourly pocket of data being delivered he can monitor data",
    "start": "938560",
    "end": "943870"
  },
  {
    "text": "on cloud storage I can monitor data on bigquery hive I saw even on datastore",
    "start": "943870",
    "end": "949840"
  },
  {
    "text": "and I even saw it can monitor date on SFTP not really sure who is except as a TP but what it can do that too",
    "start": "949840",
    "end": "957990"
  },
  {
    "text": "interesting aspect of the system in order to actually allows us to be",
    "start": "957990",
    "end": "963190"
  },
  {
    "text": "on-call and keep up to our timeliness SLA we can set the alarms and we can track historically how did we keep up",
    "start": "963190",
    "end": "970150"
  },
  {
    "text": "with the SLA other he does have other features like it we can look at the",
    "start": "970150",
    "end": "975160"
  },
  {
    "text": "counters we can go to go and drill down and see the resource manager and bunch",
    "start": "975160",
    "end": "980230"
  },
  {
    "text": "of other different interesting stuff date Amon is definitely one of my",
    "start": "980230",
    "end": "986530"
  },
  {
    "text": "favorite tools in Spotify and I think it was one of the big game changers on how",
    "start": "986530",
    "end": "992170"
  },
  {
    "text": "do we do ops in a data infrastructure",
    "start": "992170",
    "end": "997290"
  },
  {
    "text": "and finally in order to monitor the completeness SLA we built a custom",
    "start": "997290",
    "end": "1003780"
  },
  {
    "text": "tailor system which is actually monitoring all the outputs and all the inputs and then based on that calculates",
    "start": "1003780",
    "end": "1011070"
  },
  {
    "text": "if we did rate the SLA or not dumps everything to elasticsearch and from there we actually just graph it with",
    "start": "1011070",
    "end": "1018630"
  },
  {
    "text": "Cubana so what this system does is that it",
    "start": "1018630",
    "end": "1024390"
  },
  {
    "text": "actually if it detects that we did over delivery or under delivery of our data",
    "start": "1024390",
    "end": "1029400"
  },
  {
    "text": "it opens up a gyro ticket any sensor nestled on alarm after that we have a",
    "start": "1029400",
    "end": "1035010"
  },
  {
    "text": "process we start working on it so in this example on this slide you can actually see what does it do so we have",
    "start": "1035010",
    "end": "1042510"
  },
  {
    "text": "over delivery for event and then it actually opened up a gyro ticket for us",
    "start": "1042510",
    "end": "1049590"
  },
  {
    "text": "that we can actually monitor how many because did we get and then we did took all the things we needed to do in order",
    "start": "1049590",
    "end": "1056160"
  },
  {
    "text": "to mitigate this issue let's talk about",
    "start": "1056160",
    "end": "1063150"
  },
  {
    "text": "scaling a bit scaling is fun I mean everybody likes it today",
    "start": "1063150",
    "end": "1071460"
  },
  {
    "text": "Spotify is having 100 million monthly active users we recently also announced",
    "start": "1071460",
    "end": "1077460"
  },
  {
    "text": "that we have 50 million paying subscribers all of that those users are",
    "start": "1077460",
    "end": "1083820"
  },
  {
    "text": "generating 1.5 million events per second in a peak hours which actually",
    "start": "1083820",
    "end": "1090090"
  },
  {
    "text": "translates to more than 60 terabytes of data delivered every single day all that",
    "start": "1090090",
    "end": "1096270"
  },
  {
    "text": "load is being split across more than 250 unique event types were having in",
    "start": "1096270",
    "end": "1102870"
  },
  {
    "text": "Spotify this gives us a lot of interesting engineering challenges to",
    "start": "1102870",
    "end": "1109710"
  },
  {
    "text": "work with and yeah like it we came up",
    "start": "1109710",
    "end": "1115350"
  },
  {
    "text": "with an interesting design but before we started tackling the hard technical",
    "start": "1115350",
    "end": "1121350"
  },
  {
    "text": "issues we also wanted to tackle a hard soft issue today is what if I were not",
    "start": "1121350",
    "end": "1129600"
  },
  {
    "text": "seeing a rapid growth of the number of users we are having we're also seeing a growth of developers which are starting",
    "start": "1129600",
    "end": "1137160"
  },
  {
    "text": "to work with data in order to make their life easier we wanted to introduce a",
    "start": "1137160",
    "end": "1143310"
  },
  {
    "text": "concept of ownership of the events ownership in this context means that the",
    "start": "1143310",
    "end": "1150630"
  },
  {
    "text": "owner of the event is responsible for the quality of the event that is being produced and it's also responsible of",
    "start": "1150630",
    "end": "1159630"
  },
  {
    "text": "providing a good guidelines of how the event is going to be used then everything goes through a distributed",
    "start": "1159630",
    "end": "1165720"
  },
  {
    "text": "configuration service so the users of the event can actually go and track down who is the owner so they can go and talk",
    "start": "1165720",
    "end": "1171900"
  },
  {
    "text": "to them and figure out what to do with the event owners should not care about",
    "start": "1171900",
    "end": "1176910"
  },
  {
    "text": "timeliness and the owner should not care about completeness because this is what we as even deliver it in Guren",
    "start": "1176910",
    "end": "1182909"
  },
  {
    "text": "with a restless one other aspect that",
    "start": "1182909",
    "end": "1189330"
  },
  {
    "text": "the owners need to do they also need to decide where do they want data to be delivered by default it's always being",
    "start": "1189330",
    "end": "1195720"
  },
  {
    "text": "delivered to the cloud storage but the owner can choose for data to be delivered to the bigquery it interested",
    "start": "1195720",
    "end": "1201869"
  },
  {
    "text": "for data to be delivered on Hadoop and finally can choose for data to be delivered to hive so since we have many",
    "start": "1201869",
    "end": "1213989"
  },
  {
    "text": "event types flowing to our system we wanted to actually split them and",
    "start": "1213989",
    "end": "1222979"
  },
  {
    "text": "consume them by a separate parts of the system we wanted to do this since we",
    "start": "1223879",
    "end": "1230009"
  },
  {
    "text": "felt that writing many smaller parts of the system and managing this is going to",
    "start": "1230009",
    "end": "1235590"
  },
  {
    "text": "be much easier than having one huge component that consumes all the events from a one huge stream this allows us to",
    "start": "1235590",
    "end": "1245759"
  },
  {
    "text": "have a better visibility on how each event is performing and actually yeah",
    "start": "1245759",
    "end": "1253259"
  },
  {
    "text": "understand what the event is doing but of course it does have its drawbacks",
    "start": "1253259",
    "end": "1259349"
  },
  {
    "text": "so the first drawback is that by doing this and splitting our event delivery system and all the events two dependent",
    "start": "1259349",
    "end": "1266159"
  },
  {
    "text": "streams is that we have more administration overhead so this is why we needed to go and build a system which",
    "start": "1266159",
    "end": "1274559"
  },
  {
    "text": "is going to talk to the compute engine and order the infrastructure needed for",
    "start": "1274559",
    "end": "1280889"
  },
  {
    "text": "each of the events to be delivered the next issue with this kind of setup is",
    "start": "1280889",
    "end": "1287729"
  },
  {
    "text": "that determining the amount of machines",
    "start": "1287729",
    "end": "1293190"
  },
  {
    "text": "which are actually needed for each event to be delivered gets a bit more complex so our first step on it was to actually",
    "start": "1293190",
    "end": "1301679"
  },
  {
    "text": "have the same amount of machines serving every event we're having is very fun but",
    "start": "1301679",
    "end": "1307679"
  },
  {
    "text": "of course this had a big drawback if we would use the same amount of machines",
    "start": "1307679",
    "end": "1314580"
  },
  {
    "text": "for all the events in case of the small events we would based much many resources in the case of the big events",
    "start": "1314580",
    "end": "1322650"
  },
  {
    "text": "there is no guarantee that we're going to be able to scale up and pick up the",
    "start": "1322650",
    "end": "1328800"
  },
  {
    "text": "sudden spikes of the events being published of course a fix of this that",
    "start": "1328800",
    "end": "1336270"
  },
  {
    "text": "we wanted to avoid at all cost is to do the manual allocation of capacity for",
    "start": "1336270",
    "end": "1342510"
  },
  {
    "text": "each of the events or to push this manual capacity allocation to any of our customers but of course we are lazy we",
    "start": "1342510",
    "end": "1351870"
  },
  {
    "text": "don't like manual work and our customers definitely don't like manual work so we wanted to give autoscaler a try since",
    "start": "1351870",
    "end": "1360060"
  },
  {
    "text": "we're already were ordering machines on the compute engine turning on the autoscaler was quite simple you just say",
    "start": "1360060",
    "end": "1367230"
  },
  {
    "text": "this is the metric I want you to look at when you want to decide if you should auto scale something or not this is the",
    "start": "1367230",
    "end": "1375650"
  },
  {
    "text": "target that I want you to keep and this is the minimum and maximum of machines that I want you to use we decided to use",
    "start": "1375650",
    "end": "1386070"
  },
  {
    "text": "a CPU based metric since the seem like a well simpler solution and we just wanted",
    "start": "1386070",
    "end": "1391380"
  },
  {
    "text": "to see how it's going to work and an iterate on it if it does not work",
    "start": "1391380",
    "end": "1397220"
  },
  {
    "text": "but first thing first one important thing that needs to be considered before",
    "start": "1406470",
    "end": "1411670"
  },
  {
    "text": "the autoscaler is turned on is that the components which are being Auto skilled need to be stateless if the components",
    "start": "1411670",
    "end": "1419560"
  },
  {
    "text": "are not stateless turning on the autoscaler is hard or I would even dare to say it's impossible the good thing is",
    "start": "1419560",
    "end": "1428080"
  },
  {
    "text": "that we in Spotify started designing and building all of our services to be",
    "start": "1428080",
    "end": "1434290"
  },
  {
    "text": "stateless long before we started considering the autoscaler we did this because by having your services",
    "start": "1434290",
    "end": "1442360"
  },
  {
    "text": "stateless it's much easier to understand what are they doing and it's also much easier to scale because you can just",
    "start": "1442360",
    "end": "1448780"
  },
  {
    "text": "drop more capacity as needed in case of hardware issues you don't here you just recycle a machine and order a new one",
    "start": "1448780",
    "end": "1455710"
  },
  {
    "text": "and that's it the hard stuff the state keeping we usually try to push to the third party",
    "start": "1455710",
    "end": "1462910"
  },
  {
    "text": "services which are battle tested and which we know that can handle the load",
    "start": "1462910",
    "end": "1468930"
  },
  {
    "text": "so in this case in our event delivery system we're using cloud sequel and also",
    "start": "1468930",
    "end": "1474160"
  },
  {
    "text": "we're using cloud pub/sub worth mentioning here is that the cloud",
    "start": "1474160",
    "end": "1479500"
  },
  {
    "text": "pub/sub difference between Kafka and cloud pub/sub is that with the cloud pub/sub you can yet completely stateless",
    "start": "1479500",
    "end": "1486040"
  },
  {
    "text": "consumers and there is no limitation on how many consumers you can have you just",
    "start": "1486040",
    "end": "1491170"
  },
  {
    "text": "drop drop consumers in your system and they just well somehow magically",
    "start": "1491170",
    "end": "1497130"
  },
  {
    "text": "coordinate and consume the right messages this fact that we can get",
    "start": "1497130",
    "end": "1503650"
  },
  {
    "text": "stateless consumers was one of the biggest reasons why did you choose to use cloud pub/sub for managing all the",
    "start": "1503650",
    "end": "1510820"
  },
  {
    "text": "streams we're having instead of Kafka so",
    "start": "1510820",
    "end": "1517360"
  },
  {
    "text": "we turned out the auto scaling and well at some point we noticed a really",
    "start": "1517360",
    "end": "1522700"
  },
  {
    "text": "interesting thing sometimes we would have some machines using 100% of the CPU",
    "start": "1522700",
    "end": "1530350"
  },
  {
    "text": "while other machines from the same group would use 0% of the soup view because",
    "start": "1530350",
    "end": "1536320"
  },
  {
    "text": "they ended up somehow in a zombie State what was really mind-blowing for us and a bit",
    "start": "1536320",
    "end": "1542979"
  },
  {
    "text": "unexpected was well the autoscaler thinks that the average usage of the CPU",
    "start": "1542979",
    "end": "1549220"
  },
  {
    "text": "in this case is 50% and then because we wanted to save resources and of course",
    "start": "1549220",
    "end": "1554979"
  },
  {
    "text": "we wanted to have our machines use more than 50% of the CPU we wouldn't scale up even if the backlog",
    "start": "1554979",
    "end": "1562059"
  },
  {
    "text": "was growing on the other side the same situation would be if we would have only one machine dead machines ended up in",
    "start": "1562059",
    "end": "1568779"
  },
  {
    "text": "the zombie State it does have 0% CPU autoscaler things while you're not using enough CPU so I'm not going to give you",
    "start": "1568779",
    "end": "1575470"
  },
  {
    "text": "more machines and the background rows on the other side of course we get waken up on the night we need to fix this and at",
    "start": "1575470",
    "end": "1583330"
  },
  {
    "text": "some point I guess it got really hard we got really frustrated and we said this",
    "start": "1583330",
    "end": "1588759"
  },
  {
    "text": "is really important problem we need to see how are we going to mitigate this so first mitigation the simplest possible",
    "start": "1588759",
    "end": "1595720"
  },
  {
    "text": "ever just always use at least two machines per each event type this would",
    "start": "1595720",
    "end": "1601840"
  },
  {
    "text": "avoid of actually getting in a really bad state we could still end up in a bad state though but because this mitigation",
    "start": "1601840",
    "end": "1610869"
  },
  {
    "text": "alone wasn't enough we needed to actually go and find another mitigation how are we going to figure out which",
    "start": "1610869",
    "end": "1617109"
  },
  {
    "text": "machines are in the zombie State and why are they ending up in the zombies data but before I actually reveal to you what",
    "start": "1617109",
    "end": "1625419"
  },
  {
    "text": "was the second mitigation I need to explain what is being run on each machine which is being provisioned for a",
    "start": "1625419",
    "end": "1632649"
  },
  {
    "text": "worker to run so the first thing we provision a machine is a completely",
    "start": "1632649",
    "end": "1639159"
  },
  {
    "text": "blank machine and then we start running puppet when the puppet runs even it",
    "start": "1639159",
    "end": "1645039"
  },
  {
    "text": "needs to install all the packages we need and to spin up all the services we",
    "start": "1645039",
    "end": "1650529"
  },
  {
    "text": "need so the machine would end up in operational state so in our case it",
    "start": "1650529",
    "end": "1656109"
  },
  {
    "text": "installed Stoker it installs a deployment eternity stalls a service discovery configuration and it is those",
    "start": "1656109",
    "end": "1662590"
  },
  {
    "text": "a monitoring daemon once they are installed our deployment agents take",
    "start": "1662590",
    "end": "1668979"
  },
  {
    "text": "over and deploys our code to run on docker and ARB well",
    "start": "1668979",
    "end": "1675880"
  },
  {
    "text": "worker starts serving the data first",
    "start": "1675880",
    "end": "1681700"
  },
  {
    "text": "this process is really slow it can take sometimes more than 10 minutes just to",
    "start": "1681700",
    "end": "1688630"
  },
  {
    "text": "bootstrap a single machine ok but not only being slow this process is also you",
    "start": "1688630",
    "end": "1696640"
  },
  {
    "text": "wasting with too many of our resources all of the additional processes beside",
    "start": "1696640",
    "end": "1702880"
  },
  {
    "text": "our apply mean that are run there beside her worker are reaching the same CPU and",
    "start": "1702880",
    "end": "1708070"
  },
  {
    "text": "they're eating the same memory that our worker should use this is actually limiting how small machine can be used",
    "start": "1708070",
    "end": "1714850"
  },
  {
    "text": "for each worker we need to use at least force if your machines because we need to cpu for all the overhead we're having",
    "start": "1714850",
    "end": "1721419"
  },
  {
    "text": "I guess by now you're all wondering like",
    "start": "1721419",
    "end": "1726639"
  },
  {
    "text": "why did you went with this process how did you even come up with that process well worth noting is that the Spotify",
    "start": "1726639",
    "end": "1735159"
  },
  {
    "text": "just recently and that was I think almost exactly a year ago when we announced it decided to go in a cloud",
    "start": "1735159",
    "end": "1743679"
  },
  {
    "text": "game this is a process which we have been using to bootstrap all of machines",
    "start": "1743679",
    "end": "1749139"
  },
  {
    "text": "in our data center we've been using it for years it does have it all it is slow",
    "start": "1749139",
    "end": "1756250"
  },
  {
    "text": "it does use it a lot of CPU but it works",
    "start": "1756250",
    "end": "1762789"
  },
  {
    "text": "there is a lot of operational knowledge being embedded in many of the puppet",
    "start": "1762789",
    "end": "1767799"
  },
  {
    "text": "manifesting in many of the puppet classes and how do we install docker and all that kind of stuff since we're the",
    "start": "1767799",
    "end": "1775090"
  },
  {
    "text": "first team in Spotify using the autoscaler we were afraid of actually needing to",
    "start": "1775090",
    "end": "1781419"
  },
  {
    "text": "reinvent this process and we just wanted to use this as something simplest that can get us forward to see if the",
    "start": "1781419",
    "end": "1787570"
  },
  {
    "text": "autoscaler is going to work for us or not and of course there is one one thing",
    "start": "1787570",
    "end": "1795970"
  },
  {
    "text": "that I also forgot to mention which is creating a little worse resource use",
    "start": "1795970",
    "end": "1802419"
  },
  {
    "text": "attorney should is that our deployment agent can deploy only single worker process on",
    "start": "1802419",
    "end": "1808119"
  },
  {
    "text": "a single machine because we doesn't support multi-tenancy and it doesn't support multi-tenancy",
    "start": "1808119",
    "end": "1814299"
  },
  {
    "text": "with the resource isolation since this",
    "start": "1814299",
    "end": "1820389"
  },
  {
    "text": "process is as complex our first suspect was that the bootstrapping process is",
    "start": "1820389",
    "end": "1828369"
  },
  {
    "text": "actually creating a zombie machines and of course the first suspect for the",
    "start": "1828369",
    "end": "1833409"
  },
  {
    "text": "bootstrapping process was puppet nobody likes puppet it is magical and people are often just frustrated by it",
    "start": "1833409",
    "end": "1841049"
  },
  {
    "text": "so just blame puppet but even if we all",
    "start": "1841049",
    "end": "1846939"
  },
  {
    "text": "like to blame puppet is as we did that the truth was puppet was working fairly well all the processes were installed as",
    "start": "1846939",
    "end": "1854859"
  },
  {
    "text": "they should and all the services were going up as they should so the other",
    "start": "1854859",
    "end": "1863019"
  },
  {
    "text": "thing that we when we started looking even further we figured out docker is",
    "start": "1863019",
    "end": "1868299"
  },
  {
    "text": "the main root cause of all of our problems I was like it's like the",
    "start": "1868299",
    "end": "1874209"
  },
  {
    "text": "hippest technology ever and everybody is talking about docker and it's just terrible and then that's why I put it",
    "start": "1874209",
    "end": "1880839"
  },
  {
    "text": "like here it's like it's constantly on fire and it's all constantly said because it knows that we're getting woken up and our spouses get woken up",
    "start": "1880839",
    "end": "1887739"
  },
  {
    "text": "and get angry at us so so so it like",
    "start": "1887739",
    "end": "1895359"
  },
  {
    "text": "there was like just so many crazy issues so we would get like doctor proxy being broken networking doesn't work we would",
    "start": "1895359",
    "end": "1901629"
  },
  {
    "text": "get darker getting in the fan state and we can only reboot machine to keep on working and sometimes it pulls the image",
    "start": "1901629",
    "end": "1909459"
  },
  {
    "text": "hundred percent but then just returns 404 and then the only restarting doctor would work since we are not go engine",
    "start": "1909459",
    "end": "1916749"
  },
  {
    "text": "ears and since we don't want to go into actually understanding how the doctor works because it should be just a black",
    "start": "1916749",
    "end": "1922959"
  },
  {
    "text": "box we wanted to find a workaround that would work best for us and enable us to",
    "start": "1922959",
    "end": "1928209"
  },
  {
    "text": "move forward so the first thing here was that we enabled health checks from the autoscaler",
    "start": "1928209",
    "end": "1933759"
  },
  {
    "text": "what the health checks do is that they are actually pinging our",
    "start": "1933759",
    "end": "1938830"
  },
  {
    "text": "worker process and if the worker process don't don't respond for a certain amount of time they just recycle the machine",
    "start": "1938830",
    "end": "1945299"
  },
  {
    "text": "but here is a new problem when they recycle the machine they spin up a new machine with the same name which now",
    "start": "1945299",
    "end": "1952330"
  },
  {
    "text": "makes our puppet said puppet gets a new key puppet master has the old key public",
    "start": "1952330",
    "end": "1959740"
  },
  {
    "text": "you know taboos rep machine and we just get in a worse state okay we can't use hell checks let's see what what else can",
    "start": "1959740",
    "end": "1966039"
  },
  {
    "text": "we do kill script so what we did is actually we use puppet to help us with",
    "start": "1966039",
    "end": "1971950"
  },
  {
    "text": "disciplining doctor so we have our kill scripts which are looking at the doctor state and then",
    "start": "1971950",
    "end": "1977350"
  },
  {
    "text": "based on that they wipe the doctor state and restart it or just reboot the machine we put a monitor monitoring",
    "start": "1977350",
    "end": "1985840"
  },
  {
    "text": "because we like put monitoring to understand what is happening in our system and what we saw it was terrifying",
    "start": "1985840",
    "end": "1992580"
  },
  {
    "text": "we get 10% of all of our machines being rebooted every hour because doctor is",
    "start": "1992580",
    "end": "2000600"
  },
  {
    "text": "ending up in a different state if the doctor is the state our machine cannot work like the important thing is",
    "start": "2000600",
    "end": "2007590"
  },
  {
    "text": "that it allows us to move forward and no matter how terrible it is",
    "start": "2007590",
    "end": "2012779"
  },
  {
    "text": "we're not woken up in our SL ace are safe so let's look at the graphs how do",
    "start": "2012779",
    "end": "2021990"
  },
  {
    "text": "how are we actually performing with auto-scaling uh so on the top graph you",
    "start": "2021990",
    "end": "2027120"
  },
  {
    "text": "can see the amount of events which are being published you can see that the peaks are really prominent while there",
    "start": "2027120",
    "end": "2035039"
  },
  {
    "text": "is like huge dips here is how many machines are we using uh you can see",
    "start": "2035039",
    "end": "2040889"
  },
  {
    "text": "there are some Peaks but they are not as prominent so the good thing about this process is that we actually prove to",
    "start": "2040889",
    "end": "2048210"
  },
  {
    "text": "ourselves that we can save some of the resources during the day during the",
    "start": "2048210",
    "end": "2054270"
  },
  {
    "text": "night not during the day but the problem was that because of all the suboptimal",
    "start": "2054270",
    "end": "2061618"
  },
  {
    "text": "resource usage the fact that we have a common container Orchestrator we does",
    "start": "2061619",
    "end": "2067740"
  },
  {
    "text": "the support multi-tenancy and the fact that at least we need two machines to be used there is a lot of resources still being",
    "start": "2067740",
    "end": "2076860"
  },
  {
    "text": "wasted and this is definitely something that we want to look at okay so now it's",
    "start": "2076860",
    "end": "2087810"
  },
  {
    "text": "a fun stuff so how many of you like",
    "start": "2087810",
    "end": "2098760"
  },
  {
    "text": "horror stories I did oh come on okay I can skip this slide and just go to some",
    "start": "2098760",
    "end": "2104700"
  },
  {
    "text": "boring stuff so this is one of the worst stories and I think this is something",
    "start": "2104700",
    "end": "2111510"
  },
  {
    "text": "that you should teach in schools and this is something that you should say like maybe write a warning with the",
    "start": "2111510",
    "end": "2117600"
  },
  {
    "text": "autoscaler like you write warnings today when you when you buy alcohol bottles and stuff alcohol ah",
    "start": "2117600",
    "end": "2123740"
  },
  {
    "text": "the thing is autoscaler is really powerful but you need to be really careful how are you using it so what our",
    "start": "2123740",
    "end": "2131370"
  },
  {
    "text": "system does is that it consumes from the cloud pub/sub it writes to the cloud storage so here is pub/sub here is cloud",
    "start": "2131370",
    "end": "2139080"
  },
  {
    "text": "storage and it persists um stay to the data store once that state is safely persisted it just sends acknowledgements",
    "start": "2139080",
    "end": "2146250"
  },
  {
    "text": "back to the cloud pub/sub okay we start pushing more and more events our system",
    "start": "2146250",
    "end": "2153830"
  },
  {
    "text": "well was growing and at some point datastore caught fire there are some",
    "start": "2153830",
    "end": "2159930"
  },
  {
    "text": "internal limitations which are while not really scaling well the way we designed",
    "start": "2159930",
    "end": "2166830"
  },
  {
    "text": "our software and it it became increasingly sluggish as it became",
    "start": "2166830",
    "end": "2171900"
  },
  {
    "text": "sluggish we were not sending acknowledgements back our backlog grew we started using more CPU autoscaler",
    "start": "2171900",
    "end": "2178740"
  },
  {
    "text": "dropped more machines here is more machines you can consume your backlog how fast ok we put even more pressure to datastore",
    "start": "2178740",
    "end": "2186300"
  },
  {
    "text": "our backlog grows even more because datastore just cost in a worse state",
    "start": "2186300",
    "end": "2191600"
  },
  {
    "text": "autoscaler just says here you go here is more machines let's let's see how are we going to deal with it so what do you",
    "start": "2191600",
    "end": "2197730"
  },
  {
    "text": "think happened next so so so what happened is that we scaled",
    "start": "2197730",
    "end": "2207110"
  },
  {
    "text": "until we could use all the available RAM in the project we all of a sudden we",
    "start": "2207110",
    "end": "2214970"
  },
  {
    "text": "were having lunch and all of a sudden people actually call us like why do you need a terabytes of RAM like her insane",
    "start": "2214970",
    "end": "2220760"
  },
  {
    "text": "people could not spin up their data flow jobs people who could not spin up data Pro cluster people could not spin up",
    "start": "2220760",
    "end": "2226880"
  },
  {
    "text": "machines to serve the service all in all it was a really fun night I was actually",
    "start": "2226880",
    "end": "2232370"
  },
  {
    "text": "on call during that day and I I think I I went home at around 1:00 or something",
    "start": "2232370",
    "end": "2238100"
  },
  {
    "text": "like that and was like completely tired and like but nevertheless it was a good learning opportunity and then after we",
    "start": "2238100",
    "end": "2245150"
  },
  {
    "text": "did a post-mortem we kind of talked about it and it turns out we could",
    "start": "2245150",
    "end": "2251000"
  },
  {
    "text": "actually avoid this but just being smarter about handling our failure cases if we had a simple simple exponential",
    "start": "2251000",
    "end": "2259430"
  },
  {
    "text": "back-off in case we cannot write to the datastore or maybe to cloud storage we would shuffle down the CPU because we",
    "start": "2259430",
    "end": "2266030"
  },
  {
    "text": "would have well more time before we consumed from the pub/sub and the other learning was well data store in this",
    "start": "2266030",
    "end": "2273440"
  },
  {
    "text": "case was not the perfect tool for us to use so we started using cloud sequel all",
    "start": "2273440",
    "end": "2286850"
  },
  {
    "text": "in all because our current the biggest problem with this approach is that we're",
    "start": "2286850",
    "end": "2294680"
  },
  {
    "text": "having really suboptimal resource usage and we're trying to figure out how to work with it so we started looking",
    "start": "2294680",
    "end": "2302390"
  },
  {
    "text": "closely to kubernetes because kubernetes comes is a managed product from the",
    "start": "2302390",
    "end": "2308180"
  },
  {
    "text": "google cloud it also supports auto scaling out of the box and it suppose multi-tenancy with",
    "start": "2308180",
    "end": "2313820"
  },
  {
    "text": "the resource isolation everything we need but unfortunately not everything is",
    "start": "2313820",
    "end": "2318830"
  },
  {
    "text": "simple for us because if we lose the ability to run puppet on the machines as",
    "start": "2318830",
    "end": "2323840"
  },
  {
    "text": "we would lose it if you would use manage kubernetes we would not be able to do",
    "start": "2323840",
    "end": "2329030"
  },
  {
    "text": "the monitoring we do it today and we would not be able to do the service discovery which today but we'll see we'll see what the",
    "start": "2329030",
    "end": "2337080"
  },
  {
    "text": "time is going to show and then I have",
    "start": "2337080",
    "end": "2342620"
  },
  {
    "text": "just a few words before I end on how do we do testing in Spotify we are taking",
    "start": "2342620",
    "end": "2349890"
  },
  {
    "text": "testing seriously and we are big fans of doing continuous integration and deployments so what we do is that for",
    "start": "2349890",
    "end": "2361020"
  },
  {
    "text": "many of our backing services we always ensure there is enough unit tests to be tested before they are being pushed to",
    "start": "2361020",
    "end": "2367200"
  },
  {
    "text": "the production but because Spotify even delivery system is a complex distributed",
    "start": "2367200",
    "end": "2373020"
  },
  {
    "text": "system consisting of many smaller micro services we wanted to have a end-to-end",
    "start": "2373020",
    "end": "2379650"
  },
  {
    "text": "test which is going to cover the full flow and which can be run on a single",
    "start": "2379650",
    "end": "2385110"
  },
  {
    "text": "developer machine so it would be easy to iterate on it so what we did we actually just well stuffed all the stuff in a",
    "start": "2385110",
    "end": "2391860"
  },
  {
    "text": "single cucumber file we have all of our services being spinned up as a black",
    "start": "2391860",
    "end": "2397920"
  },
  {
    "text": "boxes on docker introduce some output input and observe the output and that's",
    "start": "2397920",
    "end": "2403410"
  },
  {
    "text": "it interesting thing is that this is run before the code is being merged and it's",
    "start": "2403410",
    "end": "2408990"
  },
  {
    "text": "also being run before the code is being deployed to production and few times we",
    "start": "2408990",
    "end": "2415590"
  },
  {
    "text": "actually ignored what the end-to-end test is telling us because sometimes it can take up to ten minutes to run and we",
    "start": "2415590",
    "end": "2422160"
  },
  {
    "text": "have big incidents but when we learned it actually saved us quite a few times",
    "start": "2422160",
    "end": "2427730"
  },
  {
    "text": "and that would be it thank you",
    "start": "2427730",
    "end": "2433910"
  },
  {
    "text": "so before we start with the questioning we're hiring if you like working with these interesting problems feel free to",
    "start": "2439710",
    "end": "2446740"
  },
  {
    "text": "check the site and please don't ask me any questions about the google cloud costa and now questions",
    "start": "2446740",
    "end": "2457710"
  },
  {
    "text": "yeah what what went wrong with Kafka actually so we chakra went wrong and",
    "start": "2461740",
    "end": "2467980"
  },
  {
    "text": "many things so the the first thing that went wrong is that we're having multiple data centers and we wanted to use the",
    "start": "2467980",
    "end": "2474339"
  },
  {
    "text": "mirror makers at a point when we started to actually experiment with the mirror makers we figured out that mirror makers",
    "start": "2474339",
    "end": "2481480"
  },
  {
    "text": "are not really mirroring the data they're dropping the data if the destination cluster is down so there was",
    "start": "2481480",
    "end": "2486880"
  },
  {
    "text": "like really big thing the second thing that went wrong is that the client libraries were kind of hard to work with",
    "start": "2486880",
    "end": "2493720"
  },
  {
    "text": "because they were ending up in a really weird state that we could we didn't know how to recover from and the only thing",
    "start": "2493720",
    "end": "2500500"
  },
  {
    "text": "was to reboot the machines and at that point we said yeah just cloud pub/sub is just more convenient for us okay yep hi",
    "start": "2500500",
    "end": "2511330"
  },
  {
    "text": "I have a question regarding having the team's doing operations of your services",
    "start": "2511330",
    "end": "2516760"
  },
  {
    "text": "so do you have any metrics regarding I don't know frequency or severity of",
    "start": "2516760",
    "end": "2522580"
  },
  {
    "text": "incidence may be compared to other players of your scale or to the time",
    "start": "2522580",
    "end": "2528490"
  },
  {
    "text": "before you switch that node so I I don't have the numbers because we don't really",
    "start": "2528490",
    "end": "2534280"
  },
  {
    "text": "track them I mean we do have incidence across the board every single day or maybe not every single day maybe every",
    "start": "2534280",
    "end": "2540760"
  },
  {
    "text": "second day yeah but the important thing would actually change for us and why did we went with the actually DevOps system",
    "start": "2540760",
    "end": "2547450"
  },
  {
    "text": "is that we were hiring more and more developers and there happened a few years ago and we were not hiring what we",
    "start": "2547450",
    "end": "2553690"
  },
  {
    "text": "couldn't hire in fsor race so this is why we pushed more operational responsibility toward the squads so what",
    "start": "2553690",
    "end": "2561640"
  },
  {
    "text": "I think is that you as a developer when you're developing and when you're seeing your system in production you're",
    "start": "2561640",
    "end": "2567310"
  },
  {
    "text": "inclined to make your system much better because you care much more about the",
    "start": "2567310",
    "end": "2572349"
  },
  {
    "text": "people you work with than just some operations team that sits like three rooms down or something like that and I",
    "start": "2572349",
    "end": "2579070"
  },
  {
    "text": "think that's that's what works the best and I really think it works really well for us",
    "start": "2579070",
    "end": "2585150"
  },
  {
    "text": "if you can just back down one slide please from the testing yeah do you run",
    "start": "2591510",
    "end": "2596950"
  },
  {
    "text": "this on the developers machine everyone who runs this on their own PC no but why",
    "start": "2596950",
    "end": "2604480"
  },
  {
    "text": "I said it's a developer machine is that because I think if you can run your stuff on your developer machine is much",
    "start": "2604480",
    "end": "2610900"
  },
  {
    "text": "easier to iterate and fix it so we were having issues with Python in the beginning and the biggest issue was the",
    "start": "2610900",
    "end": "2617170"
  },
  {
    "text": "developers could not run the Python in the libraries we've developed on their local machines but what is important",
    "start": "2617170",
    "end": "2624190"
  },
  {
    "text": "like even if it can run on the developer machine we don't really run it that we have a Jenkins server which is handling",
    "start": "2624190",
    "end": "2630160"
  },
  {
    "text": "world all our bills and all our deployment and this is where this this",
    "start": "2630160",
    "end": "2635500"
  },
  {
    "text": "is being run so in a CI environment in a CI environment yes sir because the",
    "start": "2635500",
    "end": "2642369"
  },
  {
    "text": "question is when you have many many micro services that you work on in small teams working on each one of them then",
    "start": "2642369",
    "end": "2649450"
  },
  {
    "text": "you have many dependencies so the question is when you work on just one and you want to test what you are doing",
    "start": "2649450",
    "end": "2656740"
  },
  {
    "text": "then you require all the others to be up so I guess this is a bit specific we're",
    "start": "2656740",
    "end": "2663250"
  },
  {
    "text": "having a big system that we need to maintain and we just happen to think it's just easier to cut it in many",
    "start": "2663250",
    "end": "2669190"
  },
  {
    "text": "smaller pieces but the important thing is that every team has its own Jenkins",
    "start": "2669190",
    "end": "2674380"
  },
  {
    "text": "and every team decides Howard with its testing it's only microservices so in",
    "start": "2674380",
    "end": "2680079"
  },
  {
    "text": "Spotify we have many micro services but there is no overall end-to-end as how how are they being tested because it is",
    "start": "2680079",
    "end": "2686829"
  },
  {
    "text": "hard and it requires so much communication and so much like effort for this to work and of course it",
    "start": "2686829",
    "end": "2693490"
  },
  {
    "text": "doesn't work ever so yeah thank you ok",
    "start": "2693490",
    "end": "2699730"
  },
  {
    "text": "hi there sorry that question I had was related to the docker over here ok the darker percentage",
    "start": "2699730",
    "end": "2707109"
  },
  {
    "text": "failures it seems incredibly high and I was wondering could you give us some more",
    "start": "2707109",
    "end": "2712450"
  },
  {
    "text": "information as to the type of failures you saw and are you happy to continue to live with that level of failure and if",
    "start": "2712450",
    "end": "2719710"
  },
  {
    "text": "not what are you doing - trying dressers so I can tell you we're definitely not happy and I hate it so",
    "start": "2719710",
    "end": "2726359"
  },
  {
    "text": "much currently currently currently we're",
    "start": "2726359",
    "end": "2731550"
  },
  {
    "text": "working with one team in the New York which is handling the docker stuff and we're trying to upgrade but of course",
    "start": "2731550",
    "end": "2737070"
  },
  {
    "text": "this is not simple because the upgrades you have other bugs and like if it's kind I don't know but the thing is like",
    "start": "2737070",
    "end": "2743510"
  },
  {
    "text": "we think that the Dockers and the containers were a big game-changer for us and that we would definitely would like",
    "start": "2743510",
    "end": "2751800"
  },
  {
    "text": "to keep on working as with the container environments as we are working today but we don't know what could be used that's",
    "start": "2751800",
    "end": "2758220"
  },
  {
    "text": "the problem we had a big incident a while ago with",
    "start": "2758220",
    "end": "2763320"
  },
  {
    "text": "kubernetes and one of the one of my questions was like can we use something else not docker for kubernetes and then",
    "start": "2763320",
    "end": "2770730"
  },
  {
    "text": "some Google engineers were said like please please PLEASE ask ask rpm to support rocket apparently rocket is much",
    "start": "2770730",
    "end": "2777030"
  },
  {
    "text": "better but I have no idea so I don't know I mean a lot of the Google services are based on kubernetes themselves so if",
    "start": "2777030",
    "end": "2783869"
  },
  {
    "text": "you have google engineers telling you not to use it that doesn't inspire confidence going forward so the fun",
    "start": "2783869",
    "end": "2791730"
  },
  {
    "text": "thing was like okay so we had we were building our own scheduler on kubernetes",
    "start": "2791730",
    "end": "2796859"
  },
  {
    "text": "to schedule all the data jobs and it has a special quirk it actually wants to run",
    "start": "2796859",
    "end": "2802250"
  },
  {
    "text": "backup jobs so at some point we started having a lot of failures because docker",
    "start": "2802250",
    "end": "2808740"
  },
  {
    "text": "PS was taking more than 60 seconds to return and then when we started talking about the kubernetes engineers while",
    "start": "2808740",
    "end": "2815670"
  },
  {
    "text": "trying to solve the case they were just mentioning that there is so many workarounds they needed to implement for",
    "start": "2815670",
    "end": "2822090"
  },
  {
    "text": "the docker and they were so scared for going from one version to another because if they would go probably docker",
    "start": "2822090",
    "end": "2829800"
  },
  {
    "text": "PS would be faster but who knows what else would they actually unleash so I",
    "start": "2829800",
    "end": "2835830"
  },
  {
    "text": "don't know I mean it's kind of hard the expression ODIHR comes to mind yeah okay",
    "start": "2835830",
    "end": "2844910"
  },
  {
    "text": "hi so you mentioned you've got some",
    "start": "2844910",
    "end": "2850470"
  },
  {
    "text": "something like 350 event types how did you split this interview pops up",
    "start": "2850470",
    "end": "2855670"
  },
  {
    "text": "so you have like dedicated topics for events yes so I actually I did this talk",
    "start": "2855670",
    "end": "2861700"
  },
  {
    "text": "before I know when I talked to Danny he said I should show you but I was afraid this is going to confuse so many people",
    "start": "2861700",
    "end": "2867579"
  },
  {
    "text": "so because it is confusing and it's actually 40 minutes talks so we have a",
    "start": "2867579",
    "end": "2872640"
  },
  {
    "text": "we're sending a single stream of the events because of the legacy reason to this service and then we're splitting",
    "start": "2872640",
    "end": "2878740"
  },
  {
    "text": "them up and publishing them to the topics another quirk of pub/sub is that actually if the topic is not the same as",
    "start": "2878740",
    "end": "2887200"
  },
  {
    "text": "topic in Kafka so you actually need to create a subscription and every subscription you create it has own state",
    "start": "2887200",
    "end": "2893890"
  },
  {
    "text": "so every event which is being consumed by our events here is consuming data from a specific subscription do you find",
    "start": "2893890",
    "end": "2903579"
  },
  {
    "text": "you get duplications as well say for from so from the same topic if you come multiple workers on one",
    "start": "2903579",
    "end": "2910570"
  },
  {
    "text": "subscriber and how do you deal with that so here's the bigger attack",
    "start": "2910570",
    "end": "2916869"
  },
  {
    "text": "oops oh yeah I'm sorry I know so the",
    "start": "2916869",
    "end": "2922420"
  },
  {
    "text": "thing is like yes cloud pub/sub is at least once so what it does it actually consumes it and writes it to the",
    "start": "2922420",
    "end": "2928839"
  },
  {
    "text": "temporary bucket and then saves state saving here is actually ensuring us to",
    "start": "2928839",
    "end": "2934810"
  },
  {
    "text": "say this is when the bucket is complete and this is when you should start processing and then at the end here we",
    "start": "2934810",
    "end": "2940599"
  },
  {
    "text": "have a MapReduce job which is taking all the intermediate files and then deduct them and then this is not enough so some",
    "start": "2940599",
    "end": "2949480"
  },
  {
    "text": "of the events can be reached right from the clients here and then be retried so",
    "start": "2949480",
    "end": "2954579"
  },
  {
    "text": "because we are having a not client timestamp we were actually having a syslog timestamp we're actually just",
    "start": "2954579",
    "end": "2960160"
  },
  {
    "text": "adapting on our semantics but at the other end here there there is another",
    "start": "2960160",
    "end": "2966190"
  },
  {
    "text": "job which is doing a semantic data thing so we would ensure that the messages are really data even from the client",
    "start": "2966190",
    "end": "2972220"
  },
  {
    "text": "perspective okay thank you okay",
    "start": "2972220",
    "end": "2977040"
  },
  {
    "text": "last question hi there so you mentioned",
    "start": "2981839",
    "end": "2987070"
  },
  {
    "text": "you have this configuration service where the event type owners can decide whether they want you to even consume",
    "start": "2987070",
    "end": "2993940"
  },
  {
    "text": "their event ID yeah of your 250 or however many you have how many are",
    "start": "2993940",
    "end": "3000450"
  },
  {
    "text": "actually being processed and how many are you just throwing away and are you literally throwing them away so they're",
    "start": "3000450",
    "end": "3005640"
  },
  {
    "text": "never recoverable or is there some these storing them somewhere and finally if I may since you've been running cloud",
    "start": "3005640",
    "end": "3012210"
  },
  {
    "text": "pub/sub have you ever lost data so no we haven't lost data with cloud pub/sub and",
    "start": "3012210",
    "end": "3017550"
  },
  {
    "text": "I'm personally most happy with the cloud pub/sub from all the Google cloud",
    "start": "3017550",
    "end": "3022589"
  },
  {
    "text": "services we are using and and in order to save resources we are completely dropping them and we communicated this",
    "start": "3022589",
    "end": "3029520"
  },
  {
    "text": "really clearly if you're not doing your due diligence you're not going to get your events and they're not recoverable",
    "start": "3029520",
    "end": "3034770"
  },
  {
    "text": "well truth is they're still recoverable because we do have stored them on the",
    "start": "3034770",
    "end": "3039810"
  },
  {
    "text": "syslog files for three days but we just pretend they're not so that's it",
    "start": "3039810",
    "end": "3046400"
  },
  {
    "text": "thanks everyone you can still come here to ask questions if you want it all questions except a price singer",
    "start": "3047270",
    "end": "3054250"
  },
  {
    "text": "[Applause]",
    "start": "3054250",
    "end": "3058599"
  }
]