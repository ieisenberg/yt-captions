[
  {
    "text": "foreign [Music]",
    "start": "0",
    "end": "15980"
  },
  {
    "text": "this presentation we are going to talk about Slack's DNA cycle a lot and a very interesting outage that we had on",
    "start": "15980",
    "end": "22260"
  },
  {
    "text": "September 30th last year I'll start by introducing myself my name",
    "start": "22260",
    "end": "28980"
  },
  {
    "text": "is Rafael Devina and I am a senior software engineer on the traffic team at slack our team looks after English",
    "start": "28980",
    "end": "34739"
  },
  {
    "text": "balancing TLS DNS cdns and leaders protection at slack among other things",
    "start": "34739",
    "end": "41760"
  },
  {
    "text": "during this talk I'm going to pretend to be a DNS expert but that's something I am really not so let's go",
    "start": "41760",
    "end": "49800"
  },
  {
    "text": "so what is DNA sec dnsc is a suite of extensions intended",
    "start": "49800",
    "end": "55680"
  },
  {
    "text": "for securing data exchange by the DNS particle this protocol provides cryptographic authentication of data",
    "start": "55680",
    "end": "61879"
  },
  {
    "text": "authenticated denial of existence and data Integrity but not availability or confidentiality",
    "start": "61879",
    "end": "69060"
  },
  {
    "text": "these are the records and key types used by dnsc which I will be referencing later on along the talk",
    "start": "69060",
    "end": "75299"
  },
  {
    "text": "so the first one is the TS record and this is the delegation signer it's used to secure delegations between name",
    "start": "75299",
    "end": "81540"
  },
  {
    "text": "servers and we also reference to this record as the chain of trust then we have the DNS key record which",
    "start": "81540",
    "end": "88680"
  },
  {
    "text": "holds the public key that resolvers can use to verify that the NSX signatures in the rrc records",
    "start": "88680",
    "end": "95520"
  },
  {
    "text": "these Roc records hold the dnsx signature for a record set resolvers can",
    "start": "95520",
    "end": "101159"
  },
  {
    "text": "verify the signature with a public key stored in the DNS key record that we just mentioned",
    "start": "101159",
    "end": "107159"
  },
  {
    "text": "and then we have nsec and nsec3 Records and this can be used by resolvers to",
    "start": "107159",
    "end": "112500"
  },
  {
    "text": "verify the non-existence of a record name and type then in terms of keys we have the sound",
    "start": "112500",
    "end": "117780"
  },
  {
    "text": "signing key which is the private portion of the key and this key just digitally signs each record set in the zone while",
    "start": "117780",
    "end": "125100"
  },
  {
    "text": "the public portion the DNS key verifies the signature itself then the key signing key will sign the",
    "start": "125100",
    "end": "132000"
  },
  {
    "text": "publicly the public key exclusively which is the DNS key creating an rrc",
    "start": "132000",
    "end": "137700"
  },
  {
    "text": "record for it foreign here's a successful DNS record request sequence where the user will",
    "start": "137700",
    "end": "144360"
  },
  {
    "text": "make a request to the recursive resolver and then the recursive resolver will attempt to track down the DNS record",
    "start": "144360",
    "end": "150620"
  },
  {
    "text": "that the user will just request it it does this by making a series of requests",
    "start": "150620",
    "end": "156300"
  },
  {
    "text": "until it reaches the authoritative dnsm server for the requested record which is slack.com in this case",
    "start": "156300",
    "end": "162599"
  },
  {
    "text": "and this is a very basic interpretation of a DNS record request so and then the sequence is the same",
    "start": "162599",
    "end": "169560"
  },
  {
    "text": "when the resolver does the insect validation and the only difference is that the additional records requested",
    "start": "169560",
    "end": "175620"
  },
  {
    "text": "and returned to perform this validation and let's keep in mind that the NSX only validates the DNS responses received up",
    "start": "175620",
    "end": "183060"
  },
  {
    "text": "to the recursion resolver and it just ensures that the request like it hasn't been tampered within",
    "start": "183060",
    "end": "189900"
  },
  {
    "text": "Transit and it's legitimately what the authoritative name server has so but Bad",
    "start": "189900",
    "end": "195120"
  },
  {
    "text": "actors can still man in the middle between the recursive resolver and the end user",
    "start": "195120",
    "end": "201300"
  },
  {
    "text": "now that we've briefly touched space on dnsack let's go through our DNA SEC Journey at Slack",
    "start": "201300",
    "end": "207780"
  },
  {
    "text": "back in May last year we started off by doing a proof of concept where we've replicated most of our DNS use cases on",
    "start": "207780",
    "end": "215159"
  },
  {
    "text": "a controlled and isolated environment in this environment we covered multiple tests and gained knowledge on how to",
    "start": "215159",
    "end": "221700"
  },
  {
    "text": "operate the NSAID once our proof of concept was successfully completed we worked on an",
    "start": "221700",
    "end": "228120"
  },
  {
    "text": "internal RFC that outlined all the necessary work to enable dnsx signing on all slack domains then prior to starting",
    "start": "228120",
    "end": "236220"
  },
  {
    "text": "the work to enable DNS exciting on any of these domains we spent significant time simplifying our DNS setup and",
    "start": "236220",
    "end": "243299"
  },
  {
    "text": "making this like some necessary zone changes in preparation for DNS Tech I'm",
    "start": "243299",
    "end": "248459"
  },
  {
    "text": "not going to cover these changes today but feel free to reach out to me after the talk if you're interested because we",
    "start": "248459",
    "end": "254159"
  },
  {
    "text": "did a fair bit of work here once we deemed ourselves to be ready for",
    "start": "254159",
    "end": "259260"
  },
  {
    "text": "the nsac we started with the actual rollout plan by Design dnsa can only be",
    "start": "259260",
    "end": "265080"
  },
  {
    "text": "enabled on a per domain basis and making it impossible to enable DNC on a like",
    "start": "265080",
    "end": "270120"
  },
  {
    "text": "per sub purse of domain or sub-zone basis so this design Choice significantly increases the risk of the",
    "start": "270120",
    "end": "276780"
  },
  {
    "text": "NSI rollouts to overcome this we categorized all our domains by the risk basically so we have",
    "start": "276780",
    "end": "283740"
  },
  {
    "text": "low medium and high in in this way in the case of failed attempt or like any",
    "start": "283740",
    "end": "289860"
  },
  {
    "text": "bugs in the early stages we would only impact themes that are used for things like monitoring or other non-critical or",
    "start": "289860",
    "end": "296400"
  },
  {
    "text": "less impactful slack features for each of these domains with all the same extensive testing and validation",
    "start": "296400",
    "end": "303060"
  },
  {
    "text": "steps making sure that all the domains were still resolving correctly as 13 S6 signing was enabled and at this point",
    "start": "303060",
    "end": "310259"
  },
  {
    "text": "you must be thinking yeah yeah but like how did it all go wrong",
    "start": "310259",
    "end": "315540"
  },
  {
    "text": "so as you might have already guessed slack.com was the last domain on our dnsi product and prior to slack.com we",
    "start": "315540",
    "end": "323039"
  },
  {
    "text": "wrote that DNS egg to all others like public domain successfully with no internal or customer impact",
    "start": "323039",
    "end": "329820"
  },
  {
    "text": "but obviously slack.com had to be different so in this section we're going to cover the three times we failed to",
    "start": "329820",
    "end": "335639"
  },
  {
    "text": "roll out the insect to slack.com so first on September 7th last year we",
    "start": "335639",
    "end": "342600"
  },
  {
    "text": "did our first attempt to enable DSX signing on slack.com however prior to publishing the the",
    "start": "342600",
    "end": "348720"
  },
  {
    "text": "slack.com DS record at the TNS registrar which is the last type of a DNS callout",
    "start": "348720",
    "end": "354000"
  },
  {
    "text": "a large ISP in the US had an outage and many of our customers reported being enabled to access like as a result",
    "start": "354000",
    "end": "360840"
  },
  {
    "text": "early in that incident and before we were even aware of this ISP issue we decided to roll back to slack.com Stone",
    "start": "360840",
    "end": "367919"
  },
  {
    "text": "changes as a precaution one day later on September 7th we",
    "start": "367919",
    "end": "374340"
  },
  {
    "text": "enabled dnsx signing on slack.com following the same procedure as on the previous attempt and again prior to",
    "start": "374340",
    "end": "380520"
  },
  {
    "text": "publishing the DS record or customer experience team noticed a small number of users reporting DNS resolution",
    "start": "380520",
    "end": "386160"
  },
  {
    "text": "problems so we started investigating and we realized most of the affected users",
    "start": "386160",
    "end": "391319"
  },
  {
    "text": "were accessing in slack through a VPN provider and once again we decided to roll back signing in in slack.com zones",
    "start": "391319",
    "end": "398220"
  },
  {
    "text": "as a precaution then after a further investigation it turned out that some resolvers become",
    "start": "398220",
    "end": "404280"
  },
  {
    "text": "more strict when dnsx signing is enabled at the authoritative name servers even before the DS records are published to",
    "start": "404280",
    "end": "411479"
  },
  {
    "text": "the.com named servers in this case so this strict DNS spec enforcement will reject the cname record",
    "start": "411479",
    "end": "418440"
  },
  {
    "text": "at the Apex of its own included the Apex of a sub Zone which was our case so this",
    "start": "418440",
    "end": "425280"
  },
  {
    "text": "was the reason that customers using VPN providers were disproportionately affected as many VPN providers use",
    "start": "425280",
    "end": "431819"
  },
  {
    "text": "resolvers with this Behavior so to overcome this problem all our subdelegated zones were updated",
    "start": "431819",
    "end": "438120"
  },
  {
    "text": "to Alias records rather than C names then after migrating all the cnms at the",
    "start": "438120",
    "end": "445259"
  },
  {
    "text": "Apex of sub zones um we we were ready for another attempt",
    "start": "445259",
    "end": "450300"
  },
  {
    "text": "right so on September 30th uh and after colorful planning we made our third attempt to enable the NSX signing on",
    "start": "450300",
    "end": "457080"
  },
  {
    "text": "slack.com so we started off by first enabling",
    "start": "457080",
    "end": "462180"
  },
  {
    "text": "signing on the author date Navy servers and the delegated substance as the last two changes and we left the showtime",
    "start": "462180",
    "end": "468419"
  },
  {
    "text": "prior to publishing the TS record at the registrar as we had seen issues on the previous two attempts",
    "start": "468419",
    "end": "474919"
  },
  {
    "text": "then after three hours soak time and successful validations we were pretty",
    "start": "474919",
    "end": "480120"
  },
  {
    "text": "confident to publish to slack.com DS record at the registrar and this basically instructed resolvers to start",
    "start": "480120",
    "end": "486300"
  },
  {
    "text": "validating DNS requests for slack.com so at this point we had fully enabled dnsx",
    "start": "486300",
    "end": "491880"
  },
  {
    "text": "on you for slack.com and everything looked great for a while on our tests or external probes or",
    "start": "491880",
    "end": "499319"
  },
  {
    "text": "monitoring were looking good and we were so happy to have completed the last domain on our dnsi correlate but then",
    "start": "499319",
    "end": "506400"
  },
  {
    "text": "after a little while things started to look a bit less idyllic our customer experienced team again",
    "start": "506400",
    "end": "512419"
  },
  {
    "text": "started making reports from users seeing DNS resolution errors in their slack clients",
    "start": "512419",
    "end": "519240"
  },
  {
    "text": "so to give you some context slack applications are based on chromium and",
    "start": "519240",
    "end": "524580"
  },
  {
    "text": "they integrate a way to export the network capture these Network capture is an event",
    "start": "524580",
    "end": "529860"
  },
  {
    "text": "logging mechanism for Chrome's Network stack to help debug problems and analyze performance networks are extensively",
    "start": "529860",
    "end": "536940"
  },
  {
    "text": "used at Slack on the left you will find the DNS configuration of a client available",
    "start": "536940",
    "end": "542459"
  },
  {
    "text": "inside the network capture and on the right you will see an attempt to resolve app.slack.com with all the relevant",
    "start": "542459",
    "end": "549180"
  },
  {
    "text": "information so during our initial investigation all the reports were",
    "start": "549180",
    "end": "554339"
  },
  {
    "text": "caused by no data or empty DNS responses from some DNS recursive resolvers",
    "start": "554339",
    "end": "561000"
  },
  {
    "text": "most of which were from a large customer using a private corporate resolver and",
    "start": "561000",
    "end": "566580"
  },
  {
    "text": "from Google public resolver so that's quite eight and we were both surprised",
    "start": "566580",
    "end": "571680"
  },
  {
    "text": "and confused by this as Google DNS failing would re to resolve slack.com",
    "start": "571680",
    "end": "576899"
  },
  {
    "text": "should mean a much larger impact than our monitoring and customer reports indicated",
    "start": "576899",
    "end": "582839"
  },
  {
    "text": "so given the data we had at the time we decided to roll back our changes for slack.com",
    "start": "582839",
    "end": "589860"
  },
  {
    "text": "then we attempted to do so by pulling the DS record from the DNS register effectively removing dislike.com DS",
    "start": "589860",
    "end": "596940"
  },
  {
    "text": "record at the.com Zone to basically stop the bleeding so we could later focus on the no data DNS responses reported that",
    "start": "596940",
    "end": "604080"
  },
  {
    "text": "the customers but after nearly an hour there were no signs of improvement and the other rates remained stable",
    "start": "604080",
    "end": "610680"
  },
  {
    "text": "so our traffic team was confident that reverting the DS record at the registrar was sufficient to eventually mitigate",
    "start": "610680",
    "end": "617100"
  },
  {
    "text": "the DNS resolution problems but I think we're not getting any better and given",
    "start": "617100",
    "end": "622560"
  },
  {
    "text": "the severity of the incident we decided to roll back one step further this was a bad idea",
    "start": "622560",
    "end": "629640"
  },
  {
    "text": "so you know we're all back the NSX signing in our slack.com authoritative",
    "start": "629640",
    "end": "634740"
  },
  {
    "text": "and delegated zones one thing to recover are DNS configuration to the last previous healthy State uh allowing us to",
    "start": "634740",
    "end": "641880"
  },
  {
    "text": "completely rule out the nsac as a problem during the incident so we had this false sense of trust in running",
    "start": "641880",
    "end": "648480"
  },
  {
    "text": "back soon The Zone signing changes due to the previous two attempts where we",
    "start": "648480",
    "end": "654120"
  },
  {
    "text": "had done this successfully with this light difference of publishing the DS record at the restart this time so as",
    "start": "654120",
    "end": "661440"
  },
  {
    "text": "soon as the rollback was pushed out things got much worse so this is an example DNS resolution",
    "start": "661440",
    "end": "668760"
  },
  {
    "text": "alert that page star traffic team so yeah that was me that day",
    "start": "668760",
    "end": "675899"
  },
  {
    "text": "so yeah um so yeah we basically said that you know slack.com was failing to resolve from",
    "start": "675899",
    "end": "682500"
  },
  {
    "text": "multiple resolvers and probes around the world this is not a page you want to get by the way",
    "start": "682500",
    "end": "688860"
  },
  {
    "text": "so our understanding at the time was and what we expected was that the DS records",
    "start": "688860",
    "end": "694620"
  },
  {
    "text": "at the.com Zone were never cached so pulling it from the registrar would cause resolvers to immediately stop",
    "start": "694620",
    "end": "700440"
  },
  {
    "text": "performing DNS validation then this assumption turned out to be somewhat untrue as the.com Zone will ask",
    "start": "700440",
    "end": "707700"
  },
  {
    "text": "resolvers to Cache the slack.com TS record for 24 hours by default",
    "start": "707700",
    "end": "714180"
  },
  {
    "text": "yeah so when you stop signing the authoritative zone is a high risk operation unless the TS record is not",
    "start": "714180",
    "end": "721440"
  },
  {
    "text": "published anymore however the Assumption of no cash TS records at the.com Zone made us think we",
    "start": "721440",
    "end": "728459"
  },
  {
    "text": "were in the same state as the previous two rollbacks having the same end result however unlike our previous attempts",
    "start": "728459",
    "end": "735839"
  },
  {
    "text": "these time resolvers had cached the DS record for up to 24 hours once the role",
    "start": "735839",
    "end": "741240"
  },
  {
    "text": "was rollback was completed so at this point all validating resolvers that had recently cached this",
    "start": "741240",
    "end": "747600"
  },
  {
    "text": "DS record started returning sir fails for slack.com lookups",
    "start": "747600",
    "end": "753480"
  },
  {
    "text": "we quickly realized the mistake we had just made and we started contacting major isps and operators that run public",
    "start": "753480",
    "end": "759420"
  },
  {
    "text": "DNS resolvers asking them to flush all the cash records for slack.com",
    "start": "759420",
    "end": "764880"
  },
  {
    "text": "additionally we practically flushed caches for resolvers that offer a public site like Google what Aid or call for",
    "start": "764880",
    "end": "772980"
  },
  {
    "text": "what nine but one sorry um so as resolvers flush their caches we",
    "start": "772980",
    "end": "778320"
  },
  {
    "text": "slowly saw signs of improvement on our internal monitoring so slack clients send their Telemetry to",
    "start": "778320",
    "end": "784740"
  },
  {
    "text": "a different domain called slack beep and thanks to this isolation we were still able to receive client metrics",
    "start": "784740",
    "end": "791040"
  },
  {
    "text": "that helped us quantify the impact of this outage ironically slack B had the unisex enabled successfully prior to",
    "start": "791040",
    "end": "797820"
  },
  {
    "text": "this incident so throughout the incident we considered",
    "start": "797820",
    "end": "802920"
  },
  {
    "text": "resigning this lag.com Zone without publishing again the TS record at the.com Zone as restoring would slightly",
    "start": "802920",
    "end": "809820"
  },
  {
    "text": "improve this situation for some users but it wouldn't have solved the issue with all the users that were initially",
    "start": "809820",
    "end": "815100"
  },
  {
    "text": "getting these no data responses after signing was enabled so for us to restore signing we would",
    "start": "815100",
    "end": "822000"
  },
  {
    "text": "have had to recover the key signing key that had been deleted when the when we rolled back the changes to the slack.com",
    "start": "822000",
    "end": "828480"
  },
  {
    "text": "zone so in in row 53 the key signing key is managed by AWS KMS key",
    "start": "828480",
    "end": "835079"
  },
  {
    "text": "so it came as is an AWS service to store Keys securely basically so this KMS key",
    "start": "835079",
    "end": "841200"
  },
  {
    "text": "was recoverable as per configuration meaning that the key signing key would be the same but we were uncertain if the",
    "start": "841200",
    "end": "847800"
  },
  {
    "text": "stone signing key would have been there the same or different as the Zone signing key is fully managed by AWS and",
    "start": "847800",
    "end": "854760"
  },
  {
    "text": "we have no visibility into it so now after the incident Amazon's Route",
    "start": "854760",
    "end": "860579"
  },
  {
    "text": "53 team confirmed that the Zone signing keyword did have been different as when re-enabling signing on the Zone this",
    "start": "860579",
    "end": "866880"
  },
  {
    "text": "sound sanity will be generated with a new key pair meaning that all the unisex validating resolvers would have",
    "start": "866880",
    "end": "872579"
  },
  {
    "text": "continued failing to validate at least until the DNS dtl expired so during the",
    "start": "872579",
    "end": "878579"
  },
  {
    "text": "incident we decided not to restore shining due to a lack of confidence but we now know it wouldn't have helped kind",
    "start": "878579",
    "end": "885540"
  },
  {
    "text": "of so at this point in some hours into the incident we were in a situation where slack was resolving correctly for",
    "start": "885540",
    "end": "892260"
  },
  {
    "text": "the vast majority of customers but a long tail of users of smaller DNS resolvers which had not flushed the",
    "start": "892260",
    "end": "899600"
  },
  {
    "text": "slack.com DS records were still impacted then as public resolvers caches were",
    "start": "899600",
    "end": "907620"
  },
  {
    "text": "flushed and the TT the 24 hour TTL on slack.com expired the error rates went",
    "start": "907620",
    "end": "913920"
  },
  {
    "text": "back to normal so at this point all we had left was a mystery to solve",
    "start": "913920",
    "end": "919639"
  },
  {
    "text": "so once the impact is like customers was mitigated we aim to determine the root cause of this average",
    "start": "920519",
    "end": "926880"
  },
  {
    "text": "um so prior to attempting dnssecondslack.com our team had successfully enabled the nsq on all",
    "start": "926880",
    "end": "932639"
  },
  {
    "text": "others like public domains so we had a lot of questions right so how was locked.com different why did we",
    "start": "932639",
    "end": "939959"
  },
  {
    "text": "not see any issues with any of the previous domains and why did this only we did this only impact some customer or",
    "start": "939959",
    "end": "946579"
  },
  {
    "text": "corporate internally as resolvers and some of Google public DNS lookups but not all of it",
    "start": "946579",
    "end": "953100"
  },
  {
    "text": "to understand what happened we replicated the wrong steps using a test sound setup which was set up identical",
    "start": "953100",
    "end": "959339"
  },
  {
    "text": "to slack.com using a resolver that we knew had problems during the outage",
    "start": "959339",
    "end": "964560"
  },
  {
    "text": "surprisingly other attempts to reproduce this Behavior were unsuccessful and at this point we were like hmm let's",
    "start": "964560",
    "end": "972300"
  },
  {
    "text": "go back to the net logs that we have received from the customers during the outage and and see what what can we get",
    "start": "972300",
    "end": "977760"
  },
  {
    "text": "from there and here's where we found that extreme interesting clue clients were able to resolve slack.com",
    "start": "977760",
    "end": "983699"
  },
  {
    "text": "successfully during the incident but they failed to resolve app.come",
    "start": "983699",
    "end": "989100"
  },
  {
    "text": "why this end indicated that there was likely a problem with the startupslack.com",
    "start": "989100",
    "end": "994680"
  },
  {
    "text": "Wildcat record to which we thought oh like none of the",
    "start": "994680",
    "end": "999839"
  },
  {
    "text": "other zones where we've done in a sec in the past contain a wildfire record this is the only one so this was clearly an",
    "start": "999839",
    "end": "1005720"
  },
  {
    "text": "oversight that we did not test the domain with a weltered record before attempting slack.com",
    "start": "1005720",
    "end": "1011779"
  },
  {
    "text": "so we collected evidence and we reached out to the Amazon prime53 team who jumped on a call with us to figure it",
    "start": "1011779",
    "end": "1018920"
  },
  {
    "text": "out and after walking them through the evidence we had they quickly correlated this Behavior to an issue with nsac",
    "start": "1018920",
    "end": "1025160"
  },
  {
    "text": "responses that Route 53 generated on Wildlife records when a request is made to a dnsack",
    "start": "1025160",
    "end": "1031339"
  },
  {
    "text": "enabled domain for a wildcat record which type does not exist for example a quality record type the answer is",
    "start": "1031339",
    "end": "1038298"
  },
  {
    "text": "assigned and SEC record confirming that while the domain name exists the requested type does not",
    "start": "1038299",
    "end": "1044660"
  },
  {
    "text": "this sign and circuit response can include some additional information specifically designed to not break Wild",
    "start": "1044660",
    "end": "1051200"
  },
  {
    "text": "Card records but graphite 3 was not returning this additional information",
    "start": "1051200",
    "end": "1056539"
  },
  {
    "text": "then what this means is that when a client does a quality lookup for app.site.com it would correctly return a",
    "start": "1056539",
    "end": "1063980"
  },
  {
    "text": "signed and sex saying there is no Rebecca for that and this is correct since we don't publish anybody records",
    "start": "1063980",
    "end": "1069980"
  },
  {
    "text": "in in this zone so the expected time Behavior then is to",
    "start": "1069980",
    "end": "1075380"
  },
  {
    "text": "fall back to requesting an a record that's instructed 53 isn't returning that extra information some public",
    "start": "1075380",
    "end": "1082100"
  },
  {
    "text": "resolvers take that response to me in no other record type exists for this record name so there's no need to query for an",
    "start": "1082100",
    "end": "1088880"
  },
  {
    "text": "a record again this msac response comes with a dtl so it will be cached by resolvers",
    "start": "1088880",
    "end": "1096140"
  },
  {
    "text": "meaning that impacted DNS resolvers were being unintentionally cash poisoned by clients innocently checking for the",
    "start": "1096140",
    "end": "1102500"
  },
  {
    "text": "existence of quantity records luckily this cash poisoning would only",
    "start": "1102500",
    "end": "1107539"
  },
  {
    "text": "affect the regional cash which means only users of an impact of regional cash for one of these resolvers will be",
    "start": "1107539",
    "end": "1114500"
  },
  {
    "text": "affected by other Regional caches would not so once we knew this and we were able to",
    "start": "1114500",
    "end": "1120980"
  },
  {
    "text": "reproduce this issue against our test zone using Google DNS but not using cloudflare DNS for example so we had a",
    "start": "1120980",
    "end": "1127940"
  },
  {
    "text": "second mystery which was whether or not one of these major public resolvers was out of spec",
    "start": "1127940",
    "end": "1133520"
  },
  {
    "text": "we went back to reading the dnsrfcs and we found out it is protocol compliant we",
    "start": "1133520",
    "end": "1138740"
  },
  {
    "text": "use a cached and set record to decide a subsequent response and this is called aggressive insec",
    "start": "1138740",
    "end": "1145039"
  },
  {
    "text": "and it's an optional spec that Google DNS implements so in the end we concluded that both options were",
    "start": "1145039",
    "end": "1151340"
  },
  {
    "text": "acceptable and the only real way to avoid being in this ambiguous situation is for your authoritative name server to",
    "start": "1151340",
    "end": "1158660"
  },
  {
    "text": "correctly return existing record types in the Anzac with map",
    "start": "1158660",
    "end": "1163720"
  },
  {
    "text": "so our mystery was finally solved and after a bit of time the roughly 53 team",
    "start": "1164120",
    "end": "1169160"
  },
  {
    "text": "fixed this insect type bug described them off together with a fix to allow recovering the same Zone shiny key if",
    "start": "1169160",
    "end": "1176000"
  },
  {
    "text": "you re-enable signing on a sound within the time frame we are very sorry for the impact this of",
    "start": "1176000",
    "end": "1181520"
  },
  {
    "text": "the chat on everyone who uses lack and we hope that this talk will shed some light on some of the corner cases with",
    "start": "1181520",
    "end": "1187340"
  },
  {
    "text": "the nsac and maybe this will prevent someone else from having a singular issue in the future",
    "start": "1187340",
    "end": "1193000"
  },
  {
    "text": "but wait there's more right so once all the postings and work was",
    "start": "1193000",
    "end": "1198799"
  },
  {
    "text": "completed where we did things like you know writing an extensive it's an internal review figuring out incident",
    "start": "1198799",
    "end": "1205280"
  },
  {
    "text": "remediation items and we work closely with roughly three to fix the bug we",
    "start": "1205280",
    "end": "1210559"
  },
  {
    "text": "spent some time writing a blog post for our engineering blog where we explain what happened and some of the key",
    "start": "1210559",
    "end": "1216919"
  },
  {
    "text": "takeaways for us from the incident so after all of this we started planning",
    "start": "1216919",
    "end": "1222200"
  },
  {
    "text": "for the next attempt we collected all the learnings from the incident and we started to figure out what had to happen",
    "start": "1222200",
    "end": "1229039"
  },
  {
    "text": "for us to be comfortable doing another attempt hopefully one last one attempt",
    "start": "1229039",
    "end": "1234400"
  },
  {
    "text": "[Music] so this is the last status update in the",
    "start": "1234400",
    "end": "1239539"
  },
  {
    "text": "DNS Tech project Channel a few days prior to attempt number four where we finally enabled dnseg on slack.com with",
    "start": "1239539",
    "end": "1247039"
  },
  {
    "text": "no issues whatsoever and I think this is uh this list is quite interesting as we had various",
    "start": "1247039",
    "end": "1254000"
  },
  {
    "text": "focuses so the first one is documentation and testing so we focused a lot on Chromebooks improving around",
    "start": "1254000",
    "end": "1260480"
  },
  {
    "text": "books and making sure they were really solid and they contain all the necessary",
    "start": "1260480",
    "end": "1265520"
  },
  {
    "text": "steps for doing all operations related to the nsac we tested a sun signing key restore",
    "start": "1265520",
    "end": "1272960"
  },
  {
    "text": "after the Route 53 feature and then we tested the key signing key restore",
    "start": "1272960",
    "end": "1278539"
  },
  {
    "text": "testing that the DNS key rrsec is the same after re-enabling or restoring this",
    "start": "1278539",
    "end": "1284120"
  },
  {
    "text": "key then the second focus is software observability we did some work to have additional",
    "start": "1284120",
    "end": "1291740"
  },
  {
    "text": "logging of DNS traffic so we have interesting metrics like like top resolvers traffic patterns when",
    "start": "1291740",
    "end": "1298580"
  },
  {
    "text": "resolvers start asking for DS records serve fails and stuff like that and we",
    "start": "1298580",
    "end": "1303679"
  },
  {
    "text": "did a dashboard with all the SDS traffic and others like key metrics and we keep",
    "start": "1303679",
    "end": "1309080"
  },
  {
    "text": "this dashboard in a monitor refreshing constantly during the rollout and this additional metrics",
    "start": "1309080",
    "end": "1314539"
  },
  {
    "text": "there are nothing other than graphite three blocks so we basically enable the",
    "start": "1314539",
    "end": "1321260"
  },
  {
    "text": "logs on the zone and we ingest them into our logs Pipeline and we make sure that",
    "start": "1321260",
    "end": "1326299"
  },
  {
    "text": "we can you know keep track of all these metrics uh to to use as part of the",
    "start": "1326299",
    "end": "1331520"
  },
  {
    "text": "runout then the third uh focus is comps so we",
    "start": "1331520",
    "end": "1337460"
  },
  {
    "text": "communicated heavily both internally at slack and within Salesforce we",
    "start": "1337460",
    "end": "1342679"
  },
  {
    "text": "communicated with the rough53 team vastly and then with the Nano G and the",
    "start": "1342679",
    "end": "1349100"
  },
  {
    "text": "DNS Arc groups the analogy is the North American Network operators group and the",
    "start": "1349100",
    "end": "1354440"
  },
  {
    "text": "dnso arc is a community of DNS operators both of which contain a lot of like Network and DNS operators that can",
    "start": "1354440",
    "end": "1362780"
  },
  {
    "text": "transmit what are they seeing in their networks and their resolvers to us and we can reach out to them if we need help",
    "start": "1362780",
    "end": "1368960"
  },
  {
    "text": "in case of another failed attempt and then the fourth but not least is the",
    "start": "1368960",
    "end": "1374780"
  },
  {
    "text": "enrollment plan so we agreed on running the rollout during the lowest traffic time in the week",
    "start": "1374780",
    "end": "1380299"
  },
  {
    "text": "and we did some zone changes before enabling signing to reduce the impact time if things go go wrong and then the",
    "start": "1380299",
    "end": "1386480"
  },
  {
    "text": "last one is basically stick to the runbook the redevelop like just follow the runbook precisely and and stick to",
    "start": "1386480",
    "end": "1394039"
  },
  {
    "text": "that so yeah the fourth attempt was the charm and today islac.com has had a DNA SEC",
    "start": "1394039",
    "end": "1401720"
  },
  {
    "text": "enabled for two months without any issues and this is a great accomplishment for us",
    "start": "1401720",
    "end": "1407960"
  },
  {
    "text": "uh so before we jump into q a I would like to do some acknowledgments uh I would like to thank the Amazon",
    "start": "1407960",
    "end": "1414440"
  },
  {
    "text": "graffiti33 team for their collaboration and for the rapid fix the Salesforce public DNS team for their kindness their",
    "start": "1414440",
    "end": "1421400"
  },
  {
    "text": "support and their DNS expertise and all the DNS Community for their invaluable help in rapidly flushing caches to bring",
    "start": "1421400",
    "end": "1428419"
  },
  {
    "text": "slack back to everyone affected by this problem and last but not least I want to give a",
    "start": "1428419",
    "end": "1434360"
  },
  {
    "text": "huge thank you to our customer experience team who are the ones in the front lines every day connecting the dots between our customers and their",
    "start": "1434360",
    "end": "1440720"
  },
  {
    "text": "engineering teams we couldn't have done it without you so yeah feel free to go ahead and read",
    "start": "1440720",
    "end": "1447740"
  },
  {
    "text": "more more details by top about this on our engineering blog over at slacktot engineering and I am now ready to answer",
    "start": "1447740",
    "end": "1454760"
  },
  {
    "text": "any questions you might have thank you all",
    "start": "1454760",
    "end": "1459158"
  },
  {
    "text": "thank you so much for for sharing your experience of that outage it sounds like it was both a long kind of time period",
    "start": "1462320",
    "end": "1469400"
  },
  {
    "text": "also a lot of very interesting learnings along the way indeed indeed it was a good good you know bunch of months worth",
    "start": "1469400",
    "end": "1476960"
  },
  {
    "text": "of work after the incident so definitely a long one yes absolutely well we're",
    "start": "1476960",
    "end": "1482360"
  },
  {
    "text": "going to be spending some time just kind of reviewing some questions about this experience from the audience so if",
    "start": "1482360",
    "end": "1487760"
  },
  {
    "text": "anyone has any questions please add them to the chat Raphael won't be able to join us in the zoom hangout later so",
    "start": "1487760",
    "end": "1493940"
  },
  {
    "text": "definitely get your questions in now uh or else obviously join us on slack for a more async question answering time",
    "start": "1493940",
    "end": "1501260"
  },
  {
    "text": "um but to kick it off I'm sort of intrigued by one of the kind of side things you mentioned during the talk you",
    "start": "1501260",
    "end": "1507620"
  },
  {
    "text": "mentioned that you spent a fairly significant time doing what I've heard described as pre-factory doing some work",
    "start": "1507620",
    "end": "1514580"
  },
  {
    "text": "before you go into the change in order to make the architecture more friendly",
    "start": "1514580",
    "end": "1519679"
  },
  {
    "text": "to the change how did you go about kind of scoping this out and estimating this",
    "start": "1519679",
    "end": "1525200"
  },
  {
    "text": "and advocating for it within the organization so I find people can often struggle to do that",
    "start": "1525200",
    "end": "1530419"
  },
  {
    "text": "yeah it's a good question so like most of the work is like simplifying our DNS",
    "start": "1530419",
    "end": "1536179"
  },
  {
    "text": "zones like we work with two vendors at the moment one of which is Route 53 and the other one is and there's one and we",
    "start": "1536179",
    "end": "1543380"
  },
  {
    "text": "had like this very like convoluted like environment where we delegated many",
    "start": "1543380",
    "end": "1548840"
  },
  {
    "text": "cents to ns1 uh because we really like some of the features that they offer for some specific like slack features",
    "start": "1548840",
    "end": "1557059"
  },
  {
    "text": "um but the thing is we had like many other domains which were like just delegated to ns1 and we're no longer",
    "start": "1557059",
    "end": "1562640"
  },
  {
    "text": "using these features and then we had like this very complicated setup where we had to like you know keep another",
    "start": "1562640",
    "end": "1567919"
  },
  {
    "text": "Link in the chain of trust to like you know have a successful DNS setup so what",
    "start": "1567919",
    "end": "1573980"
  },
  {
    "text": "we did is uh we went and did like an analysis on all the songs we look after",
    "start": "1573980",
    "end": "1579279"
  },
  {
    "text": "and and we outlined you know how many of them need to be uh like migrated back to",
    "start": "1579279",
    "end": "1586039"
  },
  {
    "text": "their like authoritative graphite three and we just like build up a plan we",
    "start": "1586039",
    "end": "1591200"
  },
  {
    "text": "factored that in into the RFC document and we just got signed up from like key like stakeholders saying yeah this is",
    "start": "1591200",
    "end": "1598580"
  },
  {
    "text": "what we should do and it's actually like extra work but that extra work will like",
    "start": "1598580",
    "end": "1603740"
  },
  {
    "text": "you know save us time in the future like both in like operating the nsac and",
    "start": "1603740",
    "end": "1608779"
  },
  {
    "text": "possible outages coming out of like you know uh like human error having to do",
    "start": "1608779",
    "end": "1614120"
  },
  {
    "text": "with um you know not establishing that chain of stars well and things like that so the less delegations we have in this",
    "start": "1614120",
    "end": "1621500"
  },
  {
    "text": "case it's it's the best for for us it sounds like it also gave you a little bit more alignment over your zones so",
    "start": "1621500",
    "end": "1627980"
  },
  {
    "text": "that your your rollout could be a bit simpler you could kind of reuse some of the same across the zones which is good",
    "start": "1627980",
    "end": "1634820"
  },
  {
    "text": "yeah exactly yeah and we had like very like some interesting things happening there so some of the migrations required",
    "start": "1634820",
    "end": "1641779"
  },
  {
    "text": "us to like build up like temporary sounds and like shift and traffic between sounds uh because we had to",
    "start": "1641779",
    "end": "1648260"
  },
  {
    "text": "rebuild some of them uh and then there's one specifically so we couldn't just like create the Zone",
    "start": "1648260",
    "end": "1655400"
  },
  {
    "text": "have the traffic shifting there because it takes a while to like populate all the records so we had to create like to",
    "start": "1655400",
    "end": "1663080"
  },
  {
    "text": "like empty temporary stones that we're not getting any traffic and shift traffic there then perform the operations that we were doing on that",
    "start": "1663080",
    "end": "1669500"
  },
  {
    "text": "zone specifically and then traffic back so it was a fair bit of work that we had to do prior to actually getting Hands-On",
    "start": "1669500",
    "end": "1676340"
  },
  {
    "text": "with the nsac Improv interesting yeah I think that's this improv kind of theme",
    "start": "1676340",
    "end": "1682760"
  },
  {
    "text": "that we're talking about today across the whole track and that you touched on is really interesting and and where that",
    "start": "1682760",
    "end": "1688460"
  },
  {
    "text": "phrase that everyone's testing in production just some people are kind of paying attention to the results or or",
    "start": "1688460",
    "end": "1693620"
  },
  {
    "text": "focusing on that this this rollout of to slack.com is a great example of that",
    "start": "1693620",
    "end": "1699380"
  },
  {
    "text": "you've done all the pre-work you've done all the testing that you could have thought of you weren't kind of skimping",
    "start": "1699380",
    "end": "1704480"
  },
  {
    "text": "and assuming you could monitor for results and yet it was still a surprise when you ran into things and you",
    "start": "1704480",
    "end": "1710240"
  },
  {
    "text": "mentioned that before you went through I think was the fourth and final successful rollout that you added some",
    "start": "1710240",
    "end": "1715760"
  },
  {
    "text": "more I did some more monitoring to it some more logging some just more observability and Telemetry are these",
    "start": "1715760",
    "end": "1722240"
  },
  {
    "text": "things that were kind of short-term ads or do you still find yourself using that data and finding yourself expanding in",
    "start": "1722240",
    "end": "1729679"
  },
  {
    "text": "other ways yeah so they're like more long-term kind of things uh like for some zones we",
    "start": "1729679",
    "end": "1736460"
  },
  {
    "text": "figured it's not always useful to have the logs enabled all the time but for",
    "start": "1736460",
    "end": "1741679"
  },
  {
    "text": "like critical tones to us I think it's really important that we have like that visibility always available",
    "start": "1741679",
    "end": "1747380"
  },
  {
    "text": "um so in the example of like graph 53 logs those are really important for us",
    "start": "1747380",
    "end": "1752539"
  },
  {
    "text": "and we have built like dashboards around them so whenever we need to do like any",
    "start": "1752539",
    "end": "1757820"
  },
  {
    "text": "DNS operations or like we have any like network type kind of outage we can like",
    "start": "1757820",
    "end": "1763520"
  },
  {
    "text": "quickly pinpoint if there's like a resolver like specific resolver that's like having their traffic dipped or we",
    "start": "1763520",
    "end": "1770480"
  },
  {
    "text": "can even see like uh like a map of traffic divided by like",
    "start": "1770480",
    "end": "1777020"
  },
  {
    "text": "the client edns subnet so we know like where our customers are and like which",
    "start": "1777020",
    "end": "1782659"
  },
  {
    "text": "uh point of presence they're reaching and all those kind of things so it's not only",
    "start": "1782659",
    "end": "1788059"
  },
  {
    "text": "like the you know figuring out like the errors on the requests it's also like additional data that helps us build like",
    "start": "1788059",
    "end": "1794299"
  },
  {
    "text": "more like you know figuring out like when's the best time to do certain things or what should we invest in a new",
    "start": "1794299",
    "end": "1800240"
  },
  {
    "text": "pop if we want to do that and that those kind of things oh very interesting yeah I think for a lot of us I've been across",
    "start": "1800240",
    "end": "1808039"
  },
  {
    "text": "the interest side and the the software kind of service side as well I think for a lot of people each side is a bit of a",
    "start": "1808039",
    "end": "1815179"
  },
  {
    "text": "black box it's like how do you debug DNS what does observability even look like when you're talking about something that",
    "start": "1815179",
    "end": "1821659"
  },
  {
    "text": "is as distributed as DNS and as many dependencies do you feel like there's any learnings that you've either brought",
    "start": "1821659",
    "end": "1827659"
  },
  {
    "text": "in from the software observability experiences if you have any into trying to bring observability to DNS or vice",
    "start": "1827659",
    "end": "1834860"
  },
  {
    "text": "versa your experiences in this infrastructure and DNS side of things that you you feel like could enable",
    "start": "1834860",
    "end": "1840440"
  },
  {
    "text": "software service owners to be to get even more insights into their services",
    "start": "1840440",
    "end": "1845779"
  },
  {
    "text": "I think it's more of the like former like I was able to bring more like",
    "start": "1845779",
    "end": "1851539"
  },
  {
    "text": "software type of you know doing things into like the DNS World in this case uh",
    "start": "1851539",
    "end": "1858020"
  },
  {
    "text": "because typically like operating DNS is just like you know doing changes on its own rather than actively monitoring you",
    "start": "1858020",
    "end": "1865340"
  },
  {
    "text": "know the traffic and all the all those things um and thanks to this like way of thinking",
    "start": "1865340",
    "end": "1872480"
  },
  {
    "text": "like the software development life cycle and you know all the metrics that we have on our clients like the slack",
    "start": "1872480",
    "end": "1879020"
  },
  {
    "text": "clients we were able to like you know get really valuable data like this slack B thing that we were mentioning like",
    "start": "1879020",
    "end": "1885440"
  },
  {
    "text": "that was critical to us because we actually get the Telemetry from the clients into like what's going on and",
    "start": "1885440",
    "end": "1892399"
  },
  {
    "text": "the fact that it goes to a separate domain it's perfect because any impact",
    "start": "1892399",
    "end": "1897440"
  },
  {
    "text": "to our like primary domains like a production domains is not affecting this",
    "start": "1897440",
    "end": "1902659"
  },
  {
    "text": "slack B domain where we get the Telemetry so we can rely on this separate like ingestion pipeline uh to",
    "start": "1902659",
    "end": "1909559"
  },
  {
    "text": "like make decisions while they're in an incident right because like some of the metrics that we were seeing during this",
    "start": "1909559",
    "end": "1915740"
  },
  {
    "text": "incident in particular uh were like you know everything was stable and everything looked good but it's because",
    "start": "1915740",
    "end": "1921679"
  },
  {
    "text": "the customers that were reaching us were fine but the ones that were not fine were not even reaching us so we like we",
    "start": "1921679",
    "end": "1928880"
  },
  {
    "text": "didn't have like that observability at the level of you know slacks infrastructure but we had it on this",
    "start": "1928880",
    "end": "1935419"
  },
  {
    "text": "slack B portion of the observability spec",
    "start": "1935419",
    "end": "1940460"
  },
  {
    "text": "yes I think there's always those kind of realizations at the wrong time when when",
    "start": "1940460",
    "end": "1945500"
  },
  {
    "text": "your status page is being hosted by the same infrastructure that your that your app is and all of a sudden you can't",
    "start": "1945500",
    "end": "1951440"
  },
  {
    "text": "even report your status being down and that's always a bit of a face palm moment that seems so obvious in in",
    "start": "1951440",
    "end": "1958100"
  },
  {
    "text": "retrospect but doesn't always get identified up front so exactly that's really interesting",
    "start": "1958100",
    "end": "1963820"
  },
  {
    "text": "yeah thank you so much for sharing all that Raphael and your additional experiences here in the Q a",
    "start": "1963820",
    "end": "1969980"
  },
  {
    "text": "um I think we uh are out of questions for now but the beautiful thing is we",
    "start": "1969980",
    "end": "1975260"
  },
  {
    "text": "have slack which if you're not already in the qcon slack please do join and we have a channel there and uh and we can",
    "start": "1975260",
    "end": "1981740"
  },
  {
    "text": "keep answering questions so thank you again for the the detailed example of uh what can be quite a hard to debug",
    "start": "1981740",
    "end": "1988159"
  },
  {
    "text": "incident sounds great thanks so much hubby thank you all have a great day bye bye",
    "start": "1988159",
    "end": "1996820"
  },
  {
    "text": "[Music]",
    "start": "1999050",
    "end": "2005339"
  }
]