[
  {
    "text": "so i'm kind of here to talk about kubernetes and operators in xcd",
    "start": "4799",
    "end": "10240"
  },
  {
    "text": "um a lot of what i'm going to be talking about is pretty generic to operators it's really about what an",
    "start": "10240",
    "end": "16480"
  },
  {
    "text": "operator is and what problems it can solve and why you would actually want to build one and also how you can build on so i'm",
    "start": "16480",
    "end": "22720"
  },
  {
    "text": "using xcd as an example um but this isn't really specific to a cd at all if you do run lcd",
    "start": "22720",
    "end": "28160"
  },
  {
    "text": "in in production you want to run it in the kubernetes cluster please come talk to me afterwards it's fascinating but",
    "start": "28160",
    "end": "33200"
  },
  {
    "text": "i'm only going to be touching on it pretty briefly so there's a little bit of an overview",
    "start": "33200",
    "end": "38879"
  },
  {
    "text": "um i work for a clinical jet stack we are primarily a consultancy we also provide training we do open source work",
    "start": "38879",
    "end": "46160"
  },
  {
    "text": "we're most well known for cert manager which is a operator for tls certificates um",
    "start": "46160",
    "end": "53360"
  },
  {
    "text": "i mostly work in the consulting side of things and that's where this story comes from so this is based on a consulting",
    "start": "53360",
    "end": "59840"
  },
  {
    "text": "engagement we started at the end of last year so we were working with a company called",
    "start": "59840",
    "end": "65360"
  },
  {
    "text": "improbable they're based here in london they're a software company they make software for massively multiplayer",
    "start": "65360",
    "end": "70840"
  },
  {
    "text": "games and they came to us with this problem statement they needed an xcd in kubernetes",
    "start": "70840",
    "end": "76880"
  },
  {
    "text": "so they were running part of our platform in kubernetes they wanted to do alongside of it to simplify their management story",
    "start": "76880",
    "end": "83200"
  },
  {
    "text": "so let's take a bit of a step back and figure out why this is difficult at all why am i even talking about this so",
    "start": "83200",
    "end": "90479"
  },
  {
    "text": "first of all is xcd itself scd is famous for being the backing store",
    "start": "90479",
    "end": "96320"
  },
  {
    "text": "for kubernetes so everything you put in kubernetes is stored in there and that's where you most see people",
    "start": "96320",
    "end": "102720"
  },
  {
    "text": "talking about it but this is not that use case something else the project itself is a completely generic distributed",
    "start": "102720",
    "end": "108560"
  },
  {
    "text": "key value store it's a cncf hosted project and it's been going along for a couple",
    "start": "108560",
    "end": "114079"
  },
  {
    "text": "of years now originally made by core os so why is this difficult to put in",
    "start": "114079",
    "end": "120240"
  },
  {
    "text": "kubernetes in the first place well let's take a look at the traditional case",
    "start": "120240",
    "end": "125439"
  },
  {
    "text": "so this is if you're running this on either bare metal or vms or cloud vms like ec2 or",
    "start": "125439",
    "end": "131440"
  },
  {
    "text": "something like that so no orchestration layer of any kind so in this we've deployed three machines",
    "start": "131440",
    "end": "137520"
  },
  {
    "text": "we have three scd instances running they have a little bit of local disk each they can contact each other and that's",
    "start": "137520",
    "end": "143520"
  },
  {
    "text": "kind of all you need to configure they once you tell them about each other using their domain names or hard-coded",
    "start": "143520",
    "end": "148879"
  },
  {
    "text": "ip addresses if you have static ips they will find each other and they will",
    "start": "148879",
    "end": "154319"
  },
  {
    "text": "use the rash consensus protocol internally to elect a leader and then from there they can start serving requests client applications can",
    "start": "154319",
    "end": "161680"
  },
  {
    "text": "connect and they'll usually connect to either all of them and they'll pick one and do client-side load balancing or you can tell it just give a",
    "start": "161680",
    "end": "168480"
  },
  {
    "text": "single domain name with a bunch of a records one pen node which can then it can again do the load",
    "start": "168480",
    "end": "173920"
  },
  {
    "text": "balancing that way so that's that's pretty simple so",
    "start": "173920",
    "end": "179120"
  },
  {
    "text": "if you've used kubernetes at all and you're looking at this the thing you're probably thinking is okay well we",
    "start": "179120",
    "end": "185440"
  },
  {
    "text": "need some persistent disk we need some persistent network identity there's a stateful set kubernetes has a",
    "start": "185440",
    "end": "190879"
  },
  {
    "text": "native component to handle this sort of task so what's wrong with that well let's",
    "start": "190879",
    "end": "198080"
  },
  {
    "text": "let's throw it through so this is the example diagram from the kubernetes icon set of a",
    "start": "198080",
    "end": "203440"
  },
  {
    "text": "stateful set so for those of you a little bit less familiar with kubernetes um we have pods",
    "start": "203440",
    "end": "209040"
  },
  {
    "text": "which are running containers which have our application in it in this case fcd we have a service that's effectively",
    "start": "209040",
    "end": "215440"
  },
  {
    "text": "providing the dns resolution to this it has a service name and it can also provide helps us provide",
    "start": "215440",
    "end": "222400"
  },
  {
    "text": "static dns names to all of the individual pods and we have those pvcs or persistent volume claims",
    "start": "222400",
    "end": "228879"
  },
  {
    "text": "which then your cloud provider will go and then like bind those to actual disk",
    "start": "228879",
    "end": "233920"
  },
  {
    "text": "over on the side there but as a user you don't really need to worry about it they end up on a disk somewhere and the",
    "start": "233920",
    "end": "239280"
  },
  {
    "text": "stateful set kind of orchestrates that side of things it'll make sure that they always get reattached to the same",
    "start": "239280",
    "end": "244480"
  },
  {
    "text": "disk it'll make sure they always get the same name perfect so why what's wrong with this why doesn't it",
    "start": "244480",
    "end": "250319"
  },
  {
    "text": "work well if you just want a completely static cluster it does work it stands up fine there's no particular",
    "start": "250319",
    "end": "257199"
  },
  {
    "text": "issues immediately but let's talk about something slightly more advanced you might want to do with",
    "start": "257199",
    "end": "262800"
  },
  {
    "text": "xcd where this starter fall apart so one feature it has is runtime",
    "start": "262800",
    "end": "268880"
  },
  {
    "text": "reconfiguration you can wireless is running add or remove",
    "start": "268880",
    "end": "274400"
  },
  {
    "text": "nodes from your xtd cluster so how you would do this is",
    "start": "274400",
    "end": "280880"
  },
  {
    "text": "you have to tell a cd about the new node first sed has this internal knowledge of all its members",
    "start": "280880",
    "end": "286400"
  },
  {
    "text": "because it's not designed to run with an orchestration layer so the first thing you have to do is actually tell it you're going to add a",
    "start": "286400",
    "end": "291919"
  },
  {
    "text": "new one then you can bring the new one online",
    "start": "291919",
    "end": "297040"
  },
  {
    "text": "uh the new one will then join it'll do the cluster if you don't do this the new one will be rejected it won't",
    "start": "297040",
    "end": "302639"
  },
  {
    "text": "join the cluster it won't form quorum it will work with census you'll get a lot of errors it's not a nice place to be so",
    "start": "302639",
    "end": "310560"
  },
  {
    "text": "the scale down is exactly the same in the inverse the first thing you do going back to our three node cluster is you tell it you're going to remove a pier",
    "start": "310560",
    "end": "316960"
  },
  {
    "text": "it will then unregister it it will stop stop replicating to it it will if it was the leader you removed it will redo a legal leader election",
    "start": "316960",
    "end": "324800"
  },
  {
    "text": "and then you take it offline so that's pretty simple this is encoded in the operations",
    "start": "324800",
    "end": "329919"
  },
  {
    "text": "guide documentation for xcd this is how they recommend that you do this so let's go back to our",
    "start": "329919",
    "end": "336880"
  },
  {
    "text": "stateful set and think how we might implement some of these problems so if you scale up we're going to add a new pod",
    "start": "336880",
    "end": "342160"
  },
  {
    "text": "and then before we turn it on we need to do something to the std cluster well in kubernetes we have a concept of",
    "start": "342160",
    "end": "349199"
  },
  {
    "text": "in a container you can you can add an extra container that will execute strictly before your",
    "start": "349199",
    "end": "354240"
  },
  {
    "text": "application starts it will perform some logic we also have a concept of a pre-stock hook this is where before kubernetes",
    "start": "354240",
    "end": "360960"
  },
  {
    "text": "will stop your container you can have it execute something you can have it exec a script in the",
    "start": "360960",
    "end": "366800"
  },
  {
    "text": "container or kind of whatever so we can start doing this but already you can kind of",
    "start": "366800",
    "end": "371919"
  },
  {
    "text": "look and see well what happens if you have comms failures what happens if you stand up and can't contact the cluster how do we determine whether this is the",
    "start": "371919",
    "end": "377919"
  },
  {
    "text": "first time we've launched or not what do we do if we have an error moving appear do we do we stop",
    "start": "377919",
    "end": "383840"
  },
  {
    "text": "blocking do we not let it shut down what do we do and then the real thing you start to realize is",
    "start": "383840",
    "end": "389360"
  },
  {
    "text": "that this pre-stop hook is going to get executed every time we shut down one of these parts not just when we scale down if",
    "start": "389360",
    "end": "396400"
  },
  {
    "text": "kubernetes decides to reallocate the pod somewhere and a node gets drained they want to put it on",
    "start": "396400",
    "end": "401440"
  },
  {
    "text": "another machine it will run that hook before it stops a container so we're going to be constantly resizing this cluster",
    "start": "401440",
    "end": "407600"
  },
  {
    "text": "even when we're not meaning to so that that kind of goes out the window slightly and that's",
    "start": "407600",
    "end": "414000"
  },
  {
    "text": "that's that's a complete disaster and then if you think about little deep if you could find another way of doing this there are",
    "start": "414000",
    "end": "419680"
  },
  {
    "text": "a whole slew of other issues that come out of this things that could go wrong things that you're going to have to",
    "start": "419680",
    "end": "425280"
  },
  {
    "text": "handle and deal with it starts to become a lot of overhead and potentially it's going to be",
    "start": "425280",
    "end": "430880"
  },
  {
    "text": "overhead on the operations team that's going to be managing this they're going to have to know how this thing works understand",
    "start": "430880",
    "end": "435919"
  },
  {
    "text": "how it could go wrong understand what to do to fix it when it inevitably does go wrong at 3am",
    "start": "435919",
    "end": "441919"
  },
  {
    "text": "so what can we do better we decided we need an operator so",
    "start": "442479",
    "end": "449680"
  },
  {
    "text": "a couple of other talks have spoken about operators already at this conference i imagine some of you already heard of concept but",
    "start": "449680",
    "end": "455440"
  },
  {
    "text": "to briefly outline the definition of an operator in kubernetes",
    "start": "455440",
    "end": "460880"
  },
  {
    "text": "if you go to the official documentation and you ask it what operator is it tells you this it can extend the api",
    "start": "460880",
    "end": "467039"
  },
  {
    "text": "which is kind of nice but how does that help us if you read down the page a little bit this is of a quote",
    "start": "467039",
    "end": "473440"
  },
  {
    "text": "that is to capture the key aim of a human operator that is to take the knowledge of how the",
    "start": "473440",
    "end": "479440"
  },
  {
    "text": "system is ought to behave and deploy it and reactivate problems that's a bit more like it that's",
    "start": "479440",
    "end": "485280"
  },
  {
    "text": "that's our operations guide we have pages of documentation from the xcd project telling us how to",
    "start": "485280",
    "end": "490560"
  },
  {
    "text": "run this thing and we want to do that so why don't we encode it that's what the operator really does",
    "start": "490560",
    "end": "496800"
  },
  {
    "text": "here it encodes operational knowledge of an existing application and this is just one use case for",
    "start": "496800",
    "end": "503360"
  },
  {
    "text": "running an operator people use these things to build completely cloud native applications this is",
    "start": "503360",
    "end": "508800"
  },
  {
    "text": "slightly different this is taking an application that was never designed to run in an orchestration system it was never meant to win in kubernetes",
    "start": "508800",
    "end": "515279"
  },
  {
    "text": "and making it work with the kubernetes system so operators again i won't kind of draw",
    "start": "515279",
    "end": "521200"
  },
  {
    "text": "on this terribly much um but the project has become pretty popular other concepts have become pretty",
    "start": "521200",
    "end": "527200"
  },
  {
    "text": "popular there are a bunch of them out there uh operator hub has been mentioned by some we've listed hundreds of these things",
    "start": "527200",
    "end": "533200"
  },
  {
    "text": "um cert manager made by jetsac is one for tls certificate strimzy is another good example that's",
    "start": "533200",
    "end": "538320"
  },
  {
    "text": "actually written in java that one is uh for apache kafka there are a whole bunch of these things out there",
    "start": "538320",
    "end": "545120"
  },
  {
    "text": "that are used to run complex applications in kubernetes in fact and one interesting tidbit is",
    "start": "545120",
    "end": "552000"
  },
  {
    "text": "when the operator concept was first introduced back in november 2016 in the blog post by core os",
    "start": "552000",
    "end": "558880"
  },
  {
    "text": "they actually use xcd as the canonical example of why you might need an operator which of course begs the question of if",
    "start": "558880",
    "end": "565120"
  },
  {
    "text": "there's already an xd operator why are we building one the reality is that we looked at it and it didn't quite meet our production use",
    "start": "565120",
    "end": "571120"
  },
  {
    "text": "case we've been probable we decided the changes we need to do were too big so we decided to to write",
    "start": "571120",
    "end": "576240"
  },
  {
    "text": "something slightly different slightly different focus for us but it's very interesting that kind of going",
    "start": "576240",
    "end": "582000"
  },
  {
    "text": "going back to this use case again so how do you actually construct one of",
    "start": "582000",
    "end": "588720"
  },
  {
    "text": "these things we know we want one but how do you actually make one so the core thing that makes this",
    "start": "588720",
    "end": "594640"
  },
  {
    "text": "possible is the customer resource definition this is something part of kubernetes that lets you tell humanity that there",
    "start": "594640",
    "end": "601040"
  },
  {
    "text": "is a new thing it knows about you can specify the shape of it you can specify a spec",
    "start": "601040",
    "end": "606320"
  },
  {
    "text": "you can have it do basic validation this is the thing that really enables this",
    "start": "606320",
    "end": "611440"
  },
  {
    "text": "and this is once you specify a custom resource definition and load it into your cluster",
    "start": "611440",
    "end": "617360"
  },
  {
    "text": "it works just like a native resource you can ask in this case qctl to list the api resources available",
    "start": "617360",
    "end": "623440"
  },
  {
    "text": "and as well as the things that are built in like deployments and replicas and pods is listed by scd cluster resource it",
    "start": "623440",
    "end": "629360"
  },
  {
    "text": "knows about it and this means all the tooling knows about it too so qctl works perfectly well with it if",
    "start": "629360",
    "end": "635279"
  },
  {
    "text": "you're using gke or something like that their web console knows about it if you're using one of the visual systems for",
    "start": "635279",
    "end": "642720"
  },
  {
    "text": "interacting with lcd not as kubernetes like uh vmware's octant that will also",
    "start": "642720",
    "end": "648160"
  },
  {
    "text": "show it to you just alongside everything else so all your existing tooling git ops even things like opa gatekeeper",
    "start": "648160",
    "end": "654399"
  },
  {
    "text": "if you're using something like that to enforce policy will work with these tools that's pretty good so now that we've",
    "start": "654399",
    "end": "663360"
  },
  {
    "text": "defined this how do we actually build the operator do anything and just like everything else in",
    "start": "663360",
    "end": "669120"
  },
  {
    "text": "kubernetes it's just a pod running in kubernetes that pod right there is our operator we",
    "start": "669120",
    "end": "674800"
  },
  {
    "text": "put it in its own namespace we've got a deployment there to make sure it comes up and we give it a service account i mentioned",
    "start": "674800",
    "end": "682240"
  },
  {
    "text": "the service account because it's particularly important it's what gives it the ability to do everything it needs to do",
    "start": "682240",
    "end": "687680"
  },
  {
    "text": "so if you look at what's in there we have permissions to look at xcd cluster resources and we",
    "start": "687680",
    "end": "694160"
  },
  {
    "text": "have permissions to make the things we need in response replica set services whatever we need and in particular there's watch right",
    "start": "694160",
    "end": "700959"
  },
  {
    "text": "there this is a great feature with operators is instead of having to sit there and pull kubernetes asking it",
    "start": "700959",
    "end": "707200"
  },
  {
    "text": "what's there what do they need to do it can get notified when things change as there's right really efficient",
    "start": "707200",
    "end": "712800"
  },
  {
    "text": "caching cachable code that will will you create an sd cluster and the operator will be woken up by",
    "start": "712800",
    "end": "718639"
  },
  {
    "text": "kubernetes and ask to do things so what's in that pod",
    "start": "718639",
    "end": "725839"
  },
  {
    "text": "what is the operator actually implemented in again it's a miracle of containers it can be anything you could write an operator using a bash script",
    "start": "725839",
    "end": "732079"
  },
  {
    "text": "and curl if you wanted to wouldn't necessarily recommend it but you could for our team and this is where i start",
    "start": "732079",
    "end": "738000"
  },
  {
    "text": "talking about the exact specifics of our project we chose to do this in go this is for",
    "start": "738000",
    "end": "743440"
  },
  {
    "text": "two reasons firstly go has a lot of really good ecosystem tools for building these",
    "start": "743440",
    "end": "748720"
  },
  {
    "text": "things go is what kubernetes itself is written in so it's natural there'll be a lot of support for it the",
    "start": "748720",
    "end": "754800"
  },
  {
    "text": "other and probably the biggest reason is really about our team the team of people who worked on this which is a",
    "start": "754800",
    "end": "760320"
  },
  {
    "text": "bunch of us a jet stack a bunch of us improbable we all knew go we were all familiar with it we're all happy with it so it worked",
    "start": "760320",
    "end": "765600"
  },
  {
    "text": "for us but had that not been the case if we were working with a company that liked java i would have had no problem",
    "start": "765600",
    "end": "771519"
  },
  {
    "text": "writing this thing in java it's pretty much you can use whatever you want there are lots of examples out there there's operators built in java in",
    "start": "771519",
    "end": "778240"
  },
  {
    "text": "rust whatever you need so the other thing we did and this is what i was talking about with go",
    "start": "778240",
    "end": "784839"
  },
  {
    "text": "ecosystem was cube builder so this is a project",
    "start": "784839",
    "end": "789920"
  },
  {
    "text": "that can help you scaffold out and create a load of resources and manage these things in go projects so this isn't the only thing",
    "start": "789920",
    "end": "796800"
  },
  {
    "text": "like this there are a bunch of them out there um the operator sdk by core os and now red hat uh is another",
    "start": "796800",
    "end": "803920"
  },
  {
    "text": "operator framework which the opposite sdks one part is another very good example and other languages have other examples",
    "start": "803920",
    "end": "810959"
  },
  {
    "text": "as well of things that really help you do all the things you need to do manage your crds",
    "start": "810959",
    "end": "816480"
  },
  {
    "text": "manage your versioning all this sort of sort of stuff we chose to use cube builder largely",
    "start": "816480",
    "end": "823519"
  },
  {
    "text": "because we really really like the documentation that he build a book goes into a lot of detail",
    "start": "823519",
    "end": "828639"
  },
  {
    "text": "about the why of how you want to do things it's quite opinionated and that's something that we liked what",
    "start": "828639",
    "end": "833680"
  },
  {
    "text": "we agreed with is opinions so we moved in that way we also found a testing story it's really good and testing is something i'm",
    "start": "833680",
    "end": "839440"
  },
  {
    "text": "going to cover right at the end to talk about how we actually tested this so we decided",
    "start": "839440",
    "end": "847519"
  },
  {
    "text": "that we are going to make it we're going to we're going to build this thing and make no mistake this is an engineering",
    "start": "847519",
    "end": "853199"
  },
  {
    "text": "effort it took a few as a few months to build this was mostly working full-time and it's not a small",
    "start": "853199",
    "end": "858240"
  },
  {
    "text": "project that you do in one week it's something you actually have to build and maintain as any other software project",
    "start": "858240",
    "end": "864240"
  },
  {
    "text": "so now that we're building and we decided we're going to do it we know how we're going to do it what are we actually going to make it do",
    "start": "864240",
    "end": "870560"
  },
  {
    "text": "so the core of any operator is this reconcile loop and this is if you watch any talk",
    "start": "870560",
    "end": "875839"
  },
  {
    "text": "on operators i'll be talking about this loop this is how kubernetes itself works internally where the first thing",
    "start": "875839",
    "end": "882240"
  },
  {
    "text": "the operator in this pod will do is it will ask the api server about these xd clusters or got woken up",
    "start": "882240",
    "end": "888560"
  },
  {
    "text": "by them when it changes and it will from that you will get the desired state of the world you have told it",
    "start": "888560",
    "end": "894560"
  },
  {
    "text": "that you want an sd cluster you want three replicas you want this version and then based on that it will go and",
    "start": "894560",
    "end": "901279"
  },
  {
    "text": "make that happen it will make the underlying resources it will do the things it needs to do to make that in reality based on what's",
    "start": "901279",
    "end": "907040"
  },
  {
    "text": "already there this is the core loop and the idea is that if you change your definition",
    "start": "907040",
    "end": "912720"
  },
  {
    "text": "then it will update accordingly if you fiddle with some of those things on the side it will correct them for you you put",
    "start": "912720",
    "end": "918560"
  },
  {
    "text": "them back in the desired state it is always moving the world towards the state as you told it you wanted it",
    "start": "918560",
    "end": "926000"
  },
  {
    "text": "so this is how pretty much every operator works ours was actually fractionally different",
    "start": "926000",
    "end": "932399"
  },
  {
    "text": "and it all goes back to that xcd internal state thing i mentioned right at the beginning we need to tell xcd about things xcd has",
    "start": "932399",
    "end": "939680"
  },
  {
    "text": "its own view of what the world should look like and what things need to be there and what peers it needs to know about so",
    "start": "939680",
    "end": "946639"
  },
  {
    "text": "we built this into our design we actually kind of have an almost double loop the first thing we do",
    "start": "946639",
    "end": "951920"
  },
  {
    "text": "is we take our desired state and then we go talk to the std cluster that we're managing it and make sure that it's in line with",
    "start": "951920",
    "end": "957920"
  },
  {
    "text": "what we want to have if if we need to add a new peer the first thing we'll do is tell xcd about",
    "start": "957920",
    "end": "962959"
  },
  {
    "text": "it and once we've done that we can go and we can take what xcd expects of the",
    "start": "962959",
    "end": "968399"
  },
  {
    "text": "world and then implement that so that means that xcd is always the first to know it means that we are moving with its",
    "start": "968399",
    "end": "974399"
  },
  {
    "text": "expectations we are implementing what the operations guy told us to do",
    "start": "974399",
    "end": "979759"
  },
  {
    "text": "in order to help with this uh we actually split that logic out we actually built two",
    "start": "980079",
    "end": "985440"
  },
  {
    "text": "crds so we actually built one for cluster and one for a peer this is largely",
    "start": "985440",
    "end": "990560"
  },
  {
    "text": "a code clarity thing it means that we have two different code paths one for managing clusters which then",
    "start": "990560",
    "end": "996800"
  },
  {
    "text": "create the peers and then one for managing the peers but it also means that this is exposed in their api as an administrator",
    "start": "996800",
    "end": "1002560"
  },
  {
    "text": "if you want to know what's really going on you can ask the api well what api peers well std peers exist",
    "start": "1002560",
    "end": "1007600"
  },
  {
    "text": "and it can tell you it means that when we expose status of individual peers you can use cube ctl to describe appear",
    "start": "1007600",
    "end": "1014000"
  },
  {
    "text": "and you can get its status information right there in the api just for you so this helps us leverage that first thing in",
    "start": "1014000",
    "end": "1020560"
  },
  {
    "text": "the first quote i got from the documentation of extending the api to help an administrator",
    "start": "1020560",
    "end": "1025678"
  },
  {
    "text": "run this thing so that means that the actual reconciliation loop for",
    "start": "1025679",
    "end": "1031839"
  },
  {
    "text": "us looks more like this we we view a desired cluster we talk to xcd",
    "start": "1031839",
    "end": "1037360"
  },
  {
    "text": "we create the peers and the service because the service is pair cluster not paired pier then we respond to the",
    "start": "1037360",
    "end": "1043120"
  },
  {
    "text": "peer existing and go through this a second loop and then we create the replica sets persistent volume claims",
    "start": "1043120",
    "end": "1048720"
  },
  {
    "text": "things like this so it's a slightly different take on it but that core reconciler observed state",
    "start": "1048720",
    "end": "1054640"
  },
  {
    "text": "actual state loop is still there so some design considerations and these",
    "start": "1054640",
    "end": "1059760"
  },
  {
    "text": "are things that we thought about at the start based on other experiences with operators based on my colleagues",
    "start": "1059760",
    "end": "1064880"
  },
  {
    "text": "experience with cert manager things like this things we really wanted to make sure we get right at the start these these are",
    "start": "1064880",
    "end": "1070000"
  },
  {
    "text": "things that worked for us these are not hard and fast rules this is just our experience so the first thing was to be level",
    "start": "1070000",
    "end": "1076400"
  },
  {
    "text": "triggered so this is a piece of terminology that has been co-opted from people working",
    "start": "1076400",
    "end": "1082799"
  },
  {
    "text": "on low-level embedded kind of signal systems with voltages and things at that level this is the idea",
    "start": "1082799",
    "end": "1090080"
  },
  {
    "text": "that you should be level triggered not edge triggered and i'm not going to explain exactly",
    "start": "1090080",
    "end": "1095520"
  },
  {
    "text": "what this means for signal processing but for us it means that you shouldn't react to changes in state you should react to",
    "start": "1095520",
    "end": "1101200"
  },
  {
    "text": "the state itself so if you scale your cluster up from three to five you shouldn't",
    "start": "1101200",
    "end": "1108080"
  },
  {
    "text": "interpret that as add two you should interpret that as i want five i have two and that seems like a really subtle distinction that seems like i've",
    "start": "1108080",
    "end": "1114400"
  },
  {
    "text": "just said the same thing twice but it's important in certain failure conditions it's important",
    "start": "1114400",
    "end": "1120799"
  },
  {
    "text": "if you lose connectivity if your operator pod gets restarted when it comes back it may have missed",
    "start": "1120799",
    "end": "1126000"
  },
  {
    "text": "that scale up event it might not have known that this happened so instead it just has to look without being told",
    "start": "1126000",
    "end": "1132640"
  },
  {
    "text": "to look it has to notice that this thing is wrong and do it and that means look at states",
    "start": "1132640",
    "end": "1138400"
  },
  {
    "text": "not look at the change in that state the other thing is to do one thing at a",
    "start": "1138400",
    "end": "1143520"
  },
  {
    "text": "time our operator reconcile loop starts by",
    "start": "1143520",
    "end": "1149919"
  },
  {
    "text": "deciding what to do does one thing in the nexus and then next time around when it gets invoked again which is",
    "start": "1149919",
    "end": "1155600"
  },
  {
    "text": "usually immediately you will do the next thing this seems weird when you first do it you think well i know i need to make",
    "start": "1155600",
    "end": "1161200"
  },
  {
    "text": "three things why am i doing this three times to make my three things why do i just make them",
    "start": "1161200",
    "end": "1167039"
  },
  {
    "text": "the answer is that it makes it more resilient this way it makes it easier to understand what the code is doing it makes it easier to test makes",
    "start": "1167039",
    "end": "1173200"
  },
  {
    "text": "it easier to debug and it means that if you then go and change one of those things",
    "start": "1173200",
    "end": "1178240"
  },
  {
    "text": "and it re-reconciles it no it will only do the one thing it needs to do if you group these changes together into",
    "start": "1178240",
    "end": "1184640"
  },
  {
    "text": "larger changes then you might miss things if you're in a partial state which can help you in certain failure conditions",
    "start": "1184640",
    "end": "1190320"
  },
  {
    "text": "so again it's not something you'll notice necessarily but when you need it you'll know",
    "start": "1190320",
    "end": "1196799"
  },
  {
    "text": "and the other thing is caching behavior so another one of the things that a load of the go logic and keybuilder",
    "start": "1196880",
    "end": "1202559"
  },
  {
    "text": "gives you is it'll cache things you pull information from the from the",
    "start": "1202559",
    "end": "1207600"
  },
  {
    "text": "api about what replica sets are already there because you need to make one well your cache might be out of date you might get lied to you might ask it",
    "start": "1207600",
    "end": "1213760"
  },
  {
    "text": "do i have a replica set and the answer will be no and you'll go to create it and you'll get an error telling you all that exists",
    "start": "1213760",
    "end": "1218799"
  },
  {
    "text": "this can happen but this isn't necessarily something to be afraid of it just means that you have to make sure",
    "start": "1218799",
    "end": "1224720"
  },
  {
    "text": "that all of your operations are reproducible means when you create names for things they have to be deterministic",
    "start": "1224720",
    "end": "1230159"
  },
  {
    "text": "it means you have to accept that sometimes you might just try to create something and it's already there because you've already did it last time that's",
    "start": "1230159",
    "end": "1235440"
  },
  {
    "text": "okay just wait do it again and then then eventually your cash will update",
    "start": "1235440",
    "end": "1241919"
  },
  {
    "text": "and they don't have to worry about it just make sure that you're not gonna the canonical example where this could be a problem is if",
    "start": "1241919",
    "end": "1247919"
  },
  {
    "text": "you're making randomized names for peers by the time your caches are data you could have created five of them and then",
    "start": "1247919",
    "end": "1253200"
  },
  {
    "text": "you have to notice that you've created five and scale it back down again it's much easier just to have a deterministic name try to",
    "start": "1253200",
    "end": "1258640"
  },
  {
    "text": "create a second time fail and then wait up there your cache so let's actually talk through how this",
    "start": "1258640",
    "end": "1265520"
  },
  {
    "text": "solves our problem our xcd problem is going back to our icd example so you want to deploy it you can create",
    "start": "1265520",
    "end": "1271520"
  },
  {
    "text": "a resource like this this is a really minimal example you can specify more things in this spec you can specify",
    "start": "1271520",
    "end": "1277679"
  },
  {
    "text": "storage information you can specify the version of lcd you want things like this in this simple example i just said i",
    "start": "1277679",
    "end": "1284159"
  },
  {
    "text": "want three of them i've left the operator to default the rest so this is what we get we get a cluster",
    "start": "1284159",
    "end": "1291360"
  },
  {
    "text": "resource that someone just created we make a service which is going to give network identity to all of our",
    "start": "1291360",
    "end": "1296559"
  },
  {
    "text": "all of our icds and then we create three peer resources so those of you who remember my original",
    "start": "1296559",
    "end": "1303120"
  },
  {
    "text": "diagram like wondering how we just did this because the first thing we do is we talk to xcd but scd isn't there yet we haven't made it",
    "start": "1303120",
    "end": "1310240"
  },
  {
    "text": "so how can we do this we already have this state we just tried to dial rcd and there's nothing because we haven't made it",
    "start": "1310240",
    "end": "1316240"
  },
  {
    "text": "so for this particular case we have a bootstrap mode if the operator sees that there is a",
    "start": "1316240",
    "end": "1321440"
  },
  {
    "text": "cluster desiring peers and it hasn't made the peers yet or you can't find the peers and it can't contact ncd then it assumes",
    "start": "1321440",
    "end": "1328240"
  },
  {
    "text": "it's bootstrapping assumes it needs to add more peers and it will speculatively create them and add those peers",
    "start": "1328240",
    "end": "1334320"
  },
  {
    "text": "so this can go wrong if you have a network outage your operator pod might not be able to talk to a cd even if it's already there",
    "start": "1334320",
    "end": "1340080"
  },
  {
    "text": "this can fail but that's okay because the operator will recover if you accidentally create too many pods",
    "start": "1340080",
    "end": "1346720"
  },
  {
    "text": "eventually this network fault theoretical network vault will heal you'll talk to xcd again and you'll see",
    "start": "1346720",
    "end": "1352240"
  },
  {
    "text": "that ncd is confused because it has a bunch of things trying to talk to it it doesn't know that they're there doesn't expect them at which point the",
    "start": "1352240",
    "end": "1358640"
  },
  {
    "text": "operator will reconcile the state of the world with xcd's expectation again and get rid of them",
    "start": "1358640",
    "end": "1364320"
  },
  {
    "text": "so this will eventually heal which is why we're comfortable having this bootstrap mode and the other thing to bear in mind is",
    "start": "1364320",
    "end": "1370480"
  },
  {
    "text": "we never delete things in bootstrap mode we only ever add peers which means we can't delete data by accident",
    "start": "1370480",
    "end": "1376320"
  },
  {
    "text": "you cannot scale this down and then accidentally drop all your pods because they thought they needed to so",
    "start": "1376320",
    "end": "1383440"
  },
  {
    "text": "these peer resources look a bit like this again it's pretty simple um the two",
    "start": "1383440",
    "end": "1389520"
  },
  {
    "text": "things to be aware of is the initial cluster state there that's actually something that can be either new or existing and",
    "start": "1389520",
    "end": "1395679"
  },
  {
    "text": "this is what scd wants there's a configuration flag that you give to xcd to tell it whether it should",
    "start": "1395679",
    "end": "1401120"
  },
  {
    "text": "try to bootstrap a cluster or whether it should join an existing one so we're really just again fulfilling what the operations guide",
    "start": "1401120",
    "end": "1407360"
  },
  {
    "text": "told us to do this is what it shed used to provide we also need to tell it the other nodes",
    "start": "1407360",
    "end": "1412880"
  },
  {
    "text": "that appears in this cluster so here we've actually done something a little bit interesting and we've predicted what its names are",
    "start": "1412880",
    "end": "1419440"
  },
  {
    "text": "going to be because we haven't made any of these things yet this is the point where we've created the sap resources the underlying pods",
    "start": "1419440",
    "end": "1425039"
  },
  {
    "text": "and replicates everything else don't exist so we're predicting based on the service that we've already created",
    "start": "1425039",
    "end": "1430640"
  },
  {
    "text": "what its dns name is going to end up being um this is achieved by something called",
    "start": "1430640",
    "end": "1437120"
  },
  {
    "text": "the hostname field on a pod if you set that it will get a dns name regardless of its name and i should be talking about that a",
    "start": "1437120",
    "end": "1442960"
  },
  {
    "text": "little bit more a little bit later but that's how we do that so",
    "start": "1442960",
    "end": "1448960"
  },
  {
    "text": "what does the peer create well we make a replica set and we get the pod with this hostname set because we set it on the pod",
    "start": "1448960",
    "end": "1454960"
  },
  {
    "text": "template on the cassette we create a pvc the reason we're using a replica set and to be to clarify that's",
    "start": "1454960",
    "end": "1460799"
  },
  {
    "text": "one replica set pair pier not a replica set for all of the individual seds",
    "start": "1460799",
    "end": "1466080"
  },
  {
    "text": "the reason we're doing that is because we had a concerns about",
    "start": "1466080",
    "end": "1471440"
  },
  {
    "text": "hay constraints in production we didn't want our operator that was directly managing pods to have to be alive",
    "start": "1471440",
    "end": "1478320"
  },
  {
    "text": "in order to bring a cluster back up in a failure condition so instead we use a replica set our",
    "start": "1478320",
    "end": "1483919"
  },
  {
    "text": "operator doesn't even have to be running and the cluster will heal itself because kubernetes will restart the pod for it",
    "start": "1483919",
    "end": "1489360"
  },
  {
    "text": "because we use a set to hold it too told it too um you don't have to do this you can",
    "start": "1489360",
    "end": "1495279"
  },
  {
    "text": "directly address pods if you want this was kind of a take it or leave it decision for us um",
    "start": "1495279",
    "end": "1500960"
  },
  {
    "text": "but it is one thing we did slightly differently it means and take away is that you can use these higher order kubernetes things",
    "start": "1500960",
    "end": "1508000"
  },
  {
    "text": "with your operator you don't just have to go all the way down to start managing pods and things like this um i've drawn the line to a pvc slightly",
    "start": "1508000",
    "end": "1514960"
  },
  {
    "text": "differently um that's because we don't set an owner reference normally with kubernetes",
    "start": "1514960",
    "end": "1520400"
  },
  {
    "text": "resources you can tell that one resource is the owner of the other when you delete the parent it will delete the",
    "start": "1520400",
    "end": "1526000"
  },
  {
    "text": "children too we wanted to avoid the case where if you accidentally or someone maliciously",
    "start": "1526000",
    "end": "1531039"
  },
  {
    "text": "did a qctl delete sd cluster my cluster or my icd it will delete everything we didn't want",
    "start": "1531039",
    "end": "1536320"
  },
  {
    "text": "to drop the data this means that if you do that the pvcs will be left behind your data",
    "start": "1536320",
    "end": "1541600"
  },
  {
    "text": "will still be there and you can recover from doing that so now that we've got all of this where",
    "start": "1541600",
    "end": "1548720"
  },
  {
    "text": "does it deploy well if you just deployed that yaml i showed you you'll get this",
    "start": "1548720",
    "end": "1554720"
  },
  {
    "text": "you would get three pods running an xcd each with host names like that with a pvc each and a pv each and that's",
    "start": "1554720",
    "end": "1561440"
  },
  {
    "text": "its internal view of what the world is and this is pretty much exactly what that's like on-prem traditional vm",
    "start": "1561440",
    "end": "1568880"
  },
  {
    "text": "slide i had at the beginning it looked like just with pod written around it rather than the machine so that's pretty good",
    "start": "1568880",
    "end": "1576080"
  },
  {
    "text": "so let's go to the things that were difficult before what was hard so scale up was",
    "start": "1576080",
    "end": "1582559"
  },
  {
    "text": "awkward we could have done it but it was awkward how do we do it now well we edit our resource we tell it that",
    "start": "1582559",
    "end": "1588159"
  },
  {
    "text": "instead of wanting three of these things we want five of these things and this could just be a few qtl edits um this could be through some github's",
    "start": "1588159",
    "end": "1594480"
  },
  {
    "text": "pipeline redeploying it cause you've changed it um through qbc they'll apply",
    "start": "1594480",
    "end": "1600480"
  },
  {
    "text": "but we also implement the scale sub resource so you can actually just use tooling that understands concept of",
    "start": "1600480",
    "end": "1606240"
  },
  {
    "text": "scaling to scale these things you're going to say oh um qcl scale i want five of them now and it",
    "start": "1606240",
    "end": "1611279"
  },
  {
    "text": "will understand that it will work in exactly the same way so first thing we do we reconcile to xcd",
    "start": "1611279",
    "end": "1617760"
  },
  {
    "text": "we can contact xcd we're not in bootstrap mode we go to it we tell it we're going to create a new peer and again we've predicted its name we",
    "start": "1617760",
    "end": "1624400"
  },
  {
    "text": "know we're going to call it dash 3 because that's a next ordinal number it's a deterministic name",
    "start": "1624400",
    "end": "1630640"
  },
  {
    "text": "so we tell it this is going to come into existence we create a new peer resource because",
    "start": "1630640",
    "end": "1636640"
  },
  {
    "text": "now we reconcile xd against the world and ncd expects a mixed d3 and there isn't one so we make one for",
    "start": "1636640",
    "end": "1642799"
  },
  {
    "text": "it and this now looks like this this time the only real difference is that initial",
    "start": "1642799",
    "end": "1648399"
  },
  {
    "text": "cluster state is now existing we know this because we populate it from xcd we know we can talk to xd at the",
    "start": "1648399",
    "end": "1653600"
  },
  {
    "text": "time so the operator knows this must be an existing cluster and we just give it the names of all the other",
    "start": "1653600",
    "end": "1659120"
  },
  {
    "text": "peers so we can talk to them and find out and bootstrap with them and so you end up if you draw everything",
    "start": "1659120",
    "end": "1664480"
  },
  {
    "text": "on one slide just you get this you get our namespace with our cluster resources and our peer",
    "start": "1664480",
    "end": "1669520"
  },
  {
    "text": "resources and all of our nodes and replica sets and pvcs and everything else we need and then of course it would go on and it",
    "start": "1669520",
    "end": "1675360"
  },
  {
    "text": "would do the fifth one which i couldn't film the slide so what about scale down this was this",
    "start": "1675360",
    "end": "1681919"
  },
  {
    "text": "is a big problem before this was really painful like how do we do this well again we just if we go back to our",
    "start": "1681919",
    "end": "1687520"
  },
  {
    "text": "three three node case and we say let's get it down to one we go to xcd we tell it when we remove",
    "start": "1687520",
    "end": "1693520"
  },
  {
    "text": "one then we go to remove it but there's a problem",
    "start": "1693520",
    "end": "1699360"
  },
  {
    "text": "we don't delete the pvc right if you just delete the resource we'll clean up the replicasets and the pods but the pvc we don't set its owner",
    "start": "1699360",
    "end": "1705840"
  },
  {
    "text": "reference so we're not going to get rid of it and this is an issue because if you scale down and then scale",
    "start": "1705840",
    "end": "1711360"
  },
  {
    "text": "up again because the pvc is deterministically named you'll use the same pvc which means that",
    "start": "1711360",
    "end": "1716399"
  },
  {
    "text": "you could have a scale down and a few weeks or months later scale back on the same cluster pick up stale",
    "start": "1716399",
    "end": "1721679"
  },
  {
    "text": "data property of xcd is that if you already have a data directory it ignores bootstrap instructions so even worse",
    "start": "1721679",
    "end": "1728559"
  },
  {
    "text": "this like new lcd you've created will be completely stale so we take care of this this case in",
    "start": "1728559",
    "end": "1735279"
  },
  {
    "text": "particular in response to a scale down when the operator has intentionally decided to scale something down as",
    "start": "1735279",
    "end": "1740720"
  },
  {
    "text": "distinct from just deleting the resource it will go and before it deletes it it will attach a finalizer",
    "start": "1740720",
    "end": "1747120"
  },
  {
    "text": "so this is a hook you can attach to any resource in etsy in kubernetes to tell it to do",
    "start": "1747120",
    "end": "1753600"
  },
  {
    "text": "something before it gets deleted then we delete it then kubernetes calls back into us",
    "start": "1753600",
    "end": "1759360"
  },
  {
    "text": "to ask us to do the thing that we said we're gonna do in which case we delete the pvc clean it up and then we'll get rid of it",
    "start": "1759360",
    "end": "1765679"
  },
  {
    "text": "and then we'll get rid of number one as well and then we'll be down to our desired state of having only one replica",
    "start": "1765679",
    "end": "1771440"
  },
  {
    "text": "so i've covered those features mostly sort of give worked examples but this operator does a whole bunch of other",
    "start": "1771440",
    "end": "1776559"
  },
  {
    "text": "stuff too we have version upgrade you can specify a version in a spec and it will do a rolling upgrade you can",
    "start": "1776559",
    "end": "1781600"
  },
  {
    "text": "do backup you can tell it to back up your cluster while it's running into a cloud bucket",
    "start": "1781600",
    "end": "1786799"
  },
  {
    "text": "you can do restore you can you can't do a restore in place but you can you need to create a new",
    "start": "1786799",
    "end": "1792240"
  },
  {
    "text": "cluster again following the operations guide so you create a restore resource and",
    "start": "1792240",
    "end": "1797360"
  },
  {
    "text": "then it will go and it will pre-populate the pvcs for you and it will create an sd cluster on top of it to make sure it",
    "start": "1797360",
    "end": "1802480"
  },
  {
    "text": "comes up correctly and these are all just implementing what xcd told us to do in their documentation",
    "start": "1802480",
    "end": "1809760"
  },
  {
    "text": "so the last thing i really wanted to touch on was testing i mentioned it earlier and i talked about queue builder",
    "start": "1809760",
    "end": "1815679"
  },
  {
    "text": "and what its testing story was like so it looks kind of like this we have i'll",
    "start": "1815679",
    "end": "1822159"
  },
  {
    "text": "go go for a bite plane over there which is our go go process on your laptop or on your ci",
    "start": "1822159",
    "end": "1828320"
  },
  {
    "text": "node and that was a big driving factor for us we wanted all these tests to run on a laptop as well as in ci we didn't",
    "start": "1828320",
    "end": "1835279"
  },
  {
    "text": "want to be we tied into needing a gcp cluster a gta cluster or something like that in order to run our tests",
    "start": "1835279",
    "end": "1842080"
  },
  {
    "text": "so what cube builders default test harness does is it will stand up the api it'll stand",
    "start": "1842080",
    "end": "1849520"
  },
  {
    "text": "up ironically in xcd in order to back that api this is not the xcd on the test",
    "start": "1849520",
    "end": "1854720"
  },
  {
    "text": "this is just an sd to back the api server and it just downloads the binaries these",
    "start": "1854720",
    "end": "1860080"
  },
  {
    "text": "things and runs it there's no pods there's no docker there's no container runtime there's no nothing so you don't get to actually run",
    "start": "1860080",
    "end": "1866399"
  },
  {
    "text": "things you can create resources and you can watch them and listen to them and do all these kind of things",
    "start": "1866399",
    "end": "1871679"
  },
  {
    "text": "so in that code our controller loop is running and it's and then we're",
    "start": "1871679",
    "end": "1877840"
  },
  {
    "text": "going to test i'm going to go oh we're going to create an sd peer and we can see that we're trying to or we go",
    "start": "1877840",
    "end": "1883519"
  },
  {
    "text": "into entertainment api in response and we created a replica we created the pvc",
    "start": "1883519",
    "end": "1888720"
  },
  {
    "text": "we can assert on its properties we can assert that we made it we can test what happens if we start deleting stuff or changing things and how it responds",
    "start": "1888720",
    "end": "1895600"
  },
  {
    "text": "but of course part of our reconciliation logic is we go out to hcd so we end up just mocking that",
    "start": "1895600",
    "end": "1902399"
  },
  {
    "text": "we have a little mock stub for the xcd so we can tell we can pretend the lcd is behaving or pretend the xcd is not behaving that you",
    "start": "1902399",
    "end": "1909120"
  },
  {
    "text": "can't contact in order to trigger that bootstrap mode or non-bootstrap mode it'll discover that behavior",
    "start": "1909120",
    "end": "1914559"
  },
  {
    "text": "and this is great these are like just a little bit heavier than unit tests for not quite as",
    "start": "1914559",
    "end": "1919840"
  },
  {
    "text": "fast because it has to actually launch the api server in the fcd binary so those things are pretty efficient so these don't take very long but",
    "start": "1919840",
    "end": "1927360"
  },
  {
    "text": "the kind of last piece of this is a real end-to-end test when you actually actually run this and actually",
    "start": "1927360",
    "end": "1933679"
  },
  {
    "text": "stand up fcd pods so for that you use kind um this is",
    "start": "1933679",
    "end": "1938960"
  },
  {
    "text": "another cncf kind of sig hosted project uh stands for kubernetes in docker you",
    "start": "1938960",
    "end": "1945519"
  },
  {
    "text": "could people can and have done entire talks on how this thing works and it's a really",
    "start": "1945519",
    "end": "1950559"
  },
  {
    "text": "interesting project and i recommend you check out the documentation but the really short version for our purposes",
    "start": "1950559",
    "end": "1956480"
  },
  {
    "text": "is just that it lets you stand up kubernetes on any host that has docker you don't",
    "start": "1956480",
    "end": "1961600"
  },
  {
    "text": "need anything beforehand these things are small they come within a few minutes and they're entirely reproducible so it's perfect for our testing so we",
    "start": "1961600",
    "end": "1968399"
  },
  {
    "text": "can run these on crnos we're going to use some laptops it's great so putting this all together and i warn",
    "start": "1968399",
    "end": "1974159"
  },
  {
    "text": "you this is like a disaster zone of a slide we have we have this this is everything",
    "start": "1974159",
    "end": "1979519"
  },
  {
    "text": "we do if you try to an end-to-end test using using this thing so the first thing we do is we create a",
    "start": "1979519",
    "end": "1985919"
  },
  {
    "text": "kind cluster and that stands up the control plane and everything else we need for a rocky mountains thing then",
    "start": "1985919",
    "end": "1991919"
  },
  {
    "text": "we go and we run docker build in order to build the images that actually have our operator inside of it",
    "start": "1991919",
    "end": "1998399"
  },
  {
    "text": "then we go and we load the operators as in load the image is in and deploy the operator and do",
    "start": "1998399",
    "end": "2004240"
  },
  {
    "text": "things like that in order to get our crd and everything else and then we can deploy an xcd cluster and we can watch it just step back and",
    "start": "2004240",
    "end": "2010000"
  },
  {
    "text": "just watch it bootstrap everything just in the way i described and then we can start poking it and we can start asserting on it and",
    "start": "2010000",
    "end": "2015919"
  },
  {
    "text": "this because this is actually running real real containers and actual pods it's actually running xcd and talking to it",
    "start": "2015919",
    "end": "2021760"
  },
  {
    "text": "and verifying that our communication to xd is working as we expect verifying that our",
    "start": "2021760",
    "end": "2027200"
  },
  {
    "text": "reconciled loop is doing the correct thing in the correct cases we can go in and start blowing things up and removing things to make sure it works",
    "start": "2027200",
    "end": "2033279"
  },
  {
    "text": "so this is how we handle that end-to-end testing part of building this thing to make sure",
    "start": "2033279",
    "end": "2038559"
  },
  {
    "text": "it does actually work so what do we learn from doing all of",
    "start": "2038559",
    "end": "2044000"
  },
  {
    "text": "this what are our kind of key takeaways i suppose from this process trying to implement this operator",
    "start": "2044000",
    "end": "2051440"
  },
  {
    "text": "they provide value for applications of complex run books this was complicated the operations guide is quite long",
    "start": "2052000",
    "end": "2059118"
  },
  {
    "text": "that meant there was value in writing this code to implement that for us we",
    "start": "2059119",
    "end": "2066480"
  },
  {
    "text": "learned that we can work with existing tooling if you're using gitops to deploy a bunch",
    "start": "2066480",
    "end": "2072079"
  },
  {
    "text": "of yaml files or a helm chart will still work with this if you're using uh gatekeepers i think i mentioned",
    "start": "2072079",
    "end": "2078158"
  },
  {
    "text": "before to enforce security policy on these things it will work with this it will work with those crds",
    "start": "2078159",
    "end": "2085440"
  },
  {
    "text": "we learned that you can use any stack but go worked for us this was a result of our team our experience what we were comfortable",
    "start": "2085839",
    "end": "2091760"
  },
  {
    "text": "with what we wanted to do but if you're a java company you could",
    "start": "2091760",
    "end": "2097200"
  },
  {
    "text": "write this in java if you're all python you can write it in python you don't have to use go you",
    "start": "2097200",
    "end": "2102320"
  },
  {
    "text": "don't have to use those that tooling it's completely agnostic and we learned that you can enter and",
    "start": "2102320",
    "end": "2108079"
  },
  {
    "text": "test them with kind i can do this on my laptop my laptop isn't that powerful but you can still run it we do it in ci it's reproducible testing",
    "start": "2108079",
    "end": "2115440"
  },
  {
    "text": "between a local development environment and a remote one so",
    "start": "2115440",
    "end": "2120480"
  },
  {
    "text": "the operator itself is mit licensed it's available on github.link that's qr code adjust that link um i",
    "start": "2120480",
    "end": "2127520"
  },
  {
    "text": "think yeah i'm done any questions",
    "start": "2127520",
    "end": "2144240"
  },
  {
    "text": "i don't know how much time we have left before we actually have a bit of time oh okay if you don't mind sure",
    "start": "2144240",
    "end": "2152960"
  },
  {
    "text": "um it's just two very quick ones one i assume when you talk about scale that means",
    "start": "2152960",
    "end": "2158960"
  },
  {
    "text": "um it's really a property of mcd that",
    "start": "2164400",
    "end": "2169920"
  },
  {
    "text": "scaling you don't scale up to increase load because of the way ncd works you scale",
    "start": "2169920",
    "end": "2175200"
  },
  {
    "text": "to increase resiliency if you scale up actually your write performance will get",
    "start": "2175200",
    "end": "2180400"
  },
  {
    "text": "worse and your re-performance will get only fractionally better so you could but you probably if you",
    "start": "2180400",
    "end": "2186880"
  },
  {
    "text": "could auto scale on some like resilience dynamic resiliency metric you probably want to do that but yeah",
    "start": "2186880",
    "end": "2191920"
  },
  {
    "text": "but you could you completely could if you wanted to",
    "start": "2191920",
    "end": "2195838"
  },
  {
    "text": "thinking of different um how much does this depend upon introspection in that platform it sounds like you're talking to std and",
    "start": "2199040",
    "end": "2205760"
  },
  {
    "text": "kind of telling it about stuff that's happening um you know is does this whole kind of thing depend",
    "start": "2205760",
    "end": "2211760"
  },
  {
    "text": "upon that or do you recommend get",
    "start": "2211760",
    "end": "2215040"
  },
  {
    "text": "um we did it in this case because a lot of the problems we had doing this without it was just that",
    "start": "2218560",
    "end": "2224640"
  },
  {
    "text": "lcd's internal state would get confused and wouldn't match the world so that's where we would end on that path",
    "start": "2224640",
    "end": "2230480"
  },
  {
    "text": "if your database didn't do that and you had and it just kind of like would accept whatever its environment was or",
    "start": "2230480",
    "end": "2236160"
  },
  {
    "text": "dynamically figured out you probably don't need to uh it would depend on the use case but you could like most operators don't",
    "start": "2236160",
    "end": "2242720"
  },
  {
    "text": "really do this they don't need to so they don't bother so",
    "start": "2242720",
    "end": "2249119"
  },
  {
    "text": "um so i was quite interested in your concept of doing one unit of work per reconcile loop run through",
    "start": "2255680",
    "end": "2261200"
  },
  {
    "text": "so if you're adding five nodes you add one go on to the next records i'll look at another um could you go into a bit more",
    "start": "2261200",
    "end": "2266240"
  },
  {
    "text": "details about why you decided to go that way what the major benefits were versus the drawbacks because so for in our controller for",
    "start": "2266240",
    "end": "2272240"
  },
  {
    "text": "instance we don't do that we do you know unit of operation after your operation so it'd be quite interesting to see what you're thinking was in that",
    "start": "2272240",
    "end": "2278800"
  },
  {
    "text": "sure so um the kind of canonical example i i think i got this on my blog post but i'm",
    "start": "2278800",
    "end": "2283920"
  },
  {
    "text": "afraid i do not remember which one was talking about if you need to create",
    "start": "2283920",
    "end": "2288960"
  },
  {
    "text": "two things so say you need to create a service and a pod for example then you might have a piece",
    "start": "2288960",
    "end": "2295839"
  },
  {
    "text": "of logic that goes oh well if if service does not exist then create service and create pod",
    "start": "2295839",
    "end": "2301920"
  },
  {
    "text": "but of course if you delete the pods you'll never rerun this so it's it's you have to kind of figure",
    "start": "2301920",
    "end": "2309760"
  },
  {
    "text": "it out so i know this logic which is like oh if any of these things do not exist try to create all of them but of course many of them may already",
    "start": "2309760",
    "end": "2315760"
  },
  {
    "text": "exist and they have to handle that and it's yeah it just worked out to be a little bit",
    "start": "2315760",
    "end": "2320880"
  },
  {
    "text": "easier for that case and also you can ask typically what happens is you're going",
    "start": "2320880",
    "end": "2326320"
  },
  {
    "text": "to run multiple times anyway because when we create most of these resources we set owner references",
    "start": "2326320",
    "end": "2331839"
  },
  {
    "text": "so for example when the um when the cluster controller creates the",
    "start": "2331839",
    "end": "2340079"
  },
  {
    "text": "service um it sets itself as the owner and when anything changes in something",
    "start": "2340079",
    "end": "2345280"
  },
  {
    "text": "you own we get woken up again by that watch so what actually happens is we go and we",
    "start": "2345280",
    "end": "2350400"
  },
  {
    "text": "create a service and then as a result of that service being created we get invoked again which means we immediately get invoked",
    "start": "2350400",
    "end": "2356960"
  },
  {
    "text": "at which point we start doing the next thing whereas if you created 10 things you create your 10 things and then you'd run",
    "start": "2356960",
    "end": "2362000"
  },
  {
    "text": "10 more times as you you could have re-reconciled every time it's actually more efficient",
    "start": "2362000",
    "end": "2367040"
  },
  {
    "text": "most of most of these cases to actually just do it one by one and just let the let the the reconciled loop just rebound",
    "start": "2367040",
    "end": "2383839"
  },
  {
    "text": "how much effort does it took your team to create this operator you mentioned that it is like a big",
    "start": "2384160",
    "end": "2390560"
  },
  {
    "text": "project it's not like a small part but you didn't mention any scales um so i think the",
    "start": "2390560",
    "end": "2396240"
  },
  {
    "text": "team was probably about three or four people um not quite full-time i think about",
    "start": "2396240",
    "end": "2401680"
  },
  {
    "text": "eighty percent of the time for a few months i mean admittedly this was kind of over christmas and a lot of us are out for a long time so",
    "start": "2401680",
    "end": "2407839"
  },
  {
    "text": "nothing much happened then so i'd say in total it's probably a couple of a few people for a couple of months in",
    "start": "2407839",
    "end": "2413359"
  },
  {
    "text": "order to get it to this stage which we consider to be pretty stable so it's not",
    "start": "2413359",
    "end": "2418400"
  },
  {
    "text": "completely small we think it was a price worth paying for making the",
    "start": "2418400",
    "end": "2425440"
  },
  {
    "text": "operations side of things easier um but yeah it's definitely not something you could bang out in a week",
    "start": "2425440",
    "end": "2431119"
  },
  {
    "text": "i mean you could bang out a prototype away if the original prototype was uh written overnight in about three hours",
    "start": "2431119",
    "end": "2437280"
  },
  {
    "text": "by one guy but of course you know that just it's just a prototype it doesn't have documentation or testing or anything",
    "start": "2437280",
    "end": "2442400"
  },
  {
    "text": "like that so actually bring it to like a production-ready state too much longer as is true for most software projects",
    "start": "2442400",
    "end": "2452880"
  },
  {
    "text": "can i ask a question so i presume you wrote this because there wasn't",
    "start": "2452880",
    "end": "2458000"
  },
  {
    "text": "an operator already available and maybe it's worth sharing that there's",
    "start": "2458000",
    "end": "2463040"
  },
  {
    "text": "they said hundreds available um and would i mean this this cd one",
    "start": "2463040",
    "end": "2468240"
  },
  {
    "text": "that you that you built is that like is that available to people in this room yeah yeah um so i mean there was there",
    "start": "2468240",
    "end": "2475200"
  },
  {
    "text": "was an operator already available the coreos one is still out there um as i say it wasn't it didn't quite meet our use case which is",
    "start": "2475200",
    "end": "2481280"
  },
  {
    "text": "why we decided to go slightly different and the changes we we kind of evaluated the concept of",
    "start": "2481280",
    "end": "2486560"
  },
  {
    "text": "contributing upstream to it and trying to make changes that way but we realized in order to do everything we",
    "start": "2486560",
    "end": "2492000"
  },
  {
    "text": "wanted we would have to change the basically the entire code base anyway so we decided just to do it take this approach um",
    "start": "2492000",
    "end": "2498079"
  },
  {
    "text": "code is available say it's on github if you want to take a look it's mlt license you can use it use it if you want to welcome contributions all that sort of stuff",
    "start": "2498079",
    "end": "2505920"
  },
  {
    "text": "the other side of things is um they mentioned operator hub i don't think we're on there yet i think we need to talk to them about it",
    "start": "2505920",
    "end": "2512560"
  },
  {
    "text": "but yeah there are hundreds of these things out there so lots of databases in particular have these things cockroach db",
    "start": "2512560",
    "end": "2518400"
  },
  {
    "text": "have one uh there's one for couchdb i think uh i think it's three postgres that do have",
    "start": "2518400",
    "end": "2523599"
  },
  {
    "text": "various different focuses um there are a bunch out there that's what these kind of things they're very",
    "start": "2523599",
    "end": "2528640"
  },
  {
    "text": "popular for databases because databases require this extra special kind of stateful management",
    "start": "2528640",
    "end": "2535359"
  },
  {
    "text": "um so um jet stack have done operators before uh one of my colleagues james munnelly",
    "start": "2548240",
    "end": "2554160"
  },
  {
    "text": "uh wrote cert manager and so he's been working and as an operator so he's been working kind of in this space",
    "start": "2554160",
    "end": "2559520"
  },
  {
    "text": "for some time a few years now um i myself had not written an operator",
    "start": "2559520",
    "end": "2565200"
  },
  {
    "text": "before uh but a bunch of my colleagues had done so so we did have experience in the team to draw on so it",
    "start": "2565200",
    "end": "2571280"
  },
  {
    "text": "was easy to get into um yeah um i kind of mentioned the cube builder",
    "start": "2571280",
    "end": "2577040"
  },
  {
    "text": "documentation the keybuilder book that was pretty good um it does spend a lot of time talking about the",
    "start": "2577040",
    "end": "2582880"
  },
  {
    "text": "the why we do certain things and why because it has all these opinions and it has and it kind of goes into some",
    "start": "2582880",
    "end": "2588640"
  },
  {
    "text": "detail about why the authors of cube builder think you should do things in this way so that held quite a lot",
    "start": "2588640",
    "end": "2607839"
  },
  {
    "text": "um so because obviously you've got accenture you've got state what happens especially early in the project when you have to start grading adding fields to",
    "start": "2608079",
    "end": "2614800"
  },
  {
    "text": "your crd that's going to get quite painful i imagine um",
    "start": "2614800",
    "end": "2620240"
  },
  {
    "text": "the cid version management is a whole topic of in itself yeah we get stung by it yeah um if you",
    "start": "2620240",
    "end": "2626880"
  },
  {
    "text": "you looked our current api version is v1 alpha one um which means that we're kind of",
    "start": "2626880",
    "end": "2632640"
  },
  {
    "text": "comfortable making breaking changes we don't really want to um but we we can and we have",
    "start": "2632640",
    "end": "2639599"
  },
  {
    "text": "um once you've stabilized onto beta you you can't really do that um it does get easier kubernetes has a",
    "start": "2639599",
    "end": "2645680"
  },
  {
    "text": "feature called a conversion web hook so you can register a piece of logic that will run",
    "start": "2645680",
    "end": "2652240"
  },
  {
    "text": "whenever you create or update something that can actually run a version conversion for you",
    "start": "2652240",
    "end": "2659200"
  },
  {
    "text": "so if your version is only like you've moved a field or you've done like certain categories of changes you",
    "start": "2659200",
    "end": "2664720"
  },
  {
    "text": "can kind of automatically migrate those forwards for your users that's possible um",
    "start": "2664720",
    "end": "2671119"
  },
  {
    "text": "sometimes you can't do that i think it's actually happened so i'm not actually involved in the cert manager project but of course i talked",
    "start": "2671119",
    "end": "2677359"
  },
  {
    "text": "to james who is um they actually had some change recently where they had to make a breaking change",
    "start": "2677359",
    "end": "2682880"
  },
  {
    "text": "because they they changed something about their api which wasn't convertible that i think they split out a crd into",
    "start": "2682880",
    "end": "2689280"
  },
  {
    "text": "don't quote me on that i think they didn't see the cd out so they had to like go through some",
    "start": "2689280",
    "end": "2695040"
  },
  {
    "text": "documentation uh they had to like notify users it was yeah it can be difficult especially if you're a lot of",
    "start": "2695040",
    "end": "2701200"
  },
  {
    "text": "users out there to do that sort of thing it's good to know we're not the only ones then yeah yeah it's it's not a perfectly solid problem certainly the",
    "start": "2701200",
    "end": "2707119"
  },
  {
    "text": "conversion web hooks help but yeah all right thanks everyone",
    "start": "2707119",
    "end": "2712400"
  },
  {
    "text": "and i don't know if james if you're going to be sticking around yeah i can stick around and that's why so thank you very much for coming",
    "start": "2712400",
    "end": "2718740"
  },
  {
    "text": "[Applause]",
    "start": "2718740",
    "end": "2722280"
  }
]