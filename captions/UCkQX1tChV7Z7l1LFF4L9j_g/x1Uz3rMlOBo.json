[
  {
    "text": "hello everyone my name is Bing and my engineer on the infrastructure team at",
    "start": "3909",
    "end": "9700"
  },
  {
    "text": "SLAC today I'm going to talk about scaling slack before the talk I want to",
    "start": "9700",
    "end": "17019"
  },
  {
    "text": "do a quick poll raise your hand if you have used the slack before wow I saw",
    "start": "17019",
    "end": "24819"
  },
  {
    "text": "maybe in that heat 95% of you have used the slack that's fantastic",
    "start": "24819",
    "end": "30099"
  },
  {
    "text": "so for those who haven't used slag let me spend 30 seconds introduce what's the",
    "start": "30099",
    "end": "35500"
  },
  {
    "text": "racket so that is a messaging app the conversations were connected by channels you can send and receive messages get",
    "start": "35500",
    "end": "42970"
  },
  {
    "text": "notifications sent themes to your co-workers upload files search for content and the install tools and",
    "start": "42970",
    "end": "50770"
  },
  {
    "text": "services that you already use inside slack today there are over 1000 apps",
    "start": "50770",
    "end": "56530"
  },
  {
    "text": "available inside slack here are some examples of them slack is where what",
    "start": "56530",
    "end": "64268"
  },
  {
    "text": "happens our mission is to make people's working life simpler more pleasant and more productive we launched the slack",
    "start": "64269",
    "end": "72759"
  },
  {
    "text": "about four years ago at first we only have small teams with a few dozen and hundreds of users today we have gigantic",
    "start": "72759",
    "end": "80319"
  },
  {
    "text": "organization with hundreds of thousands of users the design decision we made back then made sense",
    "start": "80319",
    "end": "86109"
  },
  {
    "text": "showed their limitations I'll talk about the challenges and problems we run into",
    "start": "86109",
    "end": "91270"
  },
  {
    "text": "how we solved them and where we're going next here are some numbers about slack",
    "start": "91270",
    "end": "99639"
  },
  {
    "text": "skill we have over 6 million daily active users over 9 million weekly",
    "start": "99639",
    "end": "104679"
  },
  {
    "text": "active users the average time people spend stay connected is over 10 hours",
    "start": "104679",
    "end": "110289"
  },
  {
    "text": "and over 2 hours in active use on a typical working day over half of our",
    "start": "110289",
    "end": "117249"
  },
  {
    "text": "daily active users are outside of us",
    "start": "117249",
    "end": "121469"
  },
  {
    "text": "this a simplified version of slacks architecture slack use a typical la MP",
    "start": "123569",
    "end": "129869"
  },
  {
    "text": "stack short for Linux Apache Mexico and PHP in the center there is web",
    "start": "129869",
    "end": "135690"
  },
  {
    "text": "application it it implements our business logic of slack it's backed by",
    "start": "135690",
    "end": "141870"
  },
  {
    "text": "short in Mexico and a job queue system which executes a synchronous jobs",
    "start": "141870",
    "end": "148159"
  },
  {
    "text": "another important component of the stack is messengering server it sends real-time events to users it",
    "start": "148610",
    "end": "156450"
  },
  {
    "text": "used WebSocket protocol which is a food to clerks communication protocol over TCP it is the post multiplexing and is",
    "start": "156450",
    "end": "165030"
  },
  {
    "text": "bi-directional both the client and a server can push data to the other end our client",
    "start": "165030",
    "end": "171300"
  },
  {
    "text": "mobile desktop will web the speak HTTP",
    "start": "171300",
    "end": "176489"
  },
  {
    "text": "to web to web app and web socket to messaging server the problem we had was",
    "start": "176489",
    "end": "187940"
  },
  {
    "text": "user experienced slowness connecting to slack the problem first show up in 2015",
    "start": "187940",
    "end": "195830"
  },
  {
    "text": "to understand why that's a challenge let's take a look at the login flow",
    "start": "195830",
    "end": "202010"
  },
  {
    "text": "imagine you arrive at your office you had your first coffee now you open your laptop and the launch slack what happens",
    "start": "202820",
    "end": "210360"
  },
  {
    "text": "then is your client send HTTP POST to the server the server validates your",
    "start": "210360",
    "end": "217019"
  },
  {
    "text": "token and it sends back a snapshot of your team here is a screenshot of the",
    "start": "217019",
    "end": "223290"
  },
  {
    "text": "response with top-level objects there's team including your team name and the",
    "start": "223290",
    "end": "228360"
  },
  {
    "text": "team setting the list of channels the list of private channels your AIIMS your",
    "start": "228360",
    "end": "234090"
  },
  {
    "text": "group AIIMS users and bots on the right this shows the response size with",
    "start": "234090",
    "end": "239670"
  },
  {
    "text": "different number of users and channels of your of the team you don't need to",
    "start": "239670",
    "end": "246390"
  },
  {
    "text": "read too much about the exact number but a takeaway is the response that can become fairly big and it grows with the",
    "start": "246390",
    "end": "254459"
  },
  {
    "text": "size of the team I will come back to this in a moment",
    "start": "254459",
    "end": "260000"
  },
  {
    "text": "in this response there's also a WebSocket you are L which client used to",
    "start": "260900",
    "end": "266580"
  },
  {
    "text": "establish the WebSocket connection with the messaging server then real-time",
    "start": "266580",
    "end": "271860"
  },
  {
    "text": "events flows in on this WebSocket connection and your client is ready to use you can now navigate to channels",
    "start": "271860",
    "end": "278460"
  },
  {
    "text": "send messages and start a conversation with your co-workers on that WebSocket",
    "start": "278460",
    "end": "289830"
  },
  {
    "text": "connection there are over 100 types of events essentially anything happening in",
    "start": "289830",
    "end": "295650"
  },
  {
    "text": "real time inside slack it's sent to you through those events examples of such events",
    "start": "295650",
    "end": "301230"
  },
  {
    "text": "include chat messages type indicator indicating who it's type in the channel files upload files comment replies to",
    "start": "301230",
    "end": "308490"
  },
  {
    "text": "threads user profile change user presence change reactions pin stars",
    "start": "308490",
    "end": "313890"
  },
  {
    "text": "app installation X etc etc in short",
    "start": "313890",
    "end": "321800"
  },
  {
    "text": "client first download a snapshot of your team then it is tablished a WebSocket",
    "start": "321800",
    "end": "327060"
  },
  {
    "text": "connection and real-time events floating on that connection the client is a",
    "start": "327060",
    "end": "332700"
  },
  {
    "text": "eventually consistent snapshot of your team this design made make a lot of",
    "start": "332700",
    "end": "339180"
  },
  {
    "text": "sense in early days the slack objects users channels messages are stored",
    "start": "339180",
    "end": "346890"
  },
  {
    "text": "locally on the crime side this enabled us to support extremely rich user",
    "start": "346890",
    "end": "353040"
  },
  {
    "text": "experience and we it allowed us to move fast and experiment here new features and designs it worked great for small",
    "start": "353040",
    "end": "360690"
  },
  {
    "text": "teams however is not so great for big teams there are a few problems the first",
    "start": "360690",
    "end": "371160"
  },
  {
    "text": "team payload is too big it takes time for the server to assemble them to transmit them of the internet and and",
    "start": "371160",
    "end": "377580"
  },
  {
    "text": "takes time for the clients to process them it contributes to your large client",
    "start": "377580",
    "end": "384450"
  },
  {
    "text": "memory footprint clients needs to process is payload and keep them up to date",
    "start": "384450",
    "end": "391039"
  },
  {
    "text": "it is expensive to reconnect to slag imagine you had a break in the middle of",
    "start": "392550",
    "end": "398170"
  },
  {
    "text": "the day when you come back 50 minutes later your client needs to sync up all the events that hit missed during that",
    "start": "398170",
    "end": "403420"
  },
  {
    "text": "time there can be reconnected storm if",
    "start": "403420",
    "end": "409570"
  },
  {
    "text": "there is a regional networking blip many user come back online in the same time",
    "start": "409570",
    "end": "414610"
  },
  {
    "text": "the Thunder herd overloaded the servers with which caused cascading failures and",
    "start": "414610",
    "end": "420520"
  },
  {
    "text": "it takes time to recover we were aware",
    "start": "420520",
    "end": "426490"
  },
  {
    "text": "of this problem so we did a bunch of incremental improvement improvements",
    "start": "426490",
    "end": "432510"
  },
  {
    "text": "first we reduce the initial team payload from three different effects client",
    "start": "432930",
    "end": "439690"
  },
  {
    "text": "stores at timestamp of the objects so that's the server only needs to send a delta of those if they are updated since",
    "start": "439690",
    "end": "446800"
  },
  {
    "text": "last time we we removed certain objects out out like I am so that are not",
    "start": "446800",
    "end": "455110"
  },
  {
    "text": "currently open the idea is to establish the WebSocket connection as fast as possible then",
    "start": "455110",
    "end": "460690"
  },
  {
    "text": "those data can be loaded in parallel while the WebSocket connection is made third we simplify the certain objects",
    "start": "460690",
    "end": "468780"
  },
  {
    "text": "for example we simply provide the image the image you the user image URLs into a",
    "start": "468780",
    "end": "475600"
  },
  {
    "text": "hash code under 10,000 user team this change alone saved us a few megabyte of",
    "start": "475600",
    "end": "481720"
  },
  {
    "text": "data we also changed how climbed",
    "start": "481720",
    "end": "487600"
  },
  {
    "text": "bootstrap instead of instead of loading the whole word the client can choose to",
    "start": "487600",
    "end": "494500"
  },
  {
    "text": "load one channel first this is especially useful on mobile imagine this",
    "start": "494500",
    "end": "500140"
  },
  {
    "text": "use case you you'll receive an push notification on your phone you tap it all you want to know is what you want to",
    "start": "500140",
    "end": "506890"
  },
  {
    "text": "do is to be able to reply to this message as fast as possible so instead of loading the whole world mobile client",
    "start": "506890",
    "end": "513729"
  },
  {
    "text": "loads this one channel first with the current message a short message history and users who are mentioned in the",
    "start": "513730",
    "end": "520060"
  },
  {
    "text": "history this was first implemented in mobile then web client adopted",
    "start": "520060",
    "end": "525520"
  },
  {
    "text": "adopted it the web can also do a full load in parallel this reduced user",
    "start": "525520",
    "end": "530709"
  },
  {
    "text": "perceived a latency by 30% a few other",
    "start": "530709",
    "end": "538570"
  },
  {
    "text": "things we did we implemented a rate limit when servers are overloaded",
    "start": "538570",
    "end": "544000"
  },
  {
    "text": "rittany meters kicks in so that we only allow our percentage of traffic to go through we set up pops around the world",
    "start": "544000",
    "end": "552180"
  },
  {
    "text": "point of presence to terminate SSL connections closer to the users we",
    "start": "552180",
    "end": "560170"
  },
  {
    "text": "implemented load testing framework we similar we created the big teams and",
    "start": "560170",
    "end": "565209"
  },
  {
    "text": "simulates user different traffic patterns in a controlled way so that we",
    "start": "565209",
    "end": "570940"
  },
  {
    "text": "can see me we can find out potent acts proactively we're not only dealing with",
    "start": "570940",
    "end": "579520"
  },
  {
    "text": "the scale of teams we are also dealing with new product features for example in",
    "start": "579520",
    "end": "586270"
  },
  {
    "text": "late 2015 we launched group ion's this cost the users to be naturally in more",
    "start": "586270",
    "end": "592480"
  },
  {
    "text": "channels and caused the initial payload to be bigger we also launched emoji reactions",
    "start": "592480",
    "end": "598089"
  },
  {
    "text": "this makes messages to be bigger and the client and the reactions are synced to",
    "start": "598089",
    "end": "603160"
  },
  {
    "text": "client this makes client more likely to dump his local storage because at some point",
    "start": "603160",
    "end": "609250"
  },
  {
    "text": "it's easier and simpler to load everything from scratch instead of applying a delta this bad of all this we",
    "start": "609250",
    "end": "619149"
  },
  {
    "text": "managed to keep the situation in control with incremental improvements however we",
    "start": "619149",
    "end": "628480"
  },
  {
    "text": "know that's not enough we would still run into problem if even bigger teams",
    "start": "628480",
    "end": "634750"
  },
  {
    "text": "end up with us we were at risk of outages when many clients dumped their",
    "start": "634750",
    "end": "639910"
  },
  {
    "text": "cache oh it was it is time for an",
    "start": "639910",
    "end": "645040"
  },
  {
    "text": "architectural change the idea is simple",
    "start": "645040",
    "end": "651040"
  },
  {
    "text": "client lazy loading down on less data upfront and download more on T mount",
    "start": "651040",
    "end": "658280"
  },
  {
    "text": "this means a real tech chure of the client code of the client because client",
    "start": "658280",
    "end": "663590"
  },
  {
    "text": "can no longer make an assumption that all data is accessible locally sometimes data are fetch the look fetch to",
    "start": "663590",
    "end": "669890"
  },
  {
    "text": "remotely from remote servers what they have fetched remotely there is networking one trip Tommy introduced but",
    "start": "669890",
    "end": "677810"
  },
  {
    "text": "still we want our user experience to be seamless regardless of where data are fetched so we decided we want a new",
    "start": "677810",
    "end": "685880"
  },
  {
    "text": "service this service also client queries on demand it is backed by cache and sits",
    "start": "685880",
    "end": "691640"
  },
  {
    "text": "on the edge of the network so it provides fast data access we call this",
    "start": "691640",
    "end": "697910"
  },
  {
    "text": "service flannel you may ask why the name flannel any guesses",
    "start": "697910",
    "end": "704500"
  },
  {
    "text": "well naming as we all know it's very difficult in computer science on a day",
    "start": "707680",
    "end": "713660"
  },
  {
    "text": "when the project would kick off the lead engineer happened to wear a flannel shirt that's why in short flannel is a",
    "start": "713660",
    "end": "725390"
  },
  {
    "text": "query engine back to back cache it sits on the edge locations we examined the",
    "start": "725390",
    "end": "735380"
  },
  {
    "text": "objects in the initial payload and move the biggest object out first so users and then comes with channel",
    "start": "735380",
    "end": "742040"
  },
  {
    "text": "membership and channels we tweak to the login process now users established",
    "start": "742040",
    "end": "749330"
  },
  {
    "text": "WebSocket connection to flannel first if the user is the first user on his or her team then Freneau does not have the team",
    "start": "749330",
    "end": "756830"
  },
  {
    "text": "data in cache it goes to web app and loads the data from DB then it he",
    "start": "756830",
    "end": "762020"
  },
  {
    "text": "established a WebSocket connection on behalf of the user if the user is not",
    "start": "762020",
    "end": "767750"
  },
  {
    "text": "the first user on the team then friend already have to have a warm cache it skips step two and goes to an",
    "start": "767750",
    "end": "775610"
  },
  {
    "text": "established WebSocket connection directory for the user flannel is",
    "start": "775610",
    "end": "783200"
  },
  {
    "text": "essentially a May in the middle it sits on the WebSocket connection between client and a messaging server",
    "start": "783200",
    "end": "789260"
  },
  {
    "text": "and that WebSocket connection emissions they're over 100 types of",
    "start": "789260",
    "end": "795410"
  },
  {
    "text": "event flannel passes through all of them to the client it process a handful of",
    "start": "795410",
    "end": "801740"
  },
  {
    "text": "them to use them to update his cache such such events are users and channels",
    "start": "801740",
    "end": "809090"
  },
  {
    "text": "related examples are channel creation user creation user change their profile",
    "start": "809090",
    "end": "814400"
  },
  {
    "text": "a user joins or leaves a channel flannel",
    "start": "814400",
    "end": "822410"
  },
  {
    "text": "is deployed to seven different locations the Red Guard is our main region in u.s. East in the main region it has the four",
    "start": "822410",
    "end": "829790"
  },
  {
    "text": "slack stack including flannel web app DB and messaging server flannel is also",
    "start": "829790",
    "end": "837470"
  },
  {
    "text": "deployed to sell to six other remote regions and only flannel is in the",
    "start": "837470",
    "end": "843020"
  },
  {
    "text": "remote region we use a mix of AWS and Google cloud for our remote regions here",
    "start": "843020",
    "end": "851720"
  },
  {
    "text": "are some UI example that is powered by flannel quick switcher it's a quick way",
    "start": "851720",
    "end": "856820"
  },
  {
    "text": "to to navigate to different channels and users when you start typing it gives you a list of channels and user suggestions",
    "start": "856820",
    "end": "863960"
  },
  {
    "text": "when you select while you can navigate to them directly if you haven't used it",
    "start": "863960",
    "end": "869330"
  },
  {
    "text": "I highly recommend it it's control its command K only a Mac and control key on Windows mentions",
    "start": "869330",
    "end": "879170"
  },
  {
    "text": "suggestions in a master box when you start to type at something it gives you",
    "start": "879170",
    "end": "884930"
  },
  {
    "text": "a list of user suggestions it also tells you whether the user is in the current channel or not channel head bar it tells",
    "start": "884930",
    "end": "896000"
  },
  {
    "text": "you currently you are in general channel and with a bunch of basically information about the channel number",
    "start": "896000",
    "end": "902900"
  },
  {
    "text": "count and the channel topic channel sidebar it tells you more about the",
    "start": "902900",
    "end": "909260"
  },
  {
    "text": "channel team directory tells you everyone inside this team and allows you",
    "start": "909260",
    "end": "915320"
  },
  {
    "text": "to search it insured anything related at you users channels channel membership and autocomplete is",
    "start": "915320",
    "end": "922520"
  },
  {
    "text": "powered by flannel Flener was launched early this year",
    "start": "922520",
    "end": "929950"
  },
  {
    "text": "there was a load testing team with 200,000 users we had not been able to",
    "start": "929950",
    "end": "936260"
  },
  {
    "text": "load this team without flannel but now we were we are able to load it friendo",
    "start": "936260",
    "end": "943850"
  },
  {
    "text": "serves over five minutes simultaneous connections to the peak and it serves over 1 million queries per second here",
    "start": "943850",
    "end": "952610"
  },
  {
    "text": "is a side-by-side comparison of the team directory loaded with and without flannel on the left hand side it's",
    "start": "952610",
    "end": "959000"
  },
  {
    "text": "already loaded on the left on the right",
    "start": "959000",
    "end": "964640"
  },
  {
    "text": "hand side it's still spinning takes more",
    "start": "964640",
    "end": "970760"
  },
  {
    "text": "seconds ok that's not all of it",
    "start": "970760",
    "end": "980050"
  },
  {
    "text": "evolution of flannel the design of",
    "start": "980050",
    "end": "986810"
  },
  {
    "text": "flannel client lazy loading requires client to be able to load data asynchronously aunt amount however",
    "start": "986810",
    "end": "994850"
  },
  {
    "text": "before flannel the web current is in flip was implemented in a way with the",
    "start": "994850",
    "end": "1000910"
  },
  {
    "text": "assumption that data is always available locally so right before it it's about to",
    "start": "1000910",
    "end": "1006220"
  },
  {
    "text": "render user Bob it needs Bob in slow Co storage it's",
    "start": "1006220",
    "end": "1011920"
  },
  {
    "text": "impossible for us to change every word in crime code to be able to support lazy loading or at once",
    "start": "1011920",
    "end": "1018060"
  },
  {
    "text": "so what flannel did was to implement it just in time our notation let me explain",
    "start": "1018060",
    "end": "1026170"
  },
  {
    "text": "it in an example suppose you send a message you mention Bob in your message",
    "start": "1026170",
    "end": "1032350"
  },
  {
    "text": "and Bobby is not in the select clients cache so that the client has no way to",
    "start": "1032350",
    "end": "1039010"
  },
  {
    "text": "render the message at all friend seats on a WebSocket connection it's it's this",
    "start": "1039010",
    "end": "1044470"
  },
  {
    "text": "chat message it used some heuristic to know ok the client does not have it so it generates a synthetic user change",
    "start": "1044470",
    "end": "1052090"
  },
  {
    "text": "event about Bob client still uses out code it see this user change event it's",
    "start": "1052090",
    "end": "1058179"
  },
  {
    "text": "absurd it's local storage with Bob mom's later the chat when the chat message is",
    "start": "1058179",
    "end": "1063830"
  },
  {
    "text": "received client is able to render that message without problem in short",
    "start": "1063830",
    "end": "1069980"
  },
  {
    "text": "just-in-time annotation complete our needs without changing 1,000 places in",
    "start": "1069980",
    "end": "1075920"
  },
  {
    "text": "the web in cran code today our client evolved it is able to load data",
    "start": "1075920",
    "end": "1081380"
  },
  {
    "text": "asynchronously everywhere so we no longer need just-in-time annotation but",
    "start": "1081380",
    "end": "1087410"
  },
  {
    "text": "it used to be instrumental for us to route flannel while the web client made",
    "start": "1087410",
    "end": "1093650"
  },
  {
    "text": "incremental changes to support it let's",
    "start": "1093650",
    "end": "1100250"
  },
  {
    "text": "take a closer look why does flannel sit on the WebSocket connection it needs to",
    "start": "1100250",
    "end": "1107270"
  },
  {
    "text": "receive real-time events to update his cache however there's a downside",
    "start": "1107270",
    "end": "1115210"
  },
  {
    "text": "imagine this use case today you are at Keuka you only check slack in and out of",
    "start": "1115720",
    "end": "1122120"
  },
  {
    "text": "talks occasionally you want your co-workers to know that's the case so that they can just their assumption",
    "start": "1122120",
    "end": "1129020"
  },
  {
    "text": "about your responsibilities in you crying messages so you change your slack status to be in a conference this state",
    "start": "1129020",
    "end": "1137210"
  },
  {
    "text": "has change is broadcast to all your co-workers if you are on a 1,000 user team messenger server send out 1,000 of",
    "start": "1137210",
    "end": "1144830"
  },
  {
    "text": "such events flannel at the may in the middle it receives 1,000 copy of the",
    "start": "1144830",
    "end": "1150140"
  },
  {
    "text": "same event this is very inefficient what",
    "start": "1150140",
    "end": "1156860"
  },
  {
    "text": "we did is we supported a we implemented publish subscribe pops up Rennell pops",
    "start": "1156860",
    "end": "1164420"
  },
  {
    "text": "up to a list of users and channels it is interested in with messenger server and only at github dates for those this",
    "start": "1164420",
    "end": "1173870"
  },
  {
    "text": "means a rewrite of the messenger server for it to support pops up I won't go into details about how we did it but we",
    "start": "1173870",
    "end": "1180440"
  },
  {
    "text": "implemented it provides us a few benefits",
    "start": "1180440",
    "end": "1185710"
  },
  {
    "text": "it saves plan or CPU with simpler code we also changed from Jason event to",
    "start": "1185710",
    "end": "1192570"
  },
  {
    "text": "thrifty event the schema data it's much easier to manage it provides flexibility",
    "start": "1192570",
    "end": "1198149"
  },
  {
    "text": "for cash management previously Flener",
    "start": "1198149",
    "end": "1204210"
  },
  {
    "text": "okay allotted the team data when the first user connects and unload theta when the last user disconnects it has to",
    "start": "1204210",
    "end": "1210960"
  },
  {
    "text": "do it in this way because that's the only way for it to keep the cash up to date when the roster user disconnect the",
    "start": "1210960",
    "end": "1217679"
  },
  {
    "text": "web connection the WebSocket connection is tore down and Friends cache local would go still pretty quickly today",
    "start": "1217679",
    "end": "1227669"
  },
  {
    "text": "which pops up we isolate what events friend receives from who are connected to flannel so if Leno can keep the cash",
    "start": "1227669",
    "end": "1234299"
  },
  {
    "text": "data around longer next time when the first user on the team connects Fran already have a warm cash this helps with",
    "start": "1234299",
    "end": "1241830"
  },
  {
    "text": "the user click connect time pre-warm cash is currently under development",
    "start": "1241830",
    "end": "1249138"
  },
  {
    "text": "let's take another closer look which pops up does friend know still needs to",
    "start": "1252830",
    "end": "1258690"
  },
  {
    "text": "be on the WebSocket path dancer is down we can move flannel out of the path in",
    "start": "1258690",
    "end": "1266309"
  },
  {
    "text": "fact there is no need to capo a search query engine with real-time events path",
    "start": "1266309",
    "end": "1273470"
  },
  {
    "text": "once flannel is moved out of the WebSocket path it provides better isolation in our architecture and this",
    "start": "1273470",
    "end": "1281279"
  },
  {
    "text": "is the next thing where the next thing we're going to work on so far I've been",
    "start": "1281279",
    "end": "1289950"
  },
  {
    "text": "talking about the involvement the evolution of flannel because of performance requirements",
    "start": "1289950",
    "end": "1296220"
  },
  {
    "text": "there's also product requirements a big one is enterprise grade graded select",
    "start": "1296220",
    "end": "1302639"
  },
  {
    "text": "select solution for big enterprise in third grade you can create unlimited",
    "start": "1302639",
    "end": "1307649"
  },
  {
    "text": "number of federated teams by complete departments of locations or anything you",
    "start": "1307649",
    "end": "1314519"
  },
  {
    "text": "define each grade team provides you the same experience that many of you are",
    "start": "1314519",
    "end": "1319980"
  },
  {
    "text": "familiar with across teams you can create shared channels across a food a",
    "start": "1319980",
    "end": "1325769"
  },
  {
    "text": "few teams or the entire grade it's a great level it provides management privacy and",
    "start": "1325769",
    "end": "1331830"
  },
  {
    "text": "security control when flaner was first implemented we don't have grid in our",
    "start": "1331830",
    "end": "1337770"
  },
  {
    "text": "mind one important design of flannel is team affinity this means all users from",
    "start": "1337770",
    "end": "1346260"
  },
  {
    "text": "the same thing goes to the same clan or host if they're from the same geographical location this is to you",
    "start": "1346260",
    "end": "1352590"
  },
  {
    "text": "guarantee cache efficiency with shared channels it means many different teams",
    "start": "1352590",
    "end": "1358770"
  },
  {
    "text": "share the same objects this makes flat no to cache duplicated objects inside their carriage inside the",
    "start": "1358770",
    "end": "1365490"
  },
  {
    "text": "cache repeatedly it's clear we need to do better we introduced great aware",
    "start": "1365490",
    "end": "1372539"
  },
  {
    "text": "cache which means enough and a single flannel host we store those shared objects in won't separate key space",
    "start": "1372539",
    "end": "1379740"
  },
  {
    "text": "which are referenced by multiple teams with this change we saved a lot of",
    "start": "1379740",
    "end": "1386429"
  },
  {
    "text": "flannel memory our average per host we saved Chinese yogic bat of the 22 to",
    "start": "1386429",
    "end": "1393360"
  },
  {
    "text": "kick that of memory and one point one terabyte across the fleet for our",
    "start": "1393360",
    "end": "1404190"
  },
  {
    "text": "biggest customer it also improves their DB shard CPU usage the CPU idle",
    "start": "1404190",
    "end": "1410789"
  },
  {
    "text": "increased from 25 percent to 90 percent that is because it's more likely for",
    "start": "1410789",
    "end": "1416490"
  },
  {
    "text": "shared objects to be in cash so it takes so flannel needs to go to the beach",
    "start": "1416490",
    "end": "1421860"
  },
  {
    "text": "fetch data less fewer times for the exact same reason this also improves",
    "start": "1421860",
    "end": "1427230"
  },
  {
    "text": "user collect connective agency p99 agency dropped from 40 seconds to 4",
    "start": "1427230",
    "end": "1433470"
  },
  {
    "text": "seconds in the future we plan to",
    "start": "1433470",
    "end": "1440190"
  },
  {
    "text": "implement scatter and gather when requests coming one flow no hosts fetch",
    "start": "1440190",
    "end": "1446130"
  },
  {
    "text": "data from different his bases which may located on different flannel hosts and",
    "start": "1446130",
    "end": "1451140"
  },
  {
    "text": "combine them together our thinking is this will further improve our cache efficiency",
    "start": "1451140",
    "end": "1457730"
  },
  {
    "text": "so far I've been talking about the evolution of flannel let's tweet switch",
    "start": "1461270",
    "end": "1467670"
  },
  {
    "text": "gears and look at client pops up this is an interesting feature for performance",
    "start": "1467670",
    "end": "1473100"
  },
  {
    "text": "reasons if you still remember the",
    "start": "1473100",
    "end": "1481350"
  },
  {
    "text": "example I brought up earlier you are at cue card you change your slack status to",
    "start": "1481350",
    "end": "1486540"
  },
  {
    "text": "be in a conference and this is broadcast to all your coworkers in fact this is",
    "start": "1486540",
    "end": "1492600"
  },
  {
    "text": "unnecessary most likely you are going to talk to you a few dozen co-workers most of the time so only them needs to know",
    "start": "1492600",
    "end": "1499350"
  },
  {
    "text": "your state has changed instead of broadcast everything to everyone",
    "start": "1499350",
    "end": "1504980"
  },
  {
    "text": "client-side pops up is for clients to sub support for crunch subscribe to your",
    "start": "1504980",
    "end": "1510300"
  },
  {
    "text": "list of users and channels they're interested in and only get updates for those in fact reduce the number of",
    "start": "1510300",
    "end": "1518370"
  },
  {
    "text": "events client have two clients have to process largely improves clients",
    "start": "1518370",
    "end": "1523650"
  },
  {
    "text": "performance the first thing we moved to",
    "start": "1523650",
    "end": "1531620"
  },
  {
    "text": "presents - the first thing we moved to Oakland pops up is presence update this",
    "start": "1531620",
    "end": "1538740"
  },
  {
    "text": "is a feature when the user goes online or offline we render a green or grey dot",
    "start": "1538740",
    "end": "1543929"
  },
  {
    "text": "by the side of your avatar presence events used to be 60% of all the events",
    "start": "1543929",
    "end": "1549780"
  },
  {
    "text": "in terms of volume due to its volatile nature under 1000 the user team suppose",
    "start": "1549780",
    "end": "1556559"
  },
  {
    "text": "each user flip their presents once its generate 1 million events it grows with",
    "start": "1556559",
    "end": "1562380"
  },
  {
    "text": "n square in Big O notation so what we",
    "start": "1562380",
    "end": "1568830"
  },
  {
    "text": "did is client keeps a list of users in counter view and only subscribes to",
    "start": "1568830",
    "end": "1574860"
  },
  {
    "text": "their presence when the user changed their view it it's changed the",
    "start": "1574860",
    "end": "1581850"
  },
  {
    "text": "subscription list this reduced the presence events by a fact by a factor of",
    "start": "1581850",
    "end": "1588600"
  },
  {
    "text": "five across the fly and we're moving more events into this model",
    "start": "1588600",
    "end": "1594289"
  },
  {
    "text": "lastly let's take a quick tour of messaging server what is missing you",
    "start": "1597050",
    "end": "1605190"
  },
  {
    "text": "suffered you can think of it as a big",
    "start": "1605190",
    "end": "1610800"
  },
  {
    "text": "router it aroused events to users when",
    "start": "1610800",
    "end": "1617610"
  },
  {
    "text": "the event happens on a team a message is created we actually it's made a file is",
    "start": "1617610",
    "end": "1623250"
  },
  {
    "text": "uploaded messenger server found this event to the list of users who are supposed to receive them",
    "start": "1623250",
    "end": "1629840"
  },
  {
    "text": "less new server maintains metadata so that he knows where to route the traffic it knows which channels are on the team",
    "start": "1629840",
    "end": "1637110"
  },
  {
    "text": "and who are connected to which channels",
    "start": "1637110",
    "end": "1641330"
  },
  {
    "text": "initially it was implemented shortened by team meaning once there is",
    "start": "1643400",
    "end": "1648870"
  },
  {
    "text": "responsible for your team all the events related to that team goes to that server this is a single point of failure when",
    "start": "1648870",
    "end": "1656340"
  },
  {
    "text": "the server goes down it means your select you cannot connect your select you cannot connect to slack we have",
    "start": "1656340",
    "end": "1665190"
  },
  {
    "text": "shared channels share cellos channels means there are many shared States among",
    "start": "1665190",
    "end": "1671100"
  },
  {
    "text": "different teams and we need to copy messages around imagine a shared channel",
    "start": "1671100",
    "end": "1677610"
  },
  {
    "text": "which is shared among a few thousand teams which we do have in production this makes States management impossible",
    "start": "1677610",
    "end": "1686000"
  },
  {
    "text": "it's clear we need a plan B we changed",
    "start": "1686210",
    "end": "1692040"
  },
  {
    "text": "from team shardene to topic Charlie what is topic in this context topic is a",
    "start": "1692040",
    "end": "1698370"
  },
  {
    "text": "group of affiliated objects that you divide so at home it can be a user a",
    "start": "1698370",
    "end": "1703590"
  },
  {
    "text": "specific group of users a channel shared or long shared a DM a group DM a team",
    "start": "1703590",
    "end": "1709890"
  },
  {
    "text": "work great events has sent two topics",
    "start": "1709890",
    "end": "1714830"
  },
  {
    "text": "topic Charlene's a natural fit for share the channels the events from the share",
    "start": "1714950",
    "end": "1720660"
  },
  {
    "text": "the channel you send to the topic that represent in that channel and fend out to all channel members",
    "start": "1720660",
    "end": "1726510"
  },
  {
    "text": "Recovery's of which team the user his arm it reduced user perceived failures",
    "start": "1726510",
    "end": "1736520"
  },
  {
    "text": "now when a server goes down he means the list of topics are not available very",
    "start": "1736520",
    "end": "1742440"
  },
  {
    "text": "likely you can slap you can still connect to slack but you may not be able to access all your channels it's the",
    "start": "1742440",
    "end": "1752820"
  },
  {
    "text": "messenger server react texture we also improved our failing recovery previously when a server goes down",
    "start": "1752820",
    "end": "1759000"
  },
  {
    "text": "it requires human interaction and operator needs to come in run a script",
    "start": "1759000",
    "end": "1764010"
  },
  {
    "text": "micro age the states to a healthy server today all these are automatic it reduced",
    "start": "1764010",
    "end": "1770309"
  },
  {
    "text": "to failure recovery time from minutes to seconds messenger server support pops up",
    "start": "1770309",
    "end": "1777690"
  },
  {
    "text": "a mission earlier posts flannel and clients subscribe to the list of topic",
    "start": "1777690",
    "end": "1783150"
  },
  {
    "text": "they're interested in and only get updates for those this improves flannel",
    "start": "1783150",
    "end": "1788549"
  },
  {
    "text": "and client performance messenger were",
    "start": "1788549",
    "end": "1796320"
  },
  {
    "text": "implemented felt is the edge previously Messner server only sees in the main DC",
    "start": "1796320",
    "end": "1802640"
  },
  {
    "text": "today we move part of the functionality to the edge this reduced the networking",
    "start": "1802640",
    "end": "1809730"
  },
  {
    "text": "bandwidth between our main region and remote regions this is a two-year",
    "start": "1809730",
    "end": "1819240"
  },
  {
    "text": "journey we had a problem within a bunch of incremental changes we keep the",
    "start": "1819240",
    "end": "1825030"
  },
  {
    "text": "situation in control than we did a big architectural change this architectural",
    "start": "1825030",
    "end": "1830549"
  },
  {
    "text": "effort is across different teams Beck had a friend and mobile PMS and product engineers our first design of",
    "start": "1830549",
    "end": "1838470"
  },
  {
    "text": "this architecture is not the most optimal we knew that but with deciding that you do it this way because that's",
    "start": "1838470",
    "end": "1844650"
  },
  {
    "text": "the faster and the easy way to push out the change then we take time to evolve",
    "start": "1844650",
    "end": "1849900"
  },
  {
    "text": "on this architecture I think this is the biggest reason why we succeeded in such a big effort",
    "start": "1849900",
    "end": "1856790"
  },
  {
    "text": "and we have a long way ahead currently we're working on creeks at a pre-warm",
    "start": "1858030",
    "end": "1863970"
  },
  {
    "text": "flannels cash more flannel out of the websocket pass and everything pops up",
    "start": "1863970",
    "end": "1869450"
  },
  {
    "text": "under you for our team besides flannel and a messenger server we are also responsible for job queue",
    "start": "1869450",
    "end": "1875640"
  },
  {
    "text": "and the sorority layer if you are interested get in touch thank you now I",
    "start": "1875640",
    "end": "1884670"
  },
  {
    "text": "will take questions so one question",
    "start": "1884670",
    "end": "1901050"
  },
  {
    "text": "about your messaging server why do you decide to implement pops up yourself in the server rather than use a middleware",
    "start": "1901050",
    "end": "1906660"
  },
  {
    "text": "or something else to implement it for examples they RabbitMQ Redis or any other pops up systems out there we",
    "start": "1906660",
    "end": "1914220"
  },
  {
    "text": "discussed that within our team the thing is we already have a system ready there that were the implement most of the",
    "start": "1914220",
    "end": "1920730"
  },
  {
    "text": "logic so when we do the architecture we feel like we don't need to spend an",
    "start": "1920730",
    "end": "1926670"
  },
  {
    "text": "effort to bring in something completely new we can just tolerate tailor our existing system and be able to support",
    "start": "1926670",
    "end": "1933570"
  },
  {
    "text": "all those new features so if the client",
    "start": "1933570",
    "end": "1943050"
  },
  {
    "text": "is doing a lot of lazy loading as opposed to those big payloads coming across the wire",
    "start": "1943050",
    "end": "1948770"
  },
  {
    "text": "how are you protecting yourself against you know death by reconnect so if your",
    "start": "1948770",
    "end": "1954510"
  },
  {
    "text": "service goes down and you have these clients across the world trying to reconnect to your service how are you protecting yourself against",
    "start": "1954510",
    "end": "1961740"
  },
  {
    "text": "sort of a thundering herd problem honestly it depends on how much we",
    "start": "1961740",
    "end": "1967320"
  },
  {
    "text": "connect we guess today we can only support here to up to a certain point",
    "start": "1967320",
    "end": "1972800"
  },
  {
    "text": "for example two weeks ago we actually have an incident where we are like this",
    "start": "1972800",
    "end": "1978840"
  },
  {
    "text": "whole service was was done because of a thunder herd problem but actually that",
    "start": "1978840",
    "end": "1984360"
  },
  {
    "text": "problem is we lost half of our WebSocket connections and all of them are collecting slack all at once",
    "start": "1984360",
    "end": "1991610"
  },
  {
    "text": "we actually didn't handle it well enough today what happened back two weeks ago",
    "start": "1991610",
    "end": "1997770"
  },
  {
    "text": "was a WS gob was done because yoga cannot scale fast enough and then we",
    "start": "1997770",
    "end": "2004430"
  },
  {
    "text": "have to set up a new year b cluster and scale it over time that's how we",
    "start": "2004430",
    "end": "2009470"
  },
  {
    "text": "recovered our traffic okay let's thank",
    "start": "2009470",
    "end": "2021860"
  },
  {
    "text": "me [Applause]",
    "start": "2021860",
    "end": "2027500"
  }
]