[
  {
    "text": "hello all right today we're going to go over how to Benchmark some retrievable",
    "start": "719",
    "end": "6919"
  },
  {
    "text": "algorithms using the new uh Lang chain benchmarks package um as well as the",
    "start": "6919",
    "end": "12639"
  },
  {
    "text": "public data set that we're releasing um specifically the public data set is for question answering over Lang chain",
    "start": "12639",
    "end": "19000"
  },
  {
    "text": "documentation um and so we've provided uh about 86 examples of inputs and",
    "start": "19000",
    "end": "24560"
  },
  {
    "text": "expected outputs um and as well as some utilities for doing some basic kind of like in question um and then we've",
    "start": "24560",
    "end": "33120"
  },
  {
    "text": "evaluated a bunch of different methods for doing retrieval and then retrieval augmented generation so generating",
    "start": "33120",
    "end": "38239"
  },
  {
    "text": "answers to those uh questions we can then kind of like score each retrieval",
    "start": "38239",
    "end": "44520"
  },
  {
    "text": "or generation method we'll we'll kind of like change up both pieces we'll score that against the ground truth and see",
    "start": "44520",
    "end": "50120"
  },
  {
    "text": "how we do and so we've done that on a bunch of architectures so far um and",
    "start": "50120",
    "end": "56399"
  },
  {
    "text": "what we're going to do in this video is we're going to try it out on a new one uh because part of the the the value in",
    "start": "56399",
    "end": "63199"
  },
  {
    "text": "open sourcing this is that it can serve as a way for people to Benchmark you know all the different retrieval",
    "start": "63199",
    "end": "68320"
  },
  {
    "text": "algorithms all the different models that are coming out and see how it actually does so we're going to be working off of",
    "start": "68320",
    "end": "74520"
  },
  {
    "text": "this uh this notebook right here I'm going to I'm going to basically",
    "start": "74520",
    "end": "80400"
  },
  {
    "text": "be copying some parts over to my jupyter notebook running it changing some stuff up because uh I want to change stuff up",
    "start": "80400",
    "end": "87000"
  },
  {
    "text": "I want to evaluate different things specifically the thing that I want to value8 for this video is uh some sort of",
    "start": "87000",
    "end": "94119"
  },
  {
    "text": "like multi-query um query expansion type uh of retriever so in typical rag the",
    "start": "94119",
    "end": "101439"
  },
  {
    "text": "question comes in and then you look up five or six documents relevant to that question what I want to do is instead",
    "start": "101439",
    "end": "107719"
  },
  {
    "text": "expand a single question into two or three or four different",
    "start": "107719",
    "end": "113040"
  },
  {
    "text": "questions look up documents for all of those and then answer based on all of those documents the idea behind this is",
    "start": "113040",
    "end": "120520"
  },
  {
    "text": "that when you're looking things up it might be better to break down the the",
    "start": "120520",
    "end": "125560"
  },
  {
    "text": "overall user question into distinct sub questions look those things up and then respond with an answer over all of those",
    "start": "125560",
    "end": "131800"
  },
  {
    "text": "talks so I'm going to try implementing that and then benchmarking it so I've got this I'm going to copy",
    "start": "131800",
    "end": "138720"
  },
  {
    "text": "some of the code over here and install everything that's",
    "start": "138720",
    "end": "143680"
  },
  {
    "text": "needed I'm then going to set uh some uh environment Vari Ables um so let's copy",
    "start": "144800",
    "end": "153640"
  },
  {
    "text": "this um I need my Lang chain API key so I'm going to go here grab my API key",
    "start": "153640",
    "end": "161440"
  },
  {
    "text": "from here U if you don't have access to Lang Smith uh shoot me a DM on Twitter",
    "start": "161440",
    "end": "167800"
  },
  {
    "text": "that's probably the best way and and I'll get you an access code",
    "start": "167800",
    "end": "173040"
  },
  {
    "text": "um I'm going to do this in a little bit but I'm going to do it along with the other uh environment variables I'm I'm",
    "start": "173040",
    "end": "179959"
  },
  {
    "text": "going to do that I'm going to pause when I do that so that you don't see uh my screen and my secrets there the other",
    "start": "179959",
    "end": "185280"
  },
  {
    "text": "environment variables I'm going to set at the same time are these I'm not actually going to use hugging face I'm",
    "start": "185280",
    "end": "190799"
  },
  {
    "text": "just going to use open AI for everything so I'm going to set my Lang chain API key my anthropic API key and then my open AI API key let me do that and then",
    "start": "190799",
    "end": "198040"
  },
  {
    "text": "I'll come back okay we're back I set my API",
    "start": "198040",
    "end": "203080"
  },
  {
    "text": "Keys now I'm going to follow this code so I'm going to use uh the Lang chain benchmarks code",
    "start": "203080",
    "end": "211640"
  },
  {
    "text": "to check out some we have we have a variety of tasks in here the one that I'll be doing is this Lang chain doc Q&A",
    "start": "211640",
    "end": "218480"
  },
  {
    "text": "task we'll we'll we'll go into more details on some of the other ones um but this is the this is the main ready one",
    "start": "218480",
    "end": "224959"
  },
  {
    "text": "as of today um so if we take a look at it I can see that there's a data set ID I can click on this this is a public data set",
    "start": "224959",
    "end": "232040"
  },
  {
    "text": "that we've published under the link chain org um so you can see that there's 86 different examples um and then",
    "start": "232040",
    "end": "238000"
  },
  {
    "text": "there's also a bench of test runs that that we ran um along with some scores for how well those",
    "start": "238000",
    "end": "244120"
  },
  {
    "text": "did so once I've done that um or I haven't done anything yet I'm just kind",
    "start": "244120",
    "end": "249959"
  },
  {
    "text": "of like looked at what everything's is now I'm going to clone this public data set this is going to move it in to my",
    "start": "249959",
    "end": "256280"
  },
  {
    "text": "link Smith account so now if I click on it this is in my personal link Smith",
    "start": "256280",
    "end": "261400"
  },
  {
    "text": "account um and I have no tests on it because I just cloned it in here but these uh inputs and outputs are all the",
    "start": "261400",
    "end": "267400"
  },
  {
    "text": "same from uh the data set that we collected so if we take a look at some of the questions you know we can take a",
    "start": "267400",
    "end": "273800"
  },
  {
    "text": "look we see question will this work from Lang chain. chat models import chat open AI llm equals chat openi model equals",
    "start": "273800",
    "end": "282120"
  },
  {
    "text": "CLA 2 and then the answer is here no Cloud 2 is a closed Source model developed by anthropic the chat open AI",
    "start": "282120",
    "end": "288160"
  },
  {
    "text": "class interfaces with open ai's chat model so these are um so there's 86 examples some of these have you know",
    "start": "288160",
    "end": "294680"
  },
  {
    "text": "simple answers like yes no other of these have longer uh natural language output",
    "start": "294680",
    "end": "300720"
  },
  {
    "text": "so once we do that um we're now going to set up the retriever I'm not going to change too much about the retriever um",
    "start": "300720",
    "end": "307360"
  },
  {
    "text": "in in this video I'm going to use the basic retriever the only slight difference that I'll do is I'm going to change this from hugging face embeddings",
    "start": "307360",
    "end": "314280"
  },
  {
    "text": "to open Ai embeddings and then this stuff uh so so",
    "start": "314280",
    "end": "320960"
  },
  {
    "text": "this is loading some of the docks that we're going to use and then this is creating the retriever um this abstracts",
    "start": "320960",
    "end": "328080"
  },
  {
    "text": "away a little bit of what's actually going into creating the retriever it's a it's a kind of like handy method for uh",
    "start": "328080",
    "end": "334800"
  },
  {
    "text": "just creating a simple retriever if you want to change up some of the logic of this um the Logics in the the uh Lang",
    "start": "334800",
    "end": "341479"
  },
  {
    "text": "chain benchmarks code we'll probably try to make this a little bit more apparent in the future what exactly is going on",
    "start": "341479",
    "end": "347479"
  },
  {
    "text": "but for all intents and purposes this is creating a really simple Vector store retriever so let's run this and it'll do",
    "start": "347479",
    "end": "354080"
  },
  {
    "text": "some work while it's running we can take a look at the next cell so here's where we actually set up the chain that we use",
    "start": "354080",
    "end": "362080"
  },
  {
    "text": "um and so let's take a look at what's going into this chain we've got this format format docs function this takes",
    "start": "362080",
    "end": "368840"
  },
  {
    "text": "in a list of documents and returns a string so it's basically formatting the documents into some context that we can",
    "start": "368840",
    "end": "374199"
  },
  {
    "text": "pass into the language model this could be one thing that we play around with we could play around with kind of like the",
    "start": "374199",
    "end": "379599"
  },
  {
    "text": "the tokens used to denote um or pass in various metadata or Source or content um",
    "start": "379599",
    "end": "386199"
  },
  {
    "text": "this is definitely something we can play around with this is the prompt um again",
    "start": "386199",
    "end": "391840"
  },
  {
    "text": "this is something we can modify right now it's pretty simple you are an AI assistant answering questions about link chain respond Solly based on document",
    "start": "391840",
    "end": "398199"
  },
  {
    "text": "content and then the human question we're going to be using uh the anthropic uh new model that was just released um",
    "start": "398199",
    "end": "406199"
  },
  {
    "text": "and then uh the this is the so this is generating the final response it takes",
    "start": "406199",
    "end": "411520"
  },
  {
    "text": "it's the prompt llm and then it just turns it into a",
    "start": "411520",
    "end": "416720"
  },
  {
    "text": "string um it turns it into a string because the chat model returns a chat message by",
    "start": "416720",
    "end": "422199"
  },
  {
    "text": "default and then if we look at the the the chain um we can see that we are",
    "start": "422199",
    "end": "428400"
  },
  {
    "text": "adding in a new variable um this variable is called context we're getting",
    "start": "428400",
    "end": "433440"
  },
  {
    "text": "context by taking the question passing it to the retriever passing the response to format docs this is getting a string",
    "start": "433440",
    "end": "440440"
  },
  {
    "text": "so this is assigning a new variable called context with type string and then it's passing",
    "start": "440440",
    "end": "446360"
  },
  {
    "text": "it along to the response generator the response generator takes question and context so context is coming from the",
    "start": "446360",
    "end": "452639"
  },
  {
    "text": "retrieval questions getting passed along so runnable assign just adds in a new variable so it passes along everything",
    "start": "452639",
    "end": "458160"
  },
  {
    "text": "that's in it up to that point we can see that this looks like it is done so let's um so let's copy this",
    "start": "458160",
    "end": "467560"
  },
  {
    "text": "code but we want to do some changes specifically what we want to do all of",
    "start": "467560",
    "end": "474599"
  },
  {
    "text": "this looks fine um all of this looks pretty fine what we want to do is we want to change",
    "start": "474599",
    "end": "481240"
  },
  {
    "text": "this from taking the question passing it to the Retriever and then and then just formatting the documents we want to take",
    "start": "481240",
    "end": "488000"
  },
  {
    "text": "this question generate a bunch of sub questions from there we want to uh uh",
    "start": "488000",
    "end": "496080"
  },
  {
    "text": "look up all those questions with the retriever combine all the documents put them into a single string and then that's what we're going to use as",
    "start": "496080",
    "end": "502400"
  },
  {
    "text": "context so um what we're going to do to generate those sub questions is we're",
    "start": "502400",
    "end": "508720"
  },
  {
    "text": "going to go here and this is we we call this there's",
    "start": "508720",
    "end": "514120"
  },
  {
    "text": "there's two different ways that we kind of refer to this we call this multiquery or query expansion so I'm just looking in the prompt tub to see if there's any",
    "start": "514120",
    "end": "520680"
  },
  {
    "text": "prompts that I can use to kind of like help with this query expansion doesn't return anything if we do multi-query we",
    "start": "520680",
    "end": "527279"
  },
  {
    "text": "can see that there are a few different prompts um including one that that I uh",
    "start": "527279",
    "end": "533240"
  },
  {
    "text": "that I uh created when I was uh checking this out preparing for this um let me",
    "start": "533240",
    "end": "540120"
  },
  {
    "text": "um let me try to delete this um or I'll just work with it basically if you want",
    "start": "540120",
    "end": "545959"
  },
  {
    "text": "to work with your so you can see that this is forked directly from Jacob multiquery retriever what I what I don't",
    "start": "545959",
    "end": "552120"
  },
  {
    "text": "like about this prompt is that it's asking it to generate different versions of a given user",
    "start": "552120",
    "end": "557519"
  },
  {
    "text": "question and I really want to generate more like sub questions so if I try this",
    "start": "557519",
    "end": "564519"
  },
  {
    "text": "out in a playground if I pass in I also don't like the fact that I have to specify query count here I want to like",
    "start": "564519",
    "end": "570079"
  },
  {
    "text": "dynamically choose how many it should generate but let's just say there's three and then let's say say the",
    "start": "570079",
    "end": "575120"
  },
  {
    "text": "question is like how do I use open AI with chroma",
    "start": "575120",
    "end": "580399"
  },
  {
    "text": "DB um let's pick a model um let's pick",
    "start": "580399",
    "end": "585720"
  },
  {
    "text": "yeah 3.5 turbo seems fine um so if I look at all the questions that are",
    "start": "585720",
    "end": "592680"
  },
  {
    "text": "generated they're um they're not they're all basically like variants of the same",
    "start": "592680",
    "end": "600360"
  },
  {
    "text": "question which are exactly what the template asks for what the prompt asks for but I really want more specific",
    "start": "600360",
    "end": "605600"
  },
  {
    "text": "things like I want something like how do I use open how do I use chroma DB it can look up things for both of those and",
    "start": "605600",
    "end": "611560"
  },
  {
    "text": "then it can kind of maybe figure out how to use them together along with the original question or or some rephrase of how to use them together in case there",
    "start": "611560",
    "end": "617720"
  },
  {
    "text": "is a document just around that so basically I want to modify this so what I've done um actually yeah what",
    "start": "617720",
    "end": "626040"
  },
  {
    "text": "I did was I clicked the fork button and then saved it as my own um so now what I'm going to do is I",
    "start": "626040",
    "end": "633560"
  },
  {
    "text": "want to modify this a little bit um so also I think there's some weird entation in this prompt so I'm",
    "start": "633560",
    "end": "640639"
  },
  {
    "text": "going to say like I want to generate one to five different sub questions",
    "start": "640639",
    "end": "649480"
  },
  {
    "text": "or alternate versions of a given user question to",
    "start": "649480",
    "end": "655720"
  },
  {
    "text": "retrieve relevant document from the vector database by generating multiple",
    "start": "655720",
    "end": "661800"
  },
  {
    "text": "versions of the same us question by generating sub questions you",
    "start": "661800",
    "end": "670880"
  },
  {
    "text": "can break down questions or concepts that you can",
    "start": "670880",
    "end": "679320"
  },
  {
    "text": "break down questions that refer to multiple Concepts into distinct",
    "start": "679320",
    "end": "687360"
  },
  {
    "text": "questions this will help you",
    "start": "687360",
    "end": "692720"
  },
  {
    "text": "get documents for constructing Final",
    "start": "692839",
    "end": "699320"
  },
  {
    "text": "Answer um yeah I'm fine with XML tags so now let's try this out how do I",
    "start": "699320",
    "end": "707320"
  },
  {
    "text": "useb together um let's use chat openi for this let's",
    "start": "709200",
    "end": "716160"
  },
  {
    "text": "start seeing so it's still kind of focused on",
    "start": "716160",
    "end": "721440"
  },
  {
    "text": "how to use them together",
    "start": "721440",
    "end": "725760"
  },
  {
    "text": "um if uh if multiple",
    "start": "727519",
    "end": "735279"
  },
  {
    "text": "concepts are present in the question you should break into some",
    "start": "735279",
    "end": "743800"
  },
  {
    "text": "question one question for each concept",
    "start": "743800",
    "end": "749920"
  },
  {
    "text": "um let's try this out that's amazing okay so that's what I",
    "start": "749920",
    "end": "756320"
  },
  {
    "text": "want I might have like overfit slightly on this example that's fine there's a lot of prompt engineering that goes into",
    "start": "756320",
    "end": "761680"
  },
  {
    "text": "things like this we can evaluate this and see how it does that's the whole point of this video um so let's commit",
    "start": "761680",
    "end": "767760"
  },
  {
    "text": "this um to there um if we go back here cool it is",
    "start": "767760",
    "end": "774240"
  },
  {
    "text": "updated um let's copy this because we're going to use this in our code code um",
    "start": "774240",
    "end": "781160"
  },
  {
    "text": "and then from",
    "start": "781160",
    "end": "787440"
  },
  {
    "text": "model chat that's fine oh yeah don't want to",
    "start": "787440",
    "end": "794959"
  },
  {
    "text": "do that quite yet chain let's call this Q gen",
    "start": "794959",
    "end": "802800"
  },
  {
    "text": "equals",
    "start": "807760",
    "end": "810760"
  },
  {
    "text": "um",
    "start": "816600",
    "end": "819600"
  },
  {
    "text": "question Cool okay so it's generating each of those um so so I also want to probably keep around the original",
    "start": "830360",
    "end": "836600"
  },
  {
    "text": "question as well so I basically want to take the original question question generate some documents generate some code questions get some documents for",
    "start": "836600",
    "end": "842440"
  },
  {
    "text": "those look them all up comine all the results fine",
    "start": "842440",
    "end": "847519"
  },
  {
    "text": "um so now I need to add in something that basically splits this apart um oh I",
    "start": "847519",
    "end": "854519"
  },
  {
    "text": "also want to add in a stop sequence",
    "start": "854519",
    "end": "858959"
  },
  {
    "text": "um because I want it to stop when it uh this is just going to force it to stop",
    "start": "859800",
    "end": "867279"
  },
  {
    "text": "when it generates that to now let's see this",
    "start": "867279",
    "end": "872920"
  },
  {
    "text": "um okay cool",
    "start": "872920",
    "end": "877959"
  },
  {
    "text": "um I don't like how it's doing one two three four um so let's go back",
    "start": "877959",
    "end": "885320"
  },
  {
    "text": "here let's open this in the playground",
    "start": "885320",
    "end": "890759"
  },
  {
    "text": "um let's uh let's wrap these in quotes and see if",
    "start": "890880",
    "end": "898160"
  },
  {
    "text": "that fixes some of",
    "start": "898160",
    "end": "901079"
  },
  {
    "text": "it to switch this",
    "start": "904320",
    "end": "910240"
  },
  {
    "text": "how I okay so that seems good so so wrapping",
    "start": "910240",
    "end": "917839"
  },
  {
    "text": "in quotes um i' still uh quotes are going to be",
    "start": "917839",
    "end": "925399"
  },
  {
    "text": "like a little bit annoying to parse out so let's just do",
    "start": "925399",
    "end": "930600"
  },
  {
    "text": "bullets and okay cool um oh yeah you didn't see",
    "start": "931079",
    "end": "939600"
  },
  {
    "text": "there okay so that's so I don't have the stop token here so it kind of like runs on and creates two blocks which my stop",
    "start": "939600",
    "end": "945120"
  },
  {
    "text": "token it'll save that so let's commit this now if I pull down this new",
    "start": "945120",
    "end": "953519"
  },
  {
    "text": "thing cool I get back some bullets um so what I'm going to do now is I want to",
    "start": "954839",
    "end": "963680"
  },
  {
    "text": "basically write some output parser or some parsing logic that's going to split this into a list of questions um so",
    "start": "963680",
    "end": "971720"
  },
  {
    "text": "let's do",
    "start": "971720",
    "end": "977079"
  },
  {
    "text": "string um I can first I want to uh let's",
    "start": "977079",
    "end": "983519"
  },
  {
    "text": "get rid of this so let's do text text",
    "start": "983519",
    "end": "990519"
  },
  {
    "text": "strip um",
    "start": "991160",
    "end": "997040"
  },
  {
    "text": "questions um let's do questions",
    "start": "997040",
    "end": "1002880"
  },
  {
    "text": "equals uh text.",
    "start": "1002880",
    "end": "1008360"
  },
  {
    "text": "split new line Dash",
    "start": "1008360",
    "end": "1015279"
  },
  {
    "text": "space return question",
    "start": "1015279",
    "end": "1020480"
  },
  {
    "text": "let's add this up here let's now type this in to",
    "start": "1022319",
    "end": "1029480"
  },
  {
    "text": "split let's run this okay so it's getting one so we can",
    "start": "1030120",
    "end": "1036079"
  },
  {
    "text": "just do um it's getting one like weird thing there so we can just",
    "start": "1036079",
    "end": "1043280"
  },
  {
    "text": "do return Q for Q questions if",
    "start": "1043280",
    "end": "1050400"
  },
  {
    "text": "Q I think this actually works cool so now I've got a list of",
    "start": "1050440",
    "end": "1056360"
  },
  {
    "text": "questions um let me just strip that andri that I",
    "start": "1056360",
    "end": "1065120"
  },
  {
    "text": "will get rid of the the new line that I saw there okay so this get a list of",
    "start": "1065120",
    "end": "1070480"
  },
  {
    "text": "questions now what I want to do is I basically want to uh uh create this okay",
    "start": "1070480",
    "end": "1078600"
  },
  {
    "text": "so I have this Q gen this returns a list of questions one thing that I could do is basically just Q gen",
    "start": "1078600",
    "end": "1088640"
  },
  {
    "text": "um Q gen retriever map so what's going on here",
    "start": "1088679",
    "end": "1096200"
  },
  {
    "text": "and and actually let me let me combine this into retriever chain equals Q gen this",
    "start": "1096200",
    "end": "1106880"
  },
  {
    "text": "is going to take in uh uh question return a list I'm then going to do retriever do",
    "start": "1106880",
    "end": "1112919"
  },
  {
    "text": "map this is going to take each element of the list pass it to the retriever so it's going to take a question pass it toet take second question pass it to the",
    "start": "1112919",
    "end": "1119880"
  },
  {
    "text": "retriever then I need something to flatten this list of documents or format",
    "start": "1119880",
    "end": "1124919"
  },
  {
    "text": "docs so I have this here um what I'm going to do is I'm now going to create",
    "start": "1124919",
    "end": "1132760"
  },
  {
    "text": "version that is format list Docs",
    "start": "1132760",
    "end": "1139000"
  },
  {
    "text": "um this is going to be a sequence of sequence",
    "start": "1139000",
    "end": "1144120"
  },
  {
    "text": "is because it's getting here it's each element that retriever returns is a list",
    "start": "1144120",
    "end": "1149280"
  },
  {
    "text": "so it's going to get back a list of lists um and then uh I'll do doc",
    "start": "1149280",
    "end": "1156120"
  },
  {
    "text": "lists for docs",
    "start": "1156120",
    "end": "1161520"
  },
  {
    "text": "in Doc lists that",
    "start": "1162760",
    "end": "1169200"
  },
  {
    "text": "that um so there's going to be some weird things because of the index",
    "start": "1169200",
    "end": "1175480"
  },
  {
    "text": "I um so what I'm just going to do is I equals [Music]",
    "start": "1175480",
    "end": "1181200"
  },
  {
    "text": "zero for docs for Doc and",
    "start": "1181200",
    "end": "1186960"
  },
  {
    "text": "docs I plus equals",
    "start": "1186960",
    "end": "1191080"
  },
  {
    "text": "one cool um and then let's do format",
    "start": "1192039",
    "end": "1197200"
  },
  {
    "text": "plus Docs this is a retriever chain let's try this let's see what happens so this should get back a really long",
    "start": "1197200",
    "end": "1203679"
  },
  {
    "text": "string because it's going to have all the docs concatenated so yeah we get back this really long string cool we're",
    "start": "1203679",
    "end": "1210280"
  },
  {
    "text": "using CLA 2 because it has a really long context window so this is still a really long all right so we're getting a lot of",
    "start": "1210280",
    "end": "1216159"
  },
  {
    "text": "context back maybe this is good maybe this is bad this is why we have evaluations um so let now we can do",
    "start": "1216159",
    "end": "1223440"
  },
  {
    "text": "retriever chain um and I don't actually so so this plucks out the question but I don't even",
    "start": "1223440",
    "end": "1229600"
  },
  {
    "text": "need to pluck out the check question I can just do like",
    "start": "1229600",
    "end": "1234919"
  },
  {
    "text": "this um and let's wrap",
    "start": "1234919",
    "end": "1240080"
  },
  {
    "text": "this and so this is just some nice config to make it show up nicely in in traces um but I",
    "start": "1240080",
    "end": "1248440"
  },
  {
    "text": "can just do this this is going to take everything pass it to retriever chain retriever chain expects uh a dictionary",
    "start": "1248440",
    "end": "1254600"
  },
  {
    "text": "with a key question so that's perfect um cool okay so this is my new modified",
    "start": "1254600",
    "end": "1260080"
  },
  {
    "text": "chain let's try it out on this",
    "start": "1260080",
    "end": "1264679"
  },
  {
    "text": "question if we're curious about what's going on in the hood we should be able to see things in",
    "start": "1269480",
    "end": "1279400"
  },
  {
    "text": "our uh we probably haven't set tracing equals to True okay so let's actually",
    "start": "1281600",
    "end": "1288760"
  },
  {
    "text": "do that before we go any further because that'll be very helpful",
    "start": "1288760",
    "end": "1296158"
  },
  {
    "text": "Imports um if I want to have things logged",
    "start": "1299600",
    "end": "1307919"
  },
  {
    "text": "here I can go to setup I need to set this equals to",
    "start": "1307919",
    "end": "1314360"
  },
  {
    "text": "true",
    "start": "1317039",
    "end": "1320039"
  },
  {
    "text": "I wonder if this will work if I have to restart the notebook if I have to restart the notebook then I will not do",
    "start": "1323000",
    "end": "1328039"
  },
  {
    "text": "that um and I think I may actually have to",
    "start": "1328039",
    "end": "1334039"
  },
  {
    "text": "um yeah okay so it's not working the the the tracing isn't working because I",
    "start": "1334600",
    "end": "1339880"
  },
  {
    "text": "haven't uh set the environment variable before that's fine um would have been good to do so I could see what's going",
    "start": "1339880",
    "end": "1345640"
  },
  {
    "text": "on but it looks like the response that it's giving is is it's reasonable",
    "start": "1345640",
    "end": "1352120"
  },
  {
    "text": "um actually I think it would be really cool to see what's going on so let me pause the notebook or let me pause the",
    "start": "1352520",
    "end": "1357919"
  },
  {
    "text": "video restart the notebook with that environment variable set and then we can see what's going on under the hood because I think it's going to be really",
    "start": "1357919",
    "end": "1365039"
  },
  {
    "text": "cool okay so it was actually uh running before it just wasn't logging to the",
    "start": "1365039",
    "end": "1370360"
  },
  {
    "text": "project I expected it to be logging to because I had some other environment variables set from before so I changed",
    "start": "1370360",
    "end": "1376000"
  },
  {
    "text": "it up I'm now logging to uh dedicated project for this multiquery eiles if we click into what was just logged from",
    "start": "1376000",
    "end": "1382840"
  },
  {
    "text": "this run um we can see a few things that are going on um so we can see that",
    "start": "1382840",
    "end": "1388400"
  },
  {
    "text": "there's this step which is basically going to be the retrieval step um that has this format docs thing and then",
    "start": "1388400",
    "end": "1393720"
  },
  {
    "text": "there's this chain that has generate response and this is where it's generating the response so this is the retrieval this is the response the",
    "start": "1393720",
    "end": "1400440"
  },
  {
    "text": "retrieval is using this multiquery thing so if we look in here this is the prompt that we had um it's taking in the",
    "start": "1400440",
    "end": "1407360"
  },
  {
    "text": "question and generating uh uh two sub questions to ask we're then parsing that",
    "start": "1407360",
    "end": "1412919"
  },
  {
    "text": "and then there's two calls to a retriever here so for in each of these we can see basically the documents that",
    "start": "1412919",
    "end": "1418320"
  },
  {
    "text": "are returned I'm actually curious whether these are the same or not so how-to cookbook linkchain expression",
    "start": "1418320",
    "end": "1423520"
  },
  {
    "text": "language introduction how tobook linkchain exression language introduction so these",
    "start": "1423520",
    "end": "1428840"
  },
  {
    "text": "are actually returning the same things um one thing we could and should do is D duplicate these in format list of",
    "start": "1428840",
    "end": "1436039"
  },
  {
    "text": "docs um I'm debating whether it's worth doing that live or not uh probably will'll",
    "start": "1436039",
    "end": "1442520"
  },
  {
    "text": "leave that as an exercise left to the reader um but then that's all pred into this anthropic model um and so you can",
    "start": "1442520",
    "end": "1448960"
  },
  {
    "text": "see the very long system prompt here because it has lots and lots of context um and then it returns uh this actually",
    "start": "1448960",
    "end": "1457039"
  },
  {
    "text": "I I probably will um spend some time D duplicating it so we can see here um",
    "start": "1457039",
    "end": "1462640"
  },
  {
    "text": "that uh okay so",
    "start": "1462640",
    "end": "1469120"
  },
  {
    "text": "I think what I'm going to do is I'm going to add this",
    "start": "1469120",
    "end": "1475840"
  },
  {
    "text": "um for do",
    "start": "1475840",
    "end": "1481200"
  },
  {
    "text": "hashes um I'm not could be a set to be faster",
    "start": "1481200",
    "end": "1487200"
  },
  {
    "text": "but not too worried um I'm just going to Hash the content for now I could hash everything actually",
    "start": "1487200",
    "end": "1494320"
  },
  {
    "text": "I'm I have the doc string actually wait yeah this is going to be uh way easier",
    "start": "1494320",
    "end": "1500760"
  },
  {
    "text": "than I thought um if doc string not",
    "start": "1500760",
    "end": "1508080"
  },
  {
    "text": "in formatted docs then I'm going to pend increase ey okay so now if I rerun",
    "start": "1508840",
    "end": "1518200"
  },
  {
    "text": "this hopefully I shouldn't change the answer too much it actually should just be completely D duplicating um",
    "start": "1518960",
    "end": "1526080"
  },
  {
    "text": "things and I can peek out what's going on under the hood this again runs in real time so I can kind of see what's",
    "start": "1526080",
    "end": "1531760"
  },
  {
    "text": "going on um still pending a",
    "start": "1531760",
    "end": "1537200"
  },
  {
    "text": "bunch all right there we go I was just debating whether to pause the video or not so good thing that it went through",
    "start": "1541440",
    "end": "1547480"
  },
  {
    "text": "um so now if we look at what's going on we can see that the retriever oh okay so it's changing it up it's actually",
    "start": "1547480",
    "end": "1552679"
  },
  {
    "text": "generating uh three sub questions um so it's generating uh yeah three sub",
    "start": "1552679",
    "end": "1558559"
  },
  {
    "text": "questions now I don't have temperature set to zero so we are seeing some Randomness this is a cookbook and then in cookbook",
    "start": "1558559",
    "end": "1565520"
  },
  {
    "text": "introduction how two L expression language cookbook introduction how two L expression language okay so it's getting",
    "start": "1565520",
    "end": "1571159"
  },
  {
    "text": "the same docs if we now look at format list of docs um this is should be",
    "start": "1571159",
    "end": "1577399"
  },
  {
    "text": "shorter than uh let's make this wider what we can actually do to see if it's shorter or not is we can look at some",
    "start": "1577399",
    "end": "1584240"
  },
  {
    "text": "stats so in this final thing um if we click into here um we can look at",
    "start": "1584240",
    "end": "1593320"
  },
  {
    "text": "the uh input um and we can see this input here we can look at some of the",
    "start": "1593320",
    "end": "1601720"
  },
  {
    "text": "things on the side so this is right about 10,000 total tokens if we go back",
    "start": "1601720",
    "end": "1606880"
  },
  {
    "text": "to the previous one and we look at everything this is at about 6,000 total",
    "start": "1606880",
    "end": "1616240"
  },
  {
    "text": "tokens y this should be duplicating why is it not",
    "start": "1616240",
    "end": "1622640"
  },
  {
    "text": "duplicating um it is not duplicating because we have the i in here okay so",
    "start": "1625960",
    "end": "1634679"
  },
  {
    "text": "what I'm going to do real fast is just",
    "start": "1634679",
    "end": "1640320"
  },
  {
    "text": "look at okay so I do need this then I guess because I have the ey in there actually",
    "start": "1640320",
    "end": "1647320"
  },
  {
    "text": "um yeah let's change this up let's change",
    "start": "1647320",
    "end": "1652679"
  },
  {
    "text": "this up a little bit let's remove this for now and this for now and then",
    "start": "1652679",
    "end": "1660000"
  },
  {
    "text": "going to",
    "start": "1660000",
    "end": "1662480"
  },
  {
    "text": "do something",
    "start": "1666360",
    "end": "1670960"
  },
  {
    "text": "like",
    "start": "1676519",
    "end": "1679519"
  },
  {
    "text": "this thing for I and",
    "start": "1685880",
    "end": "1691880"
  },
  {
    "text": "enumerate form a docs remove this remove",
    "start": "1691880",
    "end": "1698240"
  },
  {
    "text": "this um so now I don't even need ey so basically the I was causing things to be",
    "start": "1698240",
    "end": "1703720"
  },
  {
    "text": "different that was the only difference so now I can just format them you duplicate them along the way and then",
    "start": "1703720",
    "end": "1709519"
  },
  {
    "text": "add in the I later on so if we do this we do this we do this we do",
    "start": "1709519",
    "end": "1715679"
  },
  {
    "text": "this now this should result in fewer tokens so let's take a",
    "start": "1715679",
    "end": "1722440"
  },
  {
    "text": "look it's still pending it'll take a little",
    "start": "1722440",
    "end": "1727440"
  },
  {
    "text": "bit awkward pause in the video there we go and if we take a look at this trade",
    "start": "1730159",
    "end": "1739320"
  },
  {
    "text": "we can see here it only uses 3,500 tokens yay we've successfully duplicated",
    "start": "1739320",
    "end": "1746039"
  },
  {
    "text": "uh the documents so that's going to save us some good tokens um as we as we start using",
    "start": "1746039",
    "end": "1752519"
  },
  {
    "text": "this all right now we're going to run it over the whole data set and get some",
    "start": "1753120",
    "end": "1758720"
  },
  {
    "text": "evaluations so let's copy this code we'll put this here let's copy this",
    "start": "1758720",
    "end": "1765519"
  },
  {
    "text": "code we'll put this here and this is running on the data set and we're getting some progress of what's going on",
    "start": "1765519",
    "end": "1772679"
  },
  {
    "text": "we can take a look at it in Lang Smith and we can see that we're running things",
    "start": "1772679",
    "end": "1778080"
  },
  {
    "text": "this might actually cause some errors because I have some rate limits on anthropic that are not super",
    "start": "1778080",
    "end": "1785200"
  },
  {
    "text": "high regardless this is going to take a while to run so I'm going to pause the",
    "start": "1785200",
    "end": "1790519"
  },
  {
    "text": "video If I make any changes I will restart the video and say what I did but if not I'll restart it when this is",
    "start": "1790519",
    "end": "1795640"
  },
  {
    "text": "finished running because this is going to take a little bit and I don't want to sit here for a",
    "start": "1795640",
    "end": "1800720"
  },
  {
    "text": "while all right so we're back if we look at our notebook and finished running we",
    "start": "1800720",
    "end": "1806000"
  },
  {
    "text": "get some nice um metrics from our uh",
    "start": "1806000",
    "end": "1811840"
  },
  {
    "text": "uh evaluators that we're using so we calculate the embedding cosine distance",
    "start": "1811840",
    "end": "1816960"
  },
  {
    "text": "the the accuracy score that's uses in llm um",
    "start": "1816960",
    "end": "1822000"
  },
  {
    "text": "and then a faithfulness score as well um and so if we go into here now we",
    "start": "1822000",
    "end": "1828000"
  },
  {
    "text": "can see that we have one test run we can click into it and we have a uh we have a bunch of",
    "start": "1828000",
    "end": "1836120"
  },
  {
    "text": "data points we can look at it what class type is returned by initialized agent the right answer is",
    "start": "1836120",
    "end": "1841440"
  },
  {
    "text": "the agent executor class this gives a more lengthy explanation but it still says the agent",
    "start": "1841440",
    "end": "1846600"
  },
  {
    "text": "executor class we can see that nice it gives a string score of one so this is",
    "start": "1846600",
    "end": "1852679"
  },
  {
    "text": "using the llm and it's recognizing that this is the same as this technically you know it's not exactly the same that's",
    "start": "1852679",
    "end": "1858000"
  },
  {
    "text": "why we have to use an LM the eming coine distance is um I think that's seems to",
    "start": "1858000",
    "end": "1865600"
  },
  {
    "text": "be yeah okay so that's higher than usual so that's not great so so the main metric that we look at here is this",
    "start": "1865600",
    "end": "1871279"
  },
  {
    "text": "score string accuracy one um we can do some filters so we can",
    "start": "1871279",
    "end": "1877720"
  },
  {
    "text": "look for so let's add uh less than5 so these are ones that are",
    "start": "1877720",
    "end": "1883960"
  },
  {
    "text": "actually let's even make this worse less than3 let's try to find ones that are really bad",
    "start": "1883960",
    "end": "1889158"
  },
  {
    "text": "what does on tool start mean so this is a method that is defined on classes um",
    "start": "1889240",
    "end": "1895639"
  },
  {
    "text": "uh that works with callbacks um nothing in the docs that",
    "start": "1895639",
    "end": "1900679"
  },
  {
    "text": "that we could find if we want to figure out like so this gets a bad answer because it doesn't give the correct",
    "start": "1900679",
    "end": "1906279"
  },
  {
    "text": "answer um at least it's not making up an answer um so we should uh uh you know we",
    "start": "1906279",
    "end": "1913039"
  },
  {
    "text": "we can add other metrics to calculate whether it makes up something or whether it just I think that actually might be what faithfulness is um one thing we can",
    "start": "1913039",
    "end": "1920600"
  },
  {
    "text": "also do is if we click on this run um we can open the run and we can see what's",
    "start": "1920600",
    "end": "1925799"
  },
  {
    "text": "going on so we can see everything that's going under here we can see that we have this multiquery thing that generates like what is the meaning of all to start",
    "start": "1925799",
    "end": "1931919"
  },
  {
    "text": "can you explain the definition of all tool how would you define the term on tool start we can then see the retrievers that are used um these are",
    "start": "1931919",
    "end": "1939639"
  },
  {
    "text": "returning slightly different things Okay cool so we're getting um some differences we can then see the model",
    "start": "1939639",
    "end": "1945120"
  },
  {
    "text": "that's being used um and uh the output there if we go back overall we can see",
    "start": "1945120",
    "end": "1952639"
  },
  {
    "text": "some overall metrics so we've got a faithfulness of77 and an accuracy of 63",
    "start": "1952639",
    "end": "1958639"
  },
  {
    "text": "if we compare that to the original public version of the test",
    "start": "1958639",
    "end": "1963760"
  },
  {
    "text": "set we can see that accuracy um uh I don't think we have we don't we didn't",
    "start": "1963760",
    "end": "1969080"
  },
  {
    "text": "run faithful enough on this one so if we look across accuracy this is actually crushing all other accuracy metrics um",
    "start": "1969080",
    "end": "1976720"
  },
  {
    "text": "point so 63 that's higher than the best one which was the 61 so 63 is you know",
    "start": "1976720",
    "end": "1984559"
  },
  {
    "text": "and and I I barely did anything here I think this actually speaks a lot to the power of the multiquery or this query",
    "start": "1984559",
    "end": "1989880"
  },
  {
    "text": "expansion thing it's really really powerful um there's a let me try to find uh open",
    "start": "1989880",
    "end": "1996760"
  },
  {
    "text": "AI retrieval Dev day so when they",
    "start": "1996760",
    "end": "2004039"
  },
  {
    "text": "talk I'm looking for one image in particular this one yeah okay so if you look on",
    "start": "2004039",
    "end": "2010159"
  },
  {
    "text": "this um if you look at this image query expansion they have this jumping up the",
    "start": "2010159",
    "end": "2017320"
  },
  {
    "text": "Gap let me close my messages there um if you look at this it jumps up it it's",
    "start": "2017320",
    "end": "2023919"
  },
  {
    "text": "it's one of the things that worked and so I think query expansion is really really powerful um so yeah hopefully that uh that helps",
    "start": "2023919",
    "end": "2033320"
  },
  {
    "text": "um show how you can evaluate new retrieval methods um um we are going to",
    "start": "2033320",
    "end": "2038919"
  },
  {
    "text": "add more data sets to evaluate on and we're also going to make the public benchmarks actually show more",
    "start": "2038919",
    "end": "2044919"
  },
  {
    "text": "comprehensive leaderboard that you can easily explore because right now it's a little tough to know what's going on if you look at this we have a corresponding",
    "start": "2044919",
    "end": "2052358"
  },
  {
    "text": "blog post I'll link to that in the YouTube um description I'll also link to",
    "start": "2052359",
    "end": "2057839"
  },
  {
    "text": "uh I'll link to that I'll link to the The Notebook here so that you can run it yourself I'll link to this public data",
    "start": "2057839",
    "end": "2063440"
  },
  {
    "text": "set um yeah that's that's pretty much it um really looking forward to continuing",
    "start": "2063440",
    "end": "2070079"
  },
  {
    "text": "to Benchmark things as well as uh to to see what you guys come up with um you",
    "start": "2070079",
    "end": "2076320"
  },
  {
    "text": "know there's lots of cool ideas out there ideas are only as cool as you can Benchmark them so let's do",
    "start": "2076320",
    "end": "2081800"
  },
  {
    "text": "that",
    "start": "2081800",
    "end": "2084800"
  }
]