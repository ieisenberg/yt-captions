[
  {
    "text": "right so in the previous",
    "start": "80",
    "end": "2000"
  },
  {
    "text": "video we looked at how we can build an",
    "start": "2000",
    "end": "4240"
  },
  {
    "text": "operating system that can switch between",
    "start": "4240",
    "end": "5680"
  },
  {
    "text": "multiple processes",
    "start": "5680",
    "end": "7279"
  },
  {
    "text": "to create the illusion that they're",
    "start": "7279",
    "end": "8720"
  },
  {
    "text": "running at the same time and we saw with",
    "start": "8720",
    "end": "10719"
  },
  {
    "text": "the demo we got here we had this model",
    "start": "10719",
    "end": "12880"
  },
  {
    "text": "that enabled us to conceive how we had",
    "start": "12880",
    "end": "14880"
  },
  {
    "text": "different processes running at the same",
    "start": "14880",
    "end": "16320"
  },
  {
    "text": "time so we always have one that's",
    "start": "16320",
    "end": "17680"
  },
  {
    "text": "running",
    "start": "17680",
    "end": "18560"
  },
  {
    "text": "and we can have other processes other",
    "start": "18560",
    "end": "20160"
  },
  {
    "text": "programs that are either blocked waiting",
    "start": "20160",
    "end": "21840"
  },
  {
    "text": "for something to happen from the",
    "start": "21840",
    "end": "22880"
  },
  {
    "text": "operating system say waiting for user",
    "start": "22880",
    "end": "24720"
  },
  {
    "text": "input or network io or disk io or",
    "start": "24720",
    "end": "27680"
  },
  {
    "text": "something and we can have others that",
    "start": "27680",
    "end": "29359"
  },
  {
    "text": "are ready to run but are just waiting if",
    "start": "29359",
    "end": "31279"
  },
  {
    "text": "you watch the other video we can see",
    "start": "31279",
    "end": "32480"
  },
  {
    "text": "that we can then switch the ones that",
    "start": "32480",
    "end": "34000"
  },
  {
    "text": "are running to be runnable and so on so",
    "start": "34000",
    "end": "36640"
  },
  {
    "text": "that we can then get another one running",
    "start": "36640",
    "end": "38480"
  },
  {
    "text": "if we do that fast enough we do it say",
    "start": "38480",
    "end": "40640"
  },
  {
    "text": "every 200th of a second we can give the",
    "start": "40640",
    "end": "42800"
  },
  {
    "text": "illusion that these processes",
    "start": "42800",
    "end": "45280"
  },
  {
    "text": "are all running at the same time and",
    "start": "45280",
    "end": "47920"
  },
  {
    "text": "occasionally they become unblocked and",
    "start": "47920",
    "end": "49280"
  },
  {
    "text": "they can then be ready to be runnable",
    "start": "49280",
    "end": "51360"
  },
  {
    "text": "until one of them finishes",
    "start": "51360",
    "end": "54480"
  },
  {
    "text": "i noticed somebody put a comment on a",
    "start": "55840",
    "end": "57680"
  },
  {
    "text": "previous video saying would it be",
    "start": "57680",
    "end": "59280"
  },
  {
    "text": "possible to go directly from create to",
    "start": "59280",
    "end": "61359"
  },
  {
    "text": "runnable",
    "start": "61359",
    "end": "62480"
  },
  {
    "text": "um yes and in fact that's probably what",
    "start": "62480",
    "end": "64158"
  },
  {
    "text": "you would do if you look at the source",
    "start": "64159",
    "end": "65360"
  },
  {
    "text": "code for unix say then yeah when the",
    "start": "65360",
    "end": "67600"
  },
  {
    "text": "press is created it does end up being",
    "start": "67600",
    "end": "68960"
  },
  {
    "text": "runnable but it's put into position so",
    "start": "68960",
    "end": "70560"
  },
  {
    "text": "the next time you context switch which",
    "start": "70560",
    "end": "72400"
  },
  {
    "text": "is what we're going to look at today it",
    "start": "72400",
    "end": "74159"
  },
  {
    "text": "will um",
    "start": "74159",
    "end": "75680"
  },
  {
    "text": "become running and so on we said when we",
    "start": "75680",
    "end": "77680"
  },
  {
    "text": "looked at this video that there's three",
    "start": "77680",
    "end": "78960"
  },
  {
    "text": "things we need we need this model so we",
    "start": "78960",
    "end": "80960"
  },
  {
    "text": "know how we're going to switch them and",
    "start": "80960",
    "end": "82320"
  },
  {
    "text": "which ones we can switch and so on we",
    "start": "82320",
    "end": "84000"
  },
  {
    "text": "need a way of knowing which process",
    "start": "84000",
    "end": "85920"
  },
  {
    "text": "we're going to move from runnable to",
    "start": "85920",
    "end": "87520"
  },
  {
    "text": "running at which point in time and the",
    "start": "87520",
    "end": "89520"
  },
  {
    "text": "final thing we need is some physical way",
    "start": "89520",
    "end": "92079"
  },
  {
    "text": "that we can make the cpu stop running",
    "start": "92079",
    "end": "93840"
  },
  {
    "text": "one program",
    "start": "93840",
    "end": "95439"
  },
  {
    "text": "and then start",
    "start": "95439",
    "end": "96960"
  },
  {
    "text": "running the other that's what we're",
    "start": "96960",
    "end": "98159"
  },
  {
    "text": "going to look at today it's called",
    "start": "98159",
    "end": "99119"
  },
  {
    "text": "what's called context switching because",
    "start": "99119",
    "end": "101200"
  },
  {
    "text": "we're switching from the context which",
    "start": "101200",
    "end": "102640"
  },
  {
    "text": "one program's running to switching to",
    "start": "102640",
    "end": "104880"
  },
  {
    "text": "the context that another program is",
    "start": "104880",
    "end": "107040"
  },
  {
    "text": "running so to understand how context",
    "start": "107040",
    "end": "108960"
  },
  {
    "text": "switching works we need to think about",
    "start": "108960",
    "end": "110799"
  },
  {
    "text": "how our cpu executes program so let's",
    "start": "110799",
    "end": "112640"
  },
  {
    "text": "actually have a look at a very simple",
    "start": "112640",
    "end": "114399"
  },
  {
    "text": "program i'm going to write it using our",
    "start": "114399",
    "end": "116000"
  },
  {
    "text": "machine code because the context",
    "start": "116000",
    "end": "117360"
  },
  {
    "text": "switching does happen at the machine",
    "start": "117360",
    "end": "119360"
  },
  {
    "text": "code level doesn't happen higher up as",
    "start": "119360",
    "end": "121759"
  },
  {
    "text": "we use a compil",
    "start": "121759",
    "end": "123360"
  },
  {
    "text": "higher level language so let's think",
    "start": "123360",
    "end": "125200"
  },
  {
    "text": "about a very simple program",
    "start": "125200",
    "end": "127200"
  },
  {
    "text": "that is going to",
    "start": "127200",
    "end": "129119"
  },
  {
    "text": "load in a string",
    "start": "129119",
    "end": "130959"
  },
  {
    "text": "i'm going to use our machine code for",
    "start": "130959",
    "end": "132400"
  },
  {
    "text": "this example",
    "start": "132400",
    "end": "133680"
  },
  {
    "text": "so we're going to load in the address of",
    "start": "133680",
    "end": "136000"
  },
  {
    "text": "a string into r0 so let's call this",
    "start": "136000",
    "end": "138800"
  },
  {
    "text": "h string",
    "start": "138800",
    "end": "140319"
  },
  {
    "text": "and then we're going to print it out and",
    "start": "140319",
    "end": "143200"
  },
  {
    "text": "i use a development environment for",
    "start": "143200",
    "end": "145440"
  },
  {
    "text": "developing our machine code which is",
    "start": "145440",
    "end": "147200"
  },
  {
    "text": "written at the university of manchester",
    "start": "147200",
    "end": "148720"
  },
  {
    "text": "which allows me to call the equivalent",
    "start": "148720",
    "end": "150720"
  },
  {
    "text": "of the operating system using sy3 to",
    "start": "150720",
    "end": "153120"
  },
  {
    "text": "print something out so that's going to",
    "start": "153120",
    "end": "154720"
  },
  {
    "text": "print something out and we'll define h",
    "start": "154720",
    "end": "156879"
  },
  {
    "text": "string up here",
    "start": "156879",
    "end": "158959"
  },
  {
    "text": "to have a",
    "start": "158959",
    "end": "160800"
  },
  {
    "text": "hello world in it and then let's do",
    "start": "160800",
    "end": "162720"
  },
  {
    "text": "something else let's print out all the",
    "start": "162720",
    "end": "163840"
  },
  {
    "text": "numbers from 1 to 10. so we'll move into",
    "start": "163840",
    "end": "166480"
  },
  {
    "text": "r1 the value of 0",
    "start": "166480",
    "end": "169440"
  },
  {
    "text": "and then we'll start a loop we're going",
    "start": "169440",
    "end": "171280"
  },
  {
    "text": "to add r1 comma r1 comma one we shall",
    "start": "171280",
    "end": "175440"
  },
  {
    "text": "move that into the register r0 and then",
    "start": "175440",
    "end": "178239"
  },
  {
    "text": "we'll call another pseudo operating",
    "start": "178239",
    "end": "180239"
  },
  {
    "text": "system function to print out an integer",
    "start": "180239",
    "end": "182400"
  },
  {
    "text": "so we're adding one to the value we put",
    "start": "182400",
    "end": "184480"
  },
  {
    "text": "in there so it goes from zero to one",
    "start": "184480",
    "end": "186159"
  },
  {
    "text": "because we've added one onto it we're",
    "start": "186159",
    "end": "187440"
  },
  {
    "text": "moving to another register",
    "start": "187440",
    "end": "189200"
  },
  {
    "text": "and then we call the operating system",
    "start": "189200",
    "end": "190480"
  },
  {
    "text": "printed out",
    "start": "190480",
    "end": "191599"
  },
  {
    "text": "we'll then compare our value in r1 with",
    "start": "191599",
    "end": "195280"
  },
  {
    "text": "10",
    "start": "195280",
    "end": "196480"
  },
  {
    "text": "and we'll branch if it's less than 10.",
    "start": "196480",
    "end": "200080"
  },
  {
    "text": "so a branch if it's less than 10",
    "start": "200080",
    "end": "202319"
  },
  {
    "text": "to loop",
    "start": "202319",
    "end": "203599"
  },
  {
    "text": "and then we'll print out something else",
    "start": "203599",
    "end": "206239"
  },
  {
    "text": "here so again we set r0 to point to our",
    "start": "206239",
    "end": "208560"
  },
  {
    "text": "string and we'll call this i string",
    "start": "208560",
    "end": "211040"
  },
  {
    "text": "if you want to have a better name",
    "start": "211040",
    "end": "213200"
  },
  {
    "text": "and we'll call out so i3 dot and that'll",
    "start": "213200",
    "end": "216159"
  },
  {
    "text": "be the rest of the program so we've got",
    "start": "216159",
    "end": "218000"
  },
  {
    "text": "a a simple",
    "start": "218000",
    "end": "220000"
  },
  {
    "text": "arm machine code program here we'll just",
    "start": "220000",
    "end": "221840"
  },
  {
    "text": "use arm for the example it could do",
    "start": "221840",
    "end": "223680"
  },
  {
    "text": "exactly the same while the x86 amd 64",
    "start": "223680",
    "end": "226560"
  },
  {
    "text": "chip we could do exactly the same on the",
    "start": "226560",
    "end": "228400"
  },
  {
    "text": "6 8 000 chip a 6 502 it doesn't matter",
    "start": "228400",
    "end": "230879"
  },
  {
    "text": "we're just using our example so we've",
    "start": "230879",
    "end": "233040"
  },
  {
    "text": "talked about this before on computer",
    "start": "233040",
    "end": "234799"
  },
  {
    "text": "file but the way this program works is",
    "start": "234799",
    "end": "236159"
  },
  {
    "text": "every time we execute instruction",
    "start": "236159",
    "end": "238000"
  },
  {
    "text": "somewhere inside the cpu this one's",
    "start": "238000",
    "end": "240000"
  },
  {
    "text": "probably even worse to see",
    "start": "240000",
    "end": "241680"
  },
  {
    "text": "we have a set of registers r0 r1",
    "start": "241680",
    "end": "245840"
  },
  {
    "text": "r2 and so on",
    "start": "245840",
    "end": "248000"
  },
  {
    "text": "and these can just store a temporary",
    "start": "248000",
    "end": "250640"
  },
  {
    "text": "value so as we run through the program",
    "start": "250640",
    "end": "252560"
  },
  {
    "text": "this one says put the address of h",
    "start": "252560",
    "end": "254480"
  },
  {
    "text": "string in our zero so we work out what",
    "start": "254480",
    "end": "257040"
  },
  {
    "text": "it is and we write a value in there then",
    "start": "257040",
    "end": "258959"
  },
  {
    "text": "we call this and this calls off into our",
    "start": "258959",
    "end": "261040"
  },
  {
    "text": "pseudo-operating system and we'll",
    "start": "261040",
    "end": "263199"
  },
  {
    "text": "print out whatever it is that it's doing",
    "start": "263199",
    "end": "265040"
  },
  {
    "text": "so it'll use that value and probably",
    "start": "265040",
    "end": "266479"
  },
  {
    "text": "manipulate the registers we then come to",
    "start": "266479",
    "end": "268320"
  },
  {
    "text": "the next line which moves the value of",
    "start": "268320",
    "end": "270639"
  },
  {
    "text": "zero into there and then we come to the",
    "start": "270639",
    "end": "272560"
  },
  {
    "text": "next line which gets the value out of",
    "start": "272560",
    "end": "274080"
  },
  {
    "text": "the register r1 which is",
    "start": "274080",
    "end": "276639"
  },
  {
    "text": "zero adds one onto it which is uh one",
    "start": "276639",
    "end": "279840"
  },
  {
    "text": "yep and then stores the result back in",
    "start": "279840",
    "end": "282720"
  },
  {
    "text": "r1 we now have the next line which gets",
    "start": "282720",
    "end": "284479"
  },
  {
    "text": "the value r1 which is one and stores it",
    "start": "284479",
    "end": "288080"
  },
  {
    "text": "in r0 and moves it into r0 we then call",
    "start": "288080",
    "end": "290639"
  },
  {
    "text": "sy4 which prints it out and we come here",
    "start": "290639",
    "end": "292960"
  },
  {
    "text": "we compare r1 which is",
    "start": "292960",
    "end": "295280"
  },
  {
    "text": "one with 10 it's less than so we go",
    "start": "295280",
    "end": "297840"
  },
  {
    "text": "around the loop and then we do the same",
    "start": "297840",
    "end": "299440"
  },
  {
    "text": "we get the value of r1 which is one we",
    "start": "299440",
    "end": "301360"
  },
  {
    "text": "add one to it which is two and we update",
    "start": "301360",
    "end": "304160"
  },
  {
    "text": "the value so we've now got two in r1",
    "start": "304160",
    "end": "307039"
  },
  {
    "text": "so that's the model that our cpu runs",
    "start": "307039",
    "end": "308960"
  },
  {
    "text": "the program and to understand how",
    "start": "308960",
    "end": "311680"
  },
  {
    "text": "context switching is",
    "start": "311680",
    "end": "313600"
  },
  {
    "text": "we need to remember that this",
    "start": "313600",
    "end": "316240"
  },
  {
    "text": "instruction",
    "start": "316240",
    "end": "317520"
  },
  {
    "text": "only ever looks at the value of r1 we're",
    "start": "317520",
    "end": "319919"
  },
  {
    "text": "interested in this",
    "start": "319919",
    "end": "321520"
  },
  {
    "text": "yellow instruction here for it to work",
    "start": "321520",
    "end": "324400"
  },
  {
    "text": "the only thing it needs is the value",
    "start": "324400",
    "end": "326160"
  },
  {
    "text": "that's currently in r1 it doesn't care",
    "start": "326160",
    "end": "328560"
  },
  {
    "text": "how that value got there it could have",
    "start": "328560",
    "end": "330560"
  },
  {
    "text": "got there because we've moved",
    "start": "330560",
    "end": "332479"
  },
  {
    "text": "zero into it here which is what happens",
    "start": "332479",
    "end": "333919"
  },
  {
    "text": "the first time or it could have got",
    "start": "333919",
    "end": "335840"
  },
  {
    "text": "there because we've added one into it",
    "start": "335840",
    "end": "337600"
  },
  {
    "text": "previously it doesn't make any",
    "start": "337600",
    "end": "339440"
  },
  {
    "text": "difference to the operation of that",
    "start": "339440",
    "end": "340880"
  },
  {
    "text": "instruction",
    "start": "340880",
    "end": "342080"
  },
  {
    "text": "as long as the value of r1 has the same",
    "start": "342080",
    "end": "344479"
  },
  {
    "text": "value in then it will do exactly the",
    "start": "344479",
    "end": "346080"
  },
  {
    "text": "same thing",
    "start": "346080",
    "end": "347120"
  },
  {
    "text": "so if it has a value of one in it it",
    "start": "347120",
    "end": "348720"
  },
  {
    "text": "will always add one and become two it",
    "start": "348720",
    "end": "350639"
  },
  {
    "text": "has a value of zero and it'll always",
    "start": "350639",
    "end": "351919"
  },
  {
    "text": "become",
    "start": "351919",
    "end": "353120"
  },
  {
    "text": "one and that's store one in it",
    "start": "353120",
    "end": "355120"
  },
  {
    "text": "so so it doesn't matter how it got there",
    "start": "355120",
    "end": "357840"
  },
  {
    "text": "and that is the key to understanding how",
    "start": "357840",
    "end": "359680"
  },
  {
    "text": "context switching works",
    "start": "359680",
    "end": "361600"
  },
  {
    "text": "what happens when we context switch is",
    "start": "361600",
    "end": "363759"
  },
  {
    "text": "we have one program running",
    "start": "363759",
    "end": "365680"
  },
  {
    "text": "and he's executing lots and lots of",
    "start": "365680",
    "end": "367120"
  },
  {
    "text": "different code to make things happen and",
    "start": "367120",
    "end": "369600"
  },
  {
    "text": "at some point that probe gets",
    "start": "369600",
    "end": "370880"
  },
  {
    "text": "interrupted either because it's called",
    "start": "370880",
    "end": "372800"
  },
  {
    "text": "the operating system or because there's",
    "start": "372800",
    "end": "374960"
  },
  {
    "text": "an interrupt in the computer which has",
    "start": "374960",
    "end": "377039"
  },
  {
    "text": "hit the operating system and the",
    "start": "377039",
    "end": "378080"
  },
  {
    "text": "operating system says okay you've had",
    "start": "378080",
    "end": "379360"
  },
  {
    "text": "enough time on this i'm going to switch",
    "start": "379360",
    "end": "381039"
  },
  {
    "text": "to something else the things that we",
    "start": "381039",
    "end": "382560"
  },
  {
    "text": "talked about briefly in the previous",
    "start": "382560",
    "end": "384080"
  },
  {
    "text": "video let's say we are",
    "start": "384080",
    "end": "386400"
  },
  {
    "text": "here we've got to this point in our",
    "start": "386400",
    "end": "388560"
  },
  {
    "text": "program we've got an interrupt happening",
    "start": "388560",
    "end": "390319"
  },
  {
    "text": "here and we're going to context switch",
    "start": "390319",
    "end": "392560"
  },
  {
    "text": "now the operating system when it",
    "start": "392560",
    "end": "393680"
  },
  {
    "text": "contacts which is needs to make sure",
    "start": "393680",
    "end": "395759"
  },
  {
    "text": "that when it comes back here this",
    "start": "395759",
    "end": "397199"
  },
  {
    "text": "problem continues as if nothing had",
    "start": "397199",
    "end": "398880"
  },
  {
    "text": "happened so just so that we can be",
    "start": "398880",
    "end": "400800"
  },
  {
    "text": "absolutely clear on this so when you say",
    "start": "400800",
    "end": "402240"
  },
  {
    "text": "context switching this is switching",
    "start": "402240",
    "end": "403759"
  },
  {
    "text": "jilly babies in our preview yeah so this",
    "start": "403759",
    "end": "405360"
  },
  {
    "text": "is switching from one",
    "start": "405360",
    "end": "406880"
  },
  {
    "text": "program running to the other program",
    "start": "406880",
    "end": "408960"
  },
  {
    "text": "running so we're going from this one to",
    "start": "408960",
    "end": "410560"
  },
  {
    "text": "this one and then back to this one as if",
    "start": "410560",
    "end": "413039"
  },
  {
    "text": "nothing had happened when this one had",
    "start": "413039",
    "end": "414400"
  },
  {
    "text": "run",
    "start": "414400",
    "end": "415440"
  },
  {
    "text": "so we need to switch from this one so",
    "start": "415440",
    "end": "416800"
  },
  {
    "text": "this is the",
    "start": "416800",
    "end": "417840"
  },
  {
    "text": "first one and we're going to start",
    "start": "417840",
    "end": "419120"
  },
  {
    "text": "running this one so at this point we",
    "start": "419120",
    "end": "420479"
  },
  {
    "text": "need to store",
    "start": "420479",
    "end": "421759"
  },
  {
    "text": "the state or the context of this program",
    "start": "421759",
    "end": "424319"
  },
  {
    "text": "so that",
    "start": "424319",
    "end": "425360"
  },
  {
    "text": "we can then after we've run this one",
    "start": "425360",
    "end": "428000"
  },
  {
    "text": "switch it back",
    "start": "428000",
    "end": "429280"
  },
  {
    "text": "to running this program",
    "start": "429280",
    "end": "431280"
  },
  {
    "text": "instead and this can continue as if",
    "start": "431280",
    "end": "433039"
  },
  {
    "text": "nothing had happened",
    "start": "433039",
    "end": "434560"
  },
  {
    "text": "and as we've seen the reason we can do",
    "start": "434560",
    "end": "436720"
  },
  {
    "text": "that is because as long as the values in",
    "start": "436720",
    "end": "438960"
  },
  {
    "text": "our registers have exactly the same",
    "start": "438960",
    "end": "441039"
  },
  {
    "text": "values and as long as the value in",
    "start": "441039",
    "end": "442479"
  },
  {
    "text": "memory",
    "start": "442479",
    "end": "443440"
  },
  {
    "text": "have exactly the same values then the",
    "start": "443440",
    "end": "445520"
  },
  {
    "text": "program will continue to execute in the",
    "start": "445520",
    "end": "446960"
  },
  {
    "text": "same thing each of these instructions",
    "start": "446960",
    "end": "449120"
  },
  {
    "text": "only depends on the values on the",
    "start": "449120",
    "end": "450639"
  },
  {
    "text": "registers",
    "start": "450639",
    "end": "452000"
  },
  {
    "text": "not how they got there",
    "start": "452000",
    "end": "454000"
  },
  {
    "text": "so all we need to do is make sure",
    "start": "454000",
    "end": "456000"
  },
  {
    "text": "whenever we switch from one program",
    "start": "456000",
    "end": "458639"
  },
  {
    "text": "to another",
    "start": "458639",
    "end": "461039"
  },
  {
    "text": "that we keep track of the state of the",
    "start": "461039",
    "end": "463199"
  },
  {
    "text": "program its context so that when we come",
    "start": "463199",
    "end": "466080"
  },
  {
    "text": "to load a different one we can switch in",
    "start": "466080",
    "end": "468400"
  },
  {
    "text": "its state and it will carry so how do we",
    "start": "468400",
    "end": "470400"
  },
  {
    "text": "go about storing the state of the",
    "start": "470400",
    "end": "471520"
  },
  {
    "text": "program we need to store certain things",
    "start": "471520",
    "end": "473440"
  },
  {
    "text": "we need to store the value of the",
    "start": "473440",
    "end": "474319"
  },
  {
    "text": "registers and any other state that is",
    "start": "474319",
    "end": "477120"
  },
  {
    "text": "responsible for keeping the program",
    "start": "477120",
    "end": "478639"
  },
  {
    "text": "running",
    "start": "478639",
    "end": "479680"
  },
  {
    "text": "now things in memory we can hide quite",
    "start": "479680",
    "end": "481280"
  },
  {
    "text": "easily modern operating systems support",
    "start": "481280",
    "end": "482960"
  },
  {
    "text": "virtual memory and so we can just map",
    "start": "482960",
    "end": "485280"
  },
  {
    "text": "one process memory out and map another",
    "start": "485280",
    "end": "487120"
  },
  {
    "text": "process memory in so that preserves the",
    "start": "487120",
    "end": "488639"
  },
  {
    "text": "state of the memory very easily the more",
    "start": "488639",
    "end": "491759"
  },
  {
    "text": "involved part it comes in storing the",
    "start": "491759",
    "end": "493599"
  },
  {
    "text": "state of the registers and storing the",
    "start": "493599",
    "end": "494879"
  },
  {
    "text": "state of the cpu but actually that ends",
    "start": "494879",
    "end": "497280"
  },
  {
    "text": "up being relatively straightforward what",
    "start": "497280",
    "end": "499520"
  },
  {
    "text": "we do is we have a process control block",
    "start": "499520",
    "end": "501520"
  },
  {
    "text": "for each process in our operating system",
    "start": "501520",
    "end": "503680"
  },
  {
    "text": "and as part of that we store the values",
    "start": "503680",
    "end": "506080"
  },
  {
    "text": "of the registers and a few other things",
    "start": "506080",
    "end": "507840"
  },
  {
    "text": "in there so if we start off by having a",
    "start": "507840",
    "end": "510160"
  },
  {
    "text": "look at our process control box we have",
    "start": "510160",
    "end": "512399"
  },
  {
    "text": "a register pointing to that and we can",
    "start": "512399",
    "end": "514000"
  },
  {
    "text": "use r13 for this then we'll point into",
    "start": "514000",
    "end": "516399"
  },
  {
    "text": "it at a certain point",
    "start": "516399",
    "end": "518159"
  },
  {
    "text": "now the thing about the arm chip is that",
    "start": "518159",
    "end": "520159"
  },
  {
    "text": "to make interrupts fast it actually has",
    "start": "520159",
    "end": "522159"
  },
  {
    "text": "registers that can overlay other",
    "start": "522159",
    "end": "523839"
  },
  {
    "text": "registers so i'm using r13 here but this",
    "start": "523839",
    "end": "526480"
  },
  {
    "text": "is the register that exists in",
    "start": "526480",
    "end": "528240"
  },
  {
    "text": "supervisor mode inside the cpu it's not",
    "start": "528240",
    "end": "530480"
  },
  {
    "text": "the same register that we use when we're",
    "start": "530480",
    "end": "533040"
  },
  {
    "text": "writing our code that runs in user mode",
    "start": "533040",
    "end": "534720"
  },
  {
    "text": "we talked about that in another video",
    "start": "534720",
    "end": "536800"
  },
  {
    "text": "so the first thing i'm going to do",
    "start": "536800",
    "end": "538720"
  },
  {
    "text": "is store",
    "start": "538720",
    "end": "540800"
  },
  {
    "text": "multiple registers into memory at the",
    "start": "540800",
    "end": "543279"
  },
  {
    "text": "dress pointed to by r13 and i'm actually",
    "start": "543279",
    "end": "545360"
  },
  {
    "text": "going to take all the registers r0",
    "start": "545360",
    "end": "548080"
  },
  {
    "text": "through r14 so i'm dumping the registers",
    "start": "548080",
    "end": "550800"
  },
  {
    "text": "into memory so these get written in here",
    "start": "550800",
    "end": "552880"
  },
  {
    "text": "r0 r1 and that's just copying the values",
    "start": "552880",
    "end": "555920"
  },
  {
    "text": "in and that's just ram as it is",
    "start": "555920",
    "end": "558080"
  },
  {
    "text": "just normal ram that's been allocated as",
    "start": "558080",
    "end": "559760"
  },
  {
    "text": "part of the operating system we're",
    "start": "559760",
    "end": "561120"
  },
  {
    "text": "calling this bit we've set things up so",
    "start": "561120",
    "end": "562720"
  },
  {
    "text": "pointing at that",
    "start": "562720",
    "end": "564560"
  },
  {
    "text": "but we need to be careful because the",
    "start": "564560",
    "end": "566080"
  },
  {
    "text": "state of our cpu isn't just stored in",
    "start": "566080",
    "end": "568080"
  },
  {
    "text": "the registers that we can access it's",
    "start": "568080",
    "end": "569680"
  },
  {
    "text": "another register the status register",
    "start": "569680",
    "end": "572000"
  },
  {
    "text": "which contains the flags that decide",
    "start": "572000",
    "end": "573839"
  },
  {
    "text": "whether we can branch because if things",
    "start": "573839",
    "end": "575279"
  },
  {
    "text": "have been compared and they're equal or",
    "start": "575279",
    "end": "576720"
  },
  {
    "text": "not equal or less than they're greater",
    "start": "576720",
    "end": "578080"
  },
  {
    "text": "than so we also need to store that the",
    "start": "578080",
    "end": "580000"
  },
  {
    "text": "way we do that",
    "start": "580000",
    "end": "581519"
  },
  {
    "text": "is we move that status register into",
    "start": "581519",
    "end": "585200"
  },
  {
    "text": "r0",
    "start": "585200",
    "end": "586640"
  },
  {
    "text": "like so so we're copying that register",
    "start": "586640",
    "end": "588640"
  },
  {
    "text": "into there and then we can store that",
    "start": "588640",
    "end": "591440"
  },
  {
    "text": "into memory below here so we're storing",
    "start": "591440",
    "end": "593760"
  },
  {
    "text": "again",
    "start": "593760",
    "end": "594640"
  },
  {
    "text": "relative to r13",
    "start": "594640",
    "end": "596800"
  },
  {
    "text": "the value of r0 which is now the value",
    "start": "596800",
    "end": "598800"
  },
  {
    "text": "of the status register so that goes in",
    "start": "598800",
    "end": "600560"
  },
  {
    "text": "below",
    "start": "600560",
    "end": "601519"
  },
  {
    "text": "where we were before",
    "start": "601519",
    "end": "603680"
  },
  {
    "text": "and also the value in r14 which because",
    "start": "603680",
    "end": "606079"
  },
  {
    "text": "of the way the arm places the work will",
    "start": "606079",
    "end": "607360"
  },
  {
    "text": "be the return address",
    "start": "607360",
    "end": "608959"
  },
  {
    "text": "of our program or way we want to",
    "start": "608959",
    "end": "610880"
  },
  {
    "text": "continue",
    "start": "610880",
    "end": "612160"
  },
  {
    "text": "running from so we store that",
    "start": "612160",
    "end": "614880"
  },
  {
    "text": "in there",
    "start": "614880",
    "end": "616000"
  },
  {
    "text": "what do we want to do next well next we",
    "start": "616000",
    "end": "618320"
  },
  {
    "text": "want to get the process control block of",
    "start": "618320",
    "end": "620560"
  },
  {
    "text": "the next process we want to do",
    "start": "620560",
    "end": "622480"
  },
  {
    "text": "and the way the arm suggests you do that",
    "start": "622480",
    "end": "624240"
  },
  {
    "text": "is that you load r13",
    "start": "624240",
    "end": "626560"
  },
  {
    "text": "with the value in memory pointed to by",
    "start": "626560",
    "end": "628720"
  },
  {
    "text": "the register r12 again that would have",
    "start": "628720",
    "end": "630399"
  },
  {
    "text": "been set up",
    "start": "630399",
    "end": "631680"
  },
  {
    "text": "by something else and then you add four",
    "start": "631680",
    "end": "633519"
  },
  {
    "text": "on to the end so that you're then",
    "start": "633519",
    "end": "635040"
  },
  {
    "text": "porting the next process probably want",
    "start": "635040",
    "end": "636640"
  },
  {
    "text": "to check here",
    "start": "636640",
    "end": "638320"
  },
  {
    "text": "that you're not pointing at a null",
    "start": "638320",
    "end": "640000"
  },
  {
    "text": "pointer",
    "start": "640000",
    "end": "641120"
  },
  {
    "text": "because if you are things would crash",
    "start": "641120",
    "end": "643040"
  },
  {
    "text": "and so if we're not then what we do is",
    "start": "643040",
    "end": "645440"
  },
  {
    "text": "we load multiple registers and then down",
    "start": "645440",
    "end": "648480"
  },
  {
    "text": "db",
    "start": "648480",
    "end": "649600"
  },
  {
    "text": "if not equal to zero from our 13 which",
    "start": "649600",
    "end": "652640"
  },
  {
    "text": "we've now pointed out but remember we're",
    "start": "652640",
    "end": "653920"
  },
  {
    "text": "still pointing at the same thing",
    "start": "653920",
    "end": "655040"
  },
  {
    "text": "actually we're pointing",
    "start": "655040",
    "end": "656959"
  },
  {
    "text": "down here now",
    "start": "656959",
    "end": "659760"
  },
  {
    "text": "so we load them back into r0",
    "start": "659760",
    "end": "663279"
  },
  {
    "text": "and r14 we then move",
    "start": "663279",
    "end": "666480"
  },
  {
    "text": "back into the status register that we",
    "start": "666480",
    "end": "668160"
  },
  {
    "text": "had before we'll just simplify things a",
    "start": "668160",
    "end": "669760"
  },
  {
    "text": "bit for the point of this video the",
    "start": "669760",
    "end": "671600"
  },
  {
    "text": "value on so we're setting the status",
    "start": "671600",
    "end": "672880"
  },
  {
    "text": "register back up",
    "start": "672880",
    "end": "675040"
  },
  {
    "text": "and then we move",
    "start": "675040",
    "end": "677839"
  },
  {
    "text": "the registers that were at our r13",
    "start": "677839",
    "end": "681680"
  },
  {
    "text": "back into r0 sorry to r14 but of course",
    "start": "681680",
    "end": "685920"
  },
  {
    "text": "these are the registers from the other",
    "start": "685920",
    "end": "687360"
  },
  {
    "text": "process because we changed",
    "start": "687360",
    "end": "689519"
  },
  {
    "text": "here",
    "start": "689519",
    "end": "690480"
  },
  {
    "text": "which process we're pointing at and the",
    "start": "690480",
    "end": "692800"
  },
  {
    "text": "last thing we need to do is we just need",
    "start": "692800",
    "end": "694160"
  },
  {
    "text": "to wait a bit so we run an instruction",
    "start": "694160",
    "end": "696240"
  },
  {
    "text": "which doesn't do anything",
    "start": "696240",
    "end": "698079"
  },
  {
    "text": "and we then set up the program counter",
    "start": "698079",
    "end": "700640"
  },
  {
    "text": "so we move into the program counter the",
    "start": "700640",
    "end": "702880"
  },
  {
    "text": "value which we put in r14 but because of",
    "start": "702880",
    "end": "705120"
  },
  {
    "text": "the way the pipeline works on the arm",
    "start": "705120",
    "end": "706959"
  },
  {
    "text": "cpu",
    "start": "706959",
    "end": "708079"
  },
  {
    "text": "we have to subtract four and so if we",
    "start": "708079",
    "end": "710079"
  },
  {
    "text": "execute that block of code we can",
    "start": "710079",
    "end": "712240"
  },
  {
    "text": "preserve the contents of the current",
    "start": "712240",
    "end": "714079"
  },
  {
    "text": "process",
    "start": "714079",
    "end": "715120"
  },
  {
    "text": "copying its registers in your status",
    "start": "715120",
    "end": "716560"
  },
  {
    "text": "register that's the important bit and",
    "start": "716560",
    "end": "718480"
  },
  {
    "text": "then loading the value of the previous",
    "start": "718480",
    "end": "721040"
  },
  {
    "text": "programs status register",
    "start": "721040",
    "end": "723519"
  },
  {
    "text": "and values so then we can just go back",
    "start": "723519",
    "end": "726079"
  },
  {
    "text": "to our program",
    "start": "726079",
    "end": "728079"
  },
  {
    "text": "and continue running our instructions as",
    "start": "728079",
    "end": "729839"
  },
  {
    "text": "if nothing had happened because all the",
    "start": "729839",
    "end": "731519"
  },
  {
    "text": "registers have the same values or the",
    "start": "731519",
    "end": "733680"
  },
  {
    "text": "memory addresses have the same value and",
    "start": "733680",
    "end": "735440"
  },
  {
    "text": "the status register of course which we",
    "start": "735440",
    "end": "737040"
  },
  {
    "text": "didn't have before",
    "start": "737040",
    "end": "738800"
  },
  {
    "text": "also has the same value now for",
    "start": "738800",
    "end": "740720"
  },
  {
    "text": "instruction like this preserving the",
    "start": "740720",
    "end": "742320"
  },
  {
    "text": "status schedule wouldn't have made any",
    "start": "742320",
    "end": "743680"
  },
  {
    "text": "difference but if our switch had",
    "start": "743680",
    "end": "744959"
  },
  {
    "text": "happened here after the compare",
    "start": "744959",
    "end": "746560"
  },
  {
    "text": "instruction then if that got corrupted",
    "start": "746560",
    "end": "749360"
  },
  {
    "text": "then the branch wouldn't do as we'd",
    "start": "749360",
    "end": "751040"
  },
  {
    "text": "expect so context switching is",
    "start": "751040",
    "end": "752560"
  },
  {
    "text": "relatively easy to implement you just",
    "start": "752560",
    "end": "753839"
  },
  {
    "text": "have to preserve all the registers of",
    "start": "753839",
    "end": "754959"
  },
  {
    "text": "one process and then load back in the",
    "start": "754959",
    "end": "757200"
  },
  {
    "text": "preserved registers for the new process",
    "start": "757200",
    "end": "761440"
  },
  {
    "text": "same thing can be done to start a new",
    "start": "761440",
    "end": "763279"
  },
  {
    "text": "process we just set up a dummy process",
    "start": "763279",
    "end": "765200"
  },
  {
    "text": "control block which contains empty",
    "start": "765200",
    "end": "767519"
  },
  {
    "text": "values for those registers zero say and",
    "start": "767519",
    "end": "769760"
  },
  {
    "text": "then we can just load it in and move it",
    "start": "769760",
    "end": "771279"
  },
  {
    "text": "from runnable back to running to get",
    "start": "771279",
    "end": "773279"
  },
  {
    "text": "things started",
    "start": "773279",
    "end": "774639"
  },
  {
    "text": "so that's the sort of mechanics about",
    "start": "774639",
    "end": "776240"
  },
  {
    "text": "how we save one process and then moving",
    "start": "776240",
    "end": "778800"
  },
  {
    "text": "another one the only other thing we need",
    "start": "778800",
    "end": "780240"
  },
  {
    "text": "to do is decide when we do this",
    "start": "780240",
    "end": "782720"
  },
  {
    "text": "that's where things get slightly",
    "start": "782720",
    "end": "783920"
  },
  {
    "text": "trickier",
    "start": "783920",
    "end": "785040"
  },
  {
    "text": "so we said that there's two places we",
    "start": "785040",
    "end": "786880"
  },
  {
    "text": "could do it we could either do it when",
    "start": "786880",
    "end": "789600"
  },
  {
    "text": "an operating system call is made i when",
    "start": "789600",
    "end": "791600"
  },
  {
    "text": "the user asks the operating system to do",
    "start": "791600",
    "end": "793120"
  },
  {
    "text": "something we could then make a switch",
    "start": "793120",
    "end": "794959"
  },
  {
    "text": "and that's relatively straightforward",
    "start": "794959",
    "end": "796079"
  },
  {
    "text": "the operating system gets to the end of",
    "start": "796079",
    "end": "797200"
  },
  {
    "text": "whatever it was it was doing for the",
    "start": "797200",
    "end": "798480"
  },
  {
    "text": "process and it can then make a context",
    "start": "798480",
    "end": "800160"
  },
  {
    "text": "switch so it moves to the different",
    "start": "800160",
    "end": "801600"
  },
  {
    "text": "process so we can just execute the code",
    "start": "801600",
    "end": "803440"
  },
  {
    "text": "like that and do that and that's fine",
    "start": "803440",
    "end": "806079"
  },
  {
    "text": "the other time we can do it is by using",
    "start": "806079",
    "end": "807839"
  },
  {
    "text": "an interrupt so what we do is we set up",
    "start": "807839",
    "end": "810079"
  },
  {
    "text": "the hardware of our system and this can",
    "start": "810079",
    "end": "812079"
  },
  {
    "text": "either be a dedicated heart piece of",
    "start": "812079",
    "end": "814240"
  },
  {
    "text": "hardware it's generates this interrupt",
    "start": "814240",
    "end": "816000"
  },
  {
    "text": "or the some cpus enable you to do that",
    "start": "816000",
    "end": "818320"
  },
  {
    "text": "on the actual cpu itself to generate an",
    "start": "818320",
    "end": "820240"
  },
  {
    "text": "interrupt at a regular piece of time",
    "start": "820240",
    "end": "822320"
  },
  {
    "text": "because the circuitry's all got",
    "start": "822320",
    "end": "823839"
  },
  {
    "text": "integrated into the system",
    "start": "823839",
    "end": "825680"
  },
  {
    "text": "we set up that interrupt to happen",
    "start": "825680",
    "end": "827040"
  },
  {
    "text": "regularly let's say every 200th of a",
    "start": "827040",
    "end": "828720"
  },
  {
    "text": "second",
    "start": "828720",
    "end": "829920"
  },
  {
    "text": "and when that fires",
    "start": "829920",
    "end": "831839"
  },
  {
    "text": "we can stop whatever process is running",
    "start": "831839",
    "end": "833839"
  },
  {
    "text": "because we're now in the operating",
    "start": "833839",
    "end": "834880"
  },
  {
    "text": "system code so it can execute the",
    "start": "834880",
    "end": "836639"
  },
  {
    "text": "contact switch to stop it running",
    "start": "836639",
    "end": "838800"
  },
  {
    "text": "and then move in to another process and",
    "start": "838800",
    "end": "841120"
  },
  {
    "text": "it will continue as is",
    "start": "841120",
    "end": "842560"
  },
  {
    "text": "the only time you have to be careful is",
    "start": "842560",
    "end": "844480"
  },
  {
    "text": "if you're actually running operating",
    "start": "844480",
    "end": "845680"
  },
  {
    "text": "system code at that point when the",
    "start": "845680",
    "end": "847199"
  },
  {
    "text": "interrupts happen",
    "start": "847199",
    "end": "848560"
  },
  {
    "text": "you probably don't want to switch out in",
    "start": "848560",
    "end": "850480"
  },
  {
    "text": "the middle of an operating system call",
    "start": "850480",
    "end": "852639"
  },
  {
    "text": "so probably what you do in that",
    "start": "852639",
    "end": "853839"
  },
  {
    "text": "situation is defer it until the",
    "start": "853839",
    "end": "855440"
  },
  {
    "text": "operating system call it finished and",
    "start": "855440",
    "end": "857279"
  },
  {
    "text": "then switch at that point otherwise you",
    "start": "857279",
    "end": "859519"
  },
  {
    "text": "get some weird things happening which",
    "start": "859519",
    "end": "860880"
  },
  {
    "text": "you might be halfway through setting up",
    "start": "860880",
    "end": "862240"
  },
  {
    "text": "the network to listen for something and",
    "start": "862240",
    "end": "864320"
  },
  {
    "text": "then you switch out and things could get",
    "start": "864320",
    "end": "865839"
  },
  {
    "text": "slightly corrected so you have to be",
    "start": "865839",
    "end": "866959"
  },
  {
    "text": "slightly",
    "start": "866959",
    "end": "868000"
  },
  {
    "text": "careful when you do it what happens when",
    "start": "868000",
    "end": "870480"
  },
  {
    "text": "a program relies on say time or the",
    "start": "870480",
    "end": "872560"
  },
  {
    "text": "clock how does that work i mean is that",
    "start": "872560",
    "end": "874480"
  },
  {
    "text": "something you just have to factor into",
    "start": "874480",
    "end": "875839"
  },
  {
    "text": "your code or ah so so for example if you",
    "start": "875839",
    "end": "878800"
  },
  {
    "text": "wanted a program that say was drawing a",
    "start": "878800",
    "end": "880320"
  },
  {
    "text": "real-time clock on screen how do you",
    "start": "880320",
    "end": "882160"
  },
  {
    "text": "make sure that well this again comes",
    "start": "882160",
    "end": "884240"
  },
  {
    "text": "down to things about scheduling which",
    "start": "884240",
    "end": "885839"
  },
  {
    "text": "we'll look at in another video is that",
    "start": "885839",
    "end": "887680"
  },
  {
    "text": "you probably want certain",
    "start": "887680",
    "end": "890720"
  }
]